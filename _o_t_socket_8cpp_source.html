<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otlib/OTSocket.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_o_t_socket_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otlib/OTSocket.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_o_t_socket_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿<span class="comment">/************************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *    </span>
<a name="l00003"></a>00003 <span class="comment"> *  OTSocket.cpp</span>
<a name="l00004"></a>00004 <span class="comment"> *  </span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">/************************************************************</span>
<a name="l00009"></a>00009 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00010"></a>00010 <span class="comment"> Hash: SHA1</span>
<a name="l00011"></a>00011 <span class="comment"> </span>
<a name="l00012"></a>00012 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00015"></a>00015 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00023"></a>00023 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> *  EMAIL:</span>
<a name="l00028"></a>00028 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00033"></a>00033 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00036"></a>00036 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00037"></a>00037 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00038"></a>00038 <span class="comment"> *</span>
<a name="l00039"></a>00039 <span class="comment"> *  WEBSITE:</span>
<a name="l00040"></a>00040 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> *  Components and licensing:</span>
<a name="l00043"></a>00043 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00048"></a>00048 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00051"></a>00051 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00052"></a>00052 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00053"></a>00053 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00054"></a>00054 <span class="comment"> *</span>
<a name="l00055"></a>00055 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00056"></a>00056 <span class="comment"> *</span>
<a name="l00057"></a>00057 <span class="comment"> *   LICENSE:</span>
<a name="l00058"></a>00058 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00059"></a>00059 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00060"></a>00060 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00061"></a>00061 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00062"></a>00062 <span class="comment"> *   option) any later version.</span>
<a name="l00063"></a>00063 <span class="comment"> *</span>
<a name="l00064"></a>00064 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00065"></a>00065 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00066"></a>00066 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00067"></a>00067 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00068"></a>00068 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00069"></a>00069 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00070"></a>00070 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00071"></a>00071 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00072"></a>00072 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00073"></a>00073 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00074"></a>00074 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00075"></a>00075 <span class="comment"> *</span>
<a name="l00076"></a>00076 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00077"></a>00077 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00078"></a>00078 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00079"></a>00079 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00080"></a>00080 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00081"></a>00081 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00082"></a>00082 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00083"></a>00083 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00084"></a>00084 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00085"></a>00085 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00086"></a>00086 <span class="comment"> *</span>
<a name="l00087"></a>00087 <span class="comment"> *   Lucre License:</span>
<a name="l00088"></a>00088 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00089"></a>00089 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00090"></a>00090 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00091"></a>00091 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00092"></a>00092 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00093"></a>00093 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00094"></a>00094 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00095"></a>00095 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00096"></a>00096 <span class="comment"> *   will continue to operate.</span>
<a name="l00097"></a>00097 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00098"></a>00098 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00099"></a>00099 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00100"></a>00100 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00101"></a>00101 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00102"></a>00102 <span class="comment"> *</span>
<a name="l00103"></a>00103 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00104"></a>00104 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00105"></a>00105 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00106"></a>00106 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00107"></a>00107 <span class="comment"> *</span>
<a name="l00108"></a>00108 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00109"></a>00109 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00110"></a>00110 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00111"></a>00111 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00112"></a>00112 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00113"></a>00113 <span class="comment"> *   more details.</span>
<a name="l00114"></a>00114 <span class="comment"> </span>
<a name="l00115"></a>00115 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00116"></a>00116 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00117"></a>00117 <span class="comment"> </span>
<a name="l00118"></a>00118 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00119"></a>00119 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00120"></a>00120 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00121"></a>00121 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00122"></a>00122 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00123"></a>00123 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00124"></a>00124 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00125"></a>00125 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00126"></a>00126 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00127"></a>00127 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00128"></a>00128 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00129"></a>00129 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00130"></a>00130 <span class="comment"> =uSzz</span>
<a name="l00131"></a>00131 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00132"></a>00132 <span class="comment"> **************************************************************/</span>
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_socket_8hpp.html">OTSocket.hpp</a>&gt;</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_log_8hpp.html">OTLog.hpp</a>&gt;</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="_o_t_socket_8cpp.html#a9864163cff548152f0f4101474df8c1f">00141</a> <span class="preprocessor">#define KEY_LATENCY_SEND_MS                 &quot;latency_send_ms&quot;</span>
<a name="l00142"></a><a class="code" href="_o_t_socket_8cpp.html#acb410bfdc3b4245bfc955c60690e38ed">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LATENCY_SEND_NO_TRIES           &quot;latency_send_no_tries&quot;</span>
<a name="l00143"></a><a class="code" href="_o_t_socket_8cpp.html#a8addbcfe9e68f675f5664c0b677e81f3">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LATENCY_RECEIVE_MS              &quot;latency_receive_ms&quot;</span>
<a name="l00144"></a><a class="code" href="_o_t_socket_8cpp.html#a668fd3846aaa863de12534d55368a704">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LATENCY_RECEIVE_NO_TRIES        &quot;latency_receive_no_tries&quot;</span>
<a name="l00145"></a><a class="code" href="_o_t_socket_8cpp.html#a47f1858d6897b5924241b9a69444693e">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LATENCY_DELAY_AFTER             &quot;latency_delay_after&quot;</span>
<a name="l00146"></a><a class="code" href="_o_t_socket_8cpp.html#af93484f5b0310d4bbda54c0e604bc8b9">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_IS_BLOCKING                     &quot;is_blocking&quot;</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00148"></a>00148 <span class="preprocessor">#ifdef OT_ZMQ_2_MODE</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span><span class="preprocessor">#include &lt;zmq.hpp&gt;</span>
<a name="l00150"></a>00150 <span class="preprocessor">#endif // OT_ZMQ_2_MODE</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a>00152 <span class="preprocessor">#ifdef OT_ZMQ_4_MODE</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="preprocessor">#include &lt;zmq/zmq.hpp&gt;</span>
<a name="l00154"></a>00154 <span class="preprocessor">#endif // OT_ZMQ_2_MODE</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">// OTSocket base class.</span>
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="class_o_t_socket.html#af564421e013226c819b46140129a614f">00160</a> <a class="code" href="class_o_t_socket.html#af564421e013226c819b46140129a614f">OTSocket::OTSocket</a>()
<a name="l00161"></a>00161 : m_Mutex(Mutex()),
<a name="l00162"></a>00162 m_lLatencySendMs(0),
<a name="l00163"></a>00163 m_nLatencySendNoTries(0),
<a name="l00164"></a>00164 m_lLatencyReceiveMs(0),
<a name="l00165"></a>00165 m_nLatencyReceiveNoTries(0),
<a name="l00166"></a>00166 m_lLatencyDelayAfter(0),
<a name="l00167"></a>00167 m_bIsBlocking(false),
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 m_bInitialized(false),
<a name="l00170"></a>00170 m_HasContext(false),
<a name="l00171"></a>00171 m_bConnected(false),
<a name="l00172"></a>00172 m_bListening(false),
<a name="l00173"></a>00173 m_strConnectPath(<span class="stringliteral">&quot;&quot;</span>),
<a name="l00174"></a>00174 m_strBindingPath(<span class="stringliteral">&quot;&quot;</span>)
<a name="l00175"></a>00175 {
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="class_o_t_socket_1_1_defaults.html#abacba35f39ba04a13edbf0477f3f6d09">00178</a> <a class="code" href="class_o_t_socket_1_1_defaults.html#abacba35f39ba04a13edbf0477f3f6d09">OTSocket::Defaults::Defaults</a>(
<a name="l00179"></a>00179     int64_t lLatencySendMs,
<a name="l00180"></a>00180     int32_t nLatencySendNoTries,
<a name="l00181"></a>00181     int64_t lLatencyReceiveMs,
<a name="l00182"></a>00182     int32_t nLatencyReceiveNoTries,
<a name="l00183"></a>00183     int64_t lLatencyDelayAfter,
<a name="l00184"></a>00184     <span class="keywordtype">bool</span> bIsBlocking)
<a name="l00185"></a>00185     : m_lLatencySendMs(lLatencySendMs),
<a name="l00186"></a>00186     m_nLatencySendNoTries(nLatencySendNoTries),
<a name="l00187"></a>00187     m_lLatencyReceiveMs(lLatencyReceiveMs),
<a name="l00188"></a>00188     m_nLatencyReceiveNoTries(nLatencyReceiveNoTries),
<a name="l00189"></a>00189     m_lLatencyDelayAfter(lLatencyDelayAfter),
<a name="l00190"></a>00190     m_bIsBlocking(bIsBlocking)
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 OTSocket::Mutex::Mutex()
<a name="l00196"></a>00196 : m_pMutex(new tthread::mutex)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 OTSocket::Mutex::~Mutex()
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (NULL != m_pMutex)   <span class="keyword">delete</span> m_pMutex;    m_pMutex = NULL;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 tthread::mutex * OTSocket::Mutex::Get()
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207     <span class="keywordflow">return</span> this-&gt;m_pMutex;
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="class_o_t_socket.html#a1154b4c4830d860ec5c4047bfc15af34">00210</a> tthread::mutex * <a class="code" href="class_o_t_socket.html#a1154b4c4830d860ec5c4047bfc15af34">OTSocket::GetMutex</a>()
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <span class="keywordflow">return</span> this-&gt;m_Mutex.Get();
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="class_o_t_socket.html#aac7b28cf63c959f95c3e47b8091b774f">00216</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#aac7b28cf63c959f95c3e47b8091b774f">OTSocket::Init</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_socket_1_1_defaults.html">Defaults</a> &amp; defaults)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00219"></a>00219     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <a class="code" href="class_o_t_socket.html#a2d7159c692f9aef9fc6a7ea8d1ea9176">m_lLatencySendMs</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#ac4047f98093dc9aadcd33cc4a793caa0">m_lLatencySendMs</a>;
<a name="l00224"></a>00224     <a class="code" href="class_o_t_socket.html#ab5bcda79d6f350998a75e1a3ec939a30">m_nLatencySendNoTries</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a07877c48585afc602c82be389acdffc2">m_nLatencySendNoTries</a>;
<a name="l00225"></a>00225     <a class="code" href="class_o_t_socket.html#ace0e9abac03f7086b27839e001368ce7">m_lLatencyReceiveMs</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a26cdcfd6bac73b11f2a3e38122f254ce">m_lLatencyReceiveMs</a>;
<a name="l00226"></a>00226     <a class="code" href="class_o_t_socket.html#a9f4dc1cc24a95a19819c185c714e2e79">m_nLatencyReceiveNoTries</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a6298d8c01c45346fa07ad440c0f834eb">m_nLatencyReceiveNoTries</a>;
<a name="l00227"></a>00227     <a class="code" href="class_o_t_socket.html#af082876ee29f067efd7435035c923b28">m_lLatencyDelayAfter</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#ae33ec7158f0c844f301f371f5d7d6852">m_lLatencyDelayAfter</a>;
<a name="l00228"></a>00228     <a class="code" href="class_o_t_socket.html#a6050f10a954355a2441b3324793dd148">m_bIsBlocking</a> = defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a869c06ed42ba4083511f0278cdc887c2">m_bIsBlocking</a>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a> = <span class="keyword">true</span>;
<a name="l00231"></a>00231     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="class_o_t_socket.html#add0344549ae888ff82972f9e008c3a39">00234</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#aac7b28cf63c959f95c3e47b8091b774f">OTSocket::Init</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_socket_1_1_defaults.html">Defaults</a> &amp; defaults, <a class="code" href="class_o_t_settings.html">OTSettings</a> * pSettings)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00239"></a>00239     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (NULL == pSettings) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordtype">bool</span> bIsNew;
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a03475b7711763cca0470c242f9c1c786">CheckSet_long</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#a9864163cff548152f0f4101474df8c1f">KEY_LATENCY_SEND_MS</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#ac4047f98093dc9aadcd33cc4a793caa0">m_lLatencySendMs</a>, <a class="code" href="class_o_t_socket.html#a2d7159c692f9aef9fc6a7ea8d1ea9176">m_lLatencySendMs</a>, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248         int64_t lResult = 0;
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a03475b7711763cca0470c242f9c1c786">CheckSet_long</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#acb410bfdc3b4245bfc955c60690e38ed">KEY_LATENCY_SEND_NO_TRIES</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a07877c48585afc602c82be389acdffc2">m_nLatencySendNoTries</a>, lResult, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00250"></a>00250         <a class="code" href="class_o_t_socket.html#ab5bcda79d6f350998a75e1a3ec939a30">m_nLatencySendNoTries</a> = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(lResult);
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252     {
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a03475b7711763cca0470c242f9c1c786">CheckSet_long</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#a8addbcfe9e68f675f5664c0b677e81f3">KEY_LATENCY_RECEIVE_MS</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a26cdcfd6bac73b11f2a3e38122f254ce">m_lLatencyReceiveMs</a>, <a class="code" href="class_o_t_socket.html#ace0e9abac03f7086b27839e001368ce7">m_lLatencyReceiveMs</a>, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     {
<a name="l00256"></a>00256         int64_t lResult = 0;
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a03475b7711763cca0470c242f9c1c786">CheckSet_long</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#a668fd3846aaa863de12534d55368a704">KEY_LATENCY_RECEIVE_NO_TRIES</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a6298d8c01c45346fa07ad440c0f834eb">m_nLatencyReceiveNoTries</a>, lResult, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00258"></a>00258         <a class="code" href="class_o_t_socket.html#a9f4dc1cc24a95a19819c185c714e2e79">m_nLatencyReceiveNoTries</a> = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(lResult);
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a03475b7711763cca0470c242f9c1c786">CheckSet_long</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#a47f1858d6897b5924241b9a69444693e">KEY_LATENCY_DELAY_AFTER</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#ae33ec7158f0c844f301f371f5d7d6852">m_lLatencyDelayAfter</a>, <a class="code" href="class_o_t_socket.html#af082876ee29f067efd7435035c923b28">m_lLatencyDelayAfter</a>, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (!pSettings-&gt;<a class="code" href="class_o_t_settings.html#a27314a76cb518d7959ffd100bb9d2103">CheckSet_bool</a>(<span class="stringliteral">&quot;latency&quot;</span>, <a class="code" href="_o_t_socket_8cpp.html#af93484f5b0310d4bbda54c0e604bc8b9">KEY_IS_BLOCKING</a>, defaults.<a class="code" href="class_o_t_socket_1_1_defaults.html#a869c06ed42ba4083511f0278cdc887c2">m_bIsBlocking</a>, <a class="code" href="class_o_t_socket.html#a6050f10a954355a2441b3324793dd148">m_bIsBlocking</a>, bIsNew)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a> = <span class="keyword">true</span>;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a><a class="code" href="class_o_t_socket.html#a9a82b48711ebe8ce96b94717a3cf6005">00272</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#a9a82b48711ebe8ce96b94717a3cf6005">OTSocket::IsInitialized</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>; }
<a name="l00273"></a><a class="code" href="class_o_t_socket.html#abf3a3309b1db9a9f069fc73f6621f2f6">00273</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#abf3a3309b1db9a9f069fc73f6621f2f6">OTSocket::HasContext</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>; }
<a name="l00274"></a><a class="code" href="class_o_t_socket.html#a9a2f0104b0fb249e9434e5403f088e2a">00274</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#a9a2f0104b0fb249e9434e5403f088e2a">OTSocket::IsConnected</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>; }
<a name="l00275"></a><a class="code" href="class_o_t_socket.html#a585731ab17304638fd97fc2b8425a08d">00275</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket.html#a585731ab17304638fd97fc2b8425a08d">OTSocket::IsListening</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>; }
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="class_o_t_socket.html#a7ca2e1cbd10342463b694ab113d52410">00277</a> <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; <a class="code" href="class_o_t_socket.html#a7ca2e1cbd10342463b694ab113d52410">OTSocket::GetConnectPath</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#a85f7e19c4e7a2e50f7cede42c2c0a521">m_strConnectPath</a>; }
<a name="l00278"></a><a class="code" href="class_o_t_socket.html#a1f0965df909124f363d2c4793027cd46">00278</a> <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; <a class="code" href="class_o_t_socket.html#a1f0965df909124f363d2c4793027cd46">OTSocket::GetBindingPath</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_socket.html#a8bf94304c29b3545fb7c54f24c346d78">m_strBindingPath</a>; }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="preprocessor">#ifdef OT_ZMQ_2_MODE</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>
<a name="l00284"></a>00284 <span class="comment">// OTSocket with zmq2x.</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="keyword">class </span>OTSocket_ZMQ_2::ZMQ2{
<a name="l00287"></a>00287 <span class="keyword">public</span>:
<a name="l00288"></a>00288     ZMQ2();
<a name="l00289"></a>00289     ~ZMQ2();
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     zmq::context_t  * context_zmq;
<a name="l00292"></a>00292     zmq::socket_t   * socket_zmq;
<a name="l00293"></a>00293 };
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 OTSocket_ZMQ_2::ZMQ2::ZMQ2()
<a name="l00297"></a>00297 : context_zmq(NULL),
<a name="l00298"></a>00298 socket_zmq(NULL)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 OTSocket_ZMQ_2::ZMQ2::~ZMQ2()
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304     <span class="keyword">delete</span> this-&gt;socket_zmq;
<a name="l00305"></a>00305     <span class="keyword">delete</span> this-&gt;context_zmq;
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 OTSocket_ZMQ_2::OTSocket_ZMQ_2()
<a name="l00310"></a>00310 :m_pzmq(new ZMQ2())
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 OTSocket_ZMQ_2::~OTSocket_ZMQ_2()
<a name="l00315"></a>00315 {
<a name="l00316"></a>00316     this-&gt;CloseSocket();
<a name="l00317"></a>00317     <span class="keyword">delete</span>(this-&gt;m_pzmq);
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::CloseSocket(<span class="keyword">const</span> <span class="keywordtype">bool</span> bNewContext <span class="comment">/*= false*/</span>)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (!m_bInitialized) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (!m_HasContext &amp;&amp; !bNewContext) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;socket_zmq)  zmq_close(m_pzmq-&gt;socket_zmq);
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;socket_zmq) <span class="keyword">delete</span> m_pzmq-&gt;socket_zmq;  m_pzmq-&gt;socket_zmq = NULL;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     m_bConnected = <span class="keyword">false</span>;
<a name="l00330"></a>00330     m_bListening = <span class="keyword">false</span>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::NewSocket(<span class="keyword">const</span> <span class="keywordtype">bool</span> bIsRequest)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (!m_bInitialized) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (!m_HasContext) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (!this-&gt;CloseSocket()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     m_pzmq-&gt;socket_zmq = <span class="keyword">new</span> zmq::socket_t(*m_pzmq-&gt;context_zmq, bIsRequest ? ZMQ_REQ : ZMQ_REP);  <span class="comment">// make a new socket</span>
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s failed to be created!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="keyword">const</span> <span class="keywordtype">int</span> linger = 0; <span class="comment">// close immediately</span>
<a name="l00347"></a>00347     m_pzmq-&gt;socket_zmq-&gt;setsockopt(ZMQ_LINGER, &amp;linger, <span class="keyword">sizeof</span> (linger));
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     m_bConnected = <span class="keyword">false</span>;
<a name="l00350"></a>00350     m_bListening = <span class="keyword">false</span>;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::NewContext()
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <span class="keywordflow">if</span> (!m_bInitialized) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     m_HasContext = <span class="keyword">false</span>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (!this-&gt;CloseSocket(<span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;context_zmq) zmq_term(m_pzmq-&gt;context_zmq);
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;context_zmq)    <span class="keyword">delete</span> m_pzmq-&gt;context_zmq; m_pzmq-&gt;context_zmq = NULL;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     m_pzmq-&gt;context_zmq = <span class="keyword">new</span> zmq::context_t(1);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     m_HasContext = <span class="keyword">true</span>;
<a name="l00369"></a>00369     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::RemakeSocket(<span class="keyword">const</span> <span class="keywordtype">bool</span> bNewContext <span class="comment">/*= false*/</span>) {
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     <span class="keywordflow">if</span> (!m_bInitialized) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (!m_HasContext) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (!m_bConnected || !m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (m_bConnected &amp;&amp; m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordtype">bool</span> bConnected = m_bConnected;
<a name="l00381"></a>00381     <span class="keywordtype">bool</span> bListening = m_bListening;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (bNewContext) this-&gt;NewContext();
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (bConnected) <span class="keywordflow">return</span> this-&gt;Connect();
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (bListening) <span class="keywordflow">return</span> this-&gt;Listen();
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Connect()
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (!m_bInitialized) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (!m_HasContext) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Listen!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (<span class="keyword">true</span> == m_bListening)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Must not be Listening, to Connect!\n&quot;</span>, __FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (!m_strConnectPath.Exists()) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (!this-&gt;NewSocket(<span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// NewSocket(true), Request Socket.</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="keywordflow">try</span> {
<a name="l00404"></a>00404         m_pzmq-&gt;socket_zmq-&gt;connect(m_strConnectPath.Get());
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00407"></a>00407         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00408"></a>00408         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     m_bConnected = <span class="keyword">true</span>;
<a name="l00412"></a>00412     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Listen()
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (!m_bInitialized) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (!m_HasContext) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Listen!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (<span class="keyword">true</span> == m_bConnected)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Must not be Connected, to Listen!\n&quot;</span>, __FUNCTION__);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (!m_strBindingPath.Exists()) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (!this-&gt;NewSocket(<span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// NewSocket(false), Responce Socket.</span>
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <span class="keywordflow">try</span> {
<a name="l00428"></a>00428         m_pzmq-&gt;socket_zmq-&gt;bind(m_strBindingPath.Get());  <span class="comment">// since m_strBindingPath was checked and set above.</span>
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00431"></a>00431         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00432"></a>00432         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     m_bListening = <span class="keyword">true</span>;
<a name="l00436"></a>00436     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Connect(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strConnectPath)
<a name="l00440"></a>00440 {
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (!strConnectPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s dosn&#39;t exist!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strConnectPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (5 &gt; strConnectPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is too short!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strConnectPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     m_strConnectPath = strConnectPath;  <span class="comment">// set the connection path.</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">return</span> (this-&gt;Connect());
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Listen(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strBindingPath)
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <span class="keywordflow">if</span> (!strBindingPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s dosn&#39;t exist!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strBindingPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00452"></a>00452     <span class="keywordflow">if</span> (5 &gt; strBindingPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is too short!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strBindingPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     m_strBindingPath = strBindingPath;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="keywordflow">return</span> (this-&gt;Listen());
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Send(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascEnvelope)
<a name="l00461"></a>00461 {
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (!m_bInitialized) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (0 &gt;= ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is zero length!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ascEnvelope&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00465"></a>00465     m_ascLastMsgSent.Set(ascEnvelope); <span class="comment">// In case we need to re-send.</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (!m_HasContext) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00468"></a>00468     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Send!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (!m_bConnected &amp;&amp; !m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (m_bConnected &amp;&amp; m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Send!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="comment">// -----------------------------------  </span>
<a name="l00476"></a>00476     <span class="keyword">const</span> <span class="keywordtype">long</span> lLatencySendMilliSec = m_lLatencySendMs;
<a name="l00477"></a>00477     <span class="keyword">const</span> <span class="keywordtype">long</span> lLatencySendMicroSec = lLatencySendMilliSec * 1000; <span class="comment">// Microsecond is 1000 times smaller than millisecond.</span>
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     zmq::message_t zmq_message(ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>());
<a name="l00480"></a>00480     memcpy((<span class="keywordtype">void</span>*)zmq_message.data(), ascEnvelope.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>());
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordtype">bool</span> bSuccessSending = <span class="keyword">false</span>;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (m_bIsBlocking)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486         bSuccessSending = m_pzmq-&gt;socket_zmq-&gt;send(zmq_message); <span class="comment">// Blocking.</span>
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488     <span class="keywordflow">else</span> <span class="comment">// not blocking</span>
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490         <span class="keywordtype">int</span>     nSendTries = m_nLatencySendNoTries;
<a name="l00491"></a>00491         <span class="keywordtype">long</span>    lDoubling = lLatencySendMicroSec;
<a name="l00492"></a>00492         <span class="keywordtype">bool</span>    bKeepTrying = <span class="keyword">true</span>;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494         <span class="keywordflow">while</span> (bKeepTrying &amp;&amp; (nSendTries &gt; 0))
<a name="l00495"></a>00495         {
<a name="l00496"></a>00496             zmq::pollitem_t items[] = {
<a name="l00497"></a>00497                 { (*m_pzmq-&gt;socket_zmq), 0, ZMQ_POLLOUT, 0 }
<a name="l00498"></a>00498             };
<a name="l00499"></a>00499 
<a name="l00500"></a>00500             <span class="keyword">const</span> <span class="keywordtype">int</span> nPoll = zmq::poll(&amp;items[0], 1, lDoubling);   <span class="comment">// ZMQ_POLLOUT, 1 item, timeout (microseconds in ZMQ 2.1; changes to milliseconds in 3.0)                   </span>
<a name="l00501"></a>00501             lDoubling *= 2;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             <span class="keywordflow">if</span> (items[0].revents &amp; ZMQ_POLLOUT)
<a name="l00504"></a>00504             {
<a name="l00505"></a>00505                 bSuccessSending = m_pzmq-&gt;socket_zmq-&gt;send(zmq_message, ZMQ_NOBLOCK); <span class="comment">// &lt;=========== SEND ===============</span>
<a name="l00506"></a>00506                 <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(1);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508                 <span class="keywordflow">if</span> (!bSuccessSending)
<a name="l00509"></a>00509                 {
<a name="l00510"></a>00510                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandleSendingError())
<a name="l00511"></a>00511                         bKeepTrying = <span class="keyword">false</span>;
<a name="l00512"></a>00512                 }
<a name="l00513"></a>00513                 <span class="keywordflow">else</span>
<a name="l00514"></a>00514                     <span class="keywordflow">break</span>; <span class="comment">// (Success -- we&#39;re done in this loop.)</span>
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1) == nPoll) <span class="comment">// error.</span>
<a name="l00517"></a>00517             {
<a name="l00518"></a>00518                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandlePollingError())
<a name="l00519"></a>00519                     bKeepTrying = <span class="keyword">false</span>;
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522             --nSendTries;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     <span class="comment">/*</span>
<a name="l00526"></a>00526 <span class="comment">    Normally, we try to send...</span>
<a name="l00527"></a>00527 <span class="comment">    If the send fails, we wait X ms and then try again (Y times).</span>
<a name="l00528"></a>00528 <span class="comment"></span>
<a name="l00529"></a>00529 <span class="comment">    BUT -- what if the failure was an errno==EAGAIN ?</span>
<a name="l00530"></a>00530 <span class="comment">    In that case, it&#39;s not a REAL failure, but rather, a &quot;failure right now, try again in a sec.&quot;</span>
<a name="l00531"></a>00531 <span class="comment">    */</span>
<a name="l00532"></a>00532     <span class="comment">// ***********************************</span>
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keywordflow">if</span> (bSuccessSending)
<a name="l00535"></a>00535         <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(m_lLatencyDelayAfter &gt; 0 ? m_lLatencyDelayAfter : 1);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="keywordflow">return</span> bSuccessSending;
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Send(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascEnvelope, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strConnectPath)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542     <span class="keyword">const</span> <span class="keywordtype">bool</span> bNewPath = m_strConnectPath.Compare(strConnectPath);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (!bNewPath) this-&gt;Connect(strConnectPath);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (!m_bConnected) <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="keywordflow">return</span> this-&gt;Send(ascEnvelope);
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::Receive(<a class="code" href="class_o_t_string.html">OTString</a> &amp; strServerReply)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553     <span class="keywordflow">if</span> (!m_bInitialized) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00554"></a>00554     <span class="keywordflow">if</span> (!m_HasContext) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00555"></a>00555     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Receive!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <span class="keywordflow">if</span> (!m_bConnected &amp;&amp; !m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (m_bConnected &amp;&amp; m_bListening) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Receive!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="comment">// -----------------------------------  </span>
<a name="l00563"></a>00563     <span class="keyword">const</span> <span class="keywordtype">long</span> lLatencyRecvMilliSec = m_lLatencyReceiveMs;
<a name="l00564"></a>00564     <span class="keyword">const</span> <span class="keywordtype">long</span> lLatencyRecvMicroSec = lLatencyRecvMilliSec * 1000;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">// ***********************************</span>
<a name="l00567"></a>00567     <span class="comment">//ââGetâtheâreply.</span>
<a name="l00568"></a>00568     zmq::message_t zmq_message;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordtype">bool</span> bSuccessReceiving = <span class="keyword">false</span>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="comment">// If failure receiving, re-tries 2 times, with 4000 ms max delay between each (Doubling every time.)</span>
<a name="l00573"></a>00573     <span class="comment">//</span>
<a name="l00574"></a>00574     <span class="keywordflow">if</span> (m_bIsBlocking)
<a name="l00575"></a>00575     {
<a name="l00576"></a>00576         bSuccessReceiving = m_pzmq-&gt;socket_zmq-&gt;recv(&amp;zmq_message); <span class="comment">// Blocking.</span>
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578     <span class="keywordflow">else</span>    <span class="comment">// not blocking</span>
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <span class="keywordtype">long</span>    lDoubling = lLatencyRecvMicroSec;
<a name="l00581"></a>00581         <span class="keywordtype">int</span>     nReceiveTries = m_nLatencyReceiveNoTries;
<a name="l00582"></a>00582         <span class="keywordtype">bool</span>    expect_reply = <span class="keyword">true</span>;
<a name="l00583"></a>00583         <span class="keywordflow">while</span> (expect_reply)
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585             <span class="comment">//  Poll socket for a reply, with timeout</span>
<a name="l00586"></a>00586             zmq::pollitem_t items[] = { { *m_pzmq-&gt;socket_zmq, 0, ZMQ_POLLIN, 0 } };
<a name="l00587"></a>00587 
<a name="l00588"></a>00588             <span class="keyword">const</span> <span class="keywordtype">int</span> nPoll = zmq::poll(&amp;items[0], 1, lDoubling);
<a name="l00589"></a>00589             lDoubling *= 2;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591             <span class="comment">//  If we got a reply, process it</span>
<a name="l00592"></a>00592             <span class="keywordflow">if</span> (items[0].revents &amp; ZMQ_POLLIN)
<a name="l00593"></a>00593             {
<a name="l00594"></a>00594                 bSuccessReceiving = m_pzmq-&gt;socket_zmq-&gt;recv(&amp;zmq_message, ZMQ_NOBLOCK); <span class="comment">// &lt;=========== RECEIVE ===============</span>
<a name="l00595"></a>00595                 <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(1);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597                 <span class="keywordflow">if</span> (!bSuccessReceiving)
<a name="l00598"></a>00598                 {
<a name="l00599"></a>00599                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandleReceivingError())
<a name="l00600"></a>00600                         expect_reply = <span class="keyword">false</span>;
<a name="l00601"></a>00601                 }
<a name="l00602"></a>00602                 <span class="keywordflow">else</span>
<a name="l00603"></a>00603                     <span class="keywordflow">break</span>; <span class="comment">// (Success -- we&#39;re done in this loop.)             </span>
<a name="l00604"></a>00604             }
<a name="l00605"></a>00605             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nReceiveTries == 0)
<a name="l00606"></a>00606             {
<a name="l00607"></a>00607                 <span class="comment">//OTLog::Error(&quot;OTSocket::Receive: no message.\n&quot;);</span>
<a name="l00608"></a>00608                 expect_reply = <span class="keyword">false</span>;
<a name="l00609"></a>00609                 <span class="keywordflow">break</span>;
<a name="l00610"></a>00610             }
<a name="l00611"></a>00611             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1) == nPoll) <span class="comment">// error.</span>
<a name="l00612"></a>00612             {
<a name="l00613"></a>00613                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandlePollingError())
<a name="l00614"></a>00614                     expect_reply = <span class="keyword">false</span>;
<a name="l00615"></a>00615             }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617             --nReceiveTries;
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619     }
<a name="l00620"></a>00620     <span class="comment">// ***********************************</span>
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     <span class="keywordflow">if</span> (bSuccessReceiving &amp;&amp; (zmq_message.size() &gt; 0))
<a name="l00623"></a>00623         strServerReply.<a class="code" href="class_o_t_string.html#afe8b9f0781c0159cd7575b92af89bf9a">MemSet</a>(static_cast&lt;const char*&gt;(zmq_message.data()), static_cast&lt;uint32_t&gt; (zmq_message.size()));
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">return</span> (bSuccessReceiving &amp;&amp; (zmq_message.size() &gt; 0));
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::HandlePollingError()
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <span class="keywordflow">switch</span> (errno) {
<a name="l00634"></a>00634         <span class="comment">// At least one of the members of the items array refers to a socket whose associated ÃMQ context was terminated.</span>
<a name="l00635"></a>00635     <span class="keywordflow">case</span> ETERM:
<a name="l00636"></a>00636         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Failure: At least one of the members of the items array refers to a socket whose associated ÃMQ context was terminated. (Deleting and re-creating the context.)\n&quot;</span>);
<a name="l00637"></a>00637         this-&gt;NewContext();
<a name="l00638"></a>00638         <span class="keywordflow">break</span>;
<a name="l00639"></a>00639         <span class="comment">// The provided items was not valid (NULL).</span>
<a name="l00640"></a>00640     <span class="keywordflow">case</span> EFAULT:
<a name="l00641"></a>00641         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Failed: The provided polling items were not valid (NULL).\n&quot;</span>);
<a name="l00642"></a>00642         <span class="keywordflow">break</span>;
<a name="l00643"></a>00643         <span class="comment">// The operation was interrupted by delivery of a signal before any events were available.</span>
<a name="l00644"></a>00644     <span class="keywordflow">case</span> EINTR:
<a name="l00645"></a>00645         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: The operation was interrupted by delivery of a signal before any events were available. Re-trying...\n&quot;</span>);
<a name="l00646"></a>00646         bRetVal = <span class="keyword">true</span>;
<a name="l00647"></a>00647         <span class="keywordflow">break</span>;
<a name="l00648"></a>00648     <span class="keywordflow">default</span>:
<a name="l00649"></a>00649         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Default case. Re-trying...\n&quot;</span>);
<a name="l00650"></a>00650         bRetVal = <span class="keyword">true</span>;
<a name="l00651"></a>00651         <span class="keywordflow">break</span>;
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653     <span class="keywordflow">return</span> bRetVal;
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::HandleSendingError()
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <span class="keywordflow">switch</span> (errno) {
<a name="l00661"></a>00661         <span class="comment">// Non-blocking mode was requested and the message cannot be sent at the moment.</span>
<a name="l00662"></a>00662     <span class="keywordflow">case</span> EAGAIN:
<a name="l00663"></a>00663         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleSendingError: Non-blocking mode was requested and the message cannot be sent at the moment. Re-trying...\n&quot;</span>);
<a name="l00664"></a>00664         bRetVal = <span class="keyword">true</span>;
<a name="l00665"></a>00665         <span class="keywordflow">break</span>;
<a name="l00666"></a>00666         <span class="comment">// The zmq_send() operation is not supported by this socket type.</span>
<a name="l00667"></a>00667     <span class="keywordflow">case</span> ENOTSUP:
<a name="l00668"></a>00668         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: failure: The zmq_send() operation is not supported by this socket type.\n&quot;</span>);
<a name="l00669"></a>00669         <span class="keywordflow">break</span>;
<a name="l00670"></a>00670         <span class="comment">// The zmq_send() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. This error may occur with socket types that switch between several states, such as ZMQ_REP. See the messaging patterns section of zmq_socket(3) for more information.</span>
<a name="l00671"></a>00671     <span class="keywordflow">case</span> EFSM:
<a name="l00672"></a>00672         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleSendingError: The zmq_send() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. Deleting socket and re-trying...\n&quot;</span>);
<a name="l00673"></a>00673         this-&gt;RemakeSocket();
<a name="l00674"></a>00674         bRetVal = <span class="keyword">true</span>;
<a name="l00675"></a>00675         <span class="keywordflow">break</span>;
<a name="l00676"></a>00676         <span class="comment">// The ÃMQ context associated with the specified socket was terminated.</span>
<a name="l00677"></a>00677     <span class="keywordflow">case</span> ETERM:
<a name="l00678"></a>00678         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The ÃMQ context associated with the specified socket was terminated. (Deleting and re-creating the context and the socket, and trying again.)\n&quot;</span>);
<a name="l00679"></a>00679         this-&gt;RemakeSocket(<span class="keyword">true</span>);
<a name="l00680"></a>00680         bRetVal = <span class="keyword">true</span>;
<a name="l00681"></a>00681         <span class="keywordflow">break</span>;
<a name="l00682"></a>00682         <span class="comment">// The provided socket was invalid.</span>
<a name="l00683"></a>00683     <span class="keywordflow">case</span> ENOTSOCK:
<a name="l00684"></a>00684         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The provided socket was invalid. (Deleting socket and re-trying...)\n&quot;</span>);
<a name="l00685"></a>00685         this-&gt;RemakeSocket();
<a name="l00686"></a>00686         bRetVal = <span class="keyword">true</span>;
<a name="l00687"></a>00687         <span class="keywordflow">break</span>;
<a name="l00688"></a>00688         <span class="comment">// The operation was interrupted by delivery of a signal before the message was sent. Re-trying...</span>
<a name="l00689"></a>00689     <span class="keywordflow">case</span> EINTR:
<a name="l00690"></a>00690         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The operation was interrupted by delivery of a signal before the message was sent. (Re-trying...)\n&quot;</span>);
<a name="l00691"></a>00691         bRetVal = <span class="keyword">true</span>;
<a name="l00692"></a>00692         <span class="keywordflow">break</span>;
<a name="l00693"></a>00693         <span class="comment">// Invalid message.</span>
<a name="l00694"></a>00694     <span class="keywordflow">case</span> EFAULT:
<a name="l00695"></a>00695         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: Failure: The provided pollitems were not valid (NULL).\n&quot;</span>);
<a name="l00696"></a>00696         <span class="keywordflow">break</span>;
<a name="l00697"></a>00697     <span class="keywordflow">default</span>:
<a name="l00698"></a>00698         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: Default case. Re-trying...\n&quot;</span>);
<a name="l00699"></a>00699         bRetVal = <span class="keyword">true</span>;
<a name="l00700"></a>00700         <span class="keywordflow">break</span>;
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     <span class="keywordflow">return</span> bRetVal;
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 <span class="keywordtype">bool</span> OTSocket_ZMQ_2::HandleReceivingError()
<a name="l00706"></a>00706 {
<a name="l00707"></a>00707     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     <span class="keywordflow">switch</span> (errno) {
<a name="l00710"></a>00710         <span class="comment">// Non-blocking mode was requested and no messages are available at the moment.</span>
<a name="l00711"></a>00711     <span class="keywordflow">case</span> EAGAIN:
<a name="l00712"></a>00712         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleReceivingError: Non-blocking mode was requested and no messages are available at the moment. Re-trying...\n&quot;</span>);
<a name="l00713"></a>00713         bRetVal = <span class="keyword">true</span>;
<a name="l00714"></a>00714         <span class="keywordflow">break</span>;
<a name="l00715"></a>00715         <span class="comment">// The zmq_recv() operation is not supported by this socket type.</span>
<a name="l00716"></a>00716     <span class="keywordflow">case</span> ENOTSUP:
<a name="l00717"></a>00717         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Failure: The zmq_recv() operation is not supported by this socket type.\n&quot;</span>);
<a name="l00718"></a>00718         <span class="keywordflow">break</span>;
<a name="l00719"></a>00719         <span class="comment">// The zmq_recv() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. This error may occur with socket types that switch between several states, such as ZMQ_REP. See the messaging patterns section of zmq_socket(3) for more information.</span>
<a name="l00720"></a>00720     <span class="keywordflow">case</span> EFSM:
<a name="l00721"></a>00721         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleReceivingError: The zmq_recv() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. (Deleting socket and re-trying...)\n&quot;</span>);
<a name="l00722"></a>00722         this-&gt;RemakeSocket();
<a name="l00723"></a>00723         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(m_ascLastMsgSent); bRetVal = this-&gt;Send(ascTemp); }
<a name="l00724"></a>00724         <span class="keywordflow">break</span>;
<a name="l00725"></a>00725         <span class="comment">// The ÃMQ context associated with the specified socket was terminated.</span>
<a name="l00726"></a>00726     <span class="keywordflow">case</span> ETERM:
<a name="l00727"></a>00727         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: The ÃMQ context associated with the specified socket was terminated. (Re-creating the context, and trying again...)\n&quot;</span>);
<a name="l00728"></a>00728         this-&gt;RemakeSocket(<span class="keyword">true</span>);
<a name="l00729"></a>00729         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(m_ascLastMsgSent); bRetVal = this-&gt;Send(ascTemp); }
<a name="l00730"></a>00730         <span class="keywordflow">break</span>;
<a name="l00731"></a>00731         <span class="comment">// The provided socket was invalid.</span>
<a name="l00732"></a>00732     <span class="keywordflow">case</span> ENOTSOCK:
<a name="l00733"></a>00733         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: The provided socket was invalid. (Deleting socket and re-trying.)\n&quot;</span>);
<a name="l00734"></a>00734         this-&gt;RemakeSocket();
<a name="l00735"></a>00735         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(m_ascLastMsgSent); bRetVal = this-&gt;Send(ascTemp); }
<a name="l00736"></a>00736         <span class="keywordflow">break</span>;
<a name="l00737"></a>00737         <span class="comment">// The operation was interrupted by delivery of a signal before a message was available.</span>
<a name="l00738"></a>00738     <span class="keywordflow">case</span> EINTR:
<a name="l00739"></a>00739         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The operation was interrupted by delivery of a signal before the message was sent. (Re-trying...)\n&quot;</span>);
<a name="l00740"></a>00740         bRetVal = <span class="keyword">true</span>;
<a name="l00741"></a>00741         <span class="keywordflow">break</span>;
<a name="l00742"></a>00742         <span class="comment">// The message passed to the function was invalid.</span>
<a name="l00743"></a>00743     <span class="keywordflow">case</span> EFAULT:
<a name="l00744"></a>00744         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Failure: The message passed to the function was invalid.\n&quot;</span>);
<a name="l00745"></a>00745         <span class="keywordflow">break</span>;
<a name="l00746"></a>00746     <span class="keywordflow">default</span>:
<a name="l00747"></a>00747         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Default case. Re-trying...\n&quot;</span>);
<a name="l00748"></a>00748         bRetVal = <span class="keyword">true</span>;
<a name="l00749"></a>00749         <span class="keywordflow">break</span>;
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751     <span class="keywordflow">return</span> bRetVal;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="preprocessor">#endif // OT_ZMQ_2_MODE</span>
<a name="l00757"></a>00757 <span class="preprocessor"></span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 <span class="preprocessor">#ifdef OT_ZMQ_4_MODE</span>
<a name="l00760"></a>00760 <span class="preprocessor"></span>
<a name="l00761"></a>00761 <span class="comment">// OTSocket with zmq4x.</span>
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 <span class="keyword">class </span>OTSocket_ZMQ_4::ZMQ4{
<a name="l00764"></a>00764 <span class="keyword">public</span>:
<a name="l00765"></a>00765     ZMQ4();
<a name="l00766"></a>00766     ~ZMQ4();
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     zmq::context_t  * context_zmq;
<a name="l00769"></a>00769     zmq::socket_t   * socket_zmq;
<a name="l00770"></a>00770 };
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 OTSocket_ZMQ_4::ZMQ4::ZMQ4()
<a name="l00774"></a>00774 : context_zmq(NULL),
<a name="l00775"></a>00775 socket_zmq(NULL)
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777 }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 OTSocket_ZMQ_4::ZMQ4::~ZMQ4()
<a name="l00780"></a>00780 {
<a name="l00781"></a>00781     <span class="keyword">delete</span> this-&gt;socket_zmq;
<a name="l00782"></a>00782     <span class="keyword">delete</span> this-&gt;context_zmq;
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <a class="code" href="class_o_t_socket___z_m_q__4.html#a6037f4836e5b747c9277b7e9a69d44c9">OTSocket_ZMQ_4::OTSocket_ZMQ_4</a>()
<a name="l00787"></a>00787 :m_pzmq(new ZMQ4())
<a name="l00788"></a>00788 {
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <a class="code" href="class_o_t_socket___z_m_q__4.html#a53a98a727b135768a402f426899a9bc8">OTSocket_ZMQ_4::~OTSocket_ZMQ_4</a>()
<a name="l00792"></a>00792 {
<a name="l00793"></a>00793     this-&gt;CloseSocket();
<a name="l00794"></a>00794     <span class="keyword">delete</span>(this-&gt;m_pzmq);
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="keywordtype">bool</span> OTSocket_ZMQ_4::CloseSocket(<span class="keyword">const</span> <span class="keywordtype">bool</span> bNewContext <span class="comment">/*= false*/</span>)
<a name="l00799"></a>00799 {
<a name="l00800"></a>00800     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00801"></a>00801     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a> &amp;&amp; !bNewContext) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;socket_zmq)  zmq_close(m_pzmq-&gt;socket_zmq);
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;socket_zmq) <span class="keyword">delete</span> m_pzmq-&gt;socket_zmq;  m_pzmq-&gt;socket_zmq = NULL;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> = <span class="keyword">false</span>;
<a name="l00807"></a>00807     <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a> = <span class="keyword">false</span>;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="keywordtype">bool</span> OTSocket_ZMQ_4::NewSocket(<span class="keyword">const</span> <span class="keywordtype">bool</span> bIsRequest)
<a name="l00813"></a>00813 {
<a name="l00814"></a>00814     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00815"></a>00815     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (!this-&gt;CloseSocket()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819     <span class="keywordflow">try</span> {
<a name="l00820"></a>00820         m_pzmq-&gt;socket_zmq = <span class="keyword">new</span> zmq::socket_t(*m_pzmq-&gt;context_zmq, bIsRequest ? ZMQ_REQ : ZMQ_REP);  <span class="comment">// make a new socket</span>
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00823"></a>00823         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00824"></a>00824         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s failed to be created!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="keyword">const</span> <span class="keywordtype">int</span> linger = 0; <span class="comment">// close immediately</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">try</span> {
<a name="l00832"></a>00832         m_pzmq-&gt;socket_zmq-&gt;setsockopt(ZMQ_LINGER, &amp;linger, <span class="keyword">sizeof</span> (linger));
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00835"></a>00835         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00836"></a>00836         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> = <span class="keyword">false</span>;
<a name="l00840"></a>00840     <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a> = <span class="keyword">false</span>;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a086dc9be881e6e87bd53ce460802e3cb">OTSocket_ZMQ_4::NewContext</a>()
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a> = <span class="keyword">false</span>;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (!this-&gt;CloseSocket(<span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;context_zmq) zmq_term(m_pzmq-&gt;context_zmq);
<a name="l00854"></a>00854     <span class="keywordflow">if</span> (NULL != m_pzmq-&gt;context_zmq)    <span class="keyword">delete</span> m_pzmq-&gt;context_zmq; m_pzmq-&gt;context_zmq = NULL;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="keywordflow">try</span> {
<a name="l00857"></a>00857         m_pzmq-&gt;context_zmq = <span class="keyword">new</span> zmq::context_t(1,31); <span class="comment">// Threads, Max Sockets. (31 is a sane default).</span>
<a name="l00858"></a>00858     }
<a name="l00859"></a>00859     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00860"></a>00860         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00861"></a>00861         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a> = <span class="keyword">true</span>;
<a name="l00865"></a>00865     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00866"></a>00866 }
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">OTSocket_ZMQ_4::RemakeSocket</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> bNewContext <span class="comment">/*= false*/</span>) {
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00871"></a>00871     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> || !<a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> &amp;&amp; <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876     <span class="keywordtype">bool</span> bConnected = <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>;
<a name="l00877"></a>00877     <span class="keywordtype">bool</span> bListening = <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (bNewContext) this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a086dc9be881e6e87bd53ce460802e3cb">NewContext</a>();
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     <span class="keywordflow">if</span> (bConnected) <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a48b42d805dd87a01038fbe84ad49fb57">Connect</a>();
<a name="l00882"></a>00882     <span class="keywordflow">if</span> (bListening) <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#aa11e57907aa4c0d56643c42b96827676">Listen</a>();
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a48b42d805dd87a01038fbe84ad49fb57">OTSocket_ZMQ_4::Connect</a>()
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Listen!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Must not be Listening, to Connect!\n&quot;</span>, __FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#a85f7e19c4e7a2e50f7cede42c2c0a521">m_strConnectPath</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="keywordflow">if</span> (!this-&gt;NewSocket(<span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// NewSocket(true), Request Socket.</span>
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="keywordflow">try</span> {
<a name="l00900"></a>00900         m_pzmq-&gt;socket_zmq-&gt;connect(<a class="code" href="class_o_t_socket.html#a85f7e19c4e7a2e50f7cede42c2c0a521">m_strConnectPath</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00903"></a>00903         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00904"></a>00904         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> = <span class="keyword">true</span>;
<a name="l00908"></a>00908     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#aa11e57907aa4c0d56643c42b96827676">OTSocket_ZMQ_4::Listen</a>()
<a name="l00912"></a>00912 {
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00914"></a>00914     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Listen!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Must not be Connected, to Listen!\n&quot;</span>, __FUNCTION__);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#a8bf94304c29b3545fb7c54f24c346d78">m_strBindingPath</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="keywordflow">if</span> (!this-&gt;NewSocket(<span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// NewSocket(false), Responce Socket.</span>
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">try</span> {
<a name="l00924"></a>00924         m_pzmq-&gt;socket_zmq-&gt;bind(<a class="code" href="class_o_t_socket.html#a8bf94304c29b3545fb7c54f24c346d78">m_strBindingPath</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// since m_strBindingPath was checked and set above.</span>
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926     <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00927"></a>00927         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00928"></a>00928         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a> = <span class="keyword">true</span>;
<a name="l00932"></a>00932     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a48b42d805dd87a01038fbe84ad49fb57">OTSocket_ZMQ_4::Connect</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strConnectPath)
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <span class="keywordflow">if</span> (!strConnectPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s dosn&#39;t exist!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strConnectPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00938"></a>00938     <span class="keywordflow">if</span> (5 &gt; strConnectPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is too short!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strConnectPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <a class="code" href="class_o_t_socket.html#a85f7e19c4e7a2e50f7cede42c2c0a521">m_strConnectPath</a> = strConnectPath;  <span class="comment">// set the connection path.</span>
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <span class="keywordflow">return</span> (this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a48b42d805dd87a01038fbe84ad49fb57">Connect</a>());
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#aa11e57907aa4c0d56643c42b96827676">OTSocket_ZMQ_4::Listen</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strBindingPath)
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <span class="keywordflow">if</span> (!strBindingPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s dosn&#39;t exist!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strBindingPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (5 &gt; strBindingPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is too short!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strBindingPath&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950     <a class="code" href="class_o_t_socket.html#a8bf94304c29b3545fb7c54f24c346d78">m_strBindingPath</a> = strBindingPath;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952     <span class="keywordflow">return</span> (this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#aa11e57907aa4c0d56643c42b96827676">Listen</a>());
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">OTSocket_ZMQ_4::Send</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascEnvelope)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (0 &gt;= ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is zero length!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ascEnvelope&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00961"></a>00961     <a class="code" href="class_o_t_socket.html#ae4cd1c83306e34a2810c0d98af2a4931">m_ascLastMsgSent</a>.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(ascEnvelope); <span class="comment">// In case we need to re-send.</span>
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00964"></a>00964     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Send!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> &amp;&amp; !<a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> &amp;&amp; <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00968"></a>00968     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Send!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">// -----------------------------------  </span>
<a name="l00972"></a>00972     <span class="keyword">const</span> int64_t lLatencySendMilliSec = <a class="code" href="class_o_t_socket.html#a2d7159c692f9aef9fc6a7ea8d1ea9176">m_lLatencySendMs</a>;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     zmq::message_t zmq_message(ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>());
<a name="l00975"></a>00975     memcpy((<span class="keywordtype">void</span>*)zmq_message.data(), ascEnvelope.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), ascEnvelope.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>());
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordtype">bool</span> bSuccessSending = <span class="keyword">false</span>;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#a6050f10a954355a2441b3324793dd148">m_bIsBlocking</a>)
<a name="l00980"></a>00980     {
<a name="l00981"></a>00981         <span class="keywordflow">try</span> {
<a name="l00982"></a>00982             bSuccessSending = m_pzmq-&gt;socket_zmq-&gt;send(zmq_message); <span class="comment">// Blocking.</span>
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984         <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l00985"></a>00985             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l00986"></a>00986             <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00987"></a>00987         }
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989     <span class="keywordflow">else</span> <span class="comment">// not blocking</span>
<a name="l00990"></a>00990     {
<a name="l00991"></a>00991         int32_t     nSendTries = <a class="code" href="class_o_t_socket.html#ab5bcda79d6f350998a75e1a3ec939a30">m_nLatencySendNoTries</a>;
<a name="l00992"></a>00992         int64_t lDoubling = lLatencySendMilliSec;
<a name="l00993"></a>00993         <span class="keywordtype">bool</span>    bKeepTrying = <span class="keyword">true</span>;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995         <span class="keywordflow">while</span> (bKeepTrying &amp;&amp; (nSendTries &gt; 0))
<a name="l00996"></a>00996         {
<a name="l00997"></a>00997             zmq::pollitem_t items[] = {
<a name="l00998"></a>00998                 { (*m_pzmq-&gt;socket_zmq), 0, ZMQ_POLLOUT, 0 }
<a name="l00999"></a>00999             };
<a name="l01000"></a>01000 
<a name="l01001"></a>01001             <span class="keywordtype">int</span> nPoll = 0;
<a name="l01002"></a>01002             <span class="keywordflow">try</span> {
<a name="l01003"></a>01003                 nPoll = zmq::poll(&amp;items[0], 1, static_cast&lt;long&gt;(lDoubling));  <span class="comment">// ZMQ_POLLOUT, 1 item, timeout (milliseconds)  </span>
<a name="l01004"></a>01004             }
<a name="l01005"></a>01005             <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l01006"></a>01006                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l01007"></a>01007                 <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01008"></a>01008             }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010             lDoubling *= 2;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012             <span class="keywordflow">if</span> (items[0].revents &amp; ZMQ_POLLOUT)
<a name="l01013"></a>01013             {
<a name="l01014"></a>01014                 <span class="keywordflow">try</span> {
<a name="l01015"></a>01015                     bSuccessSending = m_pzmq-&gt;socket_zmq-&gt;send(zmq_message, ZMQ_NOBLOCK); <span class="comment">// &lt;=========== SEND ===============</span>
<a name="l01016"></a>01016                 }
<a name="l01017"></a>01017                 <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l01018"></a>01018                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l01019"></a>01019                     <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01020"></a>01020                 }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022                 <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(1);
<a name="l01023"></a>01023 
<a name="l01024"></a>01024                 <span class="keywordflow">if</span> (!bSuccessSending)
<a name="l01025"></a>01025                 {
<a name="l01026"></a>01026                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandleSendingError())
<a name="l01027"></a>01027                         bKeepTrying = <span class="keyword">false</span>;
<a name="l01028"></a>01028                 }
<a name="l01029"></a>01029                 <span class="keywordflow">else</span>
<a name="l01030"></a>01030                     <span class="keywordflow">break</span>; <span class="comment">// (Success -- we&#39;re done in this loop.)</span>
<a name="l01031"></a>01031             }
<a name="l01032"></a>01032             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1) == nPoll) <span class="comment">// error.</span>
<a name="l01033"></a>01033             {
<a name="l01034"></a>01034                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandlePollingError())
<a name="l01035"></a>01035                     bKeepTrying = <span class="keyword">false</span>;
<a name="l01036"></a>01036             }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038             --nSendTries;
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041     <span class="comment">/*</span>
<a name="l01042"></a>01042 <span class="comment">    Normally, we try to send...</span>
<a name="l01043"></a>01043 <span class="comment">    If the send fails, we wait X ms and then try again (Y times).</span>
<a name="l01044"></a>01044 <span class="comment"></span>
<a name="l01045"></a>01045 <span class="comment">    BUT -- what if the failure was an errno==EAGAIN ?</span>
<a name="l01046"></a>01046 <span class="comment">    In that case, it&#39;s not a REAL failure, but rather, a &quot;failure right now, try again in a sec.&quot;</span>
<a name="l01047"></a>01047 <span class="comment">    */</span>
<a name="l01048"></a>01048     <span class="comment">// ***********************************</span>
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <span class="keywordflow">if</span> (bSuccessSending)
<a name="l01051"></a>01051         <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(<a class="code" href="class_o_t_socket.html#af082876ee29f067efd7435035c923b28">m_lLatencyDelayAfter</a> &gt; 0 ? <a class="code" href="class_o_t_socket.html#af082876ee29f067efd7435035c923b28">m_lLatencyDelayAfter</a> : 1);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <span class="keywordflow">return</span> bSuccessSending;
<a name="l01054"></a>01054 }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">OTSocket_ZMQ_4::Send</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascEnvelope, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strConnectPath)
<a name="l01057"></a>01057 {
<a name="l01058"></a>01058     <span class="keyword">const</span> <span class="keywordtype">bool</span> bNewPath = <a class="code" href="class_o_t_socket.html#a85f7e19c4e7a2e50f7cede42c2c0a521">m_strConnectPath</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(strConnectPath);
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">if</span> (!bNewPath) this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a48b42d805dd87a01038fbe84ad49fb57">Connect</a>(strConnectPath);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a>) <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">Send</a>(ascEnvelope);
<a name="l01065"></a>01065 }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_socket___z_m_q__4.html#a377a19b0a30376b6914f898df8b5972c">OTSocket_ZMQ_4::Receive</a>(<a class="code" href="class_o_t_string.html">OTString</a> &amp; strServerReply)
<a name="l01068"></a>01068 {
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#aa1a36fc72b71534e13ffc8a178784038">m_bInitialized</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01070"></a>01070     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#adf869685401e0ac50b370b090763b16d">m_HasContext</a>) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01071"></a>01071     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;context_zmq)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Receive!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;context_zmq&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> &amp;&amp; !<a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#abade24b910b612f7e3e2eca74e74064b">m_bConnected</a> &amp;&amp; <a class="code" href="class_o_t_socket.html#a380b08a18427e066f193797a413bc0b1">m_bListening</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01075"></a>01075     <span class="keywordflow">if</span> (NULL == m_pzmq-&gt;socket_zmq) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s must exist to Receive!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pzmq-&gt;socket_zmq&quot;</span>);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     <span class="comment">// -----------------------------------  </span>
<a name="l01079"></a>01079     <span class="keyword">const</span> int64_t lLatencyRecvMilliSec = <a class="code" href="class_o_t_socket.html#ace0e9abac03f7086b27839e001368ce7">m_lLatencyReceiveMs</a>;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081     <span class="comment">// ***********************************</span>
<a name="l01082"></a>01082     <span class="comment">//ââGetâtheâreply.</span>
<a name="l01083"></a>01083     zmq::message_t zmq_message;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="keywordtype">bool</span> bSuccessReceiving = <span class="keyword">false</span>;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <span class="comment">// If failure receiving, re-tries 2 times, with 4000 ms max delay between each (Doubling every time.)</span>
<a name="l01088"></a>01088     <span class="comment">//</span>
<a name="l01089"></a>01089     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_socket.html#a6050f10a954355a2441b3324793dd148">m_bIsBlocking</a>)
<a name="l01090"></a>01090     {
<a name="l01091"></a>01091         <span class="keywordflow">try</span> {
<a name="l01092"></a>01092             bSuccessReceiving = m_pzmq-&gt;socket_zmq-&gt;recv(&amp;zmq_message); <span class="comment">// Blocking.</span>
<a name="l01093"></a>01093         }
<a name="l01094"></a>01094         <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l01095"></a>01095             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l01096"></a>01096             <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01097"></a>01097         }
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     <span class="keywordflow">else</span>    <span class="comment">// not blocking</span>
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101         int64_t lDoubling = lLatencyRecvMilliSec;
<a name="l01102"></a>01102         int32_t     nReceiveTries = <a class="code" href="class_o_t_socket.html#a9f4dc1cc24a95a19819c185c714e2e79">m_nLatencyReceiveNoTries</a>;
<a name="l01103"></a>01103         <span class="keywordtype">bool</span>    expect_reply = <span class="keyword">true</span>;
<a name="l01104"></a>01104         <span class="keywordflow">while</span> (expect_reply)
<a name="l01105"></a>01105         {
<a name="l01106"></a>01106             <span class="comment">//  Poll socket for a reply, with timeout</span>
<a name="l01107"></a>01107             zmq::pollitem_t items[] = { { *m_pzmq-&gt;socket_zmq, 0, ZMQ_POLLIN, 0 } };
<a name="l01108"></a>01108 
<a name="l01109"></a>01109             <span class="keywordtype">int</span> nPoll = 0;
<a name="l01110"></a>01110             <span class="keywordflow">try</span> {
<a name="l01111"></a>01111                 nPoll = zmq::poll(&amp;items[0], 1, static_cast&lt;long&gt;(lDoubling));
<a name="l01112"></a>01112             }
<a name="l01113"></a>01113             <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l01114"></a>01114                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l01115"></a>01115                 <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01116"></a>01116             }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118             lDoubling *= 2;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120             <span class="comment">//  If we got a reply, process it</span>
<a name="l01121"></a>01121             <span class="keywordflow">if</span> (items[0].revents &amp; ZMQ_POLLIN)
<a name="l01122"></a>01122             {
<a name="l01123"></a>01123                 <span class="keywordflow">try</span> {
<a name="l01124"></a>01124                 bSuccessReceiving = m_pzmq-&gt;socket_zmq-&gt;recv(&amp;zmq_message, ZMQ_NOBLOCK); <span class="comment">// &lt;=========== RECEIVE ===============</span>
<a name="l01125"></a>01125                 }
<a name="l01126"></a>01126                 <span class="keywordflow">catch</span> (std::exception&amp; e) {
<a name="l01127"></a>01127                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Exception Caught: %s \n&quot;</span>, __FUNCTION__, e.what());
<a name="l01128"></a>01128                     <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01129"></a>01129                 }
<a name="l01130"></a>01130                 <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(1);
<a name="l01131"></a>01131 
<a name="l01132"></a>01132                 <span class="keywordflow">if</span> (!bSuccessReceiving)
<a name="l01133"></a>01133                 {
<a name="l01134"></a>01134                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandleReceivingError())
<a name="l01135"></a>01135                         expect_reply = <span class="keyword">false</span>;
<a name="l01136"></a>01136                 }
<a name="l01137"></a>01137                 <span class="keywordflow">else</span>
<a name="l01138"></a>01138                     <span class="keywordflow">break</span>; <span class="comment">// (Success -- we&#39;re done in this loop.)             </span>
<a name="l01139"></a>01139             }
<a name="l01140"></a>01140             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nReceiveTries == 0)
<a name="l01141"></a>01141             {
<a name="l01142"></a>01142                 <span class="comment">//OTLog::Error(&quot;OTSocket::Receive: no message.\n&quot;);</span>
<a name="l01143"></a>01143                 expect_reply = <span class="keyword">false</span>;
<a name="l01144"></a>01144                 <span class="keywordflow">break</span>;
<a name="l01145"></a>01145             }
<a name="l01146"></a>01146             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1) == nPoll) <span class="comment">// error.</span>
<a name="l01147"></a>01147             {
<a name="l01148"></a>01148                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == HandlePollingError())
<a name="l01149"></a>01149                     expect_reply = <span class="keyword">false</span>;
<a name="l01150"></a>01150             }
<a name="l01151"></a>01151 
<a name="l01152"></a>01152             --nReceiveTries;
<a name="l01153"></a>01153         }
<a name="l01154"></a>01154     }
<a name="l01155"></a>01155     <span class="comment">// ***********************************</span>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <span class="keywordflow">if</span> (bSuccessReceiving &amp;&amp; (zmq_message.size() &gt; 0))
<a name="l01158"></a>01158         strServerReply.<a class="code" href="class_o_t_string.html#afe8b9f0781c0159cd7575b92af89bf9a">MemSet</a>(static_cast&lt;const char*&gt;(zmq_message.data()), static_cast&lt;uint32_t&gt; (zmq_message.size()));
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     <span class="keywordflow">return</span> (bSuccessReceiving &amp;&amp; (zmq_message.size() &gt; 0));
<a name="l01161"></a>01161 }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 
<a name="l01164"></a>01164 <span class="keywordtype">bool</span> OTSocket_ZMQ_4::HandlePollingError()
<a name="l01165"></a>01165 {
<a name="l01166"></a>01166     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <span class="keywordflow">switch</span> (errno) {
<a name="l01169"></a>01169         <span class="comment">// At least one of the members of the items array refers to a socket whose associated ÃMQ context was terminated.</span>
<a name="l01170"></a>01170     <span class="keywordflow">case</span> ETERM:
<a name="l01171"></a>01171         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Failure: At least one of the members of the items array refers to a socket whose associated ÃMQ context was terminated. (Deleting and re-creating the context.)\n&quot;</span>);
<a name="l01172"></a>01172         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a086dc9be881e6e87bd53ce460802e3cb">NewContext</a>();
<a name="l01173"></a>01173         <span class="keywordflow">break</span>;
<a name="l01174"></a>01174         <span class="comment">// The provided items was not valid (NULL).</span>
<a name="l01175"></a>01175     <span class="keywordflow">case</span> EFAULT:
<a name="l01176"></a>01176         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Failed: The provided polling items were not valid (NULL).\n&quot;</span>);
<a name="l01177"></a>01177         <span class="keywordflow">break</span>;
<a name="l01178"></a>01178         <span class="comment">// The operation was interrupted by delivery of a signal before any events were available.</span>
<a name="l01179"></a>01179     <span class="keywordflow">case</span> EINTR:
<a name="l01180"></a>01180         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: The operation was interrupted by delivery of a signal before any events were available. Re-trying...\n&quot;</span>);
<a name="l01181"></a>01181         bRetVal = <span class="keyword">true</span>;
<a name="l01182"></a>01182         <span class="keywordflow">break</span>;
<a name="l01183"></a>01183     <span class="keywordflow">default</span>:
<a name="l01184"></a>01184         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandlePollingError: Default case. Re-trying...\n&quot;</span>);
<a name="l01185"></a>01185         bRetVal = <span class="keyword">true</span>;
<a name="l01186"></a>01186         <span class="keywordflow">break</span>;
<a name="l01187"></a>01187     }
<a name="l01188"></a>01188     <span class="keywordflow">return</span> bRetVal;
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="keywordtype">bool</span> OTSocket_ZMQ_4::HandleSendingError()
<a name="l01192"></a>01192 {
<a name="l01193"></a>01193     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">switch</span> (errno) {
<a name="l01196"></a>01196         <span class="comment">// Non-blocking mode was requested and the message cannot be sent at the moment.</span>
<a name="l01197"></a>01197     <span class="keywordflow">case</span> EAGAIN:
<a name="l01198"></a>01198         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleSendingError: Non-blocking mode was requested and the message cannot be sent at the moment. Re-trying...\n&quot;</span>);
<a name="l01199"></a>01199         bRetVal = <span class="keyword">true</span>;
<a name="l01200"></a>01200         <span class="keywordflow">break</span>;
<a name="l01201"></a>01201         <span class="comment">// The zmq_send() operation is not supported by this socket type.</span>
<a name="l01202"></a>01202     <span class="keywordflow">case</span> ENOTSUP:
<a name="l01203"></a>01203         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: failure: The zmq_send() operation is not supported by this socket type.\n&quot;</span>);
<a name="l01204"></a>01204         <span class="keywordflow">break</span>;
<a name="l01205"></a>01205         <span class="comment">// The zmq_send() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. This error may occur with socket types that switch between several states, such as ZMQ_REP. See the messaging patterns section of zmq_socket(3) for more information.</span>
<a name="l01206"></a>01206     <span class="keywordflow">case</span> EFSM:
<a name="l01207"></a>01207         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleSendingError: The zmq_send() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. Deleting socket and re-trying...\n&quot;</span>);
<a name="l01208"></a>01208         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>();
<a name="l01209"></a>01209         bRetVal = <span class="keyword">true</span>;
<a name="l01210"></a>01210         <span class="keywordflow">break</span>;
<a name="l01211"></a>01211         <span class="comment">// The ÃMQ context associated with the specified socket was terminated.</span>
<a name="l01212"></a>01212     <span class="keywordflow">case</span> ETERM:
<a name="l01213"></a>01213         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The ÃMQ context associated with the specified socket was terminated. (Deleting and re-creating the context and the socket, and trying again.)\n&quot;</span>);
<a name="l01214"></a>01214         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>(<span class="keyword">true</span>);
<a name="l01215"></a>01215         bRetVal = <span class="keyword">true</span>;
<a name="l01216"></a>01216         <span class="keywordflow">break</span>;
<a name="l01217"></a>01217         <span class="comment">// The provided socket was invalid.</span>
<a name="l01218"></a>01218     <span class="keywordflow">case</span> ENOTSOCK:
<a name="l01219"></a>01219         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The provided socket was invalid. (Deleting socket and re-trying...)\n&quot;</span>);
<a name="l01220"></a>01220         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>();
<a name="l01221"></a>01221         bRetVal = <span class="keyword">true</span>;
<a name="l01222"></a>01222         <span class="keywordflow">break</span>;
<a name="l01223"></a>01223         <span class="comment">// The operation was interrupted by delivery of a signal before the message was sent. Re-trying...</span>
<a name="l01224"></a>01224     <span class="keywordflow">case</span> EINTR:
<a name="l01225"></a>01225         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The operation was interrupted by delivery of a signal before the message was sent. (Re-trying...)\n&quot;</span>);
<a name="l01226"></a>01226         bRetVal = <span class="keyword">true</span>;
<a name="l01227"></a>01227         <span class="keywordflow">break</span>;
<a name="l01228"></a>01228         <span class="comment">// Invalid message.</span>
<a name="l01229"></a>01229     <span class="keywordflow">case</span> EFAULT:
<a name="l01230"></a>01230         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: Failure: The provided pollitems were not valid (NULL).\n&quot;</span>);
<a name="l01231"></a>01231         <span class="keywordflow">break</span>;
<a name="l01232"></a>01232     <span class="keywordflow">default</span>:
<a name="l01233"></a>01233         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: Default case. Re-trying...\n&quot;</span>);
<a name="l01234"></a>01234         bRetVal = <span class="keyword">true</span>;
<a name="l01235"></a>01235         <span class="keywordflow">break</span>;
<a name="l01236"></a>01236     }
<a name="l01237"></a>01237     <span class="keywordflow">return</span> bRetVal;
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="keywordtype">bool</span> OTSocket_ZMQ_4::HandleReceivingError()
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     <span class="keywordtype">bool</span> bRetVal = <span class="keyword">false</span>;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244     <span class="keywordflow">switch</span> (errno) {
<a name="l01245"></a>01245         <span class="comment">// Non-blocking mode was requested and no messages are available at the moment.</span>
<a name="l01246"></a>01246     <span class="keywordflow">case</span> EAGAIN:
<a name="l01247"></a>01247         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleReceivingError: Non-blocking mode was requested and no messages are available at the moment. Re-trying...\n&quot;</span>);
<a name="l01248"></a>01248         bRetVal = <span class="keyword">true</span>;
<a name="l01249"></a>01249         <span class="keywordflow">break</span>;
<a name="l01250"></a>01250         <span class="comment">// The zmq_recv() operation is not supported by this socket type.</span>
<a name="l01251"></a>01251     <span class="keywordflow">case</span> ENOTSUP:
<a name="l01252"></a>01252         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Failure: The zmq_recv() operation is not supported by this socket type.\n&quot;</span>);
<a name="l01253"></a>01253         <span class="keywordflow">break</span>;
<a name="l01254"></a>01254         <span class="comment">// The zmq_recv() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. This error may occur with socket types that switch between several states, such as ZMQ_REP. See the messaging patterns section of zmq_socket(3) for more information.</span>
<a name="l01255"></a>01255     <span class="keywordflow">case</span> EFSM:
<a name="l01256"></a>01256         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTSocket::HandleReceivingError: The zmq_recv() operation cannot be performed on this socket at the moment due to the socket not being in the appropriate state. (Deleting socket and re-trying...)\n&quot;</span>);
<a name="l01257"></a>01257         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>();
<a name="l01258"></a>01258         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_socket.html#ae4cd1c83306e34a2810c0d98af2a4931">m_ascLastMsgSent</a>); bRetVal = this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">Send</a>(ascTemp); }
<a name="l01259"></a>01259         <span class="keywordflow">break</span>;
<a name="l01260"></a>01260         <span class="comment">// The ÃMQ context associated with the specified socket was terminated.</span>
<a name="l01261"></a>01261     <span class="keywordflow">case</span> ETERM:
<a name="l01262"></a>01262         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: The ÃMQ context associated with the specified socket was terminated. (Re-creating the context, and trying again...)\n&quot;</span>);
<a name="l01263"></a>01263         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>(<span class="keyword">true</span>);
<a name="l01264"></a>01264         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_socket.html#ae4cd1c83306e34a2810c0d98af2a4931">m_ascLastMsgSent</a>); bRetVal = this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">Send</a>(ascTemp); }
<a name="l01265"></a>01265         <span class="keywordflow">break</span>;
<a name="l01266"></a>01266         <span class="comment">// The provided socket was invalid.</span>
<a name="l01267"></a>01267     <span class="keywordflow">case</span> ENOTSOCK:
<a name="l01268"></a>01268         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: The provided socket was invalid. (Deleting socket and re-trying.)\n&quot;</span>);
<a name="l01269"></a>01269         this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a9b5e3a304b5aea115a73dcbc2d9f6962">RemakeSocket</a>();
<a name="l01270"></a>01270         { <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_socket.html#ae4cd1c83306e34a2810c0d98af2a4931">m_ascLastMsgSent</a>); bRetVal = this-&gt;<a class="code" href="class_o_t_socket___z_m_q__4.html#a7779fa54d8f0e70ce8d99a01d06abc5f">Send</a>(ascTemp); }
<a name="l01271"></a>01271         <span class="keywordflow">break</span>;
<a name="l01272"></a>01272         <span class="comment">// The operation was interrupted by delivery of a signal before a message was available.</span>
<a name="l01273"></a>01273     <span class="keywordflow">case</span> EINTR:
<a name="l01274"></a>01274         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleSendingError: The operation was interrupted by delivery of a signal before the message was sent. (Re-trying...)\n&quot;</span>);
<a name="l01275"></a>01275         bRetVal = <span class="keyword">true</span>;
<a name="l01276"></a>01276         <span class="keywordflow">break</span>;
<a name="l01277"></a>01277         <span class="comment">// The message passed to the function was invalid.</span>
<a name="l01278"></a>01278     <span class="keywordflow">case</span> EFAULT:
<a name="l01279"></a>01279         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Failure: The message passed to the function was invalid.\n&quot;</span>);
<a name="l01280"></a>01280         <span class="keywordflow">break</span>;
<a name="l01281"></a>01281     <span class="keywordflow">default</span>:
<a name="l01282"></a>01282         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTSocket::HandleReceivingError: Default case. Re-trying...\n&quot;</span>);
<a name="l01283"></a>01283         bRetVal = <span class="keyword">true</span>;
<a name="l01284"></a>01284         <span class="keywordflow">break</span>;
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286     <span class="keywordflow">return</span> bRetVal;
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 <span class="preprocessor">#endif // OT_ZMQ_4_MODE</span>
<a name="l01292"></a>01292 <span class="preprocessor"></span>
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_o_t_socket_8cpp.html">OTSocket.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:04 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
