<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OT_API Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t___a_p_i.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">OT_API Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OT_API" -->
<p><code>#include &lt;<a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>&gt;</code></p>

<p><a href="class_o_t___a_p_i-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><b>Pid</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#adc2385facb91965076934474d827dd6d">OT_API</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a652314745fe8d849224ccd851c5eb94e">~OT_API</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aae7802dad48d8347a4b3d6b91e7aac0c">SetTransportCallback</a> (<a class="el" href="struct_transport_callback.html">TransportCallback</a> *pTransportCallback)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="struct_transport_callback.html">TransportCallback</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">GetTransportCallback</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a597eab7dd06eba0ae38de43717fb775f">TransportFunction</a> (<a class="el" href="class_o_t_server_contract.html">OTServerContract</a> &amp;theServerContract, <a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;theEnvelope)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a6e79ce6216fb40ef9c2f48615e72072a">GetWalletFilename</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strPath)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5eaacf363f5fb27e71c196cbb099cced">SetWalletFilename</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPath)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_wallet.html">OTWallet</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a> (const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_client.html">OTClient</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8de0d3d75ac1cbef23abdb746e9e2c61">LoadConfigFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af6c984fa7aa142e79ed4ddbc14d14503">SetWallet</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFilename)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a798f3a326f18f31b8e62a682bbaa6a6d">WalletExists</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a2ff83b1c64286eafdf7af6360e138d6e">GetTime</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a12f34568b5ed20e3d1744f30e472f454">NumList_Add</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theList, const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theNewNumbers)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a577cd1a86933ded118347ca37f537cee">NumList_Remove</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theList, const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theOldNumbers)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ac2bbcfd6aa2d7a7bf0f6a78b4dd2a654">NumList_VerifyQuery</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theList, const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theQueryNumbers)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a909a6234b5e4dd04059a7e86f7883d1c">NumList_VerifyAll</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theList, const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theQueryNumbers)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ad6a7774af0f1af97fe6c36c396e054a3">NumList_Count</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theList)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a267d362ca74da9e01ab8e956da42b386">GetNymCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0fad5fe7f5da3cac88b0794c705b1a9b">GetServerCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acb9cb01e0d828ad885aa8da40b69ffb3">GetAssetTypeCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">GetAccountCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a> (int32_t iIndex, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;NYM_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a> (int32_t iIndex, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a> (int32_t iIndex, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a> (int32_t iIndex, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5bc096141864f38038f2860076d93f9e">GetNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acb7f145e4c952265f06719ef525c3543">GetServer</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ac31d39fb3e703cebc6a9e2842593040f">GetAssetType</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1591843600750cfacc015a9bbd12b26f">GetAccount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;THE_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa0bdb71f4b4b19f8a49061cbc2d037c4">GetNymByIDPartialMatch</a> (const std::string PARTIAL_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a27228b655e5c661959812e3a2b7f144e">GetServerContractPartialMatch</a> (const std::string PARTIAL_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aec51f205544c3c4a8acf95e1562292ba">GetAssetContractPartialMatch</a> (const std::string PARTIAL_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7a602b75fccd8b11b73508ce358a4594">GetAccountPartialMatch</a> (const std::string PARTIAL_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0ecd26987ce0a3fd24c04b618bbbb293">GetOrLoadPublicNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, <a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *pPWData=NULL, <a class="el" href="class_o_t_password.html">OTPassword</a> *pImportPassword=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, <a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *pPWData=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ac9416e678013333f9d6e1612dcf0ffaa">GetOrLoadAccount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a765251304181ec99fa3874d0fe0a8568">SetNym_Name</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;NYM_NEW_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa2213ae9a93b111ca1c774df67818b6b">SetAccount_Name</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;ACCT_NEW_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a62071d84252f0b233071c640b9de67de">SetAssetType_Name</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;STR_NEW_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5e063a9ac2d1e9c15eb116948a16fb6e">SetServer_Name</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;STR_NEW_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5d793f8c61422481fc3a266ec68c523a">LoadPublicNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const char *szFuncName=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a38f96bbf12655ca9ced0ebf33a5c3794">LoadPrivateNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, <a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *pPWData=NULL, <a class="el" href="class_o_t_password.html">OTPassword</a> *pImportPassword=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0de395c333a49913b59ae8cac223d526">CreateNym</a> (int32_t nKeySize=1024, const std::string str_id_source=&quot;&quot;, const std::string str_alt_location=&quot;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1124d87febc45eec06c1c9e8a2cc91da">IsNym_RegisteredAtServer</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a90f13aec197a306faca8f87d1dd8d1dd">Wallet_ChangePassphrase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae78c8768a982b6c2fd700f07e2cd6f79">Wallet_CanRemoveServer</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1ca73000987bce8e5e326a43ca46cd69">Wallet_CanRemoveAssetType</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a2f3e914453a7b7ad2a03b6a39f3f0fce">Wallet_CanRemoveNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5b14775126eb326cfd49ffb1a7d4db32">Wallet_CanRemoveAccount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af2aefbb08ad7e13fe40400ab1366b6b0">Wallet_RemoveServer</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#abfa83caebd9bb2bd22377f7b5f630055">Wallet_RemoveAssetType</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aed300d9ad2ef3d1e76d423c1e91659c5">Wallet_RemoveNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#abe3cee60ee8f3d8e3660067d481b2dcc">Wallet_ExportNym</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a77a64ebe7b8942ae50ed25c31834eb7c">Wallet_ImportNym</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;FILE_CONTENTS, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pNymID=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a52464281f46358635dde59e3b787354e">Wallet_ImportCert</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;DISPLAY_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;FILE_CONTENTS, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pNymID=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#afebfabab4241d6aa75ce0e178e248592">Wallet_ExportCert</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a4b5282e8670208c395d3ab98a9a2a315">Wallet_ImportPurse</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8f2b202917e923bfe9eeacd152493401">Encode</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPlaintext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, bool bLineBreaks=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a3c5209f2f8ba1892edb5cf4614cd04a6">Decode</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strEncoded, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, bool bLineBreaks=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa0fba0e8b0dbbe6a77bc443a6d99fa06">Encrypt</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theRecipientNymID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPlaintext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a864877a4f56fbbfee46ad8a650a1bb82">Decrypt</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theRecipientNymID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strCiphertext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a4decdc65f8b0a207a6057b86716e050a">FlatSign</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theSignerNymID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strInput, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strContractType, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa354b7ac168afd7cacfcf045241f4771">SignContract</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theSignerNymID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strContract, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae5d31c92f0438b3c64ff5466c4e380e1">AddSignature</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theSignerNymID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strContract, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1ffc5ff556721c5ab9fee696ea922ec1">VerifySignature</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strContract, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theSignerNymID, <a class="el" href="class_o_t_contract.html">OTContract</a> **ppContract=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab941c58200fe040a3d432d54297c9fbe">VerifyAndRetrieveXMLContents</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strContract, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theSignerNymID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify and Retrieve XML Contents.  <a href="#ab941c58200fe040a3d432d54297c9fbe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a6db6ca5618edfb53c7a8a7bc38e4bd0e">VerifyAccountReceipt</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_cheque.html">OTCheque</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a504e99bac03c227bbecb79f869a76578">WriteCheque</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const int64_t &amp;CHEQUE_AMOUNT, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;VALID_FROM, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;VALID_TO, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_USER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;CHEQUE_MEMO, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pRECIPIENT_USER_ID=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8e1fde16ebe39537f28c737844d09d1f">DiscardCheque</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CHEQUE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_payment_plan.html">OTPaymentPlan</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5c416b1b8178998dad0f7357498974a3">ProposePaymentPlan</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;VALID_FROM, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;VALID_TO, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_USER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;PLAN_CONSIDERATION, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_USER_ID, const int64_t &amp;INITIAL_PAYMENT_AMOUNT, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;INITIAL_PAYMENT_DELAY, const int64_t &amp;PAYMENT_PLAN_AMOUNT, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;PAYMENT_PLAN_DELAY, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;PAYMENT_PLAN_PERIOD, <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> PAYMENT_PLAN_LENGTH=<a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>, int32_t PAYMENT_PLAN_MAX_PAYMENTS=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#afe54d89f1f94b05bb2ecaffe9a02e1f4">ConfirmPaymentPlan</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_USER_ID, <a class="el" href="class_o_t_payment_plan.html">OTPaymentPlan</a> &amp;thePlan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">LoadPurse</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ac3e808efa2420f7647ee0659de4ed176">SavePurse</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;THE_PURSE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a85b0d012168cd75ed3aaebd08cba2dea">CreatePurse</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;OWNER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0f580137479e85f755aadbecc85f84a0">CreatePurse_Passphrase</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8f169045c3550424b6b28df54539a183">LoadPurseAndOwnerFromString</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAssetTypeID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPurse, <a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;thePurse, <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassword, const bool bForEncrypting=true, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOWNER_ID=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay1=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay2=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">LoadPurseAndOwnerForMerge</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPurse, <a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;thePurse, <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassword, const bool bCanBePublic=false, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOWNER_ID=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_token.html">OTToken</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ac4922a16395e2da553cf4f0bd0fdaf62">Purse_Peek</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOWNER_ID=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a71b132b76b09ced31829d59348aa6a08">Purse_Pop</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOWNER_ID=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#adc667ad801925aaddd138f0dd7d0770e">Purse_Empty</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_purse.html">OTPurse</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a480eef589ef3fd1f416930540e46082f">Purse_Push</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_TOKEN, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOWNER_ID=NULL, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_token.html">OTToken</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7183d283456ab1e13c01f88b71062828">Token_ChangeOwner</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_TOKEN, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;OLD_OWNER, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;NEW_OWNER, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_mint.html">OTMint</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7ed4ec7967a76d735047e5bae1574bf5">LoadMint</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a9e0c39f51b0c700bfeb378d7ab868724">LoadAssetContract</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#adeed94c645c2e2330e536520b9fa5664">LoadServerContract</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1513a6077de1cdcd818ac9f480481ed8">IsBasketCurrency</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aba4eb1e71d36b4ca4f077a90e3220ed5">GetBasketMinimumTransferAmount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af4747b3de4902f3217ab050bb041bc66">GetBasketMemberCount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aa51bdf044a89177e8bb1e0387e28a24a">GetBasketMemberType</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID, const int32_t nIndex, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutputMemberType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af5ceba4f208230dc9b077b37423e289f">GetBasketMemberMinimumTransferAmount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID, const int32_t nIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ad8538f636eb127ddcb4ca4a72ec7cc88">LoadAssetAccount</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a407abef5bd443ce7f68e399f76252fd3">LoadNymbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5d73d9af141c79478e431d81b3ac641d">LoadNymboxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a478f3f32e383e05a203807810bc94940">LoadInbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a11a9479b4875de4377232237d3521690">LoadInboxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aeaf758c15cb39763d3ac80e7582e5409">LoadOutbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af4b4a5ef255263fbda9958082d393875">LoadOutboxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5077987cf25f441923c88cb51b3d940a">LoadPaymentInbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8e02cb186854f0b325c4c55da69f2e55">LoadPaymentInboxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a318f160f9a43ac68afcf415ff51ae267">LoadRecordBox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8c288f48dcdc98a6ae02c03e6452c438">LoadRecordBoxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a71244607da4b28d1b33ab623ec9a2a1e">ClearRecord</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID, const int32_t nIndex, const bool bClearAll=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae3d6ecd9fabfea445d35fd7307008856">LoadExpiredBox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7b9a649113879b83befa1d7acc00b79d">LoadExpiredBoxNoVerify</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a742952a02e0d947156e8687933602725">ClearExpired</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int32_t nIndex, const bool bClearAll=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ad96c4b1b56f797482b7383072b9037db">RecordPayment</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, bool bIsInbox, int32_t nIndex, bool bSaveCopy)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acbc0834e9b4c4f995114e62436e54fea">DoesBoxReceiptExist</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_message.html">OTMessage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a04aee43cd2310d2da162f14c771e26cb">PopMessageBuffer</a> (const int64_t &amp;lRequestNumber, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae9f593a90e408ab34e92c25a4428bf8b">FlushMessageBuffer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_message.html">OTMessage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a23edd3f777f72244fa6281911d431e08">GetSentMessage</a> (const int64_t &amp;lRequestNumber, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5ee70b9309b55c10ade9e0bf240c66a2">RemoveSentMessage</a> (const int64_t &amp;lRequestNumber, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a9a02cca439067abd875c78ca7f732011">FlushSentMessages</a> (const bool bHarvestingForRetry, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;THE_NYMBOX)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a76e14d4a7826d39f55e0dcac022a8474">HaveAlreadySeenReply</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int64_t &amp;lRequestNumber)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8257fd4d11d7a54cc633edb5224d55f4">ResyncNymWithServer</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theNymbox, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theMessageNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1d07c06d85b685d11ac4076104d73f49">checkServerID</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a60e541e43d25106bee94688886d66dcb">createUserAccount</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a6d44f675aa0c8fb36f9d55dadba5efcc">deleteUserAccount</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a3c15352c5e6e6297252cc4d41dc66188">checkUser</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID_CHECK)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aae87777314e8bcd258a117082559b024">usageCredits</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID_CHECK, const int64_t lAdjustment=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1dfa9ba3149336b36e68662e86265b6e">getRequest</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab168fb55e1ce59b07f251517d6768076">sendUserMessage</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID_RECIPIENT, <a class="el" href="class_o_t_string.html">OTString</a> &amp;RECIPIENT_PUBKEY, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_MESSAGE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a579f8299c5c8df16a7d30e2226663d84">sendUserInstrument</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID_RECIPIENT, <a class="el" href="class_o_t_string.html">OTString</a> &amp;RECIPIENT_PUBKEY, <a class="el" href="class_o_t_payment.html">OTPayment</a> &amp;THE_INSTRUMENT, <a class="el" href="class_o_t_payment.html">OTPayment</a> *pINSTRUMENT_FOR_SENDER=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8ab12884841613694afed4593e780e5a">issueAssetType</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a5edd49c564ada6fb519882ad7a60bd8e">getContract</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab8904b6f61d9c3c03acc6d5723458d86">getMint</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0cec1627c8efa1c18cdace3894a916e1">getBoxReceipt</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab1188ffba89c5ab70a5924effb4f0477">queryAssetTypes</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;ENCODED_MAP)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a911f4791ccc4619dc5149e571d676867">createAssetAccount</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a75dfa596de3c054af8a9ffb9c51748b0">deleteAssetAccount</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8d2a98f3ec41510173e91d2acb34b520">getAccount</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a2df75f7a37f281e3bacfce2c0fa49a3e">getAccountFiles</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_basket.html">OTBasket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acd596ba47ce7c6e3f1035d91e6fdfbac">GenerateBasketCreation</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int64_t MINIMUM_TRANSFER)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a27cfd793ce09044f9364bee6e0bff7ad">AddBasketCreationItem</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_basket.html">OTBasket</a> &amp;theBasket, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const int64_t MINIMUM_TRANSFER)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab691e0c2f1b8728b31babf07d958168a">issueBasket</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;BASKET_INFO)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_basket.html">OTBasket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a25e69e50ec485944c6031a5a9511e570">GenerateBasketExchange</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_TYPE_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_ACCT_ID, const int32_t TRANSFER_MULTIPLE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a9257737bcd43f36e8426b5d5bfb67a7b">AddBasketExchangeItem</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_basket.html">OTBasket</a> &amp;theBasket, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_TYPE_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aac6fa94e53c2fd89cd398965282be272">exchangeBasket</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;BASKET_ASSET_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;BASKET_INFO, const bool bExchangeInOrOut)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#afd2344eb8007c310ada18aaafa70eb67">getTransactionNumber</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a598ad655514570fcbcc615709251c7e4">notarizeWithdrawal</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, const int64_t &amp;AMOUNT)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a02e42976ba8ca2b4a667c97c94199780">notarizeDeposit</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PURSE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a10d6c5c156dfe6cf66860c3aa62e5fc0">notarizeTransfer</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_FROM, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_TO, const int64_t &amp;AMOUNT, <a class="el" href="class_o_t_string.html">OTString</a> &amp;NOTE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a2536b41070f3a165345ae598381ddfdd">getNymbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8bc5ab412574867dd506207e311d0fa2">getInbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#afca788fa27e0d4988a5c09586fe23237">getOutbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#aafe1988e1f3029dc633666816ccee743">processNymbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a937dc63294d4d989c0f691b6f12287df">processInbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;ACCT_LEDGER)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7157cd6bf562305e24867b9521188a3c">withdrawVoucher</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_USER_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;CHEQUE_MEMO, const int64_t &amp;AMOUNT)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a867538fd96d36fc772d94cffef2e8d47">payDividend</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ISSUER_USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;DIVIDEND_FROM_ACCT_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SHARES_ASSET_TYPE_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;DIVIDEND_MEMO, const int64_t &amp;AMOUNT_PER_SHARE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1216782dbd78afbf72e269e81c936c6b">depositCheque</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CHEQUE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a0bf5890924481ffbf89bc2a6fb529b04">triggerClause</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int64_t &amp;lTransactionNum, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strClauseName, const <a class="el" href="class_o_t_string.html">OTString</a> *pStrParam=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acdcf4e8ee01eb5684ad276a9f2f96ad6">Create_SmartContract</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_FROM, <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_TO, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a68be6928764334d775d466f0e4725d72">SmartContract_AddBylaw</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;BYLAW_NAME, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a495e1b59fcfedf265a853665c7e2f73c">SmartContract_AddClause</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;BYLAW_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;CLAUSE_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;SOURCE_CODE, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a561b64935144d650a1790b614a593be8">SmartContract_AddVariable</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;BYLAW_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;VAR_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;VAR_ACCESS, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;VAR_TYPE, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;VAR_VALUE, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acb0a85ed4e9125dea813ba87e2e9ecf8">SmartContract_AddCallback</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;BYLAW_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;CALLBACK_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;CLAUSE_NAME, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae4c6e55f20c7609a2a6b774505483bab">SmartContract_AddHook</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;BYLAW_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;HOOK_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;CLAUSE_NAME, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a357d0c597723cd9b03bb77b8636ec1ca">SmartContract_AddParty</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;PARTY_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;AGENT_NAME, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a47bbd248e72e8d45609a5365f7fa5187">SmartContract_AddAccount</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;PARTY_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;ACCT_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;ASSET_TYPE_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ae9ebf14defb8aa50c6c40a1b20fbe20d">SmartContract_CountNumsNeeded</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;AGENT_NAME)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a10954b356a026ea6729ece4d16b281eb">SmartContract_ConfirmAccount</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SIGNER_NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;PARTY_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;ACCT_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;AGENT_NAME, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;ACCT_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a3c1974fc1798d311264ff55ef1724dcf">SmartContract_ConfirmParty</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CONTRACT, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;PARTY_NAME, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af1e69026904ab8b2a6a3a1185801bdf7">Msg_HarvestTransactionNumbers</a> (<a class="el" href="class_o_t_message.html">OTMessage</a> &amp;theMsg, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a46beec5e1e260828865c4c03b71930ab">HarvestClosingNumbers</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CRON_ITEM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a3455b2ed3c8b4abef30b1eaaafa595ab">HarvestAllNumbers</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;NYM_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_CRON_ITEM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ab1022d7f5baf3dadf907e1cf1f5adc08">activateSmartContract</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_SMART_CONTRACT)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a4b11c8f60024b34f43c9a9132fe8ac65">depositPaymentPlan</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;THE_PAYMENT_PLAN)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#acadf476636347f6d2e748a3ac517c7c8">issueMarketOffer</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;CURRENCY_ACCT_ID, const int64_t &amp;MARKET_SCALE, const int64_t &amp;MINIMUM_INCREMENT, const int64_t &amp;TOTAL_ASSETS_ON_OFFER, const int64_t &amp;PRICE_LIMIT, const bool bBuyingOrSelling, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tLifespanInSeconds=<a class="el" href="_o_t_common_8hpp.html#ae431139997436f8522341a67e64d0d32">OT_TIME_DAY_IN_SECONDS</a>, const char STOP_SIGN=0, const int64_t ACTIVATION_PRICE=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a86ffb271aec1f5cdb211f3f1403cc910">getMarketList</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a32bf905befe6a9450b9293ed75ee1e3a">getMarketOffers</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;MARKET_ID, const int64_t &amp;lDepth)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ad4046209a1d0cb1792b23f71834a294e">getMarketRecentTrades</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;MARKET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1e508b83332ea7707f74c91622105ea8">getNym_MarketOffers</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#ade192b1b17ef3814b79e76afe7badb8a">cancelCronItem</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ACCT_ID, const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a8523ebb8ba314f72c5f04951d9bd375f">getOffer_Trades</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a13311668f7e0d6a58ef5d97e83fa9f46">AddServerContract</a> (const <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> &amp;pContract)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a1235a29159f7ed06cd975ad94186eb42">AddAssetContract</a> (const <a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> &amp;theContract)</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#adc39b64382968c133c59fd7bf52124de">InitOTApp</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#a7c1ce59287a7919d518149d9252e9d34">CleanupOTApp</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_wallet.html">OTWallet</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_client.html">OTClient</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_open_transactions_8hpp_source.html#l00212">212</a> of file <a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="adc2385facb91965076934474d827dd6d"></a><!-- doxytag: member="OT_API::OT_API" ref="adc2385facb91965076934474d827dd6d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t___a_p_i.html#adc2385facb91965076934474d827dd6d">OT_API::OT_API</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00342">342</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">               :
    m_pPid(<span class="keyword">new</span> Pid()),
    m_pTransportCallback(NULL),

<span class="preprocessor">#ifdef OT_ZMQ_2_MODE</span>
<span class="preprocessor"></span>    m_pSocket(<span class="keyword">new</span> OTSocket_ZMQ_2()),
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef OT_ZMQ_4_MODE</span>
<span class="preprocessor"></span>    m_pSocket(<span class="keyword">new</span> <a class="code" href="class_o_t_socket___z_m_q__4.html">OTSocket_ZMQ_4</a>()),
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>(NULL),
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>(NULL),
    m_bInitialized(<span class="keyword">false</span>)
{

    m_strDataPath = <span class="stringliteral">&quot;&quot;</span>;
    m_strWalletFilename = <span class="stringliteral">&quot;&quot;</span>;
    m_strWalletFilePath = <span class="stringliteral">&quot;&quot;</span>;
    m_strConfigFilename = <span class="stringliteral">&quot;&quot;</span>;
    m_strConfigFilePath = <span class="stringliteral">&quot;&quot;</span>;

    <span class="keywordflow">if</span> (!this-&gt;Init())
    {
        this-&gt;Cleanup();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a652314745fe8d849224ccd851c5eb94e"></a><!-- doxytag: member="OT_API::~OT_API" ref="a652314745fe8d849224ccd851c5eb94e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t___a_p_i.html#a652314745fe8d849224ccd851c5eb94e">OT_API::~OT_API</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00373">373</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// DELETE AND SET NULL</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL != m_pSocket) <span class="keyword">delete</span> m_pSocket; m_pSocket = NULL;

    <span class="keywordflow">if</span> (NULL != m_pTransportCallback) <span class="keyword">delete</span> m_pTransportCallback; m_pTransportCallback = NULL;
    <span class="keywordflow">if</span> (NULL != <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>) <span class="keyword">delete</span> <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>; <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a> = NULL;
    <span class="keywordflow">if</span> (NULL != <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>) <span class="keyword">delete</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>; <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> = NULL;

    <span class="keywordflow">if</span> (m_bInitialized)
    <span class="keywordflow">if</span> (!(this-&gt;Cleanup())) <span class="comment">// we only cleanup if we need to</span>
    {
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="comment">// this must be last!</span>
    <span class="keywordflow">if</span> (NULL != m_pPid) <span class="keyword">delete</span> m_pPid;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab1022d7f5baf3dadf907e1cf1f5adc08"></a><!-- doxytag: member="OT_API::activateSmartContract" ref="ab1022d7f5baf3dadf907e1cf1f5adc08" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTString &amp;THE_SMART_CONTRACT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ab1022d7f5baf3dadf907e1cf1f5adc08">OT_API::activateSmartContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_SMART_CONTRACT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l10309">10309</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bCancelling = <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> theContract(SERVER_ID);
    <a class="code" href="class_o_t_message.html">OTMessage</a>       theMessage;
    int64_t            lRequestNumber = 0;
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">if</span> (theContract.LoadContractFromString(THE_SMART_CONTRACT))
    {
        <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = NULL;
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = theContract.FindPartyBasedOnNymAsAuthAgent(*pNym, &amp;pAgent);
        <span class="keywordflow">if</span> (NULL == pParty)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: USER_ID *IS* a valid Nym, but that Nym is not the authorizing agent for any &quot;</span>
                           <span class="stringliteral">&quot;of the parties on this contract. Try calling ConfirmParty() first.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> (-1);
        }
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pAgent);
        <span class="comment">//</span>
        <span class="comment">// BELOW THIS POINT, pAgent and pParty are both valid, and no need to clean them up.</span>
        <span class="comment">// ----------------------------------</span>
        <span class="comment">// Note: Usually, payment plan or market offer will load up the Nym and accounts,</span>
        <span class="comment">// and verify ownership, etc.</span>
        <span class="comment">// But in this case, the Nym who actually activates the smart contract is merely</span>
        <span class="comment">// the authorizing agent for a single party, where there may be a dozen parties listed</span>
        <span class="comment">// on the actual contract.</span>
        <span class="comment">//</span>
        <span class="comment">// It would be unreasonable to expect a party to have EVERY nym and EVERY account</span>
        <span class="comment">// to the entire contract. As long as the Nym is legitimately the authorizing agent</span>
        <span class="comment">// for one of the parties, then we allow him to send the activation message to the server.</span>
        <span class="comment">//</span>
        <span class="comment">// (Let the server sort out the trouble of loading all the nyms, loading all the accounts,</span>
        <span class="comment">// verifying all the asset type IDs, verifying all the agent names, making sure there</span>
        <span class="comment">// are no stashes already created, ETC ETC.)</span>
        <span class="comment">//</span>
        <span class="comment">// ONE THING I should verify, is that all of the parties are confirmed. I mean, it&#39;s not</span>
        <span class="comment">// even worth the bother to send the damn thing until then, right? And the Server ID.</span>
        <span class="comment">//</span>

        <span class="comment">// -----------------------------------------------------------</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == theContract.AllPartiesHaveSupposedlyConfirmed()) <span class="comment">// all parties are NOT confirmed.</span>
        {
<span class="comment">//          OTLog::vOutput(0, &quot;%s: Failed. EACH PARTY to this smart contract needs to CONFIRM IT FIRST, before one of them &quot;</span>
<span class="comment">//                           &quot;then activates it at the server. (But THIS smart contract has NOT yet been confirmed, at least, &quot;</span>
<span class="comment">//                           &quot;not by all of its parties.)\n&quot;, __FUNCTION__);</span>
<span class="comment">//          return -1;</span>

            <span class="comment">// UPDATE: This is now how we will trigger the &quot;cancel smart contract&quot; functionality, which can</span>
            <span class="comment">// only be performed BEFORE the contract has been activated.</span>

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Not all parties to smart contract are confirmed. Treating this as a request for cancelation...\n&quot;</span>);

            bCancelling = <span class="keyword">true</span>;
            <span class="comment">// ----------------------------</span>
            <span class="keywordflow">if</span> (theContract.IsCanceled())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: attempted to cancel (pre-emptively, before activation) a smart contract &quot;</span>
                              <span class="stringliteral">&quot;that was already set as canceled.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> (-1);
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!theContract.CancelBeforeActivation(*pNym)) <span class="comment">// sets as canceler, releases signatures, signs, saves.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: attempted to cancel (pre-emptively, before activation) a smart contract, &quot;</span>
                              <span class="stringliteral">&quot;but the attempt somehow failed.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> (-1);
            }
        }
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="keywordflow">if</span> (SERVER_ID != theContract.GetServerID())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. The server ID passed in doesn&#39;t match the one on the contract itself.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="keywordflow">if</span> (!(pParty-&gt;<a class="code" href="class_o_t_party.html#a0b130989d275386c980ed34d587e5e87">GetAccountCount</a>() &gt; 0))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. The activating Nym must not only be the authorizing agent for one of the parties, &quot;</span>
                            <span class="stringliteral">&quot;but must also be the authorized agent for one of that party&#39;s asset accounts. That party must have &quot;</span>
                           <span class="stringliteral">&quot;at least one asset account &quot;</span>
                            <span class="stringliteral">&quot;for this reason. (See code comment below this message, in the code.)\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// *************************************************************************************</span>
        <span class="comment">//</span>
        <span class="comment">// REQUIREMENT:  The ACTIVATOR aka the Originator Nym (the party who activates the smart</span>
        <span class="comment">// contract on the server) must have at least one asset account as part of the smart contract,</span>
        <span class="comment">// for which the authorizing agent for that party is also the authorized agent for that account.</span>
        <span class="comment">// This is in order to make sure that the smart contracts will work with the existing infrastructure,</span>
        <span class="comment">// so that functions like &quot;GetOpeningNumber()&quot; and &quot;GetClosingNumber()&quot; will continue to work the way</span>
        <span class="comment">// they are expected to, and so that there is always at least ONE closing transaction number supplied</span>
        <span class="comment">// for the smart contract (at least ONE finalReceipt will actually have to be signed for once it is</span>
        <span class="comment">// deactivated) and so we can know who the owner of that account, and what acct # it will be.</span>
        <span class="comment">//</span>
        <span class="comment">// This is also a requirement because the existing infrastructure uses the transaction system for</span>
        <span class="comment">// activating cron items. It was simply not anticipated in the past that cron items, based on valid</span>
        <span class="comment">// transactions, wouldn&#39;t also therefore be associated with at least one asset account. In fact,</span>
        <span class="comment">// the original difference between transactions (vs normal messages) was that transactions dealt</span>
        <span class="comment">// with asset accounts, whereas normal messages did not. (Such as, &quot;checkUser&quot; or &quot;getRequest&quot;.)</span>
        <span class="comment">//</span>
        <span class="comment">// A big piece of this is the BALANCE AGREEMENT. Obviously it wasn&#39;t anticipated that &quot;balance</span>
        <span class="comment">// agreements&quot; would ever be needed for transactions, yet asset accounts wouldn&#39;t be. So the below</span>
        <span class="comment">// TRANSACTION STATEMENT, for example, expects an asset account, as does the verification code</span>
        <span class="comment">// associated with it. Even transaction statements were originally made for situations where the balance</span>
        <span class="comment">// wasn&#39;t actually changing, (and so a balance agreement wasn&#39;t needed), but where a signature on</span>
        <span class="comment">// the transaction numbers was still necessary, since one had to be burned in order to prove that</span>
        <span class="comment">// the instrument was valid.</span>
        <span class="comment">//</span>
        <span class="comment">// Unfortunately, transaction statements still expected an asset account to at least EXIST, since</span>
        <span class="comment">// they involved market offers (which do not immediately change the balance) or payment plans</span>
        <span class="comment">// (which also do not immediately change the balance.) Yet the account&#39;s ID was still at least</span>
        <span class="comment">// present in the receipt, and a transaction # was still used.</span>
        <span class="comment">//</span>
        <span class="comment">// In the case of smart contracts, I will probably someday lift this restriction (that the activating</span>
        <span class="comment">// nym must also be the authorized agent on one of the asset accounts on the smart contract). But I</span>
        <span class="comment">// will have to go over all the plumbing first and deal with that. In the meantime:</span>
        <span class="comment">//</span>
        <span class="comment">// --- THE ACTIVATING NYM *MUST* ALSO BE THE AUTHORIZED AGENT</span>
        <span class="comment">//     FOR AT LEAST ONE ASSET ACCOUNT, FOR THAT PARTY. ---</span>
        <span class="comment">//</span>
        <span class="comment">// *************************************************************************************</span>

        <span class="keyword">const</span> std::string str_agent_name(pAgent-&gt;<a class="code" href="class_o_t_agent.html#a123d27f05e46977ecdbe0b83de3c119d">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#a6cdea442a9b09e5b8f3fdfedba4ae767">GetAccountByAgent</a>(str_agent_name);

        <span class="keywordflow">if</span> (NULL == pAcct)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. The activating Nym must not only be the authorizing agent for one of the parties, &quot;</span>
                           <span class="stringliteral">&quot;but must also be the authorized agent for one of that party&#39;s asset accounts. That party must have &quot;</span>
                           <span class="stringliteral">&quot;at least one asset account &quot;</span>
                           <span class="stringliteral">&quot;for this reason. (See code comment above this message, in the code.)\n&quot;</span>,__FUNCTION__);
            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strAcctID = pAcct-&gt;GetAcctID();

        <span class="keywordflow">if</span> (!strAcctID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. The Account ID is blank for asset acct (%s) for party (%s). Did you confirm &quot;</span>
                           <span class="stringliteral">&quot;this account, before trying to activate this contract?\n&quot;</span>, __FUNCTION__,
                           pAcct-&gt;GetName().Get(), pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            <span class="keywordflow">return</span> -1;
        }
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAcctID(strAcctID);
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="keyword">const</span> int64_t   lOpeningTransNo = pParty-&gt;<a class="code" href="class_o_t_party.html#aa11f990dfe9743dd1d8e34af8bfd693a">GetOpeningTransNo</a>();
        <span class="keyword">const</span> int64_t   lClosingTransNo = pAcct-&gt; GetClosingTransNo();

        <span class="keywordflow">if</span> ((lOpeningTransNo &lt;= 0) || (lClosingTransNo &lt;= 0))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. Opening Transaction # (%ld) or Closing # (%ld) were invalid &quot;</span>
                           <span class="stringliteral">&quot;for asset acct (%s) for party (%s). Did you confirm this account and party, &quot;</span>
                           <span class="stringliteral">&quot;before trying to activate this contract?\n&quot;</span>,
                           __FUNCTION__, lOpeningTransNo, lClosingTransNo, pAcct-&gt;GetName().Get(),
                           pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            <span class="keywordflow">return</span> -1;
        }
        <span class="keywordflow">if</span> (!pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lOpeningTransNo))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. Opening Transaction # (%ld) wasn&#39;t valid/issued to this Nym, &quot;</span>
                           <span class="stringliteral">&quot;for asset acct (%s) for party (%s) on server (%s). Did you confirm this account and party, &quot;</span>
                           <span class="stringliteral">&quot;before trying to activate this contract?\n&quot;</span>,
                           __FUNCTION__, lOpeningTransNo, pAcct-&gt;GetName().Get(), pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str(),
                           strServerID.Get());
            <span class="keywordflow">return</span> -1;
        }
        <span class="keywordflow">if</span> (!pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lClosingTransNo))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed. Closing Transaction # (%ld) wasn&#39;t issued to this Nym, &quot;</span>
                           <span class="stringliteral">&quot;for asset acct (%s) for party (%s). Did you confirm this account and party, &quot;</span>
                           <span class="stringliteral">&quot;before trying to activate this contract?\n&quot;</span>,
                           __FUNCTION__, lClosingTransNo, pAcct-&gt;GetName().Get(), pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="comment">// These numbers (the opening and closing transaction #s) were already available on</span>
        <span class="comment">// the smart contract -- specifically an opening number is stored for each party,</span>
        <span class="comment">// taken from the authorizing agent for that party, and a closing number is stored for</span>
        <span class="comment">// each asset account, taken from the authorized agent for that asset account.</span>
        <span class="comment">//</span>
        <span class="comment">// Now we set the appropriate opening/closing number onto the smart contract, in the way</span>
        <span class="comment">// of the existing CronItem system, so that it will work properly within that infrastructure.</span>
        <span class="comment">// (This is what makes the activating Nym slightly different / more than the other authorizing</span>
        <span class="comment">// agent nyms for each party to the contract. Not only does it have opening/closing numbers</span>
        <span class="comment">// on its party like all the others, but its numbers are also those used for the cron item itself.)</span>
        <span class="comment">//</span>
        theContract.PrepareToActivate(lOpeningTransNo, lClosingTransNo, USER_ID, theAcctID);
        <span class="comment">// This call changes the contract slightly, so it must be re-signed (in order to save changes.)</span>
        <span class="comment">// ----------------------------------------------------------</span>
        theContract.ReleaseSignatures();

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAgent-&gt;<a class="code" href="class_o_t_agent.html#a0749f394cfbabd6a64942bbf53af0e7b">SignContract</a>(theContract)) <span class="comment">// RE-SIGN HERE.</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed re-signing contract, after calling PrepareToActivate().\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> -1;
        }

        theContract.SaveContract();
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(theContract); <span class="comment">// Grab a string version of the latest signed contract.</span>
        <span class="comment">// ----------------------------------------------------------</span>
        <span class="comment">// Create a transaction</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID,
                                                                           theAcctID,
                                                                           SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>,
                                                                           theContract.GetTransactionNum());

        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">OTItem::smartContract</a>);

        <span class="comment">// Add the smart contract string as the attachment on the transaction item.</span>
        pItem-&gt;SetAttachment(strContract);

        <span class="comment">// sign the item</span>
        pItem-&gt;SignContract(*pNym);
        pItem-&gt;SaveContract();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// TRANSACTION AGREEMENT</span>

        <span class="comment">// pStatementItem is signed and saved within this call. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pStatementItem = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab592ef450504c5af83b84d8a15ef02ea">GenerateTransactionStatement</a>(*pTransaction);

        <span class="keywordflow">if</span> (NULL != pStatementItem) <span class="comment">// Will never be NULL. Will assert above before it gets here.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pStatementItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, theAcctID, SERVER_ID);

        theLedger.GenerateLedger(theAcctID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>
        <span class="comment">// ---------------------------------------------</span>
        theAcctID.GetString(theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>);
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;
        <span class="comment">// ---------------------------------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);
        <span class="comment">// ---------------------------------------------</span>
        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                          __FUNCTION__, str_server.c_str());
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);
        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);

    } <span class="comment">// theContract.LoadContractFromString()</span>
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load smart contract from string:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_SMART_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1235a29159f7ed06cd975ad94186eb42"></a><!-- doxytag: member="OT_API::AddAssetContract" ref="a1235a29159f7ed06cd975ad94186eb42" args="(const OTAssetContract &amp;theContract)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t___a_p_i.html#a1235a29159f7ed06cd975ad94186eb42">OT_API::AddAssetContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> &amp;&#160;</td>
          <td class="paramname"><em>theContract</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12990">12990</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    this-&gt;<a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#aec0dc4e66d6bc87cbec6fc4c0e3851f7">AddAssetContract</a>(theContract);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a27cfd793ce09044f9364bee6e0bff7ad"></a><!-- doxytag: member="OT_API::AddBasketCreationItem" ref="a27cfd793ce09044f9364bee6e0bff7ad" args="(const OTIdentifier &amp;USER_ID, OTBasket &amp;theBasket, const OTIdentifier &amp;ASSET_TYPE_ID, const int64_t MINIMUM_TRANSFER)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a27cfd793ce09044f9364bee6e0bff7ad">OT_API::AddBasketCreationItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_basket.html">OTBasket</a> &amp;&#160;</td>
          <td class="paramname"><em>theBasket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>MINIMUM_TRANSFER</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08170">8170</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::AddBasketCreationItem&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>

    theBasket.<a class="code" href="class_o_t_basket.html#ae0a4fc1320ad66dd613b70cbc8e6a32b">AddSubContract</a>(ASSET_TYPE_ID, MINIMUM_TRANSFER);

    theBasket.<a class="code" href="class_o_t_basket.html#ac42324cfcc230857969c398d2c3e61c4">IncrementSubCount</a>();

    theBasket.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    theBasket.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    theBasket.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9257737bcd43f36e8426b5d5bfb67a7b"></a><!-- doxytag: member="OT_API::AddBasketExchangeItem" ref="a9257737bcd43f36e8426b5d5bfb67a7b" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, OTBasket &amp;theBasket, const OTIdentifier &amp;ASSET_TYPE_ID, const OTIdentifier &amp;ASSET_ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a9257737bcd43f36e8426b5d5bfb67a7b">OT_API::AddBasketExchangeItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_basket.html">OTBasket</a> &amp;&#160;</td>
          <td class="paramname"><em>theBasket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08354">8354</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::AddBasketExchangeItem&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pContract is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ASSET_ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(SERVER_ID) &lt; 1)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::AddBasketExchangeItem: you need at least one transaction number to add this exchange item.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (ASSET_TYPE_ID != pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>())
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(ASSET_TYPE_ID), strAcctID(ASSET_ACCT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::AddBasketExchangeItem: Wrong asset type ID on account %s (expected to find asset type %s)\n&quot;</span>,
                       strAcctID.Get(), strAssetTypeID.Get());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// By this point, I know that everything checks out. Signature and Account ID.</span>
    <span class="comment">// pAccount is good, and no need to clean it up.</span>
    <span class="comment">// ----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    int64_t lSubClosingTransactionNo = 0; <span class="comment">// For the basketReceipt (closing transaction num) for the sub account.</span>

    <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lSubClosingTransactionNo)) <span class="comment">// this saves</span>
    <span class="comment">// ---------------------------------------------------</span>
    {
        theBasket.<a class="code" href="class_o_t_basket.html#a040522b77565e6349a11ec127089c904">AddRequestSubContract</a>(ASSET_TYPE_ID, ASSET_ACCT_ID, lSubClosingTransactionNo);

        theBasket.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        theBasket.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        theBasket.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::AddBasketExchangeItem: Failed getting next transaction number. \n&quot;</span>);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a13311668f7e0d6a58ef5d97e83fa9f46"></a><!-- doxytag: member="OT_API::AddServerContract" ref="a13311668f7e0d6a58ef5d97e83fa9f46" args="(const OTServerContract &amp;pContract)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t___a_p_i.html#a13311668f7e0d6a58ef5d97e83fa9f46">OT_API::AddServerContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> &amp;&#160;</td>
          <td class="paramname"><em>pContract</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12985">12985</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    this-&gt;<a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#ad925633d8ba2319948b466ca0f0dc438">AddServerContract</a>(pContract);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae5d31c92f0438b3c64ff5466c4e380e1"></a><!-- doxytag: member="OT_API::AddSignature" ref="ae5d31c92f0438b3c64ff5466c4e380e1" args="(const OTIdentifier &amp;theSignerNymID, const OTString &amp;strContract, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ae5d31c92f0438b3c64ff5466c4e380e1">OT_API::AddSignature</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strContract</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-Sign a CONTRACT. (Add a signature) Tries to instantiate the contract object, based on the string passed in. Signs the contract, WITHOUT releasing any signatures that are already there. Returns the signed contract, or NULL if failure.</p>
<p>OT-Sign a CONTRACT. (Add a signature)</p>
<p>const char * OT_API_AddSignature(const char * SIGNER_NYM_ID, const char * THE_CONTRACT);</p>
<p>Tries to instantiate the contract object, based on the string passed in. Signs the contract, without releasing any signatures that are already there. Returns the signed contract, or NULL if failure.</p>
<p>NOTE: The actual OT functionality (Use Cases) NEVER requires you to sign via this function. Why not? because, anytime a signature is needed on something, the relevant OT API call will require you to pass in the Nym, and the API already signs internally wherever it deems appropriate. Thus, this function is only for advanced uses, for OT-Scripts, server operators, etc. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03210">3210</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerNymID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!strContract.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract passed in. (Returning false.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_contract.html">OTContract</a> * pContract = NULL;

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_contract.html#a3a4b4d7e43a53027a5e170557b9e7e12">OTContract::InstantiateContract</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: I tried my best. Unable to instantiate contract passed in:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTContract&gt;</a> theAngel(*pContract);

    <span class="comment">// -----------------------------------------------------</span>
<span class="comment">//  pContract-&gt;ReleaseSignatures();     // Other than this line, this function is identical to</span>
                                        <span class="comment">// OT_API::SignContract(). (This one adds signatures without removing existing ones.)</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// -----------------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade192b1b17ef3814b79e76afe7badb8a"></a><!-- doxytag: member="OT_API::cancelCronItem" ref="ade192b1b17ef3814b79e76afe7badb8a" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ASSET_ACCT_ID, const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ade192b1b17ef3814b79e76afe7badb8a">OT_API::cancelCronItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>------------------------------------------------------- CANCEL A SPECIFIC OFFER (THAT SAME NYM PLACED PREVIOUSLY ON SAME SERVER.) By transaction number as key. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l10649">10649</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::cancelCronItem&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a>   theMessage;

    int64_t lRequestNumber = 0;

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(strServerID) &lt; 1)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::cancelCronItem: At least 1 Transaction Number is necessary to cancel any cron item. &quot;</span>
                      <span class="stringliteral">&quot;Try requesting the server for more numbers (you are low.)\n&quot;</span>);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// ------------------------------------</span>
    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum   = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=false</span>

    <span class="keywordflow">if</span> (!bGotTransNum)
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::cancelCronItem: Supposedly there was a transaction number available, but the call\n&quot;</span>
                     <span class="stringliteral">&quot;still failed.\n&quot;</span>);
    <span class="keywordflow">else</span>
    {
        <span class="comment">// -------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> str_ASSET_ACCT_ID(ASSET_ACCT_ID);

        <span class="comment">// Create a transaction</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ASSET_ACCT_ID, SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>, lStoredTransactionNumber);
        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5db1c9a56286c66937eb57d460f2eb01">OTItem::cancelCronItem</a>);
        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pItem, <span class="stringliteral">&quot;Error allocating memory in the OT API&quot;</span>);

        pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lTransactionNum);          <span class="comment">// This transaction is being sent in order to cancel another transaction.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lTransactionNum);   <span class="comment">// This is where we clearly show which one is actually being cancelled.</span>

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// TRANSACTION AGREEMENT</span>

        <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pStatementItem = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab592ef450504c5af83b84d8a15ef02ea">GenerateTransactionStatement</a>(*pTransaction);

        <span class="keywordflow">if</span> (NULL != pStatementItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pStatementItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ASSET_ACCT_ID, SERVER_ID);
        theLedger.GenerateLedger(ASSET_ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>

        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();

        <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = str_ASSET_ACCT_ID;
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                          str_server.c_str());

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    } <span class="comment">// got transaction number.</span>

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1d07c06d85b685d11ac4076104d73f49"></a><!-- doxytag: member="OT_API::checkServerID" ref="a1d07c06d85b685d11ac4076104d73f49" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a1d07c06d85b685d11ac4076104d73f49">OT_API::checkServerID</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12952">12952</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::checkServerID&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int32_t nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a89596b609fbd84aa6151ca9d1b107c13">OTClient::checkServerID</a>, theMessage,
                                                     *pNym, *pServer,
                                                     NULL); <span class="comment">// NULL pAccount on this command.</span>
    <span class="keywordflow">if</span> (0 &lt; nReturnValue) 
    {               
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing checkServerID command in OT_API::checkServerID\n&quot;</span>);

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c15352c5e6e6297252cc4d41dc66188"></a><!-- doxytag: member="OT_API::checkUser" ref="a3c15352c5e6e6297252cc4d41dc66188" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;USER_ID_CHECK)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a3c15352c5e6e6297252cc4d41dc66188">OT_API::checkUser</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID_CHECK</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12533">12533</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strNymID2(USER_ID_CHECK);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;checkUser&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strNymID2;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7c1ce59287a7919d518149d9252e9d34"></a><!-- doxytag: member="OT_API::CleanupOTApp" ref="a7c1ce59287a7919d518149d9252e9d34" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a7c1ce59287a7919d518149d9252e9d34">OT_API::CleanupOTApp</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00309">309</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!OT_API::bInitOTApp)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: WARNING: Never Successfully called:  %s\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;OT_API::InitCTX()&quot;</span>);
        OT_API::bInitOTApp = <span class="keyword">true</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (!OT_API::bCleanupOTApp)
    {
        <span class="comment">// ------------------------------------</span>
        <a class="code" href="class_o_t_cached_key.html#a60f1041be525c88bde575ac183e64435">OTCachedKey::Cleanup</a>(); <span class="comment">// it has a static list of dynamically allocated master keys that need to be cleaned up, if the application is shutting down.</span>
        <span class="comment">// ------------------------------------</span>

        <span class="comment">// We clean these up in reverse order from the Init function, which just seems</span>
        <span class="comment">// like the best default, in absence of any brighter ideas.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a0b59b9598063be8d46a733bbd3449514">Cleanup</a>();  <span class="comment">// (OpenSSL gets cleaned up here.)</span>
        <span class="comment">// ------------------------------------</span>

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: This function can only be called once.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a742952a02e0d947156e8687933602725"></a><!-- doxytag: member="OT_API::ClearExpired" ref="a742952a02e0d947156e8687933602725" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const int32_t nIndex, const bool bClearAll=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a742952a02e0d947156e8687933602725">OT_API::ClearExpired</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bClearAll</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06544">6544</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a>  * pExpiredBox = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ae3d6ecd9fabfea445d35fd7307008856">LoadExpiredBox</a>(SERVER_ID, USER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pExpiredBox)
    {
        pExpiredBox = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>, <span class="keyword">true</span>);

        <span class="keywordflow">if</span> (NULL == pExpiredBox)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load or create expired box (and thus unable to do anything with it.)\n&quot;</span>,
                          __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theExpiredBoxAngel (pExpiredBox);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (bClearAll)
    {
        pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#ade9cb07bcb99f244712fe948291fbb6c">ReleaseTransactions</a>();
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#ace1cb1337e94d794243bbe163eb88813">SaveExpiredBox</a>();
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="comment">// Okay, it&#39;s not &quot;clear all&quot; but &quot;clear at index&quot; ...</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int32_t nTransCount  = pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>();

    <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= nTransCount))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Index out of bounds (highest allowed index for this expired box is %d.)\n&quot;</span>,
                       __FUNCTION__, nTransCount-1);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex);
    <span class="keywordtype">bool</span> bRemoved = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (NULL != pTransaction)
    {
        <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#aea09d3dd8bf2fc5630ce87184fc937c1">DeleteBoxReceipt</a>(lTransactionNum))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to delete the box receipt for a transaction being removed &quot;</span>
                          <span class="stringliteral">&quot;from a expired box: %ld\n&quot;</span>, __FUNCTION__, lTransactionNum);
        }
        <span class="comment">// -----------------------------------------------------</span>
        bRemoved = pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a>(lTransactionNum);
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="keywordflow">if</span> (bRemoved)
    {
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pExpiredBox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        pExpiredBox-&gt;<a class="code" href="class_o_t_ledger.html#ace1cb1337e94d794243bbe163eb88813">SaveExpiredBox</a>();
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <span class="keyword">const</span> int32_t nTemp = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(nIndex);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to clear an expired record from the expired box at index: %d\n&quot;</span>,
                       __FUNCTION__, nTemp);        
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71244607da4b28d1b33ab623ec9a2a1e"></a><!-- doxytag: member="OT_API::ClearRecord" ref="a71244607da4b28d1b33ab623ec9a2a1e" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID, const int32_t nIndex, const bool bClearAll=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a71244607da4b28d1b33ab623ec9a2a1e">OT_API::ClearRecord</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bClearAll</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07605">7605</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a>  * pRecordBox = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a318f160f9a43ac68afcf415ff51ae267">LoadRecordBox</a> (SERVER_ID, USER_ID, ACCOUNT_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pRecordBox)
    {
        pRecordBox = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>, <span class="keyword">true</span>);

        <span class="keywordflow">if</span> (NULL == pRecordBox)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load or create record box (and thus unable to do anything with it.)\n&quot;</span>,
                          __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theRecordBoxAngel (pRecordBox);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (bClearAll)
    {
        pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#ade9cb07bcb99f244712fe948291fbb6c">ReleaseTransactions</a>();
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#aff379f9b12cebb1132bca402396f1a8a">SaveRecordBox</a>();
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="comment">// Okay, it&#39;s not &quot;clear all&quot; but &quot;clear at index&quot; ...</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int32_t nTransCount  = pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>();

    <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= nTransCount))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Index out of bounds (highest allowed index for this record box is %d.)\n&quot;</span>,
                       __FUNCTION__, nTransCount-1);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex);
    <span class="keywordtype">bool</span> bRemoved = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (NULL != pTransaction)
    {
        <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#aea09d3dd8bf2fc5630ce87184fc937c1">DeleteBoxReceipt</a>(lTransactionNum))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to delete the box receipt for a transaction being removed &quot;</span>
                          <span class="stringliteral">&quot;from a record box: %ld\n&quot;</span>, __FUNCTION__, lTransactionNum);
        }
        <span class="comment">// -----------------------------------------------------</span>
        bRemoved = pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a>(lTransactionNum);
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="keywordflow">if</span> (bRemoved)
    {
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pRecordBox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        pRecordBox-&gt;<a class="code" href="class_o_t_ledger.html#aff379f9b12cebb1132bca402396f1a8a">SaveRecordBox</a>();
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <span class="keyword">const</span> int32_t nTemp = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(nIndex);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to clear a record from the record box at index: %d\n&quot;</span>,
                       __FUNCTION__, nTemp);        
    }
    <span class="comment">// -----------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe54d89f1f94b05bb2ecaffe9a02e1f4"></a><!-- doxytag: member="OT_API::ConfirmPaymentPlan" ref="afe54d89f1f94b05bb2ecaffe9a02e1f4" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;SENDER_USER_ID, const OTIdentifier &amp;SENDER_ACCT_ID, const OTIdentifier &amp;RECIPIENT_USER_ID, OTPaymentPlan &amp;thePlan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#afe54d89f1f94b05bb2ecaffe9a02e1f4">OT_API::ConfirmPaymentPlan</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_payment_plan.html">OTPaymentPlan</a> &amp;&#160;</td>
          <td class="paramname"><em>thePlan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04983">4983</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SENDER_USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs, ASSERTs, etc.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, SENDER_ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMerchantNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a5d793f8c61422481fc3a266ec68c523a">LoadPublicNym</a>(RECIPIENT_USER_ID, __FUNCTION__);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPseudonym&gt;</a> theNymAngel(pMerchantNym);

<span class="comment">//  if (NULL == pMerchantNym) // We don&#39;t have this Nym in our storage already.</span>
<span class="comment">//  {</span>
<span class="comment">//      const OTString strRecipNymID(RECIPIENT_USER_ID);</span>
<span class="comment">//      OTLog::vOutput(0, &quot;%s: There&#39;s no (Merchant) Nym with the recipient&#39;s NymID in local storage: %s\n&quot;,</span>
<span class="comment">//                     __FUNCTION__, strRecipNymID.Get());</span>
<span class="comment">//        return false;</span>
<span class="comment">//  }</span>
    <span class="comment">// pMerchantNym is also good, and has an angel. (No need to cleanup.)</span>
    <span class="comment">//</span>
    <span class="comment">// *******************************************************</span>
    <span class="comment">// The &quot;Creation Date&quot; of the agreement is re-set here.</span>
    <span class="comment">//</span>
    <span class="keywordtype">bool</span> bConfirmed = thePlan.<a class="code" href="class_o_t_agreement.html#aa58d2054b933bffe9c2b2ca5564b7f49">Confirm</a>(*pNym, pMerchantNym, &amp;RECIPIENT_USER_ID);
    <span class="comment">//</span>
    <span class="comment">// WARNING:  The call to &quot;Confirm()&quot; uses TWO transaction numbers from pNym!</span>
    <span class="comment">// If you don&#39;t end up actually USING this payment plan, then you need to retrieve</span>
    <span class="comment">// those numbers and Add them back to pNym again.</span>
    <span class="comment">// A nice client will store a copy of any payment plans until they are closed out, or canceled,</span>
    <span class="comment">// or whatever.</span>
    <span class="comment">// ANY FAILURES BELOW THIS POINT need to be smart enough to retrieve those numbers before returning.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    <span class="keywordflow">if</span> (!bConfirmed)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to confirm the agreement.\n&quot;</span>, __FUNCTION__);
        thePlan.<a class="code" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">HarvestOpeningNumber</a> (*pNym);
        thePlan.<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(*pNym);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------------------</span>
    thePlan.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym); <span class="comment">// Here we have saved the CUSTOMER&#39;s version,</span>
    thePlan.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();      <span class="comment">// which contains a copy of the merchant&#39;s version.</span>
    <span class="comment">// ------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// DROP A COPY into the Outpayments box...</span>
    <span class="comment">//</span>
    <span class="comment">// (Since we used a transaction number to confirm the plan, we</span>
    <span class="comment">// have to track it until it&#39;s deposited or until we cancel it.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInstrument(thePlan);
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(SENDER_USER_ID), strNymID2(RECIPIENT_USER_ID);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outpaymentsMessage&quot;</span>;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>       = strNymID2;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>     = strServerID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strInstrument);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
    pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);
    <span class="comment">// ------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acdcf4e8ee01eb5684ad276a9f2f96ad6"></a><!-- doxytag: member="OT_API::Create_SmartContract" ref="acdcf4e8ee01eb5684ad276a9f2f96ad6" args="(const OTIdentifier &amp;SIGNER_NYM_ID, time64_t VALID_FROM, time64_t VALID_TO, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#acdcf4e8ee01eb5684ad276a9f2f96ad6">OT_API::Create_SmartContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>VALID_FROM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>VALID_TO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03408">3408</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pContract, <span class="stringliteral">&quot;OT_API::Create_SmartContract: ASSERT while trying to instantiate blank smart contract.\n&quot;</span>);
    <span class="comment">// --------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_cron_item.html#ab6f1e6febdeb0f6042d751503e648107">SetDateRange</a>(VALID_FROM,  VALID_TO))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::Create_SmartContract: Failed trying to set date range.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// -----------------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    <span class="comment">// -----------------------------------------------------</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a911f4791ccc4619dc5149e571d676867"></a><!-- doxytag: member="OT_API::createAssetAccount" ref="a911f4791ccc4619dc5149e571d676867" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a911f4791ccc4619dc5149e571d676867">OT_API::createAssetAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12154">12154</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::createAssetAccount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> *   pAssetContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(ASSET_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pAssetContract) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAssetContract is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAssetTypeID(ASSET_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;createAccount&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>         = strAssetTypeID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0de395c333a49913b59ae8cac223d526"></a><!-- doxytag: member="OT_API::CreateNym" ref="a0de395c333a49913b59ae8cac223d526" args="(int32_t nKeySize=1024, const std::string str_id_source=&quot;&quot;, const std::string str_alt_location=&quot;&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#a0de395c333a49913b59ae8cac223d526">OT_API::CreateNym</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>nKeySize</em> = <code>1024</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_id_source</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_alt_location</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01332">1332</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = __FUNCTION__;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">switch</span> (nKeySize)
    {
        <span class="keywordflow">case</span> 1024:
        <span class="keywordflow">case</span> 2048:
        <span class="keywordflow">case</span> 4096:
        <span class="keywordflow">case</span> 8192:
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: nKeySize must be one of: &quot;</span>
                          <span class="stringliteral">&quot;1024, 2048, 4096, 8192. (%d was passed...)\n&quot;</span>,
                          szFuncName, nKeySize);
            <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ---------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <span class="keyword">new</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
    <span class="comment">// ---------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7a215c63b72b47034e3f92e4334f44f6">GenerateNym</a>(nKeySize, <span class="keyword">true</span>, str_id_source, str_alt_location))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to generate Nym.\n&quot;</span>, szFuncName);
        <span class="keyword">delete</span> pNym; pNym = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ---------------------------</span>
    pWallet-&gt;<a class="code" href="class_o_t_wallet.html#acb570de733658a4ad24756dde0f22a34">AddNym</a>(*pNym); <span class="comment">// Add our new nym to the wallet, who &quot;owns&quot; it hereafter.</span>

    <span class="comment">// Note: It&#39;s already on the master key. To prevent that, we would have had</span>
    <span class="comment">// to PAUSE the master key before calling GenerateNym above. So the below call</span>
    <span class="comment">// is less about the Nym&#39;s encryption, and more about the wallet KNOWING. Because</span>
    <span class="comment">// OTWallet::ConvertNymToCachedKey is what adds this nym to the wallet&#39;s list of</span>
    <span class="comment">// &quot;master key nyms&quot;. Until that happens, the wallet has no idea.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a59daeb8ce8f92530c5ddb4fcd1dde7d4">ConvertNymToCachedKey</a>(*pNym))
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed in pWallet-&gt;ConvertNymToCachedKey \n&quot;</span>,
                      szFuncName);
    pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>(); <span class="comment">// Since it just changed.</span>
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// ---------------------------</span>
    <span class="keywordflow">return</span> pNym;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a85b0d012168cd75ed3aaebd08cba2dea"></a><!-- doxytag: member="OT_API::CreatePurse" ref="a85b0d012168cd75ed3aaebd08cba2dea" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID, const OTIdentifier &amp;OWNER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#a85b0d012168cd75ed3aaebd08cba2dea">OT_API::CreatePurse</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>OWNER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05170">5170</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_ID, OWNER_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pPurse, <span class="stringliteral">&quot;Error allocating memory in the OT API.&quot;</span>); <span class="comment">// responsible to delete or return pPurse below this point.</span>

    <span class="keywordflow">return</span> pPurse;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0f580137479e85f755aadbecc85f84a0"></a><!-- doxytag: member="OT_API::CreatePurse_Passphrase" ref="a0f580137479e85f755aadbecc85f84a0" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#a0f580137479e85f755aadbecc85f84a0">OT_API::CreatePurse_Passphrase</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05193">5193</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pPurse, <span class="stringliteral">&quot;Error allocating memory in the OT API.&quot;</span>); <span class="comment">// responsible to delete or return pPurse below this point.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pPurse-&gt;<a class="code" href="class_o_t_purse.html#a2c89e783f9253e676ff2e25076265ea9">GenerateInternalKey</a>())
        <span class="keywordflow">return</span> pPurse;
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::CreatePurse_Passphrase: &quot;</span>
                     <span class="stringliteral">&quot;pPurse-&gt;GenerateInternalKey() returned false. (Failure.)\n&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">delete</span> pPurse; pPurse = NULL;
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a60e541e43d25106bee94688886d66dcb"></a><!-- doxytag: member="OT_API::createUserAccount" ref="a60e541e43d25106bee94688886d66dcb" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a60e541e43d25106bee94688886d66dcb">OT_API::createUserAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12884">12884</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::createUserAccount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int32_t nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afb333a78adbe626a0dc596eed05f63f2">OTClient::createUserAccount</a>, theMessage,
                                                     *pNym, *pServer,
                                                     NULL); <span class="comment">// NULL pAccount on this command.</span>
    <span class="keywordflow">if</span> (0 &lt; nReturnValue)
    {               
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::createUserAccount: Error in m_pClient-&gt;ProcessUserCommand() \n&quot;</span>);

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c5209f2f8ba1892edb5cf4614cd04a6"></a><!-- doxytag: member="OT_API::Decode" ref="a3c5209f2f8ba1892edb5cf4614cd04a6" args="(const OTString &amp;strEncoded, OTString &amp;strOutput, bool bLineBreaks=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a3c5209f2f8ba1892edb5cf4614cd04a6">OT_API::Decode</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strEncoded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bLineBreaks</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Decode an OT-encoded string (back to plaintext.) This will base64-decode, uncompress, and unpack an OT-encoded string. Returns the plaintext string, or NULL.</p>
<p>Decode an OT-encoded string (back to plaintext.)</p>
<p>const char * OT_API_Decode(const char * szEncoded);</p>
<p>This will base64-decode, uncompress, and unpack an OT-encoded string. Returns the plaintext string, or NULL.</p>
<p>Internally: <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascEncoded(szEncoded); <a class="el" href="class_o_t_string.html">OTString</a> strPlain(ascEncoded); // strPlain now contains the decoded plaintext string. return strPlain.Get(); // We return it. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02986">2986</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascArmor;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadedArmor = <a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">OTASCIIArmor::LoadFromString</a>(ascArmor, strEncoded); <span class="comment">// str_bookend=&quot;-----BEGIN&quot; by default</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bLoadedArmor || !ascArmor.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading string into OTASCIIArmor object:\n\n%s\n\n&quot;</span>,
                      __FUNCTION__, strEncoded.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccess = ascArmor.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strOutput, bLineBreaks);
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a864877a4f56fbbfee46ad8a650a1bb82"></a><!-- doxytag: member="OT_API::Decrypt" ref="a864877a4f56fbbfee46ad8a650a1bb82" args="(const OTIdentifier &amp;theRecipientNymID, const OTString &amp;strCiphertext, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a864877a4f56fbbfee46ad8a650a1bb82">OT_API::Decrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theRecipientNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strCiphertext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-DECRYPT an OT-encrypted string back to plaintext. Decrypts the base64-encoded ciphertext back into a normal string plaintext. Returns the plaintext string, or NULL.</p>
<p>OT-DECRYPT an OT-encrypted string back to plaintext.</p>
<p>const char * OT_API_Decrypt(const char * RECIPIENT_NYM_ID, const char * szCiphertext);</p>
<p>Decrypts the base64-encoded ciphertext back into a normal string plaintext. Returns the plaintext string, or NULL.</p>
<p>Internally the C++ code is: <a class="el" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope; // Here is the envelope object. (The ciphertext IS the data for an <a class="el" href="class_o_t_envelope.html">OTEnvelope</a>.) <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCiphertext(szCiphertext); // The base64-encoded ciphertext passed in. Next we'll try to attach it to envelope object... if (theEnvelope.SetAsciiArmoredData(ascCiphertext)) { // ...so that we can open it using the appropriate Nym, into a plain string object: <a class="el" href="class_o_t_string.html">OTString</a> strServerReply; // This will contain the output when we're done. const bool bOpened = // Now we try to decrypt: theEnvelope.Open(RECIPIENT_NYM, strServerReply); if (bOpened) { return strServerReply.Get(); } } </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03067">3067</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pRecipientNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theRecipientNymID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pRecipientNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>      theEnvelope;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascCiphertext;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadedArmor = <a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">OTASCIIArmor::LoadFromString</a>(ascCiphertext, strCiphertext); <span class="comment">// str_bookend=&quot;-----BEGIN&quot; by default</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bLoadedArmor || !ascCiphertext.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading string into OTASCIIArmor object:\n\n%s\n\n&quot;</span>,
                      __FUNCTION__, strCiphertext.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------</span>
    <span class="keywordflow">if</span> (theEnvelope.<a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(ascCiphertext))
    {
        strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
        <span class="keywordflow">return</span> theEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(*pRecipientNym, strOutput);
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a75dfa596de3c054af8a9ffb9c51748b0"></a><!-- doxytag: member="OT_API::deleteAssetAccount" ref="a75dfa596de3c054af8a9ffb9c51748b0" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a75dfa596de3c054af8a9ffb9c51748b0">OT_API::deleteAssetAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12206">12206</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::deleteAssetAccount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCOUNT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCOUNT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;deleteAssetAccount&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6d44f675aa0c8fb36f9d55dadba5efcc"></a><!-- doxytag: member="OT_API::deleteUserAccount" ref="a6d44f675aa0c8fb36f9d55dadba5efcc" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a6d44f675aa0c8fb36f9d55dadba5efcc">OT_API::deleteUserAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12918">12918</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::deleteUserAccount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int32_t nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a23b8e2415f87b591e674a206aabdd821">OTClient::deleteUserAccount</a>, theMessage,
                                                     *pNym, *pServer,
                                                     NULL); <span class="comment">// NULL pAccount on this command.</span>
    <span class="keywordflow">if</span> (0 &lt; nReturnValue) 
    {               
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deleteUserAccount command in OT_API::deleteUserAccount\n&quot;</span>);

    <span class="keywordflow">return</span> -1;

}
</pre></div>
</div>
</div>
<a class="anchor" id="a1216782dbd78afbf72e269e81c936c6b"></a><!-- doxytag: member="OT_API::depositCheque" ref="a1216782dbd78afbf72e269e81c936c6b" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, OTString &amp;THE_CHEQUE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a1216782dbd78afbf72e269e81c936c6b">OT_API::depositCheque</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CHEQUE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l09838">9838</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> CONTRACT_ID;
    <a class="code" href="class_o_t_string.html">OTString</a>     strContractID;
    CONTRACT_ID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    CONTRACT_ID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strContractID);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strDepositAcct(ACCT_ID);

    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque(SERVER_ID, CONTRACT_ID);

    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber);

    <span class="keywordflow">if</span> (!bGotTransNum)
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No transaction numbers were available. &quot;</span>
                       <span class="stringliteral">&quot;Try requesting the server for a new one.\n&quot;</span>, __FUNCTION__);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!theCheque.LoadContractFromString(THE_CHEQUE))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load cheque from string. Sorry. Contents:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theCheque.GetServerID() != SERVER_ID)
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strChequeServerID(theCheque.GetServerID());
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: ServerID on cheque (%s) doesn&#39;t match serverID where it&#39;s being deposited to (%s).&quot;</span>,
                       __FUNCTION__, strChequeServerID.Get(), strServerID.Get());
        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox = pAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);

        <span class="keywordflow">if</span> (NULL == pInbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed loading inbox for acct %s\n&quot;</span>, __FUNCTION__, strDepositAcct.Get());
            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// -----------------------------------------------------------------------------------</span>
        <span class="comment">// If bCancellingCheque==true, we&#39;re actually cancelling the cheque by &quot;depositing&quot;</span>
        <span class="comment">// it back into the same account it&#39;s drawn on.</span>
        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bCancellingCheque = <span class="keyword">false</span>;

        <span class="keywordflow">if</span> (theCheque.HasRemitter())
            bCancellingCheque = ( (theCheque.GetRemitterAcctID() == ACCT_ID) &amp;&amp;
                                  (theCheque.GetRemitterUserID() == USER_ID));
        <span class="keywordflow">else</span>
        {
            bCancellingCheque = ( (theCheque.GetSenderAcctID() == ACCT_ID) &amp;&amp;
                                  (theCheque.GetSenderUserID() == USER_ID));
            <span class="keywordflow">if</span> (bCancellingCheque)
                bCancellingCheque = theCheque.VerifySignature(*pNym);
        }
        <span class="comment">// -----------------------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (bCancellingCheque) <span class="comment">// By this point he&#39;s definitely TRYING to cancel the cheque.</span>
        {
            bCancellingCheque = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, theCheque.GetTransactionNum());

            <span class="comment">// If we TRIED to cancel the cheque (being in this block...) yet the signature fails</span>
            <span class="comment">// to verify, or the transaction number isn&#39;t even issued, then our attempt to cancel</span>
            <span class="comment">// the cheque is going to fail.</span>
            <span class="keywordflow">if</span> (!bCancellingCheque)
            {
                <span class="comment">// This is the &quot;tried and failed&quot; block.</span>
                <span class="comment">//</span>
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Cannot cancel this cheque. Either the signature fails to verify,\n&quot;</span>
                               <span class="stringliteral">&quot;or the transaction number is already closed out. (Failure.) Cheque contents:\n\n%s\n\n&quot;</span>,
                               __FUNCTION__, THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
                pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
                <span class="keywordflow">return</span> (-1);
            }
            <span class="comment">// Else we succeeded in verifying signature and issued num.</span>
            <span class="comment">// -----------------------------------------------------</span>
            <span class="comment">// Let&#39;s just make sure there isn&#39;t a chequeReceipt or voucherReceipt</span>
            <span class="comment">// already sitting in the inbox, for this same cheque.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pChequeReceipt = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#ac364836ff42d8a8d873050b86a72c7d9">GetChequeReceipt</a>(theCheque.GetTransactionNum());

            <span class="keywordflow">if</span> (NULL != pChequeReceipt) <span class="comment">// Hmm looks like there&#39;s ALREADY a chequeReceipt in the inbox (so we can&#39;t cancel it.)</span>
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Cannot cancel this cheque. There is already a %s for it in the inbox. &quot;</span>
                               <span class="stringliteral">&quot;(Failure.) Cheque contents:\n\n%s\n\n&quot;</span>, __FUNCTION__,
                               theCheque.HasRemitter() ? <span class="stringliteral">&quot;voucherReceipt&quot;</span> : <span class="stringliteral">&quot;chequeReceipt&quot;</span>,
                               THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
                pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
                <span class="keywordflow">return</span> (-1);
            }
        }
        <span class="comment">// ------------------------------------------</span>
        <span class="comment">// By this point, we&#39;re either NOT cancelling the cheque, or if we are, we&#39;ve already</span>
        <span class="comment">// verified the signature and transaction number on the cheque. (AND we&#39;ve already</span>
        <span class="comment">// verified that there aren&#39;t any chequeReceipts for this cheque, in the inbox.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bCancellingCheque &amp;&amp; !theCheque.HasRemitter())
        {
            theCheque.CancelCheque(); <span class="comment">// Sets the amount to zero.</span>
            <span class="comment">// ---------------------------------</span>
            theCheque.ReleaseSignatures(); <span class="comment">// Usually when you deposit a cheque, it&#39;s signed by someone else.</span>
            theCheque.SignContract(*pNym); <span class="comment">// But if we are CANCELING a cheque, that means we wrote that cheque</span>
            theCheque.SaveContract();      <span class="comment">// originally, so we are the original signer.</span>
        } <span class="comment">// cancelling cheque</span>
        <span class="comment">// ------------------------------------</span>
        <span class="comment">// Create a transaction</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ACCT_ID, SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>,
                                                                           lStoredTransactionNumber);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransactionAngel(pTransaction);

        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>);

        <a class="code" href="class_o_t_string.html">OTString</a> strNote(bCancellingCheque ? <span class="stringliteral">&quot;Cancel this cheque, please!&quot;</span> : <span class="stringliteral">&quot;Deposit this cheque, please!&quot;</span>); <span class="comment">// todo</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(strNote);

        <a class="code" href="class_o_t_string.html">OTString</a> strCheque(theCheque);  <span class="comment">// &lt;===== THE CHEQUE</span>

        <span class="comment">// Add the cheque string as the attachment on the transaction item.</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strCheque); <span class="comment">// The cheque is contained in the reference string.</span>

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// ---------------------------------------------</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

        <span class="keywordflow">if</span> (NULL == pOutbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::depositCheque: Failed loading outbox for acct %s\n&quot;</span>, strDepositAcct.Get());
            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// BALANCE AGREEMENT</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that twice.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(theCheque.GetAmount(), *pTransaction, *pNym, *pAccount, *pOutbox);

            <span class="keywordflow">if</span> (NULL != pBalanceItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
                pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
            <span class="comment">// else log</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// sign the transaction</span>
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// set up the ledger</span>
            <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ACCT_ID, SERVER_ID);
            theLedger.GenerateLedger(ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
            theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>
            theTransactionAngel.SetCleanupTargetPointer(NULL); <span class="comment">// No more need to cleanup pTransaction.</span>

            <span class="comment">// sign the ledger</span>
            theLedger.SignContract(*pNym);
            theLedger.SaveContract();

            <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
            <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

            <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
            pNym-&gt;GetCurrentRequestNum(strServerID, lRequestNumber);
            theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
            pNym-&gt;IncrementRequestNum(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

            <span class="comment">// (1) Set up member variables</span>
            theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
            theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
            theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
            theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

            theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strDepositAcct;
            theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
            <span class="keyword">const</span> std::string str_server(strServerID.Get());
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;GetNymboxHash(str_server, NYMBOX_HASH);
            NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

            <span class="keywordflow">if</span> (!bNymboxHash)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                              str_server.c_str());

            <span class="comment">// (2) Sign the Message</span>
            theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

            <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
            theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// (Send it)</span>
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

            <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
        }
    } <span class="comment">// bSuccess</span>

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b11c8f60024b34f43c9a9132fe8ac65"></a><!-- doxytag: member="OT_API::depositPaymentPlan" ref="a4b11c8f60024b34f43c9a9132fe8ac65" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTString &amp;THE_PAYMENT_PLAN)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a4b11c8f60024b34f43c9a9132fe8ac65">OT_API::depositPaymentPlan</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PAYMENT_PLAN</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l10086">10086</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   thePlan;
    <a class="code" href="class_o_t_message.html">OTMessage</a>       theMessage;
    int64_t         lRequestNumber = 0;

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">if</span> (thePlan.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(THE_PAYMENT_PLAN) &amp;&amp;
        thePlan.<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pNym))
    {
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bCancelling = (thePlan.<a class="code" href="class_o_t_agreement.html#a87e9b6e7028af7ddfebaee86925e8e7b">GetRecipientUserID</a>() == USER_ID);

        <span class="keywordflow">if</span> (bCancelling)
        {
            <span class="keywordflow">if</span> (thePlan.<a class="code" href="class_o_t_cron_item.html#a78f165173c66d8de46fc0a1aebeee629">IsCanceled</a>())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: attempted to cancel (pre-emptively, before activation) a payment plan &quot;</span>
                              <span class="stringliteral">&quot;that was already set as canceled.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> (-1);
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!thePlan.<a class="code" href="class_o_t_cron_item.html#ad5f37660feb3396c382a5ec5987981c7">CancelBeforeActivation</a>(*pNym)) <span class="comment">// releases signatures, signs, saves.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: attempted to cancel (pre-emptively, before activation) a payment plan, &quot;</span>
                              <span class="stringliteral">&quot;but the attempt somehow failed.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> (-1);
            }
        }

        <span class="comment">// The logic for DEPOSITOR_ACCT_ID comes about because normally the sender is the one</span>
        <span class="comment">// who activates the payment plan. BUT the recipient might ALSO activate it as a way</span>
        <span class="comment">// of CANCELLING it. So we check to see if the recipient user is the same as USER_ID.</span>
        <span class="comment">// If so, then we use the RECIPIENT account here (it&#39;s being cancelled.) Otherwise,</span>
        <span class="comment">// we use the sender account ID here as normal (it&#39;s being activated.)</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  DEPOSITOR_ACCT_ID(bCancelling ? thePlan.<a class="code" href="class_o_t_agreement.html#a66300d99a12d32b6825e7e11dfca8614">GetRecipientAcctID</a>() : thePlan.<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>());
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strDepositAcct(DEPOSITOR_ACCT_ID);
        <span class="comment">// -----------------------------------------------------</span>
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, DEPOSITOR_ACCT_ID, SERVER_ID, __FUNCTION__);
        <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
        <span class="comment">// By this point, pAccount is a good pointer and in the wallet.</span>
        <span class="comment">// (No need to cleanup.) I also know it has the right Server ID</span>
        <span class="comment">// and that the Nym owns it, and has signed it, etc.</span>
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// If the depositor is the recipient, then it&#39;s not properly confirmed yet, and he&#39;s</span>
        <span class="comment">// actually cancelling it here. The transaction number on the plan will still be set to 0.</span>
        <span class="comment">// Therefore he needs to use a fresh transaction number to perform this action.</span>
        <span class="comment">// Otherwise, if the depositor is the sender (as should normally be) then the plan is</span>
        <span class="comment">// actually being activated, and has already been properly confirmed, and will thus</span>
        <span class="comment">// already have its own transaction number set on it.</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> int64_t lTransactionNum = thePlan.<a class="code" href="class_o_t_agreement.html#a809937fd06b26ff5791094592be68b0d">GetOpeningNumber</a>(USER_ID);
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// Create a transaction</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, DEPOSITOR_ACCT_ID, SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>, lTransactionNum);
        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">OTItem::paymentPlan</a>);

        <a class="code" href="class_o_t_string.html">OTString</a> strPlan(thePlan);

        <span class="comment">// Add the payment plan string as the attachment on the transaction item.</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strPlan); <span class="comment">// The payment plan is contained in the reference string.</span>

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>

        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// TRANSACTION AGREEMENT</span>

        <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pStatementItem = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab592ef450504c5af83b84d8a15ef02ea">GenerateTransactionStatement</a>(*pTransaction);

        <span class="keywordflow">if</span> (NULL != pStatementItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pStatementItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, DEPOSITOR_ACCT_ID, SERVER_ID);
        theLedger.GenerateLedger(DEPOSITOR_ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>

        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();

        <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strDepositAcct;
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                          str_server.c_str());

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);   

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    } <span class="comment">// thePlan.LoadContractFromString()</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load payment plan from string, or verify it. Sorry.\n&quot;</span>);
    }

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8e1fde16ebe39537f28c737844d09d1f"></a><!-- doxytag: member="OT_API::DiscardCheque" ref="a8e1fde16ebe39537f28c737844d09d1f" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, OTString &amp;THE_CHEQUE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a8e1fde16ebe39537f28c737844d09d1f">OT_API::DiscardCheque</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CHEQUE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l09766">9766</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    CONTRACT_ID;
    <a class="code" href="class_o_t_string.html">OTString</a>        strContractID;

    CONTRACT_ID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    CONTRACT_ID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strContractID);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)  pServer and pAccount are also good.</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque(SERVER_ID, CONTRACT_ID);

    <span class="keywordflow">if</span> (!theCheque.LoadContractFromString(THE_CHEQUE))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load cheque from string. Sorry. Cheque contents:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((theCheque.GetServerID()     == SERVER_ID)   &amp;&amp;
             (theCheque.GetAssetID()      == CONTRACT_ID) &amp;&amp;
             (theCheque.GetSenderUserID() == USER_ID)     &amp;&amp;
             (theCheque.GetSenderAcctID() == ACCT_ID))
    {
        <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, theCheque.GetTransactionNum())) <span class="comment">// we only &quot;add it back&quot; if it was really there in the first place.</span>
        {
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, theCheque.<a class="code" href="class_o_t_pseudonym.html#aaeccb4cd9e65abe19f382faee5ad8fd1">GetTransactionNum</a>(), <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
        <span class="keywordflow">else</span> <span class="comment">// No point adding it back as available to use, if pNym doesn&#39;t even have it signed out!</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed attempt to claw back a transaction number that wasn&#39;t signed &quot;</span>
                           <span class="stringliteral">&quot;out to pNym in the first place. Cheque contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    } <span class="comment">// bSuccess</span>
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to verify cheque&#39;s server ID, asset type ID, user ID, or acct ID. &quot;</span>
                       <span class="stringliteral">&quot;Sorry. Cheque contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, THE_CHEQUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acbc0834e9b4c4f995114e62436e54fea"></a><!-- doxytag: member="OT_API::DoesBoxReceiptExist" ref="acbc0834e9b4c4f995114e62436e54fea" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#acbc0834e9b4c4f995114e62436e54fea">OT_API::DoesBoxReceiptExist</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12261">12261</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
            <span class="comment">//static</span>
    <span class="keywordflow">return</span>  <a class="code" href="class_o_t_transaction.html#acf756f8e3b1d1b9f1e9d2bcb48cbe927">OTTransaction::VerifyBoxReceiptExists</a>(SERVER_ID,
                                                  USER_ID,      <span class="comment">// Unused here for now, but still convention.</span>
                                                  ACCOUNT_ID,   <span class="comment">// If for Nymbox (vs inbox/outbox) then pass USER_ID in this field also.</span>
                                                  nBoxType,     <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
                                                  lTransactionNum);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8f2b202917e923bfe9eeacd152493401"></a><!-- doxytag: member="OT_API::Encode" ref="a8f2b202917e923bfe9eeacd152493401" args="(const OTString &amp;strPlaintext, OTString &amp;strOutput, bool bLineBreaks=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a8f2b202917e923bfe9eeacd152493401">OT_API::Encode</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPlaintext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bLineBreaks</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-encode a plaintext string. This will pack, compress, and base64-encode a plain string. Returns the base64-encoded string, or NULL.</p>
<p>OT-encode a plaintext string.</p>
<p>const char * OT_API_Encode(const char * szPlaintext);</p>
<p>This will pack, compress, and base64-encode a plain string. Returns the base64-encoded string, or NULL.</p>
<p>Internally: <a class="el" href="class_o_t_string.html">OTString</a> strPlain(szPlaintext); <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascEncoded(thePlaintext); // ascEncoded now contains the OT-encoded string. return ascEncoded.Get(); // We return it. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02957">2957</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascArmor;
    <span class="keywordtype">bool</span> bSuccess = ascArmor.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strPlaintext, bLineBreaks); <span class="comment">// encodes.</span>

    <span class="keywordflow">if</span> (bSuccess)
    {
        strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
        bSuccess = ascArmor.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strOutput,
                                               <span class="stringliteral">&quot;ENCODED TEXT&quot;</span> <span class="comment">// -----BEGIN OT ENCODED TEXT-----</span>
                                               ); <span class="comment">// (bool bEscaped=false by default.)</span>
    }
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0fba0e8b0dbbe6a77bc443a6d99fa06"></a><!-- doxytag: member="OT_API::Encrypt" ref="aa0fba0e8b0dbbe6a77bc443a6d99fa06" args="(const OTIdentifier &amp;theRecipientNymID, const OTString &amp;strPlaintext, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aa0fba0e8b0dbbe6a77bc443a6d99fa06">OT_API::Encrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theRecipientNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPlaintext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-ENCRYPT a plaintext string. This will encode, ENCRYPT, and encode a plain string. Returns the base64-encoded ciphertext, or NULL.</p>
<p>OT-ENCRYPT a plaintext string.</p>
<p>const char * OT_API_Encrypt(const char * RECIPIENT_NYM_ID, const char * szPlaintext);</p>
<p>This will encode, ENCRYPT, and encode a plain string. Returns the base64-encoded ciphertext, or NULL.</p>
<p>Internally the C++ code is: <a class="el" href="class_o_t_string.html">OTString</a> strPlain(szPlaintext); <a class="el" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope; if (theEnvelope.Seal(RECIPIENT_NYM, strPlain)) { // Now it's encrypted (in binary form, inside the envelope), to the recipient's nym. <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCiphertext(theEnvelope); // ascCiphertext now contains the base64-encoded ciphertext (as a string.) return ascCiphertext.Get(); } </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03022">3022</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::Encrypt&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pRecipientNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(theRecipientNymID, <span class="keyword">false</span>, szFuncName, &amp;thePWData); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pRecipientNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>      theEnvelope;
    <span class="keywordtype">bool</span> bSuccess = theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pRecipientNym, strPlaintext);

    <span class="keywordflow">if</span> (bSuccess)
    {
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCiphertext(theEnvelope);
        strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();

        bSuccess = ascCiphertext.WriteArmoredString(strOutput,
                                                    <span class="stringliteral">&quot;ENCRYPTED TEXT&quot;</span> <span class="comment">// -----BEGIN OT ENCRYPTED TEXT-----</span>
                                                    ); <span class="comment">// (bool bEscaped=false by default.)</span>
    }
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aac6fa94e53c2fd89cd398965282be272"></a><!-- doxytag: member="OT_API::exchangeBasket" ref="aac6fa94e53c2fd89cd398965282be272" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;BASKET_ASSET_ID, OTString &amp;BASKET_INFO, const bool bExchangeInOrOut)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#aac6fa94e53c2fd89cd398965282be272">OT_API::exchangeBasket</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_INFO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bExchangeInOrOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08522">8522</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::exchangeBasket&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pContract is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strUserID(USER_ID);

    <span class="comment">// Next load the OTBasket object out of that contract, and load the RequestBasket object that was passed in.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket, theRequestBasket;

    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()  &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()) &amp;&amp;
        BASKET_INFO.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()                 &amp;&amp; theRequestBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(BASKET_INFO))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; BASKET_ASSET_ACCT_ID(theRequestBasket.<a class="code" href="class_o_t_basket.html#ab555be54ac5511072afefe94ee15105a">GetRequestAccountID</a>());
        <span class="comment">// -------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, BASKET_ASSET_ACCT_ID, SERVER_ID, szFuncName);
        <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);

        <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// We need a transaction number just to send this thing. Plus, we need a number for</span>
        <span class="comment">// each sub-account to the basket, as well as the basket&#39;s main account.</span>
        <span class="comment">// That is: 1 + theBasket.Count() + 1</span>
        <span class="comment">// Total of 2, since theBasket.Count() worth of numbers were already added in the</span>
        <span class="comment">// calls to OT_API::AddBasketExchangeItem.</span>

        <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(SERVER_ID) &lt; 2)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::exchangeBasket: you don&#39;t have enough transaction numbers to perform the exchange.\n&quot;</span>);
        }
        <span class="keywordflow">else</span>
        {
            int64_t lStoredTransactionNumber=0;
            <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber); <span class="comment">// this saves</span>

            <span class="keywordflow">if</span> (bGotTransNum)
            {
                <span class="comment">// ----------------------------------------------------</span>
                <span class="comment">// LOAD the INBOX for the MAIN ACCOUNT</span>
                <span class="comment">//</span>
                <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pAccount-&gt;<a class="code" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a>(*pNym);
                <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a>(*pNym);

                <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
                <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

                <span class="keywordflow">if</span> (NULL == pInbox)
                {
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::exchangeBasket: Failed loading inbox!\n&quot;</span>);

                    <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox)
                {
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::exchangeBasket: Failed loading outbox!\n&quot;</span>);

                    <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
                }
                <span class="comment">// Set up the Request Basket! ------------------------------</span>
                <span class="keywordflow">else</span>
                {
                    <span class="comment">// Create a transaction</span>
                    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction =
                        <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, BASKET_ASSET_ACCT_ID, SERVER_ID,
                                                            <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>, lStoredTransactionNumber);

                    <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
                    <a class="code" href="class_o_t_item.html">OTItem</a> * pItem      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1332f32813f158436fd58abdddec855c">OTItem::exchangeBasket</a>);

                    <span class="comment">// This pItem is where the Basket Info will be stored. (So it ends up on receipts...)</span>
                    pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>

                    <span class="comment">// --------------------------------------------------</span>
                    <span class="comment">// NOTE: I&#39;m not checking this call for success...</span>
                    <span class="comment">// But, I DID check the count beforehand, and I know there are enough numbers.</span>
                    <span class="comment">//</span>
                    int64_t lClosingTransactionNo = 0; <span class="comment">// for Main Basket Acct on the Request Basket.</span>
                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lClosingTransactionNo)); <span class="comment">// this saves</span>

                    <span class="comment">// This goes in the final API call.</span>
                    theRequestBasket.<a class="code" href="class_o_t_basket.html#aa7bc47e877c208f308f7fc476728cee8">SetClosingNum</a>(lClosingTransactionNo); <span class="comment">// For the basketReceipt (Closing Transaction Num) for main account.</span>
                    <span class="comment">// -----------------------------------------------------------</span>

                    <span class="comment">// This goes in the final API call.</span>
                    theRequestBasket.<a class="code" href="class_o_t_basket.html#a75757d74f9e52043611a7ac6bedcb362">SetExchangingIn</a>(bExchangeInOrOut);

                    <span class="comment">// -----------------------------------------------------------</span>
                    theRequestBasket.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
                    theRequestBasket.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
                    theRequestBasket.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                    <span class="comment">// Export the OTBasket object into a string, add it as</span>
                    <span class="comment">// a payload on my request, and send to server.</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strBasketInfo;
                    theRequestBasket.<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strBasketInfo);

                    <span class="comment">//***********************************************************************</span>

                    pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strBasketInfo);

                    <span class="comment">// sign the item. save it.</span>
                    <span class="comment">//</span>
                    pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
                    pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                    <span class="comment">//***********************************************************************</span>

                    <span class="comment">// ---------------------------------------------</span>
                    <span class="comment">// BALANCE AGREEMENT!</span>
                    <span class="comment">//</span>
                    <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
                    <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(0, <span class="comment">// Change in balance is 0. (The accounts will all be changed,</span>
                            *pTransaction, *pNym, *pAccount, *pOutbox);         <span class="comment">// but basketReceipts will be used to account for it.)</span>

                    <span class="keywordflow">if</span> (NULL != pBalanceItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
                        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
                    <span class="comment">// ---------------------------------------------</span>

                    <span class="comment">// sign the transaction</span>
                    pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
                    pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                    <span class="comment">// set up the ledger</span>
                    <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, BASKET_ASSET_ACCT_ID, SERVER_ID);
                    theLedger.GenerateLedger(BASKET_ASSET_ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
                    theLedger.AddTransaction(*pTransaction);

                    <span class="comment">// sign the ledger</span>
                    theLedger.SignContract(*pNym);
                    theLedger.SaveContract();

                    <span class="comment">// extract the ledger in ascii-armored form</span>
                    <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
                    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger; <span class="comment">// I can&#39;t pass strLedger into this constructor because I want to encode it</span>

                    <span class="comment">// Encoding...</span>
                    ascLedger.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strLedger);

                    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

                    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
                    int64_t lRequestNumber=0;
                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
                    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

                    <span class="comment">// (1) Set up member variables</span>
                    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
                    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strUserID;
                    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
                    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

                    BASKET_ASSET_ACCT_ID.GetString(theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>);
                    theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

                    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
                    <span class="keyword">const</span> std::string str_server(strServerID.Get());
                    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
                    NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

                    <span class="keywordflow">if</span> (!bNymboxHash)
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                                      str_server.c_str());

                    <span class="comment">// (2) Sign the Message</span>
                    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

                    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
                    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                    <span class="comment">// (Send it)</span>
                    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
                    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

                    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
                } <span class="comment">// Inbox loaded.</span>
            } <span class="comment">// successfully got first transaction number.</span>
        }
    }

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4decdc65f8b0a207a6057b86716e050a"></a><!-- doxytag: member="OT_API::FlatSign" ref="a4decdc65f8b0a207a6057b86716e050a" args="(const OTIdentifier &amp;theSignerNymID, const OTString &amp;strInput, const OTString &amp;strContractType, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a4decdc65f8b0a207a6057b86716e050a">OT_API::FlatSign</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strInput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strContractType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-Sign a piece of flat text. (With no discernible bookends around it.) strType contains the OT type. For example, if you are trying to sign a ledger (which does not have any existing signatures on it) then you would pass LEDGER for strType, resulting in -----BEGIN OT SIGNED LEDGER-----</p>
<p>OT-Sign a piece of flat text. (With no discernible bookends around it.) strContractType contains, for example, if you are trying to sign a ledger (which does not have any existing signatures on it) then you would pass LEDGER for strContractType, resulting in -----BEGIN OT SIGNED LEDGER----- </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03101">3101</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerNymID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!strInput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract passed in. (Returning false.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (!strContractType.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract type passed in. (Returning false.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strTemp(strInput);
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_contract.html#a00af7c67155cdb461866f6e705fde011">OTContract::SignFlatText</a>(strTemp, strContractType, *pNym, strOutput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae9f593a90e408ab34e92c25a4428bf8b"></a><!-- doxytag: member="OT_API::FlushMessageBuffer" ref="ae9f593a90e408ab34e92c25a4428bf8b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t___a_p_i.html#ae9f593a90e408ab34e92c25a4428bf8b">OT_API::FlushMessageBuffer</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07752">7752</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized &amp;&amp; (<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> != NULL), <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);

    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36e39a99ff4495af7c8766da81d7b29b">GetMessageBuffer</a>().<a class="code" href="class_o_t_message_buffer.html#ad65d140e16982e60267bdb06b6479678">Clear</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a02cca439067abd875c78ca7f732011"></a><!-- doxytag: member="OT_API::FlushSentMessages" ref="a9a02cca439067abd875c78ca7f732011" args="(const bool bHarvestingForRetry, const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, OTLedger &amp;THE_NYMBOX)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t___a_p_i.html#a9a02cca439067abd875c78ca7f732011">OT_API::FlushSentMessages</a> </td>
          <td>(</td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bHarvestingForRetry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NYMBOX</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07853">7853</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized &amp;&amp; (<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> != NULL), <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::FlushSentMessages&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(USER_ID, szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span>;
    <span class="comment">// Below this point, pNym is a good ptr, and will be cleaned up automatically.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> ((THE_NYMBOX.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()            != USER_ID) ||
        (THE_NYMBOX.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>() != SERVER_ID))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_NYMBOX);
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure, Bad input data: UserID (%s) or ServerID (%s) failed to match Nymbox:\n\n%s\n\n&quot;</span>,
                      szFuncName, strNymID.Get(), strServerID.Get(), strLedger.Get());
        <span class="keywordflow">return</span>;
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// Iterate through the nymbox receipts.</span>
    <span class="comment">// If ANY of them is a REPLY NOTICE, then see if the SENT MESSAGE for that SAME</span>
    <span class="comment">// request number is in the sent queue.</span>
    <span class="comment">// If it IS, REMOVE IT from the sent queue. (Since Nymbox clearly already contains</span>
    <span class="comment">// a reply to it, no need to queue it anymore.)</span>
    <span class="comment">// At the end of this loop, then FLUSH the sent queue. We KNOW only important</span>
    <span class="comment">// (nymbox related) messages should be queued there, and once we see the latest Nymbox,</span>
    <span class="comment">// then we KNOW which ones to remove before flushing.</span>
    <span class="comment">//</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, THE_NYMBOX.<a class="code" href="class_o_t_ledger.html#aa71b6540e2948a36e3c7d3e7d14547a5">GetTransactionMap</a>())
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        <span class="comment">// --------------------------------</span>

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        {
            <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a86b6fe9628f0b065e7f35dd68c02b3e6">GetMessageOutbuffer</a>().<a class="code" href="class_o_t_message_outbuffer.html#ad60d6fcacb284e4ab9a3acde35bfc796">GetSentMessage</a>(*pTransaction);

            <span class="keywordflow">if</span> (NULL != pMessage) <span class="comment">// It WAS there in my sent buffer!</span>
            {
                <span class="comment">// Since it IS in my Nymbox already as a replyNotice,</span>
                <span class="comment">// therefore I&#39;m safe to erase it from my sent queue.</span>
                <span class="comment">//</span>
                <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a86b6fe9628f0b065e7f35dd68c02b3e6">GetMessageOutbuffer</a>().<a class="code" href="class_o_t_message_outbuffer.html#aefe611bcb8fab3e6fe763bfb98ccf86a">RemoveSentMessage</a>(*pTransaction);
            }
            <span class="comment">// else do nothing, must have already removed it.</span>
        }
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// Now that we&#39;ve REMOVED the sent messages that already have a reply</span>
    <span class="comment">// in the Nymbox (and thus CLEARLY do not need harvesting...)</span>
    <span class="comment">//</span>
    <span class="comment">// Clear all &quot;sent message&quot; cached messages for this server and NymID.</span>
    <span class="comment">// (And harvest their transaction numbers back, since we know for a fact</span>
    <span class="comment">// the server hasn&#39;t replied to them (the reply would be in the Nymbox, which</span>
    <span class="comment">// we just got.)</span>
    <span class="comment">//</span>
    <span class="comment">// UPDATE: We will have to rely on the Developer using the OT API to call</span>
    <span class="comment">// OT_API_FlushSentMessages IMMEDIATELY after calling getNymbox and receiving</span>
    <span class="comment">// a successful reply. Why? Because that&#39;s the only way to give him the chance</span>
    <span class="comment">// to see if certain replies are there or not (before they get removed.) That way</span>
    <span class="comment">// he can do his own harvesting, do a re-try, etc and then finally when he is done</span>
    <span class="comment">// with that, do the flush.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a86b6fe9628f0b065e7f35dd68c02b3e6">GetMessageOutbuffer</a>().<a class="code" href="class_o_t_message_outbuffer.html#a4e5414cfda971df494246ac2bf35c70c">Clear</a>(&amp;strServerID, &amp;strNymID, pNym, &amp;bHarvestingForRetry); <span class="comment">// FYI: This HARVESTS any sent messages that need harvesting, before flushing them all.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="acd596ba47ce7c6e3f1035d91e6fdfbac"></a><!-- doxytag: member="OT_API::GenerateBasketCreation" ref="acd596ba47ce7c6e3f1035d91e6fdfbac" args="(const OTIdentifier &amp;USER_ID, const int64_t MINIMUM_TRANSFER)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_basket.html">OTBasket</a> * <a class="el" href="class_o_t___a_p_i.html#acd596ba47ce7c6e3f1035d91e6fdfbac">OT_API::GenerateBasketCreation</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>MINIMUM_TRANSFER</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08142">8142</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::GenerateBasketCreation&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    int64_t lMinimumTransferAmount = 10;

    <span class="keywordflow">if</span> (MINIMUM_TRANSFER &gt; 0)
        lMinimumTransferAmount = MINIMUM_TRANSFER;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> * pBasket = <span class="keyword">new</span> <a class="code" href="class_o_t_basket.html">OTBasket</a>(0, lMinimumTransferAmount);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pBasket, <span class="stringliteral">&quot;OT_API::GenerateBasketCreation: Error allocating memory in the OT API&quot;</span>);

    pBasket-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pBasket-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="keywordflow">return</span> pBasket;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a25e69e50ec485944c6031a5a9511e570"></a><!-- doxytag: member="OT_API::GenerateBasketExchange" ref="a25e69e50ec485944c6031a5a9511e570" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;BASKET_ASSET_TYPE_ID, const OTIdentifier &amp;BASKET_ASSET_ACCT_ID, const int32_t TRANSFER_MULTIPLE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_basket.html">OTBasket</a> * <a class="el" href="class_o_t___a_p_i.html#a25e69e50ec485944c6031a5a9511e570">OT_API::GenerateBasketExchange</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>TRANSFER_MULTIPLE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08263">8263</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{                                                                       <span class="comment">// 5=2,3,4  OR  10=4,6,8  OR 15=6,9,12</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::GenerateBasketExchange&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pContract is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, BASKET_ASSET_ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (BASKET_ASSET_TYPE_ID != pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>())
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(BASKET_ASSET_ACCT_ID), strAcctTypeID(BASKET_ASSET_TYPE_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::GenerateBasketExchange: Wrong asset type ID on account %s (expected type to be %s)\n&quot;</span>,
                       strAcctID.Get(), strAcctTypeID.Get());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// By this point, I know that everything checks out. Signature and Account ID.</span>
    <span class="comment">// pAccount is good, and no need to clean it up.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    int32_t nTransferMultiple = 1;

    <span class="keywordflow">if</span> (TRANSFER_MULTIPLE &gt; 0)
        nTransferMultiple = TRANSFER_MULTIPLE;
    <span class="comment">// -----------------------------------------------------------------</span>

    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;
    <a class="code" href="class_o_t_basket.html">OTBasket</a> * pRequestBasket = NULL;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure.</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
    {
        <span class="comment">// We need a transaction number just to send this thing. Plus, we need a number for</span>
        <span class="comment">// each sub-account to the basket, as well as the basket&#39;s main account.</span>
        <span class="comment">// That is: 1 + theBasket.Count() + 1</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(SERVER_ID) &lt; (2 + theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>()))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::GenerateBasketExchange: you don&#39;t have enough transaction numbers to perform the exchange.\n&quot;</span>);
        }
        <span class="keywordflow">else</span>
        {
            pRequestBasket = <span class="keyword">new</span> <a class="code" href="class_o_t_basket.html">OTBasket</a>(theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>(), theBasket.<a class="code" href="class_o_t_basket.html#a06047122ac95a121a90a34ea5cebb4b4">GetMinimumTransfer</a>());
            <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pRequestBasket, <span class="stringliteral">&quot;OT_API::GenerateBasketExchange: Error allocating memory in the OT API&quot;</span>);

            pRequestBasket-&gt;<a class="code" href="class_o_t_basket.html#a5096e84f09a66198309f5cffb959c594">SetTransferMultiple</a>(nTransferMultiple); <span class="comment">// This stays in this function.</span>

            <span class="comment">// Make sure the server knows where to put my new basket currency funds,</span>
            <span class="comment">// once the exchange is done.</span>
            pRequestBasket-&gt;<a class="code" href="class_o_t_basket.html#a9e03d1f4702fb061b315a4d96666850d">SetRequestAccountID</a>(BASKET_ASSET_ACCT_ID); <span class="comment">// This stays too</span>

            <span class="comment">// Export the OTBasket object into a string, add it as</span>
            <span class="comment">// a payload on my request, and send to server.</span>
            pRequestBasket-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pRequestBasket-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        } <span class="comment">// *pNym apparently has enough transaction numbers to exchange the basket.</span>
        <span class="comment">// ----------------------------------------------------------------</span>
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::GenerateBasketExchange: Error loading &quot;</span>
                      <span class="stringliteral">&quot;basket info from asset contract. &quot;</span>
                      <span class="stringliteral">&quot;Are you SURE this is a basket currency?\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">return</span> pRequestBasket;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a263e050929c3f000ce4172dfbc727149"></a><!-- doxytag: member="OT_API::GetAccount" ref="a263e050929c3f000ce4172dfbc727149" args="(int32_t iIndex, OTIdentifier &amp;THE_ID, OTString &amp;THE_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">OT_API::GetAccount</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01151">1151</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(iIndex, THE_ID, THE_NAME);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1591843600750cfacc015a9bbd12b26f"></a><!-- doxytag: member="OT_API::GetAccount" ref="a1591843600750cfacc015a9bbd12b26f" args="(const OTIdentifier &amp;THE_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_account.html">OTAccount</a> * <a class="el" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">OT_API::GetAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01247">1247</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetAccount&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
    {
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAcct = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(THE_ID);
        <span class="keywordflow">if</span> ((NULL == pAcct) &amp;&amp; (NULL != szFuncName)) <span class="comment">// We only log if the caller asked us to.</span>
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strID(THE_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::GetAccount %s: No account found in wallet with ID: %s\n&quot;</span>,
                           szFunc, strID.Get());
        }
        <span class="keywordflow">return</span> pAcct;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8d2a98f3ec41510173e91d2acb34b520"></a><!-- doxytag: member="OT_API::getAccount" ref="a8d2a98f3ec41510173e91d2acb34b520" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a8d2a98f3ec41510173e91d2acb34b520">OT_API::getAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12343">12343</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getAccount&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a318b1ae501a4ad2b99ce8ff036546e5e"></a><!-- doxytag: member="OT_API::GetAccountCount" ref="a318b1ae501a4ad2b99ce8ff036546e5e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">OT_API::GetAccountCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01105">1105</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ac41d592707a250be4b86d23b7a3ea552">GetAccountCount</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2df75f7a37f281e3bacfce2c0fa49a3e"></a><!-- doxytag: member="OT_API::getAccountFiles" ref="a2df75f7a37f281e3bacfce2c0fa49a3e" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a2df75f7a37f281e3bacfce2c0fa49a3e">OT_API::getAccountFiles</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12394">12394</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getAccountFiles&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a602b75fccd8b11b73508ce358a4594"></a><!-- doxytag: member="OT_API::GetAccountPartialMatch" ref="a7a602b75fccd8b11b73508ce358a4594" args="(const std::string PARTIAL_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_account.html">OTAccount</a> * <a class="el" href="class_o_t___a_p_i.html#a7a602b75fccd8b11b73508ce358a4594">OT_API::GetAccountPartialMatch</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>PARTIAL_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01311">1311</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetAccountPartialMatch&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>(PARTIAL_ID);

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aec51f205544c3c4a8acf95e1562292ba"></a><!-- doxytag: member="OT_API::GetAssetContractPartialMatch" ref="aec51f205544c3c4a8acf95e1562292ba" args="(const std::string PARTIAL_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> * <a class="el" href="class_o_t___a_p_i.html#aec51f205544c3c4a8acf95e1562292ba">OT_API::GetAssetContractPartialMatch</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>PARTIAL_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01298">1298</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetAssetContractPartialMatch&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>(PARTIAL_ID);

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a291b0f7c5298ceecc8d4aa929146d4db"></a><!-- doxytag: member="OT_API::GetAssetType" ref="a291b0f7c5298ceecc8d4aa929146d4db" args="(int32_t iIndex, OTIdentifier &amp;THE_ID, OTString &amp;THE_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">OT_API::GetAssetType</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01140">1140</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a5f328a7ca7030125cc121b5062e0627a">GetAssetType</a>(iIndex, THE_ID, THE_NAME);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac31d39fb3e703cebc6a9e2842593040f"></a><!-- doxytag: member="OT_API::GetAssetType" ref="ac31d39fb3e703cebc6a9e2842593040f" args="(const OTIdentifier &amp;THE_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> * <a class="el" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">OT_API::GetAssetType</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01226">1226</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetAssetType&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
    {
        <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(THE_ID);
        <span class="keywordflow">if</span> ((NULL == pContract) &amp;&amp; (NULL != szFuncName)) <span class="comment">// We only log if the caller asked us to.</span>
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strID(THE_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::GetAssetType %s: No asset contract found in wallet with ID: %s\n&quot;</span>,
                           szFunc, strID.Get());
        }
        <span class="keywordflow">return</span> pContract;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb9cb01e0d828ad885aa8da40b69ffb3"></a><!-- doxytag: member="OT_API::GetAssetTypeCount" ref="acb9cb01e0d828ad885aa8da40b69ffb3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#acb9cb01e0d828ad885aa8da40b69ffb3">OT_API::GetAssetTypeCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01094">1094</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a32deda2a4c48baf8e339796f65499f3e">GetAssetTypeCount</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af4747b3de4902f3217ab050bb041bc66"></a><!-- doxytag: member="OT_API::GetBasketMemberCount" ref="af4747b3de4902f3217ab050bb041bc66" args="(const OTIdentifier &amp;BASKET_ASSET_TYPE_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#af4747b3de4902f3217ab050bb041bc66">OT_API::GetBasketMemberCount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07989">7989</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> 0;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
        <span class="keywordflow">return</span> theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af5ceba4f208230dc9b077b37423e289f"></a><!-- doxytag: member="OT_API::GetBasketMemberMinimumTransferAmount" ref="af5ceba4f208230dc9b077b37423e289f" args="(const OTIdentifier &amp;BASKET_ASSET_TYPE_ID, const int32_t nIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t___a_p_i.html#af5ceba4f208230dc9b077b37423e289f">OT_API::GetBasketMemberMinimumTransferAmount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08064">8064</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::GetBasketMemberMinimumTransferAmount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> 0;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure.</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
    {
        <span class="keywordflow">if</span> ((nIndex &gt;= theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>()) || (nIndex &lt; 0))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::GetBasketMemberMinimumTransferAmount: Index out of bounds: %d\n&quot;</span>, nIndex);
            <span class="keywordflow">return</span> 0;
        }

        <a class="code" href="class_basket_item.html">BasketItem</a> * pItem = theBasket.<a class="code" href="class_o_t_basket.html#ae2fb9c4b001c2208bbe5b61cdd174da9">At</a>(nIndex);

        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pItem, <span class="stringliteral">&quot;Bad index in OT_API::GetBasketMemberMinimumTransferAmount.&quot;</span>);

        <span class="keywordflow">return</span> pItem-&gt;<a class="code" href="class_basket_item.html#a7a1360eb91fa3bced17ed6d097669c9a">lMinimumTransferAmount</a>;;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::GetBasketMemberMinimumTransferAmount: Failed loading basket info from basket asset contract.\n&quot;</span>);

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa51bdf044a89177e8bb1e0387e28a24a"></a><!-- doxytag: member="OT_API::GetBasketMemberType" ref="aa51bdf044a89177e8bb1e0387e28a24a" args="(const OTIdentifier &amp;BASKET_ASSET_TYPE_ID, const int32_t nIndex, OTIdentifier &amp;theOutputMemberType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aa51bdf044a89177e8bb1e0387e28a24a">OT_API::GetBasketMemberType</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutputMemberType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08019">8019</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::GetBasketMemberType&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure.</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
    {
        <span class="keywordflow">if</span> ((nIndex &gt;= theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>()) || (nIndex &lt; 0))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::GetBasketMemberType: Index out of bounds: %d\n&quot;</span>, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="class_basket_item.html">BasketItem</a> * pItem = theBasket.<a class="code" href="class_o_t_basket.html#ae2fb9c4b001c2208bbe5b61cdd174da9">At</a>(nIndex);
        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pItem, <span class="stringliteral">&quot;Bad index in OT_API::GetBasketMemberType&quot;</span>);

        theOutputMemberType = pItem-&gt;<a class="code" href="class_basket_item.html#a303fdc62c0271fc0d7ccaed05b1658cb">SUB_CONTRACT_ID</a>;

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aba4eb1e71d36b4ca4f077a90e3220ed5"></a><!-- doxytag: member="OT_API::GetBasketMinimumTransferAmount" ref="aba4eb1e71d36b4ca4f077a90e3220ed5" args="(const OTIdentifier &amp;BASKET_ASSET_TYPE_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t___a_p_i.html#aba4eb1e71d36b4ca4f077a90e3220ed5">OT_API::GetBasketMinimumTransferAmount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08108">8108</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::GetBasketMinimumTransferAmount&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> 0;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure.</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
        <span class="keywordflow">return</span> theBasket.<a class="code" href="class_o_t_basket.html#a06047122ac95a121a90a34ea5cebb4b4">GetMinimumTransfer</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0cec1627c8efa1c18cdace3894a916e1"></a><!-- doxytag: member="OT_API::getBoxReceipt" ref="a0cec1627c8efa1c18cdace3894a916e1" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a0cec1627c8efa1c18cdace3894a916e1">OT_API::getBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12278">12278</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getBoxReceipt&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = NULL;
    <span class="keywordflow">if</span> (USER_ID != ACCOUNT_ID) <span class="comment">// inbox/outbox (if it were nymbox, the USER_ID and ACCOUNT_ID would match)</span>
    {
        pAccount =  this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCOUNT_ID, SERVER_ID, szFuncName);
        <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// Note: pAccount could be NULL also, but this function doesn&#39;t actually use it anyway.</span>
    <span class="comment">// I just force it to load in order to keep things clean, since this is an API call. (I&#39;m</span>
    <span class="comment">// real strict on the API user, making him keep his nose clean.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCOUNT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getBoxReceipt&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;
    theMessage.<a class="code" href="class_o_t_message.html#a04ef2907cff33f832b438c93f17880b7">m_lDepth</a>             = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(nBoxType);
    theMessage.<a class="code" href="class_o_t_message.html#a2374c052c03bf1d4c7e7dd7555197ba4">m_lTransactionNum</a>    = lTransactionNum;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa9455394ab05c2013abd0c6249d8d619"></a><!-- doxytag: member="OT_API::GetClient" ref="aa9455394ab05c2013abd0c6249d8d619" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_client.html">OTClient</a>* <a class="el" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">OT_API::GetClient</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8hpp_source.html#l00278">278</a> of file <a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a5edd49c564ada6fb519882ad7a60bd8e"></a><!-- doxytag: member="OT_API::getContract" ref="a5edd49c564ada6fb519882ad7a60bd8e" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a5edd49c564ada6fb519882ad7a60bd8e">OT_API::getContract</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11925">11925</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getContract&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAssetTypeID(ASSET_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getContract&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>         = strAssetTypeID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8bc5ab412574867dd506207e311d0fa2"></a><!-- doxytag: member="OT_API::getInbox" ref="a8bc5ab412574867dd506207e311d0fa2" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a8bc5ab412574867dd506207e311d0fa2">OT_API::getInbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11524">11524</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getInbox&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a86ffb271aec1f5cdb211f3f1403cc910"></a><!-- doxytag: member="OT_API::getMarketList" ref="a86ffb271aec1f5cdb211f3f1403cc910" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a86ffb271aec1f5cdb211f3f1403cc910">OT_API::getMarketList</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>GET MARKET LIST</p>
<p>Connect to a specific server, as a specific Nym, and request the list of markets. (Flush the buffer before calling this. Then after you make this call, wait 50 ms and then pop the buffer and check the server reply for success. From there you can either read the reply data directly out of the reply message, or you can load it from storage (OT will probably auto-store the reply to storage, for your convenience.) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11090">11090</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getMarketList&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    int64_t lRequestNumber = 0;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID);

    <span class="comment">// (1) Set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getMarketList&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a32bf905befe6a9450b9293ed75ee1e3a"></a><!-- doxytag: member="OT_API::getMarketOffers" ref="a32bf905befe6a9450b9293ed75ee1e3a" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;MARKET_ID, const int64_t &amp;lDepth)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a32bf905befe6a9450b9293ed75ee1e3a">OT_API::getMarketOffers</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>MARKET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lDepth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>GET ALL THE OFFERS ON A SPECIFIC MARKET</p>
<p>A specific Nym is requesting the Server to send a list of the offers on a specific Market ID-- the bid/ask, and prices/amounts, basically--(up to lDepth or server Max) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11143">11143</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getMarketOffers&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strMarketID(MARKET_ID);

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    int64_t lRequestNumber = 0;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID);
    <span class="comment">// (1) Set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getMarketOffers&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strMarketID;
    theMessage.<a class="code" href="class_o_t_message.html#a04ef2907cff33f832b438c93f17880b7">m_lDepth</a>             = lDepth;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad4046209a1d0cb1792b23f71834a294e"></a><!-- doxytag: member="OT_API::getMarketRecentTrades" ref="ad4046209a1d0cb1792b23f71834a294e" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;MARKET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ad4046209a1d0cb1792b23f71834a294e">OT_API::getMarketRecentTrades</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>MARKET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>------------------------------------------------------- GET RECENT TRADES FOR A SPECIFIC MARKET ID</p>
<p>Most likely, ticker data will be made available through a separate ZMQ instance, which will use the publisher/subscriber model to distribute ticker data. From there, those privileged subscribers can distribute it via RSS, store it for future analysis, display charts, etc.</p>
<p>(So this function is not here to usurp that purpose.) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11201">11201</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strMarketID(MARKET_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    int64_t lRequestNumber = 0;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID);
    <span class="comment">// (1) Set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getMarketRecentTrades&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strMarketID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab8904b6f61d9c3c03acc6d5723458d86"></a><!-- doxytag: member="OT_API::getMint" ref="ab8904b6f61d9c3c03acc6d5723458d86" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ab8904b6f61d9c3c03acc6d5723458d86">OT_API::getMint</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11976">11976</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getMint&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> *   pAssetContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(ASSET_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pAssetContract) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAssetContract is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAssetTypeID(ASSET_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getMint&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>         = strAssetTypeID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08144e29a333dd0e1087c4655e6981ee"></a><!-- doxytag: member="OT_API::GetNym" ref="a08144e29a333dd0e1087c4655e6981ee" args="(int32_t iIndex, OTIdentifier &amp;NYM_ID, OTString &amp;NYM_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">OT_API::GetNym</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01118">1118</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a146e2339010f1e6b8b9cba252c8d3213">GetNym</a>(iIndex, NYM_ID, NYM_NAME);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bc096141864f38038f2860076d93f9e"></a><!-- doxytag: member="OT_API::GetNym" ref="a5bc096141864f38038f2860076d93f9e" args="(const OTIdentifier &amp;NYM_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">OT_API::GetNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01183">1183</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetNym&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
    {
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(NYM_ID);
        <span class="keywordflow">if</span> ((NULL == pNym) &amp;&amp; (NULL != szFuncName)) <span class="comment">// We only log if the caller asked us to.</span>
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strID(NYM_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::GetNym %s: No Nym found in wallet with ID: %s\n&quot;</span>,
                           szFunc, strID.Get());
        }
        <span class="keywordflow">return</span> pNym;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1e508b83332ea7707f74c91622105ea8"></a><!-- doxytag: member="OT_API::getNym_MarketOffers" ref="a1e508b83332ea7707f74c91622105ea8" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a1e508b83332ea7707f74c91622105ea8">OT_API::getNym_MarketOffers</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>------------------------------------------------------- GET ALL THE ACTIVE (in Cron) MARKET OFFERS FOR A SPECIFIC NYM. (ON A SPECIFIC SERVER, OBVIOUSLY.) Remember to use Flush/Call/Wait/Pop to check the server reply for success or fail. Hmm for size reasons, this really will have to return a list of transaction #s, and then I request them one-by-one after that... </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11256">11256</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    int64_t lRequestNumber = 0;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID);

    <span class="comment">// (1) Set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getNym_MarketOffers&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2536b41070f3a165345ae598381ddfdd"></a><!-- doxytag: member="OT_API::getNymbox" ref="a2536b41070f3a165345ae598381ddfdd" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a2536b41070f3a165345ae598381ddfdd">OT_API::getNymbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11479">11479</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getNymbox&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getNymbox&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0bdb71f4b4b19f8a49061cbc2d037c4"></a><!-- doxytag: member="OT_API::GetNymByIDPartialMatch" ref="aa0bdb71f4b4b19f8a49061cbc2d037c4" args="(const std::string PARTIAL_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#aa0bdb71f4b4b19f8a49061cbc2d037c4">OT_API::GetNymByIDPartialMatch</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>PARTIAL_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01272">1272</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetNymByIDPartialMatch&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>(PARTIAL_ID);

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a267d362ca74da9e01ab8e956da42b386"></a><!-- doxytag: member="OT_API::GetNymCount" ref="a267d362ca74da9e01ab8e956da42b386" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a267d362ca74da9e01ab8e956da42b386">OT_API::GetNymCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01072">1072</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad98f3386c700710d76e44580c59c505a">GetNymCount</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8523ebb8ba314f72c5f04951d9bd375f"></a><!-- doxytag: member="OT_API::getOffer_Trades" ref="a8523ebb8ba314f72c5f04951d9bd375f" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT int32_t <a class="el" href="class_o_t___a_p_i.html#a8523ebb8ba314f72c5f04951d9bd375f">OT_API::getOffer_Trades</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad125eb5eb9193091ac98cc9aee179e77"></a><!-- doxytag: member="OT_API::GetOrLoadAccount" ref="ad125eb5eb9193091ac98cc9aee179e77" args="(OTPseudonym &amp;theNym, const OTIdentifier &amp;ACCT_ID, const OTIdentifier &amp;SERVER_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_account.html">OTAccount</a> * <a class="el" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">OT_API::GetOrLoadAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tries to get the account from the wallet. Otherwise loads it from local storage. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04633">4633</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetOrLoadAccount (theNym)&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad3e876943833406d7819ce4c34b74647">GetOrLoadAccount</a>(theNym, ACCT_ID, SERVER_ID, szFunc); <span class="comment">// This logs plenty.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac9416e678013333f9d6e1612dcf0ffaa"></a><!-- doxytag: member="OT_API::GetOrLoadAccount" ref="ac9416e678013333f9d6e1612dcf0ffaa" args="(const OTIdentifier &amp;NYM_ID, const OTIdentifier &amp;ACCT_ID, const OTIdentifier &amp;SERVER_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_account.html">OTAccount</a> * <a class="el" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">OT_API::GetOrLoadAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tries to get the account from the wallet. Otherwise loads it from local storage. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04652">4652</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetOrLoadAccount (NYM_ID)&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, szFunc);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, szFunc); <span class="comment">// This logs plenty.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa09f3af30f4bc451d56c6948d536922f"></a><!-- doxytag: member="OT_API::GetOrLoadNym" ref="aa09f3af30f4bc451d56c6948d536922f" args="(const OTIdentifier &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, OTPasswordData *pPWData=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">OT_API::GetOrLoadNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bChecking</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *&#160;</td>
          <td class="paramname"><em>pPWData</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function tries to load as public Nym first, then if it fails, it tries the private one next. (So as to avoid unnecessarily asking users for their passphrase.) Be sure to use <a class="el" href="class_o_t___a_p_i.html#a0ecd26987ce0a3fd24c04b618bbbb293">GetOrLoadPublicNym()</a> or <a class="el" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym()</a> if you want to force it one way or the other.</p>
<p>No need to cleanup the Nym returned here, since it's added to the wallet and the wallet takes ownership. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04609">4609</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// This already logs copiously, including szFuncName...</span>
    <span class="comment">//</span>

    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);

    <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a97c9e8ef43e629dfad894e2c5fbc4073">GetOrLoadNym</a>(NYM_ID, bChecking, szFuncName, NULL == pPWData ? &amp;thePWData : pPWData);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa53f110b77dee2bc71b70906ca64fbbc"></a><!-- doxytag: member="OT_API::GetOrLoadPrivateNym" ref="aa53f110b77dee2bc71b70906ca64fbbc" args="(const OTIdentifier &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, OTPasswordData *pPWData=NULL, OTPassword *pImportPassword=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">OT_API::GetOrLoadPrivateNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bChecking</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *&#160;</td>
          <td class="paramname"><em>pPWData</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pImportPassword</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function only tries to load as a private Nym. No need to cleanup, since it adds the Nym to the wallet.</p>
<p>It is smart enough to Get the Nym from the wallet, and if it sees that it's only a public nym (no private key) then it reloads it as a private nym at that time. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04578">4578</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// This already logs copiously, including szFuncName...</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
    <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a7ca619a0f6ac4fa8f59efc1a518a297c">GetOrLoadPrivateNym</a>(NYM_ID, bChecking, szFuncName,
                                        NULL == pPWData ? &amp;thePWData : pPWData,
                                        pImportPassword);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ecd26987ce0a3fd24c04b618bbbb293"></a><!-- doxytag: member="OT_API::GetOrLoadPublicNym" ref="a0ecd26987ce0a3fd24c04b618bbbb293" args="(const OTIdentifier &amp;NYM_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#a0ecd26987ce0a3fd24c04b618bbbb293">OT_API::GetOrLoadPublicNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function only tries to load as a public Nym. No need to cleanup, since it adds the Nym to the wallet. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04556">4556</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// This already logs copiously, including szFuncName...</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad8d73d7ddef1194c1c24f173190da9f3">GetOrLoadPublicNym</a>(NYM_ID, szFuncName);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afca788fa27e0d4988a5c09586fe23237"></a><!-- doxytag: member="OT_API::getOutbox" ref="afca788fa27e0d4988a5c09586fe23237" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#afca788fa27e0d4988a5c09586fe23237">OT_API::getOutbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11576">11576</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;getOutbox&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1dfa9ba3149336b36e68662e86265b6e"></a><!-- doxytag: member="OT_API::getRequest" ref="a1dfa9ba3149336b36e68662e86265b6e" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a1dfa9ba3149336b36e68662e86265b6e">OT_API::getRequest</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12446">12446</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getRequest&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int32_t nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ad2b66c0cf1b0a4bc0d12ae557679c004">OTClient::getRequest</a>, theMessage,
                                                     *pNym, *pServer,
                                                     NULL); <span class="comment">// NULL pAccount on this command.</span>
    <span class="keywordflow">if</span> (0 &lt; nReturnValue) 
    {               
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing getRequest command in OT_API::getRequest\n&quot;</span>);

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23edd3f777f72244fa6281911d431e08"></a><!-- doxytag: member="OT_API::GetSentMessage" ref="a23edd3f777f72244fa6281911d431e08" args="(const int64_t &amp;lRequestNumber, const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_message.html">OTMessage</a> * <a class="el" href="class_o_t___a_p_i.html#a23edd3f777f72244fa6281911d431e08">OT_API::GetSentMessage</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07776">7776</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>( (m_bInitialized &amp;&amp; (<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> != NULL)) , <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>( lRequestNumber &gt; 0, <span class="stringliteral">&quot;OT_API::GetSentMessage: lRequestNumber is less than 1.&quot;</span>);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a86b6fe9628f0b065e7f35dd68c02b3e6">GetMessageOutbuffer</a>().<a class="code" href="class_o_t_message_outbuffer.html#ad60d6fcacb284e4ab9a3acde35bfc796">GetSentMessage</a>(lRequestNumber, strServerID, strNymID); <span class="comment">// doesn&#39;t delete.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="afa4e2d39d29061b609d81f094c2ca25c"></a><!-- doxytag: member="OT_API::GetServer" ref="afa4e2d39d29061b609d81f094c2ca25c" args="(int32_t iIndex, OTIdentifier &amp;THE_ID, OTString &amp;THE_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">OT_API::GetServer</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01129">1129</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aad6abb5e5fd19ffd69a9b6f0eb75f1c7">GetServer</a>(iIndex, THE_ID, THE_NAME);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb7f145e4c952265f06719ef525c3543"></a><!-- doxytag: member="OT_API::GetServer" ref="acb7f145e4c952265f06719ef525c3543" args="(const OTIdentifier &amp;THE_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_server_contract.html">OTServerContract</a> * <a class="el" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">OT_API::GetServer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01205">1205</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetServer&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
    {
        <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ae897619f652a0d3d9fba99a8bc747993">GetServerContract</a>(THE_ID);
        <span class="keywordflow">if</span> ((NULL == pContract) &amp;&amp; (NULL != szFuncName)) <span class="comment">// We only log if the caller asked us to.</span>
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strID(THE_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::GetServer %s: No server contract found in wallet with ID: %s\n&quot;</span>,
                           szFunc, strID.Get());
        }
        <span class="keywordflow">return</span> pContract;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a27228b655e5c661959812e3a2b7f144e"></a><!-- doxytag: member="OT_API::GetServerContractPartialMatch" ref="a27228b655e5c661959812e3a2b7f144e" args="(const std::string PARTIAL_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_server_contract.html">OTServerContract</a> * <a class="el" href="class_o_t___a_p_i.html#a27228b655e5c661959812e3a2b7f144e">OT_API::GetServerContractPartialMatch</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>PARTIAL_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01285">1285</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : <span class="stringliteral">&quot;OT_API::GetServerContractPartialMatch&quot;</span>;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFunc); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a2c08b5bd12930371f99e793762819dd5">GetServerContractPartialMatch</a>(PARTIAL_ID);

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0fad5fe7f5da3cac88b0794c705b1a9b"></a><!-- doxytag: member="OT_API::GetServerCount" ref="a0fad5fe7f5da3cac88b0794c705b1a9b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a0fad5fe7f5da3cac88b0794c705b1a9b">OT_API::GetServerCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01083">1083</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="comment">// -------------------------</span>
    <span class="keywordflow">if</span> (NULL != pWallet)
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4fe8fefbb7d541cab17d920259cd81b7">GetServerCount</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2ff83b1c64286eafdf7af6360e138d6e"></a><!-- doxytag: member="OT_API::GetTime" ref="a2ff83b1c64286eafdf7af6360e138d6e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="el" href="class_o_t___a_p_i.html#a2ff83b1c64286eafdf7af6360e138d6e">OT_API::GetTime</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>TIME (in seconds, as int64_t)</p>
<p>This will return the current time in seconds, as a int64_t int32_t.</p>
<p>Todo: consider making this available on the server side as well, so the smart contracts can see what time it is. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02936">2936</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd2344eb8007c310ada18aaafa70eb67"></a><!-- doxytag: member="OT_API::getTransactionNumber" ref="afd2344eb8007c310ada18aaafa70eb67" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#afd2344eb8007c310ada18aaafa70eb67">OT_API::getTransactionNumber</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08729">8729</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::getTransactionNumber&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="keyword">const</span> int32_t nCount    = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(SERVER_ID);
    <span class="keyword">const</span> int32_t nMaxCount = 50; <span class="comment">// todo no hardcoding. (max transaction nums allowed out at a single time.)</span>

    <span class="keywordflow">if</span> (nCount &gt; nMaxCount)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::getTransactionNumber: Failure: That Nym already has &quot;</span>
                      <span class="stringliteral">&quot;more than %d transaction numbers signed out. (Use those first.)\n&quot;</span>, nMaxCount);
        <span class="keywordflow">return</span> 0; <span class="comment">// Java code needs to know that no msg went out, BUT it&#39;s because we already have TOO</span>
        <span class="comment">// MANY numbers (i.e. &quot;a good reason.&quot;) This means &quot;process your Nymbox and grab your intermediary</span>
        <span class="comment">// files, and try again!&quot; So, we return 0 to indicate this.</span>
        <span class="comment">//</span>
<span class="comment">//      return (-1);</span>
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int32_t nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afd0f3ab4babfe3e62c93e6af743c3645">OTClient::getTransactionNum</a>, theMessage,
                                                     *pNym, *pServer,
                                                     NULL); <span class="comment">// NULL pAccount on this command.</span>
    <span class="keywordflow">if</span> (0 &lt; nReturnValue) 
    {               
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::getTransactionNumber: Error processing getTransactionNumber command. Return value: %d\n&quot;</span>,
                      nReturnValue);

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a86e129f94dfef872f8809ae9bb1bbb75"></a><!-- doxytag: member="OT_API::GetTransportCallback" ref="a86e129f94dfef872f8809ae9bb1bbb75" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_transport_callback.html">TransportCallback</a> * <a class="el" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">OT_API::GetTransportCallback</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00633">633</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NULL != this-&gt;m_pTransportCallback) { <span class="keywordflow">return</span> this-&gt;m_pTransportCallback; }
    <span class="keywordflow">else</span> { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af759173aae6f4592c3d6ef1f6a9aa4ff"></a><!-- doxytag: member="OT_API::GetWallet" ref="af759173aae6f4592c3d6ef1f6a9aa4ff" args="(const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_wallet.html">OTWallet</a> * <a class="el" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">OT_API::GetWallet</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01165">1165</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Any function that calls GetWallet() thus asserts here.</span>
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = (NULL != szFuncName) ? szFuncName : __FUNCTION__;
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>; <span class="comment">// This is where we &quot;get&quot; the wallet.  :P</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pWallet)
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s %s: -- The Wallet is not loaded.\n&quot;</span>,
                       __FUNCTION__, szFunc);
    <span class="keywordflow">return</span> pWallet;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e79ce6216fb40ef9c2f48615e72072a"></a><!-- doxytag: member="OT_API::GetWalletFilename" ref="a6e79ce6216fb40ef9c2f48615e72072a" args="(OTString &amp;strPath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a6e79ce6216fb40ef9c2f48615e72072a">OT_API::GetWalletFilename</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00622">622</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">if</span> (m_strWalletFilename.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) { strPath = m_strWalletFilename; <span class="keywordflow">return</span> <span class="keyword">true</span>; } <span class="keywordflow">else</span> { strPath.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;&quot;</span>); <span class="keywordflow">return</span> <span class="keyword">false</span>; } }
</pre></div>
</div>
</div>
<a class="anchor" id="a3455b2ed3c8b4abef30b1eaaafa595ab"></a><!-- doxytag: member="OT_API::HarvestAllNumbers" ref="a3455b2ed3c8b4abef30b1eaaafa595ab" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;NYM_ID, const OTString &amp;THE_CRON_ITEM)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a3455b2ed3c8b4abef30b1eaaafa595ab">OT_API::HarvestAllNumbers</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CRON_ITEM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04518">4518</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(THE_CRON_ITEM);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pCronItem)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading the cron item (a cron item is a smart contract, or &quot;</span>
                       <span class="stringliteral">&quot;some other recurring transaction such as a market offer, or a payment plan.) &quot;</span>
                       <span class="stringliteral">&quot;Contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, THE_CRON_ITEM.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pCronItem);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    pCronItem-&gt;<a class="code" href="class_o_t_cron_item.html#ab4adba19339e539c05bba94717c481cc">HarvestOpeningNumber</a> (*pNym); <span class="comment">// &lt;==== the Nym is actually harvesting the numbers from the Cron Item, and not the other way around.</span>
    pCronItem-&gt;<a class="code" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">HarvestClosingNumbers</a>(*pNym); <span class="comment">// &lt;==== the Nym is actually harvesting the numbers from the Cron Item, and not the other way around.</span>
    <span class="comment">// -------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a46beec5e1e260828865c4c03b71930ab"></a><!-- doxytag: member="OT_API::HarvestClosingNumbers" ref="a46beec5e1e260828865c4c03b71930ab" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;NYM_ID, const OTString &amp;THE_CRON_ITEM)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a46beec5e1e260828865c4c03b71930ab">OT_API::HarvestClosingNumbers</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CRON_ITEM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04481">4481</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(THE_CRON_ITEM);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pCronItem)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading the cron item (a cron item is a smart contract, or &quot;</span>
                       <span class="stringliteral">&quot;some other recurring transaction such as a market offer, or a payment plan.) Contents:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_CRON_ITEM.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pCronItem);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    pCronItem-&gt;<a class="code" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">HarvestClosingNumbers</a>(*pNym); <span class="comment">// &lt;==== the Nym is actually harvesting the numbers from the Cron Item, and not the other way around.</span>
    <span class="comment">// -------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a76e14d4a7826d39f55e0dcac022a8474"></a><!-- doxytag: member="OT_API::HaveAlreadySeenReply" ref="a76e14d4a7826d39f55e0dcac022a8474" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, const int64_t &amp;lRequestNumber)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a76e14d4a7826d39f55e0dcac022a8474">OT_API::HaveAlreadySeenReply</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNumber</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07929">7929</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::HaveAlreadySeenReply&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// &quot;Client verifies it has already seen a server reply.&quot;</span>
<span class="comment">//  bool OTPseudonym:::VerifyAcknowledgedNum(const OTString &amp; strServerID, const int64_t &amp; lRequestNum);</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    <span class="keywordflow">return</span> pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a11fd56ffbcef5fcebbd259bdb1bd7c8e">VerifyAcknowledgedNum</a>(strServerID, lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adc39b64382968c133c59fd7bf52124de"></a><!-- doxytag: member="OT_API::InitOTApp" ref="adc39b64382968c133c59fd7bf52124de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#adc39b64382968c133c59fd7bf52124de">OT_API::InitOTApp</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00232">232</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!OT_API::bCleanupOTApp);

    <span class="keywordflow">if</span> (!OT_API::bInitOTApp)
    {
        <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_log.html#a35ff36b83c644febc07a8a736c4ea9b5">OTLog::Init</a>(<span class="stringliteral">&quot;client&quot;</span>)) { assert(<span class="keyword">false</span>); }

        <span class="comment">// ------------------------------------</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nWelcome to Open Transactions -- version %s\n&quot;</span>,
            <a class="code" href="class_o_t_log.html#a3d4addadb76f6dec42a806cbc634ee0f">OTLog::Version</a>());

        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;(transport build: OTMessage -&gt; OTEnvelope -&gt; ZMQ )\n&quot;</span>);
        <span class="comment">// ------------------------------------</span>
<span class="preprocessor">#ifdef OT_ZMQ_2_MODE</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef _WIN32</span>
<span class="preprocessor"></span>        WSADATA wsaData;
        WORD wVersionRequested = MAKEWORD( 2, 2 );
        int32_t err = WSAStartup( wVersionRequested, &amp;wsaData );

        <span class="comment">/* Tell the user that we could not find a usable        */</span>
        <span class="comment">/* Winsock DLL.                                         */</span>

        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>((err == 0), <span class="stringliteral">&quot;WSAStartup failed!\n&quot;</span>);


        <span class="comment">/*  Confirm that the WinSock DLL supports 2.2.          */</span>
        <span class="comment">/*  Note that if the DLL supports versions greater      */</span>
        <span class="comment">/*  than 2.2 in addition to 2.2, it will still return   */</span>
        <span class="comment">/*  2.2 in wVersion since that is the version we        */</span>
        <span class="comment">/*  requested.                                          */</span>

        <span class="keywordtype">bool</span> bWinsock = (LOBYTE(wsaData.wVersion) != 2 || HIBYTE(wsaData.wVersion) != 2);

        <span class="comment">/* Tell the user that we could not find a usable */</span>
        <span class="comment">/* WinSock DLL.                                  */</span>

        <span class="keywordflow">if</span> (!bWinsock) WSACleanup();  <span class="comment">// do cleanup.</span>
        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>((!bWinsock), <span class="stringliteral">&quot;Could not find a usable version of Winsock.dll\n&quot;</span>);

        <span class="comment">/* The Winsock DLL is acceptable. Proceed to use it. */</span>
        <span class="comment">/* Add network programming using Winsock here */</span>
        <span class="comment">/* then call WSACleanup when done using the Winsock dll */</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;The Winsock 2.2 dll was found okay\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="comment">// ------------------------------------</span>
        <span class="comment">// SIGNALS</span>
        <span class="comment">//</span>
<span class="preprocessor">#if defined(OT_SIGNAL_HANDLING)</span>
<span class="preprocessor"></span>        <span class="comment">//</span>
        <a class="code" href="class_o_t_log.html#a3fb27300b83fb9ed8c7c96283ff55fa0">OTLog::SetupSignalHandler</a>();  <span class="comment">// &lt;===== SIGNALS</span>
        <span class="comment">//</span>
        <span class="comment">// This is optional! You can always remove it using the OT_NO_SIGNAL_HANDLING</span>
        <span class="comment">//  option, and plus, the internals only execute once anyway. (It keeps count.)</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="comment">// ------------------------------------</span>
        <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#ae83b19ae07a5a0ba00780cf031014fcc">Init</a>(); <span class="comment">// (OpenSSL gets initialized here.)</span>
        <span class="comment">// ------------------------------------</span>
        <span class="comment">// TODO in the case of Windows, figure err into this return val somehow.</span>
        <span class="comment">// (Or log it or something.)</span>
        <span class="comment">//</span>

        OT_API::bInitOTApp = <span class="keyword">true</span>;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: This function can only be called once.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1513a6077de1cdcd818ac9f480481ed8"></a><!-- doxytag: member="OT_API::IsBasketCurrency" ref="a1513a6077de1cdcd818ac9f480481ed8" args="(const OTIdentifier &amp;BASKET_ASSET_TYPE_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a1513a6077de1cdcd818ac9f480481ed8">OT_API::IsBasketCurrency</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_ASSET_TYPE_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07957">7957</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// There is an OT_ASSERT_MSG in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(BASKET_ASSET_TYPE_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// No need to cleanup pContract.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Next load the OTBasket object out of that contract.</span>
    <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;

    <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
    <span class="comment">// Can&#39;t never be too sure...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac30a534d3a53b5e4e8998a4dd1f325a9">GetBasketInfo</a>()))
    {
        <span class="keywordflow">if</span> (theBasket.<a class="code" href="class_o_t_basket.html#a8234fefd66082303036b655db2f3311d">Count</a>() &gt; 0)
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af11b60d083c4a8e1e68a59a0824899d4"></a><!-- doxytag: member="OT_API::IsInitialized" ref="af11b60d083c4a8e1e68a59a0824899d4" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT bool <a class="el" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">OT_API::IsInitialized</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8hpp_source.html#l00268">268</a> of file <a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_bInitialized; }
</pre></div>
</div>
</div>
<a class="anchor" id="a1124d87febc45eec06c1c9e8a2cc91da"></a><!-- doxytag: member="OT_API::IsNym_RegisteredAtServer" ref="a1124d87febc45eec06c1c9e8a2cc91da" args="(const OTIdentifier &amp;NYM_ID, const OTIdentifier &amp;SERVER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a1124d87febc45eec06c1c9e8a2cc91da">OT_API::IsNym_RegisteredAtServer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01452">1452</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(NYM_ID, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// Below this point, pNym is a good ptr, and will be cleaned up automatically.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    <span class="keywordflow">return</span> pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#af5e9078ab475e6cd9c53e4ad2fae0417">IsRegisteredAtServer</a>(strServerID);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ab12884841613694afed4593e780e5a"></a><!-- doxytag: member="OT_API::issueAssetType" ref="a8ab12884841613694afed4593e780e5a" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTString &amp;THE_CONTRACT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a8ab12884841613694afed4593e780e5a">OT_API::issueAssetType</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11808">11808</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::issueAssetType&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName);
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> (-1);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
<span class="comment">//  OTLog::vError(&quot;OT_API::issueAssetType: About to trim this contract:  **BEGIN:%s***END\n\n&quot;,</span>
<span class="comment">//               THE_CONTRACT.Get());</span>

    std::string str_Trim(THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
    <a class="code" href="class_o_t_string.html">OTString</a> strTrimContract(str_Trim2.c_str());
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> theAssetContract;

    <span class="keywordflow">if</span> (!theAssetContract.LoadContractFromString(strTrimContract))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load asset contract from string:\n\n%s\n\n&quot;</span>,
                       szFuncName, strTrimContract.Get());
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    newID;
        theAssetContract.CalculateContractID(newID);
        theAssetContract.SetIdentifier(newID); <span class="comment">// probably unnecessary</span>
        <span class="comment">// -----------------------</span>
        <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
        int64_t lRequestNumber = 0;

        <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;issueAssetType&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        newID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>);
        <a class="code" href="class_o_t_string.html">OTString</a> strAssetContract(theAssetContract);
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strAssetContract);

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        <span class="comment">// ------------------------------------</span>
        <span class="comment">// Save the contract to local storage and add to wallet.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strFilename;   <span class="comment">// In this case the filename isn&#39;t actually used, since SaveToContractFolder will</span>
        <span class="comment">// handle setting up the filename and overwrite it anyway. But I still prefer to set it</span>
        <span class="comment">// up correctly, rather than pass a blank. I&#39;m just funny like that.</span>
        strFilename = theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

        <a class="code" href="class_o_t_string.html">OTString</a> strFoldername(<a class="code" href="class_o_t_folders.html#ac8ac28307d688d0defee0fd7734be027">OTFolders::Contract</a>().Get());

        <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a>(theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>, strFoldername,
                                                          strFilename, theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pContract);

        <span class="comment">// Check the server signature on the contract here. (Perhaps the message is good enough?</span>
        <span class="comment">// After all, the message IS signed by the server and contains the Account.</span>
<span class="comment">//      if (pContract-&gt;LoadContract() &amp;&amp; pContract-&gt;VerifyContract())</span>
        <span class="keywordflow">if</span> (!pContract-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTrimContract))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed(2) trying to load asset contract from string:\n\n%s\n\n&quot;</span>,
                           szFuncName, strTrimContract.Get());
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pContract-&gt;<a class="code" href="class_o_t_contract.html#aa707f03da51449ef0cd1a466cbc0f13c">VerifyContract</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed verifying asset contract:\n\n%s\n\n&quot;</span>,
                           szFuncName, strTrimContract.Get());
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Next make sure the wallet has this contract on its list...</span>
            pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aec0dc4e66d6bc87cbec6fc4c0e3851f7">AddAssetContract</a>(*pContract); <span class="comment">// this saves both the contract and the wallet.</span>
            pContract = NULL; <span class="comment">// Success. The wallet &quot;owns&quot; it now, no need to clean it up.</span>
        }
        <span class="comment">// ------------------------------------------------</span>
        <span class="comment">// cleanup</span>
        <span class="keywordflow">if</span> (pContract)
        {
            <span class="keyword">delete</span> pContract;
            pContract = NULL;
        }
        <span class="comment">// ----------------------------</span>

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    }

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab691e0c2f1b8728b31babf07d958168a"></a><!-- doxytag: member="OT_API::issueBasket" ref="ab691e0c2f1b8728b31babf07d958168a" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTString &amp;BASKET_INFO)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ab691e0c2f1b8728b31babf07d958168a">OT_API::issueBasket</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BASKET_INFO</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08206">8206</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::issueBasket&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>    * pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="comment">// AT SOME POINT, BASKET_INFO has been populated with the relevant data. (see test client for example.)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) Set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;issueBasket&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(BASKET_INFO);

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="acadf476636347f6d2e748a3ac517c7c8"></a><!-- doxytag: member="OT_API::issueMarketOffer" ref="acadf476636347f6d2e748a3ac517c7c8" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ASSET_ACCT_ID, const OTIdentifier &amp;CURRENCY_ACCT_ID, const int64_t &amp;MARKET_SCALE, const int64_t &amp;MINIMUM_INCREMENT, const int64_t &amp;TOTAL_ASSETS_ON_OFFER, const int64_t &amp;PRICE_LIMIT, const bool bBuyingOrSelling, const time64_t tLifespanInSeconds=OT_TIME_DAY_IN_SECONDS, const char STOP_SIGN=0, const int64_t ACTIVATION_PRICE=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#acadf476636347f6d2e748a3ac517c7c8">OT_API::issueMarketOffer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>CURRENCY_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>MARKET_SCALE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>MINIMUM_INCREMENT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>TOTAL_ASSETS_ON_OFFER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>PRICE_LIMIT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bBuyingOrSelling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>tLifespanInSeconds</em> = <code><a class="el" href="_o_t_common_8hpp.html#ae431139997436f8522341a67e64d0d32">OT_TIME_DAY_IN_SECONDS</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>STOP_SIGN</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>ACTIVATION_PRICE</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l10778">10778</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAssetAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ASSET_ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAssetAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAssetAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pCurrencyAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, CURRENCY_ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pCurrencyAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pCurrencyAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; ASSET_TYPE_ID     = pAssetAccount   -&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; CURRENCY_TYPE_ID  = pCurrencyAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    <span class="comment">// ------------------------------------</span>
    <span class="keywordflow">if</span> (ASSET_TYPE_ID == CURRENCY_TYPE_ID)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: The asset account and currency account cannot have the same asset type ID. (You can&#39;t, for &quot;</span>
                       <span class="stringliteral">&quot;example, trade dollars against other dollars. Why bother trading them in the first place?)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a>       theMessage;
    int64_t            lRequestNumber = 0;
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strServerID(SERVER_ID),
                    strNymID   (USER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(strServerID) &lt; 3)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: At least 3 Transaction Numbers are necessary to issue a market offer. &quot;</span>
                       <span class="stringliteral">&quot;Try requesting the server for more (you are low.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// ------------------------------------</span>
    int64_t lStoredTransactionNumber=0, lAssetAcctClosingNo=0, lCurrencyAcctClosingNo=0;
    <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">false</span>);   <span class="comment">// bSave=false</span>
    <span class="keywordtype">bool</span> bGotAssetClosingNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lAssetAcctClosingNo, <span class="keyword">false</span>); <span class="comment">// bSave=false -- (true by default, FYI.)</span>
    <span class="keywordtype">bool</span> bGotCurrencyClosingNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lCurrencyAcctClosingNo, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    <span class="comment">// -------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bGotTransNum || !bGotAssetClosingNum || !bGotCurrencyClosingNum)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Supposedly there were 3 transaction numbers available, but the call(s)\n&quot;</span>
                      <span class="stringliteral">&quot;still failed. (Re-adding back to Nym, and failing out of this function.)\n&quot;</span>,
                      __FUNCTION__);
        <span class="comment">// ------------------------------------</span>
        <span class="keywordflow">if</span> (bGotTransNum)           pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">false</span>); <span class="comment">// bSave=true</span>
        <span class="keywordflow">if</span> (bGotAssetClosingNum)    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lAssetAcctClosingNo,      <span class="keyword">false</span>); <span class="comment">// bSave=true</span>
        <span class="keywordflow">if</span> (bGotCurrencyClosingNum) pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lCurrencyAcctClosingNo,   <span class="keyword">false</span>); <span class="comment">// bSave=true</span>
        <span class="comment">// ------------------------------------</span>
        <span class="keywordflow">if</span> (bGotTransNum || bGotAssetClosingNum || bGotCurrencyClosingNum)
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pNym);
    }
    <span class="comment">// -------------------------------------------------------------------</span>
    <span class="keywordflow">else</span>
    {
        <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_FROM = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a2ff83b1c64286eafdf7af6360e138d6e">GetTime</a>();      <span class="comment">// defaults to RIGHT NOW aka OT_API_GetTime() if set to 0 anyway.</span>
        <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_TO   = <a class="code" href="_o_t_common_8hpp.html#a38e4e4253c3dd158ea40e6312586e6c9">OTTimeAddTimeInterval</a>(VALID_FROM,          <span class="comment">// defaults to 24 hours (a &quot;Day Order&quot;) aka OT_API_GetTime() + 86,400</span>
                                                            <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> == tLifespanInSeconds ? <a class="code" href="_o_t_common_8hpp.html#ae431139997436f8522341a67e64d0d32">OT_TIME_DAY_IN_SECONDS</a> : tLifespanInSeconds));
        <span class="comment">// ------------------------------------</span>
        int64_t lTotalAssetsOnOffer = 1,
                lMinimumIncrement   = 1,
                lPriceLimit         = 0,  <span class="comment">// your price limit, per scale of assets.</span>
                lMarketScale        = 1,
                lActivationPrice    = 0;
        <span class="comment">// -------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (TOTAL_ASSETS_ON_OFFER &gt; 0) lTotalAssetsOnOffer = TOTAL_ASSETS_ON_OFFER; <span class="comment">// otherwise, defaults to 1.</span>
        <span class="keywordflow">if</span> (MARKET_SCALE          &gt; 0) lMarketScale        = MARKET_SCALE;          <span class="comment">// otherwise, defaults to 1.</span>
        <span class="keywordflow">if</span> (MINIMUM_INCREMENT     &gt; 0) lMinimumIncrement   = MINIMUM_INCREMENT;     <span class="comment">// otherwise, defaults to 1.</span>
        <span class="keywordflow">if</span> (PRICE_LIMIT           &gt; 0) lPriceLimit         = PRICE_LIMIT;           <span class="comment">// otherwise, defaults to 0. (0 Being a market order.)</span>
        <span class="comment">// ------------------------------------</span>
        <span class="keywordtype">char</span> cStopSign        = 0;

        <span class="keywordflow">if</span> (
            (ACTIVATION_PRICE &gt; 0) &amp;&amp;
            ((<span class="charliteral">&#39;&lt;&#39;</span> == STOP_SIGN) || (<span class="charliteral">&#39;&gt;&#39;</span> == STOP_SIGN))
        )
        {
            cStopSign        = STOP_SIGN;
            lActivationPrice = ACTIVATION_PRICE;
        }
        <span class="comment">// -------------------------------------------------------------------</span>
        lMinimumIncrement   *= lMarketScale;       <span class="comment">// minimum increment is PER SCALE.</span>
<span class="comment">//      lTotalAssetsOnOffer *= lMinimumIncrement;  // This was a bug. (Left as a warning.)</span>
        <span class="comment">// -------------------------------------------------------------------</span>

        <a class="code" href="class_o_t_string.html">OTString</a> strOfferType(<span class="stringliteral">&quot;market order&quot;</span>);

        <span class="keywordflow">if</span> (lPriceLimit &gt; 0)
            strOfferType = <span class="stringliteral">&quot;limit order&quot;</span>;

        <span class="keywordflow">if</span> (0 != cStopSign)
        {
            <span class="keywordflow">if</span> (lPriceLimit &gt; 0)
                strOfferType.Format(<span class="stringliteral">&quot;stop limit order, at threshhold: %c%ld&quot;</span>, cStopSign, lActivationPrice);
            <span class="keywordflow">else</span>
                strOfferType.Format(<span class="stringliteral">&quot;stop order, at threshhold: %c%ld&quot;</span>, cStopSign, lActivationPrice);
        }

        <a class="code" href="class_o_t_string.html">OTString</a> strPrice(<span class="stringliteral">&quot;&quot;</span>);

        <span class="keywordflow">if</span> (lPriceLimit &gt; 0)
            strPrice.Format(<span class="stringliteral">&quot;Price: %ld\n&quot;</span>, lPriceLimit);

        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Placing market offer %ld, type: %s, %s\n&quot;</span>
                       <span class="stringliteral">&quot;%s&quot;</span>
                       <span class="stringliteral">&quot;Assets for sale/purchase: %ld\n&quot;</span>
                       <span class="stringliteral">&quot;In minimum increments of: %ld\n&quot;</span>
                       <span class="stringliteral">&quot;At market of scale: %ld\n&quot;</span>
                       <span class="stringliteral">&quot;Valid From: %ld  To: %ld\n&quot;</span>,
                       lStoredTransactionNumber,
                       bBuyingOrSelling ? <span class="stringliteral">&quot;selling&quot;</span> : <span class="stringliteral">&quot;buying&quot;</span>, strOfferType.Get(),
                       strPrice.Get(),
                       lTotalAssetsOnOffer,
                       lMinimumIncrement,
                       lMarketScale,
                       <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(VALID_FROM),
                       <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(VALID_TO)
                       );

        <span class="comment">// -------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_offer.html">OTOffer</a> theOffer(SERVER_ID, ASSET_TYPE_ID, CURRENCY_TYPE_ID, lMarketScale);
        <span class="comment">// -------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_trade.html">OTTrade</a> theTrade(SERVER_ID,
                         ASSET_TYPE_ID, ASSET_ACCT_ID,
                         USER_ID,
                         CURRENCY_TYPE_ID, CURRENCY_ACCT_ID);
        <span class="comment">// -------------------------------------------------------------------</span>
        <span class="comment">// MAKE OFFER...</span>
        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bCreateOffer = theOffer.MakeOffer(bBuyingOrSelling,    <span class="comment">// True == SELLING, False == BUYING</span>
                                               lPriceLimit,         <span class="comment">// Per Minimum Increment...</span>
                                               lTotalAssetsOnOffer, <span class="comment">// Total assets available for sale or purchase.</span>
                                               lMinimumIncrement,   <span class="comment">// The minimum increment that must be bought or sold for each transaction</span>
                                               lStoredTransactionNumber, <span class="comment">// Transaction number matches on transaction, item, offer, and trade.</span>
                                               VALID_FROM,  <span class="comment">// defaults to RIGHT NOW aka OT_API_GetTime()</span>
                                               VALID_TO);   <span class="comment">// defaults to 24 hours (a &quot;Day Order&quot;) aka OT_API_GetTime() + 86,400</span>
        <span class="comment">// -------------------------------------------------------------------</span>
        <span class="comment">// ISSUE TRADE.</span>
        <span class="keywordtype">bool</span> bIssueTrade = <span class="keyword">false</span>;

        <span class="keywordflow">if</span> (bCreateOffer)
        {
            bCreateOffer =  theOffer.SignContract(*pNym);
            <span class="keywordflow">if</span> (bCreateOffer)
            {
                bCreateOffer = theOffer.SaveContract();
                <span class="keywordflow">if</span> (bCreateOffer)
                {
                    bIssueTrade = theTrade.IssueTrade(theOffer, cStopSign, lActivationPrice); <span class="comment">// &lt;==== ISSUE TRADE &lt;=====</span>
                    <span class="comment">// ******************************************************************************</span>
                    <span class="comment">// This is new: the closing transaction number is now used for CLOSING recurring</span>
                    <span class="comment">// cron items, like market offers and payment plans. It&#39;s also useful for baskets.</span>
                    <span class="comment">// Since this is a market offer, it needs a closing number (for later cancellation</span>
                    <span class="comment">// or expiration.)</span>
                    <span class="comment">// lAssetAcctClosingNo=0, lCurrencyAcctClosingNo=0;</span>
                    <span class="comment">//</span>
                    theTrade.AddClosingTransactionNo(lAssetAcctClosingNo);
                    theTrade.AddClosingTransactionNo(lCurrencyAcctClosingNo);

                    <span class="keywordflow">if</span> (bIssueTrade)
                    {
                        bIssueTrade =   theTrade.SignContract(*pNym);
                        <span class="keywordflow">if</span> (bIssueTrade)
                            bIssueTrade = theTrade.SaveContract();
                    } <span class="comment">// if ( bIssueTrade )</span>
                }
            }
        } <span class="comment">// if ( bCreateOffer )</span>
        <span class="comment">// -------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (bCreateOffer &amp;&amp; bIssueTrade)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> str_ASSET_ACCT_ID(ASSET_ACCT_ID);

            <span class="comment">// Create a transaction</span>
            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ASSET_ACCT_ID, SERVER_ID,
                                                                               <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>, lStoredTransactionNumber);

            <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae973afad2dc8a8349e8889304b20e73b">OTItem::marketOffer</a>,
                                                               (<a class="code" href="class_o_t_identifier.html">OTIdentifier</a> *)(&amp;CURRENCY_ACCT_ID));
            <span class="comment">// the &quot;To&quot; account (normally used for a TRANSFER transaction) is used here</span>
            <span class="comment">// storing the Currency Acct ID. The Server will expect the Trade object bundled</span>
            <span class="comment">// within this item to have an Asset Acct ID and &quot;Currency&quot; Acct ID that match</span>
            <span class="comment">// those on this Item. Otherwise it will reject the offer.</span>
            <span class="comment">//</span>
            <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pItem, <span class="stringliteral">&quot;OT_API::issueMarketOffer: Error allocating memory in the OT API&quot;</span>);

            <a class="code" href="class_o_t_string.html">OTString</a> strTrade;
            theTrade.SaveContractRaw(strTrade);

            <span class="comment">// Add the trade string as the attachment on the transaction item.</span>
            pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strTrade); <span class="comment">// The trade is contained in the attachment string. (The offer is within the trade.)</span>

            <span class="comment">// sign the item</span>
            pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// TRANSACTION AGREEMENT</span>

            <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pStatementItem = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab592ef450504c5af83b84d8a15ef02ea">GenerateTransactionStatement</a>(*pTransaction);

            <span class="keywordflow">if</span> (NULL != pStatementItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
                pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pStatementItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// sign the transaction</span>
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// set up the ledger</span>
            <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ASSET_ACCT_ID, SERVER_ID);
            theLedger.GenerateLedger(ASSET_ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
            theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>

            <span class="comment">// sign the ledger</span>
            theLedger.SignContract(*pNym);
            theLedger.SaveContract();

            <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
            <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

            <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
            theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

            <span class="comment">// (1) Set up member variables</span>
            theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
            theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
            theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
            theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

            theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = str_ASSET_ACCT_ID;
            theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
            <span class="keyword">const</span> std::string str_server(strServerID.Get());
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
            NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

            <span class="keywordflow">if</span> (!bNymboxHash)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                              __FUNCTION__, str_server.c_str());

            <span class="comment">// (2) Sign the Message</span>
            theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

            <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
            theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// (Send it)</span>
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

            <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);

        } <span class="comment">// if (bCreateOffer &amp;&amp; bIssueTrade)</span>
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to create offer or issue trade. Sorry.\n&quot;</span>,
                           __FUNCTION__);

            <span class="comment">// IF FAILED, add the transaction number (and closing number)</span>
            <span class="comment">// BACK to the list of available numbers.</span>
            <span class="comment">//</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber,   <span class="keyword">false</span>); <span class="comment">// bSave defaults to true</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lAssetAcctClosingNo,        <span class="keyword">false</span>);
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lCurrencyAcctClosingNo,     <span class="keyword">true</span> ); <span class="comment">// bSave=true (No sense saving thrice in a row.)</span>
        }
    } <span class="comment">// got transaction number.</span>

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad8538f636eb127ddcb4ca4a72ec7cc88"></a><!-- doxytag: member="OT_API::LoadAssetAccount" ref="ad8538f636eb127ddcb4ca4a72ec7cc88" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_account.html">OTAccount</a> * <a class="el" href="class_o_t___a_p_i.html#ad8538f636eb127ddcb4ca4a72ec7cc88">OT_API::LoadAssetAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06125">6125</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab7a6c57d91a0c93be57afe78c56e86a7">LoadAccount</a>(*pNym, ACCOUNT_ID, SERVER_ID, __FUNCTION__);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e0c39f51b0c700bfeb378d7ab868724"></a><!-- doxytag: member="OT_API::LoadAssetContract" ref="a9e0c39f51b0c700bfeb378d7ab868724" args="(const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_asset_contract.html">OTAssetContract</a> * <a class="el" href="class_o_t___a_p_i.html#a9e0c39f51b0c700bfeb378d7ab868724">OT_API::LoadAssetContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06079">6079</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(ASSET_ID);

    <a class="code" href="class_o_t_string.html">OTString</a> strFoldername  = <a class="code" href="class_o_t_folders.html#ac8ac28307d688d0defee0fd7734be027">OTFolders::Contract</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename    = strAssetTypeID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFoldername.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::LoadAssetContract: File does not exist: %s%s%s\n&quot;</span>,
                      strFoldername.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a>(strAssetTypeID, strFoldername,
                                                      strFilename, strAssetTypeID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pContract, <span class="stringliteral">&quot;Error allocating memory for Asset &quot;</span>
                  <span class="stringliteral">&quot;Contract in OT_API::LoadAssetContract\n&quot;</span>);

    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_contract.html#a1432a5e924d021a9dc39320d3b8e7b90">LoadContract</a>() &amp;&amp; pContract-&gt;<a class="code" href="class_o_t_contract.html#aa707f03da51449ef0cd1a466cbc0f13c">VerifyContract</a>())
        <span class="keywordflow">return</span> pContract;
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::LoadAssetContract: Unable to load or verify asset contract (Maybe it&#39;s just not there, and needs to &quot;</span>
                       <span class="stringliteral">&quot;be downloaded.) Asset ID: %s\n&quot;</span>, strAssetTypeID.Get());
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">delete</span> pContract;
    pContract = NULL;

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8de0d3d75ac1cbef23abdb746e9e2c61"></a><!-- doxytag: member="OT_API::LoadConfigFile" ref="a8de0d3d75ac1cbef23abdb746e9e2c61" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a8de0d3d75ac1cbef23abdb746e9e2c61">OT_API::LoadConfigFile</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00641">641</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::LoadConfigFile()&quot;</span>;

    <span class="comment">// Setup Config File</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath, strConfigFilename;


    <span class="keywordflow">if</span>(!<a class="code" href="class_o_t_data_folder.html#a624a126d059f0db031d894de786b4011">OTDataFolder::IsInitialized</a>()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }

    <span class="comment">// Create Config Object (OTSettings)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strConfigFilePath=<span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_data_folder.html#a03f3da5b6d8d7f3df43757c66cbb8693">OTDataFolder::GetConfigFilePath</a>(strConfigFilePath)) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <a class="code" href="class_o_t_settings.html">OTSettings</a> * p_Config = NULL;
    p_Config = <span class="keyword">new</span> <a class="code" href="class_o_t_settings.html">OTSettings</a>(strConfigFilePath);

    <span class="comment">// First Load, Create new fresh config file if failed loading.</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Load())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Note: Unable to Load Config. Creating a new file: %s\n&quot;</span>, szFunc, strConfigFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span> (!p_Config -&gt; Save() ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }


    <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="comment">// Second Load, Throw Assert if Failed loading.</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Load())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(0,<span class="stringliteral">&quot;%s: Error: Unable to load config file: %s It should exist, as we just saved it!\n&quot;</span>, szFunc, strConfigFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }


    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// LOG LEVEL</span>
    {
        <span class="keywordtype">bool</span> bIsNewKey;
        int64_t lValue;
        p_Config -&gt; CheckSet_long(<span class="stringliteral">&quot;logging&quot;</span>,<span class="stringliteral">&quot;log_level&quot;</span>,0,lValue,bIsNewKey);
        <a class="code" href="class_o_t_log.html#a42b7411eaf5734cc10825d53939f4a0d">OTLog::SetLogLevel</a>(static_cast&lt;int32_t&gt; (lValue));
    }

    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// WALLET</span>

    <span class="comment">// WALLET FILENAME</span>
    <span class="comment">//</span>
    <span class="comment">// Clean and Set</span>
    {
        <span class="keywordtype">bool</span> bIsNewKey;
        <a class="code" href="class_o_t_string.html">OTString</a> strValue;
        p_Config -&gt; CheckSet_str(<span class="stringliteral">&quot;wallet&quot;</span>,<span class="stringliteral">&quot;wallet_filename&quot;</span>,<a class="code" href="_open_transactions_8cpp.html#a0b134c6acd01ee1f9ed1fd48cd7c9511">CLIENT_WALLET_FILENAME</a>,strValue,bIsNewKey);
        <a class="code" href="class_o_t___a_p_i.html#a5eaacf363f5fb27e71c196cbb099cced">OT_API::SetWalletFilename</a>(strValue);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;Using Wallet: %s\n&quot;</span>,strValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    }

    <span class="comment">// -----------------------------------</span>
    <span class="comment">// LATENCY</span>
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span> * szComment =
            <span class="stringliteral">&quot;;; LATENCY:\n\n&quot;</span>
            <span class="stringliteral">&quot;;; For sending and receiving:\n&quot;</span>
            <span class="stringliteral">&quot;;; blocking=true (usually not recommended) means OT will hang on the send/receive\n&quot;</span>
            <span class="stringliteral">&quot;;; call, and wait indefinitely until the send or receive has actually occurred.\n&quot;</span>
            <span class="stringliteral">&quot;;; IF BLOCKING IS FALSE (normal, default):\n&quot;</span>
            <span class="stringliteral">&quot;;; - no_tries is the number of times OT will try to send or receive a message.\n&quot;</span>
            <span class="stringliteral">&quot;;; - ms is the number of milliseconds it will wait between each attempt.\n&quot;</span>
            <span class="stringliteral">&quot;;; UPDATE: send_ms and receive_ms now DOUBLE after each failed attempt! (up to 3 tries)\n&quot;</span>
            <span class="stringliteral">&quot;;; Meaning that after 3 tries, it&#39;s already waited over 21 seconds trying to get\n&quot;</span>
            <span class="stringliteral">&quot;;; the message. \n&quot;</span>
            <span class="stringliteral">&quot;;; send_delay_after happens after EVERY SINGLE server request/reply, which can be\n&quot;</span>
            <span class="stringliteral">&quot;;; multiple times per use case. (They can add up quick...)\n&quot;</span>;

        <span class="keywordtype">bool</span> b_SectionExist;
        p_Config-&gt;<a class="code" href="class_o_t_settings.html#a2d5bbcf1220477060e6d6d8e1db70859">CheckSetSection</a>(<span class="stringliteral">&quot;latency&quot;</span>, szComment, b_SectionExist);
    }


    {
        <span class="keywordflow">if</span> (NULL == m_pSocket) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

        <span class="keyword">const</span> <a class="code" href="class_o_t_socket_1_1_defaults.html">OTSocket::Defaults</a> socketDefaults(
            <a class="code" href="_open_transactions_8cpp.html#a290ff9c13a30b35f59668b82ca68d4e3">CLIENT_DEFAULT_LATENCY_SEND_MS</a>,
            <a class="code" href="_open_transactions_8cpp.html#a0a9667963ecd92a68b3b014f07083f0c">CLIENT_DEFAULT_LATENCY_SEND_NO_TRIES</a>,
            <a class="code" href="_open_transactions_8cpp.html#a260f7705019dbcde2805b187fc32c296">CLIENT_DEFAULT_LATENCY_RECEIVE_MS</a>,
            <a class="code" href="_open_transactions_8cpp.html#ac9f275dd072f7e6a8f3513667150a952">CLIENT_DEFAULT_LATENCY_RECEIVE_NO_TRIES</a>,
            <a class="code" href="_open_transactions_8cpp.html#a307024706ce20afb5f4626ea769e81d2">CLIENT_DEFAULT_LATENCY_DELAY_AFTER</a>,
            <a class="code" href="_open_transactions_8cpp.html#a8d9c01e8d496678f796ee06962de888c">CLIENT_DEFAULT_IS_BLOCKING</a>
            );


        m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#aac7b28cf63c959f95c3e47b8091b774f">Init</a>(socketDefaults, p_Config);  <span class="comment">// setup the socket.</span>
    }


    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// SECURITY (beginnings of..)</span>

    <span class="comment">// Master Key Timeout</span>
    {
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szComment =
        <span class="stringliteral">&quot;; master_key_timeout is how int64_t the master key will be in memory until a thread wipes it out.\n&quot;</span>
        <span class="stringliteral">&quot;; 0   : means you have to type your password EVERY time OT uses a private key. (Even multiple times in a single function.)\n&quot;</span>
        <span class="stringliteral">&quot;; 300 : means you only have to type it once per 5 minutes.\n&quot;</span>
        <span class="stringliteral">&quot;; -1  : means you only type it once PER RUN (popular for servers.)\n&quot;</span>;

        <span class="keywordtype">bool</span> bIsNewKey;
        int64_t lValue;
    p_Config -&gt; CheckSet_long(<span class="stringliteral">&quot;security&quot;</span>,<span class="stringliteral">&quot;master_key_timeout&quot;</span>,<a class="code" href="_open_transactions_8cpp.html#a6ca020e7a6f02c7a8d769e9fa32dcd01">CLIENT_MASTER_KEY_TIMEOUT_DEFAULT</a>,lValue,bIsNewKey,szComment);
    <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;SetTimeoutSeconds(static_cast&lt;int32_t&gt;(lValue));
    }

    <span class="comment">// Use System Keyring</span>
    {
    <span class="keywordtype">bool</span> bValue, bIsNewKey;
    p_Config -&gt; CheckSet_bool(<span class="stringliteral">&quot;security&quot;</span>,<span class="stringliteral">&quot;use_system_keyring&quot;</span>,<a class="code" href="_open_transactions_8cpp.html#af566d6ce4bb1ffea9f5a698fc199bbc2">CLIENT_USE_SYSTEM_KEYRING</a>,bValue,bIsNewKey);
    <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;UseSystemKeyring(bValue);
    }

    <span class="comment">// Use System Keyring</span>
    {
    <span class="keywordtype">bool</span> bValue, bIsNewKey;
    p_Config -&gt; CheckSet_bool(<span class="stringliteral">&quot;security&quot;</span>,<span class="stringliteral">&quot;use_system_keyring&quot;</span>,<a class="code" href="_open_transactions_8cpp.html#af566d6ce4bb1ffea9f5a698fc199bbc2">CLIENT_USE_SYSTEM_KEYRING</a>,bValue,bIsNewKey);
    <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;UseSystemKeyring(bValue);

<span class="preprocessor">#if defined(OT_KEYRING_FLATFILE)</span>
<span class="preprocessor"></span>        <span class="comment">// Is there a password folder? (There shouldn&#39;t be, but we allow it...)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bValue)
        {
            <span class="keywordtype">bool</span> bIsNewKey2;
            <a class="code" href="class_o_t_string.html">OTString</a> strValue;
            p_Config -&gt; CheckSet_str(<span class="stringliteral">&quot;security&quot;</span>,<span class="stringliteral">&quot;password_folder&quot;</span>,<a class="code" href="_open_transactions_8cpp.html#afa01c4388d318bdf43542fcbf23b0659">CLIENT_PASSWORD_FOLDER</a>,strValue,bIsNewKey2);
            <span class="keywordflow">if</span> (strValue.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            {
                OTKeyring::FlatFile_SetPasswordFolder(strValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot; **DANGEROUS!**  Using password folder: %s\n&quot;</span>,strValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            }
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }


    <span class="comment">// Done Loading... Lets save any changes...</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Save())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error! Unable to save updated Config!!!\n&quot;</span>,szFunc);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="comment">// Finsihed Saving... now lets cleanup!</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (NULL != p_Config) <span class="keyword">delete</span> p_Config;
    p_Config = NULL;

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae3d6ecd9fabfea445d35fd7307008856"></a><!-- doxytag: member="OT_API::LoadExpiredBox" ref="ae3d6ecd9fabfea445d35fd7307008856" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#ae3d6ecd9fabfea445d35fd7307008856">OT_API::LoadExpiredBox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06479">6479</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;

    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadExpiredBox: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoaded = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a752b0776eed42abe1a48754d288bd79e">LoadExpiredBox</a>();

    <span class="keywordtype">bool</span> bVerified = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (bLoaded)
        bVerified = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym);

    <span class="keywordflow">if</span> (bLoaded &amp;&amp; bVerified)
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7b9a649113879b83befa1d7acc00b79d"></a><!-- doxytag: member="OT_API::LoadExpiredBoxNoVerify" ref="a7b9a649113879b83befa1d7acc00b79d" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a7b9a649113879b83befa1d7acc00b79d">OT_API::LoadExpiredBoxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06516">6516</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadExpiredBoxNoVerify: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a752b0776eed42abe1a48754d288bd79e">LoadExpiredBox</a>()) <span class="comment">// The Verify would have gone here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a478f3f32e383e05a203807810bc94940"></a><!-- doxytag: member="OT_API::LoadInbox" ref="a478f3f32e383e05a203807810bc94940" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a478f3f32e383e05a203807810bc94940">OT_API::LoadInbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06212">6212</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadInbox: Error allocating memory in the OT API.&quot;</span>);

    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a>() &amp;&amp; pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::LoadInbox: Unable to load or verify inbox: %s\n For user: %s\n&quot;</span>,
                       strAcctID.Get(), strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a11a9479b4875de4377232237d3521690"></a><!-- doxytag: member="OT_API::LoadInboxNoVerify" ref="a11a9479b4875de4377232237d3521690" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a11a9479b4875de4377232237d3521690">OT_API::LoadInboxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06249">6249</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadInboxNoVerify: Error allocating memory in the OT API.&quot;</span>);

    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a>()) <span class="comment">// The Verify would go here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::LoadInboxNoVerify: Unable to load inbox: %s\n For user: %s\n&quot;</span>,
                       strAcctID.Get(), strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7ed4ec7967a76d735047e5bae1574bf5"></a><!-- doxytag: member="OT_API::LoadMint" ref="a7ed4ec7967a76d735047e5bae1574bf5" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_mint.html">OTMint</a> * <a class="el" href="class_o_t___a_p_i.html#a7ed4ec7967a76d735047e5bae1574bf5">OT_API::LoadMint</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06000">6000</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::LoadMint&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(ASSET_ID);
    <span class="comment">// -------------------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>    * pServerContract   = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFunc);
    <span class="keywordflow">if</span> (NULL == pServerContract) <span class="keywordflow">return</span> NULL;
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>   * pServerNym        = pServerContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
    <span class="keywordflow">if</span> (NULL == pServerNym)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to get contract public Nym for ServerID: %s \n&quot;</span>,
                      szFunc, strServerID.Get());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -------------------------------------------------------------</span>
    <a class="code" href="class_o_t_mint.html">OTMint</a> * pMint = <a class="code" href="class_o_t_mint.html#a2a0ecb9351ac2ce303e1b20ae523aabb">OTMint::MintFactory</a>(strServerID, strAssetTypeID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pMint, <span class="stringliteral">&quot;OT_API::LoadMint: Error allocating memory in the OT API&quot;</span>);
    <span class="comment">// responsible to delete or return pMint below this point.</span>
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (!pMint-&gt;<a class="code" href="class_o_t_mint.html#a221bc0417a368635c5f66db83d221272">LoadMint</a>() || !pMint-&gt;<a class="code" href="class_o_t_mint.html#a0cb5f67b42a1cab07a75c9cf21970a90">VerifyMint</a>(*pServerNym))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load or verify Mintfile : %s%s%s%s%s\n&quot;</span>, szFunc,
                       <a class="code" href="class_o_t_folders.html#a821d8437b66e62cca2782da52777f299">OTFolders::Mint</a>().Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strServerID.Get(),
                       <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strAssetTypeID.Get());
        <span class="keyword">delete</span> pMint; pMint = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keywordflow">return</span> pMint;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a407abef5bd443ce7f68e399f76252fd3"></a><!-- doxytag: member="OT_API::LoadNymbox" ref="a407abef5bd443ce7f68e399f76252fd3" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a407abef5bd443ce7f68e399f76252fd3">OT_API::LoadNymbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06148">6148</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadNymbox: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#aa77a7e498b3866d054b3c58fb6c8e7d7">LoadNymbox</a>() &amp;&amp; pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::LoadNymbox: Unable to load or verify nymbox: %s\n&quot;</span>,
                       strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d73d9af141c79478e431d81b3ac641d"></a><!-- doxytag: member="OT_API::LoadNymboxNoVerify" ref="a5d73d9af141c79478e431d81b3ac641d" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a5d73d9af141c79478e431d81b3ac641d">OT_API::LoadNymboxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06181">6181</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadNymboxNoVerify: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#aa77a7e498b3866d054b3c58fb6c8e7d7">LoadNymbox</a>()) <span class="comment">// The Verify would go here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::LoadNymboxNoVerify: Unable to load nymbox: %s\n&quot;</span>,
                       strUserID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aeaf758c15cb39763d3ac80e7582e5409"></a><!-- doxytag: member="OT_API::LoadOutbox" ref="aeaf758c15cb39763d3ac80e7582e5409" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#aeaf758c15cb39763d3ac80e7582e5409">OT_API::LoadOutbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06281">6281</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadOutbox: Error allocating memory in the OT API.&quot;</span>);

    <span class="comment">// Beyond this point, I know that pLedger is loaded and will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>

    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a>() &amp;&amp; pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);

        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::LoadOutbox: Unable to load or verify outbox: %s\n For user: %s\n&quot;</span>,
                       strAcctID.Get(), strUserID.Get());

        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af4b4a5ef255263fbda9958082d393875"></a><!-- doxytag: member="OT_API::LoadOutboxNoVerify" ref="af4b4a5ef255263fbda9958082d393875" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#af4b4a5ef255263fbda9958082d393875">OT_API::LoadOutboxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06322">6322</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadOutboxNoVerify: Error allocating memory in the OT API.&quot;</span>);

    <span class="comment">// Beyond this point, I know that pLedger is loaded and will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>

    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a>()) <span class="comment">// The Verify would go here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::LoadOutboxNoVerify: Unable to load outbox: %s\n For user: %s\n&quot;</span>,
                       strAcctID.Get(), strUserID.Get());

        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5077987cf25f441923c88cb51b3d940a"></a><!-- doxytag: member="OT_API::LoadPaymentInbox" ref="a5077987cf25f441923c88cb51b3d940a" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a5077987cf25f441923c88cb51b3d940a">OT_API::LoadPaymentInbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06357">6357</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadPaymentInbox: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a2089e14094b2047e668bc50e2d5d3eb2">LoadPaymentInbox</a>() &amp;&amp; pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s / %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get(), strAcctID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8e02cb186854f0b325c4c55da69f2e55"></a><!-- doxytag: member="OT_API::LoadPaymentInboxNoVerify" ref="a8e02cb186854f0b325c4c55da69f2e55" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a8e02cb186854f0b325c4c55da69f2e55">OT_API::LoadPaymentInboxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06384">6384</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadPaymentInboxNoVerify: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a2089e14094b2047e668bc50e2d5d3eb2">LoadPaymentInbox</a>()) <span class="comment">// The Verify would have gone here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(USER_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s / %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get(), strAcctID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38f96bbf12655ca9ced0ebf33a5c3794"></a><!-- doxytag: member="OT_API::LoadPrivateNym" ref="a38f96bbf12655ca9ced0ebf33a5c3794" args="(const OTIdentifier &amp;NYM_ID, const bool bChecking=false, const char *szFuncName=NULL, OTPasswordData *pPWData=NULL, OTPassword *pImportPassword=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#a38f96bbf12655ca9ced0ebf33a5c3794">OT_API::LoadPrivateNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bChecking</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *&#160;</td>
          <td class="paramname"><em>pPWData</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pImportPassword</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>CALLER is responsible to delete the Nym that's returned here! (Low level.) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04347">4347</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// ---------------------------------</span>
    <span class="comment">// Grab the name, if there is one.</span>
    <span class="comment">// That way if we have to reload it, we&#39;ll be able to preserve the name.</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strName;
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strNymID(NYM_ID);
    <span class="comment">// ---------------------------------</span>
    <span class="comment">// If the Nym is already in the wallet, we grab the name from the wallet, so we can</span>
    <span class="comment">// set the same name onto that Nym again when he&#39;s re-loaded.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(NYM_ID, szFuncName);    <span class="comment">// This already logs and ASSERTs</span>
    strName = (NULL != pNym) ? pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a42e63697c3c3b1bdb526ee7990a9c0e7">GetNymName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() : strNymID.Get();
    <span class="comment">// now strName contains either &quot;&quot; or the Nym&#39;s name from wallet.</span>
    <span class="comment">// ---------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
    <span class="keywordflow">if</span> (NULL == pPWData)
        pPWData = &amp;thePWData;
    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#a38f96bbf12655ca9ced0ebf33a5c3794">OTPseudonym::LoadPrivateNym</a>(NYM_ID, bChecking, &amp;strName, szFuncName, pPWData, pImportPassword); <span class="comment">// CALLER must delete!</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d793f8c61422481fc3a266ec68c523a"></a><!-- doxytag: member="OT_API::LoadPublicNym" ref="a5d793f8c61422481fc3a266ec68c523a" args="(const OTIdentifier &amp;NYM_ID, const char *szFuncName=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> * <a class="el" href="class_o_t___a_p_i.html#a5d793f8c61422481fc3a266ec68c523a">OT_API::LoadPublicNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szFuncName</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>CALLER is responsible to delete this Nym! (Low level.) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04326">4326</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}

<span class="comment">//  const char * szFunc = (NULL != szFuncName) ? szFuncName : &quot;OT_API::LoadPublicNym&quot;;</span>
    <span class="comment">// ---------------------------------</span>
    <span class="comment">// Grab the name, if there is one.</span>
    <span class="comment">// That way if we have to reload it, we&#39;ll be able to preserve the name.</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strName;
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strNymID(NYM_ID);
    <span class="comment">// ---------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(NYM_ID, szFuncName);    <span class="comment">// This already logs and ASSERTs</span>
    strName = (NULL != pNym) ? pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a42e63697c3c3b1bdb526ee7990a9c0e7">GetNymName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() : strNymID.Get();
    <span class="comment">// now strName contains either &quot;&quot; or the Nym&#39;s name from wallet.</span>
    <span class="comment">// ---------------------------------</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#a5d793f8c61422481fc3a266ec68c523a">OTPseudonym::LoadPublicNym</a>(NYM_ID, &amp;strName, szFuncName);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae86b6c0831420bcf0ecadc603364d230"></a><!-- doxytag: member="OT_API::LoadPurse" ref="ae86b6c0831420bcf0ecadc603364d230" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID, const OTIdentifier &amp;USER_ID, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">OT_API::LoadPurse</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05080">5080</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Loading purse from local storage.&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(strReason);
    <span class="comment">// -----------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(ASSET_ID);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_ID, USER_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pPurse, <span class="stringliteral">&quot;Error allocating memory in the OT API.&quot;</span>); <span class="comment">// responsible to delete or return pPurse below this point.</span>

    <span class="keywordflow">if</span> (pPurse-&gt;<a class="code" href="class_o_t_purse.html#a6cda4ea82f97fab7719242c0827846f7">LoadPurse</a>(strServerID.Get(), strUserID.Get(), strAssetTypeID.Get()))
    {
        <span class="keywordflow">if</span> (pPurse-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pNym)       &amp;&amp;
            (SERVER_ID == pPurse-&gt;<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>()) &amp;&amp;
            (ASSET_ID  == pPurse-&gt;<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a> ()))
        {
            <span class="keywordflow">return</span> pPurse;
        }
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed verifying purse.\n&quot;</span>, __FUNCTION__);
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Failed loading purse.\n&quot;</span>, __FUNCTION__);
    <span class="comment">// --------------------------------</span>
    <span class="keyword">delete</span> pPurse;
    pPurse = NULL;

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7b06c8e03c43b3b45d74333b16a5f1b7"></a><!-- doxytag: member="OT_API::LoadPurseAndOwnerForMerge" ref="a7b06c8e03c43b3b45d74333b16a5f1b7" args="(const OTString &amp;strPurse, OTPurse &amp;thePurse, OTPassword &amp;thePassword, const bool bCanBePublic=false, const OTIdentifier *pOWNER_ID=NULL, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * <a class="el" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">OT_API::LoadPurseAndOwnerForMerge</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;&#160;</td>
          <td class="paramname"><em>thePurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bCanBePublic</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOWNER_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05351">5351</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = __FUNCTION__; <span class="comment">//&quot;LoadPurseAndOwnerForMerge&quot;;</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData((NULL == pstrDisplay) ? <a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOwner = NULL;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (strPurse.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse))
    {
        <span class="comment">// --------------------------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idPurseNym;

        <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#aa9fabc0850e503fe1bd507dbe9031915">IsNymIDIncluded</a>() &amp;&amp; !thePurse.<a class="code" href="class_o_t_purse.html#acd79fd6aebc25bb41034efc059ac77e6">GetNymID</a>(idPurseNym))
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to get the NymID from the &quot;</span>
                          <span class="stringliteral">&quot;purse (though one WAS apparently present.)\n&quot;</span>, szFunc);
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// Purse is encrypted based on Nym.</span>
        <span class="comment">//</span>
        <span class="comment">// If the purse includes a NymID, then we&#39;ll use it. (If we can&#39;t use that specific one, then we have failed.)</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#aa9fabc0850e503fe1bd507dbe9031915">IsNymIDIncluded</a>() ||
                 <span class="comment">// Else if the purse does NOT include a NymID (but also is NOT password protected, meaning a Nym still exists, but just isn&#39;t named) then we&#39;ll use pOWNER_ID passed in. If that&#39;s NULL, or we fail to find the Nym with it, then we have failed.</span>
                 ( !thePurse.<a class="code" href="class_o_t_purse.html#aa9fabc0850e503fe1bd507dbe9031915">IsNymIDIncluded</a>() &amp;&amp; !thePurse.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>() ) <span class="comment">// &amp;&amp; (NULL != pOWNER_ID)) // checked inside the block.</span>
                 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> * pActualOwnerID = thePurse.<a class="code" href="class_o_t_purse.html#aa9fabc0850e503fe1bd507dbe9031915">IsNymIDIncluded</a>() ? &amp;idPurseNym : pOWNER_ID;

            <span class="keywordflow">if</span> (NULL == pActualOwnerID)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: The purse is encrypted to a specific Nym (not a passphrase) &quot;</span>
                              <span class="stringliteral">&quot;but that Nym is not specified in the purse, nor was it passed into this &quot;</span>
                              <span class="stringliteral">&quot;function. (Failure. Unable to access purse.)\n&quot;</span>, szFunc);
                <span class="keywordflow">return</span> NULL;
            }
            <span class="comment">// ---------------------------------------------------</span>
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pOwnerNym = bCanBePublic ? this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>       (*pActualOwnerID, <span class="keyword">false</span>, szFunc, &amp;thePWData) :
                                                     this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(*pActualOwnerID, false, szFunc, &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
            <span class="keywordflow">if</span> (NULL == pOwnerNym)
            {
                <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAttemptedID(*pActualOwnerID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: The purse is encrypted to a specific NymID (not a passphrase) which was &quot;</span>
                              <span class="stringliteral">&quot;either specified inside the purse, or wasn&#39;t specified so we guessed the user ID. &quot;</span>
                              <span class="stringliteral">&quot;Either way, we then failed loading that Nym: %s\n&quot;</span>
                              <span class="stringliteral">&quot;(Failure. Unable to access purse.)\n&quot;</span>, szFunc, strAttemptedID.Get());
                <span class="keywordflow">return</span> NULL;
            }
            <span class="comment">// ---------------------------------------------------</span>
            <span class="comment">// We found the Nym. If it was the Nym listed in the purse, then it&#39;s almost certainly the right one.</span>
            <span class="comment">// Else if it was the Nym we guessed, it could be right and it could be wrong. We won&#39;t find out in that</span>
            <span class="comment">// case, until we actually try to use it for decrypting tokens on the purse (and then we&#39;ll fail at that</span>
            <span class="comment">// time, if it&#39;s the wrong Nym.)</span>
            <span class="comment">//</span>
            pOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pOwnerNym, pstrDisplay); <span class="comment">// Can&#39;t put &amp;strReason here. (It goes out of scope.)</span>
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOwner);
        }
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// Else if purse IS password protected, then use its internal key.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>())  <span class="comment">// Purse is encrypted based on its own built-in symmetric key.</span>
        {
            <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> * pSymmetricKey = thePurse.<a class="code" href="class_o_t_purse.html#a33b82e7e9104846933b51d939c5d5f67">GetInternalKey</a>();
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pSymmetricKey);
            <span class="comment">// -------------------------</span>
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotPassphrase = thePurse.<a class="code" href="class_o_t_purse.html#a0407a9c4d90472e8d79fb57edfae032a">GetPassphrase</a>(thePassword, thePWData.GetDisplayString());

            <span class="keywordflow">if</span> (!bGotPassphrase)
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Authentication failed, or otherwise failed &quot;</span>
                               <span class="stringliteral">&quot;retrieving secret from user.\n&quot;</span>, szFunc);
            <span class="comment">// -------------------------</span>
            <span class="comment">// Below this point, we know thePassword is good, and we know pSymmetricKey is good.</span>
            <span class="comment">// Therefore...</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span>
            {
                pOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pSymmetricKey, thePassword,
                                                   pstrDisplay); <span class="comment">// Can&#39;t put &amp;strReason here. (It goes out of scope.)</span>
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOwner);
            }
        }
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: Somehow this purse is not password-protected, nor is it &quot;</span>
                          <span class="stringliteral">&quot;Nym-protected. (This error should never actually happen.)\n&quot;</span>, szFunc);
        <span class="comment">// ************************************************************************************</span>
        <span class="comment">// (By this point, pOwner is all set up and ready to go.)</span>
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading purse from string:\n%s\n&quot;</span>,
                       szFunc, strPurse.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// ----------------</span>
    <span class="keywordflow">return</span> pOwner;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8f169045c3550424b6b28df54539a183"></a><!-- doxytag: member="OT_API::LoadPurseAndOwnerFromString" ref="a8f169045c3550424b6b28df54539a183" args="(const OTIdentifier &amp;theServerID, const OTIdentifier &amp;theAssetTypeID, const OTString &amp;strPurse, OTPurse &amp;thePurse, OTPassword &amp;thePassword, const bool bForEncrypting=true, const OTIdentifier *pOWNER_ID=NULL, const OTString *pstrDisplay1=NULL, const OTString *pstrDisplay2=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * <a class="el" href="class_o_t___a_p_i.html#a8f169045c3550424b6b28df54539a183">OT_API::LoadPurseAndOwnerFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAssetTypeID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;&#160;</td>
          <td class="paramname"><em>thePurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassword</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForEncrypting</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOWNER_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay1</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay2</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05221">5221</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc             = __FUNCTION__; <span class="comment">//&quot;LoadPurseAndOwnerFromString&quot;;</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span>   bDoesOwnerIDExist  = (NULL != pOWNER_ID); <span class="comment">// If not true, purse MUST be password-protected.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData1((NULL == pstrDisplay1) ?
                              <span class="stringliteral">&quot;Enter the master passphrase for your wallet. (LoadPurseAndOwnerFromString)&quot;</span> :
                              pstrDisplay1-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// for purses already owned by the wallet</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData2((NULL == pstrDisplay2) ?
                              <span class="stringliteral">&quot;Enter the passphrase for this purse. (LoadPurseAndOwnerFromString)&quot;</span> :
                              pstrDisplay2-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// for password-protected purses.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pOwnerNym         =  NULL; <span class="comment">// In the case where there is an owner, this will point to it.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (bDoesOwnerIDExist)
    {
        pOwnerNym = bForEncrypting ? this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(*pOWNER_ID, <span class="keyword">false</span>, szFunc, &amp;thePWData1) :
                                     this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(*pOWNER_ID, false, szFunc, &amp;thePWData1); <span class="comment">// These copiously log, and ASSERT.</span>
        <span class="keywordflow">if</span> (NULL == pOwnerNym) <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// By this point, pOwnerNym may be a good pointer, and on the wallet. (No need to cleanup.)</span>
    <span class="comment">// Or, it may also be NULL, in the case that the purse is password-protected.</span>
    <span class="comment">// bDoesOwnerIDExist is an easy way to tell, either way.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOwner = NULL;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (strPurse.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse))
    {
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymIDIncludedInPurse = thePurse.<a class="code" href="class_o_t_purse.html#aa9fabc0850e503fe1bd507dbe9031915">IsNymIDIncluded</a>();
        <span class="comment">// --------------------------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idPurseNym;

        <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>() != theServerID)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: ServerID doesn&#39;t match.\n&quot;</span>, szFunc);
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a>() != theAssetTypeID)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: AssetTypeID doesn&#39;t match.\n&quot;</span>, szFunc);
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bNymIDIncludedInPurse &amp;&amp; !thePurse.<a class="code" href="class_o_t_purse.html#acd79fd6aebc25bb41034efc059ac77e6">GetNymID</a>(idPurseNym))
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to get the NymID from the &quot;</span>
                          <span class="stringliteral">&quot;purse (though one WAS apparently present.)\n&quot;</span>, szFunc);
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bNymIDIncludedInPurse &amp;&amp; !bDoesOwnerIDExist)
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strPurseNymID(idPurseNym);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: The purse is owned by a NymID, but no NymID was passed into &quot;</span>
                          <span class="stringliteral">&quot;this function.\nNym who owns the purse: %s\n\n&quot;</span>, szFunc, strPurseNymID.Get());
        }
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bNymIDIncludedInPurse &amp;&amp; !(pOwnerNym-&gt;GetConstID() == idPurseNym))
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strPurseNymID(idPurseNym), strNymActuallyPassed(pOwnerNym-&gt;GetConstID());
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: the API call mentions Nym A, but the purse is actually &quot;</span>
                          <span class="stringliteral">&quot;owned by Nym B.\nNym A: %s\nNym B: %s\n\n&quot;</span>, szFunc, strNymActuallyPassed.Get(),
                          strPurseNymID.Get());
        }
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bDoesOwnerIDExist &amp;&amp; !thePurse.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>())
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: The USER_ID was NULL, which is only allowed &quot;</span>
                          <span class="stringliteral">&quot;for a password-protected purse. (And this purse is NOT &quot;</span>
                          <span class="stringliteral">&quot;password-protected.) Please provide a USER_ID.\n&quot;</span>, szFunc);
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// By this point, we know the purse loaded up properly, and the server and asset IDs match</span>
        <span class="comment">// what we expected. We also know that if the purse included a NymID, it matches the USER_ID</span>
        <span class="comment">// that was passed in. We also know that if a User ID was NOT passed in, that the purse WAS</span>
        <span class="comment">// definitely a password-protected purse.</span>
        <span class="comment">//</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>())  <span class="comment">// Purse is encrypted based on its own built-in symmetric key.</span>
        {
            <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> * pSymmetricKey = thePurse.<a class="code" href="class_o_t_purse.html#a33b82e7e9104846933b51d939c5d5f67">GetInternalKey</a>();
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pSymmetricKey);
            <span class="comment">// -------------------------</span>
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotPassphrase = thePurse.<a class="code" href="class_o_t_purse.html#a0407a9c4d90472e8d79fb57edfae032a">GetPassphrase</a>(thePassword, thePWData2.GetDisplayString());

            <span class="keywordflow">if</span> (!bGotPassphrase)
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Authentication failed, or otherwise failed &quot;</span>
                               <span class="stringliteral">&quot;retrieving secret from user.\n&quot;</span>, szFunc);
            <span class="comment">// -------------------------</span>
            <span class="comment">// Below this point, we know thePassword is good, and we know pSymmetricKey is good.</span>
            <span class="comment">// Therefore...</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span>
            {
                pOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pSymmetricKey, thePassword,
                                                   pstrDisplay2); <span class="comment">// Can&#39;t put &amp;strReason here. (It goes out of scope.)</span>
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOwner);
            }
        }
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bDoesOwnerIDExist)                <span class="comment">// Purse is encrypted based on Nym.</span>
        {
            pOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pOwnerNym, pstrDisplay1); <span class="comment">// Can&#39;t put &amp;strReason here. (It goes out of scope.)</span>
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOwner);
        }
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: The purse is not password-protected, but rather, is locked by a Nym. &quot;</span>
                          <span class="stringliteral">&quot;However, no USER_ID was passed in! Please supply a USER_ID in order &quot;</span>
                          <span class="stringliteral">&quot;to open this purse.\n&quot;</span>, szFunc);
        <span class="comment">// ************************************************************************************</span>
        <span class="comment">// (By this point, pOwner is all set up and ready to go.)</span>
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading purse from string:\n%s\n&quot;</span>,
                       szFunc, strPurse.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// ----------------</span>
    <span class="keywordflow">return</span> pOwner;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a318f160f9a43ac68afcf415ff51ae267"></a><!-- doxytag: member="OT_API::LoadRecordBox" ref="a318f160f9a43ac68afcf415ff51ae267" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a318f160f9a43ac68afcf415ff51ae267">OT_API::LoadRecordBox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06413">6413</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;

    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadRecordBox: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoaded = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#ad283d675ba07160bddde117386b872a6">LoadRecordBox</a>();

    <span class="keywordtype">bool</span> bVerified = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (bLoaded)
        bVerified = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym);

    <span class="keywordflow">if</span> (bLoaded &amp;&amp; bVerified)
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s / %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get(), strAcctID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8c288f48dcdc98a6ae02c03e6452c438"></a><!-- doxytag: member="OT_API::LoadRecordBoxNoVerify" ref="a8c288f48dcdc98a6ae02c03e6452c438" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t___a_p_i.html#a8c288f48dcdc98a6ae02c03e6452c438">OT_API::LoadRecordBoxNoVerify</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06449">6449</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, ACCOUNT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pLedger, <span class="stringliteral">&quot;OT_API::LoadRecordBoxNoVerify: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// Beyond this point, I know that pLedger will need to be deleted or returned.</span>
    <span class="comment">// ------------------------------------------------------</span>
    <span class="keywordflow">if</span> (pLedger-&gt;<a class="code" href="class_o_t_ledger.html#ad283d675ba07160bddde117386b872a6">LoadRecordBox</a>()) <span class="comment">// The Verify would have gone here.</span>
        <span class="keywordflow">return</span> pLedger;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID), strAcctID(ACCOUNT_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Unable to load or verify: %s / %s\n&quot;</span>,
                       __FUNCTION__, strUserID.Get(), strAcctID.Get());
        <span class="keyword">delete</span> pLedger;
        pLedger = NULL;
    }
    <span class="keywordflow">return</span>  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adeed94c645c2e2330e536520b9fa5664"></a><!-- doxytag: member="OT_API::LoadServerContract" ref="adeed94c645c2e2330e536520b9fa5664" args="(const OTIdentifier &amp;SERVER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_server_contract.html">OTServerContract</a> * <a class="el" href="class_o_t___a_p_i.html#adeed94c645c2e2330e536520b9fa5664">OT_API::LoadServerContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06041">6041</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    <a class="code" href="class_o_t_string.html">OTString</a> strFoldername  = <a class="code" href="class_o_t_folders.html#ac8ac28307d688d0defee0fd7734be027">OTFolders::Contract</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename    = strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// ------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFoldername.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::LoadServerContract: File does not exist: %s%s%s\n&quot;</span>,
                      strFoldername.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>(strServerID, strFoldername,
                                                        strFilename, strServerID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pContract, <span class="stringliteral">&quot;Error allocating memory for Server &quot;</span>
                  <span class="stringliteral">&quot;Contract in OT_API::LoadServerContract\n&quot;</span>);

    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_contract.html#a1432a5e924d021a9dc39320d3b8e7b90">LoadContract</a>() &amp;&amp; pContract-&gt;<a class="code" href="class_o_t_contract.html#aa707f03da51449ef0cd1a466cbc0f13c">VerifyContract</a>())
        <span class="keywordflow">return</span> pContract;
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::LoadServerContract: Unable to load or verify server contract. (Maybe it&#39;s just not there, and needs to &quot;</span>
                       <span class="stringliteral">&quot;be downloaded.) Server ID: %s\n&quot;</span>, strServerID.Get());
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">delete</span> pContract;
    pContract = NULL;

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3a0ae20d8736f8588d76441a18ac2c6e"></a><!-- doxytag: member="OT_API::LoadWallet" ref="a3a0ae20d8736f8588d76441a18ac2c6e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">OT_API::LoadWallet</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00886">886</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::LoadWallet&quot;</span>;

    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.\n&quot;</span>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bDefaultStore, <span class="stringliteral">&quot;Default Storage not Initialized; call OT_API::Init first.\n&quot;</span>);

    <a class="code" href="class_o_t_string.html">OTString</a> strWalletFilename;
    <span class="keywordtype">bool</span> bGetWalletFilenameSuccess = <a class="code" href="class_o_t___a_p_i.html#a6e79ce6216fb40ef9c2f48615e72072a">OT_API::GetWalletFilename</a>(strWalletFilename);

    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bGetWalletFilenameSuccess, <span class="stringliteral">&quot;OT_API::GetWalletFilename failed, wallet filename isn&#39;t set!&quot;</span>);

    <span class="comment">// Atempt Load</span>
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2,<span class="stringliteral">&quot;m_pWallet-&gt;LoadWallet() with: %s\n&quot;</span>, strWalletFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#a2932e7c8d6b5d7764707e653a3c2f216">LoadWallet</a>(strWalletFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (bSuccess) <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Success invoking m_pWallet-&gt;LoadWallet() with filename: %s\n&quot;</span>,
                               szFunc, strWalletFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keywordflow">else</span> <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed invoking m_pWallet-&gt;LoadWallet() with filename: %s\n&quot;</span>,
                              szFunc, strWalletFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1e69026904ab8b2a6a3a1185801bdf7"></a><!-- doxytag: member="OT_API::Msg_HarvestTransactionNumbers" ref="af1e69026904ab8b2a6a3a1185801bdf7" args="(OTMessage &amp;theMsg, const OTIdentifier &amp;USER_ID, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#af1e69026904ab8b2a6a3a1185801bdf7">OT_API::Msg_HarvestTransactionNumbers</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_message.html">OTMessage</a> &amp;&#160;</td>
          <td class="paramname"><em>theMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bHarvestingForRetry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasFailure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasFailure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04419">4419</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> theMsg.<a class="code" href="class_o_t_message.html#a6331ffbc53709747d82dfb100c3c8f02">HarvestTransactionNumbers</a>(*pNym,
                                            bHarvestingForRetry,
                                            bReplyWasSuccess,
                                            bReplyWasFailure,
                                            bTransactionWasSuccess,
                                            bTransactionWasFailure);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a02e42976ba8ca2b4a667c97c94199780"></a><!-- doxytag: member="OT_API::notarizeDeposit" ref="a02e42976ba8ca2b4a667c97c94199780" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, OTString &amp;THE_PURSE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a02e42976ba8ca2b4a667c97c94199780">OT_API::notarizeDeposit</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l09023">9023</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::notarizeDeposit&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strPurseReason        (<span class="stringliteral">&quot;Depositing a cash purse. Enter passphrase for the purse.&quot;</span>);
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataWallet (<span class="stringliteral">&quot;Depositing a cash purse. Enter master passphrase for wallet.&quot;</span>);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName, &amp;thePWDataWallet); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    CONTRACT_ID;
    <a class="code" href="class_o_t_string.html">OTString</a>        strContractID;

    CONTRACT_ID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    CONTRACT_ID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strContractID);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strFromAcct(ACCT_ID);

    <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServer-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> SERVER_USER_ID(*pServerNym);
    <span class="comment">// ------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> thePurse(SERVER_ID, CONTRACT_ID, SERVER_USER_ID);

    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum = <span class="keyword">false</span>;
    <span class="comment">// ---------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

    <span class="keywordflow">if</span> (NULL == pInbox){
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: Failed loading inbox!\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="keywordflow">if</span> (NULL == pOutbox){
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: Failed loading outbox!\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }

    bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber);
    <span class="keywordflow">if</span> (!bGotTransNum){
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Next Transaction Number Available: Suggest requesting the server for a new one.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }

    <span class="keywordflow">if</span> (NULL == pServerNym) <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;

    <span class="comment">// -----------------------------------------</span>
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;

    <span class="comment">// Create a transaction</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ACCT_ID, SERVER_ID,
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>, lStoredTransactionNumber);
    <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
    <a class="code" href="class_o_t_item.html">OTItem</a> * pItem  = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afd6e878bfcdf2d554b0c814d5da084d1">OTItem::deposit</a>);

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// What&#39;s going on here?</span>
    <span class="comment">// A purse can be encrypted by a private key (controlled by a Nym) or by a symmetric</span>
    <span class="comment">// key (embedded inside the purse along with a corresponding master key.) The below</span>
    <span class="comment">// function is what actually loads up pPurse from string (THE_PURSE) and this call</span>
    <span class="comment">// also returns pOwner, which is a pointer to a special wrapper class (which you must</span>
    <span class="comment">// delete, when you&#39;re done with it) which contains a pointer EITHER to the owner Nym</span>
    <span class="comment">// for that purse, OR to the &quot;owner&quot; symmetric key for that purse.</span>
    <span class="comment">//</span>
    <span class="comment">// This way, any subsequent purse operations can use pOwner, regardless of whether there</span>
    <span class="comment">// is actually a Nym inside, or a symmetric key. (None of the purse operations will care,</span>
    <span class="comment">// since they can use pOwner either way.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a>  thePassword;
    <a class="code" href="class_o_t_purse.html">OTPurse</a>     theSourcePurse(thePurse);

    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pPurseOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">LoadPurseAndOwnerForMerge</a>(THE_PURSE, theSourcePurse, thePassword,
        <span class="keyword">false</span>, <span class="comment">//bCanBePublic=false by default. MUST be private, if a nym.</span>
        &amp;USER_ID, <span class="comment">// This can be NULL, **IF** purse is password-protected. (It&#39;s just ignored in that case.) Otherwise if it&#39;s Nym-protected, the purse will have a NymID on it already, which is what LoadPurseAndOwnerForMerge will try first. If not (it&#39;s optional), then USER_ID is the ID it will try next, before failing altogether.</span>
        &amp;strPurseReason);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOwnerAngel(pPurseOwner);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pPurseOwner)
    {
        <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> theServerNymAsOwner(*pServerNym);

        <span class="keywordflow">while</span> (!theSourcePurse.IsEmpty())
        {
            <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = theSourcePurse.Pop(*pPurseOwner);

            <span class="keywordflow">if</span> (NULL != pToken)
            {
                <span class="comment">// TODO need 2-recipient envelopes. My request to the server is encrypted to the server&#39;s nym,</span>
                <span class="comment">// but it should be encrypted to my Nym also, so both have access to decrypt it.</span>

                <span class="comment">// Now the token is ready, let&#39;s add it to a purse</span>
                <span class="comment">// By pushing theToken into thePurse with *pServerNym, I encrypt it to pServerNym.</span>
                <span class="comment">// So now only the server Nym can decrypt that token and pop it out of that purse.</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == pToken-&gt;<a class="code" href="class_o_t_token.html#aa661b16971fbca2e3b4a1c3452e4c030">ReassignOwnership</a>(*pPurseOwner,         <span class="comment">// must be private, if a nym.</span>
                    theServerNymAsOwner)) <span class="comment">// can be public, if a nym.</span>
                {
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::notarizeDeposit: Error re-assigning ownership of token (to server.)\n&quot;</span>);
                    <span class="keyword">delete</span> pToken; pToken = NULL;
                    bSuccess = <span class="keyword">false</span>;
                    <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;OT_API::notarizeDeposit: Success re-assigning ownership of token (to server.)\n&quot;</span>);

                    bSuccess = <span class="keyword">true</span>;

                    pToken-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
                    pToken-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
                    pToken-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                    thePurse.Push(theServerNymAsOwner, *pToken);

                    int64_t lTemp = pItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();
                    pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lTemp += pToken-&gt;<a class="code" href="class_o_t_token.html#a4e17470c475313139d1ed975e6c26b5a">GetDenomination</a>());
                }
                <span class="keyword">delete</span> pToken;
                pToken = NULL;
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error loading token from purse.\n&quot;</span>);
                <span class="keywordflow">break</span>;
            }
        } <span class="comment">// while</span>
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="keywordflow">if</span> (bSuccess)
    {
        <span class="comment">// Save the purse into a string...</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strPurse;
        thePurse.SignContract(*pNym);
        thePurse.SaveContract();
        thePurse.SaveContractRaw(strPurse);

        <span class="comment">// Add the purse string as the attachment on the transaction item.</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strPurse); <span class="comment">// The purse is contained in the reference string.</span>

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>

        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// BALANCE AGREEMENT</span>
        <span class="comment">//</span>
        <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(pItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(), *pTransaction, *pNym, *pAccount, *pOutbox);

        <span class="keywordflow">if</span> (NULL != pBalanceItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>

        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ACCT_ID, SERVER_ID);
        theLedger.GenerateLedger(ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction); <span class="comment">// now the ledger &quot;owns&quot; and will handle cleaning up the transaction.</span>

        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();

        <span class="comment">// extract the ledger in ascii-armored form... encoding...</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;GetCurrentRequestNum(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;IncrementRequestNum(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strFromAcct;
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;GetNymboxHash(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
            str_server.c_str());

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);   

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);

    } <span class="comment">// bSuccess</span>
    <span class="keywordflow">else</span>
    {
        <span class="keyword">delete</span> pItem;       pItem = NULL;
        <span class="keyword">delete</span> pTransaction;pTransaction = NULL;

        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;AddTransactionNum(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a10d6c5c156dfe6cf66860c3aa62e5fc0"></a><!-- doxytag: member="OT_API::notarizeTransfer" ref="a10d6c5c156dfe6cf66860c3aa62e5fc0" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_FROM, OTIdentifier &amp;ACCT_TO, const int64_t &amp;AMOUNT, OTString &amp;NOTE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a10d6c5c156dfe6cf66860c3aa62e5fc0">OT_API::notarizeTransfer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_FROM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_TO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>AMOUNT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>NOTE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11306">11306</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_FROM, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int64_t lRequestNumber = 0;
    <span class="keyword">const</span> int64_t lAmount = AMOUNT;

    <a class="code" href="class_o_t_string.html">OTString</a>    strServerID(SERVER_ID), strNymID(USER_ID),
                strFromAcct(ACCT_FROM), strToAcct(ACCT_TO);

    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber);

    <span class="keywordflow">if</span> (bGotTransNum)
    {
        <span class="comment">// Create a transaction</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ACCT_FROM,
                                                                           SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>,
                                                                           lStoredTransactionNumber);

        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>, &amp;ACCT_TO);
        pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount);

        <span class="comment">// The user can include a note here for the recipient.</span>
        <span class="keywordflow">if</span> (NOTE.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; NOTE.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
        {
            pItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(NOTE);
        }

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// --------------------------------------------------</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);

        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

        <span class="keywordflow">if</span> (NULL == pInbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::notarizeTransfer: Failed loading inbox for acct: %s\n&quot;</span>, strFromAcct.Get());
            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::notarizeTransfer: Failed loading outbox for acct: %s\n&quot;</span>, strFromAcct.Get());
            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Need to setup a dummy outbox transaction (to mimic the one that will be on the server side when this pending transaction is actually put into the real outbox.)</span>
            <span class="comment">// When the server adds its own, and then compares the two, they should both show the same pending transaction, in order for this balance agreement to be valid..</span>
            <span class="comment">// Otherwise the server would have to refuse it for being inaccurate (server can&#39;t sign something inaccurate!) So I throw a dummy on there before generating balance statement.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pOutboxTransaction  = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(*pOutbox, <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>,
                                                                                     1<span class="comment">/*todo pick some number that everyone agrees doesn&#39;t matter, like 1. The referring-to is the important</span>
<span class="comment">                                                                                       number in this case, and perhaps server should update this value too before signing and returning.*/</span>); <span class="comment">// todo use a constant instead of &#39;1&#39;</span>
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOutboxTransaction); <span class="comment">// for now.</span>

            <a class="code" href="class_o_t_string.html">OTString</a> strItem(*pItem);
            pOutboxTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a9dd50265579347d2e8fa3ea36ca66320">SetReferenceString</a>(strItem); <span class="comment">// So the GenerateBalanceStatement function below can get the other info off this item (like amount, etc)</span>
            pOutboxTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());

<span class="comment">//          pOutboxTransaction-&gt;SignContract(*pNym);    // Unnecessary to sign/save, since this is just a dummy data for verification purposes, and isn&#39;t being</span>
<span class="comment">//          pOutboxTransaction-&gt;SaveContract();         // serialized anywhere. (I download the actual outbox from server, and verify against last signed receipt.)</span>

            pOutbox-&gt;<a class="code" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a>(*pOutboxTransaction);  <span class="comment">// no need to cleanup pOutboxTransaction since pOutbox will handle it now.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// BALANCE AGREEMENT</span>

            <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that twice.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(lAmount*(-1), *pTransaction, *pNym, *pAccount, *pOutbox);

            <span class="keywordflow">if</span> (NULL != pBalanceItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
                pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// sign the transaction</span>
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// set up the ledger</span>
            <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ACCT_FROM, SERVER_ID);
            theLedger.GenerateLedger(ACCT_FROM, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
            theLedger.AddTransaction(*pTransaction);

            <span class="comment">// sign the ledger</span>
            theLedger.SignContract(*pNym);
            theLedger.SaveContract();

            <span class="comment">// extract the ledger in ascii-armored form</span>
            <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger;

            <span class="comment">// Encoding...</span>
            ascLedger.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strLedger);
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
            theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

            <span class="comment">// (1) Set up member variables</span>
            theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
            theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
            theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
            theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

            theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strFromAcct;
            theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
            <span class="keyword">const</span> std::string str_server(strServerID.Get());
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
            NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

            <span class="keywordflow">if</span> (!bNymboxHash)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                              str_server.c_str());

            <span class="comment">// (2) Sign the Message</span>
            theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

            <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
            theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// (Send it)</span>
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

            <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No transaction numbers were available. Suggest requesting the server for one.\n&quot;</span>);

        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
<span class="comment">//      pNym-&gt;AddTransactionNum(*pNym, strServerID, lStoredTransactionNumber, true); // bSave=true</span>
        <span class="comment">// Duh! No need to re-add a transaction num when the error is that there weren&#39;t any transaction numbers...</span>

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a598ad655514570fcbcc615709251c7e4"></a><!-- doxytag: member="OT_API::notarizeWithdrawal" ref="a598ad655514570fcbcc615709251c7e4" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, const int64_t &amp;AMOUNT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a598ad655514570fcbcc615709251c7e4">OT_API::notarizeWithdrawal</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>AMOUNT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l08780">8780</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::notarizeWithdrawal&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> (-1);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    CONTRACT_ID;
    <a class="code" href="class_o_t_string.html">OTString</a>        strContractID, strServerID(SERVER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    CONTRACT_ID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    CONTRACT_ID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strContractID);
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(<a class="code" href="class_o_t_folders.html#a821d8437b66e62cca2782da52777f299">OTFolders::Mint</a>().Get(), strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strContractID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::notarizeWithdrawal: File does not exist: %s%s%s%s%s\n&quot;</span>,
            <a class="code" href="class_o_t_folders.html#a821d8437b66e62cca2782da52777f299">OTFolders::Mint</a>().Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strServerID.Get(),
            <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strContractID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> -1;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_mint.html">OTMint</a> * pMint = <a class="code" href="class_o_t_mint.html#a2a0ecb9351ac2ce303e1b20ae523aabb">OTMint::MintFactory</a>(strServerID, strContractID); <span class="comment">// &lt;=================</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMint&gt;</a> theMintAngel(pMint);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMint);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    int64_t lRequestNumber = 0;

    <span class="keyword">const</span>   int64_t lTotalAmount    = AMOUNT;
    int64_t lAmount     = lTotalAmount;

    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID), strFromAcct(ACCT_ID);

    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum = <span class="keyword">false</span>;
    <span class="comment">// ---------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

    <span class="keywordflow">if</span> (NULL == pInbox)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: Failed loading inbox!\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="keywordflow">if</span> (NULL == pOutbox)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: Failed loading outbox!\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }

    bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber);
    <span class="keywordflow">if</span> (!bGotTransNum)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Next Transaction Number Available: Suggest requesting the server for a new one.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> (-1);
    }

    <span class="comment">// Create a transaction</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction =
        <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(USER_ID, ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>, lStoredTransactionNumber);

    <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
    <a class="code" href="class_o_t_item.html">OTItem</a> * pItem      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91dfa211f934207df229263a14672789">OTItem::withdrawal</a>);
    pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lTotalAmount);

    <a class="code" href="class_o_t_string.html">OTString</a> strNote(<span class="stringliteral">&quot;Gimme cash!&quot;</span>);  <span class="comment">// TODO: Note is unnecessary for cash withdrawal. Research uses / risks.</span>
    pItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(strNote);
    <span class="comment">// -------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServer-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();

    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> SERVER_USER_ID(*pServerNym);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> ((NULL != pServerNym) &amp;&amp;
        pMint-&gt;<a class="code" href="class_o_t_mint.html#a221bc0417a368635c5f66db83d221272">LoadMint</a>() &amp;&amp;
        pMint-&gt;<a class="code" href="class_o_t_mint.html#a0cb5f67b42a1cab07a75c9cf21970a90">VerifyMint</a>((<a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>&amp;)*pServerNym))
    {
        <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse        = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, CONTRACT_ID, SERVER_USER_ID);
        <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurseMyCopy  = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, CONTRACT_ID, USER_ID);

        <span class="comment">// Create all the necessary tokens for the withdrawal amount.</span>
        <span class="comment">// Push copies of each token into a purse to be sent to the server,</span>
        <span class="comment">// as well as a purse to be kept for unblinding when we receive the</span>
        <span class="comment">// server response.  (Coin private unblinding keys are not sent to</span>
        <span class="comment">// the server, obviously.)</span>
        int64_t lTokenAmount = 0;
        <span class="keywordflow">while</span> ((lTokenAmount = pMint-&gt;<a class="code" href="class_o_t_mint.html#a623b821ad01b8c0ce2568b6d84102c35">GetLargestDenomination</a>(lAmount)) &gt; 0 )
        {
            lAmount -= lTokenAmount;

            <span class="comment">// Create the relevant token request with same server/asset ID as the purse.</span>
            <span class="comment">// the purse does NOT own the token at this point. The token&#39;s constructor</span>
            <span class="comment">// just uses it to copy some IDs, since they must match.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ad661596f621b1b697f1e8328cdbc3683">OTToken::InstantiateAndGenerateTokenRequest</a>(*pPurse, *pNym, *pMint, lTokenAmount);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pToken);

            <span class="comment">// Sign it and save it.</span>
            pToken-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pToken-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// Now the proto-token is generated, let&#39;s add it to a purse</span>
            <span class="comment">// By pushing *pToken into pPurse with *pServerNym, I encrypt it to pServerNym.</span>
            <span class="comment">// So now only the server Nym can decrypt that token and pop it out of that purse.</span>
            pPurse-&gt;<a class="code" href="class_o_t_purse.html#a1494538d965842e3fa3d1b9ac2b6dd25">Push</a>(*pServerNym, *pToken);

            <span class="comment">// I&#39;m saving my own copy of all this, encrypted to my nym</span>
            <span class="comment">// instead of the server&#39;s, so I can get to my private coin data.</span>
            <span class="comment">// The server&#39;s copy of pToken is already Pushed, so I can re-use</span>
            <span class="comment">// the variable now for my own purse.</span>
            pToken-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            pToken-&gt;<a class="code" href="class_o_t_token.html#a8666afcdee1f4cb0b45e278d7196d6db">SetSavePrivateKeys</a>(); <span class="comment">// This time it will save the private keys when I sign it</span>
            pToken-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pToken-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            pPurseMyCopy-&gt;<a class="code" href="class_o_t_purse.html#a1494538d965842e3fa3d1b9ac2b6dd25">Push</a>(*pNym, *pToken);<span class="comment">// Now my copy of the purse has a version of the token,</span>
        }
        <span class="comment">// --------------------------------</span>
        <span class="comment">// Save the purse into a string...</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strPurse;
        pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        pPurse-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strPurse);

        <span class="comment">// Add the purse string as the attachment on the transaction item.</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strPurse); <span class="comment">// The purse is contained in the reference string.</span>
        <span class="comment">// --------------------------------------</span>
        pPurseMyCopy-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);      <span class="comment">// encrypted to me instead of the server, and including</span>
        pPurseMyCopy-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();           <span class="comment">// the private keys for unblinding the server response.</span>
        <span class="comment">// This thing is neat and tidy. The wallet can just save it as an ascii-armored string as a</span>
        <span class="comment">// purse field inside the wallet file.  It doesn&#39;t do that for now (TODO) but it easily could.</span>
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// Add the purse to the wallet</span>
        <span class="comment">// (We will need it to look up the private coin info for unblinding the token,</span>
        <span class="comment">//  when the response comes from the server.)</span>
        pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a098029976b57c592f220ae6bf0cc3822">AddPendingWithdrawal</a>(*pPurseMyCopy);

        <span class="keyword">delete</span> pPurse;
        pPurse          = NULL; <span class="comment">// We&#39;re done with this one.</span>
        pPurseMyCopy    = NULL; <span class="comment">// The wallet owns my copy now and will handle cleaning it up.</span>

        <span class="comment">// --------------------------------------</span>
        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// BALANCE AGREEMENT</span>

        <span class="comment">// pBalanceItem is signed and saved within this call. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(lTotalAmount*(-1), *pTransaction, *pNym, *pAccount, *pOutbox);

        <span class="keywordflow">if</span> (NULL != pBalanceItem) <span class="comment">// will never be NULL. Will assert above before it gets here.</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>

        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ACCT_ID, SERVER_ID);
        theLedger.GenerateLedger(ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction);

        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();

        <span class="comment">// extract the ledger in ascii-armored form</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger; <span class="comment">// I can&#39;t pass strLedger into this constructor because I want to encode it</span>

        <span class="comment">// Encoding...</span>
        ascLedger.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strLedger);
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strFromAcct;
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
            str_server.c_str());

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12f34568b5ed20e3d1744f30e472f454"></a><!-- doxytag: member="OT_API::NumList_Add" ref="a12f34568b5ed20e3d1744f30e472f454" args="(OTNumList &amp;theList, const OTNumList &amp;theNewNumbers)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a12f34568b5ed20e3d1744f30e472f454">OT_API::NumList_Add</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theNewNumbers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02859">2859</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_num_list.html">OTNumList</a> tempNewList(theList);

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccess = tempNewList.Add(theNewNumbers);

    <span class="keywordflow">if</span> (bSuccess)
    {
        theList.<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
        theList.Add(tempNewList);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6a7774af0f1af97fe6c36c396e054a3"></a><!-- doxytag: member="OT_API::NumList_Count" ref="ad6a7774af0f1af97fe6c36c396e054a3" args="(OTNumList &amp;theList)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ad6a7774af0f1af97fe6c36c396e054a3">OT_API::NumList_Count</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theList</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02923">2923</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a577cd1a86933ded118347ca37f537cee"></a><!-- doxytag: member="OT_API::NumList_Remove" ref="a577cd1a86933ded118347ca37f537cee" args="(OTNumList &amp;theList, const OTNumList &amp;theOldNumbers)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a577cd1a86933ded118347ca37f537cee">OT_API::NumList_Remove</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theOldNumbers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02874">2874</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_num_list.html">OTNumList</a>   tempNewList(theList),
                tempOldList(theOldNumbers);

    <span class="keywordflow">while</span> (tempOldList.Count() &gt; 0)
    {
        int64_t lPeek=0;

        <span class="keywordflow">if</span> (!tempOldList.Peek(lPeek) || !tempOldList.Pop())
            <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;

        <span class="keywordflow">if</span> (!tempNewList.Remove(lPeek))
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    theList.<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
    theList.Add(tempNewList);
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a909a6234b5e4dd04059a7e86f7883d1c"></a><!-- doxytag: member="OT_API::NumList_VerifyAll" ref="a909a6234b5e4dd04059a7e86f7883d1c" args="(OTNumList &amp;theList, const OTNumList &amp;theQueryNumbers)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a909a6234b5e4dd04059a7e86f7883d1c">OT_API::NumList_VerifyAll</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theQueryNumbers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02918">2918</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> theList.<a class="code" href="class_o_t_num_list.html#ac9692a20a114672de9e02a18b1cdd5e6">Verify</a>(theQueryNumbers);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac2bbcfd6aa2d7a7bf0f6a78b4dd2a654"></a><!-- doxytag: member="OT_API::NumList_VerifyQuery" ref="ac2bbcfd6aa2d7a7bf0f6a78b4dd2a654" args="(OTNumList &amp;theList, const OTNumList &amp;theQueryNumbers)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ac2bbcfd6aa2d7a7bf0f6a78b4dd2a654">OT_API::NumList_VerifyQuery</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theQueryNumbers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02898">2898</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_num_list.html">OTNumList</a> theTempQuery(theQueryNumbers);

    <span class="keywordflow">while</span> (theTempQuery.Count() &gt; 0)
    {
        int64_t lPeek=0;

        <span class="keywordflow">if</span> (!theTempQuery.Peek(lPeek) || !theTempQuery.Pop())
            <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;

        <span class="keywordflow">if</span> (!theList.<a class="code" href="class_o_t_num_list.html#ac9692a20a114672de9e02a18b1cdd5e6">Verify</a>(lPeek))
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a867538fd96d36fc772d94cffef2e8d47"></a><!-- doxytag: member="OT_API::payDividend" ref="a867538fd96d36fc772d94cffef2e8d47" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;ISSUER_USER_ID, OTIdentifier &amp;DIVIDEND_FROM_ACCT_ID, OTIdentifier &amp;SHARES_ASSET_TYPE_ID, OTString &amp;DIVIDEND_MEMO, const int64_t &amp;AMOUNT_PER_SHARE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a867538fd96d36fc772d94cffef2e8d47">OT_API::payDividend</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ISSUER_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>DIVIDEND_FROM_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SHARES_ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>DIVIDEND_MEMO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>AMOUNT_PER_SHARE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l09267">9267</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::payDividend&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(ISSUER_USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pDividendSourceAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, DIVIDEND_FROM_ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pDividendSourceAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pDividendSourceAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pSharesContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(SHARES_ASSET_TYPE_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pSharesContract) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pSharesContract is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> (-1);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pSharesIssuerAcct = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ae4cd7fef3caaf5dec83530ecabbdddb8">GetIssuerAccount</a>(SHARES_ASSET_TYPE_ID);

    <span class="keywordflow">if</span> (NULL == pSharesIssuerAcct)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: Unable to find issuer account for the shares asset type. &quot;</span>
                      <span class="stringliteral">&quot;Are you sure you&#39;re the issuer?\n&quot;</span>, szFuncName);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> SHARES_ISSUER_ACCT_ID(*pSharesIssuerAcct);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!pDividendSourceAccount-&gt;<a class="code" href="class_o_t_account.html#a73c89c2d411eb7b88326baf87802f238">VerifyOwner</a>(*pNym))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: Nym doesn&#39;t verify as owner of the source account for the dividend payout.\n&quot;</span>,
                      szFuncName);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!pSharesIssuerAcct-&gt;<a class="code" href="class_o_t_account.html#a73c89c2d411eb7b88326baf87802f238">VerifyOwner</a>(*pNym))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: Nym doesn&#39;t verify as owner of issuer account for the shares &quot;</span>
                      <span class="stringliteral">&quot;(the shares we&#39;re paying the dividend on...)\n&quot;</span>,
                      szFuncName);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(pSharesIssuerAcct-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() &lt;= 0, <span class="stringliteral">&quot;Assert (strange): issuer account should never have a higher-than-zero balance.\n&quot;</span>);

    <span class="keywordflow">if</span> (0 == pSharesIssuerAcct-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: There are no shares issued for that asset type. &quot;</span>
                      <span class="stringliteral">&quot;(Therefore you cannot pay any dividend...)\n&quot;</span>, szFuncName);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> int64_t lAmountPerShare      = AMOUNT_PER_SHARE;

    <span class="keywordflow">if</span> (lAmountPerShare &lt;= 0)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: The amount per share must be larger than zero.\n&quot;</span>, szFuncName);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// If there are 100,000 Pepsi shares, then the Pepsi issuer acct will have -100,000 balance.</span>
    <span class="comment">// Therefore we multiply by -1, resulting in 100,000. Then we multiple that by the amount to be</span>
    <span class="comment">// paid per share, let&#39;s say $5, resulting in a lTotalCostOfDividend of $500,000 that must be</span>
    <span class="comment">// available in the dollar account (in order to successfully pay this dividend.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int64_t lTotalCostOfDividend = ((-1) * pSharesIssuerAcct-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>()) * lAmountPerShare;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Let&#39;s make sure we have enough money in the dividend source account, to pay the total cost..</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pDividendSourceAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() &lt; lTotalCostOfDividend)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: There&#39;s not enough (%ld) in the source account, to cover &quot;</span>
                      <span class="stringliteral">&quot;the total cost of the dividend (%ld.)\n&quot;</span>, szFuncName, pDividendSourceAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>(),
                      lTotalCostOfDividend);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(ISSUER_USER_ID), strFromAcct(DIVIDEND_FROM_ACCT_ID);

    int64_t lStoredTransactionNumber=0;
    <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber);

    <span class="keywordflow">if</span> (bGotTransNum)
    {
        <span class="comment">// -----------------------------------------------------------------------</span>
        <span class="comment">// Expiration (ignored by server -- it sets its own for its vouchers.)</span>
        <span class="keyword">const</span>   <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    VALID_FROM  = <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>(); <span class="comment">// This time is set to TODAY NOW</span>
        <span class="keyword">const</span>   <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    VALID_TO = <a class="code" href="_o_t_common_8hpp.html#a38e4e4253c3dd158ea40e6312586e6c9">OTTimeAddTimeInterval</a>(VALID_FROM, <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="_o_t_common_8hpp.html#ad650525921666babad17624b1a25dbcd">OT_TIME_SIX_MONTHS_IN_SECONDS</a>)); <span class="comment">// 6 months.</span>
        <span class="comment">// -----------------------------------------------------------------------</span>
        <span class="comment">// The server only uses the amount and asset type from this cheque when it</span>
        <span class="comment">// constructs the actual voucher (to the dividend payee.) And remember there</span>
        <span class="comment">// might be a hundred shareholders, so the server would create a hundred</span>
        <span class="comment">// vouchers in that case.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_cheque.html">OTCheque</a> theRequestVoucher(SERVER_ID, SHARES_ASSET_TYPE_ID); <span class="comment">// &lt;====== Server needs this (SHARES_ASSET_TYPE_ID)</span>

        <span class="keywordtype">bool</span> bIssueCheque = theRequestVoucher.IssueCheque(lAmountPerShare, <span class="comment">// &lt;====== Server needs this (lAmountPerShare.)</span>
                                                          lStoredTransactionNumber, <span class="comment">// server actually ignores this and supplies its own transaction number for any vouchers.</span>
                                                          VALID_FROM, VALID_TO, SHARES_ISSUER_ACCT_ID, ISSUER_USER_ID, DIVIDEND_MEMO);

        <span class="comment">/*</span>
<span class="comment">         NOTE: The above cheque isn&#39;t actually USED for anything, except as a vehicle to send additional</span>
<span class="comment">         data to the server. For example, the server will need to know the asset type ID for the shares.</span>
<span class="comment">         It gets that information from this voucher&#39;s asset type ID. It will also need to know the amount-</span>
<span class="comment">         per-share, which is also on this voucher, as its amount. The voucher code already does a similar</span>
<span class="comment">         thing, and this code already copied the voucher code since they were so similar, so we&#39;re just</span>
<span class="comment">         using the same mechanism here. It&#39;s consistent.</span>
<span class="comment">         On the server side, we&#39;ll also need to know the issuer account ID for the shares asset type, so</span>
<span class="comment">         we set that as the &quot;from&quot; account on the request voucher (again, just as a way of transmitting it.)</span>
<span class="comment">         */</span>
        <span class="comment">// --------------------------------------------------</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pDividendSourceAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pDividendSourceAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);

        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel (pInbox );
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);

        <span class="keywordflow">if</span> (NULL == pInbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed loading inbox for acct %s\n&quot;</span>, szFuncName, strFromAcct.Get());

            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed loading outbox for acct %s\n&quot;</span>, szFuncName, strFromAcct.Get());

            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bIssueCheque)
        {
            <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lStoredTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Create a transaction</span>
            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (ISSUER_USER_ID, DIVIDEND_FROM_ACCT_ID, SERVER_ID,
                                                                               <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>, lStoredTransactionNumber);
            <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a76baae22af2df636d404516ecf5ea06a">OTItem::payDividend</a>);
            pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lTotalCostOfDividend); <span class="comment">// &lt;=== Notice, while the CHEQUE is for lAmountPerShare, the item&#39;s AMOUNT is set to lTotalCostOfDividend.</span>
            <a class="code" href="class_o_t_string.html">OTString</a> strNote(<span class="stringliteral">&quot;Pay Dividend: &quot;</span>);     <span class="comment">// The server just needs both of those, so that&#39;s how we send them (Similar to the voucher code.)</span>
            pItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(strNote);

            <span class="comment">// Add the voucher request string as the attachment on the transaction item.</span>
            theRequestVoucher.SignContract(*pNym);
            theRequestVoucher.SaveContract();
            <a class="code" href="class_o_t_string.html">OTString</a> strVoucher(theRequestVoucher);
            pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strVoucher); <span class="comment">// The voucher request is contained in the reference string.</span>

            <span class="comment">// sign the item</span>
            pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// BALANCE AGREEMENT</span>
            <span class="comment">//</span>
            <span class="comment">// The item is signed and saved within this call as well. No need to do that again.</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(lTotalCostOfDividend*(-1), *pTransaction, *pNym, *pDividendSourceAccount, *pOutbox);

            <span class="comment">// Notice the balance agreement is made for the &quot;total cost of the dividend&quot;, which we calculated as the issuer&#39;s</span>
            <span class="comment">// account balance, times -1, times the amount per share. So for 100,000 shares of Pepsi, at a dividend payout of</span>
            <span class="comment">// $2 per share, then $200,000 must be removed from my dollar account, in order to cover it. Therefore I sign a</span>
            <span class="comment">// balance agreement for $200,000. The server removes it all at once, and then iterates through a loop, sending</span>
            <span class="comment">// vouchers to people. If any fail, or there is any left over, then vouchers are sent back to pNym again, containing</span>
            <span class="comment">// the difference.</span>
            <span class="comment">// todo failsafe: We can&#39;t just loop, int64_t-term, and send a voucher at the end. What if it crashes halfway through</span>
            <span class="comment">// the loop? It seems that the dividend payout still needs to be &quot;REGISTERED&quot; somewhere until successfully completed.</span>
            <span class="comment">// (And therefore, that this concept must be repeated throughout OT for other transactions, not just this example.)</span>
            <span class="comment">// This is already done with Cron, but just thinking about how to best do it for &quot;single action&quot; transactions.</span>

            <span class="keywordflow">if</span> (NULL != pBalanceItem)
                pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
            <span class="comment">// ---------------------------------------------</span>
            <span class="comment">// sign the transaction</span>
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// set up the ledger</span>
            <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(ISSUER_USER_ID, DIVIDEND_FROM_ACCT_ID, SERVER_ID);
            theLedger.GenerateLedger(DIVIDEND_FROM_ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
            theLedger.AddTransaction(*pTransaction);

            <span class="comment">// sign the ledger</span>
            theLedger.SignContract(*pNym);
            theLedger.SaveContract();

            <span class="comment">// extract the ledger in ascii-armored form</span>
            <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

            int64_t lRequestNumber = 0;

            <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
            theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

            <span class="comment">// (1) Set up member variables</span>
            theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
            theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
            theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
            theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

            theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strFromAcct;
            theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
            <span class="keyword">const</span> std::string str_server(strServerID.Get());
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
            NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

            <span class="keywordflow">if</span> (!bNymboxHash)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                              szFuncName, str_server.c_str());

            <span class="comment">// (2) Sign the Message</span>
            theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

            <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
            theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// (Send it)</span>
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback); 
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

            <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No Transaction Numbers were available. &quot;</span>
                       <span class="stringliteral">&quot;Suggest requesting the server for a new one.\n&quot;</span>, szFuncName);

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a04aee43cd2310d2da162f14c771e26cb"></a><!-- doxytag: member="OT_API::PopMessageBuffer" ref="a04aee43cd2310d2da162f14c771e26cb" args="(const int64_t &amp;lRequestNumber, const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_message.html">OTMessage</a> * <a class="el" href="class_o_t___a_p_i.html#a04aee43cd2310d2da162f14c771e26cb">OT_API::PopMessageBuffer</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07738">7738</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>( (m_bInitialized &amp;&amp; (<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> != NULL)) , <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>( lRequestNumber &gt; 0, <span class="stringliteral">&quot;OT_API::PopMessageBuffer: lRequestNumber is less than 1.&quot;</span>);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36e39a99ff4495af7c8766da81d7b29b">GetMessageBuffer</a>().<a class="code" href="class_o_t_message_buffer.html#a4e9d4622eafbb0ea7111a70ee6cea5f7">Pop</a>(lRequestNumber, strServerID, strNymID); <span class="comment">// deletes</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a937dc63294d4d989c0f691b6f12287df"></a><!-- doxytag: member="OT_API::processInbox" ref="a937dc63294d4d989c0f691b6f12287df" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, OTString &amp;ACCT_LEDGER)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a937dc63294d4d989c0f691b6f12287df">OT_API::processInbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_LEDGER</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11742">11742</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::processInbox&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, szFuncName);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strAcctID(ACCT_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;processInbox&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strAcctID;

    <span class="comment">// Presumably ACCT_LEDGER was already set up before this function was called...</span>
    <span class="comment">// See test client for example of it being done.</span>
    theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(ACCT_LEDGER);

    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
    <span class="keyword">const</span> std::string str_server(strServerID.Get());
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
    NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

    <span class="keywordflow">if</span> (!bNymboxHash)
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                      str_server.c_str());

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aafe1988e1f3029dc633666816ccee743"></a><!-- doxytag: member="OT_API::processNymbox" ref="aafe1988e1f3029dc633666816ccee743" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#aafe1988e1f3029dc633666816ccee743">OT_API::processNymbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l11634">11634</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::processNymbox&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(USER_ID);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a>   theMessage;
    <span class="keywordtype">bool</span>        bSuccess        = <span class="keyword">false</span>;
    int32_t         nReceiptCount   = (-1);
    int32_t         nRequestNum     = (-1);
    <span class="keywordtype">bool</span>        bIsEmpty        = <span class="keyword">true</span>;

    {
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>         &amp; theNym    = *pNym;
        <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>    &amp; theServer = *pServer;

        <span class="comment">// Load up the appropriate Nymbox...</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theNymbox (USER_ID, USER_ID, SERVER_ID);

        <span class="keywordtype">bool</span>    bLoadedNymbox   = theNymbox.LoadNymbox();
        <span class="keywordtype">bool</span>    bVerifiedNymbox = bLoadedNymbox ? theNymbox.VerifyAccount(theNym) : <span class="keyword">false</span>;

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == bLoadedNymbox)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::processNymbox: Failed loading Nymbox: %s \n&quot;</span>,
                           strNymID.Get());
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == bVerifiedNymbox)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::processNymbox: Failed verifying Nymbox: %s \n&quot;</span>,
                           strNymID.Get());
        <span class="comment">// --------------------------------------</span>
        <span class="keywordflow">else</span>
        {
            nReceiptCount   = theNymbox.GetTransactionCount();
            bIsEmpty        = (nReceiptCount &lt; 1);

            <span class="comment">// -----------------</span>
            <span class="keywordflow">if</span> (!bIsEmpty)
                bSuccess = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba6f91239e6035d1c426d0d00e7537e">AcceptEntireNymbox</a>(theNymbox, SERVER_ID, theServer, theNym, theMessage);
            <span class="comment">// -----------------</span>

            <span class="keywordflow">if</span> (!bSuccess)
            {
                <span class="keywordflow">if</span> (bIsEmpty)
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OT_API::processNymbox: Nymbox (%s) is empty (so, skipping processNymbox.)\n&quot;</span>,
                                   strNymID.Get());
                    nRequestNum   = 0;
                    nReceiptCount = 0; <span class="comment">//redundant.</span>
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::processNymbox: Failed trying to accept the entire Nymbox. (And no, it&#39;s not empty.)\n&quot;</span>);
                    nReceiptCount = (-1);
                }
            }
            <span class="keywordflow">else</span>    <span class="comment">// Success!</span>
            {
                <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
                <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
                <span class="keyword">const</span> std::string str_server(strServerID.Get());
                <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = theNym.<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
                NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

                <span class="keywordflow">if</span> (!bNymboxHash)
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                                  str_server.c_str());

                <span class="comment">// (2) Sign the Message</span>
                theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(theNym);

                <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
                theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            }
        }
        <span class="comment">// --------------------------------------</span>
    }

    <span class="keywordflow">if</span> (bSuccess)
    {
        <span class="comment">// Instead of the receipt count, in the case of success sending, we return the</span>
        <span class="comment">// actual request number for the message that was sent.</span>
        <span class="comment">// (Otherwise 0 means Nymbox was empty, and -1 means there was an error.)</span>
        <span class="comment">//</span>
        nRequestNum = atoi(theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> nRequestNum;
    }
    <span class="comment">// if successful, ..., else if not successful--and wasn&#39;t empty--then error.</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bIsEmpty)
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error performing processNymbox command in OT_API::processNymbox\n&quot;</span>);

    <span class="keywordflow">return</span> nReceiptCount;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5c416b1b8178998dad0f7357498974a3"></a><!-- doxytag: member="OT_API::ProposePaymentPlan" ref="a5c416b1b8178998dad0f7357498974a3" args="(const OTIdentifier &amp;SERVER_ID, const time64_t &amp;VALID_FROM, const time64_t &amp;VALID_TO, const OTIdentifier &amp;SENDER_ACCT_ID, const OTIdentifier &amp;SENDER_USER_ID, const OTString &amp;PLAN_CONSIDERATION, const OTIdentifier &amp;RECIPIENT_ACCT_ID, const OTIdentifier &amp;RECIPIENT_USER_ID, const int64_t &amp;INITIAL_PAYMENT_AMOUNT, const time64_t &amp;INITIAL_PAYMENT_DELAY, const int64_t &amp;PAYMENT_PLAN_AMOUNT, const time64_t &amp;PAYMENT_PLAN_DELAY, const time64_t &amp;PAYMENT_PLAN_PERIOD, time64_t PAYMENT_PLAN_LENGTH=OT_TIME_ZERO, int32_t PAYMENT_PLAN_MAX_PAYMENTS=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payment_plan.html">OTPaymentPlan</a> * <a class="el" href="class_o_t___a_p_i.html#a5c416b1b8178998dad0f7357498974a3">OT_API::ProposePaymentPlan</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>VALID_FROM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>VALID_TO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>PLAN_CONSIDERATION</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>INITIAL_PAYMENT_AMOUNT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>INITIAL_PAYMENT_DELAY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>PAYMENT_PLAN_AMOUNT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>PAYMENT_PLAN_DELAY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>PAYMENT_PLAN_PERIOD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>PAYMENT_PLAN_LENGTH</em> = <code><a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>PAYMENT_PLAN_MAX_PAYMENTS</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04803">4803</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{                                                                                   <span class="comment">// two arguments are optional.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(RECIPIENT_USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs, ASSERTs, etc.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, RECIPIENT_ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> * pPlan = <span class="keyword">new</span> <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>(SERVER_ID,
                                              pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>(),
                                              SENDER_ACCT_ID,
                                              SENDER_USER_ID,
                                              RECIPIENT_ACCT_ID,
                                              RECIPIENT_USER_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pPlan, <span class="stringliteral">&quot;OT_API::ProposePaymentPlan: Error allocating memory in the OT API for new OTPaymentPlan.\n&quot;</span>);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// At this point, I know that pPlan is a good pointer that I either</span>
    <span class="comment">// have to delete, or return to the caller. CLEANUP WARNING!</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSuccessSetProposal =
            pPlan-&gt;<a class="code" href="class_o_t_agreement.html#ac02afd651c21e1df34c97061c30706fe">SetProposal</a>(*pNym, PLAN_CONSIDERATION, VALID_FROM, VALID_TO);
    <span class="comment">// ************************************************</span>
    <span class="comment">// WARNING!!!! SetProposal() burns TWO transaction numbers for RECIPIENT. (*pNym)</span>
    <span class="comment">// BELOW THIS POINT, if you have an error, then you must retrieve those numbers from</span>
    <span class="comment">// the plan, and set them BACK on pNym before you return!!!</span>
    <span class="comment">// ------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

    <span class="keywordflow">if</span> (!bSuccessSetProposal)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to set the proposal.\n&quot;</span>, __FUNCTION__);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">HarvestOpeningNumber</a> (*pNym);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(*pNym);
        <span class="keyword">delete</span> pPlan; pPlan = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSuccessSetInitialPayment  = <span class="keyword">true</span>; <span class="comment">// the default, in case user chooses not to even have this payment.</span>
    <span class="keywordtype">bool</span> bSuccessSetPaymentPlan     = <span class="keyword">true</span>; <span class="comment">// the default, in case user chooses not to have a payment plan</span>
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> ((INITIAL_PAYMENT_AMOUNT &gt; 0) &amp;&amp; (INITIAL_PAYMENT_DELAY &gt;= <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>))
    {
        <span class="comment">// The Initial payment delay is measured in seconds, starting from the &quot;Creation Date&quot;.</span>
        bSuccessSetInitialPayment = pPlan-&gt;<a class="code" href="class_o_t_payment_plan.html#ae51fed6db87911877df2324e231da710">SetInitialPayment</a>(INITIAL_PAYMENT_AMOUNT, INITIAL_PAYMENT_DELAY);
    }
    <span class="keywordflow">if</span> (!bSuccessSetInitialPayment)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to set the initial payment.\n&quot;</span>, __FUNCTION__);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">HarvestOpeningNumber</a> (*pNym);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(*pNym);
        <span class="keyword">delete</span> pPlan; pPlan = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">//                &quot; 6 minutes   ==      360 Seconds\n&quot;</span>
    <span class="comment">//                &quot;10 minutes   ==      600 Seconds\n&quot;</span>
    <span class="comment">//                &quot;1 hour       ==     3600 Seconds\n&quot;</span>
    <span class="comment">//                &quot;1 day        ==    86400 Seconds\n&quot;</span>
    <span class="comment">//                &quot;30 days      ==  2592000 Seconds\n&quot;</span>
    <span class="comment">//                &quot;3 months     ==  7776000 Seconds\n&quot;</span>
    <span class="comment">//                &quot;6 months     == 15552000 Seconds\n\n&quot;</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (PAYMENT_PLAN_AMOUNT &gt; 0) <span class="comment">// If there are regular payments.</span>
    {
        <span class="comment">// -----------------------------------------------------------------------</span>
        <span class="comment">// The payment plan delay is measured in seconds, starting from the &quot;Creation Date&quot;.</span>
        <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    PAYMENT_DELAY = <a class="code" href="_o_t_common_8hpp.html#af04aead93a0e4b740d061e043c26c601">OT_TIME_MONTH_IN_SECONDS</a>; <span class="comment">// Defaults to 30 days, measured in seconds (if you pass 0.)</span>

        <span class="keywordflow">if</span> (PAYMENT_PLAN_DELAY &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>)
            PAYMENT_DELAY = PAYMENT_PLAN_DELAY;
        <span class="comment">// -----------------------------------------------------------------------</span>
        <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    PAYMENT_PERIOD = <a class="code" href="_o_t_common_8hpp.html#af04aead93a0e4b740d061e043c26c601">OT_TIME_MONTH_IN_SECONDS</a>; <span class="comment">// Defaults to 30 days, measured in seconds (if you pass 0.)</span>

        <span class="keywordflow">if</span> (PAYMENT_PLAN_PERIOD &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>)
            PAYMENT_PERIOD = PAYMENT_PLAN_PERIOD;
        <span class="comment">// -----------------------------------------------------------------------</span>
        <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    PLAN_LENGTH = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>; <span class="comment">// Defaults to 0 seconds (for no max length).</span>

        <span class="keywordflow">if</span> (PAYMENT_PLAN_LENGTH &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>)
            PLAN_LENGTH = PAYMENT_PLAN_LENGTH;
        <span class="comment">// -----------------------------------------------------------------------</span>
        int32_t nMaxPayments = 0; <span class="comment">// Defaults to 0 maximum payments (for no maximum).</span>

        <span class="keywordflow">if</span> (PAYMENT_PLAN_MAX_PAYMENTS &gt; 0)
            nMaxPayments = PAYMENT_PLAN_MAX_PAYMENTS;
        <span class="comment">// -----------------------------------------------------------------------</span>
        bSuccessSetPaymentPlan = pPlan-&gt;<a class="code" href="class_o_t_payment_plan.html#a14669877c3f817148180d2556d63e839">SetPaymentPlan</a>(PAYMENT_PLAN_AMOUNT,
                                                       PAYMENT_DELAY, PAYMENT_PERIOD,
                                                       PLAN_LENGTH, nMaxPayments);
    }
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordflow">if</span> (!bSuccessSetPaymentPlan)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to set the payment plan.\n&quot;</span>, __FUNCTION__);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">HarvestOpeningNumber</a> (*pNym);
        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(*pNym);
        <span class="keyword">delete</span> pPlan; pPlan = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ------------------------------------------------</span>
    pPlan-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym); <span class="comment">// Here we have saved the MERCHANT&#39;s VERSION.</span>
    pPlan-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();      <span class="comment">// A copy of this will be attached to the CUSTOMER&#39;s version as well.</span>
    <span class="comment">// ------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// DROP A COPY into the Outpayments box...</span>
    <span class="comment">//</span>
    <span class="comment">// (Since we used a transaction number to propose the plan, we</span>
    <span class="comment">// have to track it until it&#39;s deposited or until we cancel it.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInstrument(*pPlan);
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(RECIPIENT_USER_ID), strNymID2(SENDER_USER_ID);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outpaymentsMessage&quot;</span>;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>       = strNymID2;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>     = strServerID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strInstrument);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
    pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);
    <span class="comment">// ------------------------------</span>
    <span class="keywordflow">return</span> pPlan;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adc667ad801925aaddd138f0dd7d0770e"></a><!-- doxytag: member="OT_API::Purse_Empty" ref="adc667ad801925aaddd138f0dd7d0770e" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTString &amp;THE_PURSE, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#adc667ad801925aaddd138f0dd7d0770e">OT_API::Purse_Empty</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05610">5610</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Making an empty copy of a cash purse.&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<span class="comment">//  OTPasswordData thePWData(strReason);</span>
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_purse.html#ac6779fce5508f7d2dc2e02c22595d7e0">OTPurse::PurseFactory</a>(THE_PURSE, SERVER_ID, ASSET_TYPE_ID);

    <span class="keywordflow">if</span> (NULL == pPurse)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: THE_PURSE is an empty string. Please pass a &quot;</span>
                       <span class="stringliteral">&quot;real purse when calling this function.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------</span>
    pPurse-&gt;ReleaseTokens();
    <span class="comment">// NOTE: Caller must release/sign/save pReturnPurse, once this returns, in order to effect the change.</span>
    <span class="keywordflow">return</span> pPurse;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac4922a16395e2da553cf4f0bd0fdaf62"></a><!-- doxytag: member="OT_API::Purse_Peek" ref="ac4922a16395e2da553cf4f0bd0fdaf62" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTString &amp;THE_PURSE, const OTIdentifier *pOWNER_ID=NULL, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_token.html">OTToken</a> * <a class="el" href="class_o_t___a_p_i.html#ac4922a16395e2da553cf4f0bd0fdaf62">OT_API::Purse_Peek</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOWNER_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns the TOKEN on top of the stock (LEAVING it on top of the stack, but giving you a decrypted copy of it.)</p>
<p>USER_ID can be NULL, **if** the purse is password-protected. (It's just ignored in that case.) Otherwise MUST contain the NymID for the Purse owner (necessary to decrypt the token.)</p>
<p>CALLER must delete!!</p>
<p>returns NULL if failure. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05465">5465</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::Purse_Peek&quot;</span>;
    <span class="comment">// -----------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason1((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter your master passphrase for your wallet. (Purse_Peek)&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason2((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter the passphrase for this purse. (Purse_Peek)&quot;</span>          : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<span class="comment">//  OTPasswordData thePWData(strReason);</span>
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a>    thePurse(SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="class_o_t_password.html">OTPassword</a> thePassword; <span class="comment">// Only used in the case of password-protected purses.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// What&#39;s going on here?</span>
    <span class="comment">// A purse can be encrypted by a private key (controlled by a Nym) or by a symmetric</span>
    <span class="comment">// key (embedded inside the purse along with a corresponding master key.) The below</span>
    <span class="comment">// function is what actually loads up thePurse from string (THE_PURSE) and this call</span>
    <span class="comment">// also returns pOwner, which is a pointer to a special wrapper class (which you must</span>
    <span class="comment">// delete, when you&#39;re done with it) which contains a pointer EITHER to the owner Nym</span>
    <span class="comment">// for that purse, OR to the &quot;owner&quot; symmetric key for that purse.</span>
    <span class="comment">//</span>
    <span class="comment">// This way, any subsequent purse operations can use pOwner, regardless of whether there</span>
    <span class="comment">// is actually a Nym inside, or a symmetric key. (None of the purse operations will care,</span>
    <span class="comment">// since they can use pOwner either way.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a8f169045c3550424b6b28df54539a183">LoadPurseAndOwnerFromString</a>(SERVER_ID, ASSET_TYPE_ID,
                                                                       THE_PURSE, thePurse, thePassword,
                                                                       <span class="keyword">false</span>, <span class="comment">// bForEncrypting=true by default. (Peek needs to decrypt.)</span>
                                                                       pOWNER_ID,
                                                                       &amp;strReason1, &amp;strReason2);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOwnerAngel(pOwner);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pOwner) <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs, no need for more logs.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = NULL;

    <span class="keywordflow">if</span> (thePurse.IsEmpty())
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed attempt to peek; purse is empty.\n&quot;</span>, szFunc);
    <span class="keywordflow">else</span>
    {
        pToken = thePurse.Peek(*pOwner);

        <span class="keywordflow">if</span> (NULL == pToken)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed peeking a token from a &quot;</span>
                           <span class="stringliteral">&quot;purse that supposedly had tokens on it...\n&quot;</span>, szFunc);
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">return</span> pToken;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a71b132b76b09ced31829d59348aa6a08"></a><!-- doxytag: member="OT_API::Purse_Pop" ref="a71b132b76b09ced31829d59348aa6a08" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTString &amp;THE_PURSE, const OTIdentifier *pOWNER_ID=NULL, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#a71b132b76b09ced31829d59348aa6a08">OT_API::Purse_Pop</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOWNER_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns the PURSE after popping a single token off of it.</p>
<p>NOTE: Caller must delete! NOTE: Caller must sign/save in order to effect the change.</p>
<p>OWNER_ID can be NULL, **if** the purse is password-protected. (It's just ignored in that case.) Otherwise MUST contain the NymID for the Purse owner (necessary to decrypt the token.)</p>
<p>The reason you don't see a signer being passed here (to save the purse again, after popping) is because <a class="el" href="_o_t_a_p_i_8cpp.html">OTAPI.cpp</a> Purse_Pop does the saving. (That's the function that calls this one.) So IT has a signer ID passed in, in addition to the owner ID--but we don't need that here.)</p>
<p>returns NULL if failure. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05542">5542</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason1((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter your master passphrase for your wallet. (Purse_Pop)&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason2((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter the passphrase for this purse. (Purse_Pop)&quot;</span>          : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<span class="comment">//  OTPasswordData thePWData(strReason);</span>
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a>    * pPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPurse);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse); <span class="comment">// We&#39;ll unset this in success case, so it doesn&#39;t delete the purse we&#39;re returning.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> thePassword; <span class="comment">// Only used in the case of password-protected purses.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// What&#39;s going on here?</span>
    <span class="comment">// A purse can be encrypted by a private key (controlled by a Nym) or by a symmetric</span>
    <span class="comment">// key (embedded inside the purse along with a corresponding master key.) The below</span>
    <span class="comment">// function is what actually loads up pPurse from string (THE_PURSE) and this call</span>
    <span class="comment">// also returns pOwner, which is a pointer to a special wrapper class (which you must</span>
    <span class="comment">// delete, when you&#39;re done with it) which contains a pointer EITHER to the owner Nym</span>
    <span class="comment">// for that purse, OR to the &quot;owner&quot; symmetric key for that purse.</span>
    <span class="comment">//</span>
    <span class="comment">// This way, any subsequent purse operations can use pOwner, regardless of whether there</span>
    <span class="comment">// is actually a Nym inside, or a symmetric key. (None of the purse operations will care,</span>
    <span class="comment">// since they can use pOwner either way.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a8f169045c3550424b6b28df54539a183">LoadPurseAndOwnerFromString</a>(SERVER_ID, ASSET_TYPE_ID,
                                                                       THE_PURSE, *pPurse, thePassword,
                                                                       <span class="keyword">false</span>, <span class="comment">//bForEncrypting=true by default, but Pop needs to decrypt.</span>
                                                                       pOWNER_ID,
                                                                       &amp;strReason1, &amp;strReason2);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOwnerAngel(pOwner);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pOwner) <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs, no need for more logs.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pReturnPurse = NULL;

    <span class="keywordflow">if</span> (pPurse-&gt;IsEmpty())
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed attempt to pop; purse is empty.\n&quot;</span>, __FUNCTION__);
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = pPurse-&gt;Pop(*pOwner);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);

        <span class="keywordflow">if</span> (NULL == pToken)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed popping a token from a &quot;</span>
                           <span class="stringliteral">&quot;purse that supposedly had tokens on it...\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">else</span>
        {
            pReturnPurse = pPurse;
            thePurseAngel.SetCleanupTargetPointer(NULL); <span class="comment">// We don&#39;t clean up the purse in the case where we&#39;re returning it.</span>
        }
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">return</span> pReturnPurse;

    <span class="comment">// NOTE: Caller must release/sign/save pReturnPurse, once this returns, in order to effect the change.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a480eef589ef3fd1f416930540e46082f"></a><!-- doxytag: member="OT_API::Purse_Push" ref="a480eef589ef3fd1f416930540e46082f" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTString &amp;THE_PURSE, const OTString &amp;THE_TOKEN, const OTIdentifier *pOWNER_ID=NULL, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_purse.html">OTPurse</a> * <a class="el" href="class_o_t___a_p_i.html#a480eef589ef3fd1f416930540e46082f">OT_API::Purse_Push</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_TOKEN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOWNER_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns the PURSE after pushing a single token onto it.</p>
<p>NOTE: Caller must delete! NOTE: Caller must sign/save in order to effect the change.</p>
<p>USER_ID can be NULL, **if** the purse is password-protected. (It's just ignored in that case.) Otherwise MUST contain the NymID for the Purse owner (necessary to encrypt the token.)</p>
<p>returns NULL if failure. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05649">5649</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason1((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter your master passphrase for your wallet. (Purse_Push)&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason2((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter the passphrase for this purse. (Purse_Push)&quot;</span>          : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<span class="comment">//  OTPasswordData thePWData(strReason);</span>
    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">if</span> (!THE_PURSE.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Purse does not exist.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!THE_TOKEN.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Token does not exist.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
    <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);

    <span class="keywordflow">if</span> (NULL == pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to instantiate or load token from string:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_TOKEN.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a>    * pPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPurse);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse); <span class="comment">// We&#39;ll unset this in success case, so it doesn&#39;t delete the purse we&#39;re returning.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> thePassword; <span class="comment">// Only used in the case of password-protected purses.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// What&#39;s going on here?</span>
    <span class="comment">// A purse can be encrypted by a private key (controlled by a Nym) or by a symmetric</span>
    <span class="comment">// key (embedded inside the purse along with a corresponding master key.) The below</span>
    <span class="comment">// function is what actually loads up pPurse from string (THE_PURSE) and this call</span>
    <span class="comment">// also returns pOwner, which is a pointer to a special wrapper class (which you must</span>
    <span class="comment">// delete, when you&#39;re done with it) which contains a pointer EITHER to the owner Nym</span>
    <span class="comment">// for that purse, OR to the &quot;owner&quot; symmetric key for that purse.</span>
    <span class="comment">//</span>
    <span class="comment">// This way, any subsequent purse operations can use pOwner, regardless of whether there</span>
    <span class="comment">// is actually a Nym inside, or a symmetric key. (None of the purse operations will care,</span>
    <span class="comment">// since they can use pOwner either way.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a8f169045c3550424b6b28df54539a183">LoadPurseAndOwnerFromString</a>(SERVER_ID, ASSET_TYPE_ID,
                                                                       THE_PURSE, *pPurse, thePassword,
                                                                       <span class="keyword">true</span>, <span class="comment">//bForEncrypting=true by default.</span>
                                                                       pOWNER_ID,
                                                                       &amp;strReason1, &amp;strReason2);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOwnerAngel(pOwner);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pOwner) <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs, no need for more logs.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pReturnPurse = NULL;

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bPushed = pPurse-&gt;<a class="code" href="class_o_t_purse.html#a1494538d965842e3fa3d1b9ac2b6dd25">Push</a>(*pOwner, *pToken);

    <span class="keywordflow">if</span> (!bPushed)
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed pushing a token onto a purse.\n&quot;</span>, __FUNCTION__);
    <span class="keywordflow">else</span>
    {
        pReturnPurse = pPurse;
        thePurseAngel.SetCleanupTargetPointer(NULL); <span class="comment">// We don&#39;t clean up the purse in the case where we&#39;re returning it.</span>
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">return</span> pReturnPurse;

    <span class="comment">// NOTE: Caller must release/sign/save pReturnPurse, once this returns, in order to effect the change.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1188ffba89c5ab70a5924effb4f0477"></a><!-- doxytag: member="OT_API::queryAssetTypes" ref="ab1188ffba89c5ab70a5924effb4f0477" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTASCIIArmor &amp;ENCODED_MAP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ab1188ffba89c5ab70a5924effb4f0477">OT_API::queryAssetTypes</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>ENCODED_MAP</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12036">12036</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">/*</span>
<span class="comment">     // Java code will create a StringMap object:</span>
<span class="comment"></span>
<span class="comment">        String strEncodedObj(&quot;&quot;); // output will go here.</span>
<span class="comment">        StringMap stringMap = null; // we are about to create this object</span>
<span class="comment"></span>
<span class="comment">        Storable storable = otapi.CreateObject(StoredObjectType.STORED_OBJ_STRING_MAP);</span>
<span class="comment"></span>
<span class="comment">        if (storable != null)</span>
<span class="comment">        {</span>
<span class="comment">            stringMap = StringMap.ot_dynamic_cast(storable);</span>
<span class="comment">            if (stringMap != null)</span>
<span class="comment">            {</span>
<span class="comment">                // ADD ALL THE ASSET IDs HERE (To the string map, so you</span>
<span class="comment">                // can ask the server about them...)</span>
<span class="comment">                //</span>
<span class="comment">                for_each(the asset IDs you want to query the server about)</span>
<span class="comment">                {</span>
<span class="comment">                    stringMap.SetValue(ASSET_TYPE_ID, &quot;exists&quot;);</span>
<span class="comment">                }</span>
<span class="comment"></span>
<span class="comment">                strEncodedObj = otapi.EncodeObject(stringMap);</span>
<span class="comment">            }</span>
<span class="comment">        }</span>
<span class="comment"></span>
<span class="comment">        if (null == strEncodedObj)</span>
<span class="comment">            Error;</span>
<span class="comment">     ----------------------------------------------------------------------</span>
<span class="comment"></span>
<span class="comment">        Then send the server message:</span>
<span class="comment"></span>
<span class="comment">     var theRequest := OTAPI_Func(ot_Msg.QUERY_ASSET_TYPES, SERVER_ID, NYM_ID, strEncodedObj);</span>
<span class="comment">     var    strResponse = theRequest.SendRequest(theRequest, &quot;QUERY_ASSET_TYPES&quot;);</span>
<span class="comment"></span>
<span class="comment">     String strReplyMap = null;</span>
<span class="comment"></span>
<span class="comment">     // When the server reply comes back, get the payload from it:</span>
<span class="comment">     //</span>
<span class="comment">     if (strResponse != null)</span>
<span class="comment">        strReplyMap = OT_API_Message_GetPayload(strReply);</span>
<span class="comment">     ----------------------------------------------------------------------</span>
<span class="comment"></span>
<span class="comment">        //  Pass the payload (the StringMap from the server&#39;s reply) to otapi.DecodeObject:</span>
<span class="comment">        //</span>
<span class="comment">        if (strReplyMap != null)</span>
<span class="comment">        {</span>
<span class="comment">            StringMap stringMap = null;</span>
<span class="comment">            Storable storable = otapi.DecodeObject(StoredObjectType.STORED_OBJ_STRING_MAP, strReplyMap);</span>
<span class="comment">            if (storable != null)</span>
<span class="comment">            {</span>
<span class="comment">                stringMap = StringMap.ot_dynamic_cast(storable);</span>
<span class="comment">                if (stringMap != null)</span>
<span class="comment">                {</span>
<span class="comment">                    // Loop through string map. For each asset ID key, the value will</span>
<span class="comment">                    // say either &quot;true&quot; or &quot;false&quot;.</span>
<span class="comment">                    //</span>
<span class="comment">                    for_each(stringMap)</span>
<span class="comment">                    {</span>
<span class="comment">                        strValue = stringMap.GetValue(ASSET_TYPE_ID);</span>
<span class="comment"></span>
<span class="comment">                        if (strValue.compare(&quot;true&quot;) == 0)</span>
<span class="comment">                        {</span>
<span class="comment">                            // ... do something here ...</span>
<span class="comment">                        }</span>
<span class="comment">                    }</span>
<span class="comment">                }</span>
<span class="comment">            }</span>
<span class="comment">        }</span>
<span class="comment"></span>
<span class="comment">     */</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::queryAssetTypes&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;queryAssetTypes&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ENCODED_MAP;

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad96c4b1b56f797482b7383072b9037db"></a><!-- doxytag: member="OT_API::RecordPayment" ref="ad96c4b1b56f797482b7383072b9037db" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, bool bIsInbox, int32_t nIndex, bool bSaveCopy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ad96c4b1b56f797482b7383072b9037db">OT_API::RecordPayment</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bIsInbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bSaveCopy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l06753">6753</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a>  * pRecordBox  = NULL;
    <a class="code" href="class_o_t_ledger.html">OTLedger</a>  * pExpiredBox = NULL;
    <a class="code" href="class_o_t_ledger.html">OTLedger</a>  * pActualBox  = NULL; <span class="comment">// This points to either pRecordBox or pExpiredBox.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theRecordBoxAngel;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theExpiredBoxAngel;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (bSaveCopy)
    {
        pRecordBox  = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a318f160f9a43ac68afcf415ff51ae267">LoadRecordBox</a> (SERVER_ID, USER_ID, USER_ID);
        pExpiredBox = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ae3d6ecd9fabfea445d35fd7307008856">LoadExpiredBox</a>(SERVER_ID, USER_ID);
        <span class="comment">// -----------------------------------------------------</span>
        theRecordBoxAngel .<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pRecordBox);
        theExpiredBoxAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pExpiredBox);
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (NULL == pRecordBox)
        {
            pRecordBox = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>, <span class="keyword">true</span>);
            <span class="keywordflow">if</span> (NULL  == pRecordBox)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load or create record box (and thus unable to do anything with it.)\n&quot;</span>,
                              __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            theRecordBoxAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pRecordBox);
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (NULL == pExpiredBox)
        {
            pExpiredBox = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(USER_ID, USER_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>, <span class="keyword">true</span>);
            <span class="keywordflow">if</span> (NULL   == pExpiredBox)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load or create expired box (and thus unable to do anything with it.)\n&quot;</span>,
                              __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            theExpiredBoxAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pExpiredBox);
        }
    }
    <span class="comment">// -----------------------------------------------------</span>
    pActualBox  = pRecordBox;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pPaymentInbox  = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> thePaymentBoxAngel;

    <span class="keywordtype">bool</span> bIsExpired = <span class="keyword">false</span>;

    <span class="comment">//first block:</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransactionAngel;

    <span class="comment">//second block:</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMessage&gt;</a> theMessageAngel;

    <span class="keywordtype">bool</span> bRemoved = <span class="keyword">false</span>, bNeedToSaveTheNym = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (bIsInbox)
    {
        pPaymentInbox = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a5077987cf25f441923c88cb51b3d940a">LoadPaymentInbox</a>(SERVER_ID, USER_ID);
        <span class="comment">// -----------------------------------------------------</span>
        thePaymentBoxAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pPaymentInbox);
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (NULL == pPaymentInbox)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load payment inbox (and thus unable to do anything with it.)\n&quot;</span>,
                          __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>()))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to find transaction in payment inbox based on index %d. (Out of bounds.)\n&quot;</span>,
                          __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ---------------------</span>
        pTransaction = pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex);

        <span class="keywordflow">if</span> (NULL == pTransaction)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to find transaction in payment inbox based on index %d.\n&quot;</span>,
                          __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// -----------------------------------------------------</span>
        <a class="code" href="class_o_t_payment.html">OTPayment</a> * pPayment  = pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#a114a4d31098807d6cb873a7343a407ae">GetInstrument</a>(*pNym, nIndex);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPayment&gt;</a> thePaymentAngel(pPayment);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPayment);

        pPayment-&gt;<a class="code" href="class_o_t_payment.html#a1949cd91091734be36e607c3a2877822">IsExpired</a>(bIsExpired);

        <span class="keywordflow">if</span> (bIsExpired)
            pActualBox = pExpiredBox;
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// Remove it from the payments inbox...</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#aea09d3dd8bf2fc5630ce87184fc937c1">DeleteBoxReceipt</a>(lTransactionNum))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to delete the box receipt for a transaction being removed &quot;</span>
                          <span class="stringliteral">&quot;from the payment inbox: %ld\n&quot;</span>, __FUNCTION__, lTransactionNum);
        }
        <span class="comment">// -----------------------------------------------------</span>
        bRemoved = pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a>(lTransactionNum, <span class="keyword">false</span>); <span class="comment">// bDeleteIt=true by default. We pass false since we are moving it to another box. Note that we still need to save pPaymentInbox somewhere below, assuming it&#39;s all successful.</span>
        theTransactionAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction); <span class="comment">// If below we put pTransaction onto the Record Box, then we have to set this to NULL.</span>

        <span class="comment">// NOTE: pTransaction is still good, below this point, and will be cleaned up automatically</span>
        <span class="comment">// whenever we exit this function.</span>

        <span class="comment">// Anything else?</span>
        <span class="comment">// Note: no need to harvest transaction number for incoming payments.</span>
        <span class="comment">// But for outgoing (see below) then harvesting becomes an issue.</span>

    }
    <span class="keywordflow">else</span> <span class="comment">// Outpayments box (which is not stored in an OTLedger like payments inbox, but rather, is stored similarly to outmail.)</span>
    {
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66289f0575ef0b91cb5fefa4483f0d3e" title="return the number of payments items available for this Nym.">GetOutpaymentsCount</a>()))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to find payment in outpayment box based on index %d. (Out of bounds.)\n&quot;</span>,
                          __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ---------------------</span>
        pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acb808e89943f1f2d0009825a3fbcb34f">GetOutpaymentsByIndex</a>(nIndex);

        <span class="keywordflow">if</span> (NULL == pMessage)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to find payment message in outpayment box based on index %d.\n&quot;</span>,
                          __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ---------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strInstrument;
        <span class="keywordflow">if</span> (!pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strInstrument))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to find payment instrument in outpayment message at index %d.\n&quot;</span>,
                          __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ---------------------</span>
        <a class="code" href="class_o_t_payment.html">OTPayment</a>  thePayment(strInstrument);
        int64_t       lPaymentOpeningNum = 0;
        int64_t       lPaymentTransNum   = 0;

        <span class="keywordflow">if</span> (thePayment.IsValid() &amp;&amp; thePayment.SetTempValues())
        {
            <span class="comment">// EXPIRED?</span>
            <span class="comment">//</span>
            thePayment.IsExpired(bIsExpired);

            <span class="keywordflow">if</span> (bIsExpired)
                pActualBox = pExpiredBox;
            <span class="comment">// ----------------------------------------------------------------</span>
            <span class="comment">// Anything but a purse?</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (thePayment.GetOpeningNum(lPaymentOpeningNum, USER_ID)) <span class="comment">// cheques, invoices, vouchers, smart contracts, payment plans.</span>
            {
                <span class="comment">// We we-grab the transaction number at this time. That way if it&#39;s a transaction num that</span>
                <span class="comment">// belongs to some other Nym (and is different than our own opening number) then we will</span>
                <span class="comment">// get the different number here.</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == thePayment.GetTransactionNum(lPaymentTransNum))
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Should never happen! &quot;</span>
                                  <span class="stringliteral">&quot;Failed to get transaction num from payment RIGHT AFTER succeeded getting opening num.\n&quot;</span>,
                                  __FUNCTION__);
                }
                <span class="comment">// ----------------------------------------------------------</span>
                <span class="comment">// However, if it IS a different number, in the case of smart contracts and payment plans,</span>
                <span class="comment">// we then change it BACK to the opening number again. Read the next comment for details why.</span>
                <span class="comment">//</span>
                <span class="keywordtype">bool</span> bIsRecurring = <span class="keyword">false</span>;

                <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_payment.html#aff3d9ae26dc36bc91037fe53db0d55d0a78fc70e3c86977fdac8bb86f5df8fee2">OTPayment::PAYMENT_PLAN</a>   == thePayment.GetType()) ||
                    (<a class="code" href="class_o_t_payment.html#aff3d9ae26dc36bc91037fe53db0d55d0ac5f087c87496d75a8a50790118d057f1">OTPayment::SMART_CONTRACT</a> == thePayment.GetType()))
                {
                    bIsRecurring     = <span class="keyword">true</span>;
                    lPaymentTransNum = lPaymentOpeningNum;
                    <span class="comment">// We do this because the ACTUAL transaction number on a smart contract or payment plan</span>
                    <span class="comment">// might be different that THIS Nym&#39;s opening number (it might be some other Nym&#39;s opening</span>
                    <span class="comment">// number.) But even if that&#39;s the case, we still want to harvest THIS Nym&#39;s opening number,</span>
                    <span class="comment">// not the other Nym&#39;s opening number. So for these instruments, we set the &quot;transaction number&quot;</span>
                    <span class="comment">// to be THIS Nym&#39;s opening number. (Versus just saying, &quot;Oh the trans number is for some other</span>
                    <span class="comment">// Nym, so just ignore this&quot; which would cause us to not harvest the numbers for THIS Nym that</span>
                    <span class="comment">// we probably SHOULD be harvesting.</span>
                }

                <span class="comment">// See what account the payment instrument is drawn from.</span>
                <span class="comment">// Is it mine?</span>
                <span class="comment">// If so, load up the inbox and see if there are any related receipts inside.</span>
                <span class="comment">// If so, do NOT harvest the transaction numbers from the instrument.</span>
                <span class="comment">// Otherwise, harvest them. (The instrument hasn&#39;t been redeemed yet.)</span>
                <span class="comment">// Also, use the transaction number on the instrument to see if it&#39;s signed out to me.</span>
                <span class="comment">//</span>
                <span class="comment">// Hmm: If the instrument is definitely expired, and there&#39;s definitely nothing in the asset</span>
                <span class="comment">// accountinbox, then I can DEFINITELY harvest it back.</span>
                <span class="comment">//</span>
                <span class="comment">// But if the instrument is definitely NOT expired, and the transaction # IS signed out to ME,</span>
                <span class="comment">// then I can&#39;t just harvest the numbers, since the original recipient could still come through</span>
                <span class="comment">// and deposit that cheque. So in this case, I would HAVE to cancel the transaction, and then</span>
                <span class="comment">// such cancellation would automatically harvest while processing the successful server reply.</span>
                <span class="comment">//</span>
                <span class="comment">// Therefore make sure not to move the instrument here, unless it&#39;s definitely expired.</span>
                <span class="comment">// Whereas if it&#39;s not expired, then the API must cancel it with the server, and can&#39;t simply</span>
                <span class="comment">// come in here and move/harvest it. So this function can only be for expired transactions or</span>
                <span class="comment">// those where the transaction number is no longer issued. (And in cases where it&#39;s expired but</span>
                <span class="comment">// STILL issued, then it definitely DOES need to harvest.)</span>
                <span class="comment">//</span>

                <span class="keywordtype">bool</span> bShouldHarvestPayment     = <span class="keyword">false</span>;
                <span class="keywordtype">bool</span> bNeedToLoadAssetAcctInbox = <span class="keyword">false</span>;
                <span class="keywordtype">bool</span> bIsIssued                 = <span class="keyword">false</span>;
                <span class="comment">// ----------------------</span>
                <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderUserID, theSenderAcctID;

                <span class="keywordtype">bool</span> bPaymentSenderIsNym  = <span class="keyword">false</span>;
                <span class="keywordtype">bool</span> bFromAcctIsAvailable = <span class="keyword">false</span>;
                <span class="comment">// ----------------------</span>
                <span class="keywordflow">if</span> (thePayment.IsVoucher())
                {
                    bPaymentSenderIsNym  = (thePayment.GetRemitterUserID(theSenderUserID) &amp;&amp; pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(theSenderUserID));
                    bFromAcctIsAvailable =  thePayment.GetRemitterAcctID(theSenderAcctID);
                }
                <span class="keywordflow">else</span>
                {
                    bPaymentSenderIsNym  = (thePayment.GetSenderUserID(theSenderUserID) &amp;&amp; pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(theSenderUserID));
                    bFromAcctIsAvailable =  thePayment.GetSenderAcctID(theSenderAcctID);
                }
                <span class="comment">// ----------------------------------------------------------------</span>
                <span class="keywordflow">if</span> (bPaymentSenderIsNym ||  <span class="comment">// true for cheques as well as vouchers. (We grab the remitter above, for vouchers.)</span>
                    bIsRecurring)           <span class="comment">// false for cheques/vouchers; true for payment plans and smart contracts.</span>
                {
                    <span class="comment">// NOTE: With bPaymentSenderIsNym, we know pNym owns the transaction number on the cheque.</span>
                    <span class="comment">// NOTE: with bIsRecurring, we know pNym is one of the parties of the smart contract.</span>
                    <span class="comment">//       (Since we found an opening number for pNym on it.)</span>

                    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);

                    <span class="comment">// If the transaction # isn&#39;t signed out to me, then there&#39;s no need to check the inbox</span>
                    <span class="comment">// for any receipts, since those would have to have been already closed out, in order for</span>
                    <span class="comment">// the number not to be signed out to me anymore.</span>
                    <span class="comment">//</span>
                    <span class="comment">// Therefore let&#39;s check that first, before bothering to load the inbox.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ac05ddbd6036b5304b7215251d1b7c9b0">VerifyTentativeNum</a>(strServerID, lPaymentTransNum))   <span class="comment">// If I&#39;m in the middle of trying to sign it out...</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Why on earth is this transaction number (%ld) on an outgoing payment instrument, if it&#39;s still on my &#39;Tentative&#39; list? If I haven&#39;t even signed out that number, how did I send an instrument to someone else with that number on it?\n&quot;</span>, __FUNCTION__, lPaymentTransNum);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                    <span class="comment">// ---------------------------</span>
                    bIsIssued = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lPaymentTransNum);

                    <span class="comment">// If pNym is the sender AND the payment instrument IS expired.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bIsExpired)
                    {
                        <span class="keywordflow">if</span> (bIsIssued)  <span class="comment">// ...and if this number is still signed out to pNym...</span>
                        {
                            <span class="comment">// If the instrument is definitely expired, and its number is still issued to pNym, and</span>
                            <span class="comment">// there&#39;s definitely no related chequeReceipts in the asset acocunt inbox, then I</span>
                            <span class="comment">// can DEFINITELY harvest it back. After all, it hasn&#39;t been used, and since it&#39;s</span>
                            <span class="comment">// expired, now it CAN&#39;T be used. So might as well harvest the number back, since we&#39;ve</span>
                            <span class="comment">// established that it&#39;s still signed out.</span>
                            <span class="comment">//</span>
                            <span class="comment">// You might ask, but what if there IS a chequeReceipt in the asset account inbox? How</span>
                            <span class="comment">// does that change things? The answer is, because the transaction # might still be signed</span>
                            <span class="comment">// out to me, even in a case where the payment instrument is expired, but a chequeReceipt</span>
                            <span class="comment">// still IS present! How so? Simple: I sent him the cheque, he cashed it. It&#39;s in my outpayments</span>
                            <span class="comment">// still, because his chequeReceipt is in my inbox still, and hasn&#39;t been processed out.</span>
                            <span class="comment">// Meanwhile I wait a few weeks, and then the instrument, meanwhile, expires. It&#39;s already</span>
                            <span class="comment">// been processed, so it doesn&#39;t matter that it&#39;s expired. But nonetheless, according to the</span>
                            <span class="comment">// dates affixed to it, it IS expired, and the receipt IS present. So this is clearly a</span>
                            <span class="comment">// realistic and legitimate case for our logic to take into account. When this happens, we</span>
                            <span class="comment">// should NOT harvest the transaction # back when recording the payment, because that number</span>
                            <span class="comment">// has been used already!</span>
                            <span class="comment">//</span>
                            <span class="comment">// That, in a nutshell, is why we have to load the inbox and see if that receipt&#39;s there,</span>
                            <span class="comment">// to MAKE SURE whether the instrument was negotiated already, before it expired, even though</span>
                            <span class="comment">// I haven&#39;t accepted the receipt and closed out the transaction # yet, because it impacts</span>
                            <span class="comment">// our decision of whether or not to harvest back the number.</span>
                            <span class="comment">//</span>
                            <span class="comment">// The below two statements are interpreted based on this logic (see comment for each.)</span>
                            <span class="comment">//</span>
                            bShouldHarvestPayment     = <span class="keyword">true</span>;  <span class="comment">// If NO chequeReceipt/paymentReceipt/finalReceipt in inbox, definitely SHOULD harvest back the trans # (since the cheque&#39;s expired and could never otherwise be closed out)...</span>
                            bNeedToLoadAssetAcctInbox = <span class="keyword">true</span>;  <span class="comment">// ...But if chequeReceipt/paymentReceipt/finalReceipt IS in inbox, definitely should NOT harvest back the # (since it&#39;s already been used.)</span>
                            <span class="comment">//</span>
                            <span class="comment">// =====&gt; Therefore bNeedToLoadAssetAcctInbox is a caveat, which OVERRIDES bShouldHarvestPayment. &lt;=====</span>
                        }
                        <span class="keywordflow">else</span> <span class="comment">// pNym is sender, payment instrument IS expired, and most importantly: the transaction # is no longer signed out</span>
                        {    <span class="comment">// to pNym. Normally the closing of the # (by accepting whatever its related receipt was) should have already</span>
                             <span class="comment">// removed the outpayment, so we are cleared here to go ahead and remove it.</span>
                             <span class="comment">//</span>
                            bShouldHarvestPayment     = <span class="keyword">false</span>; <span class="comment">// The # isn&#39;t signed out anymore, so we don&#39;t want to harvest it (which would cause the wallet to try and use it again -- but we don&#39;t want that, since we can&#39;t be using numnbers that aren&#39;t even signed out to us!)</span>
                            bNeedToLoadAssetAcctInbox = <span class="keyword">false</span>; <span class="comment">// No need to check the inbox since the # isn&#39;t even signed out anymore. Even if some related receipt was in the inbox (for some non-cheque instrument, say) we&#39;d still never need to harvest it back for re-use, since it&#39;s not even signed out to us anymore, and we can only use numbers that are signed out to us.</span>
                        }
                    } <span class="comment">// if bIsExpired.</span>
                    <span class="comment">// ------------------------------------------------------------------------------------------------</span>
                    <span class="keywordflow">else</span> <span class="comment">// Not expired. pNym is the sender but the payment instrument is NOT expired.</span>
                    {
                        <span class="comment">// Remember that the transaction number is still signed out to me until I accept that</span>
                        <span class="comment">// chequeReceipt. So whether the receipt is there or not, the # will still be signed</span>
                        <span class="comment">// out to me. But if there&#39;s no receipt yet in my inbox, that means the cheque hasn&#39;t</span>
                        <span class="comment">// been cashed yet. And THAT means I still have time to cancel it. I can&#39;t just discard</span>
                        <span class="comment">// the payment instrument, since its trans# would still need to be harvested if it&#39;s not</span>
                        <span class="comment">// being cancelled (so as to get it closed out on some other instrument, presumably), but</span>
                        <span class="comment">// I can&#39;t just harvest a number when there&#39;s some instrument still floating around out</span>
                        <span class="comment">// there, with that same number already on it! I HAVE to cancel it.</span>
                        <span class="comment">//</span>
                        <span class="comment">// If I discard it without harvesting, and if the recipient never cashes it, then that</span>
                        <span class="comment">// transaction # will end up signed out to me FOREVER (bad thing.) So I would have to</span>
                        <span class="comment">// cancel it first, in order to discard it. The server&#39;s success reply to my cancel</span>
                        <span class="comment">// would be the proper time to discard the old outpayment. Until I see that, how do I know</span>
                        <span class="comment">// if I won&#39;t need it in the future, for harvesting back?</span>
                        <span class="comment">//</span>
                        <span class="keywordflow">if</span> (bIsIssued)  <span class="comment">// If this number is still signed out to pNym...</span>
                        {
                            <span class="comment">// If the instrument is definitely NOT expired, and the transaction # definitely IS issued to ME,</span>
                            <span class="comment">// then I can&#39;t just harvest the numbers, since the original recipient could still come through</span>
                            <span class="comment">// and deposit that cheque.  So in this case, I would HAVE to cancel the transaction first, and then</span>
                            <span class="comment">// such cancellation could sign a new transaction statement with that # removed from my list of</span>
                            <span class="comment">// &quot;signed out&quot; numbers. Only then am I safe from the cheque being cashed by the recipient,</span>
                            <span class="comment">// and only then could I even think about harvesting the number back--that itself being unnecessary,</span>
                            <span class="comment">// since the transaction # would then be cancelled/closed and thus would eliminate any need of</span>
                            <span class="comment">// harvesting it (since now I will never use it.)</span>
                            <span class="comment">//</span>
                            <span class="comment">// Also, if I DON&#39;T cancel it, then I don&#39;t want to remove it from the outpayments box, because</span>
                            <span class="comment">// it will be removed automatically whenever the cheque is eventually cashed, and until/unless that</span>
                            <span class="comment">// happens, I need to keep it around for potential harvesting or cancellation. Therefore I can&#39;t</span>
                            <span class="comment">// discard the instrument either--I need to keep it in the outpayments box for now, in case it&#39;s</span>
                            <span class="comment">// needed later.</span>
                            <span class="comment">//</span>
                            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: This outpayment isn&#39;t expired yet, and the transaction number (%ld) is still signed out. &quot;</span>
                                           <span class="stringliteral">&quot;(Skipping moving it to record box -- it will be moved automatically once you cancel the transaction &quot;</span>
                                           <span class="stringliteral">&quot;or the recipient deposits it.)\n&quot;</span>, __FUNCTION__, lPaymentTransNum);
                            <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        }
                        <span class="keywordflow">else</span> <span class="comment">// The payment is NOT expired yet, but most importantly, its transaction # is NOT signed out to pNym anymore.</span>
                        {    <span class="comment">// Normally the closing of the # (by accepting whatever its related receipt was) should have already</span>
                             <span class="comment">// removed the outpayment by now, so we are cleared here to go ahead and remove it.</span>
                             <span class="comment">//</span>
                            bShouldHarvestPayment     = <span class="keyword">false</span>; <span class="comment">// The # isn&#39;t signed out anymore, so we don&#39;t want to harvest it (which would cause the wallet to try and use it again.)</span>
                            bNeedToLoadAssetAcctInbox = <span class="keyword">false</span>; <span class="comment">// No need to check the inbox since the # isn&#39;t even signed out anymore and we&#39;re certainly not interested in harvesting it if it&#39;s not even signed out to us.</span>
                        }
                    } <span class="comment">// !bIsExpired</span>
                } <span class="comment">// sender is pNym</span>
                <span class="comment">// -----------------------------------------------------------</span>


                <span class="comment">// TODO: Add OPTIONAL field to OTPurse: &quot;Remitter&quot;.</span>
                <span class="comment">// This way the sender has the OPTION to attach his ID &quot;for the record&quot; even though</span>
                <span class="comment">// a cash transaction HAS NO &quot;SENDER.&quot;</span>
                <span class="comment">//</span>
                <span class="comment">// This would make it convenient for a purse to, for example, create a second copy</span>
                <span class="comment">// of the cash, encrypted to the remitter&#39;s public key. This is important, since the</span>
                <span class="comment">// if the remitter has the cash in his outpayment&#39;s box, he will want a way to recover</span>
                <span class="comment">// it if his friend returns and says, &quot;I lost that USB key! Do you still have that cash?!?&quot;</span>
                <span class="comment">//</span>
                <span class="comment">// In fact we may want to use the field for that purpose, WHETHER OR NOT the final sent</span>
                <span class="comment">// instrument actually includes the remitter&#39;s ID.</span>

                <span class="comment">// -----------------------------------------------------------</span>
                <span class="comment">// If the SenderUserID on this instrument isn&#39;t Nym&#39;s ID (as in the case of vouchers),</span>
                <span class="comment">// or isn&#39;t even there (as in the case of cash) then why is it in Nym&#39;s payment outbox?</span>
                <span class="comment">// Well, maybe the recipient of your voucher, lost it. You still need to be able to</span>
                <span class="comment">// get another copy for him, or get it refunded (if you are listed as the remitter...)</span>
                <span class="comment">// Therefore you keep it in your outpayments box &quot;just in case.&quot; In the case of cash,</span>
                <span class="comment">// the same could be true.</span>
                <span class="comment">//</span>
                <span class="comment">// In a way it doesn&#39;t matter, since eventually those instruments will expire and then</span>
                <span class="comment">// they will be swept into the record box with everything else (probably by this function.)</span>
                <span class="comment">//</span>
                <span class="comment">// But what if the instruments never expire? Say a voucher with a very very int64_t expiration</span>
                <span class="comment">// date? It&#39;s still going to sit there, stuck in your outpayments box, even though the</span>
                <span class="comment">// recipient have have cashed it int64_t, int64_t ago! The only way to get rid of it is to have</span>
                <span class="comment">// the server send you a notice when it&#39;s cashed, which is only possible if your ID is</span>
                <span class="comment">// listed as the remitter. (Otherwise the server wouldn&#39;t know who to send the notice to.)</span>
                <span class="comment">//</span>
                <span class="comment">// Further, there&#39;s no PROVING whether the server sent you notice for anything -- whether</span>
                <span class="comment">// you are listed as the remitter or not, the server could choose to LIE and just NOT TELL</span>
                <span class="comment">// YOU that the voucher was cashed. How would you know the difference? Thus &quot;Notice&quot; is</span>
                <span class="comment">// an important problem, peripheral to OT. Balances are safe from any change without a</span>
                <span class="comment">// proper signed and authorized receipt--that is a powerful strength of OT--but notice</span>
                <span class="comment">// cannot be proven.</span>
                <span class="comment">//</span>
                <span class="comment">// If the remitter has no way to prove that the recipient actually deposited the cheque,</span>
                <span class="comment">// (even though most servers will of course provide this, they cannot PROVE that they</span>
                <span class="comment">// provided it) then what good is the instrument to the remitter? What good is such a</span>
                <span class="comment">// cashier&#39;s cheque? Well, the voucher is still in my outpayments, so I can see the transaction</span>
                <span class="comment">// number on it, and then I should be able to query the server and see which transaction</span>
                <span class="comment">// numbers are signed out to it. In which case a simple server message (available to all</span>
                <span class="comment">// users) will return the numbers signed out to the server and thus I can see whether or</span>
                <span class="comment">// not the number on the voucher is still valid. If it&#39;s not, the server reply to that</span>
                <span class="comment">// message would be the appropriate place to move the outpayment to the record box.</span>
                <span class="comment">//</span>
                <span class="comment">// What if we don&#39;t want to have these transaction numbers signed out to the server at all?</span>
                <span class="comment">// Maybe we use numbers signed out to the users instead. Then when the voucher is cashed,</span>
                <span class="comment">// instead of checking the server&#39;s list of issued transaction numbers to see if the voucher</span>
                <span class="comment">// is valid, we would be checking the remitter&#39;s list instead. And thus whenever the voucher</span>
                <span class="comment">// is cashed, we would have to drop a voucherReceipt in the REMITTER&#39;s inbox (and nymbox)</span>
                <span class="comment">// so he would know to discard the transaction number.</span>
                <span class="comment">//</span>
                <span class="comment">// This would require adding the voucherReceipt, and would restrict the use of vouchers to</span>
                <span class="comment">// those people who have an asset account (though that&#39;s currently the only people who can</span>
                <span class="comment">// use them now anyway, since vouchers are withdrawn from accounts) but it would eliminate</span>
                <span class="comment">// the need for the server nym to store all the transaction numbers for all the open vouchers,</span>
                <span class="comment">// and it would also eliminate the problem of &quot;no notice&quot; for the remitters of vouchers.</span>
                <span class="comment">// They&#39;d be guaranteed, in fact, to get notice, since the voucherReceipt is what removes</span>
                <span class="comment">// the transaction number from the user&#39;s list of signed-out transaction numbers (and thus</span>
                <span class="comment">// prevents anyone from spending the voucher twice, which the server wants to avoid at all</span>
                <span class="comment">// costs.) Thus if the server wants to avoid having a voucher spent twice, then it needs to</span>
                <span class="comment">// get that transaction number off of my list of numbers, and it can&#39;t do that without putting</span>
                <span class="comment">// a receipt in my inbox to justify the removal of the number. Otherwise my receipt verifications</span>
                <span class="comment">// will start failing and I&#39;ll be unable to do any new transactions, and then the server will</span>
                <span class="comment">// have to explain why it removed a transaction number from my list, even though it still was</span>
                <span class="comment">// on my list during the last transaction statement, and even though there&#39;s no new receipt in</span>
                <span class="comment">// my inbox to justify removing it.</span>
                <span class="comment">//</span>
                <span class="comment">// Conclusion, DONE: vouchers WITH a remitter acct, should store the remitter&#39;s user AND acct IDs,</span>
                <span class="comment">// and should use a transaction # that&#39;s signed out to the remitter (instead of the server) and</span>
                <span class="comment">// should drop a voucherReceipt in the remitter&#39;s asset account inbox when they are cashed.</span>
                <span class="comment">// These vouchers are guaranteed to provide notice to the remitter.</span>
                <span class="comment">//</span>
                <span class="comment">// Whereas vouchers WITHOUT a remitter acct should store the remitter&#39;s user ID (or not), but should</span>
                <span class="comment">// NOT store the remitter&#39;s acct ID, and should use a transaction # that&#39;s signed out to the server,</span>
                <span class="comment">// and should drop a notice in the Nymbox of the remitter IF his user ID is available, but it should</span>
                <span class="comment">// be understood that such notice is a favor the server is doing, and not something that&#39;s PROVABLE</span>
                <span class="comment">// as in the case of the vouchers in the above paragraph.</span>
                <span class="comment">//</span>
                <span class="comment">// This is similar to smart contracts, which can only be activated by a party who has an</span>
                <span class="comment">// asset account, so he has somewhere to receive the finalReceipt for that contract. (And thus</span>
                <span class="comment">// close out the transcation number he used to open it...)</span>
                <span class="comment">//</span>
                <span class="comment">// Perhaps we&#39;ll just offer both types of vouchers, and just let users choose which they are willing</span>
                <span class="comment">// to pay for, and which trade-off is most palatable to them (having to have an asset account to</span>
                <span class="comment">// get notice, or instead verifying the voucher&#39;s spent status based on some publicly-available</span>
                <span class="comment">// listing of the transaction #&#39;s currently signed out to the server.)</span>
                <span class="comment">//</span>
                <span class="comment">// In the case of having transaction #&#39;s signed out to the server, perhaps the server&#39;s internal storage</span>
                <span class="comment">// of these should be paired each with the NymID of the owner nym for that number, just so no one</span>
                <span class="comment">// would ever have any incentive to try and use one of those numbers on some instrument somehow, and</span>
                <span class="comment">// also so that the server wouldn&#39;t necessarily have to post the entire list of numbers, but just</span>
                <span class="comment">// rather give you the ones that are relevant to you (although the entire list may have to be posted</span>
                <span class="comment">// in some public way in any case, for notice reasons.)</span>
                <span class="comment">//</span>
                <span class="comment">// By this point, you may be wondering, but what does all this have to do with the function</span>
                <span class="comment">// we&#39;re in now? Well... in the below block, with a voucher, pNym would NOT be the sender.</span>
                <span class="comment">// The voucher would still be drawn off a server account. But nevertheless, pNym might still be</span>
                <span class="comment">// the owner of the transaction # for that voucher (assuming I change OT around to use the above</span>
                <span class="comment">// system, which I will have to do if I want provable notice for vouchers.) And if pNym is the</span>
                <span class="comment">// owner of that number, then he will want the option later of refunding it or re-issuing it,</span>
                <span class="comment">// and he will have to possibly load up his inbox to make sure there&#39;s no voucherReceipt in it,</span>
                <span class="comment">// etc. So for now, the vouchers will be handled by the below code, but in the future, they might</span>
                <span class="comment">// be moved to the above code.</span>
                <span class="comment">//</span>
                <span class="comment">//</span>
                <span class="keywordflow">else</span> <span class="comment">// pNym is not the sender.</span>
                {
                    <span class="comment">// pNym isn&#39;t even the &quot;sender&quot; (although he is) but since it&#39;s cash or voucher,</span>
                    <span class="comment">// he&#39;s not waiting on any transaction number to close out or be harvested.</span>
                    <span class="comment">// (In the case of cash, in fact, we might as well just put it straight in the records</span>
                    <span class="comment">// and bypass the outpayments box entirely.) But this function can sweep it into there</span>
                    <span class="comment">// all in due time anyway, once it expires, so it seems harmless to leave it there before</span>
                    <span class="comment">// then. Plus, that way we always know which tokens are still potentially exchangeable,</span>
                    <span class="comment">// for cases where the recipient never cashed them.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bIsExpired)
                    {
                        <span class="comment">// pNym is NOT the sender AND the payment instrument IS expired.</span>
                        <span class="comment">// Therefore, say in the case of sent vouchers and sent cash, there</span>
                        <span class="comment">// may have been some legitimate reason for keeping them in outpayments</span>
                        <span class="comment">// up until this point, but now that the instrument is expired, might as</span>
                        <span class="comment">// well get it out of the outpayments box and move it to the record box.</span>
                        <span class="comment">// Let the client software do its own historical archiving.</span>
                        <span class="comment">//</span>
                        bShouldHarvestPayment     = <span class="keyword">false</span>; <span class="comment">// The # isn&#39;t signed out to pNym, so we don&#39;t want to harvest it (which would cause the wallet to try and use it even though it&#39;s signed out to someone else -- bad.)</span>
                        bNeedToLoadAssetAcctInbox = <span class="keyword">false</span>; <span class="comment">// No need to check the inbox since the # isn&#39;t even signed out to pNym and we&#39;re certainly not interested in harvesting it if it&#39;s not even signed out to us. (Thus no reason to check the inbox.)</span>
                    }
                    <span class="keywordflow">else</span> <span class="comment">// pNym is NOT the sender and the payment instrument is NOT expired.</span>
                    {
                        <span class="comment">// For example, for a sent voucher that has not expired yet.</span>
                        <span class="comment">// Those we&#39;ll keep here for now, until some server notice is</span>
                        <span class="comment">// received, or the instrument expires. What if we need to re-issue</span>
                        <span class="comment">// the cheque to the recipient who lost it? Or what if we want to</span>
                        <span class="comment">// cancel it before he tries to cash it? Since it&#39;s not expired yet,</span>
                        <span class="comment">// it&#39;s wise to keep a copy in the outpayments box for now.</span>
                        <span class="comment">//</span>
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: This outpayment isn&#39;t expired yet. (Skipping moving it to record box -- it &quot;</span>
                                       <span class="stringliteral">&quot;will be moved automatically once it expires--and maybe sooner, if I code voucherReceipts. &quot;</span>
                                       <span class="stringliteral">&quot;See giant comment just above this log.)\n&quot;</span>, __FUNCTION__, lPaymentTransNum);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                }
                <span class="comment">// ----------------------------------------------------------------</span>
                <span class="comment">//</span>
                <span class="keywordtype">bool</span>              bFoundReceiptInInbox  = <span class="keyword">false</span>;
                <span class="keywordtype">bool</span>              bIsSmartContract      = <span class="keyword">false</span>;
                <a class="code" href="class_o_t_trackable.html">OTTrackable</a>     * pTrackable            = NULL;
                <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmartContract        = NULL;
                <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   * pPlan                 = NULL;
                <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTrackable&gt;</a> theTrackableAngel;
                <span class="comment">//</span>
                <span class="comment">// In certain cases (logic above) it is determined that we have to load the</span>
                <span class="comment">// asset account inbox and make sure there aren&#39;t any chequeReceipts there,</span>
                <span class="comment">// before we go ahead and harvest any transaction numbers.</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (bNeedToLoadAssetAcctInbox &amp;&amp; (bFromAcctIsAvailable || bIsRecurring))
                {
                    <span class="keywordflow">if</span> (bIsRecurring)
                    {
                        pTrackable = thePayment.Instantiate();
                        <span class="keywordflow">if</span> ( NULL  == pTrackable )
                        {
                            <a class="code" href="class_o_t_string.html">OTString</a> strPaymentContents;
                            thePayment.GetPaymentContents(strPaymentContents);
                            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed instantiating OTPayment containing:\n%s\n&quot;</span>,
                                          __FUNCTION__, strPaymentContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                            <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        } <span class="comment">// BELOW THIS POINT, MUST DELETE pTrackable!</span>
                        theTrackableAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pTrackable); <span class="comment">// (This automates the DELETION.)</span>
                        <span class="comment">// ----------------------------</span>
                        pSmartContract = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pTrackable);
                        pPlan          = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> *<span class="keyword">&gt;</span>  (pTrackable);
                        <span class="comment">// ----------------------------</span>
                        <span class="keywordflow">if</span> (NULL != pSmartContract)
                        {
                            bIsSmartContract = <span class="keyword">true</span>; <span class="comment">// In this case we have to loop through all the accounts on the smart contract...</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pPlan)
                        {
                            <span class="comment">// Payment plan is a funny case.</span>
                            <span class="comment">// The merchant (RECIPIENT aka payee) creates the payment plan, and then he SENDS</span>
                            <span class="comment">// it to the customer (SENDER aka payer). From there, the customer ACTIVATES it on</span>
                            <span class="comment">// the server. BOTH could potentially have it in their outpayments box. In one case.</span>
                            <span class="comment">// the Nym is the &quot;sender&quot; and in another case, he&#39;s the &quot;recipient.&quot;</span>
                            <span class="comment">// (So we need to figure out which, and set the account accordingly.)</span>
                            <span class="comment">//</span>
                            <span class="keywordflow">if</span> (USER_ID == pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a87e9b6e7028af7ddfebaee86925e8e7b">GetRecipientUserID</a>())
                                theSenderAcctID = pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a66300d99a12d32b6825e7e11dfca8614">GetRecipientAcctID</a>();
                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USER_ID == pPlan-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>())
                                theSenderAcctID = pPlan-&gt;<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>();
                            <span class="keywordflow">else</span>
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Should never happen: USER_ID didn&#39;t match this payment plan for sender OR recipient. &quot;</span>
                                              <span class="stringliteral">&quot;(Expected one or the other.)\n&quot;</span>, __FUNCTION__);
                        }
                    }
                    <span class="comment">// ----------------------------------------</span>
                    <span class="keywordflow">if</span> (bIsSmartContract) <span class="comment">// In this case we have to loop through all the accounts on the smart contract... We have to</span>
                    {                     <span class="comment">// check the inbox on each, to make sure there aren&#39;t any related paymentReceipts or final receipts.</span>
                        <span class="keyword">const</span> int32_t nPartyCount = pSmartContract-&gt;<a class="code" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">GetPartyCount</a>();

                        <span class="keywordflow">for</span> (int32_t nCurrentParty = 0; nCurrentParty &lt; nPartyCount; ++nCurrentParty)
                        {
                            <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pSmartContract-&gt;<a class="code" href="class_o_t_scriptable.html#a4be857ffbe603f75f1dc5550ed4c20e9">GetPartyByIndex</a>(nCurrentParty);
                            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
                            <span class="keywordflow">if</span> (NULL != pParty)
                            {
                                <span class="keyword">const</span> int32_t nAcctCount = pParty-&gt;<a class="code" href="class_o_t_party.html#a0b130989d275386c980ed34d587e5e87">GetAccountCount</a>();

                                <span class="keywordflow">for</span> (int32_t nCurrentAcct = 0; nCurrentAcct &lt; nAcctCount; ++nCurrentAcct)
                                {
                                    <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pPartyAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#ad085e6ba37a006e0f8cf7e100a9b59eb">GetAccountByIndex</a>(nCurrentAcct);
                                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPartyAcct);
                                    <span class="keywordflow">if</span> (NULL != pPartyAcct)
                                    {
                                        <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = pPartyAcct-&gt;<a class="code" href="class_o_t_party_account.html#ad8c523b08a478e4071bb2b3ca85749b1">GetAuthorizedAgent</a>();

                                        <span class="comment">// If pNym is a signer for pPartyAcct, then we need to check pPartyAcct&#39;s inbox</span>
                                        <span class="comment">// to make sure there aren&#39;t any paymentReceipts or finalReceipts lingering in there...</span>
                                        <span class="comment">//</span>
                                        <span class="keywordflow">if</span> (pAgent-&gt;<a class="code" href="class_o_t_agent.html#a2039e8ad981abeecabf0a3aa412a3a9f">IsValidSigner</a>(*pNym))
                                        {
                                            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     &amp; strAcctID = pPartyAcct-&gt;<a class="code" href="class_o_t_party_account.html#aa5e4e0cc77853d08b3708017fe694876">GetAcctID</a>();
                                            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>   theAcctID(strAcctID);

                                            <a class="code" href="class_o_t_ledger.html">OTLedger</a> theSenderInbox(USER_ID, theAcctID, SERVER_ID);

                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccessLoadingSenderInbox = (theSenderInbox.LoadInbox() &amp;&amp; theSenderInbox.VerifyAccount(*pNym));
                                            <span class="comment">// --------------------------------------------------------------------</span>
                                            <span class="keywordflow">if</span> (bSuccessLoadingSenderInbox)
                                            {
                                                <span class="comment">// Loop through the inbox and see if there are any receipts for lPaymentTransNum inside.</span>
                                                <span class="comment">//</span>
                                                <span class="keywordflow">if</span> (theSenderInbox.GetPaymentReceipt(lPaymentTransNum) || theSenderInbox.GetFinalReceipt(lPaymentTransNum))
                                                {
                                                    bFoundReceiptInInbox = <span class="keyword">true</span>;
                                                    <span class="keywordflow">break</span>;
                                                }
                                                <span class="comment">// else we didn&#39;t find a receipt in the asset account inbox, which means we are safe to harvest.</span>
                                            }
                                            <span class="comment">//else unable to load inbox. Maybe it&#39;s empty, never been used before. i.e. it doesn&#39;t even exist.</span>
                                        } <span class="comment">// pNym is valid signer for agent</span>
                                    } <span class="comment">// NULL != pPartyAccount</span>
                                } <span class="comment">// loop party accounts.</span>

                                <span class="keywordflow">if</span> (bFoundReceiptInInbox)
                                    <span class="keywordflow">break</span>;
                            }
                        } <span class="comment">// loop parties</span>
                    } <span class="comment">// smart contract</span>
                    <span class="keywordflow">else</span> <span class="comment">// not a smart contract. (It&#39;s a payment plan or a cheque, most likely.)</span>
                    {
                        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theSenderInbox(USER_ID, theSenderAcctID, SERVER_ID);

                        <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccessLoadingSenderInbox = (theSenderInbox.LoadInbox() &amp;&amp; theSenderInbox.VerifyAccount(*pNym));
                        <span class="comment">// --------------------------------------------------------------------</span>
                        <span class="keywordflow">if</span> (bSuccessLoadingSenderInbox)
                        {
                            <span class="comment">// Loop through the inbox and see if there are any receipts for lPaymentTransNum inside.</span>
                            <span class="comment">// Technically this would have to be a chequeReceipt, or possibly a voucherReceipt if I add</span>
                            <span class="comment">// that (see giant comment above.)</span>
                            <span class="comment">//</span>
                            <span class="comment">// There are other instrument types but only a cheque, at this point, would be in my outpayments</span>
                            <span class="comment">// box AND could have a receipt in my asset account inbox. So let&#39;s see if there&#39;s a chequeReceipt</span>
                            <span class="comment">// in there that corresponds to lPaymentTransNum...</span>
                            <span class="comment">//</span>
                            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pChequeReceipt = theSenderInbox.GetChequeReceipt(lPaymentTransNum); <span class="comment">// cheque</span>

                            <span class="keywordflow">if</span> (NULL != pChequeReceipt)
                            {
                                bFoundReceiptInInbox = <span class="keyword">true</span>;
                            }
                            <span class="comment">// No cheque receipt? Ok let&#39;s see if there&#39;s a paymentReceipt or finalReceipt (for a payment plan...)</span>
                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theSenderInbox.GetPaymentReceipt(lPaymentTransNum) ||
                                     theSenderInbox.GetFinalReceipt  (lPaymentTransNum)) <span class="comment">// payment plan.</span>
                            {
                                bFoundReceiptInInbox = <span class="keyword">true</span>;
                            }
                            <span class="comment">// else we didn&#39;t find a receipt in the asset account inbox, which means we are safe to harvest.</span>
                        }
                        <span class="comment">//else unable to load inbox. Maybe it&#39;s empty, never been used before. i.e. it doesn&#39;t even exist.</span>
                    } <span class="comment">// not a smart contract</span>
                } <span class="comment">// if (bNeedToLoadAssetAcctInbox &amp;&amp; (bFromAcctIsAvailable || bIsRecurring))</span>
                <span class="comment">// ----------------------------------------------------------------</span>
                <span class="comment">// If we should harvest the transaction numbers,</span>
                <span class="comment">// AND if we don&#39;t need to double-check that against the asset inbox to make sure the receipt&#39;s not there,</span>
                <span class="comment">// (or if we do, that it was a successful double-check and the receipt indeed is not there.)</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (  bShouldHarvestPayment &amp;&amp;
                    ((!bNeedToLoadAssetAcctInbox) || (bNeedToLoadAssetAcctInbox &amp;&amp; !bFoundReceiptInInbox)))
                {
                    <span class="comment">// Harvest the transaction number(s).</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (NULL != pSmartContract)
                    {
                        pSmartContract-&gt;<a class="code" href="class_o_t_smart_contract.html#a6eaf2a458eb665dae9e25f026db27f8f">HarvestOpeningNumber</a> (*pNym);
                        pSmartContract-&gt;<a class="code" href="class_o_t_smart_contract.html#a40befd7381c6c5e68e7d1042c9a7f2d3">HarvestClosingNumbers</a>(*pNym);
                    }
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pPlan)
                    {
                        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">HarvestOpeningNumber</a> (*pNym);
                        pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(*pNym);
                    }
                    <span class="keywordflow">else</span>
                    {
                        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(SERVER_ID, lPaymentTransNum, <span class="keyword">false</span>); <span class="comment">//bSave=false</span>
                    }

                    bNeedToSaveTheNym = <span class="keyword">true</span>;

                    <span class="comment">// Note, food for thought: IF the receipt had popped into your asset inbox on the server</span>
                    <span class="comment">// side, since the last time you downloaded your inbox, then you could be making the wrong</span>
                    <span class="comment">// decision here, and harvesting a number that&#39;s already spent. (You just didn&#39;t know it yet.)</span>
                    <span class="comment">//</span>
                    <span class="comment">// What happens in that case, when I download the inbox again? A new receipt is there, and a</span>
                    <span class="comment">// transaction # is used, which I thought was still available for use? (Since I harvested it?)</span>
                    <span class="comment">// The appearance of the receipt in the inbox, as long as properly formed and signed by me,</span>
                    <span class="comment">// should be enough information for the client side to adjust its records, because if it</span>
                    <span class="comment">// doesn&#39;t anticipate this possibility, then it will be forced to resync entirely, which I want</span>
                    <span class="comment">// to avoid in all cases period.</span>
                    <span class="comment">//</span>
                    <span class="comment">// In this block, we clawed back the number because if there&#39;s no chequeReceipt in the inbox,</span>
                    <span class="comment">// then that means the cheque has never been used, since if I had closed the chequeReceipt out</span>
                    <span class="comment">// already, then the transaction number on that cheque would already have been closed out at</span>
                    <span class="comment">// that time.</span>
                    <span class="comment">// We only clawback for expired instruments, where the transaction # is still outstanding</span>
                    <span class="comment">// and where no receipt is present in the asset acct inbox. If the instrument is not expired,</span>
                    <span class="comment">// then you must cancel it properly. And if the cheque receipt is in the inbox, then you must</span>
                    <span class="comment">// close it properly.</span>
                }
            } <span class="comment">// if (thePayment.GetTransactionNum(lPaymentTransNum))</span>
            <span class="comment">// ----------------------------------------------------------------</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bSaveCopy &amp;&amp; (NULL != pActualBox) &amp;&amp; thePayment.IsPurse())
            {
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pActualBox);

                <span class="comment">// A purse has no transaction number on itself, and if it&#39;s in the outpayment box,</span>
                <span class="comment">// it has no transaction number from its ledger, either! It&#39;s numberless. So what</span>
                <span class="comment">// we do for now is, we use the expiration timestamp for the purse to create its</span>
                <span class="comment">// &quot;transaction number&quot; (we also add a billion to it, and then increment it until</span>
                <span class="comment">// we are sure it&#39;s unused in the box already) for the new receipt we&#39;re inserting</span>
                <span class="comment">// for this purse into the record box. (Otherwise we&#39;d have to skip this part and</span>
                <span class="comment">// we wouldn&#39;t save a record of the purse at all.)</span>
                <span class="comment">//</span>
                <span class="comment">// ALSO NOTE that people shouldn&#39;t really be discarding the purse anyway from the outpayment</span>
                <span class="comment">// box, since it will ALREADY disappear once it expires. (Presumably you&#39;d want the option to</span>
                <span class="comment">// recover it, at any time prior to that point...) But we still must consider that people sent</span>
                <span class="comment">// cash and they just want it erased, so...</span>
                <span class="comment">//</span>
                <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidTo = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;

                <span class="keywordflow">if</span> (thePayment.GetValidTo(tValidTo))
                {
                    lPaymentTransNum = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(tValidTo) + 1000000000; <span class="comment">// todo hardcoded. (But should be harmless since this is record box.)</span>

                    <span class="comment">// Since we&#39;re using a made-up transaction number here, let&#39;s</span>
                    <span class="comment">// make sure it&#39;s not already being used. If it is, we&#39;ll</span>
                    <span class="comment">// increment it until nothing is found.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">while</span> (NULL != pActualBox-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lPaymentTransNum))
                        ++lPaymentTransNum;
                }
                <span class="keywordflow">else</span>
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to get &#39;valid to&#39; from purse.\n&quot;</span>, __FUNCTION__);
            }
            <span class="comment">// ----------------------------------------------------------------</span>
            <span class="comment">// Create the notice to put in the Record Box.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bSaveCopy &amp;&amp; (NULL != pActualBox) &amp;&amp; (lPaymentTransNum &gt; 0))
            {
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pActualBox);

                <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pNewTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(*pActualBox, <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>, lPaymentTransNum);

                <span class="keywordflow">if</span> (NULL != pNewTransaction) <span class="comment">// The above has an OT_ASSERT within, but I just like to check my pointers.</span>
                {
                    pNewTransaction-&gt;   SetReferenceToNum(lPaymentTransNum); <span class="comment">// referencing myself here. We&#39;ll see how it works out.</span>
                    pNewTransaction-&gt;   SetReferenceString(strInstrument); <span class="comment">// the cheque, invoice, etc that used to be in the outpayments box.</span>

                    pNewTransaction-&gt;   <a class="code" href="class_o_t___a_p_i.html#aa354b7ac168afd7cacfcf045241f4771">SignContract</a>(*pNym);
                    pNewTransaction-&gt;   SaveContract();
                    <span class="comment">// -----------------------------------------</span>
                    pTransaction = pNewTransaction;

                    theTransactionAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
                }
                <span class="keywordflow">else</span> <span class="comment">// should never happen</span>
                {
                    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while trying to generate transaction in order to &quot;</span>
                                  <span class="stringliteral">&quot;add a new transaction (for a payment instrument from the outpayments box) &quot;</span>
                                  <span class="stringliteral">&quot;to Record Box: %s\n&quot;</span>, __FUNCTION__, strUserID.Get());
                }
            }
        } <span class="comment">//if (thePayment.IsValid() &amp;&amp; thePayment.SetTempValues())</span>
        <span class="comment">// -------------------------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// Now we actually remove the message from the outpayments...</span>
        <span class="comment">//</span>
        bRemoved = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2d66a8a46d8e147ca0dbc0fb45bc364d">RemoveOutpaymentsByIndex</a>(nIndex, <span class="keyword">false</span>); <span class="comment">// bDeleteIt=true by default</span>
        theMessageAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pMessage); <span class="comment">// Since we chose to keep pMessage alive after removing it from the outpayments, we set the angel here to make sure it gets cleaned up later whenever we return out of this godforsaken function.</span>

        <span class="comment">// Anything else?</span>
    } <span class="comment">// outpayments box.</span>
    <span class="comment">// ***********************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Okay by this point, whether the payment was in the payments inbox, or</span>
    <span class="comment">// whether it was in the outpayments box, either way, it has now been removed</span>
    <span class="comment">// from that box. (Otherwise we would have returned already by this point.)</span>
    <span class="comment">//</span>
    <span class="comment">// It&#39;s still safer to explicitly check bRemoved, just in case.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bRemoved)
    {
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (bSaveCopy &amp;&amp; (NULL != pActualBox) &amp;&amp; (NULL != pTransaction))
        {
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pActualBox);

            <span class="keyword">const</span> <span class="keywordtype">bool</span> bAdded = pActualBox-&gt;<a class="code" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a>(*pTransaction);

            <span class="keywordflow">if</span> (!bAdded)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to add transaction %ld to record box (after tentatively removing &quot;</span>
                              <span class="stringliteral">&quot;from payment %s, an action that is now canceled.)\n&quot;</span>, __FUNCTION__,
                              pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), bIsInbox ? <span class="stringliteral">&quot;inbox&quot;</span> : <span class="stringliteral">&quot;outbox&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
                theTransactionAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(NULL); <span class="comment">// If successfully added to the record box, then no need anymore to clean it up ourselves.</span>

            pActualBox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            pActualBox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pActualBox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            <span class="comment">// -------------------------------</span>
            <span class="keywordflow">if</span> (bIsExpired)
                pActualBox-&gt;<a class="code" href="class_o_t_ledger.html#ace1cb1337e94d794243bbe163eb88813">SaveExpiredBox</a>(); <span class="comment">// todo log failure.</span>
            <span class="keywordflow">else</span>
                pActualBox-&gt;<a class="code" href="class_o_t_ledger.html#aff379f9b12cebb1132bca402396f1a8a">SaveRecordBox</a>(); <span class="comment">// todo log failure.</span>

            <span class="comment">// Any inbox/nymbox/outbox ledger will only itself contain</span>
            <span class="comment">// abbreviated versions of the receipts, including their hashes.</span>
            <span class="comment">//</span>
            <span class="comment">// The rest is stored separately, in the box receipt, which is created</span>
            <span class="comment">// whenever a receipt is added to a box, and deleted after a receipt</span>
            <span class="comment">// is removed from a box.</span>
            <span class="comment">//</span>
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(*pActualBox); <span class="comment">// todo: log failure</span>
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (bIsInbox)
        {
            pPaymentInbox-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            pPaymentInbox-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
            pPaymentInbox-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            <span class="comment">// -----------------------------------------------------</span>
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bSavedInbox = pPaymentInbox-&gt;<a class="code" href="class_o_t_ledger.html#ab6f6af26a690d49f61ec7ffcc557a302">SavePaymentInbox</a>(); <span class="comment">// todo: log failure</span>
            <span class="keywordflow">if</span> (!bSavedInbox) <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;/n%s: Unable to Save PaymentInbox./n&quot;</span>,__FUNCTION__);
        }
        <span class="keywordflow">else</span> <span class="comment">// outbox</span>
        {
            <span class="comment">// Outpayments are currently stored in the Nymfile.</span>
            <span class="comment">//</span>
            bNeedToSaveTheNym = <span class="keyword">true</span>;
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (bNeedToSaveTheNym)
        {
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pNym);
        }
        <span class="comment">// -----------------------------------------------------</span>
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to remove from payment %s based on index %d.\n&quot;</span>,
                      __FUNCTION__, bIsInbox ? <span class="stringliteral">&quot;inbox&quot;</span> : <span class="stringliteral">&quot;outbox&quot;</span>, nIndex);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ee70b9309b55c10ade9e0bf240c66a2"></a><!-- doxytag: member="OT_API::RemoveSentMessage" ref="a5ee70b9309b55c10ade9e0bf240c66a2" args="(const int64_t &amp;lRequestNumber, const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a5ee70b9309b55c10ade9e0bf240c66a2">OT_API::RemoveSentMessage</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07789">7789</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized &amp;&amp; (<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> != NULL), <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(lRequestNumber &gt; 0, <span class="stringliteral">&quot;OT_API::RemoveSentMessage: lRequestNumber is less than 1.&quot;</span>);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a86b6fe9628f0b065e7f35dd68c02b3e6">GetMessageOutbuffer</a>().<a class="code" href="class_o_t_message_outbuffer.html#aefe611bcb8fab3e6fe763bfb98ccf86a">RemoveSentMessage</a>(lRequestNumber, strServerID, strNymID); <span class="comment">// deletes.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8257fd4d11d7a54cc633edb5224d55f4"></a><!-- doxytag: member="OT_API::ResyncNymWithServer" ref="a8257fd4d11d7a54cc633edb5224d55f4" args="(OTPseudonym &amp;theNym, OTLedger &amp;theNymbox, OTPseudonym &amp;theMessageNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a8257fd4d11d7a54cc633edb5224d55f4">OT_API::ResyncNymWithServer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theNymbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theMessageNym</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l07694">7694</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a> != theNymbox.<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::ResyncNymWithServer: Error: Expected a Nymbox, but you passed in a %s.\n&quot;</span>,
                      theNymbox.<a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(theNymbox.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> id1(theNym.<a class="code" href="class_o_t_pseudonym.html#a8167f1e2d532ab18227c5c170922c611">GetConstID</a>()), id2(theNymbox.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OT_API::ResyncNymWithServer: Error: NymID of Nym (%s) doesn&#39;t match NymID on (supposedly) his own Nymbox (%s).\n&quot;</span>,
                      id1.Get(), id2.Get());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
<span class="comment">//  if (false == theNym.CompareID(theMessageNym))</span>
<span class="comment">//  {</span>
<span class="comment">//      const OTString id1(theNym.GetConstID()), id2(theMessageNym.GetConstID());</span>
<span class="comment">//      OTLog::vError(&quot;OT_API::ResyncNymWithServer: Error: NymID of Nym (%s) doesn&#39;t match NymID on (supposedly) his server-side doppelganger (%s).\n&quot;,</span>
<span class="comment">//                    id1.Get(), id2.Get());</span>
<span class="comment">//      return false;</span>
<span class="comment">//  }</span>
    <span class="comment">// *****************************************************</span>

    <span class="keywordflow">return</span> theNym.<a class="code" href="class_o_t_pseudonym.html#a4524f90e444b02c8c2c9e4a2cb61f103">ResyncWithServer</a>(theNymbox, theMessageNym);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3e808efa2420f7647ee0659de4ed176"></a><!-- doxytag: member="OT_API::SavePurse" ref="ac3e808efa2420f7647ee0659de4ed176" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID, const OTIdentifier &amp;USER_ID, OTPurse &amp;THE_PURSE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ac3e808efa2420f7647ee0659de4ed176">OT_API::SavePurse</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_purse.html">OTPurse</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05125">5125</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// ---------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *szFunc = <span class="stringliteral">&quot;OT_API::SavePurse&quot;</span>;
    <span class="comment">// ---------------------------------------------------------</span>
    <span class="keywordflow">if</span> (THE_PURSE.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: This purse is password-protected (exported) &quot;</span>
                       <span class="stringliteral">&quot;and cannot be saved inside the wallet without first re-importing it.\n&quot;</span>, szFunc);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((THE_PURSE.<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>() != SERVER_ID) ||
             (THE_PURSE.<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a>()  != ASSET_ID))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error: Wrong server or asset ID passed in, &quot;</span>
                       <span class="stringliteral">&quot;considering the purse that was passed.\n&quot;</span>, szFunc);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// -------------------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(ASSET_ID);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strUserID(USER_ID);
        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (THE_PURSE.<a class="code" href="class_o_t_purse.html#a40b0557a09d2183149dfc7bbd6145e0d">SavePurse</a>(strServerID.Get(), strUserID.Get(), strAssetTypeID.Get()))
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strPurse(THE_PURSE);
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed saving purse:\n\n%s\n\n&quot;</span>,
                   szFunc, strPurse.Get());
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a579f8299c5c8df16a7d30e2226663d84"></a><!-- doxytag: member="OT_API::sendUserInstrument" ref="a579f8299c5c8df16a7d30e2226663d84" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;USER_ID_RECIPIENT, OTString &amp;RECIPIENT_PUBKEY, OTPayment &amp;THE_INSTRUMENT, OTPayment *pINSTRUMENT_FOR_SENDER=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a579f8299c5c8df16a7d30e2226663d84">OT_API::sendUserInstrument</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID_RECIPIENT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_PUBKEY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_payment.html">OTPayment</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_INSTRUMENT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_payment.html">OTPayment</a> *&#160;</td>
          <td class="paramname"><em>pINSTRUMENT_FOR_SENDER</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12677">12677</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int32_t  nReturnValue   = -1;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strNymID2(USER_ID_RECIPIENT);
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strInstrument,
             strInstrumentForSender;
    <span class="comment">// -----------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotPaymentContents = THE_INSTRUMENT.<a class="code" href="class_o_t_payment.html#a1d067b54e63054b1021ef5f187911fab">GetPaymentContents</a>(strInstrument);
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotSenderPmntCnts  = (NULL == pINSTRUMENT_FOR_SENDER) ? <span class="keyword">false</span> :
                                     pINSTRUMENT_FOR_SENDER-&gt;<a class="code" href="class_o_t_payment.html#a1d067b54e63054b1021ef5f187911fab">GetPaymentContents</a>(strInstrumentForSender);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// PREPARE TO SAVE A COPY IN THE OUTPAYMENT BOX</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!THE_INSTRUMENT.<a class="code" href="class_o_t_payment.html#aec4f77470b159c3afd1cc4e3dffe464d">IsPurse</a>())
    {
        <span class="comment">// ----------------------------------------------</span>
        <span class="comment">// store a copy in the outpayments.</span>
        <span class="comment">// (not encrypted, since the Nymfile will be encrypted anyway.)</span>
        <span class="comment">//</span>
        <span class="comment">// UPDATE: We are now storing a copy in outpayments when the</span>
        <span class="comment">// cheque is WRITTEN. But for other instruments (like cash, or</span>
        <span class="comment">// vouchers) we cannot store them in outpayments until they are</span>
        <span class="comment">// SENT. ...Meaning we must record at this point regardless.</span>
        <span class="comment">// Should we have an exception here for cheques?</span>
        <span class="comment">//</span>
        <span class="comment">// Solution: Let&#39;s just make sure there&#39;s not already one there...</span>
        <span class="comment">//</span>
        int64_t lTempTransNum = 0;
        <span class="keywordtype">bool</span> bGotTransNum      = THE_INSTRUMENT.<a class="code" href="class_o_t_payment.html#a4a6c103790c2fc759136079db0e65434">GetOpeningNum</a>(lTempTransNum, USER_ID);
        int32_t  lOutpaymentsIndex = bGotTransNum ? pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0fb41be70cd60e4febffce961bf39823">GetOutpaymentsIndexByTransNum</a>(lTempTransNum) : (-1);

        <span class="keywordflow">if</span> (lOutpaymentsIndex &gt; (-1)) <span class="comment">// found something that matches...</span>
        {
            <span class="comment">// Remove it from Outpayments box. We&#39;re adding an updated version</span>
            <span class="comment">// of this same instrument here anyway. We can erase the old one.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (!pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2d66a8a46d8e147ca0dbc0fb45bc364d">RemoveOutpaymentsByIndex</a>(lOutpaymentsIndex)) <span class="comment">// &lt;==== REMOVED! (So the one added below isn&#39;t a duplicate.)</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error calling RemoveOutpaymentsByIndex for Nym: %s\n&quot;</span>,
                              __FUNCTION__, strNymID.Get());

            }
            <span class="comment">// Save Nym to local storage, since an outpayment was erased.</span>
            <span class="comment">// Note: we&#39;re saving below anyway. Might as well not save twice.</span>
            <span class="comment">//</span>
<span class="comment">//          else if (!pNym-&gt;SaveSignedNymfile(*pNym))</span>
<span class="comment">//              OTLog::vError(&quot;%s: Error saving Nym: %s\n&quot;, __FUNCTION__, strNymID.Get());</span>
        }
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: FYI, didn&#39;t remove an older copy of the instrument from the payments outbox, &quot;</span>
                           <span class="stringliteral">&quot;since I couldn&#39;t find it in there.\n&quot;</span>, __FUNCTION__);
    }
    <span class="comment">// --------------------------------------------------------</span>
    <span class="comment">// OUTPAYMENT COPY:</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMessage&gt;</a> theOutMsgAngel(pMessage);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outpaymentsMessage&quot;</span>;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>       = strNymID2;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>     = strServerID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(bGotSenderPmntCnts ? strInstrumentForSender : strInstrument);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// If they&#39;re the same, we only save a copy in the outbox.</span>
    <span class="comment">// (We only SEND if they are different.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (USER_ID != USER_ID_RECIPIENT)
    {
        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;sendUserInstrument&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strNymID2;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope;
        <a class="code" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> * pPubkey = <a class="code" href="class_o_t_asymmetric_key.html#a4437342fa5841152e2dfa6ee48a69094">OTAsymmetricKey::KeyFactory</a>();
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPubkey);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAsymmetricKey&gt;</a> theKeyAngel(pPubkey);
        <span class="comment">// -----------------------------------</span>
        <span class="keywordflow">if</span> (!pPubkey-&gt;<a class="code" href="class_o_t_asymmetric_key.html#abe1f83bcc64a9f56406c4e145cd65651">SetPublicKey</a>(RECIPIENT_PUBKEY))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed setting public key from string ===&gt;%s&lt;===\n&quot;</span>,
                           __FUNCTION__, RECIPIENT_PUBKEY.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bGotPaymentContents &amp;&amp;
                 theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pPubkey, strInstrument) &amp;&amp;
                 theEnvelope.<a class="code" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">GetAsciiArmoredData</a>(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>))
        {
            <span class="comment">// (2) Sign the Message</span>
            theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

            <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
            theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            <span class="comment">// -------------------------------------------------------</span>
            <span class="comment">// Back to the outpayments message...</span>
            <span class="comment">// (We may want it saved in the outpayment box, before the reply from the</span>
            <span class="comment">// above message comes in. Actually that might be wrong, since we care more</span>
            <span class="comment">// about the receipt from the recipient depositing the instrument, then we do</span>
            <span class="comment">// about the reply for the sendInstrument itself. Anyway, better safe than sorry...)</span>
            <span class="comment">//</span>
            pMessage-&gt;<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber);

            pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
            pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            theOutMsgAngel.SetCleanupTargetPointer(NULL);
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);  <span class="comment">// &lt;==== SAVED.</span>
            <span class="comment">// --------------------------------------------------------</span>
            <span class="comment">// (Send it)</span>
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
            <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);
            <span class="comment">// -----------------------------------------------------------------</span>
            nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
        }
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed sealing envelope.\n&quot;</span>, __FUNCTION__);
    }
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="comment">// (USER_ID == USER_ID_RECIPIENT)</span>
    {
        <span class="comment">// You may be wondering why this code seems to repeat?</span>
        <span class="comment">// The answer is because above, it needs to happen BEFORE</span>
        <span class="comment">// the message is sent, since the processing of the server</span>
        <span class="comment">// reply may expect the outpayments copy to already exist.</span>
        <span class="comment">//</span>
        <span class="comment">// (NOTE: That may actually not be true. That is more true for</span>
        <span class="comment">// when the receipt comes in, from the recipient depositing</span>
        <span class="comment">// the cheque, versus the server reply to the sendInstrument</span>
        <span class="comment">// itself. Anyway...)</span>
        <span class="comment">//</span>
        <span class="comment">// Whereas here, it needs to happen in the case where the</span>
        <span class="comment">// message is NOT sent. (USER as RECIPIENT means &quot;just put</span>
        <span class="comment">// a copy in my outpayments box.&quot;)</span>
        <span class="comment">//</span>
        <span class="comment">// But if it DOES happen BEFORE, then we want to properly</span>
        <span class="comment">// add the request number to it, even though we apparently</span>
        <span class="comment">// don&#39;t use the request number on outpayments messages.</span>
        <span class="comment">// Whereas here, we don&#39;t have a request number, so it just</span>
        <span class="comment">// gets set to 0.</span>
        <span class="comment">//</span>
        pMessage-&gt;<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Will be 0 in this case.</span>

        pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
        pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        theOutMsgAngel.SetCleanupTargetPointer(NULL);
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);  <span class="comment">// &lt;==== SAVED.</span>
        <span class="comment">// -----------------------------------------------------------------</span>
        nReturnValue = 0; <span class="comment">// 0 means, nothing was sent, but no error occurred.</span>
    }
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keywordflow">return</span> nReturnValue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab168fb55e1ce59b07f251517d6768076"></a><!-- doxytag: member="OT_API::sendUserMessage" ref="ab168fb55e1ce59b07f251517d6768076" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;USER_ID_RECIPIENT, OTString &amp;RECIPIENT_PUBKEY, OTString &amp;THE_MESSAGE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ab168fb55e1ce59b07f251517d6768076">OT_API::sendUserMessage</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID_RECIPIENT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_PUBKEY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_MESSAGE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12578">12578</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::sendUserMessage&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strNymID2(USER_ID_RECIPIENT);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;sendUserMessage&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strNymID2;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope;
    <a class="code" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> * pPubkey = <a class="code" href="class_o_t_asymmetric_key.html#a4437342fa5841152e2dfa6ee48a69094">OTAsymmetricKey::KeyFactory</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPubkey);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAsymmetricKey&gt;</a> theKeyAngel(pPubkey);

    int32_t nReturnValue = -1;

    <span class="keywordflow">if</span> (!pPubkey-&gt;<a class="code" href="class_o_t_asymmetric_key.html#abe1f83bcc64a9f56406c4e145cd65651">SetPublicKey</a>(RECIPIENT_PUBKEY))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::sendUserMessage: Failed setting public key.\n&quot;</span>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (THE_MESSAGE.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp;
             theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pPubkey, THE_MESSAGE) &amp;&amp;
             theEnvelope.<a class="code" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">GetAsciiArmoredData</a>(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>))
    {
        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="comment">// ----------------------------------------------</span>
        <span class="comment">// store a copy in the outmail.</span>
        <span class="comment">// (not encrypted, since the Nymfile will be encrypted anyway.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;

        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

        pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outmailMessage&quot;</span>;
        pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;
        pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>       = strNymID2;
        pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>     = strServerID;
        pMessage-&gt;<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber);

        pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(THE_MESSAGE);

        pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
        pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a908900d7fa217571e2dd3a6c06789a9b">AddOutmail</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outmail&quot;.</span>
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym); <span class="comment">// commented out temp for testing.</span>

        nReturnValue = <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::sendUserMessage: Failed sealing envelope.\n&quot;</span>);

    <span class="keywordflow">return</span> nReturnValue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa2213ae9a93b111ca1c774df67818b6b"></a><!-- doxytag: member="OT_API::SetAccount_Name" ref="aa2213ae9a93b111ca1c774df67818b6b" args="(const OTIdentifier &amp;ACCT_ID, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;ACCT_NEW_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aa2213ae9a93b111ca1c774df67818b6b">OT_API::SetAccount_Name</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_NEW_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04286">4286</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::SetAccount_Name&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName);       <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pSignerNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFuncName);   <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pSignerNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> *     pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(ACCT_ID, szFuncName);       <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pAccount)   <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -------------------------------------</span>
    <span class="keywordflow">if</span> (!ACCT_NEW_NAME.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) <span class="comment">// Any other validation to do on the name?</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SetAccount_Name: New name is empty (bad).\n&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Saving updated account file to disk...\n&quot;</span>);
        pAccount-&gt;<a class="code" href="class_o_t_contract.html#ae6ad4eed689a88335c8818d7762bbbcb">SetName</a>(ACCT_NEW_NAME);
        pAccount-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        <span class="keywordflow">if</span> (pAccount-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pSignerNym) &amp;&amp; pAccount-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>() &amp;&amp; pAccount-&gt;<a class="code" href="class_o_t_account.html#adaba3f4ce60f7ac88f883c0543d9ddb0">SaveAccount</a>())
            <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>(); <span class="comment">// Only cause the account&#39;s name is stored here, too.</span>
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::SetAccount_Name: Failed doing this:  if (pAccount-&gt;SignContract(*pSignerNym) &quot;</span>
                         <span class="stringliteral">&quot;&amp;&amp; pAccount-&gt;SaveContract() &amp;&amp; pAccount-&gt;SaveAccount())\n&quot;</span>);
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a62071d84252f0b233071c640b9de67de"></a><!-- doxytag: member="OT_API::SetAssetType_Name" ref="a62071d84252f0b233071c640b9de67de" args="(const OTIdentifier &amp;ASSET_ID, const OTString &amp;STR_NEW_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a62071d84252f0b233071c640b9de67de">OT_API::SetAssetType_Name</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>STR_NEW_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01396">1396</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = __FUNCTION__; <span class="comment">//&quot;OT_API::SetAssetType_Name&quot;;</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(szFuncName); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(ASSET_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pContract is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Might want to put some more data validation on the name?</span>
    <span class="keywordflow">if</span> (!STR_NEW_NAME.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SetAssetType_Name: Bad: name is empty.\n&quot;</span>);
    <span class="keywordflow">else</span>
    {
        pContract-&gt;<a class="code" href="class_o_t_contract.html#ae6ad4eed689a88335c8818d7762bbbcb">SetName</a>(STR_NEW_NAME);
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>(); <span class="comment">// Only &#39;cause the name is actually stored here.</span>
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a765251304181ec99fa3874d0fe0a8568"></a><!-- doxytag: member="OT_API::SetNym_Name" ref="a765251304181ec99fa3874d0fe0a8568" args="(const OTIdentifier &amp;NYM_ID, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;NYM_NEW_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a765251304181ec99fa3874d0fe0a8568">OT_API::SetNym_Name</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_NEW_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04244">4244</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------}</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pNym        = <a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(NYM_ID, __FUNCTION__);
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pSignerNym  = <a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> ((NULL == pNym) || (NULL == pSignerNym))  <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym and pSignerNym are good pointers.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------}</span>
    <span class="comment">// Might want to put some more data validation on the name?</span>
    <span class="keywordflow">if</span> (!NYM_NEW_NAME.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SetNym_Name: Empty name (bad).\n&quot;</span>);
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strOldName(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a42e63697c3c3b1bdb526ee7990a9c0e7">GetNymName</a>()); <span class="comment">// just in case.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acf835189df80fda4eedc88d4cccdc5f1">SetNymName</a>(NYM_NEW_NAME);
        <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym))
        {
            <span class="keywordtype">bool</span> bSaveWallet = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>(); <span class="comment">// Only cause the nym&#39;s name is stored here, too.</span>
            <span class="keywordflow">if</span> (!bSaveWallet)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while trying to save wallet.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> bSaveWallet;
        }
        <span class="keywordflow">else</span>
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acf835189df80fda4eedc88d4cccdc5f1">SetNymName</a>(strOldName); <span class="comment">// Set it back to the old name if failure.</span>
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5e063a9ac2d1e9c15eb116948a16fb6e"></a><!-- doxytag: member="OT_API::SetServer_Name" ref="a5e063a9ac2d1e9c15eb116948a16fb6e" args="(const OTIdentifier &amp;SERVER_ID, const OTString &amp;STR_NEW_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a5e063a9ac2d1e9c15eb116948a16fb6e">OT_API::SetServer_Name</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>STR_NEW_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01427">1427</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = this-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pContract = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pContract is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Might want to put some more data validation on the name?</span>
    <span class="keywordflow">if</span> (!STR_NEW_NAME.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Bad: name is empty.\n&quot;</span>, __FUNCTION__);
    <span class="keywordflow">else</span>
    {
        pContract-&gt;<a class="code" href="class_o_t_contract.html#ae6ad4eed689a88335c8818d7762bbbcb">SetName</a>(STR_NEW_NAME);
        <span class="keywordflow">return</span> pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>(); <span class="comment">// Only &#39;cause the name is actually stored here.</span>
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aae7802dad48d8347a4b3d6b91e7aac0c"></a><!-- doxytag: member="OT_API::SetTransportCallback" ref="aae7802dad48d8347a4b3d6b91e7aac0c" args="(TransportCallback *pTransportCallback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aae7802dad48d8347a4b3d6b91e7aac0c">OT_API::SetTransportCallback</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_transport_callback.html">TransportCallback</a> *&#160;</td>
          <td class="paramname"><em>pTransportCallback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00627">627</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NULL != pTransportCallback) { this-&gt;m_pTransportCallback = pTransportCallback; <span class="keywordflow">return</span> <span class="keyword">true</span>; }
    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af6c984fa7aa142e79ed4ddbc14d14503"></a><!-- doxytag: member="OT_API::SetWallet" ref="af6c984fa7aa142e79ed4ddbc14d14503" args="(const OTString &amp;strFilename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#af6c984fa7aa142e79ed4ddbc14d14503">OT_API::SetWallet</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFilename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00807">807</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                   {

    <span class="keywordflow">if</span> (!m_bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    {
        <span class="keywordtype">bool</span> bExists = strFilename.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>();
        <span class="keywordflow">if</span> (bExists) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: strFilename dose not exist!\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    }

    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(strFilename.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>(),<span class="stringliteral">&quot;OT_API::SetWalletFilename: strFilename does not exist.\n&quot;</span>);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>((3 &lt; strFilename.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()),<span class="stringliteral">&quot;OT_API::SetWalletFilename: strFilename is too short.\n&quot;</span>);

    <span class="comment">// Set New Wallet Filename</span>
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Setting Wallet Filename... \n&quot;</span>, __FUNCTION__);
    <a class="code" href="class_o_t_string.html">OTString</a> strWalletFilename; <a class="code" href="class_o_t___a_p_i.html#a6e79ce6216fb40ef9c2f48615e72072a">OT_API::GetWalletFilename</a>(strWalletFilename);

    <span class="keywordflow">if</span> (strFilename.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(strWalletFilename))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Wallet Filename: %s  is same as in configuration. (skipping)\n&quot;</span>,__FUNCTION__,strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        strWalletFilename.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(strWalletFilename);

    <span class="comment">// Will save updated config filename.</span>

    <span class="comment">// Create Config Object (OTSettings)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strConfigFilePath;
    <a class="code" href="class_o_t_data_folder.html#a03f3da5b6d8d7f3df43757c66cbb8693">OTDataFolder::GetConfigFilePath</a>(strConfigFilePath);
    <a class="code" href="class_o_t_settings.html">OTSettings</a> * p_Config(<span class="keyword">new</span> <a class="code" href="class_o_t_settings.html">OTSettings</a>(strConfigFilePath));

    <span class="comment">// First Load, Create new fresh config file if failed loading.</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Load())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Note: Unable to Load Config. Creating a new file: %s\n&quot;</span>, __FUNCTION__, strConfigFilePath.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span> (!p_Config -&gt; Save() ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="comment">// Second Load, Throw Assert if Failed loading.</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Load())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(0,<span class="stringliteral">&quot;%s: Error: Unable to load config file: %s It should exist, as we just saved it!\n&quot;</span>, __FUNCTION__, strConfigFilePath.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }


    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// Set New Wallet Filename</span>
    {
        <span class="keywordtype">bool</span> bNewOrUpdated;
        p_Config -&gt; Set_str(<span class="stringliteral">&quot;wallet&quot;</span>,<span class="stringliteral">&quot;wallet_filename&quot;</span>,strWalletFilename,bNewOrUpdated,<span class="stringliteral">&quot;; Wallet updated\n&quot;</span>);

        <a class="code" href="class_o_t___a_p_i.html#a5eaacf363f5fb27e71c196cbb099cced">OT_API::SetWalletFilename</a>(strWalletFilename);
    }


    <span class="comment">// Done Loading... Lets save any changes...</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Save())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error! Unable to save updated Config!!!\n&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="comment">// Finsihed Saving... now lets cleanup!</span>
    <span class="keywordflow">if</span> (!p_Config -&gt; Reset()) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Updated Wallet filename: %s \n&quot;</span>,__FUNCTION__,strWalletFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5eaacf363f5fb27e71c196cbb099cced"></a><!-- doxytag: member="OT_API::SetWalletFilename" ref="a5eaacf363f5fb27e71c196cbb099cced" args="(const OTString &amp;strPath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a5eaacf363f5fb27e71c196cbb099cced">OT_API::SetWalletFilename</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00625">625</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">if</span> (strPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) { m_strWalletFilename = strPath; <span class="keywordflow">return</span> <span class="keyword">true</span>; } <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="aa354b7ac168afd7cacfcf045241f4771"></a><!-- doxytag: member="OT_API::SignContract" ref="aa354b7ac168afd7cacfcf045241f4771" args="(const OTIdentifier &amp;theSignerNymID, const OTString &amp;strContract, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aa354b7ac168afd7cacfcf045241f4771">OT_API::SignContract</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strContract</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-Sign a CONTRACT. (First signature) Tries to instantiate the contract object, based on the string passed in. Then it releases ALL signatures, and then signs the contract. Returns the signed contract, or NULL if failure.</p>
<p>OT-Sign a CONTRACT. (First signature)</p>
<p>const char * OT_API_SignContract(const char * SIGNER_NYM_ID, const char * THE_CONTRACT);</p>
<p>Tries to instantiate the contract object, based on the string passed in. Releases all signatures, and then signs the contract. Returns the signed contract, or NULL if failure.</p>
<p>NOTE: The actual OT functionality (Use Cases) NEVER requires you to sign via this function. Why not? because, anytime a signature is needed on something, the relevant OT API call will require you to pass in the Nym, and the API already signs internally wherever it deems appropriate. Thus, this function is only for advanced uses, for OT-Scripts, server operators, etc. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03145">3145</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerNymID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!strContract.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract passed in. (Returning false.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_contract.html">OTContract</a> * pContract = NULL;

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_contract.html#a3a4b4d7e43a53027a5e170557b9e7e12">OTContract::InstantiateContract</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: I tried my best. &quot;</span>
                       <span class="stringliteral">&quot;Unable to instantiate contract passed in:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTContract&gt;</a> theAngel(*pContract);

    <span class="comment">// -----------------------------------------------------</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// -----------------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a47bbd248e72e8d45609a5365f7fa5187"></a><!-- doxytag: member="OT_API::SmartContract_AddAccount" ref="a47bbd248e72e8d45609a5365f7fa5187" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;PARTY_NAME, const OTString &amp;ACCT_NAME, const OTString &amp;ASSET_TYPE_ID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a47bbd248e72e8d45609a5365f7fa5187">OT_API::SmartContract_AddAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>PARTY_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03502">3502</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddAccount: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_party_name(PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddAccount: Failure: Party doesn&#39;t exist. \n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> std::string str_name(ACCT_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_asset_id(ASSET_TYPE_ID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (NULL != pParty-&gt;GetAccount(str_name))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddAccount: Failed adding: account is already there with that name (%s) on party: %s \n&quot;</span>,
                       str_name.c_str(), str_party_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAgentName, strAcctName(str_name.c_str()), strAcctID, strAssetTypeID(str_asset_id.c_str());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;AddAccount(strAgentName, strAcctName, strAcctID, strAssetTypeID, 0))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddAccount: Failed trying to add account (%s) to party: %s \n&quot;</span>,
                       str_name.c_str(), str_party_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a68be6928764334d775d466f0e4725d72"></a><!-- doxytag: member="OT_API::SmartContract_AddBylaw" ref="a68be6928764334d775d466f0e4725d72" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;BYLAW_NAME, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a68be6928764334d775d466f0e4725d72">OT_API::SmartContract_AddBylaw</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BYLAW_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03849">3849</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * BYLAW_LANGUAGE = <span class="stringliteral">&quot;chai&quot;</span>; <span class="comment">// todo hardcoding.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddBylaw: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_bylaw_name(BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_language(BYLAW_LANGUAGE);

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

    <span class="keywordflow">if</span> (NULL != pBylaw)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddBylaw: Failure: Bylaw already exists: %s \n&quot;</span>,
                       BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    pBylaw = <span class="keyword">new</span> <a class="code" href="class_o_t_bylaw.html">OTBylaw</a>(str_bylaw_name.c_str(), str_language.c_str());
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a32d8bccb563ab97e335f457148770c73">AddBylaw</a>(*pBylaw)) <span class="comment">// takes ownership.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddBylaw: Failed while trying to add bylaw: %s \n&quot;</span>,
                       BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keyword">delete</span> pBylaw; pBylaw = NULL;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb0a85ed4e9125dea813ba87e2e9ecf8"></a><!-- doxytag: member="OT_API::SmartContract_AddCallback" ref="acb0a85ed4e9125dea813ba87e2e9ecf8" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;BYLAW_NAME, const OTString &amp;CALLBACK_NAME, const OTString &amp;CLAUSE_NAME, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#acb0a85ed4e9125dea813ba87e2e9ecf8">OT_API::SmartContract_AddCallback</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BYLAW_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CALLBACK_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CLAUSE_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03972">3972</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName     = <span class="stringliteral">&quot;OT_API::SmartContract_AddCallback&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddCallback: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_bylaw_name(BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

    <span class="keywordflow">if</span> (NULL == pBylaw)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddCallback: Failure: Bylaw doesn&#39;t exist: %s \n&quot;</span>,
                       str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> std::string   str_name(CALLBACK_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_clause(CLAUSE_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (NULL != pBylaw-&gt;GetCallback(str_name))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddCallback: Failure: Callback (%s) already exists on bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddCallback(str_name.c_str(), str_clause.c_str()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddCallback: Failed trying to add callback (%s, clause %s) to bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_clause.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a495e1b59fcfedf265a853665c7e2f73c"></a><!-- doxytag: member="OT_API::SmartContract_AddClause" ref="a495e1b59fcfedf265a853665c7e2f73c" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;BYLAW_NAME, const OTString &amp;CLAUSE_NAME, const OTString &amp;SOURCE_CODE, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a495e1b59fcfedf265a853665c7e2f73c">OT_API::SmartContract_AddClause</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BYLAW_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CLAUSE_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>SOURCE_CODE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04042">4042</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName     = <span class="stringliteral">&quot;OT_API::SmartContract_AddClause&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddClause: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_bylaw_name(BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

    <span class="keywordflow">if</span> (NULL == pBylaw)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddClause: Failure: Bylaw doesn&#39;t exist: %s \n Input contract: \n\n%s\n\n&quot;</span>,
                       str_bylaw_name.c_str(), THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> std::string str_name(CLAUSE_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_code(SOURCE_CODE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (NULL != pBylaw-&gt;GetClause(str_name))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddClause: Failed adding: clause is already there with that name (%s) on bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddClause(str_name.c_str(), str_code.c_str()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddClause: Failed trying to add clause (%s) to bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae4c6e55f20c7609a2a6b774505483bab"></a><!-- doxytag: member="OT_API::SmartContract_AddHook" ref="ae4c6e55f20c7609a2a6b774505483bab" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;BYLAW_NAME, const OTString &amp;HOOK_NAME, const OTString &amp;CLAUSE_NAME, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ae4c6e55f20c7609a2a6b774505483bab">OT_API::SmartContract_AddHook</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BYLAW_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>HOOK_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CLAUSE_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03911">3911</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName     = <span class="stringliteral">&quot;OT_API::SmartContract_AddHook&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddHook: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_bylaw_name(BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

    <span class="keywordflow">if</span> (NULL == pBylaw)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddHook: Failure: Bylaw doesn&#39;t exist: %s \n&quot;</span>,
                       str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> std::string   str_name(HOOK_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_clause(CLAUSE_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddHook(str_name, str_clause))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddHook: Failed trying to add hook (%s, clause %s) to bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_clause.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a357d0c597723cd9b03bb77b8636ec1ca"></a><!-- doxytag: member="OT_API::SmartContract_AddParty" ref="a357d0c597723cd9b03bb77b8636ec1ca" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;PARTY_NAME, const OTString &amp;AGENT_NAME, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a357d0c597723cd9b03bb77b8636ec1ca">OT_API::SmartContract_AddParty</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>PARTY_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>AGENT_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03441">3441</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_party_name(PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_agent_name(AGENT_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);

    <span class="keywordflow">if</span> (NULL != pParty)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Party already exists. \n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>

    pParty = <span class="keyword">new</span> <a class="code" href="class_o_t_party.html">OTParty</a>(str_party_name.c_str(), <span class="keyword">true</span> <span class="comment">/*bIsOwnerNym*/</span>,
                         NULL<span class="comment">/*OwnerID not set until confirm*/</span>, str_agent_name.c_str(),
                         <span class="keyword">true</span>); <span class="comment">//bCreateAgent=false by default.</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_scriptable.html#accfde75655f5c49c041ef3a5fbff54e6">AddParty</a>(*pParty)) <span class="comment">// takes ownership.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed while trying to add party: %s \n&quot;</span>,
                       __FUNCTION__, PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keyword">delete</span> pParty; pParty=NULL;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a561b64935144d650a1790b614a593be8"></a><!-- doxytag: member="OT_API::SmartContract_AddVariable" ref="a561b64935144d650a1790b614a593be8" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;BYLAW_NAME, const OTString &amp;VAR_NAME, const OTString &amp;VAR_ACCESS, const OTString &amp;VAR_TYPE, const OTString &amp;VAR_VALUE, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a561b64935144d650a1790b614a593be8">OT_API::SmartContract_AddVariable</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>BYLAW_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>VAR_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>VAR_ACCESS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>VAR_TYPE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>VAR_VALUE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04111">4111</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName     = <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_bylaw_name(BYLAW_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

    <span class="keywordflow">if</span> (NULL == pBylaw)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable: Failure: Bylaw doesn&#39;t exist: %s \n&quot;</span>,
                       str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> std::string   str_name(VAR_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_access(VAR_ACCESS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()),
                        str_type(VAR_TYPE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()), str_value(VAR_VALUE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="keywordflow">if</span> (NULL != pBylaw-&gt;GetVariable(str_name))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable: Failure: Variable (%s) already exists on bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672">OTVariable::OTVariable_Access</a> theAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a664538cd758878fab6c2e8718b1839fc">OTVariable::Var_Error_Access</a>;

    <span class="keywordflow">if</span> (str_access.compare(<span class="stringliteral">&quot;constant&quot;</span>) == 0)
        theAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_access.compare(<span class="stringliteral">&quot;persistent&quot;</span>) == 0)
        theAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672ad39bbaff07fae07e5d3dece3789fb03c">OTVariable::Var_Persistent</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_access.compare(<span class="stringliteral">&quot;important&quot;</span>) == 0)
        theAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a087192fa3f7d345cf2eb413a52fdddc4">OTVariable::Var_Important</a>;
    <span class="comment">// ---------------------</span>
    <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009">OTVariable::OTVariable_Type</a> theType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ae4992b1094ef990fbe683f43c7b2a2a8">OTVariable::Var_Error_Type</a>;

    <span class="keywordflow">if</span> (str_type.compare(<span class="stringliteral">&quot;bool&quot;</span>) == 0)
        theType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a4f6c0ea25b7a5aed16bc7710389e77da">OTVariable::Var_Bool</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_type.compare(<span class="stringliteral">&quot;integer&quot;</span>) == 0)
        theType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ad6ecaa07337c8641bed85deab47c1a1d">OTVariable::Var_Integer</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_type.compare(<span class="stringliteral">&quot;string&quot;</span>) == 0)
        theType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a814483713bd6ebb3b01c06378fc60fa7">OTVariable::Var_String</a>;
    <span class="comment">// ---------------------</span>
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ae4992b1094ef990fbe683f43c7b2a2a8">OTVariable::Var_Error_Type</a> == theType) || (<a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a664538cd758878fab6c2e8718b1839fc">OTVariable::Var_Error_Access</a> == theAccess))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable: Failed due to bad variable type or bad access type. \n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------</span>
    <span class="keywordtype">bool</span> bAdded = <span class="keyword">false</span>;

    <span class="keywordflow">switch</span> (theType)
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a4f6c0ea25b7a5aed16bc7710389e77da">OTVariable::Var_Bool</a>:
        {
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bValue = (str_value.compare(<span class="stringliteral">&quot;true&quot;</span>) == 0);
            bAdded = pBylaw-&gt;AddVariable(str_name, bValue, theAccess);
        }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ad6ecaa07337c8641bed85deab47c1a1d">OTVariable::Var_Integer</a>:
        {
            <span class="keyword">const</span> int32_t nValue = atoi(str_value.c_str());
            bAdded = pBylaw-&gt;AddVariable(str_name, nValue, theAccess);
        }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a814483713bd6ebb3b01c06378fc60fa7">OTVariable::Var_String</a>:
            bAdded = pBylaw-&gt;AddVariable(str_name, str_value, theAccess);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="comment">// SHOULD NEVER HAPPEN (We already return above, if the variable type isn&#39;t correct.)</span>
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;Should never happen. You aren&#39;t seeing this.&quot;</span>);
            <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bAdded)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_AddVariable: Failed trying to add variable (%s) to bylaw: %s \n&quot;</span>,
                       str_name.c_str(), str_bylaw_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <span class="comment">// Success!</span>
    <span class="comment">//</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a10954b356a026ea6729ece4d16b281eb"></a><!-- doxytag: member="OT_API::SmartContract_ConfirmAccount" ref="a10954b356a026ea6729ece4d16b281eb" args="(const OTString &amp;THE_CONTRACT, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;PARTY_NAME, const OTString &amp;ACCT_NAME, const OTString &amp;AGENT_NAME, const OTString &amp;ACCT_ID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a10954b356a026ea6729ece4d16b281eb">OT_API::SmartContract_ConfirmAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>PARTY_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>AGENT_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03602">3602</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAcctID(ACCT_ID);
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theAcctID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
    <span class="keywordflow">if</span> (NULL == pScriptable)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                       __FUNCTION__, THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pContract = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pScriptable);
    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure casting to Smart Contract. &quot;</span>
                       <span class="stringliteral">&quot;Are you SURE it&#39;s a smart contract? Contents:\n&quot;</span>
                       <span class="stringliteral">&quot;%s\n&quot;</span>, __FUNCTION__, THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_party_name(PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);
    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Party doesn&#39;t exist: %s \n&quot;</span>,
                       __FUNCTION__, PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// Make sure there&#39;s not already an account here with the same ID (Server disallows.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pDupeAcct = pParty-&gt;GetAccountByID(theAcctID);
    <span class="keywordflow">if</span> (NULL != pDupeAcct) <span class="comment">// It&#39;s already there.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed, since a duplicate account ID (%s) &quot;</span>
                       <span class="stringliteral">&quot;was already found on this contract. (Server disallows, sorry.)\n&quot;</span>,
                        __FUNCTION__, ACCT_ID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// Find the account template based on its name, to affix the acct ID to.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> std::string str_name(ACCT_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pPartyAcct = pParty-&gt;GetAccount(str_name);
    <span class="keywordflow">if</span> (NULL == pPartyAcct) <span class="comment">// It&#39;s not already there. (Though it should be...)</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed: No account found on contract with name: %s \n&quot;</span>,
                        __FUNCTION__, str_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// the actual asset type ID</span>

    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theExpectedAssetTypeID(pPartyAcct-&gt;GetAssetTypeID()); <span class="comment">// The expected asset type ID, converting from a string.</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>&amp; theActualAssetTypeID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();    <span class="comment">// the actual asset type ID, already an identifier, from the actual account.</span>

    <span class="keywordflow">if</span> (theExpectedAssetTypeID != theActualAssetTypeID)
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(theActualAssetTypeID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed, since the asset type ID of the account (%s) &quot;</span>
                       <span class="stringliteral">&quot;does not match what was expected (%s) according to this contract.\n&quot;</span>,
                        __FUNCTION__, strAssetTypeID.Get(), pPartyAcct-&gt;GetAssetTypeID().Get());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// I&#39;m leaving this here for now, since a party can only be a Nym for now anyway (until I code entities.)</span>
    <span class="comment">// Therefore this account COULD ONLY be owned by that Nym anyway, and thus will pass this test.</span>
    <span class="comment">// All the above functions aren&#39;t that stringent because they are about designing the smart contract, not</span>
    <span class="comment">// executing it. But in THIS case, we are actually confirming the thing, and adding our actual account #s</span>
    <span class="comment">// to it, signing it, etc, so I might as well save the person the hassle of being rejected later because</span>
    <span class="comment">// he accidentally set it up with the wrong Nym.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAccount-&gt;<a class="code" href="class_o_t_account.html#a73c89c2d411eb7b88326baf87802f238">VerifyOwner</a>(*pNym))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(SIGNER_NYM_ID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed, since this nym (%s) isn&#39;t the owner of this account (%s).\n&quot;</span>,
                        __FUNCTION__, strNymID.Get(), str_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// When the first ACCOUNT is confirmed, then at that moment, we know which server</span>
    <span class="comment">// this smart contract is intended to execute on.</span>
    <span class="comment">//</span>
    <span class="comment">// If this is the first account being confirmed, then we will set the server ID</span>
    <span class="comment">// for the smart contract based on the server ID of this account. Otherwise if this</span>
    <span class="comment">// is not the first account being confirmed, then we will compare the server ID</span>
    <span class="comment">// that&#39;s already on the smart contract, to the server ID for this account, and make</span>
    <span class="comment">// sure they match. (Otherwise we will reject the confirmation.)</span>
    <span class="comment">//</span>
    <span class="comment">// Once the contract is activated, the server will verify all the parties and accounts</span>
    <span class="comment">// anyway. So might as well save ourselves the hassle, if this doesn&#39;t match up now.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_smart_contract.html#aa4d0e2f242f874a9a594a31d8af26533">SetServerIDIfEmpty</a>(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()))
    {
        <span class="comment">// todo security: possibly want to verify here that this really is the FIRST</span>
        <span class="comment">// account being confirmed in this smart contract, or at least the first party.</span>
        <span class="comment">// Right now we&#39;re just using the server ID being empty as an easy way to find</span>
        <span class="comment">// out, but technically a party could slip in a &quot;signed version&quot; without setting</span>
        <span class="comment">// the server ID, and it might slip by here (though it would eventually fail some</span>
        <span class="comment">// verification.) In the int64_t term we&#39;ll do a more thorough check here, though.</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pContract-&gt;<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>() != pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>())
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServer1(pContract-&gt;<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>()),
                       strServer2(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: The smart contract has a different server ID on it already (%s) &quot;</span>
                       <span class="stringliteral">&quot;than the one that goes with this account (server %s, for account %s)\n&quot;</span>,
                       __FUNCTION__, strServer1.Get(), strServer2.Get(), ACCT_ID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// BY THIS POINT, we know that the account is actually owned by the Nym,</span>
    <span class="comment">// and we know that it&#39;s got the proper asset type ID that was expected</span>
    <span class="comment">// according to the smart contract. We also know that the smart contract</span>
    <span class="comment">// has the same server ID as the account being confirmed.</span>
    <span class="comment">//</span>
    pPartyAcct-&gt;SetAcctID(ACCT_ID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    pPartyAcct-&gt;SetAgentName(AGENT_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -------------------------------</span>
    pContract-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// -------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// -------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c1974fc1798d311264ff55ef1724dcf"></a><!-- doxytag: member="OT_API::SmartContract_ConfirmParty" ref="a3c1974fc1798d311264ff55ef1724dcf" args="(const OTString &amp;THE_CONTRACT, const OTString &amp;PARTY_NAME, const OTIdentifier &amp;NYM_ID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a3c1974fc1798d311264ff55ef1724dcf">OT_API::SmartContract_ConfirmParty</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>PARTY_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03755">3755</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;

    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading smart contract:\n\n%s\n\n&quot;</span>,
                        __FUNCTION__, THE_CONTRACT.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> std::string str_party_name(PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pContract-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Party (%s) doesn&#39;t exist, so how can you confirm it?\n&quot;</span>,
                        __FUNCTION__, str_party_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------</span>
    <a class="code" href="class_o_t_party.html">OTParty</a> * pNewParty = <span class="keyword">new</span> <a class="code" href="class_o_t_party.html">OTParty</a>(pParty-&gt;GetPartyName(), *pNym, <span class="comment">// party keeps an internal pointer to pNym from here on.</span>
                                      pParty-&gt;GetAuthorizingAgentName()); <span class="comment">// Party name and agent name must match, in order to replace / activate this party.</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNewParty);
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;CopyAcctsToConfirmingParty(*pNewParty))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed while trying to copy accounts, while confirming party: %s \n&quot;</span>,
                        __FUNCTION__, PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keyword">delete</span> pNewParty; pNewParty=NULL;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_scriptable.html#a197539281206ac2e950ff0fc4842886b">ConfirmParty</a>(*pNewParty)) <span class="comment">// takes ownership. (Deletes the theoretical version of the party, replaced by our actual version pNewParty.)</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed while trying to confirm party: %s \n&quot;</span>,
                        __FUNCTION__, PARTY_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keyword">delete</span> pNewParty; pNewParty=NULL;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------</span>
    <span class="comment">// ConfirmParty(), unlike most others, actually signs and saves the contract already.</span>
    <span class="comment">// Therefore, all that&#39;s needed here is to grab it in string form...</span>
    <span class="comment">// (No need to sign again, it&#39;s just a waste of resource..)</span>
<span class="comment">//  pContract-&gt;ReleaseSignatures();</span>
<span class="comment">//  pContract-&gt;SignContract(*pNym);</span>
<span class="comment">//  pContract-&gt;SaveContract();</span>

    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
    <span class="comment">// ------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// DROP A COPY into the Outpayments box...</span>
    <span class="comment">//</span>
    <span class="comment">// (Since we used a transaction number to confirm the party, we</span>
    <span class="comment">// have to track it until it&#39;s activated or until we cancel it.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInstrument(*pContract);
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outpaymentsMessage&quot;</span>;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;
<span class="comment">//  pMessage-&gt;m_strServerID     = strServerID;</span>
    pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strInstrument);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
    pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);
    <span class="comment">// ------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae9ebf14defb8aa50c6c40a1b20fbe20d"></a><!-- doxytag: member="OT_API::SmartContract_CountNumsNeeded" ref="ae9ebf14defb8aa50c6c40a1b20fbe20d" args="(const OTString &amp;THE_CONTRACT, const OTString &amp;AGENT_NAME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#ae9ebf14defb8aa50c6c40a1b20fbe20d">OT_API::SmartContract_CountNumsNeeded</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_CONTRACT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>AGENT_NAME</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03570">3570</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nReturnValue = 0;
    <span class="keyword">const</span> std::string   str_agent_name(AGENT_NAME.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// ----------------------------------------------------</span>
    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(THE_CONTRACT);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;

    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::SmartContract_CountNumsNeeded: Error loading smart contract. \n&quot;</span>);
        <span class="keywordflow">return</span> nReturnValue;
    }
    <span class="keywordflow">else</span>
        theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pContract);  <span class="comment">// Auto-cleanup.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// -- nReturnValue starts as 0.</span>
    <span class="comment">// -- If agent is authorizing agent for a party, nReturnValue++. (Opening number.)</span>
    <span class="comment">// -- If agent is authorized agent for any of party&#39;s accts, nReturnValue++ for each. (Closing numbers.)</span>
    <span class="comment">//</span>
    <span class="comment">// (Then return the count.)</span>

    nReturnValue = pContract-&gt;GetCountTransNumsNeededForAgent(str_agent_name);
    <span class="comment">// ----------------------------------------------------</span>
    <span class="keywordflow">return</span> nReturnValue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7183d283456ab1e13c01f88b71062828"></a><!-- doxytag: member="OT_API::Token_ChangeOwner" ref="a7183d283456ab1e13c01f88b71062828" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTString &amp;THE_TOKEN, const OTIdentifier &amp;SIGNER_NYM_ID, const OTString &amp;OLD_OWNER, const OTString &amp;NEW_OWNER, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_token.html">OTToken</a> * <a class="el" href="class_o_t___a_p_i.html#a7183d283456ab1e13c01f88b71062828">OT_API::Token_ChangeOwner</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_TOKEN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>OLD_OWNER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>NEW_OWNER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05858">5858</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::Token_ChangeOwner&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strWalletReason((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter your wallet&#39;s master passphrase. (Token_ChangeOwner.)&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_string.html">OTString</a> strPurseReason ((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter the passphrase for this purse. (Token_ChangeOwner.)&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataWallet(strWalletReason);
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_NYM_ID, <span class="keyword">false</span>, szFunc, &amp;thePWDataWallet); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pSignerNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// ALL THE COMPLEXITY YOU SEE BELOW is mainly just about handling OLD_OWNER</span>
    <span class="comment">// and NEW_OWNER each as either a NymID or as a Purse (containing a symmetric key and</span>
    <span class="comment">// a corresponding master key.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> oldOwnerNymID, newOwnerNymID; <span class="comment">// if either owner is a Nym, the ID goes here.</span>
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pOldPurse = NULL;                <span class="comment">// if the old owner is a Purse (symmetric+master key), the entire purse is loaded.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theOldPurseAngel;
    <a class="code" href="class_o_t_password.html">OTPassword</a> theOldPassword;      <span class="comment">// Only used in the case of password-protected purses.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *           pOldNym   = NULL;
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pOldOwner = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOldOwnerAngel;
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pNewPurse = NULL;                <span class="comment">// if the new owner is a Purse (symmetric+master key), the entire purse is loaded.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theNewPurseAngel;
    <a class="code" href="class_o_t_password.html">OTPassword</a> theNewPassword;      <span class="comment">// Only used in the case of password-protected purses.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *           pNewNym   = NULL;
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pNewOwner = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theNewOwnerAngel;
    <span class="comment">// ------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bOldOwnerIsPurse = OLD_OWNER.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;PURSE&quot;</span>);
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNewOwnerIsPurse = NEW_OWNER.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;PURSE&quot;</span>);
    <span class="comment">// ********************************************************************************</span>
    <span class="keywordflow">if</span> (!bOldOwnerIsPurse) <span class="comment">// The old owner is a NYM (public/private keys.)</span>
    {
        oldOwnerNymID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(OLD_OWNER);
        <span class="comment">// -----------------------------------------------------</span>
                                pOldNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(oldOwnerNymID, <span class="keyword">false</span>, szFunc, &amp;thePWDataWallet); <span class="comment">// These copiously log, and ASSERT.</span>
<span class="comment">//      if (NULL == pOldNym)    pOldNym = this-&gt;GetOrLoadPublicNym(oldOwnerNymID, szFunc); // must be private, in order to decrypt the old token.</span>
        <span class="keywordflow">if</span> (NULL == pOldNym)    <span class="keywordflow">return</span> NULL;
        <span class="comment">// -----------------------------------------------------</span>
        pOldOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pOldNym, &amp;strWalletReason);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOldOwner);
        theOldOwnerAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOldOwner);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">else</span>                  <span class="comment">// The old owner is a PURSE (Symmetric/master keys, internal to that purse.)</span>
    {
        pOldPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOldPurse);
        theOldPurseAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOldPurse);
        <span class="comment">// -----------------------------------------------------</span>
        pOldOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">LoadPurseAndOwnerForMerge</a>(OLD_OWNER, *pOldPurse, theOldPassword,
                                                    <span class="keyword">false</span>, <span class="comment">//bCanBePublic=false by default. In this case, it definitely must be private.</span>
                                                    &amp;SIGNER_NYM_ID, <span class="comment">// This can be NULL, **IF** purse is password-protected. (It&#39;s just ignored in that case.) Otherwise if it&#39;s Nym-protected, the purse will have a NymID on it already, which is what LoadPurseAndOwnerForMerge will try first. If not (it&#39;s optional), then SIGNER_NYM_ID is the ID it will try next, before failing altogether. ADDITIONAL NOTE: We don&#39;t expect the purse to ever be Nym-based since in this function, we pass a purse in order to pass the symmetric and master keys. Otherwise if this token&#39;s owner was already a Nym, then we would have passed a NymID in here, instead of a purse, in the first place.</span>
                                                    &amp;strPurseReason);
        theOldOwnerAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOldOwner);
        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (NULL == pOldOwner) <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs, no need for more logs.</span>
        <span class="comment">// -----------------------------------------------------------------</span>
    }
    <span class="comment">// ********************************************************************************</span>
    <span class="keywordflow">if</span> (!bNewOwnerIsPurse) <span class="comment">// The new owner is a NYM</span>
    {
        newOwnerNymID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(NEW_OWNER);
        <span class="comment">// -----------------------------------------------------</span>
        pNewNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(newOwnerNymID, <span class="keyword">false</span>, szFunc, &amp;thePWDataWallet); <span class="comment">// These copiously log, and ASSERT.</span>
        <span class="keywordflow">if</span> (NULL == pNewNym)    <span class="keywordflow">return</span> NULL;
        <span class="comment">// -----------------------------------------------------</span>
        pNewOwner = <span class="keyword">new</span> <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a>(*pNewNym, &amp;strWalletReason);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNewOwner);
        theNewOwnerAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pNewOwner);
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">else</span>                   <span class="comment">// The new owner is a PURSE</span>
    {
        pNewPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNewPurse);
        theNewPurseAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pNewPurse);
        <span class="comment">// -----------------------------------------------------</span>
        pNewOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">LoadPurseAndOwnerForMerge</a>(NEW_OWNER, *pNewPurse, theNewPassword,
                                                    <span class="keyword">true</span>, <span class="comment">//bCanBePublic=false by default, but set TRUE here, since you SHOULD be able to re-assign ownership of a token to someone else, without having to load their PRIVATE key (which you don&#39;t have.) Sort of irrelevant here actually, since this block is for purses only...</span>
                                                    &amp;SIGNER_NYM_ID, <span class="comment">// This can be NULL, **IF** purse is password-protected. (It&#39;s just ignored in that case.) Otherwise if it&#39;s Nym-protected, the purse will have a NymID on it already, which is what LoadPurseAndOwnerForMerge will try first. If not (it&#39;s optional), then SIGNER_NYM_ID is the ID it will try next, before failing altogether. ADDITIONAL NOTE: We don&#39;t expect the purse to ever be Nym-based since in this function, we pass a purse in order to pass the symmetric and master keys. Otherwise if this token&#39;s owner was already a Nym, then we would have passed a NymID in here, instead of a purse, in the first place.</span>
                                                    &amp;strPurseReason);
        theNewOwnerAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pNewOwner);
        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (NULL == pNewOwner) <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs, no need for more logs.</span>
        <span class="comment">// -----------------------------------------------------------------</span>
    }
    <span class="comment">// ********************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// (By this point, pOldOwner and pNewOwner should both be good to go.)</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(THE_TOKEN, SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pToken);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pToken-&gt;<a class="code" href="class_o_t_token.html#aa661b16971fbca2e3b4a1c3452e4c030">ReassignOwnership</a>(*pOldOwner,  <span class="comment">// must be private, if a Nym.</span>
                                           *pNewOwner)) <span class="comment">// can be public, if a Nym.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error re-assigning ownership of token.\n&quot;</span>,
                      szFunc);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: Success re-assigning ownership of token.\n&quot;</span>,
                       szFunc);

        pToken-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pToken-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pSignerNym);
        pToken-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        theTokenAngel.SetCleanupTargetPointer(NULL); <span class="comment">// so pToken doesn&#39;t get deleted, since we&#39;re returning it here.</span>
        <span class="keywordflow">return</span> pToken;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a597eab7dd06eba0ae38de43717fb775f"></a><!-- doxytag: member="OT_API::TransportFunction" ref="a597eab7dd06eba0ae38de43717fb775f" args="(OTServerContract &amp;theServerContract, OTEnvelope &amp;theEnvelope)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a597eab7dd06eba0ae38de43717fb775f">OT_API::TransportFunction</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_server_contract.html">OTServerContract</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerContract</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;&#160;</td>
          <td class="paramname"><em>theEnvelope</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00931">931</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>())                 { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is not Initialized!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;OT_API&quot;</span>);     <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="keywordflow">if</span> (NULL == this-&gt;<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>)                { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is a NULL!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pClient&quot;</span>);       <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="keywordflow">if</span> (NULL == this-&gt;<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a28169697045727fc9e3bb2228a0fd21d">m_pConnection</a>) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is a NULL!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_pConnection&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="comment">// ----------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym(<a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> -&gt; m_pConnection -&gt; <a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>());
    <span class="keywordflow">if</span> (NULL == pNym)                           { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is a NULL!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;pNym&quot;</span>);                <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="keywordflow">if</span> (NULL == this-&gt;m_pSocket)                { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is a NULL!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_Socket&quot;</span>);            <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="keywordflow">if</span> (NULL == this-&gt;m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#a1154b4c4830d860ec5c4047bfc15af34">GetMutex</a>())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is a NULL!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_Socket&quot;</span>);            <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="keywordflow">if</span> (!m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#a9a82b48711ebe8ce96b94717a3cf6005">IsInitialized</a>())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: %s is not Initialized!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;m_Socket&quot;</span>);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;}
    <span class="comment">// ----------------------------------------------</span>
    tthread::lock_guard&lt;tthread::mutex&gt;  lock(*m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#a1154b4c4830d860ec5c4047bfc15af34">GetMutex</a>());
    <span class="comment">// ----------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OT_API::TransportCallback&quot;</span>;
    <span class="comment">// ----------------------------------------------</span>
    int32_t         nServerPort = 0;
    <a class="code" href="class_o_t_string.html">OTString</a>    strServerHostname;

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theServerContract.<a class="code" href="class_o_t_server_contract.html#a0714f92ddd215d7a0120dffc4c9c8cd5">GetConnectInfo</a>(strServerHostname, nServerPort))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed retrieving connection info from server contract.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strConnectPath;
    strConnectPath.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;tcp://%s:%d&quot;</span>, strServerHostname.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), nServerPort);
    <span class="comment">// --------------------------------------------</span>

    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascEnvelope(theEnvelope);

    <span class="keywordflow">if</span> (ascEnvelope.Exists())
    {
        <span class="keywordflow">if</span> (!m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#abf3a3309b1db9a9f069fc73f6621f2f6">HasContext</a>()) <span class="keywordflow">if</span>(!m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#a7e398f4273932d4d43d3012120326bb0">NewContext</a>())
            <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// unable to make context. btw. should have been already made.</span>

        <span class="comment">// --------------------------------------------</span>

        <span class="keywordtype">bool</span> bSuccessSending = m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#ab87369f9469c9881c6bd821636657523">Send</a>(ascEnvelope, strConnectPath);  <span class="comment">// &lt;========</span>

        <span class="keywordflow">if</span> (!bSuccessSending)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed, even with error correction and retries, &quot;</span>
                <span class="stringliteral">&quot;while trying to send message to server.&quot;</span>, szFunc);
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a>  strRawServerReply;
            <span class="keywordtype">bool</span>      bSuccessReceiving = m_pSocket-&gt;<a class="code" href="class_o_t_socket.html#a22c16b853dab1812a724d91c436135af">Receive</a>(strRawServerReply); <span class="comment">// &lt;========</span>

            <span class="keywordflow">if</span> (!bSuccessReceiving || !strRawServerReply.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to receive expected reply from server.\n&quot;</span>, szFunc);
            }
            <span class="comment">// ----------------------------------------------------------</span>
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascServerReply;
                <span class="keyword">const</span> <span class="keywordtype">bool</span>   bLoaded = strRawServerReply.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; ascServerReply.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">LoadFromString</a>(strRawServerReply);
                <span class="comment">// -----------------------------</span>
                <a class="code" href="class_o_t_string.html">OTString</a> strServerReply;
                <span class="keywordtype">bool</span>     bRetrievedReply = <span class="keyword">false</span>;
                <span class="comment">// -----------------------------</span>
                <span class="keywordflow">if</span> (!bLoaded)
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to load OTASCIIArmor object from string:\n\n%s\n\n&quot;</span>,
                    szFunc, strRawServerReply.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="comment">// ----------------------------------------------------------</span>

                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strRawServerReply.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;ENVELOPE&quot;</span>)) <span class="comment">// Server sent this encrypted to my public key, in an armored envelope.</span>
                {
                    <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>
                        theServerEnvelope;
                    <span class="keywordflow">if</span> (theServerEnvelope.<a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(ascServerReply))
                    {

                        bRetrievedReply = theServerEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(*pNym, strServerReply);
                    }
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: while setting OTASCIIArmor&#39;d string into an OTEnvelope.\n&quot;</span>, szFunc);
                    }
                }
                <span class="comment">// ----------------------------------------------------------</span>
                <span class="comment">// NOW ABLE TO HANDLE MESSAGES HERE IN ADDITION TO ENVELOPES!!!!</span>
                <span class="comment">// (Sometimes the server HAS to reply with an unencrypted reply,</span>
                <span class="comment">// and this is what makes it possible for the client to RECEIVE</span>
                <span class="comment">// that reply.)</span>
                <span class="comment">//</span>
                <span class="comment">// The Server doesn&#39;t have to accept both types, but the client does,</span>
                <span class="comment">// since technically all clients cannot talk to it without knowing its key first.</span>
                <span class="comment">//</span>
                <span class="comment">// ===&gt; A CLIENT could POTENTIALLY have sent a message to server when unregistered,</span>
                <span class="comment">// leaving server NO WAY to reply! Therefore server HAS to have the OPTION to send</span>
                <span class="comment">// an unencrypted message, in that case, and the client HAS to be able to receive it</span>
                <span class="comment">// properly!!</span>
                <span class="comment">//</span>
                <span class="comment">// ----------------------------------------------------------</span>

                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strRawServerReply.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;MESSAGE&quot;</span>)) <span class="comment">// Server sent this NOT encrypted, in an armored message.</span>
                {
                    bRetrievedReply = ascServerReply.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strServerReply);
                }
                <span class="comment">// ----------------------------------------------------------</span>
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Unknown reply type received from server. (Expected envelope or message.)\n&quot;</span>
                        <span class="stringliteral">&quot;\n\n PERHAPS YOU ARE RUNNING AN OLD VERSION OF THE SERVER ????? \n\n&quot;</span>, szFunc);
                }
                <span class="comment">// **********************************************************************</span>
                <a class="code" href="class_o_t_message.html">OTMessage</a> * pServerReply(<span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>());
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerReply);

                <span class="keywordflow">if</span> (bRetrievedReply &amp;&amp; strServerReply.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; pServerReply-&gt;LoadContractFromString(strServerReply))
                {
                    <span class="comment">// Now the fully-loaded message object (from the server, this time) can be processed by the OT library...</span>
                    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a> -&gt; ProcessServerReply(*pServerReply); <span class="comment">// Client takes ownership and will handle cleanup.</span>
                }
                <span class="keywordflow">else</span>
                {
                    <span class="keywordflow">if</span> (NULL != pServerReply) <span class="keyword">delete</span> pServerReply; pServerReply = NULL;  <span class="comment">// cleanup</span>

                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading server reply from string:\n\n%s\n\n&quot;</span>,
                        szFunc, strRawServerReply.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                }
                <span class="comment">// ----------------------------------------------------------</span>
            } <span class="comment">// !success receiving.</span>
            <span class="comment">// ----------------------------------------------------------</span>
        } <span class="comment">// else (bSuccessSending)</span>
    } <span class="comment">// if envelope exists.</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;

}
</pre></div>
</div>
</div>
<a class="anchor" id="a0bf5890924481ffbf89bc2a6fb529b04"></a><!-- doxytag: member="OT_API::triggerClause" ref="a0bf5890924481ffbf89bc2a6fb529b04" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const int64_t &amp;lTransactionNum, const OTString &amp;strClauseName, const OTString *pStrParam=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a0bf5890924481ffbf89bc2a6fb529b04">OT_API::triggerClause</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strClauseName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pStrParam</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l10243">10243</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::triggerClause&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;triggerClause&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a2374c052c03bf1d4c7e7dd7555197ba4">m_lTransactionNum</a>    = lTransactionNum;
    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strClauseName;

    <span class="comment">// Optional string parameter. Available as &quot;param_string&quot;</span>
    <span class="comment">// inside the script.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((NULL != pStrParam) &amp;&amp; (pStrParam-&gt;<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()))
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(*pStrParam); <span class="comment">// &lt;===</span>

    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
    <span class="keyword">const</span> std::string str_server(strServerID.Get());
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
    NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

    <span class="keywordflow">if</span> (!bNymboxHash)
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                      str_server.c_str());

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aae87777314e8bcd258a117082559b024"></a><!-- doxytag: member="OT_API::usageCredits" ref="aae87777314e8bcd258a117082559b024" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;USER_ID_CHECK, const int64_t lAdjustment=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#aae87777314e8bcd258a117082559b024">OT_API::usageCredits</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID_CHECK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lAdjustment</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l12483">12483</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFuncName = <span class="stringliteral">&quot;OT_API::usageCredits&quot;</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet.</span>
    <span class="comment">//  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, szFuncName); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
    int64_t lRequestNumber = 0;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strNymID2(USER_ID_CHECK);

    <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
    theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

    <span class="comment">// (1) set up member variables</span>
    theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;usageCredits&quot;</span>;
    theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
    theMessage.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>          = strNymID2;
    theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
    theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

    theMessage.<a class="code" href="class_o_t_message.html#a04ef2907cff33f832b438c93f17880b7">m_lDepth</a>             = lAdjustment; <span class="comment">// Default is &quot;no adjustment&quot; (@usageCredits returns current balance regardless.)</span>

    <span class="comment">// (2) Sign the Message</span>
    theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

    <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
    theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="comment">// (Send it)</span>
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
    <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

    <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6db6ca5618edfb53c7a8a7bc38e4bd0e"></a><!-- doxytag: member="OT_API::VerifyAccountReceipt" ref="a6db6ca5618edfb53c7a8a7bc38e4bd0e" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a6db6ca5618edfb53c7a8a7bc38e4bd0e">OT_API::VerifyAccountReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>=== Verify Account Receipt === Returns bool. Verifies any asset account (intermediary files) against its own last signed receipt. Obviously this will fail for any new account that hasn't done any transactions yet, and thus has no receipts.</p>
<p>=== Verify Account Receipt === Returns bool. Verifies any asset account (intermediary files) against its own last signed receipt. Obviously this will fail for any new account that hasn't done any transactions yet (and thus has no receipts.) </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03381">3381</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *<span class="keyword">&gt;</span>(pServer-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>());
    <span class="keywordflow">if</span> (NULL == pServerNym) { <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OT_API::VerifyAccountReceipt: should never happen. pServerNym is NULL.\n&quot;</span>); <span class="keywordflow">return</span> <span class="keyword">false</span>; }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#ae4bcd8edaf9b3cb72b0a68d503af804c">OTTransaction::VerifyBalanceReceipt</a>(*pServerNym,
                                               *pNym,
                                               SERVER_ID,
                                               ACCOUNT_ID);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab941c58200fe040a3d432d54297c9fbe"></a><!-- doxytag: member="OT_API::VerifyAndRetrieveXMLContents" ref="ab941c58200fe040a3d432d54297c9fbe" args="(const OTString &amp;strContract, const OTIdentifier &amp;theSignerNymID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ab941c58200fe040a3d432d54297c9fbe">OT_API::VerifyAndRetrieveXMLContents</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strContract</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify and Retrieve XML Contents. </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03353">3353</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_contract.html">OTContract</a> * pContract = NULL;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccess = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a1ffc5ff556721c5ab9fee696ea922ec1">VerifySignature</a>(strContract, theSignerNymID, &amp;pContract);
    <span class="comment">//</span>
    <span class="comment">// If pContract is not NULL after the above call, then this Cleanup object</span>
    <span class="comment">// will clean it up after we leave the scope of this block.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTContract&gt;</a> theAngel(pContract);
    <span class="comment">// -----------------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();

    <span class="keywordflow">if</span> (NULL != pContract) <span class="comment">// pContract will always exist, if we were successful.</span>
        <span class="keywordflow">return</span> (bSuccess &amp;&amp; pContract-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput));

    <span class="keywordflow">return</span> bSuccess; <span class="comment">// In practice this will only happen on failure. (Could have put &quot;return false&quot;.)</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1ffc5ff556721c5ab9fee696ea922ec1"></a><!-- doxytag: member="OT_API::VerifySignature" ref="a1ffc5ff556721c5ab9fee696ea922ec1" args="(const OTString &amp;strContract, const OTIdentifier &amp;theSignerNymID, OTContract **ppContract=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a1ffc5ff556721c5ab9fee696ea922ec1">OT_API::VerifySignature</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strContract</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_contract.html">OTContract</a> **&#160;</td>
          <td class="paramname"><em>ppContract</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>OT-Verify the signature on a CONTRACT. Returns true/false (success/fail)</p>
<p>OT-Verify the signature on a CONTRACT. Returns true/false (success/fail)</p>
<p>NOTICE that ppContract can be set, EVEN WHEN THIS RETURNS FALSE! Therefore, if you are low-level enough to actually be passing ppContract in here, then you had better check it, after the call, whether it returns success or fail! Either way, that pointer could be set, in which case YOU are responsible to clean it up! Check that pointer for NULL! </p>

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l03270">3270</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(theSignerNymID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!strContract.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OT_API::VerifySignature: Empty contract passed in. (Returning false.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_contract.html">OTContract</a> * pContract = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTContract&gt;</a> theAngel;

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
        pContract = <a class="code" href="class_o_t_contract.html#a3a4b4d7e43a53027a5e170557b9e7e12">OTContract::InstantiateContract</a>(strContract);

    <span class="keywordflow">if</span> (NULL == pContract)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::VerifySignature: I tried my best. Unable to instantiate contract passed in:\n\n%s\n\n&quot;</span>,
                       strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Since we created it ourselves using a factory, we can do this:</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// The caller wants to take the contract for himself, without us cleaning</span>
    <span class="comment">// it up in here.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL != ppContract)
        *ppContract = pContract;
    <span class="comment">// Else, we will clean it up ourselves...</span>
    <span class="keywordflow">else</span>
        theAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pContract);
    <span class="comment">// -----------------------------------------------------</span>
<span class="comment">//  if (false == pContract-&gt;VerifyContractID())</span>
<span class="comment"></span><span class="comment">//  {                                           // Therefore it&#39;s only useful for server contracts and asset contracts. Here we can VerifyID and Signature,</span>
<span class="comment">//                                              // and that&#39;s good enough for here and most other places, generically speaking.</span>
<span class="comment">//      OTLog::vOutput(0, &quot;OT_API::VerifySignature: Unable to verify contract ID for contract passed in. NOTE: If you are experiencing &quot;</span>
<span class="comment">//                     &quot;a problem here, CONTACT FELLOW TRAVELER and let him know WHAT KIND OF CONTRACT, and what symptoms you are seeing, &quot;</span>
<span class="comment">//                     &quot;versus what you were expecting to see. Contract contents:\n\n%s\n\n&quot;,</span>
<span class="comment">//                     strContract.Get());</span>
<span class="comment">//      return false;</span>
<span class="comment">//  }</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pNym))
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strSignerNymID(theSignerNymID);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::VerifySignature: For Nym (%s), unable to verify signature on contract passed in:\n\n%s\n\n&quot;</span>,
                       strSignerNymID.Get(), strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5b14775126eb326cfd49ffb1a7d4db32"></a><!-- doxytag: member="OT_API::Wallet_CanRemoveAccount" ref="a5b14775126eb326cfd49ffb1a7d4db32" args="(const OTIdentifier &amp;ACCOUNT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a5b14775126eb326cfd49ffb1a7d4db32">OT_API::Wallet_CanRemoveAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02050">2050</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (ACCOUNT_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAccountID(ACCOUNT_ID);

    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(ACCOUNT_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Balance must be zero in order to close an account!</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() != 0)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Account balance MUST be zero in order to close an asset account: %s.\n&quot;</span>, __FUNCTION__, strAccountID.Get());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> BOOL_RETURN_VALUE = <span class="keyword">false</span>;

    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theServerID    = pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>();
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theUserID      = pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>();

    <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
    <span class="comment">// but it still might return NULL if various verification fails.</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a478f3f32e383e05a203807810bc94940">LoadInbox</a>(theServerID, theUserID, ACCOUNT_ID);
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aeaf758c15cb39763d3ac80e7582e5409">LoadOutbox</a>(theServerID, theUserID, ACCOUNT_ID);

    <span class="comment">// Make sure it gets cleaned up pInbox this goes out of scope.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox); <span class="comment">// I pass the pointer, in case it&#39;s NULL.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox); <span class="comment">// I pass the pointer, in case it&#39;s NULL.</span>

    <span class="keywordflow">if</span> (NULL == pInbox){
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadInbox.\n Account ID: %s\n&quot;</span>, __FUNCTION__, strAccountID.Get());
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox) {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadOutbox.\n Account ID: %s\n&quot;</span>,__FUNCTION__ , strAccountID.Get());
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &gt; 0) || (pOutbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &gt; 0) ) {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: You cannot remove an asset account if there are inbox/outbox items still waiting to be processed.\n&quot;</span>, __FUNCTION__);
    }
    <span class="keywordflow">else</span> BOOL_RETURN_VALUE = <span class="keyword">true</span>; <span class="comment">// SUCCESS!</span>

    <span class="keywordflow">return</span> BOOL_RETURN_VALUE;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1ca73000987bce8e5e326a43ca46cd69"></a><!-- doxytag: member="OT_API::Wallet_CanRemoveAssetType" ref="a1ca73000987bce8e5e326a43ca46cd69" args="(const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a1ca73000987bce8e5e326a43ca46cd69">OT_API::Wallet_CanRemoveAssetType</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01922">1922</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (ASSET_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strName;
    <span class="comment">// ------------------------------------------</span>
    <span class="keyword">const</span> int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">GetAccountCount</a>();

    <span class="comment">// Loop through all the accounts.</span>
    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> accountID;

        <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(i,accountID,strName);
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(accountID,__FUNCTION__);
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theTYPE_ID(pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>());

        <span class="keywordflow">if</span> (ASSET_ID == theTYPE_ID)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strASSET_ID(ASSET_ID), strTYPE_ID(theTYPE_ID);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove asset contract %s from wallet: Account %s uses it.\n&quot;</span>,
                __FUNCTION__,strASSET_ID.Get(), strTYPE_ID.Get());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f3e914453a7b7ad2a03b6a39f3f0fce"></a><!-- doxytag: member="OT_API::Wallet_CanRemoveNym" ref="a2f3e914453a7b7ad2a03b6a39f3f0fce" args="(const OTIdentifier &amp;NYM_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a2f3e914453a7b7ad2a03b6a39f3f0fce">OT_API::Wallet_CanRemoveNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01964">1964</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>


    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(NYM_ID,__FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// ------------------------------------------</span>
    <span class="comment">// Make sure the Nym doesn&#39;t have any accounts in the wallet.</span>
    <span class="comment">// (Client must close those before calling this.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">GetAccountCount</a>();

    <span class="comment">// Loop through all the accounts.</span>
    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> accountID;
        <a class="code" href="class_o_t_string.html">OTString</a> strName;

        <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(i,accountID,strName);
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(accountID,__FUNCTION__);
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNYM_ID(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());


        <span class="keywordflow">if</span> (theNYM_ID.IsEmpty())
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bug in OT_API_Wallet_CanRemoveNym / OT_API_GetAccountWallet_NymID\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }


        <span class="comment">// Looks like the Nym still has some accounts in this wallet.</span>
        <span class="keywordflow">if</span> (NYM_ID == theNYM_ID)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Nym cannot be removed because there are still accounts in the wallet for that Nym.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// ------------------------------------------</span>
    <span class="comment">// Make sure the Nym isn&#39;t registered at any servers...</span>
    <span class="comment">// (Client must unregister at those servers before calling this function..)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int32_t nServerCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0fad5fe7f5da3cac88b0794c705b1a9b">GetServerCount</a>();

    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nServerCount; i++)
    {
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID;
    <a class="code" href="class_o_t_string.html">OTString</a>        strName;
    <span class="keywordtype">bool</span> bGetServer = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(i, theID, strName);

    <span class="keywordflow">if</span> (bGetServer)
    <span class="keywordflow">if</span> (!theID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(theID);

            <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#af5e9078ab475e6cd9c53e4ad2fae0417">IsRegisteredAtServer</a>(strServerID))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Nym cannot be removed because there are still servers in the wallet that the Nym is registered at.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
    }

    <span class="comment">// ------------------------------------------</span>

    <span class="comment">// TODO:  Make sure Nym doesn&#39;t have any cash in any purses...</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae78c8768a982b6c2fd700f07e2cd6f79"></a><!-- doxytag: member="OT_API::Wallet_CanRemoveServer" ref="ae78c8768a982b6c2fd700f07e2cd6f79" args="(const OTIdentifier &amp;SERVER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#ae78c8768a982b6c2fd700f07e2cd6f79">OT_API::Wallet_CanRemoveServer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01864">1864</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bInitialized)          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="keywordflow">if</span> (SERVER_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strName;
    <span class="comment">// ------------------------------------------</span>
    <span class="keyword">const</span> int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">GetAccountCount</a>();

    <span class="comment">// Loop through all the accounts.</span>
    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> accountID;

        <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(i,accountID,strName);
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(accountID,__FUNCTION__);

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> purportedServerID(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());

        <span class="keywordflow">if</span> (SERVER_ID == purportedServerID) {
            <a class="code" href="class_o_t_string.html">OTString</a> strPurportedServerID(purportedServerID), strSERVER_ID(SERVER_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove server contract %s from wallet, because Account %s uses it.\n&quot;</span>,
                __FUNCTION__, strSERVER_ID.Get(), strPurportedServerID.Get());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// ------------------------------------------</span>
    <span class="keyword">const</span> int32_t nNymCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a267d362ca74da9e01ab8e956da42b386">GetNymCount</a>();

    <span class="comment">// Loop through all the Nyms. (One might be registered on that server.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nNymCount; i++)
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> nymID;
        <span class="keywordtype">bool</span> bGetNym = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(i, nymID, strName);

        <span class="keywordflow">if</span>(bGetNym)
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1124d87febc45eec06c1c9e8a2cc91da">IsNym_RegisteredAtServer</a>(nymID, SERVER_ID))
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strNymID(nymID), strSERVER_ID(SERVER_ID);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove server contract %s from wallet, because Nym %s is registered there. (Delete that first...)\n&quot;</span>,
                __FUNCTION__, strSERVER_ID.Get(), strNymID.Get());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
   }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a90f13aec197a306faca8f87d1dd8d1dd"></a><!-- doxytag: member="OT_API::Wallet_ChangePassphrase" ref="a90f13aec197a306faca8f87d1dd8d1dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a90f13aec197a306faca8f87d1dd8d1dd">OT_API::Wallet_ChangePassphrase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l01523">1523</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">class </span>ot_change_pw
    {
        std::list&lt;OTPseudonym *&gt; * m_plist_nyms; <span class="comment">// We&#39;ll be responsible in this class for cleaning these up.</span>

    <span class="keyword">public</span>:
        ot_change_pw(std::list&lt;OTPseudonym *&gt; &amp; list_nyms) : m_plist_nyms(&amp;list_nyms) { }
        ~ot_change_pw()
        {
            <span class="keywordflow">if</span> (NULL != m_plist_nyms)
            {
                <span class="keywordflow">while</span> (m_plist_nyms-&gt;size() &gt; 0) <span class="comment">// Here&#39;s the cleanup.</span>
                {
                    std::list&lt;OTPseudonym *&gt;::iterator it = m_plist_nyms-&gt;begin();
                    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = *it;
                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);

                    <span class="keyword">delete</span> pNym; pNym = NULL;
                    m_plist_nyms-&gt;erase(it);
                }
            }
        }
    };
    <span class="comment">// -----------------------------------------------------</span>
    std::list&lt;OTPseudonym *&gt; list_nyms;  <span class="comment">// Any Nyms on this list will be cleaned up automatically in the ot_change_pw destructor. Thus</span>
    ot_change_pw the_cleanup(list_nyms); <span class="comment">// we cannot add Nyms here that are also on the Wallet. We load our own copies just for this list.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bAtLeastOneNymHasCredentials = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bSuccessLoading              = <span class="keyword">true</span>; <span class="comment">// defaults to true in case there aren&#39;t any Nyms.</span>

    <span class="comment">// Loop through all the private Nyms and get them all loaded up into a list.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int32_t nNymCount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad98f3386c700710d76e44580c59c505a">GetNymCount</a>();
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">for</span> (int32_t iii = 0; iii &lt; nNymCount; ++iii)
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYM_ID;
        <a class="code" href="class_o_t_string.html">OTString</a>     NYM_NAME;

        <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a146e2339010f1e6b8b9cba252c8d3213">GetNym</a>(iii, NYM_ID, NYM_NAME);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(bGotNym);
        <span class="comment">// ----------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);

        <span class="comment">// otherwise it&#39;s a public Nym, so we just skip it.</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_pseudonym.html#a9dd185e1a1c2e263e4a2978aefed21c2">OTPseudonym::DoesCertfileExist</a>(strNymID)) <span class="comment">// is there a private key or credential available for this Nym?</span>
        {   <span class="comment">// In here, we know there&#39;s a private key...</span>

            <span class="comment">// CALLER responsible to delete!</span>
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a38f96bbf12655ca9ced0ebf33a5c3794">LoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span> <span class="comment">/*bChecking*/</span>,  __FUNCTION__); <span class="comment">// This also loads credentials, if there are any.</span>

            <span class="comment">// We use LoadPrivateNym here instead. (meaning: need to clean them up.)</span>
            <span class="comment">// Therefore use a nested class here to handle the cleanup.</span>
            <span class="comment">// This way we aren&#39;t changing the actual Nyms in the wallet until it&#39;s re-loaded.</span>
            <span class="comment">// Any failure between now and then, and it&#39;s not re-loaded, and none of the Nyms</span>
            <span class="comment">// were ever changed!</span>

            <span class="keywordflow">if</span> (NULL == pNym) <span class="comment">// Since we KNOW there&#39;s a private key, yet it failed, therefore the user must have entered the wrong password...</span>
            {
                bSuccessLoading = <span class="keyword">false</span>;
                <span class="keywordflow">break</span>;
            }
            <span class="comment">// else... (add to list for cleanup, on exit from this function.)</span>
            list_nyms.push_back(pNym); <span class="comment">// ONLY private Nyms, and they ALL must successfully load and verify.</span>

            <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a6ae670b44bc6728da06141c885e6c7e9">GetMasterCredentialCount</a>() &gt; 0)
                bAtLeastOneNymHasCredentials = <span class="keyword">true</span>;
        }
    }
    <span class="comment">// ----------------------</span>
    <span class="keywordflow">if</span> (!bSuccessLoading)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed to load all the private Nyms. Wrong passphrase? (Aborting operation.)\n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// By this point we KNOW we have successfully loaded up ALL the private Nyms</span>
    <span class="comment">// for this wallet, and that list_nyms contains a pointer to each one...</span>
    <span class="comment">// ---------------------------------------------------------------------------</span>
    <span class="comment">// ENCRYPT ALL CREDENTIALS FROM MASTER KEY INTO A TEMP KEY</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a>     theTempPassword; <span class="comment">// Used to store a temp password only. Only for credentialed nyms.</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<span class="stringliteral">&quot;Enter existing wallet master passphrase.&quot;</span>);

    <span class="comment">// At this point, for Nyms with credentials, we need to ReEncrypt the Nym&#39;s credentials,</span>
    <span class="comment">// similar to importing or exporting the Nym from the wallet. Except this time, we have</span>
    <span class="comment">// to ReEncrypt FROM a wallet-based Nym to a temporary passphrase, then destroy and re-</span>
    <span class="comment">// create the wallet&#39;s cached master key, then ReEncrypt AGAIN from the temporary passphrase</span>
    <span class="comment">// and back to the new master passphrase that was just generated.</span>
    <span class="comment">// Makes sense? It&#39;s the easiest way to do it based on the existing code we have.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bAtLeastOneNymHasCredentials) <span class="comment">// All the Nyms on our list are private, by this point. And within this block, they have credentials, too.</span>
    {
        theTempPassword.<a class="code" href="class_o_t_password.html#a0e4664e731c30f8a7a8f83a2e20f907f">randomizePassword</a>(12); <span class="comment">// the new random PW will be 12 bytes int64_t. (We discard it after this function is done.)</span>
        <span class="keywordtype">bool</span> bSuccessReEncrypting = <span class="keyword">true</span>;
        <span class="comment">// ------------------------</span>
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(std::list&lt;OTPseudonym *&gt;, list_nyms)
        {
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = *it;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
            <span class="comment">// ------------------------</span>
            <span class="comment">// We know at least one Nym has credentials. Does this one?</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a6ae670b44bc6728da06141c885e6c7e9">GetMasterCredentialCount</a>() &gt; 0) <span class="comment">// If this specific Nym has credentials...</span>
            {
                <span class="comment">// It won&#39;t ask for a passphrase when using the temp password, since it already</span>
                <span class="comment">// has the password. So it will only ask for a passphrase when it is NOT using</span>
                <span class="comment">// the temp password, e.g. when using the wallet&#39;s cached master key. ABOVE (here)</span>
                <span class="comment">// that will be the OLD master key, and BELOW (after the master key is re-created)</span>
                <span class="comment">// that will be the NEW master key.</span>
                <span class="comment">// That&#39;s why here, it says: &quot;Enter your EXISTING wallet master passphrase.&quot;</span>
                <span class="comment">//</span>
                <span class="keyword">const</span> <span class="keywordtype">bool</span> bExported = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adf52e65c9002374a7298f17d97be5b57">ReEncryptPrivateCredentials</a>(<span class="keyword">false</span><span class="comment">/* (EXPORTING) bImporting=FALSE */</span>,
                                                                         &amp;thePWData, &amp;theTempPassword);
                <span class="keywordflow">if</span> (!bExported)
                {
                    bSuccessReEncrypting = <span class="keyword">false</span>; <span class="comment">// At least this way if there&#39;s a failure, it&#39;s equally to all the Nyms, and not halfway through.</span>
                }
            }
        } <span class="comment">//FOR_EACH</span>
        <span class="comment">// ------------------------</span>
        <span class="keywordflow">if</span> (!bSuccessReEncrypting) <span class="comment">// FAILURE</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to re-encrypt Nym&#39;s private credentials.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Nyms are cleaned up automatically when we return.</span>
        }
        <span class="comment">// ------------------------</span>
    }
    <span class="comment">// By this point, if there were credentials on any of the Nyms, they are all now converted</span>
    <span class="comment">// (in RAM, not in local storage) to the temp password, and OUT of the wallet&#39;s master key</span>
    <span class="comment">// (which we&#39;re about to destroy and re-create.)</span>
    <span class="comment">// ****************************************************************************</span>
    <span class="comment">// Destroy the wallet&#39;s cached master key (in Ram, not on disk--yet.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascBackup;
    <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;SerializeTo(ascBackup);  <span class="comment">// Just in case!</span>
    <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;ResetMasterPassword();   <span class="comment">// Which will force it to be re-created next time someone tries to use it...</span>

    <span class="comment">// NOTE: Below this point we cannot return without setting the master passphrase BACK.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// GENERATE the wallet&#39;s NEW MASTER KEY.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a>  strReason(<span class="stringliteral">&quot;Choose a new passphrase: &quot;</span>);

    <span class="comment">// This step would be unnecessary if we knew for a fact that at least</span>
    <span class="comment">// one Nym exists. But in the off-chance that there ARE NO NYMS in the</span>
    <span class="comment">// wallet, we need to have this here, in order to MAKE SURE that the new</span>
    <span class="comment">// master key is generated. Otherwise it would never end up actually having</span>
    <span class="comment">// to generate the thing. (Since, if there are no Nyms to re-save, it would</span>
    <span class="comment">// never need to actually retrieve the master key, which is what triggers it</span>
    <span class="comment">// to generate if it&#39;s not already there.) So we just force that step here,</span>
    <span class="comment">// to make sure it happens, even if there are no Nyms to save below this point.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> temp_password;
    _SharedPtr&lt;OTCachedKey&gt; sharedPtr(<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>());
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bRegenerate = sharedPtr-&gt;GetMasterPassword(sharedPtr, temp_password, strReason.Get(),
                                                          <span class="keyword">true</span>); <span class="comment">//bVerifyTwice=false by default.</span>
    <span class="comment">// ----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bRegenerate) <span class="comment">// Failure generating new master key.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed while trying to regenerate master key, in call: &quot;</span>
                      <span class="stringliteral">&quot;OTCachedKey::It()-&gt;GetMasterPassword. (Setting it back to the old one.)\n&quot;</span>, __FUNCTION__);
        <span class="comment">// ------------------------</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;SerializeFrom(ascBackup))
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed while trying to restore master key, in call: &quot;</span>
                          <span class="stringliteral">&quot;OTCachedKey::It()-&gt;GetMasterPassword. (While setting it back to the old one.)\n&quot;</span>
                          <span class="stringliteral">&quot;Original value: \n%s\n&quot;</span>, __FUNCTION__, ascBackup.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// todo security: is it risky to have the key displayed in this log?</span>
        <span class="comment">// ------------------------</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="comment">//</span>
        <span class="comment">// NOTE: Since we loaded our own copies of the Nyms, we haven&#39;t changed the copies in the wallet,</span>
        <span class="comment">// nor the wallet itself. So we can just return, since our copies of the Nyms will already be cleaned</span>
        <span class="comment">// up automatically.</span>
    }
    <span class="comment">// ----------------------------------------------------</span>
    <span class="keywordflow">else</span><span class="comment">// SUCCESS creating new master key, so let&#39;s CONVERT AND RE-SAVE ALL</span>
    {   <span class="comment">// THE NYMS, so they&#39;ll be using it from now on...</span>

        <span class="comment">// (Master key would normally be generated here, if we hadn&#39;t already forced it above,</span>
        <span class="comment">// but we did that to make sure it got re-created in the event there are zero nyms.)</span>

        <span class="comment">// Todo: save them to temp files and only copy over if everything</span>
        <span class="comment">// else is successful. Same with wallet. Also make backups.</span>
        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bSuccessResaving = <span class="keyword">true</span>; <span class="comment">// in case the list is empty, we assume success here.</span>

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(std::list&lt;OTPseudonym *&gt;, list_nyms) <span class="comment">// Let&#39;s save all these Nyms under the new master key.</span>
        {
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = *it;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
            <span class="comment">// ------------------------</span>
            <span class="keywordtype">bool</span> bSaved = <span class="keyword">false</span>;

            <span class="comment">// CREDENTIALS</span>
            <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a6ae670b44bc6728da06141c885e6c7e9">GetMasterCredentialCount</a>() &gt; 0) <span class="comment">// Nym has credentials.</span>
            {
                <span class="comment">// We had converted the Nyms to a temp key above, so now we need to convert</span>
                <span class="comment">// from the temp key to the new wallet key. Then we can save them and re-load</span>
                <span class="comment">// the wallet.</span>
                <span class="comment">//</span>
                <span class="comment">// We&#39;re supplying the temp password (from above), and importing the Nyms back</span>
                <span class="comment">// from that, back into to the wallet&#39;s new master key. So it will only ask</span>
                <span class="comment">// for a passphrase for the wallet, since the other passphrase is already provided.</span>
                <span class="comment">// Therefore thePWData is relevant to the wallet only.</span>
                <span class="comment">//</span>
                <span class="keywordtype">bool</span>  bSavedCredentials = <span class="keyword">false</span>;
                <span class="keyword">const</span>
                <span class="keywordtype">bool</span>  bImported = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adf52e65c9002374a7298f17d97be5b57">ReEncryptPrivateCredentials</a>(<span class="keyword">true</span><span class="comment">/*bImporting*/</span>,  <span class="comment">// &lt;==== CONVERT FROM TEMP PW TO NEW MASTER KEY.</span>
                                                                    &amp;thePWData, &amp;theTempPassword);
                <span class="comment">// --------------------------------------</span>
                <span class="keywordflow">if</span> (bImported) <span class="comment">// Success? Okay, let&#39;s Save those credentials we just imported, to local storage.</span>
                {
                    bSavedCredentials = <span class="keyword">true</span>;
                    <span class="comment">// --------------------------------------</span>
                    <a class="code" href="class_o_t_string.html">OTString</a>     strNymID, strCredList, strOutput;
                    <a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a> mapCredFiles;

                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strNymID);
                    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a508533f6ccb558e21bc205d3463a1aa5">GetPrivateCredentials</a>(strCredList, &amp;mapCredFiles);
                    <span class="comment">// --------------------------------------</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
                    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s.cred&quot;</span>, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="comment">// --------------------------------------</span>
                    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascArmor(strCredList);
                    <span class="keywordflow">if</span> (ascArmor.Exists() &amp;&amp;
                        ascArmor.WriteArmoredString(strOutput, <span class="stringliteral">&quot;CREDENTIAL LIST&quot;</span>) &amp;&amp; <span class="comment">// bEscaped=false by default.</span>
                        strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    {
                        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_folders.html#a4e94eac1e796da34baf00556042202f0">OTFolders::Credential</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
                        {
                            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: After converting credentials to new master key, failure trying to store private &quot;</span>
                                          <span class="stringliteral">&quot;credential list for Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                            bSavedCredentials = <span class="keyword">false</span>;
                        }
                    }
                    <span class="comment">// ----------------------------------------------------</span>
                    <span class="comment">// Here we do the actual credentials.</span>
                    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a>, mapCredFiles)
                    {
                        std::string str_cred_id  = (*it).first;
                        <a class="code" href="class_o_t_string.html">OTString</a>    strCredential((*it).second);
                        <span class="comment">// ------------------------</span>
                        strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
                        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascLoopArmor(strCredential);
                        <span class="keywordflow">if</span> (ascLoopArmor.Exists() &amp;&amp;
                            ascLoopArmor.WriteArmoredString(strOutput, <span class="stringliteral">&quot;CREDENTIAL&quot;</span>) &amp;&amp; <span class="comment">// bEscaped=false by default.</span>
                            strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                        {
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_folders.html#a4e94eac1e796da34baf00556042202f0">OTFolders::Credential</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), str_cred_id))
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: After converting credentials to new master key, failure trying to store private &quot;</span>
                                              <span class="stringliteral">&quot;credential for Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                bSavedCredentials = <span class="keyword">false</span>;
                            }
                        }
                        <span class="comment">// -------------------------</span>
                    } <span class="comment">// FOR_EACH</span>
                    <span class="comment">// ----------------------------------------------------</span>
                }
                <span class="comment">// ------------------------------------------</span>
                bSaved = bImported &amp;&amp; bSavedCredentials;
            } <span class="comment">// If Nym has credentials. (Convert and save them, in the above block.)</span>
            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">else</span> <span class="comment">// Old-school: the old nyms (from before credentials code) merely need to have their cert saved (here), which process will automatically use the current (new) master key to encrypt the private portion of that cert when saving. So it gets converted and saved all in this one call. For new-style Nyms (with credentials) see the above block instead.</span>
                <span class="comment">//</span>
                bSaved = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a395ce52dec4e07f04fb66521897c9cf2">Savex509CertAndPrivateKey</a>(<span class="keyword">true</span>, &amp;strReason);
            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">if</span> (!bSaved) bSuccessResaving = <span class="keyword">false</span>;
        } <span class="comment">// FOR_EACH (list_nyms)</span>
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">if</span> (!bSuccessResaving) <span class="comment">// Failed saving all the Nyms after switching their credentials over.</span>
        {
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascBackup2;
            <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;SerializeTo(ascBackup2);  <span class="comment">// Just in case!</span>
            <span class="comment">// ------------------------</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Failed re-saving Nym (into new Master Key.) It&#39;s possible &quot;</span>
                          <span class="stringliteral">&quot;some Nyms are already saved on the new key, while others are still stuck &quot;</span>
                          <span class="stringliteral">&quot;on the old key!! Therefore, asserting now. OLD KEY was:\n%s\n\n NEW KEY is: %s\n&quot;</span>,
                          __FUNCTION__, ascBackup.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), ascBackup2.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// Todo: security: keys are exposed here. Is this log safe?</span>
            <span class="comment">// ------------------------</span>
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT while trying to change wallet&#39;s master key and passphrase.\n&quot;</span>);
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="keywordflow">else</span><span class="comment">// SAVE THE WALLET.</span>
        {
            <span class="comment">// By this point, we have successfully converted all the Nyms (our local copies of the wallet&#39;s private nyms)</span>
            <span class="comment">// to the new master key, AND we have successfully saved those Nyms to local storage. Now, if we just save and</span>
            <span class="comment">// re-load the wallet itself, it should load up using the new master key, and it should load up its own copies</span>
            <span class="comment">// of those same Nyms again, using that new master key to decrypt them. (Those new copies of those Nyms being</span>
            <span class="comment">// the ones that we saved to local storage just above, using our local copies.)</span>
            <span class="comment">//</span>
            <span class="comment">// With the wallet updated thus, we can simply discard the local copies, which will have outlived their usefulness.</span>
            <span class="comment">// They will already be destroyed on exit, automatically.</span>
            <span class="comment">//</span>
            <span class="keywordtype">bool</span>  bLoaded = <span class="keyword">false</span>;
            <span class="keyword">const</span>
            <span class="keywordtype">bool</span>  bSaved  = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();
            <span class="comment">// ------------------------</span>
            <span class="keywordflow">if</span> (bSaved) <span class="comment">// Next, re-load it so the Nyms we&#39;ve changed will be loaded up in their new forms. (The nyms local to this function will be destroyed on exit, but they are separate from the nyms in the wallet, which will appear in their new forms upon loading, presuming the Nyms were successfully saved above.)</span>
                <span class="comment">//</span>
                bLoaded = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a2932e7c8d6b5d7764707e653a3c2f216">LoadWallet</a>();
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed saving wallet \n&quot;</span>, __FUNCTION__);
            <span class="comment">// ------------------------</span>
            <span class="keywordflow">if</span> (!bLoaded)
            {
                <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascBackup2;
                <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;SerializeTo(ascBackup2);  <span class="comment">// Just in case!</span>
                <span class="comment">// ------------------------</span>
                <span class="comment">// Note: if we even got this far, that means we already saved the Nyms under the new master Key,</span>
                <span class="comment">// to local storage. Therefore we NEED that new key, if it wasn&#39;t properly saved in the wallet file</span>
                <span class="comment">// just now! (And we need to have made a real backup of the wallet before attempting this...todo.)</span>
                <span class="comment">// In the meantime, the best thing we can do is just LOG that key here, and hope the server operator</span>
                <span class="comment">// still has the log! Log both keys (new and old.)</span>
                <span class="comment">// ------------------------</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Failed saving or re-loading Wallet (with new Master Key.) &quot;</span>
                              <span class="stringliteral">&quot;Asserting now. OLD KEY was:\n%s\n\n NEW KEY is: %s\n&quot;</span>,
                              __FUNCTION__, ascBackup.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), ascBackup2.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// Todo: security: keys are exposed here. Is this log safe?</span>
                <span class="comment">// ------------------------</span>
                <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT while trying to save and re-load wallet with new master key and passphrase.\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\nSuccess changing master passphrase for wallet!\n&quot;</span>);
            <span class="comment">// ------------------------</span>
            <span class="keywordflow">return</span> bLoaded;
        }
        <span class="comment">// -----------------------------------------------------</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afebfabab4241d6aa75ce0e178e248592"></a><!-- doxytag: member="OT_API::Wallet_ExportCert" ref="afebfabab4241d6aa75ce0e178e248592" args="(const OTIdentifier &amp;NYM_ID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#afebfabab4241d6aa75ce0e178e248592">OT_API::Wallet_ExportCert</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02807">2807</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataLoad(<span class="stringliteral">&quot;Need Wallet Master passphrase to export any Cert.&quot;</span>);
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataSave(<span class="stringliteral">&quot;Create new passphrase for exported Cert.&quot;</span>);
    <a class="code" href="class_o_t_string.html">OTString</a> strReasonToSave(thePWDataSave.GetDisplayString());
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWDataLoad); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Pause the master key before exporting, since we want to save this Nym</span>
    <span class="comment">// WITHOUT the master key, which it will no longer have, outside of this</span>
    <span class="comment">// wallet.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!(<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused()))
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Pause();
    }
    <span class="comment">// ----------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strCertfile;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSavedCert  = pNym-&gt;Savex509CertAndPrivateKeyToString(strCertfile, &amp;strReasonToSave);
    <span class="comment">// ----------------------</span>
    <span class="comment">// Unpause the master key.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused())
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Unpause();
    }
    <span class="comment">// ----------------------</span>
    <span class="keywordflow">if</span> (!bSavedCert)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling pNym-&gt;Savex509CertAndPrivateKeyToString(strCertfile, \&quot;%s\&quot;)\n&quot;</span>,
                      __FUNCTION__, thePWDataSave.GetDisplayString());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------</span>
    <span class="keywordflow">if</span> (strCertfile.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s&quot;</span>, strCertfile.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// -----------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abe3cee60ee8f3d8e3660067d481b2dcc"></a><!-- doxytag: member="OT_API::Wallet_ExportNym" ref="abe3cee60ee8f3d8e3660067d481b2dcc" args="(const OTIdentifier &amp;NYM_ID, OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#abe3cee60ee8f3d8e3660067d481b2dcc">OT_API::Wallet_ExportNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02235">2235</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NYM_ID is empty!&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataLoad(<span class="stringliteral">&quot;Enter wallet master passphrase.&quot;</span>);
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataSave(<span class="stringliteral">&quot;Create new passphrase for exported Nym.&quot;</span>);
    <a class="code" href="class_o_t_string.html">OTString</a> strReasonToSave(thePWDataSave.GetDisplayString());
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWDataLoad); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    std::string  str_nym_name(pNym-&gt;GetNymName().Get());
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strID; pNym-&gt;GetIdentifier(strID);
    std::string  str_nym_id(strID.Get());
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Below this point I can use:</span>
    <span class="comment">//</span>
    <span class="comment">// pNym, str_nym_name, and str_nym_id.</span>
    <span class="comment">//</span>
    <span class="comment">// I still need the certfile and the nymfile (both in string form.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bHasCredentials = (pNym-&gt;GetMasterCredentialCount() &gt; 0);

    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCredentials, ascCredList;
    <a class="code" href="class_o_t_string.html">OTString</a>     strCertfile;
    <span class="keywordtype">bool</span>         bSavedCert = <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bHasCredentials)
    {
        <span class="comment">// *****************************************************************</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused())
        {
            <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Pause();
        }
        <span class="comment">// -----------------------------------</span>
        bSavedCert = pNym-&gt;Savex509CertAndPrivateKeyToString(strCertfile, &amp;strReasonToSave);
        <span class="comment">// -----------------------------------</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused())
        {
            <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Unpause();
        }
        <span class="comment">// *****************************************************************</span>
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">else</span>
    {
        <span class="comment">// We don&#39;t have to pause OTCachedKey here like we did above, because</span>
        <span class="comment">// this already has built-in mechanisms to go around OTCachedKey.</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bReEncrypted = pNym-&gt;ReEncryptPrivateCredentials(<span class="keyword">false</span><span class="comment">/*bImporting*/</span>, &amp;thePWDataSave); <span class="comment">// Handles OTCachedKey already.</span>
        <span class="comment">// -----------------------------</span>
        <span class="keywordflow">if</span> (bReEncrypted)
        {
            <span class="comment">// -----------------------------</span>
            <span class="comment">// Create a new OTDB::StringMap object.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a> * pStorable = NULL;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTDB::Storable&gt;</a> theAngel;
            <a class="code" href="class_o_t_d_b_1_1_string_map.html">OTDB::StringMap</a> * pMap = NULL;
            <span class="comment">// --------------------------------------------------------------</span>
            pStorable = <a class="code" href="namespace_o_t_d_b.html#a67b35ca5812604fb3e1eae2b659f66ee">OTDB::CreateObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82acc03e85e0f615881a2abe9ca12628330">OTDB::STORED_OBJ_STRING_MAP</a>); <span class="comment">// this asserts already, on failure.</span>
            theAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pStorable); <span class="comment">// It will definitely be cleaned up.</span>
            pMap = (NULL == pStorable) ? NULL : dynamic_cast&lt;OTDB::StringMap *&gt;(pStorable);
            <span class="comment">// --------------------------------------------------------------</span>
            <span class="keywordflow">if</span> (NULL == pMap)
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: failed trying to load or create a STORED_OBJ_STRING_MAP.\n&quot;</span>,
                              __FUNCTION__);
            <span class="keywordflow">else</span> <span class="comment">// It instantiated.</span>
            {    <span class="comment">// -----------------------------------------------</span>
                <a class="code" href="class_o_t_string.html">OTString</a>       strCredList;
                <a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a> &amp; theMap = pMap-&gt;<a class="code" href="class_o_t_d_b_1_1_string_map.html#a460f2e551430c65fef4130576985a0ce">the_map</a>;

                pNym-&gt;GetPrivateCredentials(strCredList, &amp;theMap);
                <span class="comment">// -----------------------------------------------</span>
                <span class="comment">// Serialize the StringMap to a string...</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (strCredList.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; (theMap.size() &gt; 0)) <span class="comment">// Won&#39;t bother if there are zero credentials somehow.</span>
                {
                    std::string str_Encoded     = <a class="code" href="namespace_o_t_d_b.html#a3c8a8d4af889b2aa3458aac4365aa784">OTDB::EncodeObject</a>(*pMap);
                    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccessEncoding = (str_Encoded.size() &gt; 0);
                    <span class="keywordflow">if</span> (bSuccessEncoding)
                    {
                        ascCredList.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strCredList);   <span class="comment">// &lt;========== Success</span>
                        ascCredentials.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(str_Encoded.c_str());  <span class="comment">// Payload contains credentials list, payload2 contains actual credentials.</span>
                        bSavedCert = <span class="keyword">true</span>;
                    }
                }
            }
        } <span class="comment">// bReEncrypted.</span>
        <span class="comment">// -----------------------------</span>
    } <span class="comment">// bHasCredentials==true</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bSavedCert)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while saving Nym&#39;s private cert, or private credentials, to string.\n&quot;</span>
                      <span class="stringliteral">&quot;Reason I was doing this: \&quot;%s\&quot;\n&quot;</span>, __FUNCTION__, thePWDataSave.GetDisplayString());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strNymfile;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSavedNym = pNym-&gt;SavePseudonym(strNymfile);

    <span class="keywordflow">if</span> (!bSavedNym)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling pNym-&gt;SavePseudonym(strNymfile) (to string)\n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------</span>
    <span class="comment">// Create an OTDB::StringMap object.</span>
    <span class="comment">//</span>
    <span class="comment">// Set the name, id, [certfile|credlist credentials], and nymfile onto it.  (Our exported</span>
    <span class="comment">// Nym appears as an ASCII-armored text to the naked eye, but when loaded up in code it</span>
    <span class="comment">// appears as a map of strings: name, id, [certfile|credlist credentials], and nymfile.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a> * pStorable = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTDB::Storable&gt;</a> theAngel;
    <a class="code" href="class_o_t_d_b_1_1_string_map.html">OTDB::StringMap</a> * pMap = NULL;
    <span class="comment">// --------------------------------------------------------------</span>
    pStorable = <a class="code" href="namespace_o_t_d_b.html#a67b35ca5812604fb3e1eae2b659f66ee">OTDB::CreateObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82acc03e85e0f615881a2abe9ca12628330">OTDB::STORED_OBJ_STRING_MAP</a>); <span class="comment">// this asserts already, on failure.</span>
    theAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pStorable); <span class="comment">// It will definitely be cleaned up.</span>
    pMap = (NULL == pStorable) ? NULL : dynamic_cast&lt;OTDB::StringMap *&gt;(pStorable);
    <span class="comment">// --------------------------------------------------------------</span>
    <span class="comment">// It exists.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL == pMap)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: failed trying to load or create a STORED_OBJ_STRING_MAP.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------</span>
    <a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a> &amp; theMap = pMap-&gt;<a class="code" href="class_o_t_d_b_1_1_string_map.html#a460f2e551430c65fef4130576985a0ce">the_map</a>;
    <span class="comment">// -----------------------------------------------</span>
    theMap[<span class="stringliteral">&quot;id&quot;</span>]       = str_nym_id;
    theMap[<span class="stringliteral">&quot;name&quot;</span>]     = str_nym_name;
    theMap[<span class="stringliteral">&quot;nymfile&quot;</span>]  = strNymfile.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keywordflow">if</span> (strCertfile.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        theMap[<span class="stringliteral">&quot;certfile&quot;</span>] = strCertfile.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keywordflow">if</span> (ascCredList.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        theMap[<span class="stringliteral">&quot;credlist&quot;</span>] = ascCredList.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keywordflow">if</span> (ascCredentials.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        theMap[<span class="stringliteral">&quot;credentials&quot;</span>] = ascCredentials.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
        <span class="comment">// -----------------------------------------------</span>
    <span class="comment">// Serialize the StringMap to a string...</span>
    <span class="comment">//</span>
    std::string str_Encoded = <a class="code" href="namespace_o_t_d_b.html#a3c8a8d4af889b2aa3458aac4365aa784">OTDB::EncodeObject</a>(*pMap);
    <span class="keywordtype">bool</span> bReturnVal   = (str_Encoded.size() &gt; 0);

    <span class="keywordflow">if</span> (bReturnVal)
    {
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp;
        ascTemp.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(str_Encoded.c_str());
        strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
        bReturnVal = ascTemp.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strOutput,
                                                <span class="stringliteral">&quot;EXPORTED NYM&quot;</span> <span class="comment">// -----BEGIN OT EXPORTED NYM-----</span>
                                                ); <span class="comment">// (bool bEscaped=false by default.)</span>
    }

    <span class="keywordflow">return</span> bReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a52464281f46358635dde59e3b787354e"></a><!-- doxytag: member="OT_API::Wallet_ImportCert" ref="a52464281f46358635dde59e3b787354e" args="(const OTString &amp;DISPLAY_NAME, const OTString &amp;FILE_CONTENTS, OTIdentifier *pNymID=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a52464281f46358635dde59e3b787354e">OT_API::Wallet_ImportCert</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>DISPLAY_NAME</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>FILE_CONTENTS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pNymID</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02720">2720</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// Do various verifications on the values to make sure there&#39;s no funny business.</span>
    <span class="comment">//</span>
    <span class="comment">// If Nym with this ID is ALREADY in the wallet, set pNymID and return false.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Create a new Nym object.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <span class="keyword">new</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPseudonym&gt;</a> theAngel(*pNym); <span class="comment">// will be cleaned up automatically.</span>

    <span class="keywordflow">if</span> (DISPLAY_NAME.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
       pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acf835189df80fda4eedc88d4cccdc5f1">SetNymName</a>(DISPLAY_NAME);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Pause the master key, since this Nym is coming from outside</span>
    <span class="comment">// the wallet.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!(<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused()))
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Pause();
    }
    <span class="comment">// ----------------------</span>
    <span class="comment">// Set the public and private keys on the new Nym object based on the</span>
    <span class="comment">// certfile from the StringMap.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>  thePWData(<span class="stringliteral">&quot;To import this Cert, what is its passphrase? &quot;</span>);
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bIfNymLoadKeys = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aa7e06445fd850c8a13cabf2283ca4f01">Loadx509CertAndPrivateKeyFromString</a>(FILE_CONTENTS, &amp;thePWData);
    <span class="comment">// ----------------------</span>
    <span class="comment">// Unpause the master key. (This may go above the add to wallet, or it may stay here, with the &quot;convert to master key&quot; below.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused())
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Unpause();
    }
    <span class="comment">// ----------------------</span>
    <span class="keywordflow">if</span> (bIfNymLoadKeys &amp;&amp; pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ac6c809c283846f8a7a3338a37998ba88">SetIdentifierByPubkey</a>())
    {
        <span class="keywordflow">if</span> (NULL != pNymID)
            *pNymID = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a8167f1e2d532ab18227c5c170922c611">GetConstID</a>();
        <span class="comment">// -----------------------------------------------------</span>
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pTempNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a8167f1e2d532ab18227c5c170922c611">GetConstID</a>(), <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>

        <span class="keywordflow">if</span> (NULL != pTempNym) <span class="comment">// already there.</span>
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a8167f1e2d532ab18227c5c170922c611">GetConstID</a>());
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Tried to import the Cert for a Nym that&#39;s already in wallet: %s\n&quot;</span>,
                           __FUNCTION__, strNymID.Get());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// If success: Add to Wallet including name.</span>
        <span class="comment">//</span>
        pWallet-&gt;<a class="code" href="class_o_t_wallet.html#acb570de733658a4ad24756dde0f22a34">AddNym</a>(*pNym); <span class="comment">// Insert to wallet&#39;s list of Nyms.</span>
        theAngel.SetCleanupTargetPointer(NULL); <span class="comment">// In this case, no need to cleanup, so we set this back to NULL.</span>

        <span class="keyword">const</span> <span class="keywordtype">bool</span> bConverted = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a59daeb8ce8f92530c5ddb4fcd1dde7d4">ConvertNymToCachedKey</a>(*pNym);

        <span class="keywordflow">if</span> (!bConverted)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling pWallet-&gt;ConvertNymToCachedKey(*pNym)\n&quot;</span>, __FUNCTION__);
        }
        <span class="keywordflow">else</span>
        {
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pNym);
            pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();  <span class="comment">// the conversion process adds values to the wallet, so we must save it after.</span>
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading or verifying key from cert string.\n&quot;</span>, __FUNCTION__);
    <span class="comment">// ----------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a77a64ebe7b8942ae50ed25c31834eb7c"></a><!-- doxytag: member="OT_API::Wallet_ImportNym" ref="a77a64ebe7b8942ae50ed25c31834eb7c" args="(const OTString &amp;FILE_CONTENTS, OTIdentifier *pNymID=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a77a64ebe7b8942ae50ed25c31834eb7c">OT_API::Wallet_ImportNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>FILE_CONTENTS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pNymID</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02411">2411</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
    <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascArmor;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadedArmor = <a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">OTASCIIArmor::LoadFromString</a>(ascArmor, FILE_CONTENTS); <span class="comment">// str_bookend=&quot;-----BEGIN&quot; by default</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bLoadedArmor || !ascArmor.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading string into OTASCIIArmor object:\n\n%s\n\n&quot;</span>,
                      __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a>  * pStorable = <a class="code" href="namespace_o_t_d_b.html#a3c1cc3076ede1a1b6d78d1fea7de8cea">OTDB::DecodeObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82acc03e85e0f615881a2abe9ca12628330">OTDB::STORED_OBJ_STRING_MAP</a>, ascArmor.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTDB::Storable&gt;</a> theStorableAngel(pStorable); <span class="comment">// It will definitely be cleaned up.</span>
    <a class="code" href="class_o_t_d_b_1_1_string_map.html">OTDB::StringMap</a> * pMap = (NULL == pStorable) ? NULL : dynamic_cast&lt;OTDB::StringMap *&gt;(pStorable);

    <span class="keywordflow">if</span> (NULL == pMap)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed decoding StringMap object while trying to import Nym:\n%s\n&quot;</span>,
                       __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------</span>
    std::map&lt;std::string, std::string&gt; &amp; theMap = pMap-&gt;<a class="code" href="class_o_t_d_b_1_1_string_map.html#a460f2e551430c65fef4130576985a0ce">the_map</a>;
    <span class="comment">// ---------------------------------------------------</span>
    <span class="comment">// By this point, there was definitely a StringMap encoded in the FILE_CONTENTS...</span>
    <span class="comment">//</span>
    <span class="comment">// Decode the FILE_CONTENTS into a StringMap object,</span>
    <span class="comment">// and if success, make sure it contains these values:</span>
    <span class="comment">//</span>
    <span class="comment">// id:       The NymID.</span>
    <span class="comment">// name:     The display name from the wallet.</span>
    <span class="comment">// certfile: The public / private certfile in openssl format.</span>
    <span class="comment">// nymfile:  The contents of the nymfile.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (theMap.end() == theMap.find(<span class="stringliteral">&quot;id&quot;</span>)) <span class="comment">// todo hardcoding</span>
    {
        <span class="comment">// not found.</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find &#39;id&#39; field while trying to import Nym:\n%s\n&quot;</span>,
                       __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (theMap.end() == theMap.find(<span class="stringliteral">&quot;name&quot;</span>)) <span class="comment">// todo hardcoding</span>
    {
        <span class="comment">// not found.</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find &#39;name&#39; field while trying to import Nym:\n%s\n&quot;</span>,
                       __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (theMap.end() == theMap.find(<span class="stringliteral">&quot;nymfile&quot;</span>)) <span class="comment">// todo hardcoding</span>
    {
        <span class="comment">// not found.</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find &#39;nymfile&#39; field while trying to import Nym:\n%s\n&quot;</span>,
                       __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------</span>
    <span class="keywordflow">if</span> ((theMap.end() == theMap.find(<span class="stringliteral">&quot;certfile&quot;</span>)) &amp;&amp; <span class="comment">// todo hardcoding</span>
        (theMap.end() == theMap.find(<span class="stringliteral">&quot;credlist&quot;</span>)))   <span class="comment">// Logic: No certfile AND no credlist? Gotta have one or the other.</span>
    {
        <span class="comment">// not found.</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find a &#39;certfile&#39; nor a &#39;credlist&#39; field while trying to import Nym:\n%s\n&quot;</span>,
                       __FUNCTION__, FILE_CONTENTS.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------------------------------------</span>
    <span class="comment">// Do various verifications on the values to make sure there&#39;s no funny business.</span>
    <span class="comment">//</span>
    <span class="comment">// If Nym with this ID is ALREADY in the wallet, set pNymID and return false.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID  (theMap[<span class="stringliteral">&quot;id&quot;</span>  ].c_str());
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strNymName(theMap[<span class="stringliteral">&quot;name&quot;</span>].c_str());

    <span class="keywordflow">if</span> (NULL != pNymID)
        pNymID-&gt;<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theMap[<span class="stringliteral">&quot;id&quot;</span>].c_str());
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (theNymID.IsEmpty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: NYM_ID passed in is empty; returning false&quot;</span>, __FUNCTION__); <span class="keywordflow">return</span> <span class="keyword">false</span>; }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// MAKE SURE IT&#39;S NOT ALREADY IN THE WALLET.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theNymID, <span class="keyword">true</span>, __FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>

    <span class="keywordflow">if</span> (NULL != pNym) <span class="comment">// already there.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Tried to import a Nym that&#39;s already in wallet: %s\n&quot;</span>,
                       __FUNCTION__, theMap[<span class="stringliteral">&quot;id&quot;</span>].c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Create a new Nym object.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID);
    pNym = <span class="keyword">new</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>(theNymID);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPseudonym&gt;</a> theAngel(*pNym); <span class="comment">// will be cleaned up automatically.</span>

    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acf835189df80fda4eedc88d4cccdc5f1">SetNymName</a>(strNymName);

    <span class="comment">// *****************************************************************</span>

    <span class="comment">// The Nym being imported has its own password. We ask for that here,</span>
    <span class="comment">// so we can preserve it in an OTPassword object and pass it around to</span>
    <span class="comment">// everyone who needs it.</span>
    <span class="comment">//</span>
    <span class="comment">// This way OT doesn&#39;t automatically ask for it a billion times as it</span>
    <span class="comment">// goes through the process of loading and copying these various keys</span>
    <span class="comment">// (None of which utilize the wallet&#39;s built-in cached master key, since</span>
    <span class="comment">// this Nym is being imported and thus is external to the wallet until</span>
    <span class="comment">// that process is complete.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strDisplay(<span class="stringliteral">&quot;Enter passphrase for the Nym being imported.&quot;</span>);

    <span class="comment">// Circumvents the cached key.</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pExportPassphrase = <a class="code" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">OTSymmetricKey::GetPassphraseFromUser</a>(&amp;strDisplay, <span class="keyword">false</span>); <span class="comment">//bAskTwice is true when exporting (since the export passphrase is being created at that time.) But here during importing, we just ask once, since the passphrase is being used, not created.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> thePasswordAngel(pExportPassphrase);

    <span class="keywordflow">if</span> (NULL == pExportPassphrase)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed in GetPassphraseFromUser.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// *****************************************************************</span>
    <span class="comment">// Pause the master key, since this Nym is coming from outside</span>
    <span class="comment">// the wallet. We&#39;ll let it load with its own key. (No point using</span>
    <span class="comment">// the internal wallet master key here, since the Nym is coming from</span>
    <span class="comment">// outside, and doesn&#39;t use it anyway.)</span>
    <span class="comment">// This is true regardless of whether we load via the old system or</span>
    <span class="comment">// the new credentials system.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!(<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused()))
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Pause();   <span class="comment">// BELOW THIS POINT, CACHED MASTER KEY IS DISABLED.</span>
    }
    <span class="comment">// *****************************************************************</span>
    <span class="comment">// Set the credentials or keys on the new Nym object based on the</span>
    <span class="comment">// certfile from the StringMap.</span>
    <span class="comment">//</span>
    <span class="comment">// -------------------------------------------------</span>
    <span class="keywordtype">bool</span>      bIfNymLoadKeys = <span class="keyword">false</span>;
    <a class="code" href="class_o_t_string.html">OTString</a>  strReasonToLoad(<span class="stringliteral">&quot;(ImportNym) To import this Nym, what is its passphrase? &quot;</span>);
    <a class="code" href="class_o_t_string.html">OTString</a>  strReasonToSave(<span class="stringliteral">&quot;(ImportNym) What is your wallet&#39;s master passphrase? &quot;</span>);

    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataLoad(strReasonToLoad.Get());
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataSave(strReasonToSave.Get());
    <span class="comment">// ------------------------------------------------------------</span>
    mapOfStrings::iterator it_credlist    = theMap.find(<span class="stringliteral">&quot;credlist&quot;</span>);
    mapOfStrings::iterator it_credentials = theMap.find(<span class="stringliteral">&quot;credentials&quot;</span>);
    <span class="keywordtype">bool</span> bHasCredentials = <span class="keyword">false</span>;
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">// found &quot;credlist&quot;</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (theMap.end() != it_credlist)
    {
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCredList;
        <a class="code" href="class_o_t_string.html">OTString</a>     strCredList;
        <span class="keywordflow">if</span> (it_credlist-&gt;second.size() &gt; 0)
        {
            ascCredList.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(it_credlist-&gt;second.c_str());
            ascCredList.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strCredList);
        }
        <span class="comment">// ----------------------------------------------</span>
        <span class="comment">// cred list exists, and found &quot;credentials&quot;...</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (strCredList.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; (theMap.end() != it_credentials)) <span class="comment">// and found &quot;credentials&quot;</span>
        {
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascCredentials;
            <span class="keywordflow">if</span> (it_credentials-&gt;second.size() &gt; 0)
            {
                ascCredentials.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(it_credentials-&gt;second.c_str());
                <span class="comment">// -------------------------------------------------</span>
                <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a>  * pPrivateStorable = <a class="code" href="namespace_o_t_d_b.html#a3c1cc3076ede1a1b6d78d1fea7de8cea">OTDB::DecodeObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82acc03e85e0f615881a2abe9ca12628330">OTDB::STORED_OBJ_STRING_MAP</a>, ascCredentials.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTDB::Storable&gt;</a> thePrivStorableAngel(pPrivateStorable); <span class="comment">// It will definitely be cleaned up.</span>
                <a class="code" href="class_o_t_d_b_1_1_string_map.html">OTDB::StringMap</a> * pPrivateMap = (NULL == pPrivateStorable) ? NULL : dynamic_cast&lt;OTDB::StringMap *&gt;(pPrivateStorable);
                <span class="comment">// -------------------------------------------------</span>
                <span class="keywordflow">if</span> (NULL == pPrivateMap)
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed decoding StringMap object.\n&quot;</span>, __FUNCTION__);
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
                <span class="keywordflow">else</span> <span class="comment">// IF the list saved, then we save the credentials themselves...</span>
                {
                    <a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a> &amp; thePrivateMap = pPrivateMap-&gt;<a class="code" href="class_o_t_d_b_1_1_string_map.html#a460f2e551430c65fef4130576985a0ce">the_map</a>;
                    <span class="comment">// ----------------------------------------</span>
                    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strCredList,
                                                      &amp;thePrivateMap,
                                                      &amp;strReasonToLoad,
                                                      pExportPassphrase)) <span class="comment">// &lt;===========</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading nym %s from credential string.\n&quot;</span>,
                                      __FUNCTION__, strNymID.Get());
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                    <span class="keywordflow">else</span> <span class="comment">// Success</span>
                    {
                        bIfNymLoadKeys  = <span class="keyword">true</span>;   <span class="comment">// &lt;============</span>
                        bHasCredentials = <span class="keyword">true</span>;
                    }
                } <span class="comment">// success decoding StringMap</span>
            } <span class="comment">// it_credentials.second().size() &gt; 0</span>
        } <span class="comment">// strCredList.Exists() and it_credentials found.</span>
    } <span class="comment">// found &quot;credlist&quot;</span>
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">// found &quot;certfile&quot;</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theMap.end() != theMap.find(<span class="stringliteral">&quot;certfile&quot;</span>))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCert(theMap[<span class="stringliteral">&quot;certfile&quot;</span>]);
        bIfNymLoadKeys = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aa7e06445fd850c8a13cabf2283ca4f01">Loadx509CertAndPrivateKeyFromString</a>(strCert, &amp;thePWDataLoad, pExportPassphrase); <span class="comment">// &lt;============</span>
    }
    <span class="comment">// *****************************************************************</span>
    <span class="comment">// Unpause the OTCachedKey (wallet master key.)</span>
    <span class="comment">// Now that we&#39;ve loaded up the &quot;outsider&quot; using its own key,</span>
    <span class="comment">// we now resume normal wallet master key operations so that when</span>
    <span class="comment">// we save the Nym, it will be saved using the wallet master key.</span>
    <span class="comment">// (Henceforth, it has been &quot;imported.&quot;)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;isPaused())
    {
        <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">OTCachedKey::It</a>()-&gt;Unpause();   <span class="comment">// BELOW THIS POINT, CACHED MASTER KEY IS BACK IN EFFECT. (Disabled above.)</span>
    }
    <span class="comment">// *****************************************************************</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bIfNymLoadKeys &amp;&amp; pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>())
    {
        <span class="comment">// Before we go on switching the credentials around, let&#39;s make sure this Nym we&#39;re</span>
        <span class="comment">// importing isn&#39;t already in the wallet.</span>

        <span class="comment">// -----------------------------</span>
        <span class="keywordflow">if</span> ( bHasCredentials &amp;&amp;
            !pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adf52e65c9002374a7298f17d97be5b57">ReEncryptPrivateCredentials</a>(<span class="keyword">true</span><span class="comment">/*bImporting*/</span>, &amp;thePWDataLoad, pExportPassphrase)) <span class="comment">// Handles OTCachedKey internally, no need for pausing for this call.</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to re-encrypt Nym&#39;s private credentials.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// -----------------------------</span>
        <span class="comment">// load Nymfile from string</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymfile(theMap[<span class="stringliteral">&quot;nymfile&quot;</span>]);

              <span class="keywordtype">bool</span> bConverted = <span class="keyword">false</span>;
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoaded    = (strNymfile.Exists() &amp;&amp; pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strNymfile));
<span class="comment">//      const bool bLoaded    = (strNymfile.Exists() &amp;&amp; pNym-&gt;LoadFromString(strNymfile, &amp;thePrivateMap)); // Unnecessary, since pNym has already loaded with this private info, and it will stay loaded even through loading up the nymfile portion, which does not overwrite it. Furthermore, we have since transformed that data, re-encrypting it to a new key, and that&#39;s the important change that we&#39;re trying to save here! Therefore I don&#39;t want to re-introduce this (now old) version of the private info, therefore this is commented out.</span>
        <span class="comment">// -----------------------------</span>
        <span class="comment">// If success: Add to Wallet including name.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bLoaded)
        {
            pWallet-&gt;<a class="code" href="class_o_t_wallet.html#acb570de733658a4ad24756dde0f22a34">AddNym</a>(*pNym); <span class="comment">// Insert to wallet&#39;s list of Nyms.</span>
            theAngel.SetCleanupTargetPointer(NULL); <span class="comment">// Since adding to wallet, no need to cleanup, so we set this back to NULL.</span>

            <span class="keywordflow">if</span> (!pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a59daeb8ce8f92530c5ddb4fcd1dde7d4">ConvertNymToCachedKey</a>(*pNym)) <span class="comment">// This also calls SaveX509CertAndPrivateKey, FYI. (Or saves credentials, too, whichever is applicable.)</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling pWallet-&gt;ConvertNymToCachedKey(*pNym)\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
                bConverted = <span class="keyword">true</span>;
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading nymfile from string.\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ***********************************************************</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bLoaded &amp;&amp; bConverted) <span class="comment">// bLoaded is probably superfluous here.</span>
        {
            <span class="comment">// ----------------------------</span>
            <span class="comment">// save the nymfile.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (!pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pNym))
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed calling SaveSignedNymfile.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// ----------------------------</span>
            <span class="comment">// the conversion process adds values to the wallet, so we must save it after.</span>
            <span class="keywordflow">if</span> (!pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed to save (updated) wallet.\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            <span class="keywordflow">return</span> <span class="keyword">true</span>;   <span class="comment">// &lt;========= Success!</span>
        }
        <span class="comment">// ***********************************************************</span>
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading or verifying keys|credentials|pseudonym.\n&quot;</span>, __FUNCTION__);
    <span class="comment">// ----------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b5282e8670208c395d3ab98a9a2a315"></a><!-- doxytag: member="OT_API::Wallet_ImportPurse" ref="a4b5282e8670208c395d3ab98a9a2a315" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_TYPE_ID, const OTIdentifier &amp;SIGNER_ID, const OTString &amp;THE_PURSE, const OTString *pstrDisplay=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a4b5282e8670208c395d3ab98a9a2a315">OT_API::Wallet_ImportPurse</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_TYPE_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SIGNER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_PURSE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l05733">5733</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(m_bInitialized, <span class="stringliteral">&quot;Not initialized; call OT_API::Init first.&quot;</span>);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strPurseReason ((NULL == pstrDisplay) ? <span class="stringliteral">&quot;Enter passphrase for purse being imported.&quot;</span> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWDataWallet((NULL == pstrDisplay) ? <a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a> : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> thePassword; <span class="comment">// Only used in the case of password-protected purses.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SIGNER_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWDataWallet); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a>    * pNewPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNewPurse);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theNewPurseAngel(pNewPurse);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// What&#39;s going on here?</span>
    <span class="comment">// A purse can be encrypted by a private key (controlled by a Nym) or by a symmetric</span>
    <span class="comment">// key (embedded inside the purse along with a corresponding master key.) The below</span>
    <span class="comment">// function is what actually loads up pPurse from string (THE_PURSE) and this call</span>
    <span class="comment">// also returns pOwner, which is a pointer to a special wrapper class (which you must</span>
    <span class="comment">// delete, when you&#39;re done with it) which contains a pointer EITHER to the owner Nym</span>
    <span class="comment">// for that purse, OR to the &quot;owner&quot; symmetric key for that purse.</span>
    <span class="comment">//</span>
    <span class="comment">// This way, any subsequent purse operations can use pOwner, regardless of whether there</span>
    <span class="comment">// is actually a Nym inside, or a symmetric key. (None of the purse operations will care,</span>
    <span class="comment">// since they can use pOwner either way.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_nym__or___symmetric_key.html">OTNym_or_SymmetricKey</a> * pNewOwner = this-&gt;<a class="code" href="class_o_t___a_p_i.html#a7b06c8e03c43b3b45d74333b16a5f1b7">LoadPurseAndOwnerForMerge</a>(THE_PURSE, *pNewPurse, thePassword,
                                                                        <span class="keyword">false</span>, <span class="comment">//bCanBePublic=false by default. (Private Nym must be loaded, if a nym is the owner.)</span>
                                                                        &amp;SIGNER_ID, <span class="comment">// This can be NULL, **IF** purse is password-protected. (It&#39;s just ignored in that case.) Otherwise if it&#39;s Nym-protected, the purse will have a NymID on it already, which is what LoadPurseAndOwnerForMerge will try first. If not (it&#39;s optional), then SIGNER_ID is the ID it will try next, before failing altogether.</span>
                                                                        &amp;strPurseReason);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTNym_or_SymmetricKey&gt;</a> theOwnerAngel(pNewOwner);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pNewOwner) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// This already logs, no need for more logs.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_purse.html">OTPurse</a> * pOldPurse = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">LoadPurse</a>(SERVER_ID, ASSET_TYPE_ID, SIGNER_ID);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theOldPurseAngel(pOldPurse);

    <span class="keywordflow">if</span> (NULL == pOldPurse) <span class="comment">// apparently there&#39;s not already a purse of this type, let&#39;s create it.</span>
    {
        pOldPurse = <span class="keyword">new</span> <a class="code" href="class_o_t_purse.html">OTPurse</a>(SERVER_ID, ASSET_TYPE_ID, SIGNER_ID);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOldPurse);
        <span class="comment">// ---------------------------------------</span>
        theOldPurseAngel.SetCleanupTarget(*pOldPurse);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pOldPurse-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pNym))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed to verify signature on old purse. (Very strange...)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// By this point, the old purse has either been loaded, or created.</span>
    <span class="comment">// Let&#39;s make sure the server and asset ID match between the purses,</span>
    <span class="comment">// since they are now actually loaded up.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pOldPurse-&gt;<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>() != pNewPurse-&gt;<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: ServerIDs don&#39;t match between these two purses.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pOldPurse-&gt;<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a>() != pNewPurse-&gt;<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: AssetIDs don&#39;t match between these two purses.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// By this point, I have two owners, and two purses.</span>
    <span class="comment">//</span>
    <span class="comment">// NOTE: if I want to pass in a custom display string here, pNym could be replaced with</span>
    <span class="comment">// pOldOwner (an OTNym_or_SymmetricKey instance) which can contain that string.</span>
    <span class="comment">// (I&#39;m referring to the string that contains the &quot;reason&quot; why the passphrase needs to</span>
    <span class="comment">// be entered, so it can be shown to the user on the passphrase dialog.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pOldPurse-&gt;<a class="code" href="class_o_t_purse.html#aaabdf20e412ce34bade7a3c280973355">Merge</a>(*pNym, <span class="comment">// signer</span>
                         *pNym, <span class="comment">// old owner (must be private, if a nym.)</span>
                         *pNewOwner, <span class="comment">// new owner (must be private, if a nym.)</span>
                         *pNewPurse)) <span class="comment">// new purse (being merged into old.)</span>
    {
        pOldPurse-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        pOldPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pOldPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
        <span class="comment">// -------------------------------------------------</span>
        <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t___a_p_i.html#ac3e808efa2420f7647ee0659de4ed176">SavePurse</a>(SERVER_ID, ASSET_TYPE_ID, SIGNER_ID, *pOldPurse);
    }
    <span class="keywordflow">else</span> <span class="comment">// Failed merge.</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a>   strNymID1, strNymID2;
        pNym-&gt;     GetIdentifier(strNymID1);
        pNewOwner-&gt;<a class="code" href="class_o_t_nym__or___symmetric_key.html#a9a401c9d880a03cfbcb5dd2ed4813c86">GetIdentifier</a>(strNymID2);
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: (OldNymID: %s.) (New Owner ID: %s.) Failure merging new &quot;</span>
                       <span class="stringliteral">&quot;purse:\n\n%s\n\n&quot;</span>, __FUNCTION__, strNymID1.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strNymID2.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                       THE_PURSE.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abfa83caebd9bb2bd22377f7b5f630055"></a><!-- doxytag: member="OT_API::Wallet_RemoveAssetType" ref="abfa83caebd9bb2bd22377f7b5f630055" args="(const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#abfa83caebd9bb2bd22377f7b5f630055">OT_API::Wallet_RemoveAssetType</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02154">2154</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (ASSET_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// Make sure there aren&#39;t any dependent accounts..</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___a_p_i.html#a1ca73000987bce8e5e326a43ca46cd69">Wallet_CanRemoveAssetType</a>(ASSET_ID)) <span class="keywordflow">return</span> <span class="keyword">false</span>;


    <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>) {
        <a class="code" href="class_o_t_log.html#a8c12a31fb887aa7a3023879a2ff86173">OTLog::sError</a>(<span class="stringliteral">&quot;%s: No wallet found...!\n&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a> -&gt; RemoveAssetContract(ASSET_ID))
    {
        <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a> -&gt; SaveWallet();
        <a class="code" href="class_o_t_log.html#a607ac911c2ab1fa483168f16dd0e7355">OTLog::sOutput</a>(0, <span class="stringliteral">&quot;%s: Removed asset contract from the wallet: %s\n&quot;</span>,__FUNCTION__, ASSET_ID);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aed300d9ad2ef3d1e76d423c1e91659c5"></a><!-- doxytag: member="OT_API::Wallet_RemoveNym" ref="aed300d9ad2ef3d1e76d423c1e91659c5" args="(const OTIdentifier &amp;NYM_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#aed300d9ad2ef3d1e76d423c1e91659c5">OT_API::Wallet_RemoveNym</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>NYM_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02188">2188</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (NYM_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>


    <span class="comment">// DONE: The below call proves already that there are no accounts laying around</span>
    <span class="comment">// for this Nym. (No need to worry about &quot;orphaned accounts.&quot;)</span>
    <span class="comment">//</span>
    <span class="comment">// DONE (finally):</span>
    <span class="comment">// However, the Nym might still be registered at various servers, even without asset accounts.</span>
    <span class="comment">// Therefore, we need to iterate through the server contracts, and if the Nym is registered at</span>
    <span class="comment">// any of the servers, then &quot;deregister&quot; (before deleting the Nym entirely.) This is much</span>
    <span class="comment">// cleaner for the server side, who otherwise has to expired unused nyms based on some rule</span>
    <span class="comment">// presumably to be found in the server contract.</span>
    <span class="comment">// ------------------------------------------</span>
    <span class="keywordflow">if</span> (! <a class="code" href="class_o_t___a_p_i.html#a2f3e914453a7b7ad2a03b6a39f3f0fce">Wallet_CanRemoveNym</a>(NYM_ID)) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>)
    {
        <a class="code" href="class_o_t_log.html#a8c12a31fb887aa7a3023879a2ff86173">OTLog::sError</a>(<span class="stringliteral">&quot;%s: No wallet found...!\n&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#a7dd1cf4ba4922eacc2c3c81d21dd07dc">RemoveNym</a>(NYM_ID))
    {
        <a class="code" href="class_o_t_log.html#a607ac911c2ab1fa483168f16dd0e7355">OTLog::sOutput</a>(0, <span class="stringliteral">&quot;%s: Success erasing Nym from wallet: %s\n&quot;</span>, __FUNCTION__, NYM_ID);
        <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a> -&gt; SaveWallet();
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a607ac911c2ab1fa483168f16dd0e7355">OTLog::sOutput</a>(0, <span class="stringliteral">&quot;%s: Failure erasing Nym from wallet: %s\n&quot;</span>, __FUNCTION__, NYM_ID);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af2aefbb08ad7e13fe40400ab1366b6b0"></a><!-- doxytag: member="OT_API::Wallet_RemoveServer" ref="af2aefbb08ad7e13fe40400ab1366b6b0" args="(const OTIdentifier &amp;SERVER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#af2aefbb08ad7e13fe40400ab1366b6b0">OT_API::Wallet_RemoveServer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l02109">2109</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bInitialized = <a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
    <span class="keywordflow">if</span> (!bInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">if</span> (SERVER_ID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// Make sure there aren&#39;t any dependent accounts..</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___a_p_i.html#ae78c8768a982b6c2fd700f07e2cd6f79">Wallet_CanRemoveServer</a>(SERVER_ID)) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="comment">// TODO: the above call proves that there are no accounts laying around</span>
    <span class="comment">// for this server ID. (No need to worry about &quot;orphaned accounts.&quot;)</span>
    <span class="comment">//</span>
    <span class="comment">// However, there may still be Nyms registered at the server! Therefore,</span>
    <span class="comment">// we need to loop through the Nyms, and make sure none of them has been</span>
    <span class="comment">// registered at this server ID. If it has, then we need to message the server</span>
    <span class="comment">// to &quot;deregister&quot; the Nym, which is much cleaner.  Otherwise server&#39;s only</span>
    <span class="comment">// other alternative is to expire Nyms that have gone unused for some specific</span>
    <span class="comment">// period of time, presumably those terms are described in the server contract.</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>) {
        <a class="code" href="class_o_t_log.html#a8c12a31fb887aa7a3023879a2ff86173">OTLog::sError</a>(<span class="stringliteral">&quot;%s:  No wallet found...\n&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#ab739c1b18f6dcc6958cfd1ac53f728d8">RemoveServerContract</a>(SERVER_ID))
    {
        <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();
        <a class="code" href="class_o_t_log.html#a607ac911c2ab1fa483168f16dd0e7355">OTLog::sOutput</a>(0, <span class="stringliteral">&quot;%s: Removed server contract from the wallet: %s\n&quot;</span>, __FUNCTION__, SERVER_ID);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a798f3a326f18f31b8e62a682bbaa6a6d"></a><!-- doxytag: member="OT_API::WalletExists" ref="a798f3a326f18f31b8e62a682bbaa6a6d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t___a_p_i.html#a798f3a326f18f31b8e62a682bbaa6a6d">OT_API::WalletExists</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l00881">881</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (NULL != <a class="code" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">m_pWallet</a>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7157cd6bf562305e24867b9521188a3c"></a><!-- doxytag: member="OT_API::withdrawVoucher" ref="a7157cd6bf562305e24867b9521188a3c" args="(OTIdentifier &amp;SERVER_ID, OTIdentifier &amp;USER_ID, OTIdentifier &amp;ACCT_ID, OTIdentifier &amp;RECIPIENT_USER_ID, OTString &amp;CHEQUE_MEMO, const int64_t &amp;AMOUNT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t___a_p_i.html#a7157cd6bf562305e24867b9521188a3c">OT_API::withdrawVoucher</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CHEQUE_MEMO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>AMOUNT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l09525">9525</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(USER_ID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *  pServer = this-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(SERVER_ID, __FUNCTION__); <span class="comment">// This ASSERTs and logs already.</span>
    <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> (-1);
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    CONTRACT_ID;
    <a class="code" href="class_o_t_string.html">OTString</a>        strContractID;

    CONTRACT_ID = pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
    CONTRACT_ID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strContractID);
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

    <span class="keyword">const</span> int64_t lAmount = AMOUNT;

    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strNymID(USER_ID), strFromAcct(ACCT_ID);

    int64_t lWithdrawTransNum = 0,
         lVoucherTransNum  = 0;

    <span class="keywordtype">bool</span> bGotTransNum1 = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lWithdrawTransNum);
    <span class="keywordtype">bool</span> bGotTransNum2 = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lVoucherTransNum);

    <span class="keywordflow">if</span> (!bGotTransNum1 || !bGotTransNum2)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Not enough Transaction Numbers were available. &quot;</span>
                       <span class="stringliteral">&quot;(Suggest requesting the server for more.)\n&quot;</span>, __FUNCTION__);

        <span class="keywordflow">if</span> (bGotTransNum1)
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lWithdrawTransNum, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        <span class="keywordflow">if</span> (bGotTransNum2)
            pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lVoucherTransNum,  <span class="keyword">true</span>); <span class="comment">// bSave=true</span>

        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strChequeMemo(CHEQUE_MEMO);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strRecipientUserID(RECIPIENT_USER_ID);
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">// Expiration (ignored by server -- it sets its own for its vouchers.)</span>
    <span class="keyword">const</span>   <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    VALID_FROM  = <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>(); <span class="comment">// This time is set to TODAY NOW</span>
    <span class="keyword">const</span>   <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>    VALID_TO = <a class="code" href="_o_t_common_8hpp.html#a38e4e4253c3dd158ea40e6312586e6c9">OTTimeAddTimeInterval</a>(VALID_FROM, <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="_o_t_common_8hpp.html#ad650525921666babad17624b1a25dbcd">OT_TIME_SIX_MONTHS_IN_SECONDS</a>)); <span class="comment">// 6 months.</span>
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">// The server only uses the memo, amount, and recipient from this cheque when it</span>
    <span class="comment">// constructs the actual voucher.</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theRequestVoucher(SERVER_ID, CONTRACT_ID);
    <span class="keywordtype">bool</span> bIssueCheque = theRequestVoucher.IssueCheque(lAmount, lVoucherTransNum,
                                                      VALID_FROM, VALID_TO, ACCT_ID, USER_ID, strChequeMemo,
                                                      (strRecipientUserID.GetLength() &gt; 2) ? &amp;(RECIPIENT_USER_ID) : NULL);
    <span class="comment">// --------------------------------------------------</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = pAccount-&gt;<a class="code" href="class_o_t_account.html#a9d961058556c3a8381b082d3a0b5f7e7">LoadInbox</a>(*pNym);
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = pAccount-&gt;<a class="code" href="class_o_t_account.html#a5a00679ce53bc6744dc4ec09c2915b3a">LoadOutbox</a>(*pNym);

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pInbox)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::%s: Failed loading inbox for acct %s\n&quot;</span>,
                       __FUNCTION__, strFromAcct.Get());

        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lWithdrawTransNum, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lVoucherTransNum,  <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OT_API::%s: Failed loading outbox for acct %s\n&quot;</span>,
                       __FUNCTION__, strFromAcct.Get());

        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lWithdrawTransNum, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lVoucherTransNum,  <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bIssueCheque)
    {
        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lWithdrawTransNum, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lVoucherTransNum,  <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
    }
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Create a transaction</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> (USER_ID, ACCT_ID, SERVER_ID,
                                                                           <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>, lWithdrawTransNum);
        <span class="comment">// set up the transaction item (each transaction may have multiple items...)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a044b299744ed5d88b526470c0a3bbcf4">OTItem::withdrawVoucher</a>);
        pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount);
        <a class="code" href="class_o_t_string.html">OTString</a> strNote(<span class="stringliteral">&quot; &quot;</span>);
        pItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(strNote);

        <span class="comment">// Add the voucher request string as the attachment on the transaction item.</span>
        theRequestVoucher.SignContract(*pNym);
        theRequestVoucher.SaveContract();
        <a class="code" href="class_o_t_string.html">OTString</a> strVoucher(theRequestVoucher);
        <span class="comment">// ---------------------------------------------</span>
        pItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strVoucher); <span class="comment">// The voucher request is contained in the reference string.</span>

        <span class="comment">// sign the item</span>
        pItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem); <span class="comment">// the Transaction&#39;s destructor will cleanup the item. It &quot;owns&quot; it now.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// BALANCE AGREEMENT</span>
        <span class="comment">//</span>
        <span class="comment">// The item is signed and saved within this call as well. No need to do that again.</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(lAmount*(-1), *pTransaction, *pNym, *pAccount, *pOutbox);

        <span class="keywordflow">if</span> (NULL != pBalanceItem)
            pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem); <span class="comment">// Better not be NULL... message will fail... But better check anyway.</span>
        <span class="comment">// ---------------------------------------------</span>
        <span class="comment">// sign the transaction</span>
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// set up the ledger</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, ACCT_ID, SERVER_ID);
        theLedger.GenerateLedger(ACCT_ID, SERVER_ID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>); <span class="comment">// bGenerateLedger defaults to false, which is correct.</span>
        theLedger.AddTransaction(*pTransaction);

        <span class="comment">// sign the ledger</span>
        theLedger.SignContract(*pNym);
        theLedger.SaveContract();

        <span class="comment">// extract the ledger in ascii-armored form</span>
        <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(theLedger);
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascLedger(strLedger);

        int64_t lRequestNumber = 0;

        <span class="comment">// (0) Set up the REQUEST NUMBER and then INCREMENT IT</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a3866622c214e0c9b9ede3b00df3cdcba">GetCurrentRequestNum</a>(strServerID, lRequestNumber);
        theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%ld&quot;</span>, lRequestNumber); <span class="comment">// Always have to send this.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e2031a4404c589c3a492bd48eb63932">IncrementRequestNum</a>(*pNym, strServerID); <span class="comment">// since I used it for a server request, I have to increment it</span>

        <span class="comment">// (1) Set up member variables</span>
        theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>         = <span class="stringliteral">&quot;notarizeTransactions&quot;</span>;
        theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>           = strNymID;
        theMessage.<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>        = strServerID;
        theMessage.<a class="code" href="class_o_t_message.html#a1d5e432e2353991e4a52752921e6d915">SetAcknowledgments</a>(*pNym); <span class="comment">// Must be called AFTER theMessage.m_strServerID is already set. (It uses it.)</span>

        theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>          = strFromAcct;
        theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>         = ascLedger;

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYMBOX_HASH;
        <span class="keyword">const</span> std::string str_server(strServerID.Get());
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bNymboxHash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server, NYMBOX_HASH);
        NYMBOX_HASH.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);

        <span class="keywordflow">if</span> (!bNymboxHash)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed getting NymboxHash from Nym for server: %s\n&quot;</span>,
                          __FUNCTION__, str_server.c_str());

        <span class="comment">// (2) Sign the Message</span>
        theMessage.<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);

        <span class="comment">// (3) Save the Message (with signatures and all, back to its internal member m_strRawFile.)</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// (Send it)</span>
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServer, *pNym, this-&gt;m_pTransportCallback);
        <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#acba8ab65dfe62afdc219277c9d44b546">ProcessMessageOut</a>(theMessage);

        <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">m_pClient</a>-&gt;<a class="code" href="class_o_t_client.html#aa8dd2177f0b88bc2ac38b6abac24d4e3">CalcReturnVal</a>(lRequestNumber);
    }

    <span class="keywordflow">return</span> (-1);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a504e99bac03c227bbecb79f869a76578"></a><!-- doxytag: member="OT_API::WriteCheque" ref="a504e99bac03c227bbecb79f869a76578" args="(const OTIdentifier &amp;SERVER_ID, const int64_t &amp;CHEQUE_AMOUNT, const time64_t &amp;VALID_FROM, const time64_t &amp;VALID_TO, const OTIdentifier &amp;SENDER_ACCT_ID, const OTIdentifier &amp;SENDER_USER_ID, const OTString &amp;CHEQUE_MEMO, const OTIdentifier *pRECIPIENT_USER_ID=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cheque.html">OTCheque</a> * <a class="el" href="class_o_t___a_p_i.html#a504e99bac03c227bbecb79f869a76578">OT_API::WriteCheque</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>CHEQUE_AMOUNT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>VALID_FROM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>VALID_TO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>CHEQUE_MEMO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pRECIPIENT_USER_ID</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8cpp_source.html#l04674">4674</a> of file <a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = this-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(SENDER_USER_ID, <span class="keyword">false</span>, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = this-&gt;<a class="code" href="class_o_t___a_p_i.html#ad125eb5eb9193091ac98cc9aee179e77">GetOrLoadAccount</a>(*pNym, SENDER_ACCT_ID, SERVER_ID, __FUNCTION__);
    <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> NULL;
    <span class="comment">// By this point, pAccount is a good pointer, and is on the wallet. (No need to cleanup.)</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// To write a cheque, we need to burn one of our transaction numbers. (Presumably the wallet</span>
    <span class="comment">// is also storing a couple of these, since they are needed to perform any transaction.)</span>
    <span class="comment">//</span>
    <span class="comment">// I don&#39;t have to contact the server to write a cheque -- as long as I already have a transaction</span>
    <span class="comment">// number I can use to write it with. (Otherwise I&#39;d have to ask the server to send me one first.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID);
    int64_t lTransactionNumber=0; <span class="comment">// Notice I use the server ID on the ACCOUNT.</span>

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lTransactionNumber))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: User attempted to write a cheque, but had no transaction numbers.\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// At this point, I know that lTransactionNumber contains one I can use.</span>
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> * pCheque = <span class="keyword">new</span> <a class="code" href="class_o_t_cheque.html">OTCheque</a>(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>(),
                                      pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>());
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pCheque, <span class="stringliteral">&quot;OT_API::WriteCheque: Error allocating memory in the OT API.&quot;</span>);
    <span class="comment">// At this point, I know that pCheque is a good pointer that I either</span>
    <span class="comment">// have to delete, or return to the caller.</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordtype">bool</span> bIssueCheque = pCheque-&gt;<a class="code" href="class_o_t_cheque.html#af554e93b31bf218e373bdc8f457d7605">IssueCheque</a>(CHEQUE_AMOUNT,
                                             lTransactionNumber,
                                             VALID_FROM, VALID_TO,
                                             SENDER_ACCT_ID,
                                             SENDER_USER_ID,
                                             CHEQUE_MEMO,
                                             pRECIPIENT_USER_ID);
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bIssueCheque)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure calling OTCheque::IssueCheque().\n&quot;</span>, __FUNCTION__);
        <span class="keyword">delete</span> pCheque; pCheque = NULL;
        <span class="comment">// IF FAILED, ADD TRANSACTION NUMBER BACK TO LIST OF AVAILABLE NUMBERS.</span>
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ------------------------------</span>
    pCheque-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
    pCheque-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
    <span class="comment">// ------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// DROP A COPY into the Outpayments box...</span>
    <span class="comment">//</span>
    <span class="comment">// (Since we used a transaction number to write the cheque,</span>
    <span class="comment">// we have to track it until it&#39;s deposited or until we cancel</span>
    <span class="comment">// it.)</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInstrument(*pCheque);
    <span class="comment">// ------------------------------</span>
    <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pMessage);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(SENDER_USER_ID);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>      = <span class="stringliteral">&quot;outpaymentsMessage&quot;</span>;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>        = strNymID;

    <span class="keywordflow">if</span> (NULL != pRECIPIENT_USER_ID)
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID2(*pRECIPIENT_USER_ID);
        pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>   = strNymID2;
    }
    pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>     = strServerID;
    pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strInstrument);

    pMessage-&gt;<a class="code" href="class_o_t_message.html#a0ed3dfe3a61124318b477ff5c4e5e041">SignContract</a>(*pNym);
    pMessage-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a0e6b0025655ea295902be7ea71ec444c">AddOutpayments</a>(*pMessage); <span class="comment">// Now the Nym is responsible to delete it. It&#39;s in his &quot;outpayments&quot;.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
    pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym);
    <span class="comment">// ------------------------------</span>
    <span class="keywordflow">return</span> pCheque;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="adb93341da4f1091977c5ac42acef25fd"></a><!-- doxytag: member="OT_API::m_pClient" ref="adb93341da4f1091977c5ac42acef25fd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_client.html">OTClient</a>* <a class="el" href="class_o_t___a_p_i.html#adb93341da4f1091977c5ac42acef25fd">OT_API::m_pClient</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8hpp_source.html#l00257">257</a> of file <a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af96fb56042201afb4574298dcdca93fc"></a><!-- doxytag: member="OT_API::m_pWallet" ref="af96fb56042201afb4574298dcdca93fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_wallet.html">OTWallet</a>* <a class="el" href="class_o_t___a_p_i.html#af96fb56042201afb4574298dcdca93fc">OT_API::m_pWallet</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_open_transactions_8hpp_source.html#l00256">256</a> of file <a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otapi/<a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a></li>
<li>src/otapi/<a class="el" href="_open_transactions_8cpp_source.html">OpenTransactions.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t___a_p_i.html">OT_API</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:06 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
