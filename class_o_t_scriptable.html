<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTScriptable Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_scriptable.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">OTScriptable Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTScriptable" --><!-- doxytag: inherits="OTContract" -->
<p><code>#include &lt;<a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTScriptable:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_scriptable.png" usemap="#OTScriptable_map" alt=""/>
  <map id="OTScriptable_map" name="OTScriptable_map">
<area href="class_o_t_contract.html" alt="OTContract" shape="rect" coords="119,0,228,24"/>
<area href="class_o_t_instrument.html" alt="OTInstrument" shape="rect" coords="119,112,228,136"/>
<area href="class_o_t_offer.html" alt="OTOffer" shape="rect" coords="0,168,109,192"/>
<area href="class_o_t_token.html" alt="OTToken" shape="rect" coords="119,168,228,192"/>
<area href="class_o_t_trackable.html" alt="OTTrackable" shape="rect" coords="238,168,347,192"/>
<area href="class_o_t_cheque.html" alt="OTCheque" shape="rect" coords="178,224,287,248"/>
<area href="class_o_t_cron_item.html" alt="OTCronItem" shape="rect" coords="297,224,406,248"/>
<area href="class_o_t_agreement.html" alt="OTAgreement" shape="rect" coords="178,280,287,304"/>
<area href="class_o_t_smart_contract.html" alt="OTSmartContract" shape="rect" coords="297,280,406,304"/>
<area href="class_o_t_trade.html" alt="OTTrade" shape="rect" coords="416,280,525,304"/>
<area href="class_o_t_payment_plan.html" alt="OTPaymentPlan" shape="rect" coords="178,336,287,360"/>
</map>
 </div></div>

<p><a href="class_o_t_scriptable-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a7590c450a8a079eb388fd4fc378b3b40">SetDisplayLabel</a> (const std::string *pstrLabel=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">GetPartyCount</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a8ceb875e6117eaa14fd02d84e15cb9b3">GetBylawCount</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#accfde75655f5c49c041ef3a5fbff54e6">AddParty</a> (<a class="el" href="class_o_t_party.html">OTParty</a> &amp;theParty)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a32d8bccb563ab97e335f457148770c73">AddBylaw</a> (<a class="el" href="class_o_t_bylaw.html">OTBylaw</a> &amp;theBylaw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a197539281206ac2e950ff0fc4842886b">ConfirmParty</a> (<a class="el" href="class_o_t_party.html">OTParty</a> &amp;theParty)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a> (const std::string str_party_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_bylaw.html">OTBylaw</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a> (const std::string str_bylaw_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_clause.html">OTClause</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#abe36809472a1b7adf66b303ea176888e">GetClause</a> (const std::string str_clause_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a4be857ffbe603f75f1dc5550ed4c20e9">GetPartyByIndex</a> (int32_t nIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_bylaw.html">OTBylaw</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#addfadf16de3cfbb972ec73e097a8dc81">GetBylawByIndex</a> (int32_t nIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#aa89029542587094cd2844cb8bf7a9a16">FindPartyBasedOnNymAsAgent</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_agent.html">OTAgent</a> **ppAgent=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a08ff87b0f54ed3139bfcfb362a757778">FindPartyBasedOnNymAsAuthAgent</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_agent.html">OTAgent</a> **ppAgent=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#adf3ca54a95c8813c23cf7bdc23e4330a">FindPartyBasedOnAccount</a> (<a class="el" href="class_o_t_account.html">OTAccount</a> &amp;theAccount, <a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> **ppPartyAccount=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#af0eddbe4b88394bcc113d9333d8e0a97">FindPartyBasedOnNymIDAsAgent</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theNymID, <a class="el" href="class_o_t_agent.html">OTAgent</a> **ppAgent=NULL) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a5853814d252a72a7d5c7d63f04c3cae2">FindPartyBasedOnNymIDAsAuthAgent</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theNymID, <a class="el" href="class_o_t_agent.html">OTAgent</a> **ppAgent=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party.html">OTParty</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a7a425a20fba9d2a800e1d6a029186094">FindPartyBasedOnAccountID</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID, <a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> **ppPartyAccount=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_agent.html">OTAgent</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a8f8c32df22c81d1a5aec3e483089b923">GetAgent</a> (const std::string str_agent_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a94c9e55f78357e04e4b9781ab662370f">GetPartyAccount</a> (const std::string str_acct_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ae4abf1800fd193dc93835b777f40019c">GetPartyAccountByID</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a2c2d74c762a93dd62bedfe1235de3bce">GetCountTransNumsNeededForAgent</a> (const std::string str_agent_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a242f30ff4c6deccf285930efa15638eb">VerifyNymAsAgent</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theSignerNym, <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *pmap_ALREADY_LOADED=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a844de5b0eb2560a28bf795c2c4da3f3b">VerifyNymAsAgentForAccount</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_account.html">OTAccount</a> &amp;theAccount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a5b20bcf70883ffe7e02f10343b88affc">VerifyPartyAuthorization</a> (<a class="el" href="class_o_t_party.html">OTParty</a> &amp;theParty, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theSignerNym, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strServerID, <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *pmap_ALREADY_LOADED=NULL, <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *pmap_NEWLY_LOADED=NULL, const bool bBurnTransNo=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a1cd358deb75bfc2d39cbba6a4a4799f6">VerifyPartyAcctAuthorization</a> (<a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> &amp;thePartyAcct, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theSignerNym, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strServerID, const bool bBurnTransNo=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ae83de8305c791c41e58e888cb873def0">VerifyThisAgainstAllPartiesSignedCopies</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a559702a7d59f37881a892129b911d330">AllPartiesHaveSupposedlyConfirmed</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a9e41bb939fd5dbfe1f2442e5919a5079">RetrieveNymPointers</a> (<a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp;map_Nyms_Already_Loaded)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ab9a6cff853b9c71456eaf427caa3ab8b">ClearTemporaryPointers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a298d8fdb0982df3c36e8ae194f228009">GetHooks</a> (const std::string str_HookName, <a class="el" href="_o_t_clause_8hpp.html#a40c16432fa9c16826c026b74351425ad">mapOfClauses</a> &amp;theResults)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_clause.html">OTClause</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a390511c5b2f419453b1cc169ec576972">GetCallback</a> (const std::string str_CallbackName)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_variable.html">OTVariable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a3f72637feb6a94088d8a576e29cc6a29">GetVariable</a> (const std::string str_VarName)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a3855f5a3f2ae738c6a39674f4d621ed5">IsDirty</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a9f08ba14dc0e384301b8b69947243581">IsDirtyImportant</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a69532b928482fc65b1c5abd2cebe3f4c">SetAsClean</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a03d724ec348f2dc140c9ed45d6133429">SendNoticeToAllParties</a> (bool bSuccessMsg, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theServerNym, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, const int64_t &amp;lNewTransactionNumber, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strReference, <a class="el" href="class_o_t_string.html">OTString</a> *pstrNote=NULL, <a class="el" href="class_o_t_string.html">OTString</a> *pstrAttachment=NULL, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pActualNym=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ae2046f1b62828d26dda822eaa6a194b6">CanExecuteClause</a> (const std::string str_party_name, const std::string str_clause_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a4a95506db44acbdd3b125f54cac3595a">ExecuteCallback</a> (<a class="el" href="class_o_t_clause.html">OTClause</a> &amp;theCallbackClause, <a class="el" href="_o_t_variable_8hpp.html#aa7620bdfc9f969dd2802c11c3260eb37">mapOfVariables</a> &amp;theParameters, <a class="el" href="class_o_t_variable.html">OTVariable</a> &amp;varReturnVal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ad469b542209e1c73905d2094bb561793">RegisterOTNativeCallsWithScript</a> (<a class="el" href="class_o_t_script.html">OTScript</a> &amp;theScript)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">Compare</a> (<a class="el" href="class_o_t_scriptable.html">OTScriptable</a> &amp;rhs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a1789860b8b6fae4c7c6543cfc72463cb">OTScriptable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ad15650bac68579572022af0cd2adad9d">~OTScriptable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a65ed14652345ef231ad4a3d347d89c3a">UpdateContentsToString</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strAppend)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#ac1c6d838f350141b461420004bb8834b">CalculateContractID</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;newID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a92785192590f2e039f46d16bcd1934d3">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a2f9a8cf56455a256952bf4069b7039ba">Release_Scriptable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#accb9d578e3b10cee62e6aba7c178cf62">UpdateContents</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#af1433fd747d848bbab0029c06c07668a">SaveContractWallet</a> (std::ofstream &amp;ofs)</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_scriptable.html">OTScriptable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">InstantiateScriptable</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">ValidateName</a> (const std::string str_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#aebf4ace228231ac6aa8395fe56a5271c">GetTime</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a2fe2dd55c1bb910e895c05a6924d08f4">ProcessXMLNode</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">m_bSpecifyParties</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_string.html">OTString</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">m_strLabel</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00144">144</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a1789860b8b6fae4c7c6543cfc72463cb"></a><!-- doxytag: member="OTScriptable::OTScriptable" ref="a1789860b8b6fae4c7c6543cfc72463cb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_scriptable.html#a1789860b8b6fae4c7c6543cfc72463cb">OTScriptable::OTScriptable</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03151">3151</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">:  ot_super(),
    <a class="code" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a>(<span class="keyword">false</span>), <span class="comment">// This is not serialized.</span>
    <a class="code" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a>(<span class="keyword">false</span>), <a class="code" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">m_bSpecifyParties</a>(<span class="keyword">false</span>) <span class="comment">// These are.</span>
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="ad15650bac68579572022af0cd2adad9d"></a><!-- doxytag: member="OTScriptable::~OTScriptable" ref="ad15650bac68579572022af0cd2adad9d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_scriptable.html#ad15650bac68579572022af0cd2adad9d">OTScriptable::~OTScriptable</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03160">3160</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_scriptable.html#a2f9a8cf56455a256952bf4069b7039ba">Release_Scriptable</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a32d8bccb563ab97e335f457148770c73"></a><!-- doxytag: member="OTScriptable::AddBylaw" ref="a32d8bccb563ab97e335f457148770c73" args="(OTBylaw &amp;theBylaw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a32d8bccb563ab97e335f457148770c73">OTScriptable::AddBylaw</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_bylaw.html">OTBylaw</a> &amp;&#160;</td>
          <td class="paramname"><em>theBylaw</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02005">2005</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> std::string str_name = theBylaw.<a class="code" href="class_o_t_bylaw.html#ad7c410277a99a3abed22249a8dfd8fb7">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::AddBylaw:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.find(str_name) == <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.end())
    {
        <span class="comment">// Careful:  This ** DOES ** TAKE OWNERSHIP!  theBylaw will get deleted when this OTScriptable is.</span>
        <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.insert( std::pair&lt;std::string, OTBylaw *&gt;(str_name, &amp;theBylaw)) ;

        theBylaw.<a class="code" href="class_o_t_bylaw.html#ad841af7594d0a885a5b35e6e2973d28c">SetOwnerAgreement</a>(*<span class="keyword">this</span>);

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::AddBylaw: Failed attempt: bylaw already exists on contract.\n &quot;</span>);

    <span class="comment">// ----------------------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="accfde75655f5c49c041ef3a5fbff54e6"></a><!-- doxytag: member="OTScriptable::AddParty" ref="accfde75655f5c49c041ef3a5fbff54e6" args="(OTParty &amp;theParty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#accfde75655f5c49c041ef3a5fbff54e6">OTScriptable::AddParty</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_party.html">OTParty</a> &amp;&#160;</td>
          <td class="paramname"><em>theParty</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#af2ebb9b6ca7fd398f4bbd7e6dc21df93">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01976">1976</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> std::string str_party_name = theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>();

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_party_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::AddParty:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.find(str_party_name) == <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.end())
    {
        <span class="comment">// Careful:  This ** DOES ** TAKE OWNERSHIP!  theParty will get deleted when this OTScriptable is.</span>
        <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.insert( std::pair&lt;std::string, OTParty *&gt;(str_party_name, &amp;theParty)) ;

        theParty.<a class="code" href="class_o_t_party.html#a41f870f87f27213da8f4c2996a3d0bf1">SetOwnerAgreement</a>(*<span class="keyword">this</span>);

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::AddParty: Failed attempt: party already exists on contract.\n &quot;</span>);

    <span class="comment">// ----------------------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a559702a7d59f37881a892129b911d330"></a><!-- doxytag: member="OTScriptable::AllPartiesHaveSupposedlyConfirmed" ref="a559702a7d59f37881a892129b911d330" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a559702a7d59f37881a892129b911d330">OTScriptable::AllPartiesHaveSupposedlyConfirmed</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00496">496</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bReturnVal = (<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size() &gt; 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>
        <span class="keywordflow">if</span> (!(pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()))
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> bReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac1c6d838f350141b461420004bb8834b"></a><!-- doxytag: member="OTScriptable::CalculateContractID" ref="ac1c6d838f350141b461420004bb8834b" args="(OTIdentifier &amp;newID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#ac1c6d838f350141b461420004bb8834b">OTScriptable::CalculateContractID</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>newID</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">OTContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02127">2127</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContents(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);

    <span class="comment">// Produce a template version of the scriptable.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a>    = <span class="keyword">true</span>;

    <a class="code" href="class_o_t_scriptable.html#accb9d578e3b10cee62e6aba7c178cf62">UpdateContents</a>();  <span class="comment">// &lt;=========</span>

    newID.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);

    <span class="comment">// Put it back the way it was.</span>
    <a class="code" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a>    = <span class="keyword">false</span>;

<span class="comment">//  UpdateContents(); // No need to do this, we already had this string before (above).</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a> = strContents; <span class="comment">// Here we just set it back again.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae2046f1b62828d26dda822eaa6a194b6"></a><!-- doxytag: member="OTScriptable::CanExecuteClause" ref="ae2046f1b62828d26dda822eaa6a194b6" args="(const std::string str_party_name, const std::string str_clause_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#ae2046f1b62828d26dda822eaa6a194b6">OTScriptable::CanExecuteClause</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_party_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_clause_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00328">328</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">//  OTCron * pCron  = GetCron();</span>
<span class="comment">//  OT_ASSERT(NULL != pCron);</span>
<span class="comment">//  // ----------------------------------</span>
<span class="comment">//  OTPseudonym * pServerNym = pCron-&gt;GetServerNym();</span>
<span class="comment">//  OT_ASSERT(NULL != pServerNym);</span>
    <span class="comment">// -------------------------------------------------</span>

    <a class="code" href="class_o_t_party.html">OTParty</a>     * pParty    = this-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);
    <a class="code" href="class_o_t_clause.html">OTClause</a>    * pClause   = this-&gt;<a class="code" href="class_o_t_scriptable.html#abe36809472a1b7adf66b303ea176888e">GetClause</a>(str_clause_name);

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Unable to find this party: %s\n&quot;</span>,
                       str_party_name.size() &gt; 0 ? str_party_name.c_str() : <span class="stringliteral">&quot;&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (NULL == pClause)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Unable to find this clause: %s\n&quot;</span>,
                       str_clause_name.size() &gt; 0 ? str_clause_name.c_str() : <span class="stringliteral">&quot;&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Below this point, pParty and pClause are both good.</span>
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">//</span>

    <span class="comment">// ...This WILL check to see if pParty has its Opening number verified as issued.</span>
    <span class="comment">// (If the opening number is &gt; 0 then VerifyPartyAuthorization() is smart enough to verify it.)</span>
    <span class="comment">//</span>
    <span class="comment">// To KNOW that a party has the right to even ASK the script to cancel a contract, MEANS that</span>
    <span class="comment">// (1) The party is listed as a party on the contract. (2) The party&#39;s copy of that contract</span>
    <span class="comment">// is signed by the authorizing agent for that party. and (3) The opening transaction number for</span>
    <span class="comment">// that party is verified as issued for authorizing agent. (2 and 3 are both performed at the same</span>
    <span class="comment">// time, in VerifyPartyAuthorization(), since the agent may need to be loaded in order to verify</span>
    <span class="comment">// them.) 1 is already done by this point, as it&#39;s performed above.</span>
    <span class="comment">//</span>
    <span class="comment">// Todo: notice this code appears in CanCancelContract() (this function) as well as</span>
    <span class="comment">// OTScriptable::CanExecuteClause.</span>
    <span class="comment">// Therefore I can see that THIS VERIFICATION CODE WILL GET CALLED EVERY SINGLE TIME THE SCRIPT</span>
    <span class="comment">// CALLS ANY CLAUSE OR OT NATIVE FUNCTION.  Since technically this only needs to be verified before the</span>
    <span class="comment">// first call, and not for EVERY call during any of a script&#39;s runs, I should probably move this verification</span>
    <span class="comment">// higher, such as each time the OTCronItem triggers, plus each time a party triggers a clause directly</span>
    <span class="comment">// through the API (server message). As long as those are covered, I will be able to remove it from here</span>
    <span class="comment">// which should be a significant improvement for performance.</span>
    <span class="comment">// It will be at the bottom of those same functions that &quot;ClearTemporaryPointers()&quot; should finally be called.</span>
    <span class="comment">//</span>
    <span class="comment">// Also todo:  Need to implement MOVE CONSTRUCTORS and MOVE COPY CONSTRUCTORS all over the place,</span>
    <span class="comment">// once I&#39;m sure C++0x build environments are available for all of the various OT platforms. That should</span>
    <span class="comment">// be another great performance boost!</span>
    <span class="comment">//</span>
<span class="comment">//  const OTString strServerID(GetServerID());</span>
<span class="comment">//</span>
<span class="comment">//  mapOfNyms   map_Nyms_Already_Loaded;</span>
<span class="comment">//  this-&gt;RetrieveNymPointers(map_Nyms_Already_Loaded);</span>
<span class="comment">//</span>
<span class="comment">//  bool bVerifiedAuthorization =</span>
<span class="comment">//      this-&gt;VerifyPartyAuthorization(*pParty, *pServerNym, strServerID, &amp;map_Nyms_Already_Loaded);</span>
<span class="comment">//</span>
<span class="comment">//  if (!bVerifiedAuthorization)</span>
<span class="comment">//  {</span>
<span class="comment">//      OTLog::vOutput(0, &quot;OTScriptable::CanExecuteClause: Unable to verify authorization for party: %s\n&quot;,</span>
<span class="comment">//                     str_party_name.c_str());</span>
<span class="comment">//      return false;</span>
<span class="comment">//  }</span>

    <span class="comment">// NOTE (Above):  When it came time to compile, I realized that OTScriptable has no pointer to Cron,</span>
    <span class="comment">// nor access to any ServerNym (unless you pass it in).  But I want this function to work by merely</span>
    <span class="comment">// passing in 2 strings.</span>
    <span class="comment">//</span>
    <span class="comment">// SINCE THE PARTY IS VERIFIED ALREADY (WHEN THE SMART CONTRACT IS FIRST ACTIVATED) THEN THIS IS</span>
    <span class="comment">// REDUNDANT ANYWAY.</span>
    <span class="comment">//</span>
    <span class="comment">// IF you ever need to use CanExecuteClause() in some circumstance where the party has NOT been verified</span>
    <span class="comment">// anyway (it won&#39;t be from within some script...) then just call VerifyPartyAuthorization() yourself in</span>
    <span class="comment">// that code, wherever you need to.</span>

    <span class="comment">// *****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// DISALLOW parties to directly execute any clauses named similarly to callbacks, hooks, or cron hooks!</span>
    <span class="comment">// Only allow this for normal clauses.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (str_clause_name.compare(0,5,<span class="stringliteral">&quot;cron_&quot;</span>) == 0) <span class="comment">// todo stop hardcoding</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Parties may not directly trigger clauses beginning in cron_\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (str_clause_name.compare(0,5,<span class="stringliteral">&quot;hook_&quot;</span>) == 0) <span class="comment">// todo stop hardcoding</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Parties may not directly trigger clauses beginning in hook_\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (str_clause_name.compare(0,9,<span class="stringliteral">&quot;callback_&quot;</span>) == 0) <span class="comment">// todo stop hardcoding</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Parties may not directly trigger clauses beginning in callback_\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// *****************************************************************************</span>

    <span class="comment">// IF NO CALLBACK IS PROVIDED, The default answer to this function is:</span>
    <span class="comment">//     YES, this party MAY run this clause!</span>
    <span class="comment">//</span>
    <span class="comment">// But... first we check to see if this OTScriptable has a clause named:</span>
    <span class="comment">//          &quot;callback_party_may_execute_clause&quot;</span>
    <span class="comment">// ...and if so, we ask the CALLBACK to make the decision instead. This way, people can define</span>
    <span class="comment">// in their own scripts any rules they want about which parties may execute which clauses.</span>

    <span class="comment">//</span>
    <span class="keyword">const</span> std::string str_CallbackName(<a class="code" href="_o_t_scriptable_8cpp.html#a51efbadf8c28ca583639fbd6991a0fab">SCRIPTABLE_CALLBACK_PARTY_MAY_EXECUTE</a>);

    <a class="code" href="class_o_t_clause.html">OTClause</a> * pCallbackClause = this-&gt;<a class="code" href="class_o_t_scriptable.html#a390511c5b2f419453b1cc169ec576972">GetCallback</a>(str_CallbackName); <span class="comment">// See if there is a script clause registered for this callback.</span>

    <span class="keywordflow">if</span> (NULL != pCallbackClause) <span class="comment">// Found it!</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Found script for: %s. Asking...\n&quot;</span>,
                       <a class="code" href="_o_t_scriptable_8cpp.html#a51efbadf8c28ca583639fbd6991a0fab">SCRIPTABLE_CALLBACK_PARTY_MAY_EXECUTE</a>);

        <span class="comment">// The function we&#39;re IN defaults to TRUE, if there&#39;s no script available.</span>
        <span class="comment">// However, if the script is available, then our default return value starts as FALSE.</span>
        <span class="comment">// The script itself will then have to set it to true, if that&#39;s what it wants.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_variable.html">OTVariable</a> param1       (<span class="stringliteral">&quot;param_party_name&quot;</span>,  str_party_name,   <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);
        <a class="code" href="class_o_t_variable.html">OTVariable</a> param2       (<span class="stringliteral">&quot;param_clause_name&quot;</span>, str_clause_name,  <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);
        <span class="comment">// -------------------------------------------------------------</span>
        <a class="code" href="class_o_t_variable.html">OTVariable</a> theReturnVal (<span class="stringliteral">&quot;return_val&quot;</span>,        <span class="keyword">false</span>);
        <span class="comment">// -------------------------------------------------------------</span>
        <a class="code" href="_o_t_variable_8hpp.html#aa7620bdfc9f969dd2802c11c3260eb37">mapOfVariables</a> theParameters;
        theParameters.insert(std::pair&lt;std::string, OTVariable *&gt;(<span class="stringliteral">&quot;param_party_name&quot;</span>,  &amp;param1));
        theParameters.insert(std::pair&lt;std::string, OTVariable *&gt;(<span class="stringliteral">&quot;param_clause_name&quot;</span>, &amp;param2));

        <span class="comment">// ****************************************</span>

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == this-&gt;<a class="code" href="class_o_t_scriptable.html#a4a95506db44acbdd3b125f54cac3595a">ExecuteCallback</a>(*pCallbackClause, theParameters, theReturnVal)) <span class="comment">// &lt;============================================</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Error while running callback script %s, clause %s \n&quot;</span>,
                          <a class="code" href="_o_t_scriptable_8cpp.html#a51efbadf8c28ca583639fbd6991a0fab">SCRIPTABLE_CALLBACK_PARTY_MAY_EXECUTE</a>, str_clause_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Success executing callback script %s, clause: %s.\n\n&quot;</span>,
                           <a class="code" href="_o_t_scriptable_8cpp.html#a51efbadf8c28ca583639fbd6991a0fab">SCRIPTABLE_CALLBACK_PARTY_MAY_EXECUTE</a>, str_clause_name.c_str());

            <span class="keywordflow">return</span> theReturnVal.CopyValueBool();
        }
        <span class="comment">// ****************************************</span>
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::CanExecuteClause: Unable to find script for: %s. Therefore, default return value is: TRUE.\n&quot;</span>,
                       <a class="code" href="_o_t_scriptable_8cpp.html#a51efbadf8c28ca583639fbd6991a0fab">SCRIPTABLE_CALLBACK_PARTY_MAY_EXECUTE</a>);
    }
    <span class="comment">// *****************************************************************************</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab9a6cff853b9c71456eaf427caa3ab8b"></a><!-- doxytag: member="OTScriptable::ClearTemporaryPointers" ref="ab9a6cff853b9c71456eaf427caa3ab8b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#ab9a6cff853b9c71456eaf427caa3ab8b">OTScriptable::ClearTemporaryPointers</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00513">513</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa4735bf6c25261ea1a021fd8afb57916"></a><!-- doxytag: member="OTScriptable::Compare" ref="aa4735bf6c25261ea1a021fd8afb57916" args="(OTScriptable &amp;rhs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">OTScriptable::Compare</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_scriptable.html">OTScriptable</a> &amp;&#160;</td>
          <td class="paramname"><em>rhs</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a5b4a2b0e39d8aa534de380d92778bf0d">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02049">2049</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTScriptable::Compare&quot;</span>;
    <span class="comment">//</span>
    <span class="comment">// UPDATE: ALL of the parties should be there, in terms of their</span>
    <span class="comment">// names and account names --- but the actual IDs can remain blank,</span>
    <span class="comment">// and the signed copies can be blank. (Those things are all verified</span>
    <span class="comment">// elsewhere. That&#39;s about verifying the signature and authorization,</span>
    <span class="comment">// versus verifying the content.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">GetPartyCount</a>() != rhs.<a class="code" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">GetPartyCount</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: The number of parties does not match.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_scriptable.html#a8ceb875e6117eaa14fd02d84e15cb9b3">GetBylawCount</a>() != rhs.<a class="code" href="class_o_t_scriptable.html#a8ceb875e6117eaa14fd02d84e15cb9b3">GetBylawCount</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: The number of bylaws does not match.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <span class="keyword">const</span> std::string str_bylaw_name    = (*it).first;
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw                    = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// --------------------</span>

        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * p2 = rhs.<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(str_bylaw_name);

        <span class="keywordflow">if</span> (NULL == p2)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find bylaw %s on rhs.\n&quot;</span>, szFunc,
                           str_bylaw_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a2337bd8701517a3bf168ac345f9d201c">Compare</a>(*p2) )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Bylaws don&#39;t match: %s.\n&quot;</span>, szFunc,
                           str_bylaw_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// ----------------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <span class="keyword">const</span> std::string str_party_name    = (*it).first;
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty                    = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// --------------------</span>

        <a class="code" href="class_o_t_party.html">OTParty</a> * p2 = rhs.<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(str_party_name);

        <span class="keywordflow">if</span> (NULL == p2)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find party %s on rhs.\n&quot;</span>, szFunc,
                           str_party_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! pParty-&gt;<a class="code" href="class_o_t_party.html#aea38f73c2145bddc59c900fd887bfd4e">Compare</a>(*p2) )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Parties don&#39;t match: %s.\n&quot;</span>, szFunc,
                           str_party_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// ----------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a197539281206ac2e950ff0fc4842886b"></a><!-- doxytag: member="OTScriptable::ConfirmParty" ref="a197539281206ac2e950ff0fc4842886b" args="(OTParty &amp;theParty)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a197539281206ac2e950ff0fc4842886b">OTScriptable::ConfirmParty</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_party.html">OTParty</a> &amp;&#160;</td>
          <td class="paramname"><em>theParty</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a361ba96466948934e82da4b8be6bdc8a">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01883">1883</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> std::string str_party_name = theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>();

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_party_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::ConfirmParty:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------------</span>
    <span class="comment">// MAKE SURE ALL SIGNED COPIES ARE OF THE SAME CONTRACT.</span>
    <span class="comment">// Loop through ALL the parties. For whichever ones are already signed,</span>
    <span class="comment">// load up the signed copy and make sure it compares to the main one.</span>
    <span class="comment">// This is in order to make sure that I am signing the same thing that</span>
    <span class="comment">// everyone else signed, before I actually sign it.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#ae83de8305c791c41e58e888cb873def0">VerifyThisAgainstAllPartiesSignedCopies</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// This already logs on failure.</span>

    <span class="comment">// BY THIS POINT, we know that, of all the parties who have already signed,</span>
    <span class="comment">// their signed copies DO match this smart contract.</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Next, find the theoretical Party on this scriptable that matches the actual Party that</span>
    <span class="comment">// was passed in. (It should already be there.) If found, replace it with the one passed in.</span>
    <span class="comment">// Then sign the contract, save the signed version in the new party, and then sign again.</span>
    <span class="comment">//</span>
    <span class="comment">// If NOT found, then we failed. (For trying to confirm a non-existent party.)</span>
    <span class="comment">//</span>
    mapOfParties::iterator it_delete = <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.find(str_party_name);

    <span class="keywordflow">if</span> (it_delete != <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.end()) <span class="comment">// It was already there. (Good.)</span>
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it_delete).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -------------------------------</span>

        <span class="keywordflow">if</span> (!pParty-&gt;<a class="code" href="class_o_t_party.html#aea38f73c2145bddc59c900fd887bfd4e">Compare</a>(theParty)) <span class="comment">// Make sure my party compares to the one it&#39;s replacing...</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::ConfirmParty: Party (%s) doesn&#39;t match the one it&#39;s confirming.\n&quot;</span>,
                           str_party_name.c_str());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// else...</span>
        <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.erase(it_delete);  <span class="comment">// Remove the theoretical party from the map, so we can replace it with the real one.</span>
        <span class="keyword">delete</span> pParty; pParty=NULL;     <span class="comment">// Delete it, since I own it.</span>
        <span class="comment">// ------------------------</span>
        <span class="comment">// Careful:  This ** DOES ** TAKE OWNERSHIP!  theParty will get deleted when</span>
        <span class="comment">// this OTScriptable instance is.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.insert( std::pair&lt;std::string, OTParty *&gt;(str_party_name, &amp;theParty)) ;
        theParty.<a class="code" href="class_o_t_party.html#a41f870f87f27213da8f4c2996a3d0bf1">SetOwnerAgreement</a>(*<span class="keyword">this</span>); <span class="comment">// Now the actual party is in place, instead of a placekeeper version of it. There are actual Acct/Nym IDs now, etc.</span>
        <span class="comment">// ------------------------</span>

        <span class="comment">// Sign it and save it,</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strNewSignedCopy;
        this-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
        <span class="keywordtype">bool</span> bSuccess = theParty.<a class="code" href="class_o_t_party.html#a4b078e0267983b8da083264f504489e1">SignContract</a>(*<span class="keyword">this</span>);
        <span class="keywordflow">if</span> (bSuccess)
        {
            this-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            this-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strNewSignedCopy);
            <span class="comment">// -----------------------</span>
            <span class="comment">// then save a copy of it inside theParty,</span>
            <span class="comment">//</span>
            theParty.<a class="code" href="class_o_t_party.html#a4a5ec299bde05422462ddcb0a66495d4">SetMySignedCopy</a>(strNewSignedCopy);

            <span class="comment">// -----------------------</span>
            <span class="comment">// then sign the overall thing again, so that signed copy (now inside theParty) will be properly saved.</span>
            <span class="comment">// That way when other people verify my signature, it will be there for them to verify.</span>
            <span class="comment">//</span>
            this-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            theParty.<a class="code" href="class_o_t_party.html#a4b078e0267983b8da083264f504489e1">SignContract</a>(*<span class="keyword">this</span>);
            this-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }

        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::ConfirmParty: Failed attempt to confirm non-existent party: %s \n &quot;</span>,
                      str_party_name.c_str());
    <span class="comment">// ----------------------------------------</span>

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4a95506db44acbdd3b125f54cac3595a"></a><!-- doxytag: member="OTScriptable::ExecuteCallback" ref="a4a95506db44acbdd3b125f54cac3595a" args="(OTClause &amp;theCallbackClause, mapOfVariables &amp;theParameters, OTVariable &amp;varReturnVal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a4a95506db44acbdd3b125f54cac3595a">OTScriptable::ExecuteCallback</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_clause.html">OTClause</a> &amp;&#160;</td>
          <td class="paramname"><em>theCallbackClause</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_variable_8hpp.html#aa7620bdfc9f969dd2802c11c3260eb37">mapOfVariables</a> &amp;&#160;</td>
          <td class="paramname"><em>theParameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_variable.html">OTVariable</a> &amp;&#160;</td>
          <td class="paramname"><em>varReturnVal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00525">525</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> std::string str_clause_name   = theCallbackClause.<a class="code" href="class_o_t_clause.html#a325b3cfeedbfc1c699de3d0f787e5120">GetName</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ?
                                            theCallbackClause.<a class="code" href="class_o_t_clause.html#a325b3cfeedbfc1c699de3d0f787e5120">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() : <span class="stringliteral">&quot;&quot;</span>;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(<a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_clause_name));

    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = theCallbackClause.<a class="code" href="class_o_t_clause.html#adcfc1603deba61e670b5d1374147bd6a">GetBylaw</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// By this point, we have the clause we are executing as theCallbackClause,</span>
    <span class="comment">// and we have the Bylaw it belongs to, as pBylaw.</span>
    <span class="comment">// ----------------------------------------</span>

    <span class="keyword">const</span> std::string str_code      =   theCallbackClause.<a class="code" href="class_o_t_clause.html#a29dced05f7ab1026ef191dbc013dddd6">GetCode</a>();    <span class="comment">// source code for the script.</span>
    <span class="keyword">const</span> std::string str_language  =   pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a9227cd44b9e3bab6efdf0dcb719e126c">GetLanguage</a>();          <span class="comment">// language it&#39;s in. (Default is &quot;chai&quot;)</span>

    _SharedPtr&lt;OTScript&gt; pScript = <a class="code" href="_o_t_script_8hpp.html#af97c0dd6a02e33a9ff1c837a6d006b88">OTScriptFactory</a>(str_language, str_code);

    <span class="comment">// ---------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// SET UP THE NATIVE CALLS, REGISTER THE PARTIES, REGISTER THE VARIABLES, AND EXECUTE THE SCRIPT.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pScript)
    {
        <span class="comment">// Register the special server-side native OT calls we make available to all scripts.</span>
        <span class="comment">//</span>
        this-&gt;<a class="code" href="class_o_t_scriptable.html#ad469b542209e1c73905d2094bb561793">RegisterOTNativeCallsWithScript</a>(*pScript);

        <span class="comment">// ---------------------------------------</span>
        <span class="comment">// Register all the parties with the script.</span>
        <span class="comment">//</span>
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
        {
            <span class="keyword">const</span> std::string str_party_name    = (*it).first;
            <a class="code" href="class_o_t_party.html">OTParty</a> * pParty                    = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((NULL != pParty) &amp;&amp; (str_party_name.size() &gt; 0));
            <span class="comment">// -----------------------</span>

            pScript-&gt;AddParty(str_party_name, *pParty);
        }
        <span class="comment">// ---------------------------------------</span>
        <span class="comment">// Add the parameters...</span>
        <span class="comment">//</span>
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_variable_8hpp.html#aa7620bdfc9f969dd2802c11c3260eb37">mapOfVariables</a>, theParameters)
        {
            <span class="keyword">const</span> std::string str_var_name  = (*it).first;
            <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar               = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((NULL != pVar)&amp;&amp;(str_var_name.size() &gt; 0));
            <span class="comment">// ---------------------------------------------------</span>
            pVar-&gt;<a class="code" href="class_o_t_variable.html#a89944d26c87080bbc6aab0ff3fe26de5">RegisterForExecution</a>(*pScript);
        }

        <span class="comment">// ---------------------------------------</span>
        <span class="comment">// Also need to loop through the Variables on pBylaw and register those as well.</span>
        <span class="comment">//</span>
        pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#aa9a5296f71c28edb48988fe0a8b4bf65">RegisterVariablesForExecution</a>(*pScript); <span class="comment">// This sets all the variables as CLEAN so we can check for dirtiness after execution.</span>
        <span class="comment">//</span>
        <span class="comment">// ****************************************</span>

        this-&gt;<a class="code" href="class_o_t_scriptable.html#a7590c450a8a079eb388fd4fc378b3b40">SetDisplayLabel</a>(&amp;str_clause_name);

        pScript-&gt;SetDisplayFilename(<a class="code" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">m_strLabel</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pScript-&gt;ExecuteScript(&amp;varReturnVal))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::ExecuteCallback: Error while running callback on scriptable: %s\n&quot;</span>,
                         <a class="code" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">m_strLabel</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::ExecuteCallback: Successfully executed callback on scriptable: %s\n\n&quot;</span>,
                           <a class="code" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">m_strLabel</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }
    <span class="comment">// ---------------------------------------------------------------</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::ExecuteCallback: Error instantiating script!\n&quot;</span>);
    }

    <span class="comment">// ***************************************************************</span>

    <span class="comment">// NOTE: Normally after calling a script, you want to check to see if any of the persistent variables</span>
    <span class="comment">// are dirty, and if important, send a notice to the parties, save an updated copy of the contract, etc.</span>
    <span class="comment">// WE DON&#39;T DO THAT FOR CALLBACKS!  Why not?</span>
    <span class="comment">//</span>
    <span class="comment">// 1) It only matters if the variables change, if you are actually saving an updated version of the contract.</span>
    <span class="comment">//    (Which is more OTCronItem / OTSmartContract, which saves an updated copy of itself.) Whereas if you are</span>
    <span class="comment">//    NOT saving the contract with those variables in it, then why the hell would you care to notify people?</span>
    <span class="comment">// 2) Since only OTCronItem / OTSmartContract actually save updated copies of themselves, they are the only ones</span>
    <span class="comment">//    who will ever need to notify anyone. Not EVERY OTScriptable-derived class will send notifications, but if they</span>
    <span class="comment">//    need to, SendNoticeToAllParties() is already available on OTScriptable.</span>
    <span class="comment">//</span>
    <span class="comment">// 3) MOST IMPORTANTLY: the only time a callback is currently triggered is when the script has already been activated</span>
    <span class="comment">//    somehow, and the only places that do that ALREADY SEND NOTICES WHEN DIRTY. In fact, if a callback actually makes</span>
    <span class="comment">//    the scriptable dirty, IT WILL SEND NOTICES ANYWAY, since the &quot;ExecuteClauses()&quot; function that CALLED the callback</span>
    <span class="comment">//    is also smart enough to send the notices already.</span>
    <span class="comment">//</span>

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adf3ca54a95c8813c23cf7bdc23e4330a"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnAccount" ref="adf3ca54a95c8813c23cf7bdc23e4330a" args="(OTAccount &amp;theAccount, OTPartyAccount **ppPartyAccount=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#adf3ca54a95c8813c23cf7bdc23e4330a">OTScriptable::FindPartyBasedOnAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_account.html">OTAccount</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> **&#160;</td>
          <td class="paramname"><em>ppPartyAccount</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00916">916</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#ad586d25e956e0925e58e39879688a8e9">HasAccount</a>(theAccount, ppPartyAccount))
        {
            <span class="keywordflow">return</span> pParty;
        }
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a425a20fba9d2a800e1d6a029186094"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnAccountID" ref="a7a425a20fba9d2a800e1d6a029186094" args="(const OTIdentifier &amp;theAcctID, OTPartyAccount **ppPartyAccount=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#a7a425a20fba9d2a800e1d6a029186094">OTScriptable::FindPartyBasedOnAccountID</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> **&#160;</td>
          <td class="paramname"><em>ppPartyAccount</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00869">869</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#a1bf782a97edb882ba9ace729ed74e22d">HasAccountByID</a>(theAcctID, ppPartyAccount))
        {
            <span class="keywordflow">return</span> pParty;
        }
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa89029542587094cd2844cb8bf7a9a16"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnNymAsAgent" ref="aa89029542587094cd2844cb8bf7a9a16" args="(OTPseudonym &amp;theNym, OTAgent **ppAgent=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#aa89029542587094cd2844cb8bf7a9a16">OTScriptable::FindPartyBasedOnNymAsAgent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_agent.html">OTAgent</a> **&#160;</td>
          <td class="paramname"><em>ppAgent</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00886">886</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#afda73de60d222bc8c01b893289a4564e">HasAgent</a>(theNym, ppAgent))
            <span class="keywordflow">return</span> pParty;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08ff87b0f54ed3139bfcfb362a757778"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnNymAsAuthAgent" ref="a08ff87b0f54ed3139bfcfb362a757778" args="(OTPseudonym &amp;theNym, OTAgent **ppAgent=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#a08ff87b0f54ed3139bfcfb362a757778">OTScriptable::FindPartyBasedOnNymAsAuthAgent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_agent.html">OTAgent</a> **&#160;</td>
          <td class="paramname"><em>ppAgent</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00901">901</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#aa34fe1901531ed5056633b99fade0f93">HasAuthorizingAgent</a>(theNym, ppAgent))
            <span class="keywordflow">return</span> pParty;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af0eddbe4b88394bcc113d9333d8e0a97"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnNymIDAsAgent" ref="af0eddbe4b88394bcc113d9333d8e0a97" args="(const OTIdentifier &amp;theNymID, OTAgent **ppAgent=NULL) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#af0eddbe4b88394bcc113d9333d8e0a97">OTScriptable::FindPartyBasedOnNymIDAsAgent</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_agent.html">OTAgent</a> **&#160;</td>
          <td class="paramname"><em>ppAgent</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00839">839</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#a6d8f917d33c9c49c6425add0b041e4ee">HasAgentByNymID</a>(theNymID, ppAgent))
            <span class="keywordflow">return</span> pParty;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5853814d252a72a7d5c7d63f04c3cae2"></a><!-- doxytag: member="OTScriptable::FindPartyBasedOnNymIDAsAuthAgent" ref="a5853814d252a72a7d5c7d63f04c3cae2" args="(const OTIdentifier &amp;theNymID, OTAgent **ppAgent=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#a5853814d252a72a7d5c7d63f04c3cae2">OTScriptable::FindPartyBasedOnNymIDAsAuthAgent</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theNymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_agent.html">OTAgent</a> **&#160;</td>
          <td class="paramname"><em>ppAgent</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00854">854</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#a649744ad680735efc8f3670c0b4294fc">HasAuthorizingAgentByNymID</a>(theNymID, ppAgent))
            <span class="keywordflow">return</span> pParty;
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8f8c32df22c81d1a5aec3e483089b923"></a><!-- doxytag: member="OTScriptable::GetAgent" ref="a8f8c32df22c81d1a5aec3e483089b923" args="(const std::string str_agent_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_agent.html">OTAgent</a> * <a class="el" href="class_o_t_scriptable.html#a8f8c32df22c81d1a5aec3e483089b923">OTScriptable::GetAgent</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_agent_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01697">1697</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_agent_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: invalid name.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -------------------------</span>
        <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = pParty-&gt;<a class="code" href="class_o_t_party.html#af959cf9f0815a145c5a3072eadfaeb14">GetAgent</a>(str_agent_name);

        <span class="keywordflow">if</span> (NULL != pAgent) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pAgent;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a970014fa028541c7a3c908800bfa4ee9"></a><!-- doxytag: member="OTScriptable::GetBylaw" ref="a970014fa028541c7a3c908800bfa4ee9" args="(const std::string str_bylaw_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_bylaw.html">OTBylaw</a> * <a class="el" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">OTScriptable::GetBylaw</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_bylaw_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01720">1720</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_bylaw_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: invalid name.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------------</span>
    mapOfBylaws::iterator iii = <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.find(str_bylaw_name);

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.end() == iii) <span class="comment">// Did NOT find it.</span>
    {
        <span class="comment">// People call this function sometimes just to SEE if one is there.</span>
        <span class="comment">// So it&#39;s not an error if it&#39;s not there...</span>
        <span class="comment">//</span>
<span class="comment">//      OTLog::vOutput(0, &quot;OTScriptable::GetBylaw: Strange: bylaw not found: %s. Bylaw count is: %d \n&quot;,</span>
<span class="comment">//                     str_bylaw_name.c_str(), m_mapBylaws.size());</span>
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ----------------------------------------</span>
    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*iii).second;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);

    <span class="keywordflow">return</span> pBylaw;
}
</pre></div>
</div>
</div>
<a class="anchor" id="addfadf16de3cfbb972ec73e097a8dc81"></a><!-- doxytag: member="OTScriptable::GetBylawByIndex" ref="addfadf16de3cfbb972ec73e097a8dc81" args="(int32_t nIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_bylaw.html">OTBylaw</a> * <a class="el" href="class_o_t_scriptable.html#addfadf16de3cfbb972ec73e097a8dc81">OTScriptable::GetBylawByIndex</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01801">1801</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.size())))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Index out of bounds: %d\n&quot;</span>, __FUNCTION__, nIndex);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// --------------------------</span>
        int32_t nLoopIndex = -1; <span class="comment">// will be 0 on first iteration.</span>

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
        {
            <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
            <span class="comment">// ----------------------------</span>
            ++nLoopIndex; <span class="comment">// 0 on first iteration.</span>

            <span class="keywordflow">if</span> (nLoopIndex == nIndex)
                <span class="keywordflow">return</span> pBylaw;
        } <span class="comment">// FOR_EACH</span>
        <span class="comment">// --------------------------</span>
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ceb875e6117eaa14fd02d84e15cb9b3"></a><!-- doxytag: member="OTScriptable::GetBylawCount" ref="a8ceb875e6117eaa14fd02d84e15cb9b3" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_scriptable.html#a8ceb875e6117eaa14fd02d84e15cb9b3">OTScriptable::GetBylawCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00209">209</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.size()); }
</pre></div>
</div>
</div>
<a class="anchor" id="a390511c5b2f419453b1cc169ec576972"></a><!-- doxytag: member="OTScriptable::GetCallback" ref="a390511c5b2f419453b1cc169ec576972" args="(const std::string str_CallbackName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_clause.html">OTClause</a> * <a class="el" href="class_o_t_scriptable.html#a390511c5b2f419453b1cc169ec576972">OTScriptable::GetCallback</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_CallbackName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03056">3056</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_CallbackName)) ||
        (str_CallbackName.compare(0,9,<span class="stringliteral">&quot;callback_&quot;</span>) != 0)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::GetCallback:  Error: invalid name: %s\n&quot;</span>, str_CallbackName.c_str());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -------------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// -------------------------</span>

        <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ab1c6c33a33817e60be48e70ce862e898">GetCallback</a>(str_CallbackName);

        <span class="keywordflow">if</span> (NULL != pClause) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pClause;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abe36809472a1b7adf66b303ea176888e"></a><!-- doxytag: member="OTScriptable::GetClause" ref="abe36809472a1b7adf66b303ea176888e" args="(const std::string str_clause_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_clause.html">OTClause</a> * <a class="el" href="class_o_t_scriptable.html#abe36809472a1b7adf66b303ea176888e">OTScriptable::GetClause</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_clause_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01674">1674</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_clause_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: invalid name.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// -------------------------</span>
        <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a95b30b2c0f6e2944bb3061e0044f48f5">GetClause</a>(str_clause_name);

        <span class="keywordflow">if</span> (NULL != pClause) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pClause;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2c2d74c762a93dd62bedfe1235de3bce"></a><!-- doxytag: member="OTScriptable::GetCountTransNumsNeededForAgent" ref="a2c2d74c762a93dd62bedfe1235de3bce" args="(const std::string str_agent_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_scriptable.html#a2c2d74c762a93dd62bedfe1235de3bce">OTScriptable::GetCountTransNumsNeededForAgent</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_agent_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00749">749</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nReturnVal = 0;

    <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = this-&gt;<a class="code" href="class_o_t_scriptable.html#a8f8c32df22c81d1a5aec3e483089b923">GetAgent</a>(str_agent_name);
    <span class="keywordflow">if</span> (NULL == pAgent)
        <span class="keywordflow">return</span> nReturnVal;  <span class="comment">// (Looks like there is no agent with that name.)</span>

    <span class="comment">// Below this point, pAgent is good, meaning str_agent_name really IS</span>
    <span class="comment">// a legit agent for this party. But that doesn&#39;t necessarily mean the</span>
    <span class="comment">// agent has to supply any opening or closing transaction #s for this</span>
    <span class="comment">// smart contract. That&#39;s only true if he&#39;s the AUTHORIZING agent for</span>
    <span class="comment">// the party (for the opening num) or the authorized agent for any of</span>
    <span class="comment">// party&#39;s accounts (for the closing number).  So let&#39;s add it up...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pAgent-&gt;<a class="code" href="class_o_t_agent.html#a4fd83cc610c9c64e1e3dd043b050a81a">IsAuthorizingAgentForParty</a>())   <span class="comment">// true/false whether THIS agent is the authorizing agent for his party.</span>
        nReturnVal++;

    <span class="comment">// Add the number of accounts, owned by this agent&#39;s party, that this agent is the authorized agent FOR.</span>
    <span class="comment">//</span>
    nReturnVal += pAgent-&gt;<a class="code" href="class_o_t_agent.html#a3bb37db7c624b498462ca875783d9f50">GetCountAuthorizedAccts</a>();

    <span class="keywordflow">return</span> nReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a298d8fdb0982df3c36e8ae194f228009"></a><!-- doxytag: member="OTScriptable::GetHooks" ref="a298d8fdb0982df3c36e8ae194f228009" args="(const std::string str_HookName, mapOfClauses &amp;theResults)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a298d8fdb0982df3c36e8ae194f228009">OTScriptable::GetHooks</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_HookName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_clause_8hpp.html#a40c16432fa9c16826c026b74351425ad">mapOfClauses</a> &amp;&#160;</td>
          <td class="paramname"><em>theResults</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03083">3083</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (
        (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_HookName))
        ||
        ((str_HookName.compare(0,5,<span class="stringliteral">&quot;cron_&quot;</span>) != 0) &amp;&amp; (str_HookName.compare(0,5,<span class="stringliteral">&quot;hook_&quot;</span>) != 0))
       ) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::GetHooks:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------</span>
    <span class="keywordtype">bool</span> bReturnVal = <span class="keyword">false</span>;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// -------------------------</span>

        <span class="comment">// Look up all clauses matching a specific hook.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ac43e007f0a64ca7c09853340c8a3aab1">GetHooks</a>(str_HookName, theResults))
            bReturnVal = <span class="keyword">true</span>;
    }

    <span class="keywordflow">return</span> bReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acd0f8e884ed00f1d082fa498323d8894"></a><!-- doxytag: member="OTScriptable::GetParty" ref="acd0f8e884ed00f1d082fa498323d8894" args="(const std::string str_party_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">OTScriptable::GetParty</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_party_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01747">1747</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_party_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: invalid name.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -----------------------------------------------------------</span>
    mapOfParties::iterator it = <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.find(str_party_name);

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.end() == it) <span class="comment">// Did NOT find it.</span>
    {
        <span class="comment">// GetParty() is often called to SEE if a party is there.</span>
        <span class="comment">// (So if the party ain&#39;t there, it&#39;s not necessarily an error.)</span>
        <span class="comment">//</span>
<span class="comment">//      OTLog::vOutput(0, &quot;OTScriptable::GetParty: Strange: party not found: %s\n&quot;,</span>
<span class="comment">//                     str_party_name.c_str());</span>
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ----------------------------------------</span>
    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);

    <span class="keywordflow">return</span> pParty;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a94c9e55f78357e04e4b9781ab662370f"></a><!-- doxytag: member="OTScriptable::GetPartyAccount" ref="a94c9e55f78357e04e4b9781ab662370f" args="(const std::string str_acct_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> * <a class="el" href="class_o_t_scriptable.html#a94c9e55f78357e04e4b9781ab662370f">OTScriptable::GetPartyAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_acct_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00775">775</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_acct_name)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::GetPartyAccount:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ----------------------------------------</span>

<span class="comment">//  OTLog::vError(&quot;DEBUGGING OTScriptable::GetPartyAccount: above loop. str_acct_name: %s \n&quot;, str_acct_name.c_str());</span>

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -------------------------</span>

<span class="comment">//      OTLog::vError(&quot;DEBUGGING OTScriptable::GetPartyAccount: loop iteration. party name: %s \n&quot;, pParty-&gt;GetPartyName().c_str());</span>

        <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#aee3973dc05c042dab571781a9d454af2">GetAccount</a>(str_acct_name);

        <span class="keywordflow">if</span> (NULL != pAcct) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pAcct;
    }

<span class="comment">//  OTLog::Error(&quot;DEBUGGING OTScriptable::GetPartyAccount: below loop \n&quot;);</span>

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae4abf1800fd193dc93835b777f40019c"></a><!-- doxytag: member="OTScriptable::GetPartyAccountByID" ref="ae4abf1800fd193dc93835b777f40019c" args="(const OTIdentifier &amp;theAcctID) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> * <a class="el" href="class_o_t_scriptable.html#ae4abf1800fd193dc93835b777f40019c">OTScriptable::GetPartyAccountByID</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00806">806</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -------------------------</span>

        <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#a31c08f0f4902dd79db4786d10f2fe81e">GetAccountByID</a>(theAcctID);

        <span class="keywordflow">if</span> (NULL != pAcct) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pAcct;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4be857ffbe603f75f1dc5550ed4c20e9"></a><!-- doxytag: member="OTScriptable::GetPartyByIndex" ref="a4be857ffbe603f75f1dc5550ed4c20e9" args="(int32_t nIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_party.html">OTParty</a> * <a class="el" href="class_o_t_scriptable.html#a4be857ffbe603f75f1dc5550ed4c20e9">OTScriptable::GetPartyByIndex</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01774">1774</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size())))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Index out of bounds: %d\n&quot;</span>, __FUNCTION__, nIndex);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// --------------------------</span>
        int32_t nLoopIndex = -1; <span class="comment">// will be 0 on first iteration.</span>

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
        {
            <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
            <span class="comment">// ----------------------------</span>
            ++nLoopIndex; <span class="comment">// 0 on first iteration.</span>

            <span class="keywordflow">if</span> (nLoopIndex == nIndex)
                <span class="keywordflow">return</span> pParty;
        } <span class="comment">// FOR_EACH</span>
        <span class="comment">// --------------------------</span>
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a862b70e3515a874a4fed101ad4af1a50"></a><!-- doxytag: member="OTScriptable::GetPartyCount" ref="a862b70e3515a874a4fed101ad4af1a50" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">OTScriptable::GetPartyCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00208">208</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size()); }
</pre></div>
</div>
</div>
<a class="anchor" id="aebf4ace228231ac6aa8395fe56a5271c"></a><!-- doxytag: member="OTScriptable::GetTime" ref="aebf4ace228231ac6aa8395fe56a5271c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="class_o_t_scriptable.html#aebf4ace228231ac6aa8395fe56a5271c">OTScriptable::GetTime</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00311">311</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  CURRENT_TIME = <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>();
    <span class="keyword">const</span> int64_t   lTime = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(CURRENT_TIME);
    <span class="comment">// ----------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strTime;
    strTime.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld&quot;</span>, lTime);
    <span class="keywordflow">return</span>  strTime.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3f72637feb6a94088d8a576e29cc6a29"></a><!-- doxytag: member="OTScriptable::GetVariable" ref="a3f72637feb6a94088d8a576e29cc6a29" args="(const std::string str_VarName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_variable.html">OTVariable</a> * <a class="el" href="class_o_t_scriptable.html#a3f72637feb6a94088d8a576e29cc6a29">OTScriptable::GetVariable</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_VarName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03029">3029</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(str_VarName)) <span class="comment">// this logs, FYI.</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::GetVariable:  Error: invalid name.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// -------------------------------------</span>

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// -------------------------</span>

        <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#aae26ff96d920fcc17ef69e9f0c762710">GetVariable</a>(str_VarName);

        <span class="keywordflow">if</span> (NULL != pVar) <span class="comment">// found it.</span>
            <span class="keywordflow">return</span> pVar;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4a89cbc1abd2bac0e5dec64da3452b7a"></a><!-- doxytag: member="OTScriptable::InstantiateScriptable" ref="a4a89cbc1abd2bac0e5dec64da3452b7a" args="(const OTString &amp;strInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_scriptable.html">OTScriptable</a> * <a class="el" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strInput</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00176">176</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[45] = <span class="stringliteral">&quot;&quot;</span>;
    <span class="comment">// ---------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == strInput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: Input string is empty.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strContract(strInput);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == strContract.DecodeIfArmored(<span class="keyword">false</span>)) <span class="comment">// bEscapedIsAllowed=true by default.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Input string apparently was encoded and then failed decoding. Contents: \n%s\n&quot;</span>,
                      __FUNCTION__, strInput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ------------------------------------------</span>
    <span class="comment">// At this point, strContract contains the actual contents, whether they</span>
    <span class="comment">// were originally ascii-armored OR NOT. (And they are also now trimmed, either way.)</span>
    <span class="comment">//</span>
    strContract.reset(); <span class="comment">// for sgets</span>
    buf[0] = 0; <span class="comment">// probably unnecessary.</span>
    <span class="keywordtype">bool</span> bGotLine = strContract.sgets(buf, 40);

    <span class="keywordflow">if</span> (!bGotLine)
        <span class="keywordflow">return</span> NULL;
    <span class="comment">// --------------------------------</span>
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pItem = NULL;

    <a class="code" href="class_o_t_string.html">OTString</a> strFirstLine(buf);
    strContract.reset(); <span class="comment">// set the &quot;file&quot; pointer within this string back to index 0.</span>

    <span class="comment">// Now I feel pretty safe -- the string I&#39;m examining is within</span>
    <span class="comment">// the first 45 characters of the beginning of the contract, and</span>
    <span class="comment">// it will NOT contain the escape &quot;- &quot; sequence. From there, if</span>
    <span class="comment">// it contains the proper sequence, I will instantiate that type.</span>
    <span class="keywordflow">if</span> (!strFirstLine.Exists() || strFirstLine.Contains(<span class="stringliteral">&quot;- -&quot;</span>))
        <span class="keywordflow">return</span> NULL;

    <span class="comment">// There are actually two factories that load smart contracts. See OTCronItem.</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strFirstLine.Contains(<span class="stringliteral">&quot;-----BEGIN SIGNED SMARTCONTRACT-----&quot;</span>))  <span class="comment">// this string is 36 chars long.</span>
    {   pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a>();  <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem); }

    <span class="comment">// Coming soon.</span>
<span class="comment">//  else if (strFirstLine.Contains(&quot;-----BEGIN SIGNED ENTITY-----&quot;))  // this string is 29 chars long.</span>
<span class="comment">//  {   pItem = new OTEntity();         OT_ASSERT(NULL != pItem); }</span>

    <span class="comment">// The string didn&#39;t match any of the options in the factory.</span>
    <span class="keywordflow">if</span> (NULL == pItem)
        <span class="keywordflow">return</span> NULL;

    <span class="comment">// Does the contract successfully load from the string passed in?</span>
    <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strContract))
        <span class="keywordflow">return</span> pItem;
    <span class="keywordflow">else</span>
        <span class="keyword">delete</span> pItem;


    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3855f5a3f2ae738c6a39674f4d621ed5"></a><!-- doxytag: member="OTScriptable::IsDirty" ref="a3855f5a3f2ae738c6a39674f4d621ed5" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a3855f5a3f2ae738c6a39674f4d621ed5">OTScriptable::IsDirty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00682">682</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bIsDirty = <span class="keyword">false</span>;

    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// ---------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#af44456e72cb29dce8374aa5ea37b6540">IsDirty</a>())
        {
            bIsDirty = <span class="keyword">true</span>;
            <span class="keywordflow">break</span>;
        }
    }

    <span class="keywordflow">return</span> bIsDirty;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9f08ba14dc0e384301b8b69947243581"></a><!-- doxytag: member="OTScriptable::IsDirtyImportant" ref="a9f08ba14dc0e384301b8b69947243581" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a9f08ba14dc0e384301b8b69947243581">OTScriptable::IsDirtyImportant</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00705">705</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bIsDirty = <span class="keyword">false</span>;

    <a class="code" href="_o_t_storage_8hpp.html#a804eb881e96b7e1846d130a55a94f716">FOR_EACH_CONST</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// ---------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a8e755847cfb04617fb6395cbdc16e2c2">IsDirtyImportant</a>())
        {
            bIsDirty = <span class="keyword">true</span>;
            <span class="keywordflow">break</span>;
        }
    }

    <span class="keywordflow">return</span> bIsDirty;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2fe2dd55c1bb910e895c05a6924d08f4"></a><!-- doxytag: member="OTScriptable::ProcessXMLNode" ref="a2fe2dd55c1bb910e895c05a6924d08f4" args="(irr::io::IrrXMLReader *&amp;xml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_scriptable.html#a2fe2dd55c1bb910e895c05a6924d08f4">OTScriptable::ProcessXMLNode</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a48611c37c8e8e7d9125238bda2b77978">OTContract</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a8524c56a7469d39a895bed4b18671972">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#aba122af21b536d24bfb178074f843ff5">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#af1c7a24817b3367f2c76c9867effd557">OTPaymentPlan</a>, <a class="el" href="class_o_t_cron_item.html#a6b7eec23353a8ed49ee40a742c391aa3">OTCronItem</a>, <a class="el" href="class_o_t_trade.html#ab62bbaf94b2df5b01c52d988e023ae8b">OTTrade</a>, <a class="el" href="class_o_t_offer.html#aaa64f53ea2b3d1a54f2aa97fe9e09240">OTOffer</a>, <a class="el" href="class_o_t_token.html#a1f672677602d84c0b435eeb960bd6107">OTToken</a>, <a class="el" href="class_o_t_trackable.html#ad980c2ad5e97ff6f536dc296a3572e8f">OTTrackable</a>, <a class="el" href="class_o_t_instrument.html#a7c81b5fa331d2020d41b6da686a0033a">OTInstrument</a>, and <a class="el" href="class_o_t_cheque.html#a8e1ff8823e7def4ed309c22519125b29">OTCheque</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02197">2197</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTScriptable::ProcessXMLNode&quot;</span>;


    int32_t nReturnVal = 0; <span class="comment">// Unless/until I want to add OTContract::Compare(), then people would be able to surreptitiously insert keys and</span>
<span class="comment">//  int32_t nReturnVal = ot_super::ProcessXMLNode(xml); // conditions, and entities, that passed OTScriptable::Compare() with flying colors</span>
<span class="comment">//  even though they didn&#39;t really match. Therefore, here I explicitly disallow loading those things.</span>

    <span class="comment">// Here we call the parent class first.</span>
    <span class="comment">// If the node is found there, or there is some error,</span>
    <span class="comment">// then we just return either way.  But if it comes back</span>
    <span class="comment">// as &#39;0&#39;, then nothing happened, and we&#39;ll continue executing.</span>
    <span class="comment">//</span>
    <span class="comment">// -- Note: you can choose not to call the parent, if</span>
    <span class="comment">// you don&#39;t want to use any of those xml tags.</span>

<span class="comment">//  if (nReturnVal == 1 || nReturnVal == (-1))</span>
<span class="comment">//      return nReturnVal;</span>

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNodeName(xml-&gt;getNodeName());


<span class="comment">//    OTLog::vError(&quot;OTScriptable::ProcessXMLNode:  strNodeName: %s \n&quot;, strNodeName.Get());</span>


    <span class="keywordflow">if</span> (strNodeName.Compare(<span class="stringliteral">&quot;scriptableContract&quot;</span>))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strSpecify1  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;specifyAssetID&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strSpecify2  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;specifyParties&quot;</span>);

        <a class="code" href="class_o_t_string.html">OTString</a> strNumParties      = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numParties&quot;</span>);
        <a class="code" href="class_o_t_string.html">OTString</a> strNumBylaws       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numBylaws&quot;</span>);

        <span class="comment">// ---------------------------------------</span>
        <span class="comment">// These determine whether asset IDs and/or party owner IDs</span>
        <span class="comment">// are used on the template for any given smart contract.</span>
        <span class="comment">// (Some templates are specific to certain asset types, while</span>
        <span class="comment">// other smart contract types allow you to leave asset ID blank</span>
        <span class="comment">// until the confirmation phase.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (strSpecify1.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>))
            <a class="code" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a> = <span class="keyword">true</span>;
        <span class="keywordflow">if</span> (strSpecify2.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>))
            <a class="code" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">m_bSpecifyParties</a> = <span class="keyword">true</span>;

        <span class="comment">// -----------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// Load up the Parties.</span>
        <span class="comment">//</span>
        int32_t nPartyCount = strNumParties.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumParties.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
        <span class="keywordflow">if</span> (nPartyCount &gt; 0)
        {
            <span class="keywordflow">while</span> (nPartyCount-- &gt; 0)
            {
<span class="comment">//              xml-&gt;read(); // &lt;==================</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected element for party. \n&quot;</span>, szFunc);
                    <span class="keywordflow">return</span> (-1);
                }
                <span class="comment">// -----------------------------------------------</span>

<span class="comment">//                OTLog::vOutput(0, &quot;%s: Looping to load parties: currently on: %s \n&quot;, szFunc, xml-&gt;getNodeName());</span>

                <span class="keywordflow">if</span> ((!strcmp(<span class="stringliteral">&quot;party&quot;</span>, xml-&gt;getNodeName())))
                {
                    <a class="code" href="class_o_t_string.html">OTString</a> strName            = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Party name (in script code)</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strOwnerType       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;ownerType&quot;</span>); <span class="comment">// &quot;nym&quot; or &quot;entity&quot;</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strOwnerID         = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;ownerID&quot;</span>); <span class="comment">// Nym or Entity ID. todo security probably make these separate variables.</span>

                    <a class="code" href="class_o_t_string.html">OTString</a> strOpeningTransNo  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;openingTransNo&quot;</span>); <span class="comment">// the closing #s are on the asset accounts.</span>

                    <a class="code" href="class_o_t_string.html">OTString</a> strAuthAgent       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;authorizingAgent&quot;</span>); <span class="comment">// When an agent activates this contract, it&#39;s HIS opening trans# that&#39;s used.</span>

                    <a class="code" href="class_o_t_string.html">OTString</a> strNumAgents       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numAgents&quot;</span>); <span class="comment">// number of agents on this party.</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strNumAccounts     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numAccounts&quot;</span>); <span class="comment">// number of accounts for this party.</span>

                    <a class="code" href="class_o_t_string.html">OTString</a> strIsCopyProvided  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;signedCopyProvided&quot;</span>);

                    <span class="comment">// ----------------------------------</span>
                    <span class="keywordtype">bool</span> bIsCopyProvided = <span class="keyword">false</span>; <span class="comment">// default</span>

                    <span class="keywordflow">if</span> (strIsCopyProvided.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>))
                        bIsCopyProvided = <span class="keyword">true</span>;

                    <span class="comment">// ---------------------------------------</span>
                    int64_t lOpeningTransNo = 0;
                    <span class="comment">// -------</span>
                    <span class="keywordflow">if</span> (strOpeningTransNo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                        lOpeningTransNo = atol(strOpeningTransNo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="keywordflow">else</span>
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected openingTransNo in party.\n&quot;</span>, szFunc);
                    <span class="comment">// ---------------------------------------</span>

                    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = <span class="keyword">new</span>  <a class="code" href="class_o_t_party.html">OTParty</a>(strName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() : <span class="stringliteral">&quot;PARTY_ERROR_NAME&quot;</span>,
                                                    strOwnerType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;nym&quot;</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>,
                                                    strOwnerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                                    strAuthAgent.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);

                    pParty-&gt;<a class="code" href="class_o_t_party.html#a7f587b2f9dc4305e035057fa252b8fa7">SetOpeningTransNo</a>(lOpeningTransNo); <span class="comment">// WARNING:  NEED TO MAKE SURE pParty IS CLEANED UP BELOW THIS POINT, IF FAILURE!!</span>

                    <span class="comment">// -----------------------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// Load up the agents.</span>
                    <span class="comment">//</span>
                    int32_t nAgentCount = strNumAgents.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumAgents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nAgentCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nAgentCount-- &gt; 0)
                        {
<span class="comment">//                          xml-&gt;read(); // &lt;==================</span>
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                            {
                                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected element for agent. \n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pParty; pParty=NULL;
                                <span class="keywordflow">return</span> (-1);
                            }
                            <span class="comment">// -----------------------------------------------</span>
                            <span class="keywordflow">if</span> ((xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (!strcmp(<span class="stringliteral">&quot;agent&quot;</span>, xml-&gt;getNodeName())))
                            {
                                <a class="code" href="class_o_t_string.html">OTString</a> strAgentName       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Agent name (if needed in script code)</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strAgentRepSelf    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;doesAgentRepresentHimself&quot;</span>); <span class="comment">// Agent might also BE the party, and not just party&#39;s employee.</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strAgentIndividual = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;isAgentAnIndividual&quot;</span>); <span class="comment">// Is the agent a voting group, or an individual nym? (whether employee or not)</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strNymID           = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;nymID&quot;</span>); <span class="comment">// Nym ID if Nym in role for entity, or if representing himself.</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strRoleID          = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;roleID&quot;</span>); <span class="comment">// Role ID if Nym in Role.</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strGroupName       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;groupName&quot;</span>); <span class="comment">// Group name if voting group. (Relative to entity.)</span>

                                <span class="comment">// ----------------------------------</span>

                                <span class="keywordflow">if</span> (!strAgentName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strAgentRepSelf.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strAgentIndividual.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading agent: Either the name, or one of the bool variables was EMPTY.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ----------------------------------</span>
                                <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a>(strAgentName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading agent due to Invalid name: %s\n&quot;</span>, szFunc,
                                                  strAgentName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ----------------------------------</span>
                                <span class="keywordtype">bool</span> bRepsHimself = <span class="keyword">true</span>; <span class="comment">// default</span>

                                <span class="keywordflow">if</span> (strAgentRepSelf.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;false&quot;</span>))
                                    bRepsHimself = <span class="keyword">false</span>;

                                <span class="comment">// ----------------------------------</span>
                                <span class="keywordtype">bool</span> bIsIndividual = <span class="keyword">true</span>; <span class="comment">// default</span>

                                <span class="keywordflow">if</span> (strAgentIndividual.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;false&quot;</span>))
                                    bIsIndividual = <span class="keyword">false</span>;

                                <span class="comment">// ---------------------------------------</span>
                                <span class="comment">// See if the same-named agent already exists on ANY of the OTHER PARTIES</span>
                                <span class="comment">// (There can only be one agent on an OTScriptable with a given name.)</span>
                                <span class="comment">//</span>
                                <a class="code" href="class_o_t_agent.html">OTAgent</a> * pExistingAgent = this-&gt;<a class="code" href="class_o_t_scriptable.html#a8f8c32df22c81d1a5aec3e483089b923">GetAgent</a>(strAgentName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="keywordflow">if</span> (NULL != pExistingAgent) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                                {
                                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading agent named %s, since one was &quot;</span>
                                                   <span class="stringliteral">&quot;already there on party %s.\n&quot;</span>, szFunc, strAgentName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// The AddAgent call below checks to see if it&#39;s already there, but only for the</span>
                                <span class="comment">// currently-loading party.</span>
                                <span class="comment">// Whereas the above GetAgent() call checks this OTScriptable for ALL the agents on the already-loaded parties.</span>
                                <span class="comment">// ----------------------------------</span>

                                <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent =
                                <span class="keyword">new</span> <a class="code" href="class_o_t_agent.html">OTAgent</a>(bRepsHimself, bIsIndividual, strAgentName, strNymID, strRoleID, strGroupName);
                                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pAgent);

                                <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;AddAgent(*pAgent))
                                {
                                    <span class="keyword">delete</span> pAgent; pAgent = NULL;
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed adding agent to party.\n&quot;</span>, szFunc);
                                    <span class="keywordflow">return</span> (-1);
                                }

                                <span class="comment">//                  xml-&gt;read(); // &lt;==================</span>

                                <span class="comment">// MIGHT need to add &quot;skip after element&quot; here.</span>

                                <span class="comment">// Update: Nope.</span>
                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected agent element in party.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pParty; pParty=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    }
                    <span class="comment">// --------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// LOAD PARTY ACCOUNTS.</span>
                    <span class="comment">//</span>
                    int32_t nAcctCount  = strNumAccounts.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumAccounts.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nAcctCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nAcctCount-- &gt; 0)
                        {
<span class="comment">//                          xml-&gt;read(); // &lt;==================</span>
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">OTContract::SkipToElement</a>(xml))
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error finding expected next element for party account.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pParty; pParty=NULL;
                                <span class="keywordflow">return</span> (-1);
                            }
                            <span class="comment">// -----------------------------------------------</span>
                            <span class="keywordflow">if</span> ((xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (!strcmp(<span class="stringliteral">&quot;assetAccount&quot;</span>, xml-&gt;getNodeName())))
                            {
                                <a class="code" href="class_o_t_string.html">OTString</a> strAcctName        = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Acct name (if needed in script code)</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strAcctID          = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;acctID&quot;</span>); <span class="comment">// Asset Acct ID</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;assetTypeID&quot;</span>); <span class="comment">// Asset Type ID</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strAgentName       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;agentName&quot;</span>); <span class="comment">// Name of agent who controls this account.</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strClosingTransNo  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;closingTransNo&quot;</span>); <span class="comment">// the closing #s are on the asset accounts.</span>

                                int64_t lClosingTransNo = 0;
                                <span class="comment">// -------</span>
                                <span class="keywordflow">if</span> (strClosingTransNo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                    lClosingTransNo = atol(strClosingTransNo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                <span class="keywordflow">else</span>
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected closingTransNo in partyaccount.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ----------------------------------</span>

                                <span class="comment">// Missing Account ID is allowed, as well as agent name, since those things may not be decided yet.</span>
                                <span class="comment">//</span>
                                <span class="keywordflow">if</span> (!strAcctName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || (<a class="code" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a> &amp;&amp; !strAssetTypeID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()))
<span class="comment">//                              if (!strAcctName.Exists() || !strAcctID.Exists() || !strAgentName.Exists() || !strAssetTypeID.Exists())</span>
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected missing AcctID or AssetTypeID or Name or AgentName in partyaccount.\n&quot;</span>,
                                                  szFunc);
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>
                                <span class="comment">// See if the same-named partyacct already exists on ANY of the OTHER PARTIES</span>
                                <span class="comment">// (There can only be one partyacct on an OTScriptable with a given name.)</span>
                                <span class="comment">//</span>
                                <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = this-&gt;<a class="code" href="class_o_t_scriptable.html#a94c9e55f78357e04e4b9781ab662370f">GetPartyAccount</a>(strAcctName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="keywordflow">if</span> (NULL != pAcct) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                                {
                                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading partyacct named %s, since one was &quot;</span>
                                                   <span class="stringliteral">&quot;already there on party %s.\n&quot;</span>, szFunc, strAcctName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// The AddAccount call below checks to see if it&#39;s already there, but only for the</span>
                                <span class="comment">// currently-loading party.</span>
                                <span class="comment">// Whereas the above call checks this OTScriptable for all the accounts on the already-loaded parties.</span>
                                <span class="comment">// ----------------------------------</span>

                                <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;AddAccount(strAgentName, strAcctName, strAcctID, strAssetTypeID, lClosingTransNo))
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed adding account to party.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pParty; pParty=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }

<span class="comment">//                              xml-&gt;read(); // &lt;==================</span>


                                <span class="comment">// MIGHT need to add &quot;skip after field&quot; call here.</span>

                                <span class="comment">// UPdate: Nope. Not here.</span>

                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected assetAccount element in party.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pParty; pParty=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    }

                    <span class="comment">// **************************************</span>

                    <span class="keywordflow">if</span> (bIsCopyProvided)
                    {
                        <span class="keyword">const</span> <span class="keywordtype">char</span>  *   pElementExpected    = <span class="stringliteral">&quot;mySignedCopy&quot;</span>;
                        <a class="code" href="class_o_t_string.html">OTString</a>        strTextExpected; <span class="comment">// signed copy will go here.</span>

                        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#ac374831c4a1fad9d016d39d640a285ac">OTContract::LoadEncodedTextFieldByName</a>(xml, strTextExpected, pElementExpected))
                        {
                            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: &quot;</span>
                                          <span class="stringliteral">&quot;Expected %s element with text field.\n&quot;</span>, szFunc,
                                          pElementExpected);
                            <span class="keyword">delete</span> pParty; pParty = NULL;
                            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                        }
                        <span class="comment">// else ...</span>

                        pParty-&gt;SetMySignedCopy(strTextExpected);
                    }

                    <span class="comment">// --------------------------------</span>
<span class="comment">//                    if (false == SkipAfterLoadingField(xml))  // &lt;/party&gt;</span>
<span class="comment">//                    {</span>
<span class="comment">//                        OTLog::vOutput(0, &quot;*** %s: Bad data? Expected EXN_ELEMENT_END here, but &quot;</span>
<span class="comment">//                                       &quot;didn&#39;t get it. Failure.\n&quot;, szFunc);</span>
<span class="comment">//                        delete pParty; pParty=NULL;</span>
<span class="comment">//                        return (-1);</span>
<span class="comment">//                    }</span>
                    <span class="comment">// --------------------------------</span>

                    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#accfde75655f5c49c041ef3a5fbff54e6">AddParty</a>(*pParty))
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Loaded Party: %s\n&quot;</span>, szFunc, pParty-&gt;GetPartyName().c_str());
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading Party: %s\n&quot;</span>, szFunc, pParty-&gt;GetPartyName().c_str());
                        <span class="keyword">delete</span> pParty; pParty = NULL;
                        <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                    }
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected party element.\n&quot;</span>, szFunc);
                    <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                }
            } <span class="comment">// while</span>
        }

        <span class="comment">// -----------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// Load up the Bylaws.</span>
        <span class="comment">//</span>
        int32_t nBylawCount = strNumBylaws.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumBylaws.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
        <span class="keywordflow">if</span> (nBylawCount &gt; 0)
        {
            <span class="keywordflow">while</span> (nBylawCount-- &gt; 0)
            {
<span class="comment">//              xml-&gt;read(); // &lt;==================</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected element for bylaw. \n&quot;</span>, szFunc);
                    <span class="keywordflow">return</span> (-1);
                }
                <span class="comment">// -----------------------------------------------</span>

<span class="comment">//                OTLog::vOutput(0, &quot;%s: Looping to load bylaws: currently on: %s \n&quot;, szFunc, xml-&gt;getNodeName());</span>


                <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;bylaw&quot;</span>, xml-&gt;getNodeName()))
                {
                    <a class="code" href="class_o_t_string.html">OTString</a> strName        = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// bylaw name</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strLanguage    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;language&quot;</span>); <span class="comment">// The script language used in this bylaw.</span>

                    <a class="code" href="class_o_t_string.html">OTString</a> strNumVariable     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numVariables&quot;</span>); <span class="comment">// number of variables on this bylaw.</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strNumClauses      = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numClauses&quot;</span>); <span class="comment">// number of clauses on this bylaw.</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strNumHooks        = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numHooks&quot;</span>); <span class="comment">// hooks to server events.</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strNumCallbacks    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numCallbacks&quot;</span>); <span class="comment">// Callbacks the server may initiate, when it needs answers.</span>

                    <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = <span class="keyword">new</span> <a class="code" href="class_o_t_bylaw.html">OTBylaw</a>(strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strLanguage.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);

                    <span class="comment">// ---------------------------------------------------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// LOAD VARIABLES AND CONSTANTS.</span>
                    <span class="comment">//</span>
                    int32_t nCount  = strNumVariable.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumVariable.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nCount-- &gt; 0)
                        {
<span class="comment">//                          xml-&gt;read(); // &lt;==================</span>
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">OTContract::SkipToElement</a>(xml))
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error finding expected next element for variable.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1);
                            }
                            <span class="comment">// -----------------------------------------------</span>
                            <span class="keywordflow">if</span> ((xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (!strcmp(<span class="stringliteral">&quot;variable&quot;</span>, xml-&gt;getNodeName())))
                            {
                                <a class="code" href="class_o_t_string.html">OTString</a> strVarName     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Variable name (if needed in script code)</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strVarValue    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;value&quot;</span>); <span class="comment">// Value stored in variable (If this is &quot;true&quot; then a real value is expected in a text field below. Otherwise, it&#39;s assumed to be a BLANK STRING.)</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strVarType     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>); <span class="comment">// string or int64_t</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strVarAccess   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;access&quot;</span>); <span class="comment">// constant, persistent, or important.</span>

                                <span class="comment">// ----------------------------------</span>

                                <span class="keywordflow">if</span> (!strVarName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strVarType.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strVarAccess.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected missing name, type, or access type in variable.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>
                                <span class="comment">// See if the same-named variable already exists on ANY of the OTHER BYLAWS</span>
                                <span class="comment">// (There can only be one variable on an OTScriptable with a given name.)</span>
                                <span class="comment">//</span>
                                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = this-&gt;<a class="code" href="class_o_t_scriptable.html#a3f72637feb6a94088d8a576e29cc6a29">GetVariable</a>(strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="keywordflow">if</span> (NULL != pVar) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                                {
                                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading variable named %s, since one was &quot;</span>
                                                   <span class="stringliteral">&quot;already there on one of the bylaws.\n&quot;</span>, szFunc, strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// The AddVariable call below checks to see if it&#39;s already there, but only for the</span>
                                <span class="comment">// currently-loading bylaw.</span>
                                <span class="comment">// Whereas the above call checks this OTScriptable for all the variables on the already-loaded bylaws.</span>
                                <span class="comment">// ----------------------------------</span>
                                <span class="comment">//</span>
                                <span class="comment">// VARIABLE TYPE AND ACCESS TYPE</span>
                                <span class="comment">//</span>
                                <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009">OTVariable::OTVariable_Type</a> theVarType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ae4992b1094ef990fbe683f43c7b2a2a8">OTVariable::Var_Error_Type</a>;

                                <span class="keywordflow">if</span> (strVarType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;integer&quot;</span>))
                                    theVarType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ad6ecaa07337c8641bed85deab47c1a1d">OTVariable::Var_Integer</a>;
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strVarType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;string&quot;</span>))
                                    theVarType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a814483713bd6ebb3b01c06378fc60fa7">OTVariable::Var_String</a>;
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strVarType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;bool&quot;</span>))
                                    theVarType = <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a4f6c0ea25b7a5aed16bc7710389e77da">OTVariable::Var_Bool</a>;
                                <span class="keywordflow">else</span>
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad variable type: %s.\n&quot;</span>, szFunc, strVarType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="comment">// ---------</span>

                                <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672">OTVariable::OTVariable_Access</a> theVarAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a664538cd758878fab6c2e8718b1839fc">OTVariable::Var_Error_Access</a>;

                                <span class="keywordflow">if</span> (strVarAccess.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;constant&quot;</span>))
                                    theVarAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>;
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strVarAccess.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;persistent&quot;</span>))
                                    theVarAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672ad39bbaff07fae07e5d3dece3789fb03c">OTVariable::Var_Persistent</a>;
                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strVarAccess.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;important&quot;</span>))
                                    theVarAccess = <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a087192fa3f7d345cf2eb413a52fdddc4">OTVariable::Var_Important</a>;
                                <span class="keywordflow">else</span>
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad variable access type: %s.\n&quot;</span>, szFunc, strVarAccess.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="comment">// ---------</span>

                                <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a664538cd758878fab6c2e8718b1839fc">OTVariable::Var_Error_Access</a> == theVarAccess) ||
                                    (<a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ae4992b1094ef990fbe683f43c7b2a2a8">OTVariable::Var_Error_Type</a> == theVarType))
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading variable to bylaw: &quot;</span>
                                                  <span class="stringliteral">&quot;bad type (%s) or access type (%s).\n&quot;</span>,
                                                  szFunc, strVarType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strVarAccess.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>

                                <span class="keywordtype">bool</span> bAddedVar = <span class="keyword">false</span>;
                                <span class="keyword">const</span> std::string str_var_name = strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

                                <span class="keywordflow">switch</span> (theVarType)
                                {
                                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ad6ecaa07337c8641bed85deab47c1a1d">OTVariable::Var_Integer</a>:
                                        <span class="keywordflow">if</span> (strVarValue.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                        {
                                            <span class="keyword">const</span> int32_t nVarValue = atoi(strVarValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                            bAddedVar = pBylaw-&gt;AddVariable(str_var_name, nVarValue, theVarAccess);
                                        }
                                        <span class="keywordflow">else</span>
                                        {
                                            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No value found for integer variable: %s\n&quot;</span>, szFunc,
                                                          strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                            <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                            <span class="keywordflow">return</span> (-1);
                                        }
                                        <span class="keywordflow">break</span>;
                                        <span class="comment">// ---------------------------------</span>
                                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a4f6c0ea25b7a5aed16bc7710389e77da">OTVariable::Var_Bool</a>:
                                        <span class="keywordflow">if</span> (strVarValue.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                        {
                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> bVarValue = strVarValue.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
                                            bAddedVar = pBylaw-&gt;AddVariable(str_var_name, bVarValue, theVarAccess);
                                        }
                                        <span class="keywordflow">else</span>
                                        {
                                            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No value found for bool variable: %s\n&quot;</span>, szFunc,
                                                          strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                            <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                            <span class="keywordflow">return</span> (-1);
                                        }
                                        <span class="keywordflow">break</span>;
                                        <span class="comment">// ---------------------------------</span>
                                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a814483713bd6ebb3b01c06378fc60fa7">OTVariable::Var_String</a>:
                                    {
                                        <span class="comment">// I realized I should probably allow empty strings.  :-P</span>
                                        <span class="keywordflow">if</span> (strVarValue.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; strVarValue.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;exists&quot;</span>))
                                        {
                                            strVarValue.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>(); <span class="comment">// probably unnecessary.</span>
                                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, strVarValue))
                                            {
                                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No value found for string variable: %s\n&quot;</span>, szFunc,
                                                              strVarName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                                <span class="keywordflow">return</span> (-1);
                                            }
                                            <span class="comment">// (else success)</span>
                                        }
                                        <span class="keywordflow">else</span>
                                            strVarValue.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>(); <span class="comment">// Necessary. If it&#39;s going to be a blank string, then let&#39;s make sure.</span>

                                        <span class="keyword">const</span> std::string str_var_value = strVarValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                                        bAddedVar = pBylaw-&gt;AddVariable(str_var_name, str_var_value, theVarAccess);
                                    }
                                        <span class="keywordflow">break</span>;
                                    <span class="keywordflow">default</span>:
                                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong variable type... &quot;</span>
                                                      <span class="stringliteral">&quot;somehow AFTER I should have already detected it...\n&quot;</span>, szFunc);
                                        <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                        <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// -------------------------------------------------</span>

                                <span class="keywordflow">if</span> (<span class="keyword">false</span> == bAddedVar)
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed adding variable to bylaw.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }

                                <span class="comment">//                  xml-&gt;read(); // &lt;==================</span>

                                <span class="comment">// MIGHT NEED TO HAVE &quot;SKIP AFTER&quot; HERE...</span>
                                <span class="comment">// Update: Nope.</span>


            <span class="comment">//                  if (false == SkipAfterLoadingField(xml))</span>
            <span class="comment">//                  {</span>
            <span class="comment">//                      OTLog::Output(0, &quot;*** OTScriptable::ProcessXMLNode: Bad data? Expected EXN_ELEMENT_END here, but &quot;</span>
            <span class="comment">//                                  &quot;didn&#39;t get it. Failure.\n&quot;);</span>
            <span class="comment">//                      delete pBylaw; pBylaw=NULL;</span>
            <span class="comment">//                      return (-1);</span>
            <span class="comment">//                  }</span>
                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected variable element in bylaw.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    }

                    <span class="comment">// ---------------------------------------------------------------------------</span>
                    <span class="comment">// LOAD CLAUSES</span>
                    <span class="comment">//</span>
                    nCount  = strNumClauses.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumClauses.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nCount-- &gt; 0)
                        {
                            <span class="comment">// OTContract::LoadEncodedTextFieldByName() (below) does this stuff already. Commented out.</span>
                            <span class="comment">//</span>
            <span class="comment">//              xml-&gt;read(); // &lt;==================</span>
            <span class="comment">//              if (false == OTContract::SkipToElement(xml))</span>
            <span class="comment">//              {</span>
            <span class="comment">//                  OTLog::Error(&quot;OTScriptable::ProcessXMLNode: Error finding expected next element for variable.\n&quot;);</span>
            <span class="comment">//                  delete pBylaw; pBylaw=NULL;</span>
            <span class="comment">//                  return (-1);</span>
            <span class="comment">//              }</span>
                            <span class="comment">// -----------------------------------------------</span>

                            <span class="keyword">const</span> <span class="keywordtype">char</span>  *   pElementExpected    = <span class="stringliteral">&quot;clause&quot;</span>;
                            <a class="code" href="class_o_t_string.html">OTString</a>        strTextExpected; <span class="comment">// clause&#39;s script code will go here.</span>

                            <a class="code" href="_o_t_string_8hpp.html#a7ec7839682b097a5c5b5c5125046c82b">mapOfStrings</a>    temp_MapAttributes;
                            <span class="comment">//</span>
                            <span class="comment">// This map contains values we will also want, when we read the clause...</span>
                            <span class="comment">// (The OTContract::LoadEncodedTextField call below will read all the values</span>
                            <span class="comment">// as specified in this map.)</span>
                            <span class="comment">//</span>
                            <span class="comment">//</span>
                            temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));   // Grab the others this way as well.</span>
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));</span>
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));</span>
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));</span>
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));</span>
            <span class="comment">//              temp_MapAttributes.insert(std::pair&lt;std::string, std::string&gt;(&quot;name&quot;, &quot;&quot;));</span>

                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#ac374831c4a1fad9d016d39d640a285ac">OTContract::LoadEncodedTextFieldByName</a>(xml, strTextExpected, pElementExpected, &amp;temp_MapAttributes)) <span class="comment">// &lt;/clause&gt;</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: &quot;</span>
                                              <span class="stringliteral">&quot;Expected %s element with text field.\n&quot;</span>, szFunc,
                                              pElementExpected);
                                <span class="keyword">delete</span> pBylaw; pBylaw = NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }

                            <span class="comment">// Okay we now have the script code in strTextExpected. Next, let&#39;s read the clause&#39;s NAME</span>
                            <span class="comment">// from the map. If it&#39;s there, and presumably some kind of harsh validation for both, then</span>
                            <span class="comment">// create a clause object and add to my list here.</span>
                            <span class="comment">// ------------------------------------------</span>

                            mapOfStrings::iterator it = temp_MapAttributes.find(<span class="stringliteral">&quot;name&quot;</span>);

                            <span class="keywordflow">if</span> ((it != temp_MapAttributes.end())) <span class="comment">// We expected this much.</span>
                            {
                                std::string &amp; str_name = (*it).second;

                                <span class="keywordflow">if</span> (str_name.size() &gt; 0) <span class="comment">// SUCCESS</span>
                                {
                                    <span class="comment">// ---------------------------------------</span>

            <span class="comment">//                      if (false == SkipAfterLoadingField(xml))  // NOt sure yet about this block....</span>
            <span class="comment">//                      {</span>
            <span class="comment">//                          OTLog::Output(0, &quot;*** OTScriptable::ProcessXMLNode: Bad data? Expected EXN_ELEMENT_END here, but &quot;</span>
            <span class="comment">//                                        &quot;didn&#39;t get it. Failure.\n&quot;);</span>
            <span class="comment">//                          delete pBylaw; pBylaw=NULL;</span>
            <span class="comment">//                          return (-1);</span>
            <span class="comment">//                      }</span>
                                    <span class="comment">// *****************************************************</span>

                                    <span class="comment">// See if the same-named clause already exists on ANY of the OTHER BYLAWS</span>
                                    <span class="comment">// (There can only be one clause on an OTScriptable with a given name.)</span>
                                    <span class="comment">//</span>
                                    <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = this-&gt;<a class="code" href="class_o_t_scriptable.html#abe36809472a1b7adf66b303ea176888e">GetClause</a>(str_name.c_str());

                                    <span class="keywordflow">if</span> (NULL != pClause) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                                    {
                                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading clause named %s, since one was already &quot;</span>
                                                       <span class="stringliteral">&quot;there on one of the bylaws.\n&quot;</span>, szFunc, str_name.c_str());
                                        <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                        <span class="keywordflow">return</span> (-1);
                                    }
                                    <span class="comment">// ---------------------------------------------------------</span>
                                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddClause(str_name.c_str(),
                                                                        strTextExpected.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
                                    {
                                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed adding clause to bylaw.\n&quot;</span>, szFunc);
                                        <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                        <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                                    }
                                }
                                <span class="comment">// else it&#39;s empty, which is expected if nothing was there, since that&#39;s the default value</span>
                                <span class="comment">// that we set above for &quot;name&quot; in temp_MapAttributes.</span>
                                <span class="keywordflow">else</span>
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected clause name.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                                }
                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Strange error: couldn&#39;t find name AT ALL.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    } <span class="comment">// if strNumClauses.Exists() &amp;&amp; nCount &gt; 0</span>


                    <span class="comment">// ---------------------------------------------------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// LOAD HOOKS.</span>
                    <span class="comment">//</span>
                    nCount  = strNumHooks.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumHooks.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nCount-- &gt; 0)
                        {
<span class="comment">//                          xml-&gt;read();</span>
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                            {
                                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected element.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1);
                            }
                            <span class="comment">// --------------------------------------</span>
                            <span class="keywordflow">if</span> ((xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (!strcmp(<span class="stringliteral">&quot;hook&quot;</span>, xml-&gt;getNodeName())))
                            {
                                <a class="code" href="class_o_t_string.html">OTString</a> strHookName    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Name of standard hook such as hook_activate or cron_process, etc</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strClause      = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;clause&quot;</span>); <span class="comment">// Name of clause on this Bylaw that should trigger when that callback occurs.</span>

                                <span class="comment">// ----------------------------------</span>

                                <span class="keywordflow">if</span> (!strHookName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strClause.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected missing name or clause while loading hook.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>

                                <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddHook(strHookName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strClause.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed adding hook to bylaw.\n&quot;</span>, szFunc);
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>

<span class="comment">//                              xml-&gt;read(); // &lt;==================  NO NEED FOR THIS HERE.</span>
                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected hook element in bylaw.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    }

                    <span class="comment">// ---------------------------------------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// LOAD CALLBACKS.</span>
                    <span class="comment">//</span>
                    nCount  = 0;
                    nCount  = strNumCallbacks.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumCallbacks.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
                    <span class="keywordflow">if</span> (nCount &gt; 0)
                    {
                        <span class="keywordflow">while</span> (nCount-- &gt; 0)
                        {
<span class="comment">//                          xml-&gt;read();</span>
                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                            {
                                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected element.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1);
                            }
                            <span class="comment">// --------------------------------------</span>
                            <span class="keywordflow">if</span> ((xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (!strcmp(<span class="stringliteral">&quot;callback&quot;</span>, xml-&gt;getNodeName())))
                            {
                                <a class="code" href="class_o_t_string.html">OTString</a> strCallbackName    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;name&quot;</span>); <span class="comment">// Name of standard callback such as OnActivate, OnDeactivate, etc</span>
                                <a class="code" href="class_o_t_string.html">OTString</a> strClause          = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;clause&quot;</span>); <span class="comment">// Name of clause on this Bylaw that should trigger when that hook occurs.</span>

                                <span class="comment">// ----------------------------------</span>

                                <span class="keywordflow">if</span> (!strCallbackName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strClause.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected, yet nevertheless missing, name or clause while loading &quot;</span>
                                                  <span class="stringliteral">&quot;callback for bylaw %s.\n&quot;</span>, szFunc, strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>
                                <span class="comment">// See if the same-named callback already exists on ANY of the OTHER BYLAWS</span>
                                <span class="comment">// (There can only be one clause to handle any given callback.)</span>
                                <span class="comment">//</span>
                                <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = this-&gt;<a class="code" href="class_o_t_scriptable.html#a390511c5b2f419453b1cc169ec576972">GetCallback</a>(strCallbackName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                                <span class="keywordflow">if</span> (NULL != pClause) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                                {
                                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading callback %s, since one was already there on one of the other bylaws.\n&quot;</span>,
                                                   szFunc,
                                                   strCallbackName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// The below call checks to see if it&#39;s already there, but only for the currently-loading bylaw.</span>
                                <span class="comment">// Whereas the above call checks this OTScriptable for all the already-loaded bylaws.</span>
                                <span class="comment">// ---------------------------------------</span>

                                <span class="keywordflow">if</span> (<span class="keyword">false</span> == pBylaw-&gt;AddCallback(strCallbackName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strClause.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
                                {
                                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%se: Failed adding callback (%s) to bylaw (%s).\n&quot;</span>, szFunc,
                                                  strCallbackName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                                    <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                    <span class="keywordflow">return</span> (-1);
                                }
                                <span class="comment">// ---------------------------------------</span>

<span class="comment">//                              xml-&gt;read(); // &lt;==================    NO NEED FOR THIS HERE.</span>
                            }
                            <span class="keywordflow">else</span>
                            {
                                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected callback element in bylaw.\n&quot;</span>, szFunc);
                                <span class="keyword">delete</span> pBylaw; pBylaw=NULL;
                                <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                            }
                        } <span class="comment">// while</span>
                    }

                    <span class="comment">// --------------------------------</span>
<span class="comment">//                  if (false == SkipAfterLoadingField(xml))  // &lt;/bylaw&gt;</span>
<span class="comment">//                  {</span>
<span class="comment">//                      OTLog::vOutput(0, &quot;*** %s: Bad data? Expected EXN_ELEMENT_END here, but &quot;</span>
<span class="comment">//                                     &quot;didn&#39;t get it. Failure.\n&quot;, szFunc);</span>
<span class="comment">//                      delete pBylaw; pBylaw=NULL;</span>
<span class="comment">//                      return (-1);</span>
<span class="comment">//                  }</span>
                    <span class="comment">// --------------------------------</span>

                    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_scriptable.html#a32d8bccb563ab97e335f457148770c73">AddBylaw</a>(*pBylaw))
                    {
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Loaded Bylaw: %s\n&quot;</span>, szFunc,
                                       pBylaw-&gt;GetName().Get());
                    }
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading Bylaw: %s\n&quot;</span>, szFunc,
                                      pBylaw-&gt;GetName().Get());
                        <span class="keyword">delete</span> pBylaw; pBylaw = NULL;
                        <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                    }
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected bylaw element.\n&quot;</span>, szFunc);
                    <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                }

            } <span class="comment">// while</span>
        }
        <span class="comment">// -----------------------------------------------</span>

        nReturnVal = 1;
    }

    <span class="comment">// ----------------------------------------------------------------------------------</span>


    <span class="keywordflow">return</span> nReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad469b542209e1c73905d2094bb561793"></a><!-- doxytag: member="OTScriptable::RegisterOTNativeCallsWithScript" ref="ad469b542209e1c73905d2094bb561793" args="(OTScript &amp;theScript)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#ad469b542209e1c73905d2094bb561793">OTScriptable::RegisterOTNativeCallsWithScript</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_script.html">OTScript</a> &amp;&#160;</td>
          <td class="paramname"><em>theScript</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#ad79350fe9df32d0e129e1a8b5fe28a04">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00281">281</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#ifdef OT_USE_SCRIPT_CHAI</span>
<span class="preprocessor"></span>    <span class="keyword">using namespace </span>chaiscript;

    <span class="comment">// In the future, this will be polymorphic.</span>
    <span class="comment">// But for now, I&#39;m forcing things...</span>

    OTScriptChai * pScript = <span class="keyword">dynamic_cast&lt;</span>OTScriptChai *<span class="keyword">&gt;</span> (&amp;theScript);

    <span class="keywordflow">if</span> (NULL != pScript)
    {
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pScript-&gt;chai)

        pScript-&gt;chai-&gt;add(fun(&amp;<a class="code" href="class_o_t_scriptable.html">OTScriptable</a>::<a class="code" href="class_o_t_scriptable.html#aebf4ace228231ac6aa8395fe56a5271c">GetTime</a>), &quot;get_time&quot;);
        <span class="comment">// ---------------------------------------------------------------------------------</span>
        pScript-&gt;chai-&gt;add(fun(&amp;<a class="code" href="class_o_t_scriptable.html">OTScriptable</a>::<a class="code" href="class_o_t_scriptable.html#ae2046f1b62828d26dda822eaa6a194b6">CanExecuteClause</a>, this), &quot;party_may_execute_clause&quot;);
<span class="comment">//      pScript-&gt;chai.add(fun(&amp;OTScriptable::CanExecuteClause, (*this)), &quot;party_may_execute_clause&quot;);</span>
    }
<span class="comment">//  else if (NULL != (pScript = dynamic_cast&lt;OTScriptSomeOtherScriptingLanguageSubClass_GOES_HERE *&gt; (&amp;theScript)) )</span>
<span class="comment">//  { }</span>
    else
<span class="preprocessor">#endif // OT_USE_SCRIPT_CHAI</span>
<span class="preprocessor"></span>    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::RegisterOTNativeCallsWithScript: Failed dynamic casting OTScript to OTScriptChai \n&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a92785192590f2e039f46d16bcd1934d3"></a><!-- doxytag: member="OTScriptable::Release" ref="a92785192590f2e039f46d16bcd1934d3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a92785192590f2e039f46d16bcd1934d3">OTScriptable::Release</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a15e423ca0d650858a23e54f8285feae1">OTContract</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a335f903820d3128716c7f7b93200b5ac">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#aad6f21095f2ea95a1ced567ffc17d2eb">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#a231d9ec26ad3f267bf68cbc5f51c62ac">OTPaymentPlan</a>, <a class="el" href="class_o_t_cron_item.html#a11e9851acefc9162bb5f107a1952ffb7">OTCronItem</a>, <a class="el" href="class_o_t_trade.html#a677d2b33af8117fb681b52e20a4baaff">OTTrade</a>, <a class="el" href="class_o_t_token.html#a973344e50b0b1e8cab012a3a1dc54a0d">OTToken</a>, <a class="el" href="class_o_t_offer.html#aaaed3d93e2a4117f36e344a602f3c909">OTOffer</a>, <a class="el" href="class_o_t_cheque.html#ae903c10cd8712d1478970fb955301996">OTCheque</a>, <a class="el" href="class_o_t_trackable.html#a71dcca204d36941c6e2f3f73af4a6c2b">OTTrackable</a>, and <a class="el" href="class_o_t_instrument.html#a4fdc0a70ec257ea7f8f58e7774932d60">OTInstrument</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03141">3141</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_scriptable.html#a2f9a8cf56455a256952bf4069b7039ba">Release_Scriptable</a>();

    <span class="comment">// If there were any dynamically allocated objects, clean them up here.</span>

    <a class="code" href="class_o_t_contract.html#a15e423ca0d650858a23e54f8285feae1">ot_super::Release</a>(); <span class="comment">// since I&#39;ve overridden the base class, I call it now...</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f9a8cf56455a256952bf4069b7039ba"></a><!-- doxytag: member="OTScriptable::Release_Scriptable" ref="a2f9a8cf56455a256952bf4069b7039ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a2f9a8cf56455a256952bf4069b7039ba">OTScriptable::Release_Scriptable</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03113">3113</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Go through the existing list of parties and bylaws at this point, and delete them all.</span>
    <span class="comment">// (After all, I own them.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">while</span> (!<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.empty())
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.begin()-&gt;second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);

        <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.erase(<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.begin());

        <span class="keyword">delete</span> pParty;
        pParty = NULL;
    }
    <span class="keywordflow">while</span> (!<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.empty())
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.begin()-&gt;second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);

        <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.erase(<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.begin());

        <span class="keyword">delete</span> pBylaw;
        pBylaw = NULL;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e41bb939fd5dbfe1f2442e5919a5079"></a><!-- doxytag: member="OTScriptable::RetrieveNymPointers" ref="a9e41bb939fd5dbfe1f2442e5919a5079" args="(mapOfNyms &amp;map_Nyms_Already_Loaded)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a9e41bb939fd5dbfe1f2442e5919a5079">OTScriptable::RetrieveNymPointers</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp;&#160;</td>
          <td class="paramname"><em>map_Nyms_Already_Loaded</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00933">933</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// -----------------------</span>

        pParty-&gt;<a class="code" href="class_o_t_party.html#aa47dda003a2d39a491ac96582c9679b8">RetrieveNymPointers</a>(map_Nyms_Already_Loaded);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1433fd747d848bbab0029c06c07668a"></a><!-- doxytag: member="OTScriptable::SaveContractWallet" ref="af1433fd747d848bbab0029c06c07668a" args="(std::ofstream &amp;ofs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#af1433fd747d848bbab0029c06c07668a">OTScriptable::SaveContractWallet</a> </td>
          <td>(</td>
          <td class="paramtype">std::ofstream &amp;&#160;</td>
          <td class="paramname"><em>ofs</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="class_o_t_contract.html#af16a41ce18a9e3408fc5c9ee18315a30">OTContract</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#aa39d672a40e0778c205ed308b86c6927">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#a463dad42bf5d7cc342dd42c5989f6492">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#ac05bb3d3f77b90edfa3259c182c57f2b">OTPaymentPlan</a>, <a class="el" href="class_o_t_token.html#a9774f03f56290413acff03b8ea428052">OTToken</a>, <a class="el" href="class_o_t_trade.html#a635d7f83beaa3885856900727a457835">OTTrade</a>, <a class="el" href="class_o_t_offer.html#ad165d20dd33ab3d827f61233ceb5f077">OTOffer</a>, <a class="el" href="class_o_t_cheque.html#aeecffca22860a763c0843b7a051a1182">OTCheque</a>, <a class="el" href="class_o_t_trackable.html#a85b7622124dd3d103cb50498cddac2b2">OTTrackable</a>, and <a class="el" href="class_o_t_instrument.html#a4d5f08d86edc07a603c300fd46ebfca5">OTInstrument</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l03166">3166</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a03d724ec348f2dc140c9ed45d6133429"></a><!-- doxytag: member="OTScriptable::SendNoticeToAllParties" ref="a03d724ec348f2dc140c9ed45d6133429" args="(bool bSuccessMsg, OTPseudonym &amp;theServerNym, const OTIdentifier &amp;theServerID, const int64_t &amp;lNewTransactionNumber, const OTString &amp;strReference, OTString *pstrNote=NULL, OTString *pstrAttachment=NULL, OTPseudonym *pActualNym=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a03d724ec348f2dc140c9ed45d6133429">OTScriptable::SendNoticeToAllParties</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bSuccessMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNewTransactionNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strReference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrNote</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrAttachment</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pActualNym</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a871b6c2a80d4187aac0e4ce520c92bbf">OTAgreement</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00641">641</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">true</span>;  <span class="comment">// Success is defined as ALL parties receiving a notice</span>

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// ------------------</span>
        <span class="comment">// If a smart contract is being canceled, it may not have been confirmed by</span>
        <span class="comment">// all parties. There may be some unconfirmed parties. (Meaning there is no</span>
        <span class="comment">// NymID available for those parties.) So here, we make sure we are only sending</span>
        <span class="comment">// the notice to parties which have been confirmed. Those parties will have an</span>
        <span class="comment">// opening transaction number that is non-zero. So for parties with a 0 opening</span>
        <span class="comment">// number, we skip the notice (since there won&#39;t be any NymID anyway -- nowhere</span>
        <span class="comment">// to send the notice even if we tried.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (0 != pParty-&gt;<a class="code" href="class_o_t_party.html#aa11f990dfe9743dd1d8e34af8bfd693a">GetOpeningTransNo</a>())
        {
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;<a class="code" href="class_o_t_party.html#a7419b9a17e72819156005dd976b2dd1e">SendNoticeToParty</a>(bSuccessMsg, <span class="comment">// &quot;success&quot; notice? or &quot;failure&quot; notice?</span>
                                                   theServerNym, theServerID, lNewTransactionNumber,
<span class="comment">//                                                 lInReferenceTo, // each party has its own opening trans #.</span>
                                                   strReference, pstrNote, pstrAttachment, pActualNym))
                bSuccess = <span class="keyword">false</span>; <span class="comment">// Notice I don&#39;t break here -- I still allow it to try to notice ALL parties, even if one fails.</span>
        }
    }

    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a69532b928482fc65b1c5abd2cebe3f4c"></a><!-- doxytag: member="OTScriptable::SetAsClean" ref="a69532b928482fc65b1c5abd2cebe3f4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a69532b928482fc65b1c5abd2cebe3f4c">OTScriptable::SetAsClean</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00728">728</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
    {
        <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);
        <span class="comment">// ---------------------------------------------------</span>
        <span class="comment">//</span>
        pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a8ed91d5c78fc24f89229531223132142">SetAsClean</a>(); <span class="comment">// so we can check for dirtiness later, if it&#39;s changed.</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7590c450a8a079eb388fd4fc378b3b40"></a><!-- doxytag: member="OTScriptable::SetDisplayLabel" ref="a7590c450a8a079eb388fd4fc378b3b40" args="(const std::string *pstrLabel=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a7590c450a8a079eb388fd4fc378b3b40">OTScriptable::SetDisplayLabel</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string *&#160;</td>
          <td class="paramname"><em>pstrLabel</em> = <code>NULL</code></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a0724be6ceeab338be3d9ea1469e82114">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00242">242</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">m_strLabel</a> = (NULL != pstrLabel) ? pstrLabel-&gt;c_str() : <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="accb9d578e3b10cee62e6aba7c178cf62"></a><!-- doxytag: member="OTScriptable::UpdateContents" ref="accb9d578e3b10cee62e6aba7c178cf62" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#accb9d578e3b10cee62e6aba7c178cf62">OTScriptable::UpdateContents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a78c28164555e2eb79d6b67698421638d">OTContract</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a4804dc10ab81b2bde13fce0a3afb0765">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#a6b6a960a3cf2ea5dace23b9107b829cf">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#a3b3c234f381f92f16d8ef1feaebb8a57">OTPaymentPlan</a>, <a class="el" href="class_o_t_trade.html#ab72fd44769391a80946e0cd51c9bd194">OTTrade</a>, <a class="el" href="class_o_t_offer.html#aebbb817e2106827fac130da7b00e90dc">OTOffer</a>, <a class="el" href="class_o_t_token.html#a2863bbe79da29265b1274ddabd187f44">OTToken</a>, <a class="el" href="class_o_t_cheque.html#acd515195f24d57c4b6b145c5bf1d4650">OTCheque</a>, and <a class="el" href="class_o_t_trackable.html#ae708d31ab5dca7a4dff24b0534fec889">OTTrackable</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02187">2187</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// I release this because I&#39;m about to repopulate it.</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();

    <a class="code" href="class_o_t_scriptable.html#a65ed14652345ef231ad4a3d347d89c3a">UpdateContentsToString</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a65ed14652345ef231ad4a3d347d89c3a"></a><!-- doxytag: member="OTScriptable::UpdateContentsToString" ref="a65ed14652345ef231ad4a3d347d89c3a" args="(OTString &amp;strAppend)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_scriptable.html#a65ed14652345ef231ad4a3d347d89c3a">OTScriptable::UpdateContentsToString</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strAppend</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l02152">2152</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size()&gt;0) || (<a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.size()&gt;0))
    {
        strAppend.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;scriptableContract\n specifyAssetID=\&quot;%s\&quot;\n specifyParties=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; numParties=\&quot;%d\&quot;\n numBylaws=\&quot;%d\&quot; &gt;\n\n&quot;</span>,
                              <a class="code" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>, <a class="code" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">m_bSpecifyParties</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>,
                              <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size(), <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>.size()
                              );

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
        {
            <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);

            <span class="comment">// Serialization is slightly different depending on whether we are saving</span>
            <span class="comment">// for real, or just generating a template version of the contract in order</span>
            <span class="comment">// to generate its ID.</span>
            <span class="comment">//</span>
            pParty-&gt;<a class="code" href="class_o_t_party.html#a417d0ab00166c2cd8fe2c07c3c218955">Serialize</a>(strAppend, <a class="code" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a>, <a class="code" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">m_bSpecifyAssetID</a>, <a class="code" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">m_bSpecifyParties</a>);
        }

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a>, <a class="code" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">m_mapBylaws</a>)
        {
            <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pBylaw);

            pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a0221074fd0bcf790ec4c1b92e6aeba80">Serialize</a>(strAppend, <a class="code" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">m_bCalculatingID</a>);
        }

        strAppend.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;/scriptableContract&gt;\n\n&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9492afb0aee3340f6fbdffdbdf8d5291"></a><!-- doxytag: member="OTScriptable::ValidateName" ref="a9492afb0aee3340f6fbdffdbdf8d5291" args="(const std::string str_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a9492afb0aee3340f6fbdffdbdf8d5291">OTScriptable::ValidateName</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>str_name</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00260">260</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (str_name.size() &lt;= 0)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTScriptable::ValidateName: Name has zero size.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (find_if(str_name.begin(), str_name.end(), <a class="code" href="_o_t_scriptable_8cpp.html#a0de615976d74e8e2c5acde992b062471">is_ot_namechar_invalid</a>) != str_name.end())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::ValidateName: Name fails validation testing: %s\n&quot;</span>,
                     str_name.c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a242f30ff4c6deccf285930efa15638eb"></a><!-- doxytag: member="OTScriptable::VerifyNymAsAgent" ref="a242f30ff4c6deccf285930efa15638eb" args="(OTPseudonym &amp;theNym, OTPseudonym &amp;theSignerNym, mapOfNyms *pmap_ALREADY_LOADED=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a242f30ff4c6deccf285930efa15638eb">OTScriptable::VerifyNymAsAgent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *&#160;</td>
          <td class="paramname"><em>pmap_ALREADY_LOADED</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a55854189c875ce691374dd49f8de0494">OTAgreement</a>, and <a class="el" href="class_o_t_trade.html#a821c6861fd2da5ebd81f7b9d078c8af7">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01205">1205</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// (COmmented out) existing trades / payment plans on OT basically just have this one line:</span>
    <span class="comment">//</span>
    <span class="comment">// this-&gt;VerifySignature(theNym)</span>

    <span class="comment">// ----------------------------------------------------</span>
    <span class="comment">// NEW VERSION:</span>
    <span class="comment">/*</span>
<span class="comment">     Proves the original party DOES approve of Nym:</span>
<span class="comment"></span>
<span class="comment">     1) Lookup the party for this Nym, (loop to see if Nym is listed as an agent by any party.)</span>
<span class="comment">     2) If party found, lookup authorizing agent for party, loading him if necessary.</span>
<span class="comment">     3) Use authorizing agent to verify signature on original copy of this contract. Each party stores their</span>
<span class="comment">        own copy of the agreement, therefore use that copy to verify signature, instead of the current version.</span>
<span class="comment"></span>
<span class="comment">     This proves that the original authorizing agent for the party that lists Nym as an agent HAS signed the smart contract.</span>
<span class="comment">     (As long as that same party OWNS the account, that should be fine.)</span>
<span class="comment">     Obviously the best proof is to verify the ORIGINAL version of the contract against the PARTY&#39;S ORIGINAL SIGNED COPY,</span>
<span class="comment">     and also to verify them AGAINST EACH OTHER.  The calling function should do this. Otherwise what if the &quot;authorized signer&quot;</span>
<span class="comment">     has been changed, and some new guy and signature are substituted? Well, I guess as long as he really is authorized... but</span>
<span class="comment">     you simply don&#39;t know what the original agreement really says unless you look at it.  So load it and use it to call THIS METHOD.</span>
<span class="comment">     */</span>

    <span class="comment">// (1)</span>
    <span class="comment">// This step verifies that theNym is at least REGISTERED as a valid agent for the party. (According to the party.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = this-&gt;<a class="code" href="class_o_t_scriptable.html#aa89029542587094cd2844cb8bf7a9a16">FindPartyBasedOnNymAsAgent</a>(theNym);

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Unable to find party based on Nym as agent.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Below this point, pParty is good.</span>
    <span class="comment">// --------------------------------------------------</span>

    <span class="comment">// This party hasn&#39;t signed the contract??</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Unable to find party&#39;s (%s) signed copy of &quot;</span>
                       <span class="stringliteral">&quot;this contract. Has it been executed?\n&quot;</span>, pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, we know that pParty has a signed copy of the agreement (or of SOMETHING anyway) and we know that</span>
    <span class="comment">// we were able to find the party based on theNym as one of its agents. But the signature still needs to be verified...</span>

    <span class="comment">// (2)</span>
    <span class="comment">// This step verifies that the party has been signed by its authorizing agent. (Who may not be the Nym, yet might be.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_agent.html">OTAgent</a>     * pAuthorizingAgent = NULL;
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pAuthAgentsNym    = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPseudonym&gt;</a> theAgentNymAngel;

    <span class="comment">// See if theNym is the authorizing agent.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((<span class="keyword">false</span> == pParty-&gt;<a class="code" href="class_o_t_party.html#aa34fe1901531ed5056633b99fade0f93">HasAuthorizingAgent</a>(theNym, &amp;pAuthorizingAgent)) &amp;&amp;
        (NULL  != pmap_ALREADY_LOADED))
    {
        <span class="comment">// No? Okay then, let&#39;s see if the authorizing agent is one of these already loaded.</span>
        <span class="comment">// (So we don&#39;t load it twice.)</span>
        <span class="comment">//</span>
        <a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp; map_Nyms_Already_Loaded = (*pmap_ALREADY_LOADED);
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a>, map_Nyms_Already_Loaded)
        {
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
            <span class="comment">// -----------------------------</span>

            <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#aa34fe1901531ed5056633b99fade0f93">HasAuthorizingAgent</a>(*pNym, &amp;pAuthorizingAgent))
            {
                pAuthAgentsNym = pNym; <span class="comment">// Just in case.</span>
                <span class="keywordflow">break</span>;
            }
        }
        <span class="comment">// if pAuthorizingAgent != NULL, that means the authorizing agent was found among the map of nyms that were already loaded.</span>
    }

    <span class="comment">// Still not found?</span>
    <span class="keywordflow">if</span> (NULL == pAuthorizingAgent)
    {
        <span class="comment">// Of all of a party&#39;s Agents, the &quot;authorizing agent&quot; is the one who originally activated</span>
        <span class="comment">// the agreement for this party (and fronted the opening trans#.) Since we need to verify his</span>
        <span class="comment">// signature, we have to load him up.</span>
        <span class="comment">//</span>
        pAuthAgentsNym = pParty-&gt;<a class="code" href="class_o_t_party.html#a01988fe0bfd917703214f7f7bf3ba66f">LoadAuthorizingAgentNym</a>(theSignerNym, &amp;pAuthorizingAgent);

        <span class="keywordflow">if</span> (NULL != pAuthAgentsNym) <span class="comment">// success</span>
        {
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pAuthorizingAgent); <span class="comment">// This HAS to be set now. I assume it henceforth.</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: I just had to load the authorizing agent&#39;s Nym for a party (%s), &quot;</span>
                          <span class="stringliteral">&quot;so I guess it wasn&#39;t already available on the list of Nyms that were already loaded.\n&quot;</span>,
                           pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            theAgentNymAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pAuthAgentsNym);  <span class="comment">// CLEANUP!!</span>
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Error: Strange, unable to load authorizing &quot;</span>
                         <span class="stringliteral">&quot;agent&#39;s Nym for party %s (to verify his signature.)\n&quot;</span>, pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>();
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// Below this point, we KNOW that pAuthorizingAgent is a good pointer and will be cleaned up properly/automatically.</span>
    <span class="comment">// I&#39;m not using pAuthAgentsNym directly, but pAuthorizingAgent WILL use it before this function is done.</span>
    <span class="comment">// -----------------------------------------</span>

    <span class="comment">// TODO: Verify the opening transaction # here, like I do in VerifyPartyAuthorization() ??  Research first.</span>

    <span class="comment">// (3)</span>
    <span class="comment">// Here, we use the Authorizing Agent to verify the signature on his party&#39;s version of the contract.</span>
    <span class="comment">// Notice: Even if the authorizing agent gets fired, we can still load his Nym to verify the original signature on the</span>
    <span class="comment">// original contract! We should ALWAYS be able to verify our signatures!  Therefore, TODO: When a Nym is DELETED, it&#39;s necessary</span>
    <span class="comment">// to KEEP the public key on file. We may not have a Nymfile with any request #s or trans# signed out, and there are may be no</span>
    <span class="comment">// accounts for him, but we still need that public key, for later verification of the signature.</span>
    <span class="comment">// UNLESS... the public key ITSELF is stashed into the contract... Notice that normal asset contracts already keep the keys inside,</span>
    <span class="comment">// so why shouldn&#39;t these? In fact I can pop the &quot;key&quot; value onto the contract as part of the &quot;Party-Signing&quot; API call. Just grab the</span>
    <span class="comment">// public key from each one. Meanwhile the server can verify that it&#39;s actually there, and refuse to process without it!!  Nice.</span>
    <span class="comment">// This also shows why we need to store the NymID, even if it can be overridden by a Role: because you want to be able to verify</span>
    <span class="comment">// the original signature, no matter WHO is authorized now. Otherwise your entire contract falls apart.</span>

    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pPartySignedCopy = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>());
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theCopyAngel;

    <span class="keywordflow">if</span> (NULL == pPartySignedCopy)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Error loading party&#39;s (%s) signed copy of agreement. Has it been executed?\n&quot;</span>,
                      pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        theCopyAngel.SetCleanupTarget(*pPartySignedCopy);
    <span class="comment">// ----------------------------------------------</span>

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSigVerified = pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a63316db5c765344066a18d87e39cef60">VerifySignature</a>(*pPartySignedCopy);
    <span class="keywordtype">bool</span> bContentsVerified = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (bSigVerified)
    {
        <span class="comment">// Todo OPTIMIZE: Might move this call to a higher layer, so it gets called MUCH less often but retains the same security.</span>
        <span class="comment">// There are several places currently in smart contracts like this.</span>
        <span class="comment">// Need to analyze security aspects before doing it.</span>
        <span class="comment">//</span>
        bContentsVerified = this-&gt;<a class="code" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">Compare</a>(*pPartySignedCopy);

        <span class="keywordflow">if</span> (!bContentsVerified)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Though the signature verifies, the contract &quot;</span>
                           <span class="stringliteral">&quot;signed by the party (%s) doesn&#39;t match this contract. (Failed comparison.)\n&quot;</span>,
                           pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgent: Signature failed to verify for party: %s \n&quot;</span>,
                       pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());


    <span class="comment">// Todo: possibly call this-&gt;Compare(*pPartySignedCopy); to make sure there&#39;s no funny business.</span>
    <span class="comment">// Well actually that HAS to happen anyway, it&#39;s just a question of whether it goes here too, or only somewhere else.</span>
    <span class="comment">// ----------------------------------------------</span>

    pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// We loaded a Nym ourselves, which goes out of scope after this function. The party is done</span>
                                    <span class="comment">// with it now, and we don&#39;t want it to keep pointing to something that is now going out of scope.</span>

    <span class="keywordflow">return</span> bContentsVerified;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a844de5b0eb2560a28bf795c2c4da3f3b"></a><!-- doxytag: member="OTScriptable::VerifyNymAsAgentForAccount" ref="a844de5b0eb2560a28bf795c2c4da3f3b" args="(OTPseudonym &amp;theNym, OTAccount &amp;theAccount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a844de5b0eb2560a28bf795c2c4da3f3b">OTScriptable::VerifyNymAsAgentForAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_account.html">OTAccount</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a306ad448347dffd754fa04ca41473f4b">OTAgreement</a>, and <a class="el" href="class_o_t_trade.html#ab1bb54a55733cfe8a996f58b6b43f216">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01499">1499</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="comment">// Lookup the party via the NYM.</span>
    <span class="comment">// NOTE: I think without this, the agent never gets its pointer set to Nym.  FYI.</span>
    <span class="comment">// OTAgent * pAgent = NULL;</span>
<span class="comment">//  const   OTParty * pNymParty = this-&gt;FindPartyBasedOnNymAsAgent(theNym, &amp;pAgent);</span>
<span class="comment">//</span>
<span class="comment">//  if (NULL == pNymParty)</span>
<span class="comment">//  {</span>
<span class="comment">//      OT_ASSERT(NULL != pAgent);</span>
<span class="comment">//      OTLog::Output(0, &quot;OTScriptable::VerifyNymAsAgentForAccount: Unable to find party based on Nym as agent.\n&quot;);</span>
<span class="comment">//      return false;</span>
<span class="comment">//  }</span>
    <span class="comment">// Below this point, pAgent is a good pointer.</span>
    <span class="comment">//</span>
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="comment">// Lookup the party via the ACCOUNT.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a>  * pPartyAcct    = NULL;
    <a class="code" href="class_o_t_party.html">OTParty</a>         * pParty        = this-&gt;<a class="code" href="class_o_t_scriptable.html#adf3ca54a95c8813c23cf7bdc23e4330a">FindPartyBasedOnAccount</a>(theAccount, &amp;pPartyAcct);

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPartyAcct);
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgentForAccount: Unable to find party based on account.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// pPartyAcct is a good pointer below this point.</span>

    <span class="comment">// -------------------------------------------------------------</span>

    <span class="comment">// Verify ownership.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;<a class="code" href="class_o_t_party.html#a34d26cfe50e7065718c0360b42ca20ef">VerifyOwnershipOfAccount</a>(theAccount))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgentForAccount: pParty is not the owner of theAccount.\n&quot;</span>);
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// Just in case.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// -------------------------------------------------------------</span>

    <span class="keyword">const</span>   std::string str_acct_agent_name = pPartyAcct-&gt;  GetAgentName().Get();
            <a class="code" href="class_o_t_agent.html">OTAgent</a> *   pAgent              = pParty-&gt;      <a class="code" href="class_o_t_scriptable.html#a8f8c32df22c81d1a5aec3e483089b923">GetAgent</a>(str_acct_agent_name);

    <span class="comment">// Make sure they are from the SAME PARTY.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL == pAgent)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgentForAccount: Unable to find the right agent for this account.\n&quot;</span>);
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// Just in case.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Below this point, pPartyAcct is a good pointer, and so is pParty, as well as pAgent</span>
    <span class="comment">// We also know that the agent&#39;s name is the same one that was listed on the account as authorized.</span>
    <span class="comment">// (Because we used the account&#39;s agent_name to look up pAgent in the first place.)</span>
    <span class="comment">// -------------------------------------------------------------</span>

    <span class="comment">// Make sure theNym is a valid signer for pAgent, whether representing himself as in individual, or in a role for an entity.</span>
    <span class="comment">// This means that pAgent (looked up based on partyAcct&#39;s agent name) will return true to IsValidSigner when passed theNym,</span>
    <span class="comment">// assuming theNym really is the agent that partyAcct was talking about.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAgent-&gt;<a class="code" href="class_o_t_agent.html#a2039e8ad981abeecabf0a3aa412a3a9f">IsValidSigner</a>(theNym))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgentForAccount: theNym is not a valid signer for pAgent.\n&quot;</span>);
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// Just in case.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAgent-&gt;<a class="code" href="class_o_t_agent.html#a0ebeaa707c5793be4ac3c1a906f89f7c">VerifyAgencyOfAccount</a>(theAccount))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTScriptable::VerifyNymAsAgentForAccount: theNym is not a valid agent for theAccount.\n&quot;</span>);
        pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// Just in case.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }


<span class="comment">//  Now we know:</span>
    <span class="comment">// (1) theNym is agent for pParty,     (according to the party)</span>
    <span class="comment">// (2) theAccount is owned by pParty   (according to the party)</span>
    <span class="comment">// (3) theNym is agent for theAccount  (according to the party)</span>
    <span class="comment">// (4) theNym is valid signer for pAgent</span>
    <span class="comment">// (5) pParty is the actual OWNER of the account. (According to theAccount.)</span>


    pParty-&gt;<a class="code" href="class_o_t_party.html#a41a428ded2f0477cf8752648cbe51e4e">ClearTemporaryPointers</a>(); <span class="comment">// Just in case.</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1cd358deb75bfc2d39cbba6a4a4799f6"></a><!-- doxytag: member="OTScriptable::VerifyPartyAcctAuthorization" ref="a1cd358deb75bfc2d39cbba6a4a4799f6" args="(OTPartyAccount &amp;thePartyAcct, OTPseudonym &amp;theSignerNym, const OTString &amp;strServerID, const bool bBurnTransNo=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a1cd358deb75bfc2d39cbba6a4a4799f6">OTScriptable::VerifyPartyAcctAuthorization</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_party_account.html">OTPartyAccount</a> &amp;&#160;</td>
          <td class="paramname"><em>thePartyAcct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bBurnTransNo</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01387">1387</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = thePartyAcct.<a class="code" href="class_o_t_party_account.html#a018ef4f5d66227cd23fc6a323db4b669">GetParty</a>();

    <span class="keywordflow">if</span> (NULL == pParty)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTScriptable::%s: Unable to find party for acct: %s \n&quot;</span>,
                      __FUNCTION__, thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------</span>
    <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAuthorizedAgent = thePartyAcct.<a class="code" href="class_o_t_party_account.html#ad8c523b08a478e4071bb2b3ca85749b1">GetAuthorizedAgent</a>();

    <span class="keywordflow">if</span> (NULL == pAuthorizedAgent)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: Unable to find authorized agent (%s) for acct: %s \n&quot;</span>,
                       __FUNCTION__, thePartyAcct.<a class="code" href="class_o_t_party_account.html#a86975046b18ac6d6c5841f5ba0befe69">GetAgentName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------</span>
    <span class="comment">// BELOW THIS POINT, pParty and pAuthorizedAgent are both good pointers.</span>
    <span class="comment">//</span>
    <span class="comment">// Next, we need to verify that pParty is the proper OWNER of thePartyAcct..</span>
    <span class="comment">//</span>
    <span class="comment">// AND that pAuthorizedAgent really IS authorized to manipulate the actual</span>
    <span class="comment">// account itself. (Either he is listed as its actual owner, or he is an</span>
    <span class="comment">// agent for an entity, authorized based on a specific role, and the account</span>
    <span class="comment">// is owned by that entity / controlled by that role.)</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------</span>
    <span class="comment">// VERIFY ACCOUNT&#39;s OWNERSHIP BY PARTY</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!thePartyAcct.<a class="code" href="class_o_t_party_account.html#a126d14e990b067acb6a4149ee4639b43">VerifyOwnership</a>())  <span class="comment">// This will use pParty internally.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: Unable to verify party&#39;s (%s) ownership of acct: %s \n&quot;</span>,
                      __FUNCTION__, pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str(), thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------</span>
    <span class="comment">// VERIFY ACCOUNT&#39;s AUTHORIZED AGENT (that he has rights to manipulate the account itself)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!thePartyAcct.<a class="code" href="class_o_t_party_account.html#ae1ede2f4ff5e29ab6a46c6fedff21bd3">VerifyAgency</a>()) <span class="comment">// This will use pAuthorizedAgent internally.</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: Unable to verify agent&#39;s (%s) rights re: acct: %s \n&quot;</span>,
                       __FUNCTION__, pAuthorizedAgent-&gt;<a class="code" href="class_o_t_agent.html#a123d27f05e46977ecdbe0b83de3c119d">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// **************************************************</span>

    <span class="comment">//     Verify the closing number, if he has one. (If this instance is OTScriptable-derived, but NOT OTCronItem-derived,</span>
    <span class="comment">//     then that means there IS NO closing number, since we&#39;re not even on Cron.) The PartyAccts just happen</span>
    <span class="comment">//     to store their closing number for the cases where we ARE on Cron, which will probably be most cases.</span>
    <span class="comment">//     Therefore we CHECK TO SEE if the closing number is NONZERO -- and if so, we VERIFY ISSUED on that #. That way,</span>
    <span class="comment">//     for cases where this IS a cron item, it will still verify the number (as it should) and in other cases, it will</span>
    <span class="comment">//     just skip this step.</span>
    <span class="comment">//</span>
    <span class="comment">//     Also: If bBurnTransNo is set to true, then it will force this issue, since the code then DEMANDS a number</span>
    <span class="comment">//     be available for use.</span>

    <span class="keyword">const</span> int64_t lClosingNo = thePartyAcct.<a class="code" href="class_o_t_party_account.html#add572c3b200be9265d9dcc4a1b1f4185">GetClosingTransNo</a>();

    <span class="keywordflow">if</span> (lClosingNo &gt; 0) <span class="comment">// If one exists, then verify it.</span>
    {
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAuthorizedAgent-&gt;<a class="code" href="class_o_t_agent.html#aa5175fb8a0a26e3b5cb7ea54ba3c2f7e">VerifyIssuedNumber</a>(lClosingNo, strServerID))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: Closing trans number %lld doesn&#39;t &quot;</span>
                           <span class="stringliteral">&quot;verify for the nym listed as the authorized agent for account %s.\n&quot;</span>, __FUNCTION__,
                           lClosingNo, thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// The caller wants the additional verification that the number hasn&#39;t been USED</span>
        <span class="comment">// yet -- AND the caller wants you to BURN IT HERE.</span>
        <span class="comment">//</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bBurnTransNo)
        {
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAuthorizedAgent-&gt;<a class="code" href="class_o_t_agent.html#adb89b362ce9a7100d4bd736d8e54d92a">VerifyTransactionNumber</a>(lClosingNo, strServerID))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: Closing trans number %lld doesn&#39;t &quot;</span>
                               <span class="stringliteral">&quot;verify as available for use, for the nym listed as the authorized agent for acct: %s.\n&quot;</span>,
                               __FUNCTION__, lClosingNo, thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span><span class="comment">// SUCCESS -- It verified as available, so let&#39;s burn it here. (So he can&#39;t use it twice. It remains</span>
            {   <span class="comment">// issued and open until the cron item is eventually closed out for good.)</span>
                <span class="comment">//</span>
                <span class="comment">// NOTE: This also adds lClosingNo to the agent&#39;s nym&#39;s GetSetOpenCronItems.</span>
                <span class="comment">//</span>
                pAuthorizedAgent-&gt;<a class="code" href="class_o_t_agent.html#a6e4e4cc1971996a8da677b1c789a324e">RemoveTransactionNumber</a>(lClosingNo, strServerID, theSignerNym, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
            }
        }
        <span class="comment">// ---------------------</span>
    } <span class="comment">// if lClosingNo&gt;0</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bBurnTransNo)  <span class="comment">// In this case, bBurnTransNo=true, then the caller EXPECTED to burn a transaction</span>
    {                       <span class="comment">// num. But the number was 0! Therefore, FAILURE!</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTScriptable::%s: FAILURE. On Acct %s, expected to burn a legitimate closing transaction &quot;</span>
                       <span class="stringliteral">&quot;number, but got this instead: %lld\n&quot;</span>, __FUNCTION__, thePartyAcct.<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), lClosingNo);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5b20bcf70883ffe7e02f10343b88affc"></a><!-- doxytag: member="OTScriptable::VerifyPartyAuthorization" ref="a5b20bcf70883ffe7e02f10343b88affc" args="(OTParty &amp;theParty, OTPseudonym &amp;theSignerNym, const OTString &amp;strServerID, mapOfNyms *pmap_ALREADY_LOADED=NULL, mapOfNyms *pmap_NEWLY_LOADED=NULL, const bool bBurnTransNo=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a5b20bcf70883ffe7e02f10343b88affc">OTScriptable::VerifyPartyAuthorization</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_party.html">OTParty</a> &amp;&#160;</td>
          <td class="paramname"><em>theParty</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *&#160;</td>
          <td class="paramname"><em>pmap_ALREADY_LOADED</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *&#160;</td>
          <td class="paramname"><em>pmap_NEWLY_LOADED</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bBurnTransNo</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l00979">979</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// This function DOES assume that theParty was initially FOUND on OTScriptable.</span>
    <span class="comment">// Meaning I don&#39;t have to verify that much if I got this far.</span>
    <span class="comment">// --------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNeedToCleanup = (NULL == pmap_NEWLY_LOADED) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
    <span class="comment">// --------------------------------------------------</span>
    <span class="comment">// This party hasn&#39;t signed the contract??</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theParty.<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to find party&#39;s signed copy of this contract. Has it been executed?\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, we know that theParty has a signed copy of the agreement (or of SOMETHING anyway) and we know that</span>
    <span class="comment">// we were able to find the party based on theNym as one of its agents. But the signature still needs to be verified...</span>

    <span class="comment">// (2)</span>
    <span class="comment">// This step verifies that the party has been signed by its authorizing agent. (Who may not be the Nym, yet might be.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_agent.html">OTAgent</a>     * pAuthorizingAgent = NULL;
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pAuthAgentsNym    = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPseudonym&gt;</a> theAgentNymAngel; <span class="comment">// In case I have to load it myself, I want it cleaned up properly.</span>

    <span class="comment">// Some nyms are *already* loaded. If any were passed in, let&#39;s see if any of them are</span>
    <span class="comment">// the authorizing agent for the contract (for this party)...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL != pmap_ALREADY_LOADED)
    {
        <span class="comment">// (So we don&#39;t load it twice, if it&#39;s there.)</span>
        <span class="comment">//</span>
        <a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp; map_Nyms_Already_Loaded = (*pmap_ALREADY_LOADED);

        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a>, map_Nyms_Already_Loaded)
        {
            <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = (*it).second;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pNym);
            <span class="comment">// -----------------------------</span>
            <span class="keywordflow">if</span> (theParty.<a class="code" href="class_o_t_party.html#aa34fe1901531ed5056633b99fade0f93">HasAuthorizingAgent</a>(*pNym, &amp;pAuthorizingAgent))
            {
                pAuthAgentsNym = pNym; <span class="comment">// Just in case</span>
                <span class="keywordflow">break</span>;
            }
        }
        <span class="comment">// if pAuthorizingAgent != NULL, that means the authorizing agent was found among the map of nyms that were already loaded.</span>
    }
    <span class="comment">// -------------------------------------------------------------------------------------</span>
    <span class="comment">// Only if I had to load the authorizing agent myself, do I clear its temporary pointer.</span>
    <span class="comment">// (Because it&#39;s going out of scope at the bottom of this function.)</span>
    <span class="comment">// Any other temporary pointers, I do NOT clear, but I leave them because a script is</span>
    <span class="comment">// probably executing and may still need them.</span>
    <span class="comment">// (This function that we&#39;re in was expressly called by someone who didn&#39;t want the</span>
    <span class="comment">// temporary nym pointers cleared just yet, for whatever reason.)</span>
    <span class="comment">//</span>
    <span class="keywordtype">bool</span> bHadToLoadItMyself = (NULL == pAuthorizingAgent) ? <span class="keyword">true</span> : <span class="keyword">false</span>;

    <span class="comment">// Still not found? Okay, let&#39;s LOAD IT UP then...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bHadToLoadItMyself)
    {
        <span class="comment">// Of all of a party&#39;s Agents, the &quot;authorizing agent&quot; is the one who originally activated</span>
        <span class="comment">// the agreement for this party (and fronted the opening trans#.) Since we need to verify his</span>
        <span class="comment">// signature, we have to load him up.</span>
        <span class="comment">//</span>
        pAuthAgentsNym = theParty.<a class="code" href="class_o_t_party.html#a01988fe0bfd917703214f7f7bf3ba66f">LoadAuthorizingAgentNym</a>(theSignerNym, &amp;pAuthorizingAgent);

        <span class="keywordflow">if</span> (NULL != pAuthAgentsNym) <span class="comment">// success</span>
        {
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pAuthorizingAgent); <span class="comment">// This HAS to be set now. I assume it henceforth.</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: I just had to load &quot;</span>
                           <span class="stringliteral">&quot;the authorizing agent&#39;s Nym for a party (%s), &quot;</span>
                           <span class="stringliteral">&quot;so I guess it wasn&#39;t already available on the list of &quot;</span>
                           <span class="stringliteral">&quot;Nyms that were already loaded.\n&quot;</span>,
                           __FUNCTION__, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            <span class="comment">// ----------------------------------------------------</span>
            <span class="comment">// Either I&#39;m DEFINITELY cleaning it up myself, OR I&#39;m adding it to a list</span>
            <span class="comment">// where the CALLER can clean it up.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bNeedToCleanup)
                theAgentNymAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pAuthAgentsNym);  <span class="comment">// CLEANUP!!</span>
            <span class="keywordflow">else</span>
            {
                <span class="keyword">const</span>
                std::string str_agent_name = pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a123d27f05e46977ecdbe0b83de3c119d">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

                <a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp; map_Nyms_Newly_Loaded = (*pmap_NEWLY_LOADED);
                map_Nyms_Newly_Loaded.insert(map_Nyms_Newly_Loaded.begin(),
                                             std::pair&lt;std::string, OTPseudonym *&gt;(str_agent_name, pAuthAgentsNym)); <span class="comment">// (Caller must clean these up.)</span>
            }
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Strange, unable to load authorizing agent&#39;s Nym (to verify his signature.)\n&quot;</span>,
                          __FUNCTION__);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// Below this point, we KNOW that pAuthorizingAgent is a good pointer and will be cleaned up properly/automatically.</span>
    <span class="comment">// I&#39;m not using pAuthAgentsNym directly, but pAuthorizingAgent WILL use it before this function is done.</span>
    <span class="comment">// -----------------------------------------</span>

    <span class="comment">// (3) Verify the issued number, if he has one. If this instance is OTScriptable-derived, but NOT OTCronItem-derived,</span>
    <span class="comment">//     then that means there IS NO opening number (or closing number) since we&#39;re not even on Cron. The parties just</span>
    <span class="comment">//     happen to store their opening number for the cases where we ARE on Cron, which will probably be most cases.</span>
    <span class="comment">//     Therefore we CHECK TO SEE if the opening number is NONZERO -- and if so, we VERIFY ISSUED on that #. That way,</span>
    <span class="comment">//     for cases where this IS a cron item, it will still verify the number (as it should) and in other cases, it will</span>
    <span class="comment">//     just skip this step.</span>
    <span class="comment">//</span>

    <span class="keyword">const</span> int64_t lOpeningNo = theParty.<a class="code" href="class_o_t_party.html#aa11f990dfe9743dd1d8e34af8bfd693a">GetOpeningTransNo</a>();

    <span class="keywordflow">if</span> (lOpeningNo &gt; 0) <span class="comment">// If one exists, then verify it.</span>
    {
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#aa5175fb8a0a26e3b5cb7ea54ba3c2f7e">VerifyIssuedNumber</a>(lOpeningNo, strServerID))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Opening trans number %lld doesn&#39;t &quot;</span>
                          <span class="stringliteral">&quot;verify for the nym listed as the authorizing agent for party %s.\n&quot;</span>,
                          __FUNCTION__, lOpeningNo, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
            <span class="keywordflow">if</span> (bHadToLoadItMyself &amp;&amp; bNeedToCleanup)
                pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a90211a756315e750b9e658bc6a224f0e">ClearTemporaryPointers</a>(); <span class="comment">// We loaded the Nym ourselves, which goes out of scope after this function.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// --------------------------------------</span>
        <span class="comment">// The caller wants the additional verification that the number hasn&#39;t been USED</span>
        <span class="comment">// yet -- AND the caller wants you to BURN IT HERE.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bBurnTransNo)
        {
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#adb89b362ce9a7100d4bd736d8e54d92a">VerifyTransactionNumber</a>(lOpeningNo, strServerID))
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Opening trans number %lld doesn&#39;t &quot;</span>
                              <span class="stringliteral">&quot;verify as available for use, for the nym listed as the authorizing agent for party: %s.\n&quot;</span>,
                              __FUNCTION__, lOpeningNo, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
                <span class="keywordflow">if</span> (bHadToLoadItMyself &amp;&amp; bNeedToCleanup)
                    pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a90211a756315e750b9e658bc6a224f0e">ClearTemporaryPointers</a>(); <span class="comment">// We loaded the Nym ourselves, which goes out of scope after this function.</span>
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> <span class="comment">// SUCCESS -- It verified as available, so let&#39;s burn it here. (So he can&#39;t use it twice. It remains issued and open until the cron item is eventually closed out for good.)</span>
            {
                <span class="comment">// This function also adds lOpeningNo to the agent&#39;s nym&#39;s list of open cron items.</span>
                <span class="comment">// (OTPseudonym::GetSetOpenCronItems)</span>
                <span class="comment">//</span>
                pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a6e4e4cc1971996a8da677b1c789a324e">RemoveTransactionNumber</a>(lOpeningNo, strServerID, theSignerNym, <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
            }
        }
        <span class="comment">// ---------------------</span>
    } <span class="comment">// if lOpeningNo&gt;0</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bBurnTransNo)  <span class="comment">// In this case, bBurnTransNo=true, then the caller EXPECTED to burn a transaction</span>
    {                       <span class="comment">// num. But the number was 0! Therefore, FAILURE!</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: FAILURE. On Party %s, expected to burn a legitimate opening transaction &quot;</span>
                       <span class="stringliteral">&quot;number, but got this instead: %lld\n&quot;</span>, __FUNCTION__, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str(), lOpeningNo);
        <span class="keywordflow">if</span> (bHadToLoadItMyself &amp;&amp; bNeedToCleanup)
            pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a90211a756315e750b9e658bc6a224f0e">ClearTemporaryPointers</a>(); <span class="comment">// We loaded the Nym ourselves, which goes out of scope after this function.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// (4)</span>
    <span class="comment">// Here, we use the Authorizing Agent to verify the signature on his party&#39;s version of the contract.</span>
    <span class="comment">// Notice: Even if the authorizing agent gets fired, we can still load his Nym to verify the original signature on the</span>
    <span class="comment">// original contract! We should ALWAYS be able to verify our signatures!  Therefore, TODO: When a Nym is DELETED, it&#39;s necessary</span>
    <span class="comment">// to KEEP the public key on file. We may not have a Nymfile with any request #s or trans# signed out, and there are may be no</span>
    <span class="comment">// accounts for him, but we still need that public key, for later verification of the signature.</span>
    <span class="comment">// UNLESS... the public key ITSELF is stashed into the contract... Notice that normal asset contracts already keep the keys inside,</span>
    <span class="comment">// so why shouldn&#39;t these? In fact I can pop the &quot;key&quot; value onto the contract as part of the &quot;Party-Signing&quot; API call. Just grab the</span>
    <span class="comment">// public key from each one. Meanwhile the server can verify that it&#39;s actually there, and refuse to process without it!!  Nice.</span>
    <span class="comment">// This also shows why we need to store the NymID, even if it can be overridden by a Role: because you want to be able to verify</span>
    <span class="comment">// the original signature, no matter WHO is authorized now. Otherwise your entire contract falls apart.</span>

    <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pPartySignedCopy = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(theParty.<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>());
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theCopyAngel;

    <span class="keywordflow">if</span> (NULL == pPartySignedCopy)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading party&#39;s signed copy of agreement. Has it been executed?\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">if</span> (bHadToLoadItMyself &amp;&amp; bNeedToCleanup)
            pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a90211a756315e750b9e658bc6a224f0e">ClearTemporaryPointers</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
    {
        theCopyAngel.SetCleanupTarget(*pPartySignedCopy);
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSigVerified = pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a63316db5c765344066a18d87e39cef60">VerifySignature</a>(*pPartySignedCopy);
<span class="comment">//  const bool bSigVerified = pPartySignedCopy-&gt;VerifySignature(*pAuthAgentsNym);</span>
    <span class="keywordtype">bool</span> bContentsVerified = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (bSigVerified)
    {
        <span class="comment">// Todo OPTIMIZE: Might move this call to a higher layer, so it gets called MUCH less often but retains the same security.</span>
        <span class="comment">// There are several places currently in smart contracts like this.</span>
        <span class="comment">// Need to analyze security aspects before doing it.</span>
        <span class="comment">//</span>
        bContentsVerified = this-&gt;<a class="code" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">Compare</a>(*pPartySignedCopy); <span class="comment">// This also compares the opening / closing numbers, if they are non-zero.</span>

        <span class="keywordflow">if</span> (!bContentsVerified)
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Though the signature verifies, the contract &quot;</span>
                           <span class="stringliteral">&quot;signed by the party (%s) doesn&#39;t match this contract. (Failed comparison.)\n&quot;</span>,
                           __FUNCTION__, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Signature failed to verify for party: %s \n&quot;</span>,
                       __FUNCTION__, theParty.<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>().c_str());
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">if</span> (bHadToLoadItMyself &amp;&amp; bNeedToCleanup)
        pAuthorizingAgent-&gt;<a class="code" href="class_o_t_agent.html#a90211a756315e750b9e658bc6a224f0e">ClearTemporaryPointers</a>(); <span class="comment">// We loaded the Nym ourselves, which goes out of scope after this function.</span>
    <span class="comment">//The party is done with it now, and we don&#39;t want it to keep pointing to something that is now going out of scope.</span>

    <span class="keywordflow">return</span> bContentsVerified;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae83de8305c791c41e58e888cb873def0"></a><!-- doxytag: member="OTScriptable::VerifyThisAgainstAllPartiesSignedCopies" ref="ae83de8305c791c41e58e888cb873def0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#ae83de8305c791c41e58e888cb873def0">OTScriptable::VerifyThisAgainstAllPartiesSignedCopies</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8cpp_source.html#l01830">1830</a> of file <a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bReturnVal = (<a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>.size() &gt; 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;

    <span class="comment">// MAKE SURE ALL SIGNED COPIES ARE OF THE SAME CONTRACT.</span>
    <span class="comment">// Loop through ALL the parties. For whichever ones are already signed,</span>
    <span class="comment">// load up the signed copy and make sure it compares to the main one.</span>
    <span class="comment">// This is in order to make sure that I am signing the same thing that</span>
    <span class="comment">// everyone else signed, before I actually sign it.</span>
    <span class="comment">//</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a>, <a class="code" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">m_mapParties</a>)
    {
        <span class="keyword">const</span> std::string current_party_name = (*it).first;
        <a class="code" href="class_o_t_party.html">OTParty</a> * pParty                     = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pParty);
        <span class="comment">// ---------------</span>
        <span class="keywordflow">if</span> (pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pPartySignedCopy = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>());
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theCopyAngel;

            <span class="keywordflow">if</span> (NULL == pPartySignedCopy)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading party&#39;s (%s) signed copy of agreement. Has it been executed?\n&quot;</span>,
                              __FUNCTION__, current_party_name.c_str());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span>
                theCopyAngel.SetCleanupTarget(*pPartySignedCopy);
            <span class="comment">// ----------------------</span>
            <span class="keywordflow">if</span> ( ! this-&gt;<a class="code" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">Compare</a>(*pPartySignedCopy) )   <span class="comment">// &lt;==== For all signed copies, we compare them to *this.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Party&#39;s (%s) signed copy of agreement doesn&#39;t match *this.\n&quot;</span>,
                              __FUNCTION__, current_party_name.c_str());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
        <span class="comment">// else nothing. (We only verify against the ones that are signed.)</span>
    } <span class="comment">// FOR_EACH</span>
    <span class="comment">// ---------------</span>
    <span class="keywordflow">return</span> bReturnVal;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a217fc906e2d6475e22913bd8653ffaa2"></a><!-- doxytag: member="OTScriptable::m_bCalculatingID" ref="a217fc906e2d6475e22913bd8653ffaa2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a217fc906e2d6475e22913bd8653ffaa2">OTScriptable::m_bCalculatingID</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00195">195</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="acea6ed68ee05f67a19caa03fcab92b49"></a><!-- doxytag: member="OTScriptable::m_bSpecifyAssetID" ref="acea6ed68ee05f67a19caa03fcab92b49" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#acea6ed68ee05f67a19caa03fcab92b49">OTScriptable::m_bSpecifyAssetID</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00197">197</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8e92c7502904b0e3ac00abc672e7f942"></a><!-- doxytag: member="OTScriptable::m_bSpecifyParties" ref="a8e92c7502904b0e3ac00abc672e7f942" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_scriptable.html#a8e92c7502904b0e3ac00abc672e7f942">OTScriptable::m_bSpecifyParties</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00198">198</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="abd086b417d7222947b26a63aee80d501"></a><!-- doxytag: member="OTScriptable::m_mapBylaws" ref="abd086b417d7222947b26a63aee80d501" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_bylaw_8hpp.html#ae1c6a97f4f9673e07292cd88ef39b450">mapOfBylaws</a> <a class="el" href="class_o_t_scriptable.html#abd086b417d7222947b26a63aee80d501">OTScriptable::m_mapBylaws</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00151">151</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6a7e4ef3e0ed95f90d950b1718f815ab"></a><!-- doxytag: member="OTScriptable::m_mapParties" ref="a6a7e4ef3e0ed95f90d950b1718f815ab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_party_8hpp.html#a029bc6921acd4516530e26201cf595f2">mapOfParties</a> <a class="el" href="class_o_t_scriptable.html#a6a7e4ef3e0ed95f90d950b1718f815ab">OTScriptable::m_mapParties</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00150">150</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9e1d9c7e46bab582ea1922026a21b357"></a><!-- doxytag: member="OTScriptable::m_strLabel" ref="a9e1d9c7e46bab582ea1922026a21b357" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_string.html">OTString</a> <a class="el" href="class_o_t_scriptable.html#a9e1d9c7e46bab582ea1922026a21b357">OTScriptable::m_strLabel</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_scriptable_8hpp_source.html#l00203">203</a> of file <a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_scriptable_8hpp_source.html">OTScriptable.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_scriptable_8cpp_source.html">OTScriptable.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_scriptable.html">OTScriptable</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:15 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
