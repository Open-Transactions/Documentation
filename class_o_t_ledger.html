<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTLedger Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_ledger.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">OTLedger Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTLedger" --><!-- doxytag: inherits="OTTransactionType" -->
<p><code>#include &lt;<a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTLedger:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_ledger.png" usemap="#OTLedger_map" alt=""/>
  <map id="OTLedger_map" name="OTLedger_map">
<area href="class_o_t_transaction_type.html" alt="OTTransactionType" shape="rect" coords="0,56,123,80"/>
<area href="class_o_t_contract.html" alt="OTContract" shape="rect" coords="0,0,123,24"/>
</map>
 </div></div>

<p><a href="class_o_t_ledger-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> { <br/>
&#160;&#160;<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">nymbox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">inbox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">outbox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">message</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">paymentInbox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">recordBox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">expiredBox</a>, 
<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a">error_state</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a51b47d519c07ba297e6d87e840b21a19">LoadedLegacyData</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_item.html">OTItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a> (const int64_t lAdjustment, const <a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theOwner, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, const <a class="el" href="class_o_t_account.html">OTAccount</a> &amp;theAccount, <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theOutbox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ab39066df3f397573a6c840c114e94ed1">ProduceOutboxReport</a> (<a class="el" href="class_o_t_item.html">OTItem</a> &amp;theBalanceItem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a> (<a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theTransaction)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a> (int64_t lTransactionNum, bool bDeleteIt=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a> (const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> theType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a603c6175e9380fa5b2c4f577982fb9ab">GetTransaction</a> (int64_t lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a> (int32_t nIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ab4a37c7036b68bf5e4496848bddb1953">GetFinalReceipt</a> (int64_t lReferenceNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a4107700057144e2cc8719bbf1771e614">GetPaymentReceipt</a> (int64_t lReferenceNum, <a class="el" href="class_o_t_payment.html">OTPayment</a> **ppPaymentOut=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a82181e9dd053f165008b02b5827f784d">GetTransferReceipt</a> (int64_t lNumberOfOrigin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ac364836ff42d8a8d873050b86a72c7d9">GetChequeReceipt</a> (const int64_t lChequeNum, <a class="el" href="class_o_t_cheque.html">OTCheque</a> **ppChequeOut=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa45a9d3c7110327f47b2934574b0177d">GetTransactionIndex</a> (int64_t lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#abff95a14ed703447ec5557183f5dc91c">GetReplyNotice</a> (const int64_t &amp;lRequestNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_payment.html">OTPayment</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a114a4d31098807d6cb873a7343a407ae">GetInstrument</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, const int32_t &amp;nIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a0eb4102ef28704ac8518c6cf98ebc34d">LoadBoxReceipts</a> (std::set&lt; int64_t &gt; *psetUnloaded=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a304007b699192719d05c6e72ac1b580e">SaveBoxReceipts</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a> (const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a37b54e63ee359e0561662c5a76477225">SaveBoxReceipt</a> (const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aea09d3dd8bf2fc5630ce87184fc937c1">DeleteBoxReceipt</a> (const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a53d47cbd97a874f205dcfb1df75eba40">SaveInbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pInboxHash=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa77a7e498b3866d054b3c58fb6c8e7d7">LoadNymbox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa2dec5beccd6e4a55cfe45788ebd2137">SaveNymbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pNymboxHash=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a97cb4ada66ef13b442bfd69e0a9e0c25">SaveOutbox</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOutboxHash=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a994010d2cfcb8ca486b51159efdec2d4">CalculateHash</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a520421fca03ee9ccefe03dacf6589ecc">CalculateInboxHash</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#abc8bced33099b04f251040bf6a0b219c">CalculateOutboxHash</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aad762086bb009eacd8f60d7e078357a4">CalculateNymboxHash</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ab6f6af26a690d49f61ec7ffcc557a302">SavePaymentInbox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a2089e14094b2047e668bc50e2d5d3eb2">LoadPaymentInbox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aff379f9b12cebb1132bca402396f1a8a">SaveRecordBox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ad283d675ba07160bddde117386b872a6">LoadRecordBox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ace1cb1337e94d794243bbe163eb88813">SaveExpiredBox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a752b0776eed42abe1a48754d288bd79e">LoadExpiredBox</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theStr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#adee226f0dab7315814a65a6e08be7fb5">LoadInboxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a3a908c983d03a683590a228c80af3b4c">LoadOutboxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a7058093dd49939907c448cdf6c4a391a">LoadNymboxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#af96a6ae7202057dca8de1b9ab073efa3">LoadPaymentInboxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a9b860864e88843d90bc027c2d6faac4d">LoadRecordBoxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a3ca2a96eb490fa56d693487a228b25cf">LoadExpiredBoxFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strBox)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ac72aea8d3eb0d0e8e59a5b7eaa4fda6e">GetTransactionCountInRefTo</a> (const int64_t lReferenceNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#afe1dc4d292a140a025eab1c178b93a01">GetTotalPendingValue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa71b6540e2948a36e3c7d3e7d14547a5">GetTransactionMap</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a1b462e6f1bbf9991b662c48f09d7b505">OTLedger</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a6e9ca905b8f7a637cf10fadc826ae511">~OTLedger</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a7bc5480937407cd3fe47d643b015e464">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a39d56bb887c5d5acf1b8e353946a062f">Release_Ledger</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ade9cb07bcb99f244712fe948291fbb6c">ReleaseTransactions</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a9ebe60fcd10bef68cded25e1cad7b873">OTLedger</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a44d61f2c5bfafa42af7216a1736a996b">InitLedger</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a9c69a2bb95829215b942a571f410c8a4">GenerateLedger</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, const <a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> theType, bool bCreateFile=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a5c595ed0f34346f50f5fa821005ec376">SaveContractWallet</a> (std::ofstream &amp;ofs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT char const *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">GenerateLedger</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, const <a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> theType, bool bCreateFile=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT char const *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a45edcea1fb843a5aedcc3cd32c144522">_GetTypeString</a> (<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> theType)</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa46d52115b1ace7f7d6e752a99aaa186">ProcessXMLNode</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a693eb8428f49e984f7705adb12a56fc6">UpdateContents</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#aa5b00bde91a578e9c68b73015b362858">OTLedger</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a> (<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> theType, const <a class="el" href="class_o_t_string.html">OTString</a> *pString=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a> (<a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> theType)</td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_transaction_type.html">OTTransactionType</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_ledger.html#a50cdde745e8606b4c07fd2ca1a18251f">OTTransactionType::TransactionFactory</a> (<a class="el" href="class_o_t_string.html">OTString</a> strInput)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00159">159</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591a"></a><!-- doxytag: member="OTLedger::ledgerType" ref="ac03f2514d0c6ae00147c5d53bf19591a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">OTLedger::ledgerType</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae"></a><!-- doxytag: member="nymbox" ref="ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae" args="" -->nymbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006"></a><!-- doxytag: member="inbox" ref="ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006" args="" -->inbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4"></a><!-- doxytag: member="outbox" ref="ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4" args="" -->outbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916"></a><!-- doxytag: member="message" ref="ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916" args="" -->message</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984"></a><!-- doxytag: member="paymentInbox" ref="ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984" args="" -->paymentInbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922"></a><!-- doxytag: member="recordBox" ref="ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922" args="" -->recordBox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a"></a><!-- doxytag: member="expiredBox" ref="ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a" args="" -->expiredBox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a"></a><!-- doxytag: member="error_state" ref="ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a" args="" -->error_state</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00177">177</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">nymbox</a>,     <span class="comment">// the nymbox is per user account (versus per asset account) and is used to receive new transaction numbers (and messages.)</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">inbox</a>,      <span class="comment">// each asset account has an inbox, with pending transfers as well as receipts inside.</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">outbox</a>,     <span class="comment">// if you SEND a pending transfer, it sits in your outbox until it&#39;s accepted, rejected, or canceled.</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">message</a>,    <span class="comment">// used in OTMessages, to send various lists of transactions back and forth.</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">paymentInbox</a>,   <span class="comment">// Used for client-side-only storage of incoming cheques, invoices, payment plan requests, etc. (Coming in from the Nymbox.)</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">recordBox</a>,      <span class="comment">// Used for client-side-only storage of completed items from the inbox, and the paymentInbox.</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">expiredBox</a>,     <span class="comment">// Used for client-side-only storage of expired items from the paymentInbox.</span>
        <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a">error_state</a>
    };  <span class="comment">// If you add any types to this list, update the list of strings at the top of the .CPP file.</span>
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aa5b00bde91a578e9c68b73015b362858"></a><!-- doxytag: member="OTLedger::OTLedger" ref="aa5b00bde91a578e9c68b73015b362858" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#aa5b00bde91a578e9c68b73015b362858">OTLedger::OTLedger</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01078">1078</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                   : <a class="code" href="class_o_t_transaction_type.html#ac712d2e305c9a24c8d0dbbe7dce6b6ca">OTTransactionType</a>(), <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>), <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_ledger.html#a44d61f2c5bfafa42af7216a1736a996b">InitLedger</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1b462e6f1bbf9991b662c48f09d7b505"></a><!-- doxytag: member="OTLedger::OTLedger" ref="a1b462e6f1bbf9991b662c48f09d7b505" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#aa5b00bde91a578e9c68b73015b362858">OTLedger::OTLedger</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01056">1056</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: <a class="code" href="class_o_t_transaction_type.html#ac712d2e305c9a24c8d0dbbe7dce6b6ca">OTTransactionType</a>(theUserID, theAccountID, theServerID), <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>), <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_ledger.html#a44d61f2c5bfafa42af7216a1736a996b">InitLedger</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e9ca905b8f7a637cf10fadc826ae511"></a><!-- doxytag: member="OTLedger::~OTLedger" ref="a6e9ca905b8f7a637cf10fadc826ae511" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#a6e9ca905b8f7a637cf10fadc826ae511">OTLedger::~OTLedger</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l02425">2425</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html#a39d56bb887c5d5acf1b8e353946a062f">Release_Ledger</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9ebe60fcd10bef68cded25e1cad7b873"></a><!-- doxytag: member="OTLedger::OTLedger" ref="a9ebe60fcd10bef68cded25e1cad7b873" args="(const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#aa5b00bde91a578e9c68b73015b362858">OTLedger::OTLedger</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01067">1067</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: <a class="code" href="class_o_t_transaction_type.html#ac712d2e305c9a24c8d0dbbe7dce6b6ca">OTTransactionType</a>(), <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>), <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_ledger.html#a44d61f2c5bfafa42af7216a1736a996b">InitLedger</a>();

    <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(theAccountID);
    <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(theServerID);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a45edcea1fb843a5aedcc3cd32c144522"></a><!-- doxytag: member="OTLedger::_GetTypeString" ref="a45edcea1fb843a5aedcc3cd32c144522" args="(ledgerType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char const * <a class="el" href="class_o_t_ledger.html#a45edcea1fb843a5aedcc3cd32c144522">OTLedger::_GetTypeString</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00161">161</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                        {
    int32_t nType = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (theType);
    <span class="keywordflow">return</span> <a class="code" href="_o_t_account_8cpp.html#a26fff90a622c312ec2140eb6ae9f819c">__TypeStrings</a>[nType];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6befecfc9199e90d459f3c89f2f0dc14"></a><!-- doxytag: member="OTLedger::AddTransaction" ref="a6befecfc9199e90d459f3c89f2f0dc14" args="(OTTransaction &amp;theTransaction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">OTLedger::AddTransaction</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theTransaction</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01124">1124</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// See if there&#39;s something else already there with the same transaction number.</span>
    mapOfTransactions::iterator it = m_mapTransactions.find(theTransaction.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());

    <span class="comment">// If it&#39;s not already on the list, then add it...</span>
    <span class="keywordflow">if</span> ( it == m_mapTransactions.end() )
    {
        m_mapTransactions[theTransaction.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()] = &amp;theTransaction;
        theTransaction.<a class="code" href="class_o_t_transaction.html#aceb0b4c83da5f50512bf6045fef6583b">SetParent</a>(*<span class="keyword">this</span>); <span class="comment">// for convenience</span>
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// Otherwise, if it was already there, log an error.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Attempt to add Transaction to ledger when already there for that number: %lld\n&quot;</span>,
                      theTransaction.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a994010d2cfcb8ca486b51159efdec2d4"></a><!-- doxytag: member="OTLedger::CalculateHash" ref="a994010d2cfcb8ca486b51159efdec2d4" args="(OTIdentifier &amp;theOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a994010d2cfcb8ca486b51159efdec2d4">OTLedger::CalculateHash</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00705">705</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    theOutput.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

    <span class="keywordtype">bool</span> bCalcDigest = theOutput.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bCalcDigest)
    {
        theOutput.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::CalculateHash: Failed trying to calculate hash (for a %s)\n&quot;</span>,
                      <a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>());
    }

    <span class="keywordflow">return</span> bCalcDigest;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a520421fca03ee9ccefe03dacf6589ecc"></a><!-- doxytag: member="OTLedger::CalculateInboxHash" ref="a520421fca03ee9ccefe03dacf6589ecc" args="(OTIdentifier &amp;theOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a520421fca03ee9ccefe03dacf6589ecc">OTLedger::CalculateInboxHash</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00721">721</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::CalculateInboxHash.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_ledger.html#a994010d2cfcb8ca486b51159efdec2d4">CalculateHash</a>(theOutput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aad762086bb009eacd8f60d7e078357a4"></a><!-- doxytag: member="OTLedger::CalculateNymboxHash" ref="aad762086bb009eacd8f60d7e078357a4" args="(OTIdentifier &amp;theOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aad762086bb009eacd8f60d7e078357a4">OTLedger::CalculateNymboxHash</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00745">745</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::CalculateNymboxHash.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_ledger.html#a994010d2cfcb8ca486b51159efdec2d4">CalculateHash</a>(theOutput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="abc8bced33099b04f251040bf6a0b219c"></a><!-- doxytag: member="OTLedger::CalculateOutboxHash" ref="abc8bced33099b04f251040bf6a0b219c" args="(OTIdentifier &amp;theOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#abc8bced33099b04f251040bf6a0b219c">OTLedger::CalculateOutboxHash</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00733">733</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::CalculateOutboxHash.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_ledger.html#a994010d2cfcb8ca486b51159efdec2d4">CalculateHash</a>(theOutput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aea09d3dd8bf2fc5630ce87184fc937c1"></a><!-- doxytag: member="OTLedger::DeleteBoxReceipt" ref="aea09d3dd8bf2fc5630ce87184fc937c1" args="(const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aea09d3dd8bf2fc5630ce87184fc937c1">OTLedger::DeleteBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00282">282</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">// First, see if the transaction itself exists on this ledger.</span>
    <span class="comment">// Get a pointer to it.</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction  = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTransactionNum);

    <span class="keywordflow">if</span> (NULL == pTransaction)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTLedger::DeleteBoxReceipt: Unable to delete (overwrite) box receipt %lld: &quot;</span>
                       <span class="stringliteral">&quot;couldn&#39;t find the transaction on this ledger.\n&quot;</span>, lTransactionNum);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span>  pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac2e9b2e8e4a00f439109273b6a7ea658">DeleteBoxReceipt</a>(*<span class="keyword">this</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="acd3bbb77d181318d69bbf61b5aeca7fb"></a><!-- doxytag: member="OTLedger::GenerateBalanceStatement" ref="acd3bbb77d181318d69bbf61b5aeca7fb" args="(const int64_t lAdjustment, const OTTransaction &amp;theOwner, OTPseudonym &amp;theNym, const OTAccount &amp;theAccount, OTLedger &amp;theOutbox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_item.html">OTItem</a> * <a class="el" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">OTLedger::GenerateBalanceStatement</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lAdjustment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theOwner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_account.html">OTAccount</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutbox</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Only if it is an inbox, a ledger will loop through the transactions and produce the XML output for the report that's necessary during a balance agreement. (Any balance agreement for an account must include the list of transactions the nym has issued for use, as well as a listing of the transactions in the inbox for that account. This function does that last part :)</p>
<p>returns a new balance statement item containing the inbox report CALLER IS RESPONSIBLE TO DELETE. </p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01511">1511</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a> != <a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::GenerateBalanceStatement: Wrong ledger type.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">// ------------------------------------------------------</span>

    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(theNym);

    <span class="keywordflow">if</span> (
        (theAccount.<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>() != <a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()) ||
        (theAccount.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()  != <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()) ||
        (theAccount.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()             != <a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()) )
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong Account passed in to OTLedger::GenerateBalanceStatement.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">if</span> (
        (theOutbox.<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()  != <a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()) ||
        (theOutbox.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()   != <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()) ||
        (theOutbox.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()              != <a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()) )
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong Outbox passed in to OTLedger::GenerateBalanceStatement.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">if</span> (
        (theNymID   != <a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()))
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong Nym passed in to OTLedger::GenerateBalanceStatement.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ---------------------------------------------------------</span>
    <span class="comment">// theOwner is the withdrawal, or deposit, or whatever, that wants to change</span>
    <span class="comment">// the account balance, and thus that needs a new balance agreement signed.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(theOwner, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>); <span class="comment">// &lt;=== balanceStatement type, with user ID, server ID, account ID, transaction ID.</span>

    <span class="comment">// The above has an ASSERT, so this this will never actually happen.</span>
    <span class="keywordflow">if</span> (NULL == pBalanceItem)
        <span class="keywordflow">return</span> NULL;
    <span class="comment">// ---------------------------------------------------------</span>
    <span class="comment">// COPY THE ISSUED TRANSACTION NUMBERS FROM THE NYM to the MESSAGE NYM.</span>

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym;

    theMessageNym.<a class="code" href="class_o_t_pseudonym.html#aa120e0e319f6c4f26fe68628701008fc">HarvestIssuedNumbers</a>(this-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
                                       theNym <span class="comment">/*unused in this case, not saving to disk*/</span>, theNym, <span class="keyword">false</span>); <span class="comment">// bSave = false;</span>
    <span class="comment">// -------------------------------------</span>

    <span class="keywordflow">switch</span> (theOwner.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
    {
            <span class="comment">// These six options will remove the transaction number from the issued list, SUCCESS OR FAIL.</span>
            <span class="comment">// Server will expect the number to be missing from the list, in the case of these.</span>
            <span class="comment">// Therefore I remove it here in order to generate a proper balance agreement, acceptable to the server.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:

            theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>(), theOwner.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());  <span class="comment">// a transaction number is being used, and REMOVED from my list of responsibility,</span>
            theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a3fb93588f8e68c7f56cee00930f07d34">RemoveTransactionNum</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>(), theOwner.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());  <span class="comment">// a transaction number is being used, and REMOVED from my list of  available numbers.</span>
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
            <span class="comment">// Nothing removed here since the transaction is still in play. (Assuming success.)</span>
            <span class="comment">// If the server replies with rejection for any of these three, then I can remove</span>
            <span class="comment">// the transaction number from my list of issued/signed for. But if success, then I</span>
            <span class="comment">// am responsible for the transaction number until I sign off on closing it.</span>
            <span class="comment">// Since the Balance Statement ANTICIPATES SUCCESS, NOT FAILURE, it assumes the number</span>
            <span class="comment">// to be &quot;in play&quot; here, and thus DOES NOT remove it (vs the cases above, which do.)</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="comment">// Error</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::%s: wrong owner transaction type: %s\n&quot;</span>,
                          __FUNCTION__, theOwner.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            <span class="keywordflow">break</span>;
    }

    <a class="code" href="class_o_t_string.html">OTString</a>    strMessageNym(theMessageNym); <span class="comment">// Okay now we have the transaction numbers in this MessageNym string.</span>

    pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strMessageNym);             <span class="comment">// &lt;======== This is where the server will read the transaction numbers from (A nym in item.m_ascAttachment)</span>

    <span class="comment">// ---------------------------------------------------------</span>

    int64_t lCurrentBalance = theAccount.<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>();

    pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lCurrentBalance + lAdjustment);  <span class="comment">// &lt;==== Here&#39;s the new (predicted) balance for after the transaction is complete. (item.GetAmount)</span>

    <span class="comment">// ---------------------------------------------------------</span>
    <span class="comment">// loop through the INBOX transactions, and produce a sub-item onto pBalanceItem for each, which will</span>
    <span class="comment">// be a report on each transaction in this inbox, therefore added to the balance item.</span>
    <span class="comment">// (So the balance item contains a complete report on the receipts in this inbox.)</span>

    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;About to loop through the inbox items and produce a report for each one...\n&quot;</span>);

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Producing a report...\n&quot;</span>);

        <span class="comment">// it only reports receipts where we don&#39;t yet have balance agreement.</span>
<span class="comment">//      pTransaction-&gt;ProduceInboxReportItem(*pBalanceItem, const_cast&lt;OTTransaction &amp;&gt;(theOwner));</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a4a89382fb0a9a3500c19fe9107df3122">ProduceInboxReportItem</a>(*pBalanceItem);    <span class="comment">// &lt;======= This function adds a receipt sub-item to pBalanceItem, where appropriate for INBOX items.</span>
    }

    <span class="comment">// ---------------------------------------------------------</span>

    theOutbox.<a class="code" href="class_o_t_ledger.html#ab39066df3f397573a6c840c114e94ed1">ProduceOutboxReport</a>(*pBalanceItem);   <span class="comment">// &lt;======= This function adds receipt sub-items to pBalanceItem, where appropriate for the OUTBOX items.</span>

    <span class="comment">// ---------------------------------------------------------</span>

    pBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(theNym); <span class="comment">// &lt;=== Sign, save, and return. OTTransactionType needs to weasel in a &quot;date signed&quot; variable.</span>
    pBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="keywordflow">return</span> pBalanceItem;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae255257ef1a25233ca772d81ab730643"></a><!-- doxytag: member="OTLedger::GenerateLedger" ref="ae255257ef1a25233ca772d81ab730643" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAcctID, const OTIdentifier &amp;theServerID, const ledgerType theType, bool bCreateFile=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html">OTLedger</a> * <a class="el" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bCreateFile</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00900">900</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <span class="keyword">new</span> <a class="code" href="class_o_t_ledger.html#aa5b00bde91a578e9c68b73015b362858">OTLedger</a>(theUserID, theAcctID, theServerID);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pLedger);

    pLedger-&gt;<a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">GenerateLedger</a>(theAcctID, theServerID, theType, bCreateFile);
    pLedger-&gt;<a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(theUserID);

    <span class="keywordflow">return</span> pLedger;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c69a2bb95829215b942a571f410c8a4"></a><!-- doxytag: member="OTLedger::GenerateLedger" ref="a9c69a2bb95829215b942a571f410c8a4" args="(const OTIdentifier &amp;theAcctID, const OTIdentifier &amp;theServerID, const ledgerType theType, bool bCreateFile=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bCreateFile</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00916">916</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// First we set the &quot;Safe&quot; ID and try to load the file, to make sure it doesn&#39;t already exist.</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strID(theAcctID), strServerID(theServerID);

    <span class="keywordflow">switch</span> (theType) {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:  <span class="comment">// stored by NymID ONLY.</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#ada1729c82d6ebbfa53b16d511d2aded4">OTFolders::Nymbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:   <span class="comment">// stored by AcctID ONLY.</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#a6f314709ced53a8c542eb5ef53126b39">OTFolders::Inbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:  <span class="comment">// stored by AcctID ONLY.</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#af4ad3cfbb3030044148f03fd8020c41a">OTFolders::Outbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    <span class="comment">// stored by NymID ONLY.</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#a92fc938529eac80e1a040a664d844847">OTFolders::PaymentInbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       <span class="comment">// stored by Acct ID *and* Nym ID (depending on the box.)</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#a33b17e178549458a5fa7596dcf38adc6">OTFolders::RecordBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      <span class="comment">// stored by Nym ID only.</span>
            <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = <a class="code" href="class_o_t_folders.html#a1dfba6274248dcc7cb910770635720f6">OTFolders::ExpiredBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.Get());
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>:
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(4, <span class="stringliteral">&quot;Generating message ledger...\n&quot;</span>);
            <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(theAcctID);
            <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theAcctID);   <span class="comment">// It&#39;s safe to set these the same here, since we&#39;re creating the ledger now.</span>
            <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(theServerID);
            <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theServerID);  <span class="comment">// Always want the server ID on anything that the server signs.</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>  = theType;
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;OTLedger::GenerateLedger: GenerateLedger is only for message, nymbox, inbox, outbox, and paymentInbox ledgers.\n&quot;</span>);
    }

    <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>  = theType; <span class="comment">// Todo make this Get/Set methods</span>

    <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(theAcctID); <span class="comment">// set this before calling LoadContract... (In this case, will just be the Nym ID as well...)</span>
    <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(theServerID); <span class="comment">// (Ledgers/transactions/items were originally meant just for account-related functions.)</span>

    <span class="keywordflow">if</span> (bCreateFile)
    {
        <span class="comment">// --------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
        strFilename = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

        <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(); <span class="comment">// &quot;nymbox&quot; (or &quot;inbox&quot; or &quot;outbox&quot;)</span>
        <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();     <span class="comment">// &quot;nymbox/SERVER_ID&quot;</span>
        <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();     <span class="comment">// &quot;nymbox/SERVER_ID/USER_ID&quot;  (or &quot;inbox/SERVER_ID/ACCT_ID&quot; or &quot;outbox/SERVER_ID/ACCT_ID&quot;)</span>
        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFolder1name, szFolder2name, szFilename))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;ERROR: trying to generate ledger that already exists: %s%s%s%s%s\n&quot;</span>,
                           szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="comment">// Okay, it doesn&#39;t already exist. Let&#39;s generate it.</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Generating %s%s%s%s%s\n&quot;</span>,
                       szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
    }
    <span class="comment">// --------------------------------------------------</span>
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a> == theType) || (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a> == theType))
    {
        <span class="comment">// Have to look up the UserID here. No way around it. We need that ID.</span>
        <span class="comment">// Plus it helps verify things.</span>
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_account.html#a6574057f6e3415546d3a9f7d7e445e4f">OTAccount::LoadExistingAccount</a>(theAcctID, theServerID);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a> theAccountGuardian(pAccount); <span class="comment">// No worries about having to clean it up.</span>

        <span class="keywordflow">if</span> (NULL != pAccount)
            <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::GenerateLedger: Failed in OTAccount::LoadExistingAccount().\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a> == theType)
    {
        <span class="comment">// RecordBox COULD be by NymID OR AcctID.</span>
        <span class="comment">// So we TRY to lookup the acct.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_account.html#a6574057f6e3415546d3a9f7d7e445e4f">OTAccount::LoadExistingAccount</a>(theAcctID, theServerID);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a> theAccountGuardian(pAccount); <span class="comment">// No worries about having to clean it up.</span>

        <span class="keywordflow">if</span> (NULL != pAccount) <span class="comment">// Found it!</span>
            <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
        <span class="keywordflow">else</span> <span class="comment">// Must be based on NymID, not AcctID (like Nymbox. But RecordBox can go either way.)</span>
        {
            <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(theAcctID); <span class="comment">// In the case of nymbox, and sometimes with recordBox, the acct ID IS the user ID.</span>
        }
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// In the case of paymentInbox, expired box, and nymbox, the acct ID IS the user ID.</span>
        <span class="comment">// (Should change it to &quot;owner ID&quot; to make it sound right either way.)</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(theAcctID);
    }

    <span class="comment">// Notice I still don&#39;t actually create the file here.  The programmer still has to call</span>
    <span class="comment">// &quot;SaveNymbox&quot;, &quot;SaveInbox&quot; or &quot;SaveOutbox&quot; or &quot;SaveRecordBox&quot; or &quot;SavePaymentInbox&quot; to</span>
    <span class="comment">// actually save the file. But he cannot do that unless he generates it first here, and</span>
    <span class="comment">// the &quot;bCreateFile&quot; parameter insures that he isn&#39;t overwriting one that is already there</span>
    <span class="comment">// (even if we don&#39;t actually save the file in this function.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theAcctID);
    <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theServerID);

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac364836ff42d8a8d873050b86a72c7d9"></a><!-- doxytag: member="OTLedger::GetChequeReceipt" ref="ac364836ff42d8a8d873050b86a72c7d9" args="(const int64_t lChequeNum, OTCheque **ppChequeOut=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#ac364836ff42d8a8d873050b86a72c7d9">OTLedger::GetChequeReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lChequeNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_cheque.html">OTCheque</a> **&#160;</td>
          <td class="paramname"><em>ppChequeOut</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01341">1341</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pCurrentReceipt = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCurrentReceipt);

        <span class="keywordflow">if</span> ((pCurrentReceipt-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>) &amp;&amp;
            (pCurrentReceipt-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>))
            <span class="keywordflow">continue</span>;
        <span class="comment">// ----------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strDepositChequeMsg;
        pCurrentReceipt-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strDepositChequeMsg);

        <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strDepositChequeMsg, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
                                                              pCurrentReceipt-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel(pOriginalItem);

        <span class="keywordflow">if</span> (NULL == pOriginalItem)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected original depositCheque request item to be inside the chequeReceipt &quot;</span>
                          <span class="stringliteral">&quot;(but failed to load it...)\n&quot;</span>, __FUNCTION__);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a> != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strItemType;
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strItemType);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected original depositCheque request item to be inside the chequeReceipt, &quot;</span>
                          <span class="stringliteral">&quot;but somehow what we found instead was a %s...\n&quot;</span>, __FUNCTION__, strItemType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_string.html">OTString</a>   strCheque;
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strCheque);
            <span class="comment">// -------------------------------------</span>
            <a class="code" href="class_o_t_cheque.html">OTCheque</a> * pCheque = <span class="keyword">new</span> <a class="code" href="class_o_t_cheque.html">OTCheque</a>;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCheque);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCheque&gt;</a> theChequeAngel(pCheque);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == ((strCheque.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2) &amp;&amp;
                          pCheque-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strCheque)))
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading cheque from string:\n%s\n&quot;</span>,
                              __FUNCTION__, strCheque.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            }
            <span class="comment">// NOTE: Technically we don&#39;T NEED to load up the cheque anymore, since</span>
            <span class="comment">// we could just check the NumberOfOrigin, which should already match the</span>
            <span class="comment">// transaction number on the cheque.</span>
            <span class="comment">// However, even that would have to load up the cheque once, if it wasn&#39;t</span>
            <span class="comment">// already set, and this function already must RETURN a copy of the cheque</span>
            <span class="comment">// (at least optionally), so we might as well just load it up, verify it,</span>
            <span class="comment">// and return it. (That&#39;s why we are still loading the cheque here instead</span>
            <span class="comment">// of checking the number of origin.)</span>
            <span class="keywordflow">else</span>
            {
                <span class="comment">// Success loading the cheque.</span>
                <span class="comment">// Let&#39;s see if it&#39;s the right cheque...</span>
                <span class="keywordflow">if</span> (pCheque-&gt;<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>() == lChequeNum)
                {
                    <span class="comment">// We found it! Let&#39;s return a pointer to pCurrentReceipt</span>

                    <span class="comment">// Also return pCheque, if the caller wants it (otherwise delete it.)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (NULL != ppChequeOut) <span class="comment">// caller wants us to return the cheque pointer as well.</span>
                    {
                        (*ppChequeOut) = pCheque; <span class="comment">// now caller is responsible to delete.</span>
                        theChequeAngel.SetCleanupTargetPointer(NULL); <span class="comment">// we will no longer clean it up.</span>
                    }

                    <span class="keywordflow">return</span> pCurrentReceipt;
                }
            }
        }
    }<span class="comment">// FOR_EACH</span>
    <span class="comment">// ---------------------------</span>
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab4a37c7036b68bf5e4496848bddb1953"></a><!-- doxytag: member="OTLedger::GetFinalReceipt" ref="ab4a37c7036b68bf5e4496848bddb1953" args="(int64_t lReferenceNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#ab4a37c7036b68bf5e4496848bddb1953">OTLedger::GetFinalReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lReferenceNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01431">1431</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions that make up this ledger.</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) <span class="comment">// &lt;=======</span>
            <span class="keywordflow">continue</span>;
        <span class="comment">// ---------------------------------</span>
        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReferenceNum)
            <span class="keywordflow">return</span> pTransaction;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a114a4d31098807d6cb873a7343a407ae"></a><!-- doxytag: member="OTLedger::GetInstrument" ref="a114a4d31098807d6cb873a7343a407ae" args="(OTPseudonym &amp;theNym, const int32_t &amp;nIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payment.html">OTPayment</a> * <a class="el" href="class_o_t_ledger.html#a114a4d31098807d6cb873a7343a407ae">OTLedger::GetInstrument</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t &amp;&#160;</td>
          <td class="paramname"><em>nIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01696">1696</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((0 &gt; nIndex) || (nIndex &gt;= this-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>()))
    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative.)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
    <span class="comment">// ----------------------------------------------------</span>
<span class="comment">//  if (nIndex &gt;= this-&gt;GetTransactionCount())</span>
<span class="comment">//  {</span>
<span class="comment">//      OTLog::vError(&quot;%s: out of bounds: %d\n&quot;, __FUNCTION__, nIndex);</span>
<span class="comment">//      return NULL; // out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<span class="comment">//                   // ^^^ That&#39;s right you shouldn&#39;t! That&#39;s the client developer&#39;s problem, not yours.</span>
<span class="comment">//  }</span>
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = this-&gt;<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex);
<span class="comment">//  OTCleanup&lt;OTTransaction&gt; theAngel(pTransaction); // THE LEDGER CLEANS THIS ALREADY.</span>

    <span class="keywordflow">if</span> (NULL == pTransaction)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered NULL pointer: %d\n&quot;</span>, __FUNCTION__, nIndex);
        <span class="keywordflow">return</span> NULL; <span class="comment">// Weird.</span>
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();

    <span class="comment">// Update: for transactions in ABBREVIATED form, the string is empty, since it has never actually</span>
    <span class="comment">// been signed (in fact the whole point32_t with abbreviated transactions in a ledger is that they</span>
    <span class="comment">// take up very little room, and have no signature of their own, but exist merely as XML tags on</span>
    <span class="comment">// their parent ledger.)</span>
    <span class="comment">//</span>
    <span class="comment">// THEREFORE I must check to see if this transaction is abbreviated and if so, sign it in order to</span>
    <span class="comment">// force the UpdateContents() call, so the programmatic user of this API will be able to load it up.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        this-&gt;<a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a>(static_cast&lt;int64_t&gt;(lTransactionNum)); <span class="comment">// I don&#39;t check return val here because I still want it to send the abbreviated form, if this fails.</span>
        pTransaction = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(static_cast&lt;int64_t&gt;(lTransactionNum));
        <span class="comment">// -------------------------</span>
        <span class="keywordflow">if</span> (NULL == pTransaction)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered NULL &quot;</span>
                <span class="stringliteral">&quot;pointer after trying to load full version of receipt (from abbreviated) at index: %d\n&quot;</span>,
                __FUNCTION__, nIndex);
            <span class="keywordflow">return</span> NULL; <span class="comment">// Weird. Clearly I need the full box receipt, if I&#39;m to get the instrument out of it.</span>
        }
    }
    <span class="comment">// ------------------------------------------------</span>
    <span class="comment">/*</span>
<span class="comment">    TO EXTRACT INSTRUMENT FROM PAYMENTS INBOX:</span>
<span class="comment">    -- Iterate through the transactions in the payments inbox.</span>
<span class="comment">    -- (They should all be &quot;instrumentNotice&quot; transactions.)</span>
<span class="comment">    -- Each transaction contains (1) OTMessage in &quot;in ref to&quot; field, which in turn contains an encrypted</span>
<span class="comment">    OTPayment in the payload field, which contains the actual financial instrument.</span>
<span class="comment">    -- *** Therefore, this function, based purely on ledger index (as we iterate):</span>
<span class="comment">    1. extracts the OTMessage from the Transaction &quot;in ref to&quot; field (for the transaction at that index),</span>
<span class="comment">    2. then decrypts the payload on that message, producing an OTPayment object,</span>
<span class="comment">    3. ...which contains the actual instrument.</span>
<span class="comment">    */</span>
    <span class="comment">// ------------------------------------------------</span>
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>    != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) &amp;&amp;
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>         != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) &amp;&amp;
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>              != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Expected OTTransaction::instrumentNotice, ::payDividend or ::notice, &quot;</span>
            <span class="stringliteral">&quot;but found: OTTransaction::%s\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ------------------------------------------------</span>
    <span class="keywordflow">if</span> (
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) || <span class="comment">// It&#39;s encrypted.</span>
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>      == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        )
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strMsg;
        pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strMsg);

        <span class="keywordflow">if</span> (!strMsg.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Expected OTTransaction::instrumentNotice to &quot;</span>
                <span class="stringliteral">&quot;contain an &#39;in reference to&#39; string, but it was empty. (Returning \&quot;\&quot;.)\n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> NULL;
        }
        <span class="comment">// ------------------------------------------------</span>
        <a class="code" href="class_o_t_message.html">OTMessage</a> * pMsg = <span class="keyword">new</span> <a class="code" href="class_o_t_message.html">OTMessage</a>;
        <span class="keywordflow">if</span> (NULL == pMsg) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null:  Assert while allocating memory for an OTMessage!\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMessage&gt;</a> theMsgAngel(*pMsg); <span class="comment">// cleanup memory.</span>
        <span class="comment">// ------------------------------------------------</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pMsg-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMsg))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load OTMessage from string:\n\n%s\n\n&quot;</span>, __FUNCTION__, strMsg.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> NULL;
        }
        <span class="comment">// ------------------------------------------------</span>
        <span class="comment">// By this point, the original OTMessage has been loaded from string successfully.</span>
        <span class="comment">// Now we need to decrypt the payment on that message (which contains the instrument</span>
        <span class="comment">// itself that we need to return.) We decrypt it the same way as we do in</span>
        <span class="comment">// OTAPI_Wrap::GetNym_MailContentsByIndex():</span>
        <span class="comment">//</span>

        <span class="comment">// SENDER:     pMsg-&gt;m_strNymID</span>
        <span class="comment">// RECIPIENT:  pMsg-&gt;m_strNymID2</span>
        <span class="comment">// INSTRUMENT: pMsg-&gt;m_ascPayload (in an OTEnvelope)</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>  theEnvelope;
        <a class="code" href="class_o_t_string.html">OTString</a>    strEnvelopeContents;

        <span class="comment">// Decrypt the Envelope.</span>
        <span class="keywordflow">if</span> (!theEnvelope.<a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(pMsg-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>))
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to set ASCII-armored data for envelope:\n%s\n\n&quot;</span>,
                           __FUNCTION__, strMsg.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!theEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(theNym, strEnvelopeContents))
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to decrypt the financial instrument &quot;</span>
                           <span class="stringliteral">&quot;that was supposedly attached as a payload to this payment message:\n%s\n\n&quot;</span>,
                           __FUNCTION__, strMsg.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strEnvelopeContents.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed: after decryption, cleartext is empty. From:\n%s\n\n&quot;</span>,
                               __FUNCTION__, strMsg.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_payment.html">OTPayment</a> * pPayment = <span class="keyword">new</span> <a class="code" href="class_o_t_payment.html">OTPayment</a>(strEnvelopeContents);  <span class="comment">// strEnvelopeContents contains a PURSE or CHEQUE (etc) and not specifically a PAYMENT.</span>
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPayment);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPayment&gt;</a> thePaymentAngel(pPayment);

            <span class="keywordflow">if</span> (!pPayment-&gt;<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed: after decryption, payment is invalid. &quot;</span>
                <span class="stringliteral">&quot;Contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, strEnvelopeContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">else</span> <span class="comment">// success.</span>
            {
                thePaymentAngel.SetCleanupTargetPointer(NULL);
                <span class="keywordflow">return</span> pPayment; <span class="comment">// Caller responsible to delete.</span>
            }
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: This must be a notice (vs an instrumentNotice or payDividend). &quot;</span>
                      <span class="stringliteral">&quot;!!! Not yet supported !!!\n&quot;</span>, __FUNCTION__);

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4107700057144e2cc8719bbf1771e614"></a><!-- doxytag: member="OTLedger::GetPaymentReceipt" ref="a4107700057144e2cc8719bbf1771e614" args="(int64_t lReferenceNum, OTPayment **ppPaymentOut=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#a4107700057144e2cc8719bbf1771e614">OTLedger::GetPaymentReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lReferenceNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_payment.html">OTPayment</a> **&#160;</td>
          <td class="paramname"><em>ppPaymentOut</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01454">1454</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions that make up this ledger.</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a> != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) <span class="comment">// &lt;=======</span>
            <span class="keywordflow">continue</span>;
        <span class="comment">// ---------------------------------</span>
        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReferenceNum)
        {
            <span class="keywordflow">if</span> (NULL != ppPaymentOut) <span class="comment">// The caller might want a copy of this.</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strPayment;
                pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strPayment);

                <span class="keywordflow">if</span> (!strPayment.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                {
                    <a class="code" href="class_o_t_payment.html">OTPayment</a> * pPayment = <span class="keyword">new</span> <a class="code" href="class_o_t_payment.html">OTPayment</a>(strPayment);
                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pPayment);

                    <span class="keywordflow">if</span> (pPayment-&gt;<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>() &amp;&amp; pPayment-&gt;<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>())
                        *ppPaymentOut = pPayment; <span class="comment">// CALLER RESPONSIBLE TO DELETE.</span>
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed loading up payment instrument from paymentReceipt.\n&quot;</span>,
                                      __FUNCTION__);
                        <span class="keyword">delete</span> pPayment;
                        pPayment = NULL;
                        *ppPaymentOut = NULL;
                    }
                }
                <span class="keywordflow">else</span>
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Unexpected: payment instrument was empty string, on a paymentReceipt.\n&quot;</span>,
                                  __FUNCTION__);
            }

            <span class="keywordflow">return</span> pTransaction;
        }
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abff95a14ed703447ec5557183f5dc91c"></a><!-- doxytag: member="OTLedger::GetReplyNotice" ref="abff95a14ed703447ec5557183f5dc91c" args="(const int64_t &amp;lRequestNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#abff95a14ed703447ec5557183f5dc91c">OTLedger::GetReplyNotice</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01257">1257</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions that make up this ledger.</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a> != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) <span class="comment">// &lt;=======</span>
            <span class="keywordflow">continue</span>;
        <span class="comment">// ---------------------------------</span>
        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aa90624fb50b1b0edb72c6d4bd7b01a4c">GetRequestNum</a>() == lRequestNum)
            <span class="keywordflow">return</span> pTransaction;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe1dc4d292a140a025eab1c178b93a01"></a><!-- doxytag: member="OTLedger::GetTotalPendingValue" ref="afe1dc4d292a140a025eab1c178b93a01" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_ledger.html#afe1dc4d292a140a025eab1c178b93a01">OTLedger::GetTotalPendingValue</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01643">1643</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lTotalPendingValue = 0;

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a> != <a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::GetTotalPendingValue: Wrong ledger type (expected inbox).\n&quot;</span>);
        <span class="keywordflow">return</span> 0;
    }

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>)
            lTotalPendingValue += pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(); <span class="comment">// this actually loads up the original item and reads the amount.</span>
    }

    <span class="keywordflow">return</span> lTotalPendingValue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a89dedbb3be7bd6869ad5e345fd14fb20"></a><!-- doxytag: member="OTLedger::GetTransaction" ref="a89dedbb3be7bd6869ad5e345fd14fb20" args="(const OTTransaction::transactionType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">OTLedger::GetTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01147">1147</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the items that make up this transaction</span>

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (theType == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
            <span class="keywordflow">return</span> pTransaction;
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a603c6175e9380fa5b2c4f577982fb9ab"></a><!-- doxytag: member="OTLedger::GetTransaction" ref="a603c6175e9380fa5b2c4f577982fb9ab" args="(int64_t lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">OTLedger::GetTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01190">1190</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions inside this ledger</span>

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() == lTransactionNum)
        {
            <span class="keywordflow">return</span> pTransaction;
        }
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ede5441f84527b2717662fa465e526c"></a><!-- doxytag: member="OTLedger::GetTransactionByIndex" ref="a5ede5441f84527b2717662fa465e526c" args="(int32_t nIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">OTLedger::GetTransactionByIndex</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>nIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01231">1231</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Out of bounds.</span>
    <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= <a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>()))
        <span class="keywordflow">return</span> NULL;

    int32_t nIndexCount = -1;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        nIndexCount++; <span class="comment">// On first iteration, this is now 0, same as nIndex.</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((NULL != pTransaction)); <span class="comment">// Should always be good.</span>

        <span class="comment">// If this transaction is the one at the requested index</span>
        <span class="keywordflow">if</span> (nIndexCount == nIndex)
            <span class="keywordflow">return</span> pTransaction;
    }

    <span class="keywordflow">return</span> NULL; <span class="comment">// Should never reach this point, since bounds are checked at the top.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a963473034789aca7bab8ddb4b089a3ff"></a><!-- doxytag: member="OTLedger::GetTransactionCount" ref="a963473034789aca7bab8ddb4b089a3ff" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">OTLedger::GetTransactionCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00292">292</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (m_mapTransactions.size()); }
</pre></div>
</div>
</div>
<a class="anchor" id="ac72aea8d3eb0d0e8e59a5b7eaa4fda6e"></a><!-- doxytag: member="OTLedger::GetTransactionCountInRefTo" ref="ac72aea8d3eb0d0e8e59a5b7eaa4fda6e" args="(const int64_t lReferenceNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_ledger.html#ac72aea8d3eb0d0e8e59a5b7eaa4fda6e">OTLedger::GetTransactionCountInRefTo</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lReferenceNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01212">1212</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nCount = 0;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReferenceNum)
            nCount++;
    }

    <span class="keywordflow">return</span> nCount;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa45a9d3c7110327f47b2934574b0177d"></a><!-- doxytag: member="OTLedger::GetTransactionIndex" ref="aa45a9d3c7110327f47b2934574b0177d" args="(int64_t lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_ledger.html#aa45a9d3c7110327f47b2934574b0177d">OTLedger::GetTransactionIndex</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01165">1165</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions inside this ledger</span>
    <span class="comment">// If a specific transaction is found, returns its index inside the ledger</span>
    <span class="comment">//</span>
    int32_t nIndex = -1;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        ++nIndex; <span class="comment">// 0 on first iteration.</span>

        <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() == lTransactionNum)
        {
            <span class="keywordflow">return</span> nIndex;
        }
    }
    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa71b6540e2948a36e3c7d3e7d14547a5"></a><!-- doxytag: member="OTLedger::GetTransactionMap" ref="aa71b6540e2948a36e3c7d3e7d14547a5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a> &amp; <a class="el" href="class_o_t_ledger.html#aa71b6540e2948a36e3c7d3e7d14547a5">OTLedger::GetTransactionMap</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01084">1084</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> m_mapTransactions;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a82181e9dd053f165008b02b5827f784d"></a><!-- doxytag: member="OTLedger::GetTransferReceipt" ref="a82181e9dd053f165008b02b5827f784d" args="(int64_t lNumberOfOrigin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_ledger.html#a82181e9dd053f165008b02b5827f784d">OTLedger::GetTransferReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lNumberOfOrigin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01276">1276</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the transactions that make up this ledger.</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strReference;
            pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);

            <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference,
                                                                  pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
                                                                  pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOriginalItem);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel(*pOriginalItem);

            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::%s: Wrong item type attached to transferReceipt!\n&quot;</span>,
                              __FUNCTION__);
                <span class="keywordflow">return</span> NULL;
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">// Note: the acceptPending USED to be &quot;in reference to&quot; whatever the pending</span>
                <span class="comment">// was in reference to. (i.e. the original transfer.) But since the KacTech</span>
                <span class="comment">// bug fix (for accepting multiple transfer receipts) the acceptPending is now</span>
                <span class="comment">// &quot;in reference to&quot; the pending itself, instead of the original transfer.</span>
                <span class="comment">//</span>
                <span class="comment">// It used to be that a caller of GetTransferReceipt would pass in the InRefTo</span>
                <span class="comment">// expected from the pending in the outbox, and match it to the InRefTo found</span>
                <span class="comment">// on the acceptPending (inside the transferReceipt) in the inbox.</span>
                <span class="comment">// But this is no longer possible, since the acceptPending is no longer InRefTo</span>
                <span class="comment">// whatever the pending is InRefTo.</span>
                <span class="comment">//</span>
                <span class="comment">// Therefore, in this place, it is now necessary to pass in the NumberOfOrigin,</span>
                <span class="comment">// and compare it to the NumberOfOrigin, to find the match.</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>() == lNumberOfOrigin)
<span class="comment">//              if (pOriginalItem-&gt;GetReferenceToNum() == lTransactionNum)</span>
                    <span class="keywordflow">return</span> pTransaction; <span class="comment">// FOUND IT!</span>
            }
        }
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a28fd8abcda98128b8610c825d73e0f55"></a><!-- doxytag: member="OTLedger::GetType" ref="a28fd8abcda98128b8610c825d73e0f55" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> <a class="el" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">OTLedger::GetType</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00198">198</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a12f028ac95367cc8e48ad2636565c3a2"></a><!-- doxytag: member="OTLedger::GetTypeString" ref="a12f028ac95367cc8e48ad2636565c3a2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT char const* <a class="el" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">OTLedger::GetTypeString</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00325">325</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a45edcea1fb843a5aedcc3cd32c144522">OTLedger::_GetTypeString</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>); }
</pre></div>
</div>
</div>
<a class="anchor" id="a44d61f2c5bfafa42af7216a1736a996b"></a><!-- doxytag: member="OTLedger::InitLedger" ref="a44d61f2c5bfafa42af7216a1736a996b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#a44d61f2c5bfafa42af7216a1736a996b">OTLedger::InitLedger</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01040">1040</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>   = <span class="stringliteral">&quot;LEDGER&quot;</span>; <span class="comment">// CONTRACT, MESSAGE, TRANSACTION, LEDGER, TRANSACTION ITEM</span>

    <span class="comment">// This is the default type for a ledger.</span>
    <span class="comment">// Inboxes and Outboxes are generated with the right type, with files.</span>
    <span class="comment">// Until the GenerateLedger function is called, message is the default type.</span>
    <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>;

    <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a> = <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae91873a35ebda05d8d91c78c1c1fcfbf"></a><!-- doxytag: member="OTLedger::LoadBoxReceipt" ref="ae91873a35ebda05d8d91c78c1c1fcfbf" args="(const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">OTLedger::LoadBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00376">376</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// First, see if the transaction itself exists on this ledger.</span>
    <span class="comment">// Get a pointer to it.</span>
    <span class="comment">// Next, see if the appropriate file exists, and load it up from</span>
    <span class="comment">// local storage, into a string.</span>
    <span class="comment">// Finally, try to load the transaction from that string and see if successful.</span>
    <span class="comment">// If it verifies, then replace the abbreviated receipt with the actual one.</span>
    <span class="comment">// --------------------------------------------------------</span>

    <span class="comment">// First, see if the transaction itself exists on this ledger.</span>
    <span class="comment">// Get a pointer to it.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction  = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTransactionNum);

    <span class="keywordflow">if</span> (NULL == pTransaction)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load box receipt %lld: couldn&#39;t find abbreviated &quot;</span>
                       <span class="stringliteral">&quot;version already on this ledger.\n&quot;</span>, __FUNCTION__, lTransactionNum);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ****************************************************************</span>
    <span class="comment">// Todo: security analysis. By this point we&#39;ve verified the hash of the transaction against the stored</span>
    <span class="comment">// hash inside the abbreviated version. (VerifyBoxReceipt) We&#39;ve also verified a few other values like transaction</span>
    <span class="comment">// number, and the &quot;in ref to&quot; display number. We&#39;re then assuming based on those, that the adjustment and display</span>
    <span class="comment">// amount are correct. (The hash is actually a zero knowledge proof of this already.) This is good for speedier</span>
    <span class="comment">// optimization but may be worth revisiting in case any security holes.</span>
    <span class="comment">// UPDATE: We&#39;ll save this for optimization needs in the future.</span>
<span class="comment">//  pBoxReceipt-&gt;SetAbbrevAdjustment(       pTransaction-&gt;GetAbbrevAdjustment() );</span>
<span class="comment">//  pBoxReceipt-&gt;SetAbbrevDisplayAmount(    pTransaction-&gt;GetAbbrevDisplayAmount() );</span>
    <span class="comment">// -------------------------------------------------</span>

<span class="comment">//  OTLog::vOutput(0, &quot;DEBUGGING:  OTLedger::LoadBoxReceipt: ledger type: %s \n&quot;, GetTypeString());</span>

    <span class="comment">// OTTransaction::LoadBoxReceipt already checks pTransaction to see if it&#39;s abbreviated</span>
    <span class="comment">// (which it must be.) So I don&#39;t bother checking twice.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pBoxReceipt = <a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">OTTransaction::LoadBoxReceipt</a>(*pTransaction, *<span class="keyword">this</span>);

    <span class="comment">// success</span>
    <span class="keywordflow">if</span> (NULL != pBoxReceipt)
    {
        <span class="comment">//  Remove the existing, abbreviated receipt, and replace it with the actual receipt.</span>
        <span class="comment">//  (If this inbox/outbox/whatever is saved, it will later save in abbreviated form</span>
        <span class="comment">//  again.)</span>
        <span class="comment">//</span>
        this-&gt;<a class="code" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a>(lTransactionNum); <span class="comment">// this deletes pTransaction</span>
        pTransaction = NULL;
        this-&gt;<a class="code" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a>(*pBoxReceipt); <span class="comment">// takes ownership.</span>
        <span class="comment">// -------------------------------------------------</span>
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0eb4102ef28704ac8518c6cf98ebc34d"></a><!-- doxytag: member="OTLedger::LoadBoxReceipts" ref="a0eb4102ef28704ac8518c6cf98ebc34d" args="(std::set&lt; int64_t &gt; *psetUnloaded=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a0eb4102ef28704ac8518c6cf98ebc34d">OTLedger::LoadBoxReceipts</a> </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; int64_t &gt; *&#160;</td>
          <td class="paramname"><em>psetUnloaded</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00308">308</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Grab a copy of all the transaction #s stored inside this ledger.</span>
    <span class="comment">//</span>
    std::set&lt;int64_t&gt; the_set;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        the_set.insert(pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
    }
    <span class="comment">// -------------------------------</span>
    <span class="comment">// Now iterate through those numbers and for each, load the box receipt.</span>
    <span class="comment">//</span>
    <span class="keywordtype">bool</span> bRetVal = <span class="keyword">true</span>;

    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(std::set&lt;int64_t&gt;, the_set)
    {
        int64_t lSetNum = *it;
        <span class="comment">// ------------------------</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lSetNum);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        <span class="comment">// ------------------------</span>
        <span class="comment">// Failed loading the boxReceipt</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> ((<span class="keyword">true</span>   ==  pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>()) &amp;&amp;
            (<span class="keyword">false</span>  ==  this-&gt;<a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a>(lSetNum)))
        {
            <span class="comment">// WARNING: pTransaction must be re-Get&#39;d below this point if needed, since pointer</span>
            <span class="comment">// is bad if success on LoadBoxReceipt() call.</span>
            <span class="comment">//</span>
            pTransaction    = NULL;
            bRetVal         = <span class="keyword">false</span>;
            int32_t nLogLevel   = 0;
            <span class="comment">// --------------</span>
            <span class="keywordflow">if</span> (NULL != psetUnloaded)
            {
                psetUnloaded-&gt;insert(lSetNum);
                nLogLevel = 3;
            }
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(nLogLevel, <span class="stringliteral">&quot;OTLedger::LoadBoxReceipts: Failed calling LoadBoxReceipt on &quot;</span>
                           <span class="stringliteral">&quot;abbreviated transaction number: %lld.\n&quot;</span>, lSetNum);
            <span class="comment">// If psetUnloaded is passed in, then we don&#39;t want to break, because we want to</span>
            <span class="comment">// populate it with the conmplete list of IDs that wouldn&#39;t load as a Box Receipt.</span>
            <span class="comment">// Thus, we only break if psetUnloaded is NULL, which is better optimization in that case.</span>
            <span class="comment">// (If not building a list of all failures, then we can return at first sign of failure.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (NULL == psetUnloaded)
                <span class="keywordflow">break</span>;
        }
        <span class="comment">// else (success), no need for a block in that case.</span>
    }

    <span class="comment">// You might ask, why didn&#39;t I just iterate through the transactions directly and just call</span>
    <span class="comment">// LoadBoxReceipt on each one? Answer: Because that function actually deletes the transaction</span>
    <span class="comment">// and replaces it with a different object, if successful.</span>

    <span class="keywordflow">return</span> bRetVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a51b47d519c07ba297e6d87e840b21a19"></a><!-- doxytag: member="OTLedger::LoadedLegacyData" ref="a51b47d519c07ba297e6d87e840b21a19" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT bool <a class="el" href="class_o_t_ledger.html#a51b47d519c07ba297e6d87e840b21a19">OTLedger::LoadedLegacyData</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00200">200</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a752b0776eed42abe1a48754d288bd79e"></a><!-- doxytag: member="OTLedger::LoadExpiredBox" ref="a752b0776eed42abe1a48754d288bd79e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a752b0776eed42abe1a48754d288bd79e">OTLedger::LoadExpiredBox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00494">494</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3ca2a96eb490fa56d693487a228b25cf"></a><!-- doxytag: member="OTLedger::LoadExpiredBoxFromString" ref="a3ca2a96eb490fa56d693487a228b25cf" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a3ca2a96eb490fa56d693487a228b25cf">OTLedger::LoadExpiredBoxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00512">512</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3a9052c23a2838efce273d55da58a51b"></a><!-- doxytag: member="OTLedger::LoadGeneric" ref="a3a9052c23a2838efce273d55da58a51b" args="(ledgerType theType, const OTString *pString=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">OTLedger::LoadGeneric</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">OTLedger::ledgerType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pString</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">OTLedger::LoadGeneric</a> is called by LoadInbox, LoadOutbox, and LoadNymbox. Does NOT VerifyAccount after loading -- caller is responsible to do that.</p>
<p>pString -- optional argument, for when you prefer to load from a string instead of from a file. </p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00525">525</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = theType;
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszType    = <a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>();
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszFolder  = NULL;
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keywordflow">switch</span> (theType)
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          pszFolder = <a class="code" href="class_o_t_folders.html#ada1729c82d6ebbfa53b16d511d2aded4">OTFolders::Nymbox</a>()      .<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           pszFolder = <a class="code" href="class_o_t_folders.html#a6f314709ced53a8c542eb5ef53126b39">OTFolders::Inbox</a>()       .<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          pszFolder = <a class="code" href="class_o_t_folders.html#af4ad3cfbb3030044148f03fd8020c41a">OTFolders::Outbox</a>()      .<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    pszFolder = <a class="code" href="class_o_t_folders.html#a92fc938529eac80e1a040a664d844847">OTFolders::PaymentInbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       pszFolder = <a class="code" href="class_o_t_folders.html#a33b17e178549458a5fa7596dcf38adc6">OTFolders::RecordBox</a>()   .<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      pszFolder = <a class="code" href="class_o_t_folders.html#a1dfba6274248dcc7cb910770635720f6">OTFolders::ExpiredBox</a>()  .<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
            <span class="comment">/* --- BREAK --- */</span>
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::LoadGeneric: Error: unknown box type. (This should never happen.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = pszFolder;
    <span class="comment">// --------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strID;
    <a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strID);
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
    strFilename = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(); <span class="comment">// &quot;nymbox&quot; (or &quot;inbox&quot; or &quot;outbox&quot;)</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();     <span class="comment">// &quot;nymbox/SERVER_ID&quot;</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();     <span class="comment">// &quot;nymbox/SERVER_ID/USER_ID&quot;  (or &quot;inbox/SERVER_ID/ACCT_ID&quot; or &quot;outbox/SERVER_ID/ACCT_ID&quot;)</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strRawFile;

    <span class="keywordflow">if</span> (NULL != pString)    <span class="comment">// Loading FROM A STRING.</span>
        strRawFile.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(*pString);
    <span class="keywordflow">else</span>                    <span class="comment">// Loading FROM A FILE.</span>
    {
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFolder1name, szFolder2name, szFilename))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s does not exist in OTLedger::Load%s: %s%s%s%s%s\n&quot;</span>,
                           pszType,         pszType,
                           szFolder1name,   <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                           szFolder2name,   <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// --------------------------------------------------------------------</span>
        <span class="comment">// Try to load the ledger from local storage.</span>
        <span class="comment">//</span>
        std::string strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFolder1name, szFolder2name, szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>

        <span class="keywordflow">if</span> (strFileContents.length() &lt; 2)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::LoadGeneric: Error reading file: %s%s%s%s%s\n&quot;</span>,
                          szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// --------------------------------------------------------------------</span>
        strRawFile.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(strFileContents.c_str());
    }
    <span class="comment">// NOTE: No need to deal with OT ARMORED INBOX file format here, since</span>
    <span class="comment">//       LoadContractFromString already handles that automatically.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == strRawFile.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::LoadGeneric: Unable to load box (%s%s%s%s%s) from empty string.\n&quot;</span>,
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSuccess = this-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strRawFile);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSuccess)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Failed loading %s %s in OTLedger::Load%s: %s%s%s%s%s\n&quot;</span>,
                      pszType, (NULL != pString) ? <span class="stringliteral">&quot;from string&quot;</span> : <span class="stringliteral">&quot;from file&quot;</span>, pszType,
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;Successfully loaded %s %s in OTLedger::Load%s: %s%s%s%s%s\n&quot;</span>,
                       pszType, (NULL != pString) ? <span class="stringliteral">&quot;from string&quot;</span> : <span class="stringliteral">&quot;from file&quot;</span>, pszType,
                       szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                       szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
    }

    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a383560406c46ae01bc5992c4928b45b6"></a><!-- doxytag: member="OTLedger::LoadInbox" ref="a383560406c46ae01bc5992c4928b45b6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">OTLedger::LoadInbox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00437">437</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">//  print_stacktrace();</span>

    <span class="keywordtype">bool</span> bRetVal = <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);

    <span class="keywordflow">return</span> bRetVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adee226f0dab7315814a65a6e08be7fb5"></a><!-- doxytag: member="OTLedger::LoadInboxFromString" ref="adee226f0dab7315814a65a6e08be7fb5" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#adee226f0dab7315814a65a6e08be7fb5">OTLedger::LoadInboxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00464">464</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a472314e803ddaad58d3063c78ef0c22b"></a><!-- doxytag: member="OTLedger::LoadLedgerFromString" ref="a472314e803ddaad58d3063c78ef0c22b" args="(const OTString &amp;theStr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">OTLedger::LoadLedgerFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theStr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01841">1841</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bLoaded = <span class="keyword">false</span>;

    <span class="comment">// Todo security: Look how this is done...</span>
    <span class="comment">// Any vulnerabilities?</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;nymbox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#a7058093dd49939907c448cdf6c4a391a">LoadNymboxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;inbox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#adee226f0dab7315814a65a6e08be7fb5">LoadInboxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;outbox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#a3a908c983d03a683590a228c80af3b4c">LoadOutboxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;paymentInbox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#af96a6ae7202057dca8de1b9ab073efa3">LoadPaymentInboxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;recordBox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#a9b860864e88843d90bc027c2d6faac4d">LoadRecordBoxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;expiredBox\&quot;&quot;</span>))
        bLoaded = this-&gt;<a class="code" href="class_o_t_ledger.html#a3ca2a96eb490fa56d693487a228b25cf">LoadExpiredBoxFromString</a>(theStr);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;\&quot;\n type=\&quot;message\&quot;&quot;</span>))
    {
        <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>  = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>;
        bLoaded = this-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(theStr);
    }
    <span class="keywordflow">return</span> bLoaded;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa77a7e498b3866d054b3c58fb6c8e7d7"></a><!-- doxytag: member="OTLedger::LoadNymbox" ref="aa77a7e498b3866d054b3c58fb6c8e7d7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aa77a7e498b3866d054b3c58fb6c8e7d7">OTLedger::LoadNymbox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00458">458</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7058093dd49939907c448cdf6c4a391a"></a><!-- doxytag: member="OTLedger::LoadNymboxFromString" ref="a7058093dd49939907c448cdf6c4a391a" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a7058093dd49939907c448cdf6c4a391a">OTLedger::LoadNymboxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00476">476</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afa28a4e35a57fa01a8062b608102ddf4"></a><!-- doxytag: member="OTLedger::LoadOutbox" ref="afa28a4e35a57fa01a8062b608102ddf4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">OTLedger::LoadOutbox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00452">452</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3a908c983d03a683590a228c80af3b4c"></a><!-- doxytag: member="OTLedger::LoadOutboxFromString" ref="a3a908c983d03a683590a228c80af3b4c" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a3a908c983d03a683590a228c80af3b4c">OTLedger::LoadOutboxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00470">470</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2089e14094b2047e668bc50e2d5d3eb2"></a><!-- doxytag: member="OTLedger::LoadPaymentInbox" ref="a2089e14094b2047e668bc50e2d5d3eb2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a2089e14094b2047e668bc50e2d5d3eb2">OTLedger::LoadPaymentInbox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00482">482</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af96a6ae7202057dca8de1b9ab073efa3"></a><!-- doxytag: member="OTLedger::LoadPaymentInboxFromString" ref="af96a6ae7202057dca8de1b9ab073efa3" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#af96a6ae7202057dca8de1b9ab073efa3">OTLedger::LoadPaymentInboxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00500">500</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad283d675ba07160bddde117386b872a6"></a><!-- doxytag: member="OTLedger::LoadRecordBox" ref="ad283d675ba07160bddde117386b872a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ad283d675ba07160bddde117386b872a6">OTLedger::LoadRecordBox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00488">488</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9b860864e88843d90bc027c2d6faac4d"></a><!-- doxytag: member="OTLedger::LoadRecordBoxFromString" ref="a9b860864e88843d90bc027c2d6faac4d" args="(const OTString &amp;strBox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a9b860864e88843d90bc027c2d6faac4d">OTLedger::LoadRecordBoxFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strBox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00506">506</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3a9052c23a2838efce273d55da58a51b">LoadGeneric</a>(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>, &amp;strBox);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa46d52115b1ace7f7d6e752a99aaa186"></a><!-- doxytag: member="OTLedger::ProcessXMLNode" ref="aa46d52115b1ace7f7d6e752a99aaa186" args="(irr::io::IrrXMLReader *&amp;xml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_ledger.html#aa46d52115b1ace7f7d6e752a99aaa186">OTLedger::ProcessXMLNode</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a48611c37c8e8e7d9125238bda2b77978">OTContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01989">1989</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTLedger::ProcessXMLNode&quot;</span>;
    <span class="comment">// -------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNodeName = xml-&gt;getNodeName();

    <span class="keywordflow">if</span> (strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;accountLedger&quot;</span>))
    {
        <a class="code" href="class_o_t_string.html">OTString</a>    strType,  <span class="comment">// ledger type</span>
                    strLedgerAcctID, <span class="comment">// purported</span>
                    strLedgerAcctServerID, <span class="comment">// purported</span>
                    strUserID,
                    strNumPartialRecords; <span class="comment">// Ledger contains either full receipts, or abbreviated receipts with hashes and partial data.</span>
        <span class="comment">// ------------------------------------------------------------------</span>
        strType         = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>);
        <a class="code" href="class_o_t_contract.html#aa0d889e0e1670b56fedca245041a5ed3">m_strVersion</a>    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;version&quot;</span>);
        <span class="comment">// ------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;message&quot;</span>))     <span class="comment">// These are used for sending transactions in messages. (Withdrawal request, etc.)</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;nymbox&quot;</span>)) <span class="comment">// Used for receiving new transaction numbers, and for receiving notices.</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;inbox&quot;</span>))  <span class="comment">// These are used for storing the receipts in your inbox. (That server must store until signed-off.)</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;outbox&quot;</span>)) <span class="comment">// Outgoing, pending transfers.</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentInbox&quot;</span>))   <span class="comment">// Receiving invoices, etc.</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;recordBox&quot;</span>))  <span class="comment">// Where receipts go to die (awaiting user deletion, completed from other boxes already.)</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;expiredBox&quot;</span>)) <span class="comment">// Where expired payments go to die (awaiting user deletion, completed from other boxes already.)</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>;
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a">OTLedger::error_state</a>; <span class="comment">// Danger, Will Robinson.</span>
        <span class="comment">// ------------------------------------------------------------------</span>
        strLedgerAcctID         = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;accountID&quot;</span>);
        strLedgerAcctServerID   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;serverID&quot;</span>);
        strUserID               = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;userID&quot;</span>);

        <span class="keywordflow">if</span> (!strLedgerAcctID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strLedgerAcctServerID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strUserID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: missing strLedgerAcctID (%s) or &quot;</span>
                           <span class="stringliteral">&quot;strLedgerAcctServerID (%s) or strUserID (%s) while loading transaction &quot;</span>
                           <span class="stringliteral">&quot;from %s ledger. \n&quot;</span>, szFunc, strLedgerAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strLedgerAcctServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                           strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> (-1);
        }
        <span class="comment">// --------------------------------------------------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    ACCOUNT_ID(strLedgerAcctID),
                        SERVER_ID(strLedgerAcctServerID),
                        USER_ID(strUserID);
        <span class="comment">// --------------------------------------------------------------</span>
                        <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(ACCOUNT_ID);
                        <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(SERVER_ID);
                        <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(USER_ID);

        <span class="keywordflow">if</span> (<span class="keyword">false</span> ==  <a class="code" href="class_o_t_transaction_type.html#a05be1cf5d51725a4b427d5ac9714234b">m_bLoadSecurely</a>)
        {
            <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(ACCOUNT_ID);
            <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(SERVER_ID);
<span class="comment">//            OTString str1(GetRealAccountID()), str2(GetRealServerID());</span>
<span class="comment">//            OTLog::vError(&quot;DEBUGGING:\nReal Acct ID: %s\nReal Server ID: %s\n&quot;,</span>
<span class="comment">//                          str1.Get(), str2.Get());</span>
        }
        <span class="comment">// ------------------------------------------------------------------</span>
        <span class="comment">// Load up the partial records, based on the expected count...</span>
        <span class="comment">//</span>
        strNumPartialRecords    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numPartialRecords&quot;</span>);
        int32_t nPartialRecordCount = (strNumPartialRecords.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atoi(strNumPartialRecords.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0);
        <span class="comment">// -------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strExpected;   <span class="comment">// The record type has a different name for each box.</span>
        <a class="code" href="class_o_t_num_list.html">OTNumList</a>   theNumList;
        <a class="code" href="class_o_t_num_list.html">OTNumList</a> * pNumList = NULL;
        <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>)
        {
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>);pNumList = &amp;theNumList; <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>);                         <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>);                        <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>);                  <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>);                     <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      strExpected.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>);                    <span class="keywordflow">break</span>;
                <span class="comment">/* --- BREAK --- */</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>:
                <span class="keywordflow">if</span> (nPartialRecordCount &gt; 0) <span class="comment">// -------------------</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: There are %d unexpected abbreviated records in an &quot;</span>
                                  <span class="stringliteral">&quot;OTLedger::message type ledger. (Failed loading ledger with accountID: %s)\n&quot;</span>,
                                  szFunc, nPartialRecordCount, strLedgerAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="keywordflow">return</span> (-1);
                }<span class="comment">// -----------------------------------------------</span>
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:<a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::ProcessXMLNode: Unexpected ledger type (%s). (Failed loading &quot;</span>
                                  <span class="stringliteral">&quot;ledger for account: %s)\n&quot;</span>, strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strLedgerAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="keywordflow">return</span> (-1);
        } <span class="comment">// switch (to set strExpected to the abbreviated record type.)</span>
        <span class="comment">// -------------------------</span>
        <span class="keywordflow">if</span> (nPartialRecordCount &gt; 0) <span class="comment">// message ledger will never enter this block due to switch block (above.)</span>
        {
            <span class="comment">// -------------------------------</span>
            <span class="comment">// We iterate to read the expected number of partial records from the xml.</span>
            <span class="comment">// (They had better be there...)</span>
            <span class="comment">//</span>
            <span class="keywordflow">while</span> (nPartialRecordCount-- &gt; 0)
            {
<span class="comment">//              xml-&gt;read(); // &lt;==================</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a6d67d87a183391e60f4aca8a3856fdb2">SkipToElement</a>(xml))
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find element when one was expected (%s) &quot;</span>
                                   <span class="stringliteral">&quot;for abbreviated record of receipt in %s box:\n\n%s\n\n&quot;</span>, szFunc,
                                   strExpected.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>(),
                                   <a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="keywordflow">return</span> (-1);
                }
                <span class="comment">// -----------------------------------------------</span>
                <span class="comment">// strExpected can be one of:</span>
                <span class="comment">//</span>
<span class="comment">//              strExpected.Set(&quot;nymboxRecord&quot;);</span>
<span class="comment">//              strExpected.Set(&quot;inboxRecord&quot;);</span>
<span class="comment">//              strExpected.Set(&quot;outboxRecord&quot;);</span>
                <span class="comment">//</span>
                <span class="comment">// We&#39;re loading here either a nymboxRecord, inboxRecord, or outboxRecord...</span>
                <span class="comment">//</span>
                <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strLoopNodeName = xml-&gt;getNodeName();

                <span class="keywordflow">if</span> (strLoopNodeName.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; (xml-&gt;getNodeType() == irr::io::EXN_ELEMENT) &amp;&amp; (strExpected.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(strLoopNodeName)))
                {
                    int64_t lNumberOfOrigin = 0;
                    int64_t lTransactionNum = 0;
                    int64_t lInRefTo            = 0;
                    int64_t lInRefDisplay       = 0;
                    <span class="comment">// -------------------------------------</span>
                    <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> the_DATE_SIGNED = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
                    <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> theType = <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa9f75065337929a6aea3ff52aabf2bf8a">OTTransaction::error_state</a>; <span class="comment">// default</span>
                    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
                    <span class="comment">// -------------------------------------</span>
                    int64_t lAdjustment     = 0;
                    int64_t lDisplayValue       = 0;
                    int64_t lClosingNum     = 0;
                    int64_t lRequestNum        = 0;
                    <span class="keywordtype">bool</span> bReplyTransSuccess = <span class="keyword">false</span>;
                    <span class="comment">// -------------------------------------</span>
                    int32_t nAbbrevRetVal =
                        <a class="code" href="class_o_t_transaction.html#aa0726f273b313b03bad0390ed2b8bb19">OTTransaction::LoadAbbreviatedRecord</a>(xml,
                                                             lNumberOfOrigin,
                                                             lTransactionNum,
                                                             lInRefTo,
                                                             lInRefDisplay,
                                                             the_DATE_SIGNED,
                                                             theType,
                                                             strHash,
                                                             lAdjustment,
                                                             lDisplayValue,
                                                             lClosingNum,
                                                             lRequestNum,
                                                             bReplyTransSuccess,
                                                             pNumList); <span class="comment">// This is for &quot;OTTransaction::blank&quot; and &quot;OTTransaction::successNotice&quot;, otherwise NULL.</span>
                    <span class="keywordflow">if</span> ((-1) == nAbbrevRetVal)
                        <span class="keywordflow">return</span> (-1); <span class="comment">// The function already logs appropriately.</span>
                    <span class="comment">// -------------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// See if the same-ID transaction already exists in the ledger.</span>
                    <span class="comment">// (There can only be one.)</span>
                    <span class="comment">//</span>
                    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pExistingTrans = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTransactionNum);
                    <span class="keywordflow">if</span> (NULL != pExistingTrans) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                    {
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading transaction %lld (%s), since one was &quot;</span>
                                       <span class="stringliteral">&quot;already there, in box for account: %s.\n&quot;</span>, szFunc,
                                       lTransactionNum, strExpected.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                       strLedgerAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                        <span class="keywordflow">return</span> (-1);
                    }
                    <span class="comment">// ----------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// CONSTRUCT THE ABBREVIATED RECEIPT HERE...</span>

                    <span class="comment">// Set all the values we just loaded here during actual construction of transaction</span>
                    <span class="comment">// (as abbreviated transaction) i.e. make a special constructor for abbreviated transactions</span>
                    <span class="comment">// which is ONLY used here.</span>
                    <span class="comment">//</span>
                    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <span class="keyword">new</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a>(USER_ID,
                                                                     ACCOUNT_ID,
                                                                     SERVER_ID,
                                                                     lNumberOfOrigin,
                                                                     lTransactionNum,
                                                                     lInRefTo,          <span class="comment">// lInRefTo</span>
                                                                     lInRefDisplay,
                                                                     the_DATE_SIGNED,
                                                                     theType,
                                                                     strHash,
                                                                     lAdjustment,
                                                                     lDisplayValue,
                                                                     lClosingNum,
                                                                     lRequestNum,
                                                                     bReplyTransSuccess,
                                                                     pNumList); <span class="comment">// This is for &quot;OTTransaction::blank&quot; and &quot;OTTransaction::successNotice&quot;, otherwise NULL.</span>
                    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction); <span class="comment">// --------------------------------</span>
                    <span class="comment">//</span>
                    <span class="comment">// NOTE: For THIS CONSTRUCTOR ONLY, we DO set the purported AcctID and purported ServerID.</span>
                    <span class="comment">// WHY? Normally you set the &quot;real&quot; IDs at construction, and then set the &quot;purported&quot; IDs</span>
                    <span class="comment">// when loading from string. But this constructor (only this one) is actually used when</span>
                    <span class="comment">// loading abbreviated receipts as you load their inbox/outbox/nymbox.</span>
                    <span class="comment">// Abbreviated receipts are not like real transactions, which have serverID, AcctID, userID,</span>
                    <span class="comment">// and signature attached, and the whole thing is base64-encoded and then added to the ledger</span>
                    <span class="comment">// as part of a list of contained objects. Rather, with abbreviated receipts, there are a series</span>
                    <span class="comment">// of XML records loaded up as PART OF the ledger itself. None of these individual XML records</span>
                    <span class="comment">// has its own signature, or its own record of the main IDs -- those are assumed to be on the parent</span>
                    <span class="comment">// ledger.</span>
                    <span class="comment">// That&#39;s the whole point: abbreviated records don&#39;t store redundant info, and don&#39;t each have their</span>
                    <span class="comment">// own signature, because we want them to be as small as possible inside their parent ledger.</span>
                    <span class="comment">// Therefore I will pass in the parent ledger&#39;s &quot;real&quot; IDs at construction, and immediately thereafter</span>
                    <span class="comment">// set the parent ledger&#39;s &quot;purported&quot; IDs onto the abbreviated transaction. That way, VerifyContractID()</span>
                    <span class="comment">// will still work and do its job properly with these abbreviated records.</span>
                    <span class="comment">//</span>
                    <span class="comment">// This part normally happens in &quot;GenerateTransaction&quot;.</span>
                    <span class="comment">// NOTE: Moved to OTTransaction constructor (for abbreviateds) for now.</span>
                    <span class="comment">//</span>
<span class="comment">//                    pTransaction-&gt;SetPurportedAccountID(  this-&gt;GetPurportedAccountID());</span>
<span class="comment">//                    pTransaction-&gt;SetPurportedServerID(   this-&gt;GetPurportedServerID());</span>
                    <span class="comment">// --------------------------------------------------------------------</span>
                    <span class="comment">// Add it to the ledger&#39;s list of transactions...</span>
                    <span class="comment">//</span>

                    <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>())
                    {
                        <span class="comment">// Add it to the ledger...</span>
                        <span class="comment">//</span>
                        m_mapTransactions[pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()] = pTransaction;
                        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aceb0b4c83da5f50512bf6045fef6583b">SetParent</a>(*<span class="keyword">this</span>);
<span class="comment">//                      OTLog::Output(5, &quot;Loaded abbreviated transaction and adding to m_mapTransactions in OTLedger\n&quot;);</span>
                    }
                    <span class="keywordflow">else</span>
                    {
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: verifying contract ID on abbreviated transaction %lld\n&quot;</span>,
                                      szFunc, pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                        <span class="keyword">delete</span> pTransaction;
                        pTransaction = NULL;
                        <span class="keywordflow">return</span> (-1);
                    }
<span class="comment">//                  xml-&gt;read(); // &lt;==================</span>
                    <span class="comment">// MIGHT need to add &quot;skip after element&quot; here.</span>
                    <span class="comment">//</span>
                    <span class="comment">// Update: Nope.</span>
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected abbreviated record element.\n&quot;</span>, szFunc);
                    <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
                }
            } <span class="comment">// while</span>
        } <span class="comment">//if (number of partial records &gt; 0)</span>
        <span class="comment">// --------------------------------</span>


        <span class="comment">// ------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;%s: Loading account ledger of type \&quot;%s\&quot;, version: %s\n&quot;</span>, szFunc,
<span class="comment">//              &quot;accountID: %s\n userID: %s\n serverID: %s\n----------\n&quot;,  szFunc,</span>
                strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                <a class="code" href="class_o_t_contract.html#aa0d889e0e1670b56fedca245041a5ed3">m_strVersion</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()
<span class="comment">//              strLedgerAcctID.Get(), strUserID.Get(), strLedgerAcctServerID.Get()</span>
                );

        <span class="comment">// Since we just loaded this stuff, let&#39;s verify it.</span>
        <span class="comment">// We may have to remove this verification here and do it outside this call.</span>
        <span class="comment">// But for now...</span>

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>())
            <span class="keywordflow">return</span> 1;
        <span class="keywordflow">else</span>
            <span class="keywordflow">return</span> (-1);
    }

    <span class="comment">// Todo: When loading abbreviated list of records, set the m_bAbbreviated to true.</span>
    <span class="comment">// Then in THIS block below, if that is set to true, then seek an existing transaction instead of</span>
    <span class="comment">// instantiating a new one. Then repopulate the new one and verify the new values against the ones</span>
    <span class="comment">// that were already there before overwriting anything.</span>

    <span class="comment">// Hmm -- technically this code should only execute for OTLedger::message, and thus only if</span>
    <span class="comment">// m_bIsAbbreviated is FALSE. When the complete receipt is loaded, &quot;LoadBoxReceipt()&quot; will be</span>
    <span class="comment">// called, and it will directly load the transaction starting in OTTransaction::ProcessXMLNode().</span>
    <span class="comment">// THAT is where we must check for abbreviated mode and expect it already loaded etc etc. Whereas</span>
    <span class="comment">// here in this spot, we basically want to error out if it&#39;s not a message ledger.</span>
    <span class="comment">// UPDATE: However, I must consider legacy data. For now, I&#39;ll allow this to load in any type of box.</span>
    <span class="comment">// I also need to check and see if the box receipt already exists (since its normal creation point</span>
    <span class="comment">// may not have happened, when taking legacy data into account.) If it doesn&#39;t already exist, then I</span>
    <span class="comment">// should save it again at this point.</span>
    <span class="comment">//</span>

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transaction&quot;</span>))
    {
        <a class="code" href="class_o_t_string.html">OTString</a>        strTransaction;
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>    ascTransaction;

        <span class="comment">// go to the next node and read the text.</span>
<span class="comment">//      xml-&gt;read(); // &lt;==================</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a219a1ee572cecb9b6510c9869d8c4a64">SkipToTextField</a>(xml))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: Unable to find expected text field &quot;</span>
                          <span class="stringliteral">&quot;containing receipt transaction in box. \n&quot;</span>, __FUNCTION__);
            <span class="keywordflow">return</span> (-1);
        }
        <span class="comment">// -----------------------------------------------</span>
        <span class="keywordflow">if</span> (irr::io::EXN_TEXT == xml-&gt;getNodeType())
        {
            <span class="comment">// the ledger contains a series of transactions.</span>
            <span class="comment">// Each transaction is initially stored as an OTASCIIArmor string.</span>
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strLoopNodeData = xml-&gt;getNodeData();

            <span class="keywordflow">if</span> (strLoopNodeData.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                ascTransaction.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(strLoopNodeData);        <span class="comment">// Put the ascii-armored node data into the ascii-armor object</span>

            <span class="comment">// Decode that into strTransaction, so we can load the transaction object from that string.</span>
            <span class="keywordflow">if</span> (!ascTransaction.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !ascTransaction.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strTransaction))
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Missing expected transaction contents. Ledger contents:\n\n%s\n\n&quot;</span>,
                              __FUNCTION__, <a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="keywordflow">return</span> (-1);
            }
            <span class="comment">// ------------------------------</span>
            <span class="comment">// I belive we&#39;re only supposed to use purported numbers when loading/saving, and to compare them (as distrusted)</span>
            <span class="comment">// against a more-trusted source, in order to verify them. Whereas when actually USING the numbers (such as here,</span>
            <span class="comment">// when &quot;GetRealAccountID()&quot; is being used to instantiate the transaction, then you ONLY use numbers that you KNOW</span>
            <span class="comment">// are good (the number you were expecting) versus whatever number was actually in the file.</span>
            <span class="comment">// But wait, you ask, how do I know they are the same number then? Because you verified that when you first loaded</span>
            <span class="comment">// everything into memory. Right after &quot;load&quot; was a &quot;verify&quot; that makes sure the &quot;real&quot; account ID and the &quot;purported&quot;</span>
            <span class="comment">// account ID are actually the same.</span>
            <span class="comment">//</span>
            <span class="comment">// UPDATE: If this ledger is loaded from string, there&#39;s no guarantee that the real IDs have even been set.</span>
            <span class="comment">// In some cases (Factory...) they definitely have not been. It makes sense here when loading, to set the member</span>
            <span class="comment">// transactions to the same account/server IDs that were actually loaded for their parent ledger. Therefore, changing</span>
            <span class="comment">// back here to Purported values.</span>
            <span class="comment">//</span>
<span class="comment">//          OTTransaction * pTransaction = new OTTransaction(GetUserID(), GetRealAccountID(),      GetRealServerID());</span>
            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <span class="keyword">new</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a>(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), <a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>(), <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

            <span class="comment">// Need this set before the LoadContractFromString().</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (<span class="keyword">false</span> ==  <a class="code" href="class_o_t_transaction_type.html#a05be1cf5d51725a4b427d5ac9714234b">m_bLoadSecurely</a>)
                pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a0734d617542cad4697f7852a15ef7b3c">SetLoadInsecure</a>();
            <span class="comment">// -------------------------------------------</span>

            <span class="comment">// If we&#39;re able to successfully base64-decode the string and load it up as</span>
            <span class="comment">// a transaction, then let&#39;s add it to the ledger&#39;s list of transactions</span>
            <span class="keywordflow">if</span> (strTransaction.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp;
                pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction) &amp;&amp;
                pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>())
                <span class="comment">// I responsible here to call pTransaction-&gt;VerifyContractID() since</span>
                <span class="comment">// I am loading it here and adding it to the ledger. (So I do.)</span>
            {
                <span class="comment">// ------------------------------------------------------------------</span>
                <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pExistingTrans = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">if</span> (NULL != pExistingTrans) <span class="comment">// Uh-oh, it&#39;s already there!</span>
                {
                    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strPurportedAcctID(this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>());
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error loading full transaction %lld, since one was &quot;</span>
                                   <span class="stringliteral">&quot;already there, in box for account: %s.\n&quot;</span>, szFunc,
                                   pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), strPurportedAcctID.Get());
                    <span class="keyword">delete</span> pTransaction; pTransaction = NULL;
                    <span class="keywordflow">return</span> (-1);
                }
                <span class="comment">// ------------------------------------------------------------------</span>
                <span class="comment">// It&#39;s not already there on this ledger -- so add it!</span>
                <span class="comment">// (Below this point, no need to delete pTransaction upon returning.)</span>
                <span class="comment">//</span>
                m_mapTransactions[pTransaction-&gt;GetTransactionNum()] = pTransaction;
                pTransaction-&gt;SetParent(*<span class="keyword">this</span>);
<span class="comment">//              OTLog::Output(5, &quot;Loaded full transaction and adding to m_mapTransactions in OTLedger\n&quot;);</span>

                <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
                {
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>:
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:
                    <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:
                    {
                        <span class="comment">// For the sake of legacy data, check for existence of box receipt here,</span>
                        <span class="comment">// and re-save that box receipt if it doesn&#39;t exist.</span>
                        <span class="comment">//</span>
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;--- Apparently this is old data (the transaction is still stored inside the ledger itself)... \n&quot;</span>);
                        <a class="code" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">m_bLoadedLegacyData</a> = <span class="keyword">true</span>; <span class="comment">// Only place this is set true.</span>

                        <span class="keyword">const</span> int32_t nBoxType = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>());

                        <span class="keyword">const</span> <span class="keywordtype">bool</span> bBoxReceiptAlreadyExists =
                            <a class="code" href="class_o_t_transaction.html#acf756f8e3b1d1b9f1e9d2bcb48cbe927">OTTransaction::VerifyBoxReceiptExists</a>(pTransaction-&gt;GetRealServerID(),
                                                                  pTransaction-&gt;GetUserID(),
                                                                  pTransaction-&gt;GetRealAccountID(), <span class="comment">// If Nymbox (vs inbox/outbox) the USER_ID will be in this field also.</span>
                                                                  nBoxType,                         <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
                                                                  pTransaction-&gt;GetTransactionNum());
                        <span class="keywordflow">if</span> (<span class="keyword">false</span> == bBoxReceiptAlreadyExists) <span class="comment">// Doesn&#39;t already exist separately.</span>
                        {
                            <span class="comment">// Okay then, let&#39;s create it...</span>
                            <span class="comment">//</span>
                            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;--- The BoxReceipt doesn&#39;t exist separately (yet.) Creating it in local storage...\n&quot;</span>);

                            <span class="keyword">const</span> int64_t lBoxType = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(nBoxType);

                            <span class="keywordflow">if</span> (<span class="keyword">false</span> == pTransaction-&gt;SaveBoxReceipt(lBoxType)) <span class="comment">//  &lt;======== SAVE BOX RECEIPT</span>
                                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;--- FAILED trying to save BoxReceipt from legacy data to local storage!\n&quot;</span>);
                        }
                    }
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unknown ledger type while loading transaction! (Should never happen.)\n&quot;</span>,
                                      szFunc); <span class="comment">// todo: assert here? &quot;should never happen&quot; ...</span>
                        <span class="keywordflow">return</span> (-1);
                } <span class="comment">// switch (this-&gt;GetType())</span>
                <span class="comment">// ---------------------------------------------</span>
            }   <span class="comment">// if transaction loads and verifies.</span>
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;ERROR: loading or verifying transaction in OTLedger::ProcessXMLNode\n&quot;</span>);
                <span class="keywordflow">if</span> (NULL != pTransaction)
                {
                    <span class="keyword">delete</span> pTransaction;
                    pTransaction = NULL;
                }
                <span class="keywordflow">return</span> (-1);
            }
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTLedger::ProcessXMLNode: transaction without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }
        <span class="keywordflow">return</span> 1;
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab39066df3f397573a6c840c114e94ed1"></a><!-- doxytag: member="OTLedger::ProduceOutboxReport" ref="ab39066df3f397573a6c840c114e94ed1" args="(OTItem &amp;theBalanceItem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#ab39066df3f397573a6c840c114e94ed1">OTLedger::ProduceOutboxReport</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_item.html">OTItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theBalanceItem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01670">1670</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a> != <a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong ledger type.\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// loop through the OUTBOX transactions, and produce a sub-item onto theBalanceItem for each, which will</span>
    <span class="comment">// be a report on each pending transfer in this outbox, therefore added to the balance item.</span>
    <span class="comment">// (So the balance item contains a complete report on the outoing transfers in this outbox.)</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="comment">// it only reports receipts where we don&#39;t yet have balance agreement.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a1820ab7e64e5cd46baf19f21ce2f0bf0">ProduceOutboxReportItem</a>(theBalanceItem);  <span class="comment">// &lt;======= This function adds a pending transfer sub-item to theBalanceItem, where appropriate.</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7bc5480937407cd3fe47d643b015e464"></a><!-- doxytag: member="OTLedger::Release" ref="a7bc5480937407cd3fe47d643b015e464" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#a7bc5480937407cd3fe47d643b015e464">OTLedger::Release</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#aeec55f5abb43646745a532bf10aece24">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l02451">2451</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html#a39d56bb887c5d5acf1b8e353946a062f">Release_Ledger</a>();

    <a class="code" href="class_o_t_transaction_type.html#aeec55f5abb43646745a532bf10aece24">ot_super::Release</a>(); <span class="comment">// since I&#39;ve overridden the base class, I call it now...</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a39d56bb887c5d5acf1b8e353946a062f"></a><!-- doxytag: member="OTLedger::Release_Ledger" ref="a39d56bb887c5d5acf1b8e353946a062f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#a39d56bb887c5d5acf1b8e353946a062f">OTLedger::Release_Ledger</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l02445">2445</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html#ade9cb07bcb99f244712fe948291fbb6c">ReleaseTransactions</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade9cb07bcb99f244712fe948291fbb6c"></a><!-- doxytag: member="OTLedger::ReleaseTransactions" ref="ade9cb07bcb99f244712fe948291fbb6c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#ade9cb07bcb99f244712fe948291fbb6c">OTLedger::ReleaseTransactions</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l02431">2431</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// If there were any dynamically allocated objects, clean them up here.</span>

    <span class="keywordflow">while</span> (!m_mapTransactions.empty())
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = m_mapTransactions.begin()-&gt;second;
        m_mapTransactions.erase(m_mapTransactions.begin());
        <span class="keyword">delete</span> pTransaction;
        pTransaction = NULL;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acfb903f9b389367653d22b10df900978"></a><!-- doxytag: member="OTLedger::RemoveTransaction" ref="acfb903f9b389367653d22b10df900978" args="(int64_t lTransactionNum, bool bDeleteIt=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">OTLedger::RemoveTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bDeleteIt</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If transaction #87, in reference to #74, is in the inbox, you can remove it by calling this function and passing in 87. Deletes. </p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01093">1093</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTLedger::RemoveTransaction&quot;</span>;

    <span class="comment">// See if there&#39;s something there with that transaction number.</span>
    mapOfTransactions::iterator it = m_mapTransactions.find(lTransactionNum);

    <span class="comment">// If it&#39;s not already on the list, then there&#39;s nothing to remove.</span>
    <span class="keywordflow">if</span> ( it == m_mapTransactions.end() )
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Attempt to remove Transaction from ledger, when not already there: %lld\n&quot;</span>,
                      szFunc, lTransactionNum);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Otherwise, if it WAS already there, remove it properly.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        m_mapTransactions.erase(it);

        <span class="keywordflow">if</span> (bDeleteIt)
        {
            <span class="keyword">delete</span> pTransaction;
            pTransaction = NULL;
        }
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a37b54e63ee359e0561662c5a76477225"></a><!-- doxytag: member="OTLedger::SaveBoxReceipt" ref="a37b54e63ee359e0561662c5a76477225" args="(const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a37b54e63ee359e0561662c5a76477225">OTLedger::SaveBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00264">264</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">// First, see if the transaction itself exists on this ledger.</span>
    <span class="comment">// Get a pointer to it.</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction  = this-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTransactionNum);

    <span class="keywordflow">if</span> (NULL == pTransaction)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTLedger::SaveBoxReceipt: Unable to save box receipt %lld: &quot;</span>
                       <span class="stringliteral">&quot;couldn&#39;t find the transaction on this ledger.\n&quot;</span>, lTransactionNum);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span>  pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(*<span class="keyword">this</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a304007b699192719d05c6e72ac1b580e"></a><!-- doxytag: member="OTLedger::SaveBoxReceipts" ref="a304007b699192719d05c6e72ac1b580e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a304007b699192719d05c6e72ac1b580e">OTLedger::SaveBoxReceipts</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00238">238</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bRetVal = <span class="keyword">true</span>;
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        <span class="comment">// -------------------------------</span>

        <span class="comment">// We only save full versions of transactions as box receipts, not abbreviated versions.</span>
        <span class="comment">// (If it&#39;s not abbreviated, therefore it&#39;s the full version.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>()) <span class="comment">// This way we won&#39;t see an error if it&#39;s not abbreviated.</span>
            bRetVal = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(*<span class="keyword">this</span>);

        <span class="keywordflow">if</span> (!bRetVal)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::SaveBoxReceipts: Failed calling SaveBoxReceipt on transaction: %lld.\n&quot;</span>,
                          pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
            <span class="keywordflow">break</span>;
        }
    }
    <span class="keywordflow">return</span> bRetVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5c595ed0f34346f50f5fa821005ec376"></a><!-- doxytag: member="OTLedger::SaveContractWallet" ref="a5c595ed0f34346f50f5fa821005ec376" args="(std::ofstream &amp;ofs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a5c595ed0f34346f50f5fa821005ec376">OTLedger::SaveContractWallet</a> </td>
          <td>(</td>
          <td class="paramtype">std::ofstream &amp;&#160;</td>
          <td class="paramname"><em>ofs</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#abd60f993ccc74387236943cd4209f72e">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l02459">2459</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace1cb1337e94d794243bbe163eb88813"></a><!-- doxytag: member="OTLedger::SaveExpiredBox" ref="ace1cb1337e94d794243bbe163eb88813" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ace1cb1337e94d794243bbe163eb88813">OTLedger::SaveExpiredBox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00887">887</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SaveExpiredBox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae268af5638702fcc9abaef6c1cca3ec1"></a><!-- doxytag: member="OTLedger::SaveGeneric" ref="ae268af5638702fcc9abaef6c1cca3ec1" args="(ledgerType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">OTLedger::SaveGeneric</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">OTLedger::ledgerType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00623">623</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> = theType;

    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszFolder = NULL;
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszType = <a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>();

    <span class="keywordflow">switch</span> (theType)
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          pszFolder = <a class="code" href="class_o_t_folders.html#ada1729c82d6ebbfa53b16d511d2aded4">OTFolders::Nymbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           pszFolder = <a class="code" href="class_o_t_folders.html#a6f314709ced53a8c542eb5ef53126b39">OTFolders::Inbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();           <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          pszFolder = <a class="code" href="class_o_t_folders.html#af4ad3cfbb3030044148f03fd8020c41a">OTFolders::Outbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    pszFolder = <a class="code" href="class_o_t_folders.html#a92fc938529eac80e1a040a664d844847">OTFolders::PaymentInbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       pszFolder = <a class="code" href="class_o_t_folders.html#a33b17e178549458a5fa7596dcf38adc6">OTFolders::RecordBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();       <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      pszFolder = <a class="code" href="class_o_t_folders.html#a1dfba6274248dcc7cb910770635720f6">OTFolders::ExpiredBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();      <span class="keywordflow">break</span>;
            <span class="comment">/* --- BREAK --- */</span>
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::SaveGeneric: Error: unknown box type. (This should never happen.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a> = pszFolder;  <span class="comment">// &lt;=======</span>
    <span class="comment">// --------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strID;
    <a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strID);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        <a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s%s%s&quot;</span>, strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
    strFilename = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(); <span class="comment">// &quot;nymbox&quot; (or &quot;inbox&quot; or &quot;outbox&quot;)</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();     <span class="comment">// &quot;nymbox/SERVER_ID&quot;</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();     <span class="comment">// &quot;nymbox/SERVER_ID/USER_ID&quot;  (or &quot;inbox/SERVER_ID/ACCT_ID&quot; or &quot;outbox/SERVER_ID/ACCT_ID&quot;)</span>

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(<a class="code" href="class_o_t_contract.html#ab1e11693a38a1673037b1f29c9d84010">m_strFoldername</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(<a class="code" href="class_o_t_contract.html#ab7ab1f1fe7ff7e52f2c126404a8f4f92">m_strFilename</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()   &gt; 2);
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strRawFile;

    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strRawFile))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::SaveGeneric: Error saving %s (to string):\n%s%s%s%s%s\n&quot;</span>, pszType,
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(strRawFile);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::SaveGeneric: Error saving %s (failed writing armored string):\n%s%s%s%s%s\n&quot;</span>, pszType,
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), szFolder1name,
                                         szFolder2name, szFilename); <span class="comment">// &lt;=== SAVING TO DATA STORE.</span>
    <span class="keywordflow">if</span> (!bSaved)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::SaveGeneric: Error writing %s to file: %s%s%s%s%s\n&quot;</span>, pszType,
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;Successfully saved %s: %s%s%s%s%s\n&quot;</span>, pszType,
                       szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
    <span class="comment">// --------------------------------------------------------------------</span>

    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a53d47cbd97a874f205dcfb1df75eba40"></a><!-- doxytag: member="OTLedger::SaveInbox" ref="a53d47cbd97a874f205dcfb1df75eba40" args="(OTIdentifier *pInboxHash=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a53d47cbd97a874f205dcfb1df75eba40">OTLedger::SaveInbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pInboxHash</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00790">790</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{

<span class="comment">//  OTString strTempBlah, strTempBlah2(*this);</span>
<span class="comment">//  GetIdentifier(strTempBlah);</span>
<span class="comment">//  OTLog::vError(&quot;OTLedger::SaveInbox: DEBUGGING: SAVING INBOX for account: %s, number of transactions currently in the inbox: %d \n\n STACK TRACE:\n\n&quot;,</span>
<span class="comment">//                strTempBlah.Get(), GetTransactionCount());</span>
<span class="comment">//</span>
<span class="comment">//  print_stacktrace();</span>

<span class="comment">//  OTLog::vError(&quot;OTLedger::SaveInbox: (CONTINUED DEBUGGING):  INBOX CONTENTS: \n\n%s\n\n&quot;,</span>
<span class="comment">//                strTempBlah2.Get());</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SaveInbox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSaved = <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// Sometimes the caller, when saving the Inbox, wants to know what the</span>
    <span class="comment">// latest Inbox hash is. FYI, the InboxHash is calculated on the UNSIGNED</span>
    <span class="comment">// contents of the Inbox. So if pInboxHash is not NULL, then that is where</span>
    <span class="comment">// I will put the new hash, as output for the caller of this function.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bSaved &amp;&amp; (NULL != pInboxHash))
    {
        pInboxHash-&gt;<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

        <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_ledger.html#a520421fca03ee9ccefe03dacf6589ecc">CalculateInboxHash</a>(*pInboxHash))
<span class="comment">//      if (!pInboxHash-&gt;CalculateDigest(m_xmlUnsigned))</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::SaveInbox: Failed trying to calculate Inbox hash.\n&quot;</span>);
    }

    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa2dec5beccd6e4a55cfe45788ebd2137"></a><!-- doxytag: member="OTLedger::SaveNymbox" ref="aa2dec5beccd6e4a55cfe45788ebd2137" args="(OTIdentifier *pNymboxHash=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aa2dec5beccd6e4a55cfe45788ebd2137">OTLedger::SaveNymbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pNymboxHash</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00758">758</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SaveNymbox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSaved = <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// Sometimes the caller, when saving the Nymbox, wants to know what the</span>
    <span class="comment">// latest Nymbox hash is. FYI, the NymboxHash is calculated on the UNSIGNED</span>
    <span class="comment">// contents of the Nymbox. So if pNymboxHash is not NULL, then that is where</span>
    <span class="comment">// I will put the new hash, as output for the caller of this function.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bSaved &amp;&amp; (NULL != pNymboxHash))
    {
        pNymboxHash-&gt;<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

        <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_ledger.html#aad762086bb009eacd8f60d7e078357a4">CalculateNymboxHash</a>(*pNymboxHash))
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::SaveNymbox: Failed trying to calculate nymbox hash.\n&quot;</span>);
<span class="comment">//</span>
<span class="comment">//        if (!pNymboxHash-&gt;CalculateDigest(m_xmlUnsigned))</span>
<span class="comment">//            OTLog::Error(&quot;OTLedger::SaveNymbox: Failed trying to calculate nymbox hash.\n&quot;);</span>
    }

    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a97cb4ada66ef13b442bfd69e0a9e0c25"></a><!-- doxytag: member="OTLedger::SaveOutbox" ref="a97cb4ada66ef13b442bfd69e0a9e0c25" args="(OTIdentifier *pOutboxHash=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a97cb4ada66ef13b442bfd69e0a9e0c25">OTLedger::SaveOutbox</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOutboxHash</em> = <code>NULL</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00831">831</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SaveOutbox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSaved = <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// Sometimes the caller, when saving the Outbox, wants to know what the</span>
    <span class="comment">// latest Outbox hash is. FYI, the OutboxHash is calculated on the UNSIGNED</span>
    <span class="comment">// contents of the Outbox. So if pOutboxHash is not NULL, then that is where</span>
    <span class="comment">// I will put the new hash, as output for the caller of this function.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bSaved &amp;&amp; (NULL != pOutboxHash))
    {
        pOutboxHash-&gt;<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

        <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_ledger.html#abc8bced33099b04f251040bf6a0b219c">CalculateOutboxHash</a>(*pOutboxHash))
<span class="comment">//      if (!pOutboxHash-&gt;CalculateDigest(m_xmlUnsigned))</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::SaveOutbox: Failed trying to calculate Outbox hash.\n&quot;</span>);
    }

    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab6f6af26a690d49f61ec7ffcc557a302"></a><!-- doxytag: member="OTLedger::SavePaymentInbox" ref="ab6f6af26a690d49f61ec7ffcc557a302" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#ab6f6af26a690d49f61ec7ffcc557a302">OTLedger::SavePaymentInbox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00861">861</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SavePaymentInbox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aff379f9b12cebb1132bca402396f1a8a"></a><!-- doxytag: member="OTLedger::SaveRecordBox" ref="aff379f9b12cebb1132bca402396f1a8a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aff379f9b12cebb1132bca402396f1a8a">OTLedger::SaveRecordBox</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00874">874</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a> != <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong ledger type passed to OTLedger::SaveRecordBox.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#ae268af5638702fcc9abaef6c1cca3ec1">SaveGeneric</a>(<a class="code" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">m_Type</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a693eb8428f49e984f7705adb12a56fc6"></a><!-- doxytag: member="OTLedger::UpdateContents" ref="a693eb8428f49e984f7705adb12a56fc6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_ledger.html#a693eb8428f49e984f7705adb12a56fc6">OTLedger::UpdateContents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a78c28164555e2eb79d6b67698421638d">OTContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l01870">1870</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span>    bSavingAbbreviated  = <span class="keyword">true</span>; <span class="comment">// The default. Only OTLedger::message changes this to false.</span>
    int32_t     nPartialRecordCount = 0;    <span class="comment">// We store this, so we know how many abbreviated records to read back later.</span>

    <span class="comment">// --------------------------------</span>
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
            <span class="comment">// a message ledger stores the full receipts directly inside itself. (No separate files.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>:
            bSavingAbbreviated  = <span class="keyword">false</span>;
            nPartialRecordCount = 0; <span class="comment">// In this case (OTLedger::message), they are all FULL records, not abbreviated.</span>
            <span class="keywordflow">break</span>;
            <span class="comment">// -----------------------------</span>
            <span class="comment">// These store abbreviated versions of themselves, with the actual receipts in separate files.</span>
            <span class="comment">// Those separate files are created on server side when first added to the box, and on client</span>
            <span class="comment">// side when downloaded from the server. They must match the hash that appears in the box.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:
            bSavingAbbreviated  = <span class="keyword">true</span>;
            nPartialRecordCount = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (m_mapTransactions.size()); <span class="comment">// We store this, so we know how many abbreviated records to read back later.</span>
            <span class="keywordflow">break</span>;
            <span class="comment">// -----------------------------</span>
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::UpdateContents: Error: unexpected box type (1st block). (This should never happen.)\n&quot;</span>);
            <span class="keywordflow">return</span>;
    }
    <span class="comment">// --------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Notice I use the PURPORTED Account ID and Server ID to create the output. That&#39;s because</span>
    <span class="comment">// I don&#39;t want to inadvertantly substitute the real ID for a bad one and then sign it.</span>
    <span class="comment">// So if there&#39;s a bad one in there when I read it, THAT&#39;s the one that I write as well!</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a>    strType(<a class="code" href="class_o_t_ledger.html#a12f028ac95367cc8e48ad2636565c3a2">GetTypeString</a>()),
                strLedgerAcctID(<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()),
                strLedgerAcctServerID(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()),
                strUserID(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
    <span class="comment">// -----------------------------------------</span>
    <span class="comment">// I release this because I&#39;m about to repopulate it.</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();

<span class="comment">//  m_xmlUnsigned.Concatenate(&quot;&lt;?xml version=\&quot;%s\&quot;?&gt;\n\n&quot;, &quot;1.0&quot;);</span>
    <span class="comment">// ------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strLedgerContents = <span class="stringliteral">&quot;&quot;</span>;

    int32_t nPartialACTUALCount = 0;

    <span class="comment">// loop through the transactions and print them out here.</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_ledger_8hpp.html#a1823ddf57c0de6495aa8ec5da7f1b8f7">mapOfTransactions</a>, m_mapTransactions)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = (*it).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
        <span class="comment">// ------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strTransaction;
        <span class="comment">// ------------------------------</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSavingAbbreviated) <span class="comment">// only OTLedger::message uses this block.</span>
        {   <span class="comment">// Save the FULL version of the receipt inside the box, so no separate files are necessary.</span>
            <span class="comment">//</span>
            pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strTransaction);
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>   ascTransaction;
            ascTransaction.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strTransaction, <span class="keyword">true</span>); <span class="comment">// linebreaks = true</span>
            strLedgerContents.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;transaction&gt;\n%s&lt;/transaction&gt;\n\n&quot;</span>, ascTransaction.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="comment">// ------------------------------</span>
        <span class="keywordflow">else</span> <span class="comment">// true == bSavingAbbreviated  // ALL OTHER ledger types are saved here in abbreviated form.</span>
        {
            <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
            {
                    <span class="comment">// -----------------------------</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#add17ff12beaf8f0ba84b73b6b564f5b0">SaveAbbreviatedNymboxRecord</a>(strTransaction);  <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ab15380c235814aeb89779fb5f42401d4">SaveAbbreviatedInboxRecord</a>(strTransaction);   <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a0ea6c7483a961acfdef55cd992e4065d">SaveAbbreviatedOutboxRecord</a>(strTransaction);  <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac30eb05906f92766b5ce895854e682a3">SaveAbbrevPaymentInboxRecord</a>(strTransaction); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a08424e75b8906896335609d7ca45c729">SaveAbbrevRecordBoxRecord</a>(strTransaction);    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#af73fe383da8254ef5cd2c8a27de79a29">SaveAbbrevExpiredBoxRecord</a>(strTransaction);   <span class="keywordflow">break</span>;
                    <span class="comment">// -----------------------------</span>
                <span class="keywordflow">default</span>: <span class="comment">// todo: possibly change this to an OT_ASSERT. security.</span>
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTLedger::UpdateContents: Error: unexpected box type (2nd block). (This should never happen. Skipping.)\n&quot;</span>);

                    <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTLedger::UpdateContents: Unexpected ledger type.&quot;</span>);

                    <span class="keywordflow">continue</span>;
            }

            nPartialACTUALCount++; <span class="comment">// Just in case the number actually written matches the count in the map.</span>

            strLedgerContents.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s&quot;</span>, strTransaction.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        } <span class="comment">// ------------------------------</span>
    }<span class="comment">// FOR_EACH(transactions)</span>
    <span class="comment">// ------------------------------------------------------</span>

    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(nPartialACTUALCount == nPartialRecordCount, <span class="stringliteral">&quot;ASSERT: OTLedger::UpdateContents: OT_ASSERT_MSG(nPartialACTUALCount == nPartialRecordCount)&quot;</span>);

    <span class="comment">// ------------------------------------------------------</span>
    <span class="comment">// HERE IS WHERE WE ACTUALLY BUILD THE STRING:</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;accountLedger version=\&quot;%s\&quot;\n &quot;</span>
                              <span class="stringliteral">&quot;type=\&quot;%s\&quot;\n &quot;</span>
                              <span class="stringliteral">&quot;numPartialRecords=\&quot;%d\&quot;\n &quot;</span>
                              <span class="stringliteral">&quot;accountID=\&quot;%s\&quot;\n &quot;</span>
                              <span class="stringliteral">&quot;userID=\&quot;%s\&quot;\n &quot;</span>
                              <span class="stringliteral">&quot;serverID=\&quot;%s\&quot; &gt;\n\n&quot;</span>, <a class="code" href="class_o_t_contract.html#aa0d889e0e1670b56fedca245041a5ed3">m_strVersion</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              strType.Get(),
                              nPartialRecordCount,
                              strLedgerAcctID.Get(),
                              strUserID.Get(),
                              strLedgerAcctServerID.Get());
    <span class="comment">// ------------------------------------------------------</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s&quot;</span>, strLedgerContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;/accountLedger&gt;\n&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3511c200c6eaa50c6cf249c8995fcb7e"></a><!-- doxytag: member="OTLedger::VerifyAccount" ref="a3511c200c6eaa50c6cf249c8995fcb7e" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">OTLedger::VerifyAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#a5df67ad1e0b4d60e205c0a8e1ae5e703">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_ledger_8cpp_source.html#l00177">177</a> of file <a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>: <span class="comment">// message ledgers do not load Box Receipts. (They store full version internally already.)</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:
        {
            std::set&lt;int64_t&gt; setUnloaded;
            <span class="comment">// if psetUnloaded passed in, then use it to return the #s that weren&#39;t there as box receipts.</span>
<span class="comment">//          bool bLoadedBoxReceipts =</span>
            this-&gt;<a class="code" href="class_o_t_ledger.html#a0eb4102ef28704ac8518c6cf98ebc34d">LoadBoxReceipts</a>(&amp;setUnloaded); <span class="comment">// Note: Also useful for suppressing errors here.</span>
        }
                <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
        {
            <span class="keyword">const</span> int32_t nLedgerType = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(this-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>());
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(theNym);
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strNymID(theNymID);
            <a class="code" href="class_o_t_string.html">OTString</a> strAccountID;
            this-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strAccountID);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTLedger::VerifyAccount: Failure: Bad ledger type: %d, UserID: %s, AcctID: %s\n&quot;</span>,
                          nLedgerType, strNymID.Get(), strAccountID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">OTTransactionType::VerifyAccount</a>(theNym);
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a50cdde745e8606b4c07fd2ca1a18251f"></a><!-- doxytag: member="OTLedger::OTTransactionType::TransactionFactory" ref="a50cdde745e8606b4c07fd2ca1a18251f" args="(OTString strInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction_type.html">OTTransactionType</a>* <a class="el" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a>&#160;</td>
          <td class="paramname"><em>strInput</em></td><td>)</td>
          <td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aa8bd6cbd5297225406a19b63f6f3c521"></a><!-- doxytag: member="OTLedger::m_bLoadedLegacyData" ref="aa8bd6cbd5297225406a19b63f6f3c521" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_ledger.html#aa8bd6cbd5297225406a19b63f6f3c521">OTLedger::m_bLoadedLegacyData</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00191">191</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3a53c8676f172c811a168db4ec776b41"></a><!-- doxytag: member="OTLedger::m_Type" ref="a3a53c8676f172c811a168db4ec776b41" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591a">ledgerType</a> <a class="el" href="class_o_t_ledger.html#a3a53c8676f172c811a168db4ec776b41">OTLedger::m_Type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_ledger_8hpp_source.html#l00189">189</a> of file <a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_ledger_8hpp_source.html">OTLedger.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_ledger_8cpp_source.html">OTLedger.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_ledger.html">OTLedger</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:13 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
