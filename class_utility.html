<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: Utility Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_utility.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Utility Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="Utility" -->
<p><code>#include &lt;<a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a>&gt;</code></p>

<p><a href="class_utility-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ac7af3e1642ac8d53ef180180a08fbd00">Utility</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#aecfe4b31e39b00555158a2d8288b874a">~Utility</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#aca01f3986c5d18f3490c6950a3ebc894">delay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a1d8f582b0679932743f3a40d2dee45d0">getAndProcessNymbox_3</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a4b80172eebe42e9d5d4b88ebfe9fbacf">getAndProcessNymbox_8</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, const bool bForceDownload, const int32_t nRequestNumber, bool &amp;bFoundNymboxItem, const bool bHarvestingForRetry, const <a class="el" href="class_o_tfourbool.html">OTfourbool</a> &amp;bMsgFoursome)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ac525e30eb94faab66f240d7a17a0e845">getBoxReceiptLowLevel</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int64_t strTransactionNum, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a9987f4da96634939d1a2dce81b147d95">getBoxReceiptWithErrorCorrection</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int64_t strTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">getInboxAccount</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ad4599a3d5ab440ca221980b5c903a454">getInboxAccount</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a146d2bf737526cc31e0f8473aed7e36e">getInboxAccount_old</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ac257e532b323bbb3cd841749b0565da7">getInboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a59b0628ccc6241729a32b1c362bb7155">getInboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent, const bool bForce)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ace00803d49059bc75277ecb7712b1bd5">getInboxOutboxAccount</a> (const string &amp;accountID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a28dcdd17394214ea61ea708899c5d746">getInboxOutboxAccount</a> (const string &amp;accountID, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">getIntermediaryFiles</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#aa20c934ec6b8e7c8fb4c1ed6f7bf617e">getIntermediaryFiles</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ae7f64d3fed00450d31b4659607918e0d">getIntermediaryFiles_old</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">getLastReplyReceived</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a7443cfaae100f819537e97fbad964b93">getNbrTransactionCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">getNymbox</a> (const string &amp;serverID, const string &amp;nymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a75bf919d2c853c9002605a15f9a032c0">getNymbox</a> (const string &amp;serverID, const string &amp;nymID, const bool bForceDownload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">getNymboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#af74d4659949c99e1fd86bbc69f8a1697">getNymboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">getOutboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a4ad01379dfd7aa0762fd976b8c297ea3">getOutboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent, const bool bForce)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a> (const string &amp;serverID, const string &amp;nymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a252176a94ca8f6db2b76a79266f21d3c">getRequestNumber</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#af469bfc39379af23989e185469bb9dbd">getTransactionNumbers</a> (const string &amp;serverID, const string &amp;nymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a022490aee892af222c03cbe2f74c6739">getTransactionNumbers</a> (const string &amp;serverID, const string &amp;nymID, const bool bForceFirstCall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a542c5b9409119aef3e1dce41d7904c03">getTransactionNumLowLevel</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a3dfa4e51052f58f3a0df4e455692803e">insureHaveAllBoxReceipts</a> (const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int32_t nRequestSeeking, bool &amp;bFoundIt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a680b0d0873c6d28cfd5b91de4e30c6b1">longDelay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ac88672f5fd7f460fa467476a71f30371">processNymbox</a> (const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, int32_t &amp;nMsgSentRequestNumOut, int32_t &amp;nReplySuccessOut, int32_t &amp;nBalanceSuccessOut, int32_t &amp;nTransSuccessOut)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a8bd3cff789307602e0ef5a29b911b8ce">ReceiveReplyLowLevel</a> (const string &amp;serverID17, const string &amp;nymID, const int32_t nRequestNumber8, const string &amp;IN_FUNCTION)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a> (const string &amp;serverID18, const string &amp;nymID, const int32_t nRequestNumber7, const string &amp;IN_FUNCTION)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ad6c441c50adc8c4327de016dbdfa9a28">sendProcessNymboxLowLevel</a> (const string &amp;serverID, const string &amp;nymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#ab5bdca5dc8f916c2daa50c791ffcdfb1">setLastReplyReceived</a> (const string &amp;strReply)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a86d6326e062a59eca23cf597a8a11900">setNbrTransactionCount</a> (int32_t new_trans_dl)</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#a55f9ff8ceb056a8fe95ec1ed5e4e3399">delay_ms</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_utility.html#abf88910f56716fb9ddf3c991af073216">max_trans_dl</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="ot__utility__ot_8hpp_source.html#l00059">59</a> of file <a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac7af3e1642ac8d53ef180180a08fbd00"></a><!-- doxytag: member="Utility::Utility" ref="ac7af3e1642ac8d53ef180180a08fbd00" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_utility.html#ac7af3e1642ac8d53ef180180a08fbd00">Utility::Utility</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00542">542</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a> = <span class="stringliteral">&quot;&quot;</span>;
    <a class="code" href="class_utility.html#a55f9ff8ceb056a8fe95ec1ed5e4e3399">delay_ms</a> = 50;
    <a class="code" href="class_utility.html#abf88910f56716fb9ddf3c991af073216">max_trans_dl</a> = 10; <span class="comment">// Number of transactions I download when I&#39;m low. (Also, when I&#39;m low is when I&#39;m below this number.)</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="aecfe4b31e39b00555158a2d8288b874a"></a><!-- doxytag: member="Utility::~Utility" ref="aecfe4b31e39b00555158a2d8288b874a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_utility.html#aecfe4b31e39b00555158a2d8288b874a">Utility::~Utility</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00549">549</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aca01f3986c5d18f3490c6950a3ebc894"></a><!-- doxytag: member="Utility::delay" ref="aca01f3986c5d18f3490c6950a3ebc894" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void <a class="el" href="class_utility.html#aca01f3986c5d18f3490c6950a3ebc894">Utility::delay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00553">553</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_p_i___wrap.html#ae71d4d649f0cd1929a48f9092d505e10">OTAPI_Wrap::Sleep</a>(<a class="code" href="class_utility.html#a55f9ff8ceb056a8fe95ec1ed5e4e3399">delay_ms</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1d8f582b0679932743f3a40d2dee45d0"></a><!-- doxytag: member="Utility::getAndProcessNymbox_3" ref="a1d8f582b0679932743f3a40d2dee45d0" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a1d8f582b0679932743f3a40d2dee45d0">Utility::getAndProcessNymbox_3</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasMsgSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01393">1393</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasMsgSent, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6d2691529e14cbcdc6023797428aa26"></a><!-- doxytag: member="Utility::getAndProcessNymbox_4" ref="ad6d2691529e14cbcdc6023797428aa26" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">Utility::getAndProcessNymbox_4</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasMsgSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01359">1359</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getAndProcessNymbox_4&quot;</span>;

    <span class="keywordflow">if</span> (<span class="comment">/* !VerifyOTBoolRef(bWasMsgSent) || */</span> !<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(bForceDownload))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: SHOULD NEVER HAPPEN!!! ASSERT!! ERROR!! FAILURE!!! PROBLEM!!!!!\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(serverID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(nymID))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: SHOULD NEVER HAPPEN!!! ASSERT!! ERROR!! FAILURE!!! PROBLEM!!!!!\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="comment">//   bool bMsgReplySuccess5 = false;</span>
    <span class="comment">//   bool bMsgReplyFailure5 = false;</span>
    <span class="comment">//   bool bMsgTransSuccess5 = false;</span>
    <span class="comment">//   bool bMsgTransFailure5 = false;</span>

    int32_t nRequestNumber = 0;
    <span class="keywordtype">bool</span> bHarvestingForRetry = <span class="keyword">false</span>;
    <a class="code" href="class_o_tfourbool.html">OTfourbool</a> the_foursome(<span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
    <span class="keywordtype">bool</span> bFoundNymboxItem = <span class="keyword">false</span>; <span class="comment">// bFoundNymboxItem is output bool, telling caller whether it was found.;</span>

    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#a4b80172eebe42e9d5d4b88ebfe9fbacf">getAndProcessNymbox_8</a>(serverID, nymID, bWasMsgSent, bForceDownload, nRequestNumber, bFoundNymboxItem, bHarvestingForRetry, the_foursome);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4b80172eebe42e9d5d4b88ebfe9fbacf"></a><!-- doxytag: member="Utility::getAndProcessNymbox_8" ref="a4b80172eebe42e9d5d4b88ebfe9fbacf" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, const bool bForceDownload, const int32_t nRequestNumber, bool &amp;bFoundNymboxItem, const bool bHarvestingForRetry, const OTfourbool &amp;bMsgFoursome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a4b80172eebe42e9d5d4b88ebfe9fbacf">Utility::getAndProcessNymbox_8</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasMsgSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nRequestNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bFoundNymboxItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bHarvestingForRetry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_tfourbool.html">OTfourbool</a> &amp;&#160;</td>
          <td class="paramname"><em>bMsgFoursome</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00865">865</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getAndProcessNymbox&quot;</span>;

    <span class="keywordtype">bool</span> bMsgReplySuccess = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bMsgReplyFailure = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bMsgTransSuccess = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bMsgTransFailure = <span class="keyword">false</span>;

    bMsgReplySuccess = bMsgFoursome.<a class="code" href="class_o_tfourbool.html#ac271a3591b0180883a25daf6e249c7b1">one</a>;
    bMsgReplyFailure = bMsgFoursome.<a class="code" href="class_o_tfourbool.html#a911c709dda8ec4e030fbb1d3523a25d3">two</a>;
    bMsgTransSuccess = bMsgFoursome.<a class="code" href="class_o_tfourbool.html#a71cfae65c31c57649bd860d6c0d082b7">three</a>;
    bMsgTransFailure = bMsgFoursome.<a class="code" href="class_o_tfourbool.html#ac656fed0abc02be552d02d422e03cbba">four</a>;

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nRequestNumber))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n\n\n Failed verifying nRequestNumber as an integer. \n\n\n\n\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (1 == nRequestNumber)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: WARNING: Request Num of &#39;1&#39; was just passed in here.\n&quot;</span>);
    }

    <span class="comment">//if (!VerifyOTBoolRef(bWasMsgSent) || !VerifyOTBoolRef(bFoundNymboxItem))</span>
    <span class="comment">//{</span>
    <span class="comment">//    OTAPI_Wrap::Output(0, strLocation + &quot;: SHOULD NEVER HAPPEN!!! ASSERT!! ERROR!! FAILURE!!! PROBLEM!!!!!\n&quot;);</span>
    <span class="comment">//    return -1;</span>
    <span class="comment">//}</span>

    bWasMsgSent = <span class="keyword">false</span>;

    <span class="comment">// what is nRequestNumber?</span>
    <span class="comment">//</span>
    <span class="comment">// Let&#39;s say a message, say for a cash withdrawal with request number 5, has FAILED.</span>
    <span class="comment">// Since the message failed, perhaps the request number was out of sync, or Nymbox hash</span>
    <span class="comment">// was old? So, let&#39;s say that it then sent a getRequest message, in order to resync,</span>
    <span class="comment">// and discovered that the Nymbox hash has changed. Therefore the Nymbox is now being</span>
    <span class="comment">// re-downloaded and processed, so that the cash withdrawal can be attempted again.</span>
    <span class="comment">//</span>
    <span class="comment">// HOWEVER, before we PROCESS the Nymbox, we need to see if the withdrawal reply is already</span>
    <span class="comment">// sitting in it. Why, you ask, if the withdrawal failed, would I expect a reply to be in</span>
    <span class="comment">// the Nymbox? In case 1, the message was dropped, so I don&#39;t know if the reply is there</span>
    <span class="comment">// until I check the Nymbox. In case 2, the message may have failed OR SUCCEEDED, with the</span>
    <span class="comment">// successful message containing a FAILED TRANSACTION.</span>
    <span class="comment">// Thus, we just want to check the Nymbox for nRequestNumber, and make sure whether it&#39;s</span>
    <span class="comment">// there or not, before we PROCESS the nymbox, because once we do THAT, it will be empty.</span>
    <span class="comment">//</span>
    <span class="comment">// We will return a;</span>
    <span class="comment">// was already in the Nymbox. We can also harvest the transaction numbers from the reply</span>
    <span class="comment">// message, if it&#39;s a transaction, so that everything is set for the re-try. (Possibly pass</span>
    <span class="comment">// a bool parameter dictating whether the harvesting is being done for a re-try or not.)</span>
    <span class="comment">//</span>


    <span class="comment">// -- SECTION 1: &quot;GET NYMBOX&quot;</span>
    <span class="comment">//</span>
    <span class="comment">// This call is sufficiently high-level enough that it already has re-tries</span>
    <span class="comment">// built into it. That&#39;s why you don&#39;t see me re-trying the getNymbox if it</span>
    <span class="comment">// fails.</span>
    <span class="comment">//</span>

    int32_t nGetNymbox = <a class="code" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">getNymbox</a>(serverID, nymID, bForceDownload);
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nGetNymbox) || (nGetNymbox &lt; 1))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: this.getNymbox returned: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">// By this point, we DEFINITELY know that the Nymbox was retrieved successfully.</span>
    <span class="comment">// (With request number nGetNymbox.) This is because the getNymboxLowLevel() call</span>
    <span class="comment">// also tries to receive the reply, so we already know by now whether the reply</span>
    <span class="comment">// was successfully received.</span>
    <span class="comment">//</span>
    <span class="comment">/*</span>
<span class="comment">    *  FYI: nRequestNumber is the request number, if &gt;0, for whatever command</span>
<span class="comment">    * is causing this getAndProcessNymbox to occur (like a cash withdrawal, or</span>
<span class="comment">    * a cheque deposit, etc.) We pass it in here so we can verify whether it&#39;s on</span>
<span class="comment">    * the Nymbox, before we process it out (so the caller knows whether to clawback.)</span>
<span class="comment">    *</span>
<span class="comment">    * FYI: nGetNymbox is the request number from getNymboxLowLevel() (above.) We</span>
<span class="comment">    * know for a FACT, by this point, this number is &gt;0.</span>
<span class="comment">    *</span>
<span class="comment">    * FYI: nProcess (just below) is the request number for the PROCESS NYMBOX message.</span>
<span class="comment">    * Below the switch block just down there, we know for a fact this number is &gt;0.</span>
<span class="comment">    */</span>
    <span class="comment">// ******************************************************************************</span>

    <span class="comment">// -- SECTION 2: &quot;SEND PROCESS NYMBOX&quot;</span>
    <span class="comment">//</span>

    <span class="comment">// Next, we have to make sure we have all the BOX RECEIPTS downloaded</span>
    <span class="comment">// for this Nymbox.</span>


    <span class="comment">// If the caller wanted to know whether a certain reply (by request number) was in the Nymbox, then bFoundNymboxItem</span>
    <span class="comment">// will be set true in this call, if it was there. That way he can Harvest his own msg if he needs to. (Just like I</span>
    <span class="comment">// harvest my own processNymbox call below, if necessary.)</span>
    <span class="comment">//</span>
    <span class="comment">// nBoxType = 0 aka nymbox;</span>
    <span class="comment">//</span>

    int32_t nBoxType = 0;

    <span class="keywordtype">bool</span> bInsured = <a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, nymID, nBoxType, nRequestNumber, bFoundNymboxItem);   <span class="comment">// ***************************;</span>
    <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(bInsured) &amp;&amp; bInsured)
    {
        <span class="comment">// If the caller was on about a specific request number...</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (nRequestNumber &gt; 0)
        {
            <span class="comment">// ...And if we DID NOT find that request number in the Nymbox</span>
            <span class="comment">// (along with the server&#39;s reply), then harvest it!!</span>
            <span class="comment">// (If we HAD found it, then we&#39;d know it didn&#39;t NEED harvesting,</span>
            <span class="comment">// since the server clearly REPLIED to it already.)</span>

            <span class="comment">// FOUND it in the nymbox! Therefore we can remove without harvesting.</span>
            <span class="comment">// (Server definitely processed it, so nothing to harvest.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bFoundNymboxItem)
            {
                <span class="comment">// Notice, if the above call to insureHaveAllBoxReceipts had any network hiccups, then</span>
                <span class="comment">// it may have had to get and processNymbox, meaning the below Remove would fail, since</span>
                <span class="comment">// the sent message was already removed. Therefore, might want to update this to call getSent</span>
                <span class="comment">// FIRST, before trying to remove.</span>
                <span class="comment">// (Might want different messages in either case.)</span>
                <span class="comment">//</span>
                <span class="keywordtype">bool</span> nRemovedMsg = <a class="code" href="class_o_t_a_p_i___wrap.html#ac15afd544c60bd63e7fe6fbc73d22a4b">OTAPI_Wrap::RemoveSentMessage</a>(int64_t(nRequestNumber), serverID, nymID);
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(2, strLocation + <span class="stringliteral">&quot;: OT_API_RemoveSentMessage: (Found server reply in Nymbox. Removing local sent msg.) Request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRemovedMsg) + <span class="stringliteral">&quot;\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// We DIDN&#39;T find it in the nymbox, so we can harvest it:</span>
            {
                <span class="comment">// NOTE: This may always fail,</span>

                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(3, strLocation + <span class="stringliteral">&quot;: FYI: Calling OT_API_GetSentMessage...\n&quot;</span>);

                <span class="keywordtype">string</span> strSentMsg = <a class="code" href="class_o_t_a_p_i___wrap.html#a29688af14e9b6cd58d50ef736a917f60">OTAPI_Wrap::GetSentMessage</a>(int64_t(nRequestNumber), serverID, nymID);

                <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSentMsg))
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(2, strLocation + <span class="stringliteral">&quot;: (1) OT_API_GetSentMessage returned NULL for clawback. (Must have already been cleared. OT uses deliberate redundancy, though optimizes this wherever possible.) Request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNumber) + <span class="stringliteral">&quot;\n&quot;</span>);
                }
                <span class="keywordflow">else</span> <span class="comment">// OTAPI_Wrap::GetSentMessage success.</span>
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: Harvesting transaction numbers from failed Msg attempt...\n&quot;</span>);

                    <span class="keywordtype">bool</span> nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSentMsg, nymID,
                        bHarvestingForRetry, <span class="comment">// bHarvestingForRetry.</span>
                        bMsgReplySuccess,    <span class="comment">// bReplyWasSuccess,       // RECEIVED server reply: explicit success.</span>
                        bMsgReplyFailure,    <span class="comment">// bReplyWasFailure,       // RECEIVED server reply: explicit failure.</span>
                        bMsgTransSuccess,    <span class="comment">// bTransactionWasSuccess, // MESSAGE success, Transaction success. (Explicit.)</span>
                        bMsgTransFailure);    <span class="comment">// bTransactionWasFailure  // MESSAGE success, Transaction failure. (Explicit.)</span>
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);


                    <span class="keywordtype">bool</span> nRemovedMsg = <a class="code" href="class_o_t_a_p_i___wrap.html#ac15afd544c60bd63e7fe6fbc73d22a4b">OTAPI_Wrap::RemoveSentMessage</a>(int64_t(nRequestNumber), serverID, nymID);
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(2, strLocation + <span class="stringliteral">&quot;: OT_API_RemoveSentMessage: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRemovedMsg) + <span class="stringliteral">&quot;\n&quot;</span>);
                } <span class="comment">// strSentMsg NOT null!</span>
            }
        }


        <span class="comment">// (flush): LOOP THROUGH ALL &quot;SENT&quot; messages, and see if ANY of them has a reply</span>
        <span class="comment">// sitting in my Nymbox. If so, REMOVE IT from &quot;Sent&quot; queue, (since clearly the server</span>
        <span class="comment">// DID respond already.) And if it&#39;s NOT in my nymbox, that means I DEFINITELY need to</span>
        <span class="comment">// harvest it back since the server definitely rejected it or never received it.</span>
        <span class="comment">//</span>
        <span class="comment">// The Nym actually SAVES the sent messages PER SERVER, so that this</span>
        <span class="comment">// will continue to work in every possible case!!</span>
        <span class="comment">// NOTE: Also now storing, on the client nym, a copy of the server&#39;s latest nymbox hash</span>
        <span class="comment">// for that nym, in addition to the nym&#39;s copy (which only updates when he gets his Nymbox.)</span>
        <span class="comment">// That way the Nym, even before syncing the nymboxes, and even before sending a new message</span>
        <span class="comment">// to find out if they are out of sync, ALREADY KNOWS if they&#39;re in sync or not. (That&#39;s why</span>
        <span class="comment">// all those other server messages send a copy of that hash back, not just the getNymbox msg.)</span>
        <span class="comment">//</span>
        <span class="comment">//</span>
        <span class="comment">//            void OTAPI_Wrap::FlushSentMessages(const int32_t bHarvestingForRetry, // bHarvestingForRetry is actually OT_BOOL</span>
        <span class="comment">//                              const char * SERVER_ID,</span>
        <span class="comment">//                              const char * USER_ID,</span>
        <span class="comment">//                              const char * THE_NYMBOX);</span>
        <span class="comment">// NoVerify means don&#39;t load up all the box receipts.</span>
        <span class="comment">// Especially in this case--we only care about whether a box receipt is THERE, not</span>
        <span class="comment">// what it contains. FlushSentMessages will work just fine WITHOUT loading those</span>
        <span class="comment">// box receipts (because the Nymbox contains enough of an abbreviated record already</span>
        <span class="comment">// for each one, that we will have the info we need already.)</span>
        <span class="comment">//</span>
        <span class="keywordtype">string</span> strNymbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID); <span class="comment">// FLUSH SENT MESSAGES!!!!  (AND HARVEST.);</span>

        <span class="comment">// *******************************************************</span>
        <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymbox))
        {

            <a class="code" href="class_o_t_a_p_i___wrap.html#ae404dd731fc2272e138880e97d4ce0a9">OTAPI_Wrap::FlushSentMessages</a>(<span class="keyword">false</span>, <span class="comment">//harvesting for retry = = OT_FALSE. None of the things are being re-tried by the time they are being flushed.  They were already old news.;</span>
                serverID,
                nymID,
                strNymbox);
        }
        <span class="comment">// Flushing removes all the messages from the &quot;sent messages&quot; queue,</span>
        <span class="comment">// and harvests any transaction numbers to be had. How do I know for sure</span>
        <span class="comment">// that I can get away with this? How do I know whether the server has</span>
        <span class="comment">// processed those messages or not? How can I harvest them as though they</span>
        <span class="comment">// were dropped on the network somewhere? The answer is because I JUST</span>
        <span class="comment">// called GetNymbox and downloaded the latest one. I can SEE which replies</span>
        <span class="comment">// are in there -- and which ones aren&#39;t. I pass that Nymbox into the flush</span>
        <span class="comment">// call, so that flush can be careful to remove all sent messages that have</span>
        <span class="comment">// nymbox replies, and only harvest the others.</span>
        <span class="comment">// *******************************************************</span>
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error while trying to flush sent messages: Failed loading Nymbox for nym: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
        }

        int32_t nMsgSentRequestNumOut = -1;
        int32_t nReplySuccessOut = -1;
        int32_t nBalanceSuccessOut = -1;
        int32_t nTransSuccessOut = -1;


        <span class="comment">// PROCESS NYMBOX</span>
        <span class="comment">//</span>
        <span class="comment">// Returns:</span>
        <span class="comment">// -1 Error.</span>
        <span class="comment">//  0 Nymbox was empty -- nothing done. (bWasMsgSent = false)</span>
        <span class="comment">//  0 Transactionstatus = = server reply received (bWasMsgSent = true),;</span>
        <span class="comment">//    but the server reply saysstatus = =failed.;</span>
        <span class="comment">// &gt;0 If the Transaction status (from the server reply) is SUCCESS, then this function</span>
        <span class="comment">//    returns the REQUEST NUMBER from when it was originally sent.</span>

        int32_t nProcess = <a class="code" href="class_utility.html#ac88672f5fd7f460fa467476a71f30371">processNymbox</a>(serverID, nymID,
            bWasMsgSent,

            nMsgSentRequestNumOut,
            nReplySuccessOut,
            nBalanceSuccessOut,
            nTransSuccessOut);

        <span class="keywordflow">if</span> (-1 == nProcess)
        {
            <span class="comment">// Todo: might want to remove the sent message here, IF bMsgWasSent is true.</span>
            <span class="comment">// (Just like case 0.)</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: processNymbox: error (-1). (It couldn&#39;t send. I give up.)\n&quot;</span>);

            <span class="keywordflow">return</span> -1; <span class="comment">// (It didn&#39;t even send.)</span>
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nProcess)
        {
            <span class="comment">// Nymbox was empty. (So we didn&#39;t send any process message because there was nothing to process.)</span>
            <span class="keywordflow">if</span> (!bWasMsgSent)
            {
                <span class="keywordflow">return</span> 0; <span class="comment">// success. done. (box was empty already.)</span>
            }
            <span class="comment">// else: the message WAS sent, (the Nymbox was NOT empty)</span>
            <span class="comment">//       and then the server replied &quot;success==FALSE&quot;</span>
            <span class="comment">//       in its REPLY to that message! Thus we continue and DROP THROUGH...</span>
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nProcess &lt; 0)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: processNymbox: unexpected: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nProcess) + <span class="stringliteral">&quot;. (I give up.)\n&quot;</span>);

            <span class="keywordflow">return</span> -1;
        }
        <span class="comment">// bWasMsgSent = true;  // unnecessary -- set already by processNymbox call above.</span>

        <span class="comment">// By this point, we definitely have a &gt;0 request number from the sendProcessNymbox()</span>
        <span class="comment">// call, stored in nProcess (meaning the message WAS sent.) (Except in case of 0, see next line which fixes this:)</span>
        <span class="comment">//</span>

        nProcess = nMsgSentRequestNumOut; <span class="comment">// Sometimes this could be 0 still, so we fix it here.;</span>
        int32_t nReplySuccess = nReplySuccessOut;
        int32_t nTransSuccess = nTransSuccessOut;
        int32_t nBalanceSuccess = nBalanceSuccessOut;


        <span class="comment">/*</span>
<span class="comment"></span>
<span class="comment">        return const;</span>
<span class="comment"></span>
<span class="comment">        char *    OTAPI_Wrap::GetSentMessage(const char * REQUEST_NUMBER)</span>
<span class="comment">        OT_BOOL   OTAPI_Wrap::RemoveSentMessage(const char * REQUEST_NUMBER)</span>
<span class="comment"></span>
<span class="comment">        */</span>
        <span class="comment">// All of these booleans (except &quot;error&quot;) represent RECEIVED ANSWERS from the server.</span>
        <span class="comment">// In other words, &quot;false&quot; does not mean &quot;failed to find message.&quot;</span>
        <span class="comment">// Rather, it means &quot;DEFINITELY got a reply, and that reply sayssuccess = =false.&quot;;</span>


        <span class="comment">// SHOULD NEVER HAPPEN (processNymbox call just above was successful,</span>
        <span class="comment">// therefore the sent message SHOULD be here in my cache.)</span>
        <span class="comment">//</span>
        <span class="keywordtype">string</span> strReplyProcess = <a class="code" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">getLastReplyReceived</a>();
        <span class="comment">// I had to do this bit because getRequestNumber doesn&#39;t return the;</span>
        <span class="comment">// reply itself. But in this case, I needed it.</span>
        <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strReplyProcess)) <span class="comment">// THIS SHOULD NEVER HAPPEN.</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR in getLastReplyReceived(): why was this string not set, when getRequestNumber was otherwise an apparent success?\n&quot;</span>);

            <span class="keywordflow">return</span> -1; <span class="comment">// (SHOULD NEVER HAPPEN. This string is set in the getRequestNumber function.)</span>
        }


        <span class="keywordtype">bool</span> bProcessNymboxReplyError = (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strReplyProcess) || (nReplySuccess   &lt; 0));
        <span class="keywordtype">bool</span> bProcessNymboxBalanceError = (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strReplyProcess) || (nBalanceSuccess &lt; 0));
        <span class="keywordtype">bool</span> bProcessNymboxTransError = (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strReplyProcess) || (nTransSuccess   &lt; 0));

        <span class="keywordtype">bool</span> bProcessNymboxReplySuccess = (!bProcessNymboxReplyError &amp;&amp; (nReplySuccess  &gt; 0));
        <span class="keywordtype">bool</span> bProcessNymboxReplyFailure = (!bProcessNymboxReplyError &amp;&amp; (nReplySuccess == 0));

        <span class="keywordtype">bool</span> bProcessNymboxBalanceSuccess = (!bProcessNymboxReplyError &amp;&amp; !bProcessNymboxBalanceError &amp;&amp; (nBalanceSuccess  &gt; 0));
        <span class="keywordtype">bool</span> bProcessNymboxBalanceFailure = (!bProcessNymboxReplyError &amp;&amp; !bProcessNymboxBalanceError &amp;&amp; (nBalanceSuccess == 0));

        <span class="keywordtype">bool</span> bProcessNymboxTransSuccess = (!bProcessNymboxReplyError &amp;&amp; !bProcessNymboxBalanceError &amp;&amp; !bProcessNymboxTransError &amp;&amp; (nTransSuccess  &gt; 0));
        <span class="keywordtype">bool</span> bProcessNymboxTransFailure = (!bProcessNymboxReplyError &amp;&amp; !bProcessNymboxBalanceError &amp;&amp; !bProcessNymboxTransError &amp;&amp; (nTransSuccess == 0));

        <span class="keywordtype">bool</span> bProcessAnyError = (bProcessNymboxReplyError || bProcessNymboxBalanceError || bProcessNymboxTransError);
        <span class="keywordtype">bool</span> bProcessAnyFailure = (bProcessNymboxReplyFailure || bProcessNymboxBalanceFailure || bProcessNymboxTransFailure);
        <span class="keywordtype">bool</span> bProcessAllSuccess = (bProcessNymboxReplySuccess &amp;&amp; bProcessNymboxBalanceSuccess &amp;&amp; bProcessNymboxTransSuccess);


        <span class="comment">// Note: we LEAVE the sent message in the &quot;sent queue&quot; until we are certain that it processed.</span>
        <span class="comment">// If we are NOT certain that it processed, then we try to download the Nymbox and see if there&#39;s</span>
        <span class="comment">// a reply there (for the sent message.) If we are able to confirm THAT, AFTER SUCCESSFULLY downloading</span>
        <span class="comment">// the Nymbox, then then we don&#39;t have to do anything because we know for sure it was processed.</span>
        <span class="comment">// Similarly, if we DEFINITELY download the Nymbox and do NOT find the reply, then we know the server</span>
        <span class="comment">// DEFINITELY did not receive (or at least process) that message, which is what allows us to HARVEST</span>
        <span class="comment">// the transaction numbers back from the sent message, and remove the sent message from the sent queue.</span>
        <span class="comment">//</span>
        <span class="comment">// However, if we are NOT able to Verify any of these things, NOR are we able to download the Nymbox to</span>
        <span class="comment">// see, then we DO leave the message in the sent queue. This is deliberate, since it gives us the opportunity</span>
        <span class="comment">// in the future to clear those sent messages NEXT time we successfully DO download the Nymbox, and in the</span>
        <span class="comment">// meantime, it allows us to store a record of EXACTLY which messages were MISSED.</span>
        <span class="comment">//</span>

        int32_t nHarvested = -1;

        <span class="keywordflow">if</span> (bProcessAllSuccess)
        {
            <span class="comment">// the processNymbox was a complete success, including the message</span>
            <span class="comment">// AND the transaction AND the transaction statement.</span>
            <span class="comment">// Therefore, there&#39;s DEFINITELY nothing to clawback.</span>
            <span class="comment">//</span>
            <span class="comment">// (Thus I RemoveSentMessage for the processNymbox message, since</span>
            <span class="comment">// I&#39;m totally done with it now.)</span>
            <span class="comment">//</span>
            <span class="comment">//         int32_t nRemoved = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nProcess), serverID, nymID);</span>

            <span class="comment">// NOTE: The above call is unnecessary, since a successful process means</span>
            <span class="comment">// we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
            <span class="comment">// already removed the sent message from the sent buffer (so no need to do that here.)</span>
            <span class="comment">//</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bProcessAnyError || bProcessAnyFailure) <span class="comment">// let&#39;s resync, and clawback whatever transaction numbers we might have used on the processNymbox request...</span>
        {
            nGetNymbox = <a class="code" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">getNymbox</a>(serverID, nymID, <span class="keyword">true</span>); <span class="comment">// bForceDownload=true - NOTE: could maybe change this to false and have it still work.;</span>

            <span class="keywordflow">if</span> (nGetNymbox &lt; 1)
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: this.getNymbox returned: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);

                <span class="keywordflow">return</span> -1;
            }

            <span class="keywordtype">bool</span> bWasFound = <span class="keyword">false</span>;
            nBoxType = 0; <span class="comment">// I think it was already zero, but since i&#39;m using it here;</span>
            <span class="comment">// PURELY to be a &#39;0&#39;, I feel safer setting it again. (Nymbox is 0.)</span>
            <span class="comment">//   bool bInsured = insureHaveAllBoxReceipts(serverID, nymID, nymID, nBoxType, nRequestNumber, bFoundNymboxItem);   // ***************************;</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, nymID, nBoxType, nProcess, bWasFound)) <span class="comment">// This will tell us whether the processNymbox reply was found in the Nymbox</span>
            {
                <span class="comment">// we FOUND the processNymbox reply in the Nymbox!</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (bWasFound)
                {
                    <span class="comment">// Thus, no need to clawback any transaction numbers,</span>
                    <span class="comment">// since the server clearly already processed this processNymbox</span>
                    <span class="comment">// transaction, since I have a reply to it already sitting in my Nymbox.</span>
                    <span class="comment">//</span>
                    <span class="comment">//                       int32_t nRemoved = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nProcess), serverID, nymID);</span>
                    <span class="comment">//</span>
                    <span class="comment">// NOTE: The above call is unnecessary, since a successful process means</span>
                    <span class="comment">// we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
                    <span class="comment">// already removed the sent message from the sent buffer (so no need to do that here.)</span>

                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: I *did* find the @processNymbox reply in my Nymbox, so NO NEED to clawback any transaction numbers.\n&quot;</span>);
                }
                <span class="keywordflow">else</span> <span class="comment">// was NOT found... we need to clawback.</span>
                {
                    <span class="comment">// This means the server&#39;s reply was definitely NOT found in the</span>
                    <span class="comment">// Nymbox, even after successfully DOWNLOADING that Nymbox. Which</span>
                    <span class="comment">// means the server never got it in the first place, or rejected it</span>
                    <span class="comment">// at the message level before the transaction portion had a chance</span>
                    <span class="comment">// to run. Either way, we need to claw back any relevant transaction</span>
                    <span class="comment">// numbers...</span>

                    <span class="comment">// HARVEST the processNymbox message from outgoing messages.</span>

                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(3, strLocation + <span class="stringliteral">&quot;: FYI: Calling OT_API_GetSentMessage...\n&quot;</span>);

                    <span class="keywordtype">string</span> strSentProcessNymboxMsg = <a class="code" href="class_o_t_a_p_i___wrap.html#a29688af14e9b6cd58d50ef736a917f60">OTAPI_Wrap::GetSentMessage</a>(int64_t(nProcess), serverID, nymID);

                    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSentProcessNymboxMsg))
                    {
                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(2, strLocation + <span class="stringliteral">&quot;: (2) OT_API_GetSentMessage returned NULL for clawback. (Must have already been cleared. OT uses deliberate redundancy, though optimizes this wherever possible.) Request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nProcess) + <span class="stringliteral">&quot;\n&quot;</span>);
                    }
                    <span class="keywordflow">else</span> <span class="comment">// strSentProcessNymboxMsg NOT null!</span>
                    {
                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: Harvesting transaction numbers from failed processNymbox attempt...\n&quot;</span>);

                        nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSentProcessNymboxMsg, nymID,
                            <span class="keyword">false</span>,   <span class="comment">//bHarvestingForRetry = = false;</span>
                            bProcessNymboxReplySuccess, <span class="comment">// bReplyWasSuccess,       // RECEIVED server reply: explicit success.</span>
                            bProcessNymboxReplyFailure, <span class="comment">// bReplyWasFailure,       // RECEIVED server reply: explicit failure.</span>
                            bProcessNymboxTransSuccess, <span class="comment">// bTransactionWasSuccess, // MESSAGE success, Transaction success. (Explicit.)</span>
                            bProcessNymboxTransFailure);  <span class="comment">// bTransactionWasFailure  // MESSAGE success, Transaction failure. (Explicit.)</span>

                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);

                        <span class="keywordtype">bool</span> nRemovedProcessNymboxMsg = <a class="code" href="class_o_t_a_p_i___wrap.html#ac15afd544c60bd63e7fe6fbc73d22a4b">OTAPI_Wrap::RemoveSentMessage</a>(int64_t(nProcess), serverID, nymID);

                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(2, strLocation + <span class="stringliteral">&quot;: OT_API_RemoveSentMessage: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRemovedProcessNymboxMsg) + <span class="stringliteral">&quot;\n&quot;</span>);
                    } <span class="comment">// strSentProcessNymboxMsg NOT null!</span>
                } <span class="comment">// a specific receipt was not found in the nymbox (need to clawback the transaction numbers on that receipt.)</span>

                strNymbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID); <span class="comment">// FLUSH SENT MESSAGES!!!!  (AND HARVEST.);</span>
                <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymbox))
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae404dd731fc2272e138880e97d4ce0a9">OTAPI_Wrap::FlushSentMessages</a>(<span class="keyword">false</span>, <span class="comment">//harvesting for retry = = OT_FALSE</span>
                        serverID,
                        nymID,
                        strNymbox);
                }
                <span class="comment">// Flushing removes all the messages from the &quot;sent messages&quot; queue,</span>
                <span class="comment">// and harvests any transaction numbers to be had. How do I know for sure</span>
                <span class="comment">// that I can get away with this? How do I know whether the server has</span>
                <span class="comment">// processed those messages or not? How can I harvest them as though they</span>
                <span class="comment">// were dropped on the network somewhere? The answer is because I JUST</span>
                <span class="comment">// called getNymbox and downloaded the latest one. I can SEE which replies</span>
                <span class="comment">// are in there -- and which ones aren&#39;t. I pass that Nymbox into the flush</span>
                <span class="comment">// call, so that flush can be careful to remove all sent messages that have</span>
                <span class="comment">// nymbox replies, and only harvest the others.</span>
                <span class="comment">// *******************************************************</span>
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error while trying to flush sent messages: Failed loading Nymbox for nym: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
                }
            } <span class="comment">// if insureHaveAllBoxReceipts()</span>
            <span class="keywordflow">else</span> <span class="comment">// we do NOT have all the box receipts.</span>
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: insureHaveAllBoxReceipts failed. (I give up.)\n&quot;</span>);
                <span class="keywordflow">return</span> -1;
            }
        } <span class="comment">// else if (bProcessAnyError || bProcessAnyFailure)</span>

        <span class="comment">// Return the request number, if potentially needed by caller.</span>
        <span class="comment">// If explicit success, the request number is returned as a positive</span>
        <span class="comment">// number (though already removed from sent queue.) Whereas if explicit</span>
        <span class="comment">// failure (replystatus = failed) then we harvest the numbers;</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bProcessAllSuccess)
            <span class="comment">//          return getNymbox(serverID, nymID, true); //bForceDownload = true. Since we DID process it successfully, then we grab it again.</span>
        {
            <span class="keywordflow">return</span> 1;
        }  <span class="comment">// We don&#39;t need the sent message after this, and we&#39;ve already removed it from sent queue.</span>

        <span class="keywordflow">if</span> (bProcessAnyFailure || bProcessAnyError)
        {
            <span class="keywordflow">if</span> (nHarvested &lt; 1)  <span class="comment">// If the message failed, and the harvesting failed, then we return the</span>
            {
                <span class="keywordflow">return</span> nProcess;
            }  <span class="comment">// number for the process nymbox, so the caller has a choice of what to do next.</span>

            <span class="keywordflow">if</span> (bProcessAnyFailure)
            {
                <span class="keywordflow">return</span> 0;
            }  <span class="comment">// by this point, we&#39;ve definitely harvested, AND removed sent message from sent queue. So we just return 0;</span>
        }

        <span class="keywordflow">return</span> -1; <span class="comment">// must&#39;ve been an error.</span>
    } <span class="comment">// if insureAllBoxReceipts()</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: insureHaveAllBoxReceipts failed. (I give up.)\n&quot;</span>);
    }

    <span class="keywordflow">return</span> -1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac525e30eb94faab66f240d7a17a0e845"></a><!-- doxytag: member="Utility::getBoxReceiptLowLevel" ref="ac525e30eb94faab66f240d7a17a0e845" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int64_t strTransactionNum, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ac525e30eb94faab66f240d7a17a0e845">Utility::getBoxReceiptLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>strTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01659">1659</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getBoxReceiptLowLevel&quot;</span>;

    bWasSent = <span class="keyword">false</span>;

    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#a293ffd5e91bc298d8ead5dc389b7344b">OTAPI_Wrap::getBoxReceipt</a>(serverID, nymID, accountID, nBoxType, strTransactionNum); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>
    <span class="keywordflow">if</span> (-2 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.);</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getNymbox message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send getNymbox message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Even though &#39;0&#39; MEANS &quot;didn&#39;t send, but no error&quot; by convention in many places, it is actually an impossible return value;</span>
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    bWasSent = <span class="keyword">true</span>;

    <span class="comment">// BY this point, we definitely have the request number, which means the</span>
    <span class="comment">// message was actually SENT. (At least.) This also means we can use nRequestNum</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">//</span>
    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, strLocation);
    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: nRequestNum: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot; /  nReturn: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn) + <span class="stringliteral">&quot;\n&quot;</span>);

    <span class="comment">//     int32_t nRemovedGetBoxReceipt = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      // NOTE: The above call is unnecessary, since a successful reply means</span>
    <span class="comment">//      // we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">//      // already removed the sent message from the sent buffer (so no need to do that here.)</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedGetBoxReceipt &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getBoxReceiptLowLevel: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedGetBoxReceipt);</span>
    <span class="comment">//      }</span>

    <span class="keywordflow">if</span> (nReturn &gt; 0)
    {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: Response from server:\n&quot;</span> + <a class="code" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">getLastReplyReceived</a>() + <span class="stringliteral">&quot;\n&quot;</span>);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9987f4da96634939d1a2dce81b147d95"></a><!-- doxytag: member="Utility::getBoxReceiptWithErrorCorrection" ref="a9987f4da96634939d1a2dce81b147d95" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int64_t strTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#a9987f4da96634939d1a2dce81b147d95">Utility::getBoxReceiptWithErrorCorrection</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>strTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01722">1722</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getBoxReceiptWithErrorCorrection&quot;</span>;

    <span class="keywordtype">bool</span> bWasSent = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bWasRequestSent = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (<a class="code" href="class_utility.html#ac525e30eb94faab66f240d7a17a0e845">getBoxReceiptLowLevel</a>(serverID, nymID, accountID, nBoxType, strTransactionNum, bWasSent))
    {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">if</span> (bWasSent &amp;&amp; (1 == <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID, bWasRequestSent))) <span class="comment">// this might be out of sync, if it failed... we&#39;ll re-sync, and re-try.</span>
    {
        <span class="keywordflow">if</span> (bWasRequestSent &amp;&amp; <a class="code" href="class_utility.html#ac525e30eb94faab66f240d7a17a0e845">getBoxReceiptLowLevel</a>(serverID, nymID, accountID, nBoxType, strTransactionNum, bWasSent))
        {
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getBoxReceiptLowLevel failed, then getRequestNumber succeeded, then getBoxReceiptLowLevel failed again. (I give up.)\n&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strLocation + <span class="stringliteral">&quot;: getBoxReceiptLowLevel failed, then getRequestNumber failed. (I give up.) Was getRequest message sent: &quot;</span>,
            <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(bWasRequestSent) + <span class="stringliteral">&quot;\n&quot;</span>));
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1f4589a6ee859d8b0b0ea25cdf3766d0"></a><!-- doxytag: member="Utility::getInboxAccount" ref="a1f4589a6ee859d8b0b0ea25cdf3766d0" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">Utility::getInboxAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentInbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentAccount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02776">2776</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">getInboxAccount</a>(serverID, nymID, accountID, bWasSentInbox, bWasSentAccount, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad4599a3d5ab440ca221980b5c903a454"></a><!-- doxytag: member="Utility::getInboxAccount" ref="ad4599a3d5ab440ca221980b5c903a454" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">Utility::getInboxAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentInbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentAccount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02631">2631</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getInboxAccount&quot;</span>;

    bWasSentAccount = <span class="keyword">false</span>;
    bWasSentInbox = <span class="keyword">false</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// (Success means both were downloaded, if necessary.)</span>
    <span class="comment">//</span>
    <span class="comment">// FIRST WE DO THE ACCOUNT...</span>
    <span class="comment">//</span>
    <span class="comment">// ***************************************************</span>
    <span class="comment">// GET ACCOUNT</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#ad928fc7e8648507f2e2f8b50e38ccc20">OTAPI_Wrap::getAccountFiles</a>(serverID, nymID, accountID); <span class="comment">// &lt;===== ATTEMPT TO SEND MESSAGE;</span>
    <span class="keywordflow">if</span> (-2 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.)</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getAccountFiles message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send getAccountFiles message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected failure sending getAccountFiles. Request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSentAccount = <span class="keyword">true</span>;
    bWasSentInbox = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">// -1 for error</span>
    <span class="comment">//  0 for reply: failure</span>
    <span class="comment">//  1 for reply: success</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, <span class="stringliteral">&quot;getInboxAccount&quot;</span>); <span class="comment">// &lt;============ RETURN VALUE;</span>
    <span class="keywordflow">if</span> (nReturn &lt; 0) <span class="comment">// error</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error in getAccountFiles: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn) + <span class="stringliteral">&quot;.  (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getInboxAccount &quot; + getLastReplyReceived());</span>

    <span class="comment">// BY this point, we definitely have the request number, which means the</span>
    <span class="comment">// message was actually SENT. (At least.) This also means we can use nRequestNum</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>

    <span class="comment">//     int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      // NOTE: The above call is unnecessary, since a successful process means</span>
    <span class="comment">//      // we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">//      // already removed the sent message from the sent buffer (so no need to do that here.)</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1) // (not success.)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getInboxAccount: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedSentMsg);</span>
    <span class="comment">//      }</span>

    <span class="comment">// ***************************************************</span>

    <span class="keywordflow">if</span> (1 != nReturn)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getAccountFiles failed, returning: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> nReturn;
    }

    <span class="comment">// DOWNLOAD THE BOX RECEIPTS.</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, accountID, 1)) <span class="comment">// &lt;===== nBoxType = 1 aka INBOX;</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getAccountFiles succeeded, but then insureHaveAllBoxReceipts failed on the inbox. (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (!<a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, accountID, 2)) <span class="comment">// &lt;===== nBoxType = 2 aka OUTBOX;</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getAccountFiles succeeded, but then insureHaveAllBoxReceipts failed on the outbox. (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a146d2bf737526cc31e0f8473aed7e36e"></a><!-- doxytag: member="Utility::getInboxAccount_old" ref="a146d2bf737526cc31e0f8473aed7e36e" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSentInbox, bool &amp;bWasSentAccount, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a146d2bf737526cc31e0f8473aed7e36e">Utility::getInboxAccount_old</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentInbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSentAccount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02783">2783</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getInboxAccount_old&quot;</span>;

    bWasSentAccount = <span class="keyword">false</span>;
    bWasSentInbox = <span class="keyword">false</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// (Success means both were downloaded, if necessary.)</span>
    <span class="comment">//</span>
    <span class="comment">// FIRST WE DO THE ACCOUNT...</span>
    <span class="comment">//</span>
    <span class="comment">// ***************************************************</span>
    <span class="comment">// GET ACCOUNT</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#a06cb5d61a5940aaecb72279ceb39238e">OTAPI_Wrap::getAccount</a>(serverID, nymID, accountID); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>

    <span class="keywordflow">if</span> ((-2) == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.)</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getAccount message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send getAccount message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected failure sending getAccount(). Request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSentAccount = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">// -1 for error</span>
    <span class="comment">//  0 for reply: failure</span>
    <span class="comment">//  1 for reply: success</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, <span class="stringliteral">&quot;getInboxAccount&quot;</span>); <span class="comment">// &lt;============ RETURN VALUE;</span>

    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getInboxAccount &quot; + getLastReplyReceived());</span>

    <span class="keywordtype">bool</span> bAccount = 1 == nReturn;

    <span class="comment">// BY this point, we definitely have the request number, which means the</span>
    <span class="comment">// message was actually SENT. (At least.) This also means we can use nRequestNum</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>

    <span class="comment">//     int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      // NOTE: The above call is unnecessary, since a successful process means</span>
    <span class="comment">//      // we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">//      // already removed the sent message from the sent buffer (so no need to do that here.)</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1) // (not success.)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getInboxAccount: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedSentMsg);</span>
    <span class="comment">//      }</span>

    <span class="keywordflow">if</span> (nReturn &lt; 0) <span class="comment">// error</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error in getAccount: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn) + <span class="stringliteral">&quot;.  (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="comment">// ***************************************************</span>

    <span class="keywordflow">if</span> (!bAccount)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getAccount failed, returning: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> nReturn;
    }

    int32_t nReturn2 = <a class="code" href="class_utility.html#ac257e532b323bbb3cd841749b0565da7">getInboxLowLevel</a>(serverID, nymID, accountID, bWasSentInbox, bForceDownload);

    <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
    <span class="comment">// no error: we already have the latest inbox. (Nothing done.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bWasSentInbox &amp;&amp; (0 == nReturn2))
    {
        <span class="keywordflow">return</span> 0;
    }

    <span class="keywordflow">if</span> (1 != nReturn2)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxLowLevel failed. Returning: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nReturn2) + <span class="stringliteral">&quot;\n&quot;</span>);
    }

    <span class="keywordflow">return</span> nReturn2;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac257e532b323bbb3cd841749b0565da7"></a><!-- doxytag: member="Utility::getInboxLowLevel" ref="ac257e532b323bbb3cd841749b0565da7" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ac257e532b323bbb3cd841749b0565da7">Utility::getInboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02893">2893</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ac257e532b323bbb3cd841749b0565da7">getInboxLowLevel</a>(serverID, nymID, accountID, bWasSent, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a59b0628ccc6241729a32b1c362bb7155"></a><!-- doxytag: member="Utility::getInboxLowLevel" ref="a59b0628ccc6241729a32b1c362bb7155" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent, const bool bForce)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ac257e532b323bbb3cd841749b0565da7">Utility::getInboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForce</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02900">2900</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getInboxLowLevel&quot;</span>;

    bWasSent = <span class="keyword">false</span>;

    <span class="comment">//</span>
    <span class="comment">// Use OTAPI_Wrap::GetAccountWallet_InboxHash(ACCT_ID) to see the server&#39;s most recent inbox hash (on the OTAccount for that box)</span>

    <span class="keywordtype">string</span> strRecentHash = <a class="code" href="class_o_t_a_p_i___wrap.html#ad9d93ec0532d16d58c73ea2a560b14e6">OTAPI_Wrap::GetAccountWallet_InboxHash</a>(accountID);
    <span class="keywordtype">bool</span> bRecentHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecentHash);
    <span class="keywordflow">if</span> (!bRecentHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve recent cached copy of server-side InboxHash from client-side nym (perhaps he&#39;s never downloaded it before?)\n\n&quot;</span>);
    }

    <span class="comment">//</span>
    <span class="comment">// Use OTAPI_Wrap::GetNym_InboxHash(ACCT_ID, NYM_ID) to see the client&#39;s copy of the inbox hash,</span>
    <span class="comment">// from whenever the client last actually downloaded the inbox.</span>

    <span class="keywordtype">string</span> strLocalHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a10ff5fb2facdf12280a5334eb5f538a4">OTAPI_Wrap::GetNym_InboxHash</a>(accountID, nymID);
    <span class="keywordtype">bool</span> bLocalHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalHash);
    <span class="keywordflow">if</span> (!bLocalHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve client-side InboxHash for:\n accountID: &quot;</span> + accountID + <span class="stringliteral">&quot;\n nymID: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
    }

    <span class="keywordflow">if</span> (!bForce)
    {
        <span class="comment">// the hashes match -- no need to download anything.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (bLocalHash &amp;&amp; bRecentHash &amp;&amp; (strRecentHash == strLocalHash))
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: The hashes already match (skipping Inbox download.)\n&quot;</span>);
            <span class="keywordflow">return</span> 0;
        }
    }
    <span class="comment">// ************************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Now that we dealt with the Inbox Hash, let&#39;s do the download!!</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#ae8c7f22dedb5d0219e7be55ab70535c0">OTAPI_Wrap::getInbox</a>(serverID, nymID, accountID); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>

    <span class="keywordflow">if</span> ((-2) == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.)</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum) <span class="comment">// if the requestNumber returned by the send-attempt is -1, that means it DIDN&#39;T SEND (error)</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getInbox message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send getInbox message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// Even though &#39;0&#39; MEANS &quot;didn&#39;t send, but no error&quot; by convention in many places, it is actually an impossible return value;</span>
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSent = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, strLocation);
    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getInboxLowLevel &quot; + getLastReplyReceived() + &quot;\n&quot;);</span>

    <span class="keywordtype">bool</span> bInbox = 1 == nReturn;

    <span class="comment">// BY this point, we definitely have the request number, which means the</span>
    <span class="comment">// message was actually SENT. (At least.) This also means we can use nRequestNum</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>

    <span class="comment">//     int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      // NOTE: The above call is unnecessary, since a successful process means</span>
    <span class="comment">//      // we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">//      // already removed the sent message from the sent buffer (so no need to do that here.)</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getInboxLowLevel: ERROR: OT_API_RemoveSentMessage returned: &quot; + to_string(nRemovedSentMsg) + &quot;\n&quot;);</span>
    <span class="comment">//      }</span>

    <span class="comment">// ***************************************************</span>
    <span class="comment">// Now let&#39;s make sure we have all the box receipts for this outbox.</span>
    <span class="comment">// (They will be needed when it is used for something.)</span>
    <span class="comment">//</span>
    int32_t nBoxType = 1;
    <span class="keywordflow">if</span> (bInbox &amp;&amp; !<a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, accountID, nBoxType)) <span class="comment">// &lt;===== nBoxType = 1 aka INBOX;</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInbox succeeded, but then insureHaveAllBoxReceipts failed. (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> nReturn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace00803d49059bc75277ecb7712b1bd5"></a><!-- doxytag: member="Utility::getInboxOutboxAccount" ref="ace00803d49059bc75277ecb7712b1bd5" args="(const string &amp;accountID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ace00803d49059bc75277ecb7712b1bd5">Utility::getInboxOutboxAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02733">2733</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ace00803d49059bc75277ecb7712b1bd5">getInboxOutboxAccount</a>(accountID, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a28dcdd17394214ea61ea708899c5d746"></a><!-- doxytag: member="Utility::getInboxOutboxAccount" ref="a28dcdd17394214ea61ea708899c5d746" args="(const string &amp;accountID, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ace00803d49059bc75277ecb7712b1bd5">Utility::getInboxOutboxAccount</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02739">2739</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getInboxOutboxAccount&quot;</span>;

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(accountID) || accountID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: invalid accountID: &quot;</span> + accountID + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordtype">string</span> serverID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(accountID);
    <span class="keywordtype">string</span> nymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(accountID);
    <span class="keywordflow">if</span> (!<a class="code" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">getIntermediaryFiles</a>(serverID, nymID, accountID, bForceDownload))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getIntermediaryFiles failed. (Returning.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afcf37cb45c40719b2d6d81f0202f96ab"></a><!-- doxytag: member="Utility::getIntermediaryFiles" ref="afcf37cb45c40719b2d6d81f0202f96ab" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">Utility::getIntermediaryFiles</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02377">2377</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">getIntermediaryFiles</a>(serverID, nymID, accountID, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa20c934ec6b8e7c8fb4c1ed6f7bf617e"></a><!-- doxytag: member="Utility::getIntermediaryFiles" ref="aa20c934ec6b8e7c8fb4c1ed6f7bf617e" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">Utility::getIntermediaryFiles</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02523">2523</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getIntermediaryFiles&quot;</span>;

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(serverID) || serverID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid serverID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(nymID) || nymID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid nymID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(accountID) || accountID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid accountID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordtype">bool</span> bWasSentInbox = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bWasSentAccount = <span class="keyword">false</span>;

    <span class="comment">// This is a new version of getInboxAccount that downloads ALL</span>
    <span class="comment">// THREE files (account/inbox/outbox) in a single server message.</span>
    <span class="comment">//</span>
    int32_t nGetInboxAcct = <a class="code" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">getInboxAccount</a>(serverID, nymID, accountID, bWasSentInbox, bWasSentAccount, bForceDownload);

    <span class="comment">// if we received an error state, and the &quot;getAccountFiles&quot; message wasn&#39;t even sent,</span>
    <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (-1 == nGetInboxAcct)
    {
        <span class="keywordflow">if</span> (!bWasSentAccount)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: this.getInboxAccount failed, without even sending getAccountFiles. (Returning false.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }


    <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
    <span class="comment">// no error: we already have the latest inbox. (Nothing done.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bWasSentInbox &amp;&amp; (0 == nGetInboxAcct))
    {
        <span class="comment">// we don&#39;t return true;</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != nGetInboxAcct)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount failed. (Trying one more time...)\n&quot;</span>);

        int32_t nGetRequest = <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID);
        <span class="keywordflow">if</span> (1 != nGetRequest)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getInboxAccount failed, then I tried to resync with getRequestNumber and then that failed too. (I give up.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span> <span class="comment">// TODO: REMOVE THIS BLOCK ONCE THE SERVERS ALL SUPPORT NEW &quot;getAccountFiles&quot; message.</span>
        {
            <span class="comment">// Maybe the server doesn&#39;t support the new getAccountFiles</span>
            <span class="comment">// message yet -- so let&#39;s just call the old version of the function we&#39;re currently in.</span>

            <span class="comment">// TODO: LONGER TERM, remove this call to _old entirely.</span>
            <span class="comment">// AND: remove this &#39;else&#39; -- just let it fall through to the getRequest / retry.</span>
            <span class="comment">//</span>
            <span class="comment">// UNTIL WE REMOVE THIS, any sync issue with the request number will cause this</span>
            <span class="comment">// function to download the account/inbox/outbox individually, due to this call</span>
            <span class="comment">// here to the old version.</span>

            <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ae7f64d3fed00450d31b4659607918e0d">getIntermediaryFiles_old</a>(serverID, nymID, accountID, bForceDownload);
        }


        <span class="comment">// We sync&#39;d the request number, so now we try the function again...</span>
        <span class="comment">//</span>
        int32_t nSecondtry = <a class="code" href="class_utility.html#a1f4589a6ee859d8b0b0ea25cdf3766d0">getInboxAccount</a>(serverID, nymID, accountID, bWasSentInbox, bWasSentAccount, bForceDownload);

        <span class="keywordflow">if</span> ((-1 == nSecondtry) &amp;&amp; !bWasSentAccount)
        {
            <span class="comment">// if we received an error state, and the &quot;getAccountFiles&quot; message wasn&#39;t even sent,</span>
            <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount failed a second time, without even sending getAccountFiles. (Returning false.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
        <span class="comment">// no error: we already have the latest inbox. (Nothing done.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (!bWasSentInbox &amp;&amp; (0 == nSecondtry))
        {
            <span class="comment">// we don&#39;t return true;</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != nSecondtry)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount re-try failed. (That&#39;s twice now--Returning false.) Value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nSecondtry) + <span class="stringliteral">&quot;\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount second call succeeded. (Continuing...)\n&quot;</span>);
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae7f64d3fed00450d31b4659607918e0d"></a><!-- doxytag: member="Utility::getIntermediaryFiles_old" ref="ae7f64d3fed00450d31b4659607918e0d" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ae7f64d3fed00450d31b4659607918e0d">Utility::getIntermediaryFiles_old</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02384">2384</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getIntermediaryFiles_old&quot;</span>;

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(serverID) || serverID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid serverID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(nymID) || nymID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid nymID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(accountID) || accountID.size() &lt; 10)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: NULL or invalid accountID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordtype">bool</span> bWasSentInbox = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bWasSentAccount = <span class="keyword">false</span>;

    int32_t nGetInboxAcct = <a class="code" href="class_utility.html#a146d2bf737526cc31e0f8473aed7e36e">getInboxAccount_old</a>(serverID, nymID, accountID, bWasSentInbox, bWasSentAccount, bForceDownload);

    <span class="comment">// if we received an error state, and the &quot;getAccount&quot; message wasn&#39;t even sent,</span>
    <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((-1 == nGetInboxAcct) &amp;&amp; !bWasSentAccount)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount_old failed, without even sending getAccount. (Returning false.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
    <span class="comment">// no error: we already have the latest inbox. (Nothing done.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bWasSentInbox &amp;&amp; (0 == nGetInboxAcct))
    {
        <span class="comment">// we don&#39;t return true;</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != nGetInboxAcct)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount_old failed. (Trying one more time...)\n&quot;</span>);

        int32_t nGetRequest = <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID);
        <span class="keywordflow">if</span> (1 != nGetRequest)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getInboxAccount_old failed, then I tried to resync with getRequestNumber and then that failed too. (I give up.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        int32_t nSecondtry = <a class="code" href="class_utility.html#a146d2bf737526cc31e0f8473aed7e36e">getInboxAccount_old</a>(serverID, nymID, accountID, bWasSentInbox, bWasSentAccount, bForceDownload);
        <span class="keywordflow">if</span> ((-1 == nSecondtry) &amp;&amp; !bWasSentAccount)
        {
            <span class="comment">// if we received an error state, and the &quot;getAccount&quot; message wasn&#39;t even sent,</span>
            <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount_old failed a second time, without even sending getAccount. (Returning false.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
        <span class="comment">// no error: we already have the latest inbox. (Nothing done.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (!bWasSentInbox &amp;&amp; (0 == nSecondtry))
        {
            <span class="comment">// we don&#39;t return true;</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != nSecondtry)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount_old re-try failed. (That&#39;s twice now--Returning false.) Value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nSecondtry) + <span class="stringliteral">&quot;\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getInboxAccount_old second call succeeded. (Continuing...)\n&quot;</span>);
    }
    <span class="comment">// *****************************************************************************</span>

    <span class="keywordtype">bool</span> bWasSentOutbox = <span class="keyword">false</span>;

    int32_t nGetOutbox = <a class="code" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">getOutboxLowLevel</a>(serverID, nymID, accountID, bWasSentOutbox, bForceDownload);

    <span class="keywordflow">if</span> (-1 == nGetOutbox &amp;&amp; !bWasSentOutbox)
    {
        <span class="comment">// if we received an error state, and the &quot;getOutbox&quot; message wasn&#39;t even sent,</span>
        <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutboxLowLevel failed, without even sending getOutbox. (Returning false.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means the</span>
    <span class="comment">// outbox we have is already the latest version.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bWasSentOutbox &amp;&amp; 0 == nGetOutbox)
    {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="keywordflow">if</span> (1 != nGetOutbox)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutboxLowLevel failed. (Trying one more time...)\n&quot;</span>);

        int32_t nGetRequest = <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID);
        <span class="keywordflow">if</span> (1 != nGetRequest)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getOutboxLowLevel failed, then I tried to resync with getRequestNumber and then that failed too. (I give up.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        int32_t nSecondtry = <a class="code" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">getOutboxLowLevel</a>(serverID, nymID, accountID, bWasSentOutbox, bForceDownload);
        <span class="keywordflow">if</span> ((-1 == nSecondtry) &amp;&amp; !bWasSentOutbox)
        {
            <span class="comment">// if we received an error state, and the &quot;getOutbox&quot; message wasn&#39;t even sent,</span>
            <span class="comment">// then no point doing a bunch of retries -- it failed.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutboxLowLevel failed a second time, without even sending getOutbox. (Returning false.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// If it wasn&#39;t sent, and 0 was returned, that means</span>
        <span class="comment">// no error: we already have the latest outbox. (Nothing done.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (!bWasSentOutbox &amp;&amp; (0 == nSecondtry))
        {
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }

        <span class="keywordflow">if</span> (1 != nSecondtry)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutboxLowLevel re-try failed. (That&#39;s twice now--Returning false.) Value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nSecondtry) + <span class="stringliteral">&quot;\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutboxLowLevel second call succeeded. (Continuing...)\n&quot;</span>);
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a41a51fc2cb1a609654b625769ef08519"></a><!-- doxytag: member="Utility::getLastReplyReceived" ref="a41a51fc2cb1a609654b625769ef08519" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> string <a class="el" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">Utility::getLastReplyReceived</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00573">573</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7443cfaae100f819537e97fbad964b93"></a><!-- doxytag: member="Utility::getNbrTransactionCount" ref="a7443cfaae100f819537e97fbad964b93" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a7443cfaae100f819537e97fbad964b93">Utility::getNbrTransactionCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00563">563</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#abf88910f56716fb9ddf3c991af073216">max_trans_dl</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aed9167fe744ab29d8e4ce30c2517fc92"></a><!-- doxytag: member="Utility::getNymbox" ref="aed9167fe744ab29d8e4ce30c2517fc92" args="(const string &amp;serverID, const string &amp;nymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">Utility::getNymbox</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00674">674</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">getNymbox</a>(serverID, nymID, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a75bf919d2c853c9002605a15f9a032c0"></a><!-- doxytag: member="Utility::getNymbox" ref="a75bf919d2c853c9002605a15f9a032c0" args="(const string &amp;serverID, const string &amp;nymID, const bool bForceDownload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">Utility::getNymbox</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceDownload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00681">681</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getNymbox&quot;</span>;

    <span class="keywordtype">string</span> strRecentHash = <a class="code" href="class_o_t_a_p_i___wrap.html#ae8d17b61c08e6fb661f1f44ddad49fc7">OTAPI_Wrap::GetNym_RecentHash</a>(serverID, nymID);
    <span class="keywordtype">bool</span> bRecentHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecentHash);
    <span class="keywordflow">if</span> (!bRecentHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve recent cached copy of server-side NymboxHash from client-side nym (perhaps he&#39;s never downloaded it before?)\n\n&quot;</span>);
    }

    <span class="keywordtype">string</span> strLocalHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a17de0af836994eb5d28f9e843ffde769">OTAPI_Wrap::GetNym_NymboxHash</a>(serverID, nymID);
    <span class="keywordtype">bool</span> bLocalHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalHash);
    <span class="keywordflow">if</span> (!bLocalHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve client-side NymboxHash for:\n serverID: &quot;</span> + serverID + <span class="stringliteral">&quot;\n nymID: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
    }

    <span class="keywordflow">if</span> (!bForceDownload)
    {
        <span class="keywordflow">if</span> (bLocalHash  &amp;&amp; bRecentHash &amp;&amp; (strRecentHash == strLocalHash)) <span class="comment">// the hashes match -- no need to download anything.</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: The hashes already match (skipping Nymbox download.)\n&quot;</span>);
            <span class="keywordflow">return</span> 1;
        }
    }

    <span class="comment">// -- SECTION 1: &quot;GET NYMBOX&quot;</span>
    <span class="comment">//</span>
    <span class="keywordtype">bool</span> bWasMsgSent = <span class="keyword">false</span>;
    int32_t nGetNymbox = <a class="code" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">getNymboxLowLevel</a>(serverID, nymID, bWasMsgSent); <span class="comment">// bWasMsgSent is output from this call.;</span>
    <span class="keywordflow">if</span> (bWasMsgSent)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: FYI: we just sent a getNymboxLowLevel msg. RequestNum: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
    }

    <span class="keywordflow">if</span> (!(bWasMsgSent) || ((nGetNymbox &lt;= 0) &amp;&amp; (-1 != nGetNymbox)))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: this.getNymboxLowLevel returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }   <span class="comment">// NOTE: for getNymbox, there is no &#39;0&#39; return value;</span>

    <span class="keywordflow">if</span> (-1 == nGetNymbox) <span class="comment">// we&#39;ll try re-syncing the request number, then try again.</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: this.getNymboxLowLevel returned -1. (Re-trying...)\n&quot;</span>);

        int32_t nGetRequest = <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID);
        <span class="keywordflow">if</span> (1 != nGetRequest)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: this.getNymboxLowLevel failed, then I tried to resync with this.getRequestNumber and then that failed too. (I give up.)\n&quot;</span>);
            <span class="keywordflow">return</span> -1;
        }

        <span class="keywordtype">string</span> <a class="code" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a> = <a class="code" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">getLastReplyReceived</a>();
        <span class="comment">// I had to do this bit because getRequestNumber doesn&#39;t return the</span>
        <span class="comment">// reply itself. But in this case, I needed it.</span>
        <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLastReplyReceived)) <span class="comment">// THIS SHOULD NEVER HAPPEN.</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR in getLastReplyReceived(): why was this string not set, when this.getRequestNumber was otherwise an apparent success?\n&quot;</span>);
            <span class="keywordflow">return</span> -1; <span class="comment">// (SHOULD NEVER HAPPEN. This string is set in the getRequestNumber function.)</span>
        }

        <span class="comment">// BY THIS POINT, we have received a server reply:  @getRequest</span>
        <span class="comment">// (Unless it is malformed.) It&#39;s definitely not null, nor empty.</span>

        <span class="comment">// Grab the NymboxHash on the @getRequest reply, and also the one I</span>
        <span class="comment">// already had on my client-side Nym... (So we can compare them.)</span>
        <span class="comment">//</span>
        <span class="comment">//      If the hashes do NOT match, then I DO need to download nymbox and box receipts.</span>
        <span class="comment">/*</span>
<span class="comment">        *      ===&gt; If the NymboxHash is changed from what I expected, then I need to re-download the</span>
<span class="comment">        *      nymbox (and any box receipts I don&#39;t already have.)</span>
<span class="comment">        *</span>
<span class="comment">        *      Then I need to process the Nymbox. But first, see if my missing server reply is in there.</span>
<span class="comment">        *      If it is, then I have the server reply! (As if we had succeeded in the first place!!)</span>
<span class="comment">        *      Next, process the Nymbox (which processes that reply) and then return strReply;</span>
<span class="comment">        *</span>
<span class="comment">        *      (Clearly this is just going to be a normal part of the getRequest syncronization.)</span>
<span class="comment">        *</span>
<span class="comment">        *      By the time that much is done, I will KNOW the request number, the nymbox, the box receipts,</span>
<span class="comment">        *      etc are ALL syncronized properly, and that I THEN processed the Nymbox successfully.</span>
<span class="comment">        *</span>
<span class="comment">        *</span>
<span class="comment">        *      NOTICE: In this example I do NOT want to pull out my sent message from the outbuffer (using</span>
<span class="comment">        *      the request number) and try to harvest all the transaction numbers. Why not? Because possibly the</span>
<span class="comment">        *      server DID reply! And if I processed that reply properly, it would sync my transaction numbers</span>
<span class="comment">        *      properly just from that! ===&gt;</span>
<span class="comment">        *</span>
<span class="comment">        *      ===&gt; Therefore, I need to see FIRST if the old message has a reply WAITING in the Nymbox. THEN</span>
<span class="comment">        *      I need to process the Nymbox. ONLY if the reply wasn&#39;t there, can I THEN pull out the message</span>
<span class="comment">        *      from my outbuffer and harvest it. (Which I am reticent to do, until I am SURE the server</span>
<span class="comment">        *      really never saw that message in the first place.)</span>
<span class="comment">        *</span>
<span class="comment">        *      However, as long as my NymboxHash hasn&#39;t changed, then I&#39;m safe! But if it HAS changed,</span>
<span class="comment">        *      then I HAVE to A. download it B. SEE if the reply is there for the request number, then</span>
<span class="comment">        *      C. process it. ... If the reply wasn&#39;t there, THEN Harvest the transaction #s (for transaction</span>
<span class="comment">        *      messages) and then re-try.</span>
<span class="comment">        */</span>

        <span class="comment">// Grabbing again in case it&#39;s changed.</span>
        <span class="keywordtype">string</span> strServerHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a42803f459dcf9ecc1c3ee4bccf917746">OTAPI_Wrap::Message_GetNymboxHash</a>(strLastReplyReceived);
        <span class="keywordtype">bool</span> bServerHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerHash);
        <span class="keywordflow">if</span> (!bServerHash)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve server-side NymboxHash from server @getRequest reply:\n\n&quot;</span> + strLastReplyReceived + <span class="stringliteral">&quot;\n&quot;</span>);
        }

        strLocalHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a17de0af836994eb5d28f9e843ffde769">OTAPI_Wrap::GetNym_NymboxHash</a>(serverID, nymID);
        bLocalHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalHash);
        <span class="keywordflow">if</span> (!bLocalHash)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning(2): Unable to retrieve client-side NymboxHash for:\n serverID: &quot;</span> + serverID + <span class="stringliteral">&quot;\n nymID: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
        }

        <span class="comment">// The hashes don&#39;t match -- so let&#39;s definitely re-try to download the latest nymbox.</span>
        <span class="keywordflow">if</span> (bForceDownload || !bLocalHash || !bServerHash || (bServerHash &amp;&amp; bLocalHash &amp;&amp; !(strServerHash == strLocalHash)))
        {
            <span class="comment">// the getRequest worked, and the server hashes don&#39;t match,</span>
            <span class="comment">// so let&#39;s try the call again...</span>

            nGetNymbox = <a class="code" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">getNymboxLowLevel</a>(serverID, nymID, bWasMsgSent);

            <span class="keywordflow">if</span> (!(bWasMsgSent) || ((nGetNymbox &lt;= 0) &amp;&amp; (-1 != nGetNymbox)))
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure(2): this.getNymboxLowLevel returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
                <span class="keywordflow">return</span> -1;
            }

            <span class="keywordflow">if</span> (-1 == nGetNymbox) <span class="comment">// we&#39;ll try re-syncing the request number, then try again.</span>
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: this.getNymboxLowLevel returned -1, even after syncing the request number successfully. (Giving up.)\n&quot;</span>);
                <span class="keywordflow">return</span> -1;
            }
        }
    }

    <span class="comment">// By this point, we DEFINITELY know that the Nymbox was retrieved successfully.</span>
    <span class="comment">// (With request number nGetNymbox.) This is because the getNymboxLowLevel() call</span>
    <span class="comment">// also tries to receive the reply, so we already know by now whether the reply</span>
    <span class="comment">// was successfully received.</span>
    <span class="comment">//</span>

    <span class="keywordflow">return</span> nGetNymbox;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acba161d25f6c8fd3cb0e459797eca6fb"></a><!-- doxytag: member="Utility::getNymboxLowLevel" ref="acba161d25f6c8fd3cb0e459797eca6fb" args="(const string &amp;serverID, const string &amp;nymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">Utility::getNymboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00584">584</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bWasSent = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">getNymboxLowLevel</a>(serverID, nymID, bWasSent);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af74d4659949c99e1fd86bbc69f8a1697"></a><!-- doxytag: member="Utility::getNymboxLowLevel" ref="af74d4659949c99e1fd86bbc69f8a1697" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#acba161d25f6c8fd3cb0e459797eca6fb">Utility::getNymboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00595">595</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getNymboxLowLevel&quot;</span>;

    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();
    bWasSent = <span class="keyword">false</span>;

    int32_t nRequestNum = <a class="code" href="class_utility.html#aed9167fe744ab29d8e4ce30c2517fc92">OTAPI_Wrap::getNymbox</a>(serverID, nymID); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>
    <span class="keywordflow">if</span> (-2 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.);</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getNymbox message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpectedly returned 0. Didn&#39;t send getNymbox message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// Even though &#39;0&#39; MEANS &quot;didn&#39;t send, but no error&quot; by convention in many places, it is actually an impossible return value;</span>
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSent = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    int32_t nResult = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, strLocation);

    <span class="comment">//      OTAPI_Wrap::Output(0, strLocation + &quot;: receiveReplySuccessLowLevel: &quot; + nResult + &quot;\n&quot;);</span>

    <span class="comment">// BY this point, we definitely have the request number in nResult, which means</span>
    <span class="comment">// the message was actually SENT. (At least.) This also means we can use nResult</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>
    <span class="comment">// THE REMOVE SENT MESSAGE BELOW FAILS, LIKE IT&#39;S ALREADY GONE.</span>
    <span class="comment">//</span>
    <span class="comment">// THIS MUST BE DUE TO THE PROCESS SERVER REPLY THAT OCCURS **IMMEDIATELY** after the message was originally sent!</span>
    <span class="comment">// (The reply came in and was sent to OT&#39;s &quot;ProcessServerReply&quot;, INSIDE the call to getNymbox.)</span>
    <span class="comment">// Our subsequent &quot;receive&quot; (above) is nothing of the sort, but actually pops the incoming message buffer where</span>
    <span class="comment">// the server&#39;s reply was ALREADY SITTING, since it was put there in OT&#39;s &quot;ProcessServerReply&quot;, WHICH REMOVED THE</span>
    <span class="comment">// SENT MESSAGE ALREADY (that&#39;s why the below call to RemoveSentMessage fails.)</span>
    <span class="comment">//</span>
    <span class="comment">// RETHINK any logic that doesn&#39;t take this into account,.</span>
    <span class="comment">// Either we REMOVE this call wherever this happens, OR... we call Get first and make sure whether it&#39;s</span>
    <span class="comment">// there, THEN remove it. But we can&#39;t be lumping &quot;Failure because it&#39;s gone&quot; versus &quot;Error state&quot; by mixing</span>
    <span class="comment">// 0 and -1 here. We need to differentiate.</span>
    <span class="comment">//</span>
    <span class="comment">// Bottom line: if the reply WAS received, then the original sent message has ALREADY been removed</span>
    <span class="comment">// from the sent buffer. Whereas if the reply was NOT received, then the sent message is still there,</span>
    <span class="comment">// but in that case, we do NOT want to remove it -- we want it to STAY in the sent buffer, so that</span>
    <span class="comment">// when we get the Nymbox later and we DO have the reply from that, THEN we can remove the sent msg from</span>
    <span class="comment">// the sent buffer. Until then, we don&#39;t want OT to think it&#39;s already been processed (which it will, if</span>
    <span class="comment">// it&#39;s already been removed from the sent buffer. So we leave it there for now.)</span>
    <span class="comment">//</span>

    <span class="comment">//      int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(to_string(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, strLocation + &quot;: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedSentMsg + &quot;\n&quot;);</span>
    <span class="comment">//      }</span>

    <span class="keywordflow">if</span> (1 == nResult)
    {
        <span class="keywordflow">return</span> nRequestNum;
    }

    <span class="keywordflow">return</span> nResult;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad1ab51b434b4a65e2eef0c3ec8516873"></a><!-- doxytag: member="Utility::getOutboxLowLevel" ref="ad1ab51b434b4a65e2eef0c3ec8516873" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">Utility::getOutboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l03017">3017</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">getOutboxLowLevel</a>(serverID, nymID, accountID, bWasSent, bForceDownload);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4ad01379dfd7aa0762fd976b8c297ea3"></a><!-- doxytag: member="Utility::getOutboxLowLevel" ref="a4ad01379dfd7aa0762fd976b8c297ea3" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, bool &amp;bWasSent, const bool bForce)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ad1ab51b434b4a65e2eef0c3ec8516873">Utility::getOutboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForce</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l03025">3025</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    bWasSent = <span class="keyword">false</span>;

    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getOutboxLowLevel&quot;</span>;

    <span class="comment">//</span>
    <span class="comment">// Use OTAPI_Wrap::GetAccountWallet_OutboxHash(ACCT_ID) to see the server&#39;s most recent outbox hash (on the OTAccount for that box)</span>

    <span class="keywordtype">string</span> strRecentHash = <a class="code" href="class_o_t_a_p_i___wrap.html#adb0da89b71880a06ce8a7522bef67aa8">OTAPI_Wrap::GetAccountWallet_OutboxHash</a>(accountID);
    <span class="keywordtype">bool</span> bRecentHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecentHash);
    <span class="keywordflow">if</span> (!bRecentHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve recent cached copy of server-side OutboxHash from client-side nym (perhaps he&#39;s never downloaded it before?)\n\n&quot;</span>);
    }

    <span class="comment">//</span>
    <span class="comment">// Use OTAPI_Wrap::GetNym_OutboxHash(ACCT_ID, NYM_ID) to see the client&#39;s copy of the outbox hash,</span>
    <span class="comment">// from whenever the client last actually downloaded the outbox.</span>

    <span class="keywordtype">string</span> strLocalHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a902332b6b95b05f597d418eb8a491776">OTAPI_Wrap::GetNym_OutboxHash</a>(accountID, nymID);
    <span class="keywordtype">bool</span> bLocalHash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalHash);
    <span class="keywordflow">if</span> (!bLocalHash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve client-side OutboxHash for:\n accountID: &quot;</span> + accountID + <span class="stringliteral">&quot;\n nymID: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
    }

    <span class="keywordflow">if</span> (!bForce)
    {
        <span class="keywordflow">if</span> (bLocalHash  &amp;&amp; bRecentHash &amp;&amp; (strRecentHash == strLocalHash)) <span class="comment">// the hashes match -- no need to download anything.</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: The hashes already match (skipping Outbox download.)\n&quot;</span>);
            <span class="keywordflow">return</span> 0;
        }
    }
    <span class="comment">// ************************************************************************************</span>

    <span class="comment">// Now that we dealt with the Outbox Hash, let&#39;s do the download!!</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#aa566a688bab96938f411018d2cec53f7">OTAPI_Wrap::getOutbox</a>(serverID, nymID, accountID); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>
    <span class="keywordflow">if</span> (-2 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.)</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum) <span class="comment">// if the requestNumber returned by the send-attempt is -1, that means it DIDN&#39;T SEND (error)</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getOutbox message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send getOutbox message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// Even though &#39;0&#39; MEANS &quot;didn&#39;t send, but no error&quot; by convention in many places, it is actually an impossible return value;</span>
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSent = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, strLocation);
    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getOutboxLowLevel &quot; + getLastReplyReceived());</span>

    <span class="keywordtype">bool</span> bOutbox = 1 == nReturn;

    <span class="comment">// BY this point, we definitely have the request number, which means the</span>
    <span class="comment">// message was actually SENT. (At least.) This also means we can use nRequestNum</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>

    <span class="comment">//     int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      // NOTE: The above call is unnecessary, since a successful process means</span>
    <span class="comment">//      // we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">//      // already removed the sent message from the sent buffer (so no need to do that here.)</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getOutboxLowLevel: ERROR: OT_API_RemoveSentMessage returned: &quot; + to_string(nRemovedSentMsg) + &quot;\n&quot;);</span>

    <span class="comment">//      }</span>


    <span class="comment">// ***************************************************</span>
    <span class="comment">// Now let&#39;s make sure we have all the box receipts for this outbox.</span>
    <span class="comment">// (They will be needed when it is used for something.)</span>
    <span class="comment">//</span>
    int32_t nBoxType = 2;
    <span class="keywordflow">if</span> (bOutbox &amp;&amp; !<a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, accountID, nBoxType)) <span class="comment">// &lt;===== nBoxType = 2 aka OUTBOX;</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: getOutbox succeeded, but then insureHaveAllBoxReceipts failed. (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">return</span> nReturn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd115fbf7b749ce17059191a07865edf"></a><!-- doxytag: member="Utility::getRequestNumber" ref="afd115fbf7b749ce17059191a07865edf" args="(const string &amp;serverID, const string &amp;nymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">Utility::getRequestNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01592">1592</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bWasSent = <span class="keyword">false</span>;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID, bWasSent);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a252176a94ca8f6db2b76a79266f21d3c"></a><!-- doxytag: member="Utility::getRequestNumber" ref="a252176a94ca8f6db2b76a79266f21d3c" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">Utility::getRequestNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01609">1609</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getRequestNumber&quot;</span>;

    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nResult = <a class="code" href="class_o_t_a_p_i___wrap.html#af42bdc7602ac9c589bea8c289e7fd660">OTAPI_Wrap::getRequest</a>(serverID, nymID);
    <span class="keywordflow">if</span> (-1 == nResult)  <span class="comment">// if error -1, that means it DIDN&#39;T SEND (error)</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getRequest message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nResult)  <span class="comment">// if 0 is returned, that also means it DIDN&#39;T SEND (but there was NO error...)</span>
    {                       <span class="comment">// I don&#39;t know if this case can actually even HAPPEN... but if it does, I&#39;ll log it.</span>
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Didn&#39;t send this getRequest message, but NO error occurred, either. (Should never happen.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// Since the 0 case should never happen, I&#39;m returning it as an ERROR (-1).</span>
        <span class="comment">// Note: I could never return 0;</span>
        <span class="comment">// and that the server&#39;s reply said &quot;success == 0&quot;. But that&#39;s not what happened here. Here,</span>
        <span class="comment">// we couldn&#39;t even SEND our request, which is an error</span>
    }
    <span class="comment">//</span>
    <span class="comment">// else it&#39;s &gt;0  ==  successfully sent! (I BELIEVE this is 1, in this case, every time, since you don&#39;t NEED a request number to CALL getRequestNum since you are only calling it in the first place because it must have gotten out of sync.)</span>
    <span class="comment">//</span>
    bWasSent = <span class="keyword">true</span>;
    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nResult, strLocation);
    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getRequestNumber &quot; + getLastReplyReceived());</span>

    <span class="comment">// BY this point, we definitely have the request number in nResult, which means</span>
    <span class="comment">// the message was actually SENT. (At least.) This also means we can use nResult</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>
    <span class="comment">//var nRemovedGetRequest = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nResult), serverID, nymID);</span>

    <span class="comment">// NOTE: The above call is unnecessary, since a successful reply means</span>
    <span class="comment">// we already received the successful server reply, and OT&#39;s &quot;ProcessServerReply&quot;</span>
    <span class="comment">// already removed the sent message from the sent buffer (so no need to do that here.)</span>

    <span class="comment">//      if (nRemovedGetRequest &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getRequestNumber: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedGetRequest);</span>
    <span class="comment">//      }</span>

    <span class="keywordflow">return</span> nReturn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af469bfc39379af23989e185469bb9dbd"></a><!-- doxytag: member="Utility::getTransactionNumbers" ref="af469bfc39379af23989e185469bb9dbd" args="(const string &amp;serverID, const string &amp;nymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#af469bfc39379af23989e185469bb9dbd">Utility::getTransactionNumbers</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02094">2094</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#af469bfc39379af23989e185469bb9dbd">getTransactionNumbers</a>(serverID, nymID, <span class="keyword">true</span>); <span class="comment">//bForceFirstCall = = true (by default) but in special cases you can override it and set it to false.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a022490aee892af222c03cbe2f74c6739"></a><!-- doxytag: member="Utility::getTransactionNumbers" ref="a022490aee892af222c03cbe2f74c6739" args="(const string &amp;serverID, const string &amp;nymID, const bool bForceFirstCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#af469bfc39379af23989e185469bb9dbd">Utility::getTransactionNumbers</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bForceFirstCall</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02099">2099</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getTransactionNumbers&quot;</span>;

    <span class="keywordtype">bool</span> bWasSent = <span class="keyword">false</span>;
    int32_t nGetNumbers = -1;
    <span class="keywordflow">if</span> (bForceFirstCall)
    {
        nGetNumbers = <a class="code" href="class_utility.html#a542c5b9409119aef3e1dce41d7904c03">getTransactionNumLowLevel</a>(serverID, nymID, bWasSent); <span class="comment">// &lt;============ FIRST TRY;</span>
    }

    <span class="comment">// if the first call didn&#39;t happen, due to bForceFirstCall being false, that means the caller wants the rest of this to happen as though it did.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bForceFirstCall || (bWasSent &amp;&amp; (nGetNumbers &gt;= 1)) || (!bWasSent &amp;&amp; (nGetNumbers == 0)))
    {
        <span class="comment">// Because it was successful, we have to now SIGN FOR those numbers we requested.</span>
        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;
        int32_t nProcess = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasSent, bForceDownload); <span class="comment">// bForceDownload=true;</span>

        <span class="keywordflow">if</span> ((bWasSent &amp;&amp; (1 == nProcess)) || (!bWasSent &amp;&amp; (0 == nProcess)))
        {
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }
    <span class="comment">// If value is LESS THAN -1 (which is an unexpected value)</span>
    <span class="comment">// or if the getTransactionNum message WASN&#39;T EVEN SENT, then return.</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nGetNumbers &lt; -1) || !bWasSent)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNumbers) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// Below this point, the message WAS sent.  -1 is error, 0 is failure, &gt;0 is success.</span>
    <span class="comment">// Now it&#39;s just about whether a reply was successful, or was even received.</span>
    <span class="comment">//</span>
    <span class="comment">//      else if ((-1 == nGetNumbers) ||   // Message sent, but then error receiving or loading the reply.</span>
    <span class="comment">//               (( 0) == nGetNumbers))     // Received a reply, butstatus = = failure on that reply.;</span>

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1 == nGetNumbers) || (0 == nGetNumbers))
    {
        <span class="keywordflow">if</span> (-1 == nGetNumbers)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: getTransactionNumLowLevel did send, but returned error (-1). (Re-trying...)\n&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nGetNumbers)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI: getTransactionNumLowLevel did send, but returned failure (0). (Re-trying...)\n&quot;</span>);
        }

        int32_t nGetRequest = <a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(serverID, nymID);
        <span class="keywordflow">if</span> (1 != nGetRequest)
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel failed, then I tried to resync with getRequestNumber and then that failed too. (I give up.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bWasProcessSent = <span class="keyword">false</span>;
        <span class="keywordtype">bool</span> bFoundNymboxItem = <span class="keyword">false</span>;

        <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;
        int32_t nProcessNymbox = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasProcessSent, bForceDownload); <span class="comment">//boolean bForceDownload=true;</span>

        <span class="comment">//          if ( (!bWasProcessSent &amp;&amp; ((nProcessNymbox  &lt; 0) || (nProcessNymbox  &gt; 1))) ||</span>
        <span class="comment">//               ( bWasProcessSent &amp;&amp; (nProcessNymbox  != 1)) ) // -1 error, 0 failed (harvesting success), 1 success, &gt;1 failed (harvesting NOT done) RequestNum is returned.</span>

        <span class="keywordflow">if</span> ((!bWasProcessSent &amp;&amp; ((nProcessNymbox  &lt; 0) || (nProcessNymbox  &gt; 1))) || (bWasProcessSent &amp;&amp; (nProcessNymbox != 1)))
        {
            <span class="comment">// todo: if request num is returned probably don&#39;t have to do anything with it.</span>
            <span class="comment">// Why not?  Because future processNymbox will iterate Nymbox and search for all found</span>
            <span class="comment">// items in the sent message buffer, and REMOVE them from it (as clearly they will be</span>
            <span class="comment">// processed already.)</span>
            <span class="comment">// The ones left over in the sent buffer, after this? Must be harvested!</span>
            <span class="comment">// Hmm, solution: Use the &quot;Flush Sent Messages&quot; function, which is already</span>
            <span class="comment">// there. Have it be smart enough to harvest all sent messages before flushing,</span>
            <span class="comment">//</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bWasProcessSent &amp;&amp; (nProcessNymbox &gt; 1))
            {
                <span class="keywordtype">string</span> strNymbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID); <span class="comment">// FLUSH SENT MESSAGES!!!!  (AND HARVEST.);</span>

                <span class="comment">// *******************************************************</span>
                <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymbox))
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae404dd731fc2272e138880e97d4ce0a9">OTAPI_Wrap::FlushSentMessages</a>(<span class="keyword">false</span>, <span class="comment">//harvesting for retry = = OT_FALSE</span>
                        serverID,
                        nymID,
                        strNymbox);
                }
            }

            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getAndProcessNymbox. Returned value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nProcessNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);

            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        nGetNumbers = <a class="code" href="class_utility.html#a542c5b9409119aef3e1dce41d7904c03">getTransactionNumLowLevel</a>(serverID, nymID, bWasSent); <span class="comment">// &lt;================= SECOND TRY;</span>

        <span class="comment">//          if ( ( bWasSent &amp;&amp; (nGetNumbers &gt;=  1)) || // if message was sent, and was a success.</span>
        <span class="comment">//               (!bWasSent &amp;&amp; (nGetNumbers ==  0)) )  // Or if message wasn&#39;t sent due to &quot;you already signed out too many numbers--you need to process your Nymbox...&quot;</span>

        <span class="keywordflow">if</span> ((bWasSent &amp;&amp; (nGetNumbers &gt;= 1)) || (!bWasSent &amp;&amp; (nGetNumbers == 0)))
        {
            <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;
            int32_t nProcess = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasSent, bForceDownload); <span class="comment">// bForceDownload=true;</span>

            <span class="comment">//              if ( ( bWasSent &amp;&amp; (1 == nProcess)) ||</span>
            <span class="comment">//                   (!bWasSent &amp;&amp; (0 == nProcess)) )</span>

            <span class="keywordflow">if</span> ((bWasSent &amp;&amp; (1 == nProcess)) || (!bWasSent &amp;&amp; (0 == nProcess)))
            {
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
        }
        <span class="comment">//          else if (( nGetNumbers &lt; -1) ||</span>
        <span class="comment">//                   (!bWasSent &amp;&amp; nGetNumbers != 0))</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nGetNumbers &lt; -1) || (!bWasSent &amp;&amp; nGetNumbers != 0))
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNumbers) + <span class="stringliteral">&quot;\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-1 == nGetNumbers) || (0 == nGetNumbers))
        {
            <span class="keywordflow">if</span> (-1 == nGetNumbers)
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel did send, but returned error (-1), even after syncing the request number successfully. (Giving up.)\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nGetNumbers)
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel did send, but returned failure (0), even after syncing the request number successfully. (Giving up.)\n&quot;</span>);
            }

            <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;

            int32_t nLast = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasProcessSent, bForceDownload); <span class="comment">//boolean bForceDownload=true;</span>
            <span class="comment">//              if (</span>
            <span class="comment">//                  ((!bWasProcessSent) &amp;&amp; ((nLast  &lt; 0) || (nLast  &gt; 1))) ||</span>
            <span class="comment">//                  ((true  == bWasProcessSent) &amp;&amp;  (nLast != 1))</span>
            <span class="comment">//                  ) // -1 error, 0 failed (harvesting success), 1 success, &gt;1 failed (harvesting NOT done) RequestNum is returned.</span>

            <span class="keywordflow">if</span> (((!bWasProcessSent) &amp;&amp; ((nLast  &lt; 0) || (nLast  &gt; 1))) || ((<span class="keyword">true</span> == bWasProcessSent) &amp;&amp; (nLast != 1))) <span class="comment">// -1 error, 0 failed (harvesting success), 1 success, &gt;1 failed (harvesting NOT done) RequestNum is returned.</span>
            {
                <span class="keywordflow">if</span> (bWasProcessSent &amp;&amp; (nLast &gt; 1))
                {
                    <span class="keywordtype">string</span> strNymbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID); <span class="comment">// FLUSH SENT MESSAGES!!!!  (AND HARVEST.);</span>

                    <span class="comment">// *******************************************************</span>
                    <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymbox))
                    {
                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae404dd731fc2272e138880e97d4ce0a9">OTAPI_Wrap::FlushSentMessages</a>(<span class="keyword">false</span>, <span class="comment">//harvesting for retry = = OT_FALSE</span>
                            serverID,
                            nymID,
                            strNymbox);
                    }
                }

                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getAndProcessNymbox. Returned value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nLast) + <span class="stringliteral">&quot;\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            nGetNumbers = <a class="code" href="class_utility.html#a542c5b9409119aef3e1dce41d7904c03">getTransactionNumLowLevel</a>(serverID, nymID, bWasSent); <span class="comment">// &lt;============ FIRST TRY;</span>

            <span class="comment">//              if ( (bWasSent &amp;&amp; (nGetNumbers &gt;= 1) )</span>
            <span class="comment">//                   ||</span>
            <span class="comment">//                   ((!bWasSent &amp;&amp; (nGetNumbers == 0) ) )</span>
            <span class="comment">//                 )</span>

            <span class="keywordflow">if</span> ((bWasSent &amp;&amp; (nGetNumbers &gt;= 1)) || ((!bWasSent &amp;&amp; (nGetNumbers == 0))))
            {
                <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;
                int32_t nProcess = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasSent, bForceDownload); <span class="comment">// bForceDownload=true;</span>

                <span class="comment">//                  if ( ( bWasSent &amp;&amp; (1 == nProcess)) ||</span>
                <span class="comment">//                       (!bWasSent &amp;&amp; (0 == nProcess)) )</span>

                <span class="keywordflow">if</span> ((bWasSent &amp;&amp; (1 == nProcess)) || (!bWasSent &amp;&amp; (0 == nProcess)))
                {
                    <span class="keywordflow">return</span> <span class="keyword">true</span>;
                }
            }

            <span class="comment">//              if ((nGetNumbers &lt; -1) ||         // If value is LESS THAN -1 (which is an unexpected value)</span>
            <span class="comment">//                  !bWasSent)    // or if the getTransactionNum message WASN&#39;T EVEN SENT, then return.</span>

            <span class="keywordflow">if</span> ((nGetNumbers &lt; -1) || !bWasSent)
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getTransactionNumLowLevel returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNumbers) + <span class="stringliteral">&quot;\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
    }

    <span class="comment">// BY THIS POINT, we have SUCCESSFULLY sent the getTransactionNumLowLevel message,</span>
    <span class="comment">// and nGetNumbers contains its request number.</span>


    <span class="comment">// No need to read the result, as getTransactionNumLowLevel() already read it,</span>
    <span class="comment">// and and it&#39;s available anytime via getLastReplyReceived()</span>

    <span class="keywordtype">string</span> <a class="code" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a> = <a class="code" href="class_utility.html#a41a51fc2cb1a609654b625769ef08519">getLastReplyReceived</a>();

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLastReplyReceived))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR in getLastReplyReceived(): why was this string not set, when getRequestNumber was otherwise an apparent success?\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// (SHOULD NEVER HAPPEN. This string is set in the getRequestNumber function.);</span>
    }

    <span class="comment">// BY THIS POINT, we have received a server reply:  @getTransactionNum</span>
    <span class="comment">// (Unless it is malformed.) It&#39;s definitely not null, nor empty.</span>

    <span class="comment">// Grab the NymboxHash on the @getTransactionNum reply, and also the one I</span>
    <span class="comment">// already had on my client-side Nym... (So we can compare them.)</span>
    <span class="comment">//</span>
    <span class="keywordtype">string</span> strServerHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a42803f459dcf9ecc1c3ee4bccf917746">OTAPI_Wrap::Message_GetNymboxHash</a>(strLastReplyReceived);
    <span class="keywordtype">bool</span> bServerhash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerHash);
    <span class="keywordflow">if</span> (!bServerhash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve server-side NymboxHash from OT, from server @getTransactionNum reply:\n\n&quot;</span> + strLastReplyReceived + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="comment">//          return false;</span>
    }

    <span class="keywordtype">string</span> strLocalHash = <a class="code" href="class_o_t_a_p_i___wrap.html#a17de0af836994eb5d28f9e843ffde769">OTAPI_Wrap::GetNym_NymboxHash</a>(serverID, nymID);
    <span class="keywordtype">bool</span> bLocalhash = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalHash);
    <span class="keywordflow">if</span> (!bLocalhash)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Warning: Unable to retrieve client-side NymboxHash from OT, for:\n serverID: &quot;</span> + serverID + <span class="stringliteral">&quot;\n nymID: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="comment">//          return false;</span>
    }

    <span class="comment">// the hashes don&#39;t match -- so let&#39;s definitely re-try to download the latest nymbox.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bServerhash || !bLocalhash || (bServerhash &amp;&amp; bLocalhash &amp;&amp; !(strServerHash == strLocalHash)))
    {
        <span class="comment">// the getRequest worked, and the server hashes don&#39;t match,</span>
        <span class="comment">// so let&#39;s get and process the Nymbox...</span>
        <span class="comment">//</span>

        <span class="keywordtype">bool</span> bWasProcessSent = <span class="keyword">false</span>;
        <span class="keywordtype">bool</span> bFoundNymboxItem = <span class="keyword">false</span>;

        <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">true</span>;
        int32_t nGetNymbox = <a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(serverID, nymID, bWasProcessSent, bForceDownload); <span class="comment">//boolean bForceDownload=true;</span>

        <span class="comment">//          if ( ((!bWasProcessSent) &amp;&amp; ((nGetNymbox  &lt; 0) || (nGetNymbox  &gt; 1))) ||</span>
        <span class="comment">//               ((true  == bWasProcessSent) &amp;&amp; (nGetNymbox != 1)) ) // -1 error, 0 failed (harvesting success), 1 success, &gt;1 failed (harvesting NOT done) RequestNum is returned.</span>

        <span class="keywordflow">if</span> (((!bWasProcessSent) &amp;&amp; ((nGetNymbox  &lt; 0) || (nGetNymbox  &gt; 1))) || ((<span class="keyword">true</span> == bWasProcessSent) &amp;&amp; (nGetNymbox != 1)))
        {
            <span class="keywordflow">if</span> (nGetNymbox &gt; 1)
            {
                <span class="keywordtype">string</span> strNymbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID); <span class="comment">// FLUSH SENT MESSAGES!!!!  (AND HARVEST.);</span>

                <span class="comment">// *******************************************************</span>
                <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymbox))
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae404dd731fc2272e138880e97d4ce0a9">OTAPI_Wrap::FlushSentMessages</a>(<span class="keyword">false</span>, <span class="comment">//harvesting for retry = = OT_FALSE</span>
                        serverID,
                        nymID,
                        strNymbox);
                }
            }

            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getAndProcessNymbox returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">if</span> (-1 == nGetNymbox) <span class="comment">// we&#39;ll try re-syncing the request number, then try again.</span>
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: getAndProcessNymbox returned -1, even after syncing the request number successfully. (Giving up.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a542c5b9409119aef3e1dce41d7904c03"></a><!-- doxytag: member="Utility::getTransactionNumLowLevel" ref="a542c5b9409119aef3e1dce41d7904c03" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasSent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a542c5b9409119aef3e1dce41d7904c03">Utility::getTransactionNumLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasSent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l02013">2013</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::getTransactionNumLowLevel&quot;</span>;

    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();
    bWasSent = <span class="keyword">false</span>;

    int32_t nRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#adf2fcc335490df1e05bffd6ac5040a05">OTAPI_Wrap::getTransactionNumber</a>(serverID, nymID); <span class="comment">// &lt;===== ATTEMPT TO SEND THE MESSAGE HERE...;</span>
    <span class="keywordflow">if</span> (-2 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: ERROR, not supported. (-2 was returned.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// -2 is also possible at some future date. (If the request number won&#39;t fit in an int32_t, this is returned and then you can retrieve the actual number via a separate call.)</span>
    }
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed to send getNymbox message due to error.\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpectedly returned 0. Didn&#39;t send getTransactionNum message, but NO error occurred, either. (In this case, SHOULD NEVER HAPPEN. Treating as Error.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;  <span class="comment">// Even though &#39;0&#39; MEANS &quot;didn&#39;t send, but no error&quot; by convention in many places, it is actually an impossible return value;</span>
    }
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unexpected request number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasSent = <span class="keyword">true</span>;

    <span class="comment">// ***************************************************</span>
    <span class="comment">//</span>
    int32_t nReturn = <a class="code" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">receiveReplySuccessLowLevel</a>(serverID, nymID, nRequestNum, <span class="stringliteral">&quot;getTransactionNum&quot;</span>);
    <span class="comment">//      OTAPI_Wrap::Output(0, &quot;IN getTransactionNum &quot; + getLastReplyReceived());</span>

    <span class="comment">// BY this point, we definitely have the request number in nResult, which means</span>
    <span class="comment">// the message was actually SENT. (At least.) This also means we can use nResult</span>
    <span class="comment">// later to query for a copy of that sent message.</span>
    <span class="comment">// Let&#39;s go ahead, in this case, and remove that now:</span>
    <span class="comment">//</span>

    <span class="comment">// THE REMOVE SENT MESSAGE BELOW FAILS, LIKE IT&#39;S ALREADY GONE.</span>
    <span class="comment">//</span>
    <span class="comment">// THIS MUST BE DUE TO THE PROCESS SERVER REPLY THAT OCCURS **IMMEDIATELY** after the message was originally sent!</span>
    <span class="comment">// (The reply came in and was sent to OT&#39;s &quot;ProcessServerReply&quot;, INSIDE the call to OTAPI_Wrap::getTransactionNumber.)</span>
    <span class="comment">// Our subsequent &quot;receive&quot; (above) is nothing of the sort, but actually pops the incoming message buffer where</span>
    <span class="comment">// the server&#39;s reply was ALREADY SITTING, since it was put there in OT&#39;s &quot;ProcessServerReply&quot;, WHICH REMOVED THE</span>
    <span class="comment">// SENT MESSAGE ALREADY (that&#39;s why the below call to RemoveSentMessage fails.)</span>
    <span class="comment">//</span>
    <span class="comment">// RETHINK any logic that doesn&#39;t take this into account,.</span>
    <span class="comment">// Either we REMOVE this call wherever this happens, OR... we call Get first and make sure whether it&#39;s</span>
    <span class="comment">// there, THEN remove it. But we can&#39;t be lumping &quot;Failure because it&#39;s gone&quot; versus &quot;Error state&quot; by mixing</span>
    <span class="comment">// 0 and -1 here. We need to differentiate.</span>
    <span class="comment">//</span>
    <span class="comment">// Bottom line: if the reply WAS received, then the original sent message has ALREADY been removed</span>
    <span class="comment">// from the sent buffer. Whereas if the reply was NOT received, then the sent message is still there,</span>
    <span class="comment">// but in that case, we do NOT want to remove it -- we want it to STAY in the sent buffer, so that</span>
    <span class="comment">// when we get the Nymbox later and we DO have the reply from that, THEN we can remove the sent msg from</span>
    <span class="comment">// the sent buffer. Until then, we don&#39;t want OT to think it&#39;s already been processed (which it will, if</span>
    <span class="comment">// it&#39;s already been removed from the sent buffer. So we leave it there for now.)</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    <span class="comment">//     int32_t nRemovedSentMsg = OTAPI_Wrap::RemoveSentMessage(Integer.toString(nRequestNum), serverID, nymID);</span>
    <span class="comment">//</span>
    <span class="comment">//      if (nRemovedSentMsg &lt; 1)</span>
    <span class="comment">//      {</span>
    <span class="comment">//          OTAPI_Wrap::Output(0, &quot;getTransactionNum: ERROR: OT_API_RemoveSentMessage returned: &quot; + nRemovedSentMsg);</span>
    <span class="comment">//      }</span>

    <span class="keywordflow">if</span> (1 == nReturn)
    {
        <span class="keywordflow">return</span> nRequestNum;
    }

    <span class="keywordflow">return</span> nReturn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad944a8dda0ef36b4e437bb9d3452ea97"></a><!-- doxytag: member="Utility::insureHaveAllBoxReceipts" ref="ad944a8dda0ef36b4e437bb9d3452ea97" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">Utility::insureHaveAllBoxReceipts</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01754">1754</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bFoundIt = <span class="keyword">false</span>;
    int32_t nRequestSeeking = 0;
    <span class="keywordflow">return</span> <a class="code" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">insureHaveAllBoxReceipts</a>(serverID, nymID, accountID, nBoxType, nRequestSeeking, bFoundIt);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3dfa4e51052f58f3a0df4e455692803e"></a><!-- doxytag: member="Utility::insureHaveAllBoxReceipts" ref="a3dfa4e51052f58f3a0df4e455692803e" args="(const string &amp;serverID, const string &amp;nymID, const string &amp;accountID, const int32_t nBoxType, const int32_t nRequestSeeking, bool &amp;bFoundIt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> bool <a class="el" href="class_utility.html#ad944a8dda0ef36b4e437bb9d3452ea97">Utility::insureHaveAllBoxReceipts</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>accountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nRequestSeeking</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bFoundIt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01762">1762</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::insureHaveAllBoxReceipts&quot;</span>;

    <span class="keywordtype">string</span> ledger = <span class="stringliteral">&quot;&quot;</span>;

    <span class="keywordflow">if</span> (0 == nBoxType)
    {
        ledger = <a class="code" href="class_o_t_a_p_i___wrap.html#a40953d1314416f6735616d66e3028712">OTAPI_Wrap::LoadNymboxNoVerify</a>(serverID, nymID);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 == nBoxType)
    {
        ledger = <a class="code" href="class_o_t_a_p_i___wrap.html#a5a08b3ad80f4f3a5e08b78344f348e92" title="These versions don&#39;t verify the ledger, they just load it up.">OTAPI_Wrap::LoadInboxNoVerify</a>(serverID, nymID, accountID);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2 == nBoxType)
    {
        ledger = <a class="code" href="class_o_t_a_p_i___wrap.html#a856a83f6ea9395e127e9eaa0ddb59546">OTAPI_Wrap::LoadOutboxNoVerify</a>(serverID, nymID, accountID);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error. Expected nBoxType of 0,1,2 (nymbox, inbox, or outbox.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// Unable to load or verify inbox/outbox/nymbox</span>
    <span class="comment">// Notice I don&#39;t call VerifyAccount() here (not that the API even exposes</span>
    <span class="comment">// that method) but why not? Because that method tries to load up all the</span>
    <span class="comment">// box receipts, in addition to verifying the signature. Therefore I call</span>
    <span class="comment">// &quot;Load XXXX NoVerify()&quot;, avoiding all that, then I verify the Signature</span>
    <span class="comment">// itself. That&#39;s because this function&#39;s whole point is to find out what</span>
    <span class="comment">// the box receipts are, and download them from the server. No point trying</span>
    <span class="comment">// to load them before that time, when I know it will fail.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(ledger) || (!<a class="code" href="class_o_t_a_p_i___wrap.html#a519859fade0f73fd4c041794be42b37f">OTAPI_Wrap::VerifySignature</a>(nymID, ledger)))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load or verify signature on ledger. (Failure.) Contents:\n&quot;</span> + ledger + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// At this point, the box is definitely loaded.</span>
    <span class="comment">// Next we&#39;ll iterate the receipts</span>
    <span class="comment">// within, and for each, verify that the Box Receipt already exists. If not,</span>
    <span class="comment">// then we&#39;ll download it using getBoxReceiptLowLevel(). If any download fails,</span>
    <span class="comment">// then we break out of the loop (without continuing on to try the rest.)</span>
    <span class="comment">//</span>
    <span class="keywordtype">bool</span> bReturnValue = <span class="keyword">true</span>; <span class="comment">// Assuming an empty box, we return success;</span>

    int32_t nReceiptCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(serverID, nymID, accountID, ledger);
    <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nReceiptCount) &amp;&amp; (nReceiptCount &gt; 0))
    {
        <span class="keywordflow">for</span> (int32_t i_loop = 0; i_loop &lt; nReceiptCount; ++i_loop) <span class="comment">// ******** FOR LOOP ****************</span>
        {
            int64_t lTransactionNum = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(serverID, nymID, accountID, ledger, i_loop);
            <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lTransactionNum) &amp;&amp; (lTransactionNum != -1))
            {
                <span class="keywordflow">if</span> (lTransactionNum &gt; 0)
                {
                    <span class="keywordtype">string</span> strTransaction = <a class="code" href="class_o_t_a_p_i___wrap.html#a0f2079d912ec13e9bace32d212efc4c8">OTAPI_Wrap::Ledger_GetTransactionByID</a>(serverID, nymID, accountID, ledger, lTransactionNum);

                    <span class="comment">// Note: OTAPI_Wrap::Ledger_GetTransactionByID tries to get the full transaction from the ledger and</span>
                    <span class="comment">// return it;</span>
                    <span class="comment">// and pass the full version back to us. Failing that (perhaps the box receipt hasn&#39;t been downloaded</span>
                    <span class="comment">// yet) then it will try to re-sign / re-save the abbreviated version and pass it back. So if, by this</span>
                    <span class="comment">// point, it STILL has failed, that means it couldn&#39;t even give us the abbreviated version either!</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransaction))
                    {
                        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: Null transaction somehow returned, (not even an abbreviated one!) even though I had a good ID &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransactionNum)
                            + <span class="stringliteral">&quot; which came originally as lTransactionNum: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransactionNum) + <span class="stringliteral">&quot; for index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i_loop) + <span class="stringliteral">&quot; with the contents:\n\n&quot;</span> + strTransaction + <span class="stringliteral">&quot;\n\n&quot;</span>);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }

                    <span class="comment">// This block might have a full version, OR an abbreviated version of the box receipt in</span>
                    <span class="comment">// question, in the strTransaction variable. It will attempt to download the full box</span>
                    <span class="comment">// receipt, if we don&#39;t already have it here on the client side.</span>
                    {
                        <span class="keywordtype">string</span> strTransType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(serverID, nymID, accountID, strTransaction);
                        <span class="keywordtype">bool</span> bIsReplyNotice = (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransType) &amp;&amp; (strTransType == <span class="stringliteral">&quot;replyNotice&quot;</span>));
                        int64_t lRequestNum = 0;
                        <span class="keywordflow">if</span> (bIsReplyNotice)
                        {
                            lRequestNum = <a class="code" href="class_o_t_a_p_i___wrap.html#a8d6b69fb05930ea9411197137d10b6d5">OTAPI_Wrap::ReplyNotice_GetRequestNum</a>(serverID, nymID, strTransaction);
                        }

                        <span class="keywordtype">bool</span> bShouldDownload = (!bIsReplyNotice ||
                            (bIsReplyNotice &amp;&amp; (0 &lt; lRequestNum) &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#aee839704601f9d56f9eb21ca9c87469c">OTAPI_Wrap::HaveAlreadySeenReply</a>(serverID, nymID, lRequestNum)));

                        <span class="keywordflow">if</span> (bShouldDownload) <span class="comment">// This block executes if we should download it (assuming we haven&#39;t already, which it also checks for.)</span>
                        {
                            <span class="keywordtype">bool</span> bHaveBoxReceipt = <a class="code" href="class_o_t_a_p_i___wrap.html#ada7621c2729462f2d6822e64ec2f2b84">OTAPI_Wrap::DoesBoxReceiptExist</a>(serverID, nymID, accountID, nBoxType, lTransactionNum);
                            <span class="keywordflow">if</span> (!bHaveBoxReceipt)
                            {
                                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, strLocation + <span class="stringliteral">&quot;: Downloading box receipt to add to my collection...\n&quot;</span>);

                                <span class="keywordtype">bool</span> bDownloaded = <a class="code" href="class_utility.html#a9987f4da96634939d1a2dce81b147d95">getBoxReceiptWithErrorCorrection</a>(serverID, nymID, accountID, nBoxType, lTransactionNum);
                                <span class="keywordflow">if</span> (!bDownloaded)
                                {
                                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed downloading box receipt. (Skipping any others.) Transaction number: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransactionNum) + <span class="stringliteral">&quot;\n&quot;</span>);

                                    bReturnValue = <span class="keyword">false</span>;
                                    <span class="keywordflow">break</span>;
                                    <span class="comment">// No point continuing to loop and fail 500 times, when getBoxReceiptWithErrorCorrection() already failed</span>
                                    <span class="comment">// even doing the getRequest() trick and everything, and whatever retries are inside OT, before it finally</span>
                                    <span class="comment">// gave up.</span>
                                }
                                <span class="comment">// else (Download success.)</span>
                            } <span class="comment">// if (!bHaveBoxReceipt)</span>
                        }

                        <span class="comment">// else we already have the box receipt, no need to download again.</span>
                    }
                } <span class="comment">// if (lTransactionNum &gt; 0)</span>
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: TransactionNum less-than-or-equal-to 0.\n&quot;</span>);
                }
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: TransactionNum was null, when trying to read it based on the index (within bounds, too!)\n&quot;</span>);
            }
        } <span class="comment">// ************* FOR LOOP ******************</span>
    } <span class="comment">// if (nReceiptCount &gt; 0)</span>

    <span class="comment">//</span>
    <span class="comment">// if nRequestSeeking is &gt;0, that means the caller wants to know if there is a receipt present for that request number.</span>
    <span class="comment">// (which is only a valid option ifnBoxType = = 0 for Nymbox.);</span>
    <span class="comment">// IF the receipt is found, then bFoundIt is set to true.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((nRequestSeeking &gt; 0) &amp;&amp; (0 == nBoxType))
    {
        <span class="comment">// NOTE: the below call to OTAPI_Wrap::Nymbox_GetReplyNotice will succeed even if</span>
        <span class="comment">// only the abbreviated receipt is available, because the caller mainly just</span>
        <span class="comment">// wants to know if it is there.</span>
        <span class="comment">// Technically the full receipt SHOULD always be there, with the above loop,</span>
        <span class="comment">// but since the above loop can break in case of error, it&#39;s still possible that</span>
        <span class="comment">// box receipts haven&#39;t been downloaded by the time you reach this code.</span>
        <span class="comment">// Nevertheless, we will see if the reply is there for the appropriate request</span>
        <span class="comment">// number, whether abbreviated or not.</span>
        <span class="comment">//</span>
        <span class="comment">// UPDATE: I am now adding specific cases where the replyNotice is NOT downloaded.</span>
        <span class="comment">// You still use it, through its abbreviated version -- and the actual version</span>
        <span class="comment">// IS still available for download through the server&#39;s API. But with a replyNotice,</span>
        <span class="comment">// just knowing that it exists is usually enough for the client, who probably still</span>
        <span class="comment">// has a cached copy of the original sent message anyway. Only in cases where he</span>
        <span class="comment">// doesn&#39;t, would he need to download it. (Why? So he can process the server&#39;s reply.)</span>
        <span class="comment">// Therefore the cached sent message is useless, since it doesn&#39;t contain the server&#39;s</span>
        <span class="comment">// reply! Hmm. So I need that reply BUT ONLY IN CASES where I didn&#39;t already receive it</span>
        <span class="comment">// as a normal part of processing (and that is MOST of the time, meaning most cases can</span>
        <span class="comment">// thus entirely eliminate the download.)</span>
        <span class="comment">//</span>
        <span class="comment">// PROTOCOL FOR NOT DOWNLOADING MOST OF THE BOX RECEIPTS</span>
        <span class="comment">//</span>
        <span class="comment">// Solution: User messages should contain a list of the last X number of request numbers</span>
        <span class="comment">// that they have DEFINITELY seen the response to. The server, meanwhile, since the user</span>
        <span class="comment">// has DEFINITELY seen the response, can now safely remove the replyNotice from the Nymbox.</span>
        <span class="comment">// The only reason it was there in the first place was to make sure the user got the reply.</span>
        <span class="comment">// Since the user is straight-up acknowledging that he received it, the server no longer</span>
        <span class="comment">// needs to &quot;make sure&quot; and thus it can remove that reply from the Nymbox, and mark the</span>
        <span class="comment">// box receipt for deletion. This will be MOST REPLIES! We&#39;ll eliminate the step of having</span>
        <span class="comment">// to download the box receipt.</span>
        <span class="comment">// The above call to getBoxReceiptWithErrorCorrection should also be smart enough not to</span>
        <span class="comment">// bother downloading any replyNotice Box Receipts if their request number appears on that</span>
        <span class="comment">// list. Again: the list means I DEFINITELY already responded to it--if the request # is on</span>
        <span class="comment">// that list, then NO NEED downloading the Box Receipt -- I DEFINITELY already got that reply!</span>
        <span class="comment">//</span>
        <span class="comment">// Therefore, Something like OTAPI_Wrap::HaveAlreadySeenReply(serverID, nymID, requestNum);</span>
        <span class="comment">//</span>
        <span class="comment">// Perhaps also, on the server side, send a list of request numbers for that Nym that the</span>
        <span class="comment">// server KNOWS the Nym saw the reply to. This way, the Nym can remove the number from his</span>
        <span class="comment">// list, and thus won&#39;t be continually causing the server to load up the Nymbox and try</span>
        <span class="comment">// to remove the replyNotice (since it&#39;s already been removed.)</span>
        <span class="comment">//</span>
        <span class="comment">// The Nym doesn&#39;t have to keep a list of ALL request numbers he&#39;s seen the reply to.</span>
        <span class="comment">// Rather, just the past X number of them, and with the number explicitly removed once</span>
        <span class="comment">// he sees the server acknowledgment. (ServerAckOfAlreadyGotReply.)</span>
        <span class="comment">//</span>
        <span class="comment">// The server, meanwhile, is free to remove the ACK for any request # once he sees that</span>
        <span class="comment">// the client has as well. Server also only needs to store a list of the past X request #s.</span>
        <span class="comment">// Also: since both sides REMOVE the number, there need not necessarily be a limit on the</span>
        <span class="comment">// size of the list, since it grows and shrinks as needed.</span>
        <span class="comment">//</span>
        <span class="comment">// Whenever Wallet processes a server reply, just see if it&#39;s on that &quot;replied to already&quot;</span>
        <span class="comment">// list already on client side. If so, discard the reply. OTClient::ProcessServerReply probably</span>
        <span class="comment">// best place to do  (We replied to it already, so discard it.)</span>
        <span class="comment">// Also, for any server reply, look at the list of numbers on it. The server is acknowledging</span>
        <span class="comment">// to us that it KNOWS we got those replies, and that it ALREADY has removed them from the</span>
        <span class="comment">// Nymbox as a result. Therefore we can remove ALL of those numbers from our own list</span>
        <span class="comment">// as well. No need for an API call to do this, since it will happen internally to OT.</span>
        <span class="comment">//</span>
        <span class="comment">// On the server side, any numbers on its own list were only there to acknowledge numbers</span>
        <span class="comment">// that had been on the client side list. Therefore, when those numbers disappear from the</span>
        <span class="comment">// client side list, the server simply removes them. Again: ANY NUMBERS on the server list,</span>
        <span class="comment">// which do NOT appear on the client list, are REMOVED From the server list. After all, the</span>
        <span class="comment">// client has clearly now removed them, so the server doesn&#39;t have to keep them around either.</span>
        <span class="comment">//</span>
        <span class="comment">// These are useful for synchronization but also there&#39;s a int64_t term benefit, if we include</span>
        <span class="comment">// them in the signed receipt (which they will be already, if the receipt contains the entire</span>
        <span class="comment">// message and not just the transaction.) That benefit is that we can prove receipt of notice.</span>
        <span class="comment">// At least, notice of server replies. But for other notice types, such as notice of upcoming</span>
        <span class="comment">// meeting. Or notice of upcoming election. Or notice of election outcome. Or notice of petition</span>
        <span class="comment">// to put X issue on the next ballot, or to nominate Y Nym for some corporate role. Sometimes</span>
        <span class="comment">// you want to be able to PROVE that notice was received. Does this prove that?</span>
        <span class="comment">// Hmm, not necessarily. Currently I&#39;m using this as an optimization scheme, which is useful</span>
        <span class="comment">// even if not provable. How to make it provable?</span>
        <span class="comment">//</span>
        <span class="comment">// Back from tangent: Wait a sec! If I notice the server that I saw the reply, the server will</span>
        <span class="comment">// remove that reply from my Nymbox -- but it&#39;s still in my Nymbox on the client side! Until</span>
        <span class="comment">// I download the latest Nymbox. Thus if I try to PROCESS MY NYMBOX, I will be attempting to</span>
        <span class="comment">// accept a receipt that&#39;s already gone! (And the processNymbox will therefore FAIL!)</span>
        <span class="comment">// Solution: be smart enough, when processing Nymbox, to IGNORE any replyNotices when the request</span>
        <span class="comment">// Number appears on the client&#39;s list! As the wallet processes the Nymbox it should already</span>
        <span class="comment">// know to skip the ones that were already replied-to.</span>
        <span class="comment">// Meanwhile the server side will deliberately NOT update the Nymbox hash just because the receipt</span>
        <span class="comment">// was removed. Otherwise it could trigger an unnecessary download of the Nymbox, when the whole</span>
        <span class="comment">// point of this exercise was to prevent unnecessary downloads. It only updates the Nymbox hash</span>
        <span class="comment">// when it WANTS me to download the Nymbox, and that certainly does NOT apply to cases where the</span>
        <span class="comment">// only change involved the removal of some old receipt I already acknowledged. (No need to force</span>
        <span class="comment">// any downloads based on THAT case, after all.)</span>
        <span class="comment">//</span>
        <span class="keywordtype">string</span> strReplyNotice = <a class="code" href="class_o_t_a_p_i___wrap.html#a0986f8a3cbac901bd17725a120cc8290">OTAPI_Wrap::Nymbox_GetReplyNotice</a>(serverID, nymID, int64_t(nRequestSeeking));

        <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strReplyNotice))
        {
            bFoundIt = <span class="keyword">true</span>;
        }
    }

    <span class="keywordflow">return</span> bReturnValue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a680b0d0873c6d28cfd5b91de4e30c6b1"></a><!-- doxytag: member="Utility::longDelay" ref="a680b0d0873c6d28cfd5b91de4e30c6b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void <a class="el" href="class_utility.html#a680b0d0873c6d28cfd5b91de4e30c6b1">Utility::longDelay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00558">558</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_p_i___wrap.html#ae71d4d649f0cd1929a48f9092d505e10">OTAPI_Wrap::Sleep</a>(<a class="code" href="class_utility.html#a55f9ff8ceb056a8fe95ec1ed5e4e3399">delay_ms</a> + 200);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac88672f5fd7f460fa467476a71f30371"></a><!-- doxytag: member="Utility::processNymbox" ref="ac88672f5fd7f460fa467476a71f30371" args="(const string &amp;serverID, const string &amp;nymID, bool &amp;bWasMsgSent, int32_t &amp;nMsgSentRequestNumOut, int32_t &amp;nReplySuccessOut, int32_t &amp;nBalanceSuccessOut, int32_t &amp;nTransSuccessOut)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ac88672f5fd7f460fa467476a71f30371">Utility::processNymbox</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bWasMsgSent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;&#160;</td>
          <td class="paramname"><em>nMsgSentRequestNumOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;&#160;</td>
          <td class="paramname"><em>nReplySuccessOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;&#160;</td>
          <td class="paramname"><em>nBalanceSuccessOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;&#160;</td>
          <td class="paramname"><em>nTransSuccessOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01418">1418</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    bWasMsgSent = <span class="keyword">false</span>;
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::processNymbox&quot;</span>;

    <span class="comment">//if (!VerifyOTBoolRef(bWasMsgSent) || !VerifyOTIntegerRef(nReplySuccessOut) || !VerifyOTIntegerRef(nBalanceSuccessOut) || !VerifyOTIntegerRef(nTransSuccessOut))</span>
    <span class="comment">//{</span>
    <span class="comment">//    OTAPI_Wrap::Output(0, strLocation + &quot;: SHOULD NEVER HAPPEN: has null values passed in...\n&quot;);</span>
    <span class="comment">//    exit(-1)</span>
    <span class="comment">//}</span>

    nMsgSentRequestNumOut = -1;
    nReplySuccessOut = -1;
    nBalanceSuccessOut = -1;
    nTransSuccessOut = -1;

    <span class="comment">// -- SECTION 2: &quot;SEND PROCESS NYMBOX&quot;</span>

    <span class="comment">// Next, we have to make sure we have all the BOX RECEIPTS downloaded</span>
    <span class="comment">// for this Nymbox.</span>

    int32_t nProcess = <a class="code" href="class_utility.html#ad6c441c50adc8c4327de016dbdfa9a28">sendProcessNymboxLowLevel</a>(serverID, nymID); <span class="comment">// &lt;===================== SEND PROCESS NYMBOX!!;</span>
    <span class="keywordflow">if</span> (-1 == nProcess)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;(2): error (-1), when calling sendProcessNymboxLowLevel. (It couldn&#39;t send. I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// (It didn&#39;t even send.)</span>
    }
    <span class="comment">// Nymbox was empty. (So we didn&#39;t send any process message because there was nothing to process.)</span>
    <span class="keywordflow">if</span> (0 == nProcess)
    {
        <span class="keywordflow">return</span> 0; <span class="comment">// success. done.</span>
    }
    <span class="keywordflow">if</span> (nProcess &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: unexpected: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nProcess) + <span class="stringliteral">&quot;, when calling sendProcessNymboxLowLevel. (I give up.)\n&quot;</span>);
        <span class="keywordflow">return</span> -1;
    }

    bWasMsgSent = <span class="keyword">true</span>;
    nMsgSentRequestNumOut = nProcess;

    <span class="comment">// By this point, we definitely have a &gt;0 request number from the sendProcessNymbox()</span>
    <span class="comment">// call, stored in  ** nProcess ** (meaning the message WAS sent.)</span>
    <span class="comment">//</span>
    <span class="comment">// But was it received?</span>
    <span class="comment">//</span>
    <span class="keywordtype">string</span> strReplyProcess = <a class="code" href="class_utility.html#a8bd3cff789307602e0ef5a29b911b8ce">ReceiveReplyLowLevel</a>(serverID, nymID, nProcess,
        <span class="stringliteral">&quot;processNymbox / sendProcessNymboxLowLevel / ReceiveReplyLowLevel&quot;</span>); <span class="comment">// &lt;=============== Here we RECEIVE the REPLY...</span>


    <span class="comment">// getLastReplyReceived() will also contain the same as strReplyProcess.</span>
    <span class="comment">// So if the CALLER of this function (that we&#39;re in, receiveNymboxLowLevel)</span>
    <span class="comment">// wants to see the contents, he can.</span>

    <span class="comment">// ReceiveReplyLowLevel returns null unless there was a string returned.</span>
    <span class="comment">// So we can directly check it for success...</span>

    int32_t nReplySuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strReplyProcess); <span class="comment">// sendProcessNymboxLowLevel;</span>
    int32_t nTransSuccess = -1;
    int32_t nBalanceSuccess = -1;;
    <span class="keywordflow">if</span> (nReplySuccess &gt; 0) <span class="comment">// If message was success, then let&#39;s see if the transaction was, too.</span>
    {
        nBalanceSuccess = <a class="code" href="class_o_t_a_p_i___wrap.html#ab96dba3945c8e16f0a290fd90cba467b">OTAPI_Wrap::Message_GetBalanceAgreementSuccess</a>(serverID, nymID, nymID, strReplyProcess); <span class="comment">// the processNymbox transaction.;</span>
        <span class="keywordflow">if</span> (nBalanceSuccess &gt; 0)
        {
            nTransSuccess = <a class="code" href="class_o_t_a_p_i___wrap.html#aa7fda270a877dde2d8765a91b11ff98c">OTAPI_Wrap::Message_GetTransactionSuccess</a>(serverID, nymID, nymID, strReplyProcess); <span class="comment">// the processNymbox transaction.;</span>
        }
    }

    nReplySuccessOut = nReplySuccess;
    nBalanceSuccessOut = nBalanceSuccess;
    nTransSuccessOut = nTransSuccess;

    <span class="comment">// NOTE: The caller MUST have a call to OTAPI_Wrap::RemoveSentMessage</span>
    <span class="comment">// to correspond to THIS function&#39;s call of sendProcessNymboxLowLevel().</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (nTransSuccess &gt; 0)
    {
        <span class="keywordflow">return</span> nProcess; <span class="comment">// &lt;=========================</span>
    }

    <span class="keywordflow">return</span> nTransSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8bd3cff789307602e0ef5a29b911b8ce"></a><!-- doxytag: member="Utility::ReceiveReplyLowLevel" ref="a8bd3cff789307602e0ef5a29b911b8ce" args="(const string &amp;serverID17, const string &amp;nymID, const int32_t nRequestNumber8, const string &amp;IN_FUNCTION)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> string <a class="el" href="class_utility.html#a8bd3cff789307602e0ef5a29b911b8ce">Utility::ReceiveReplyLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID17</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nRequestNumber8</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>IN_FUNCTION</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01569">1569</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_utility.html#aca01f3986c5d18f3490c6950a3ebc894">delay</a>();
    <a class="code" href="class_utility.html#ab5bdca5dc8f916c2daa50c791ffcdfb1">setLastReplyReceived</a>(<span class="stringliteral">&quot;&quot;</span>);

    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nRequestNumber8))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ReceiveReplyLowLevel (&quot;</span> + IN_FUNCTION + <span class="stringliteral">&quot;): nRequestNumber isn&#39;t a valid number.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
    }

    <span class="keywordtype">string</span> strResponseMessage = <a class="code" href="class_o_t_a_p_i___wrap.html#abb1006b47d0b435a01a327341471bdfc">OTAPI_Wrap::PopMessageBuffer</a>(int64_t(nRequestNumber8), serverID17, nymID);
    <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponseMessage))
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ReceiveReplyLowLevel (&quot;</span> + IN_FUNCTION + <span class="stringliteral">&quot;): null server reply!\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
    }
    <a class="code" href="class_utility.html#ab5bdca5dc8f916c2daa50c791ffcdfb1">setLastReplyReceived</a>(strResponseMessage);

    <span class="keywordflow">return</span> strResponseMessage;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3d67d3c7f3c386cb6a4a165c3ca6e5a1"></a><!-- doxytag: member="Utility::receiveReplySuccessLowLevel" ref="a3d67d3c7f3c386cb6a4a165c3ca6e5a1" args="(const string &amp;serverID18, const string &amp;nymID, const int32_t nRequestNumber7, const string &amp;IN_FUNCTION)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#a3d67d3c7f3c386cb6a4a165c3ca6e5a1">Utility::receiveReplySuccessLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID18</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nRequestNumber7</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>IN_FUNCTION</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01547">1547</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strReply = <a class="code" href="class_utility.html#a8bd3cff789307602e0ef5a29b911b8ce">ReceiveReplyLowLevel</a>(serverID18, nymID, nRequestNumber7, <span class="stringliteral">&quot;receiveReplySuccessLowLevel: &quot;</span> + IN_FUNCTION); <span class="comment">// &lt;=============== Here we RECEIVE the REPLY...</span>

    <span class="comment">// getLastReplyReceived() will also contain the same as strReply.</span>
    <span class="comment">// So if the CALLER of this function (that we&#39;re in, receiveNymboxLowLevel)</span>
    <span class="comment">// wants to see the contents, he can.</span>

    <span class="comment">// ReceiveReplyLowLevel returns null unless there was a string returned.</span>
    <span class="comment">// So we can directly check it for success...</span>

    <span class="keywordflow">return</span> <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strReply);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6c441c50adc8c4327de016dbdfa9a28"></a><!-- doxytag: member="Utility::sendProcessNymboxLowLevel" ref="ad6c441c50adc8c4327de016dbdfa9a28" args="(const string &amp;serverID, const string &amp;nymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> int32_t <a class="el" href="class_utility.html#ad6c441c50adc8c4327de016dbdfa9a28">Utility::sendProcessNymboxLowLevel</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l01510">1510</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;Utility::sendProcessNymboxLowLevel&quot;</span>;

    <span class="comment">// Send message..</span>
    <a class="code" href="class_o_t_a_p_i___wrap.html#a06b125c1d2e4141e1e875349ae570981">OTAPI_Wrap::FlushMessageBuffer</a>();

    int32_t nRequestNum = <a class="code" href="class_utility.html#ac88672f5fd7f460fa467476a71f30371">OTAPI_Wrap::processNymbox</a>(serverID, nymID);
    <span class="keywordflow">if</span> (-1 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure sending. OT_API_processNymbox() returned -1. \n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// no need to check for any reply.</span>
    } <span class="comment">// ------------------------------------------</span>
    <span class="keywordflow">if</span> (nRequestNum &lt; 0)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: OT_API_processNymbox() returned unexpected value: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nRequestNum) + <span class="stringliteral">&quot;\n&quot;</span>);
        <span class="keywordflow">return</span> -1; <span class="comment">// no need to check for any reply.</span>
    } <span class="comment">// ------------------------------------------</span>
    <span class="keywordflow">if</span> (0 == nRequestNum)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Nymbox was empty; no need to process it. \n&quot;</span>);
        <span class="keywordflow">return</span> 0; <span class="comment">// Nymbox is empty, thus no need to process it.</span>
    }

    <span class="comment">// Note: I do NOT call RemoveSentMessage for processNymbox, at least, not here.</span>
    <span class="comment">// Instead, the place that CALLS this function, will actually use that because</span>
    <span class="comment">// it has to be able to harvest the transaction numbers in certain failure cases.</span>

    <span class="keywordflow">return</span> nRequestNum;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab5bdca5dc8f916c2daa50c791ffcdfb1"></a><!-- doxytag: member="Utility::setLastReplyReceived" ref="ab5bdca5dc8f916c2daa50c791ffcdfb1" args="(const string &amp;strReply)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void <a class="el" href="class_utility.html#ab5bdca5dc8f916c2daa50c791ffcdfb1">Utility::setLastReplyReceived</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>strReply</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00578">578</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_utility.html#a00936996be8e795003e5e57149446114">strLastReplyReceived</a> = strReply;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a86d6326e062a59eca23cf597a8a11900"></a><!-- doxytag: member="Utility::setNbrTransactionCount" ref="a86d6326e062a59eca23cf597a8a11900" args="(int32_t new_trans_dl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ot__utility__ot_8hpp.html#a7401343b9dc8882cfa686264480c8f06">OT_UTILITY_OT</a> void <a class="el" href="class_utility.html#a86d6326e062a59eca23cf597a8a11900">Utility::setNbrTransactionCount</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>new_trans_dl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8cpp_source.html#l00568">568</a> of file <a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_utility.html#abf88910f56716fb9ddf3c991af073216">max_trans_dl</a> = new_trans_dl;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a55f9ff8ceb056a8fe95ec1ed5e4e3399"></a><!-- doxytag: member="Utility::delay_ms" ref="a55f9ff8ceb056a8fe95ec1ed5e4e3399" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_utility.html#a55f9ff8ceb056a8fe95ec1ed5e4e3399">Utility::delay_ms</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8hpp_source.html#l00063">63</a> of file <a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="abf88910f56716fb9ddf3c991af073216"></a><!-- doxytag: member="Utility::max_trans_dl" ref="abf88910f56716fb9ddf3c991af073216" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_utility.html#abf88910f56716fb9ddf3c991af073216">Utility::max_trans_dl</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8hpp_source.html#l00064">64</a> of file <a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a00936996be8e795003e5e57149446114"></a><!-- doxytag: member="Utility::strLastReplyReceived" ref="a00936996be8e795003e5e57149446114" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string <a class="el" href="class_utility.html#a00936996be8e795003e5e57149446114">Utility::strLastReplyReceived</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ot__utility__ot_8hpp_source.html#l00062">62</a> of file <a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otapi/<a class="el" href="ot__utility__ot_8hpp_source.html">ot_utility_ot.hpp</a></li>
<li>src/otapi/<a class="el" href="ot__utility__ot_8cpp_source.html">ot_utility_ot.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_utility.html">Utility</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:17 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
