<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otlib/OTItem.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_o_t_item_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otlib/OTItem.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_o_t_item_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *    </span>
<a name="l00003"></a>00003 <span class="comment"> *  OTItem.cpp</span>
<a name="l00004"></a>00004 <span class="comment"> *  </span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00009"></a>00009 <span class="comment"> Hash: SHA1</span>
<a name="l00010"></a>00010 <span class="comment"> </span>
<a name="l00011"></a>00011 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00014"></a>00014 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00017"></a>00017 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> *  EMAIL:</span>
<a name="l00027"></a>00027 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00032"></a>00032 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00035"></a>00035 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00036"></a>00036 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> *  WEBSITE:</span>
<a name="l00039"></a>00039 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *  Components and licensing:</span>
<a name="l00042"></a>00042 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00043"></a>00043 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00048"></a>00048 <span class="comment"> *</span>
<a name="l00049"></a>00049 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00050"></a>00050 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00051"></a>00051 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00052"></a>00052 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *   LICENSE:</span>
<a name="l00057"></a>00057 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00058"></a>00058 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00059"></a>00059 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00060"></a>00060 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00061"></a>00061 <span class="comment"> *   option) any later version.</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00064"></a>00064 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00065"></a>00065 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00066"></a>00066 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00067"></a>00067 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00068"></a>00068 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00069"></a>00069 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00070"></a>00070 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00071"></a>00071 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00072"></a>00072 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00073"></a>00073 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00074"></a>00074 <span class="comment"> *</span>
<a name="l00075"></a>00075 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00076"></a>00076 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00077"></a>00077 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00078"></a>00078 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00079"></a>00079 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00080"></a>00080 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00081"></a>00081 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00082"></a>00082 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00083"></a>00083 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00084"></a>00084 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *   Lucre License:</span>
<a name="l00087"></a>00087 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00088"></a>00088 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00089"></a>00089 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00090"></a>00090 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00091"></a>00091 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00092"></a>00092 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00093"></a>00093 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00094"></a>00094 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00095"></a>00095 <span class="comment"> *   will continue to operate.</span>
<a name="l00096"></a>00096 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00097"></a>00097 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00098"></a>00098 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00099"></a>00099 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00100"></a>00100 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00101"></a>00101 <span class="comment"> *</span>
<a name="l00102"></a>00102 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00103"></a>00103 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00104"></a>00104 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00105"></a>00105 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00106"></a>00106 <span class="comment"> *</span>
<a name="l00107"></a>00107 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00108"></a>00108 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00109"></a>00109 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00110"></a>00110 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00111"></a>00111 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00112"></a>00112 <span class="comment"> *   more details.</span>
<a name="l00113"></a>00113 <span class="comment"> </span>
<a name="l00114"></a>00114 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00115"></a>00115 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00116"></a>00116 <span class="comment"> </span>
<a name="l00117"></a>00117 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00118"></a>00118 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00119"></a>00119 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00120"></a>00120 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00121"></a>00121 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00122"></a>00122 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00123"></a>00123 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00124"></a>00124 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00125"></a>00125 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00126"></a>00126 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00127"></a>00127 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00128"></a>00128 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00129"></a>00129 <span class="comment"> =uSzz</span>
<a name="l00130"></a>00130 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00131"></a>00131 <span class="comment"> **************************************************************/</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_item_8hpp.html">OTItem.hpp</a>&gt;</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_log_8hpp.html">OTLog.hpp</a>&gt;</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_pseudonym_8hpp.html">OTPseudonym.hpp</a>&gt;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_account_8hpp.html">OTAccount.hpp</a>&gt;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_ledger_8hpp.html">OTLedger.hpp</a>&gt;</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_cheque_8hpp.html">OTCheque.hpp</a>&gt;</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="preprocessor">#include &quot;irrxml/irrXML.hpp&quot;</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">// Server-side.</span>
<a name="l00146"></a>00146 <span class="comment">//</span>
<a name="l00147"></a>00147 <span class="comment">// By the time this is called, I know that the item, AND this balance item (this)</span>
<a name="l00148"></a>00148 <span class="comment">// both have the correct user id, server id, account id, and transaction id, and</span>
<a name="l00149"></a>00149 <span class="comment">// they have been signed properly by the owner.</span>
<a name="l00150"></a>00150 <span class="comment">//</span>
<a name="l00151"></a>00151 <span class="comment">// So what do I need to verify in this function?</span>
<a name="l00152"></a>00152 <span class="comment">//</span>
<a name="l00153"></a>00153 <span class="comment">// -- That the transactions on THE_NYM (server-side), minus the current transaction number being processed,</span>
<a name="l00154"></a>00154 <span class="comment">//    are all still there.</span>
<a name="l00155"></a>00155 <span class="comment">// -- If theMessageNym is missing certain numbers that I expected to find on him, that means he is trying to</span>
<a name="l00156"></a>00156 <span class="comment">//    trick the server into signing a new agreement where he is no longer responsible for those numbers. They must</span>
<a name="l00157"></a>00157 <span class="comment">//    all be there.</span>
<a name="l00158"></a>00158 <span class="comment">// -- If theMessageNym has ADDED certain numbers that I DIDN&#39;T expect to find on him, then he&#39;s trying to trick</span>
<a name="l00159"></a>00159 <span class="comment">//    me into allowing him to add those numbers to his receipt -- OR it could mean that certain numbers were already</span>
<a name="l00160"></a>00160 <span class="comment">//    removed on my side (such as the opening # for a cron item like a market offer that has already been closed),</span>
<a name="l00161"></a>00161 <span class="comment">//    but the client-side isn&#39;t aware of this yet, and so he is trying to sign off on formerly-good numbers that</span>
<a name="l00162"></a>00162 <span class="comment">//    have since expired.  This shouldn&#39;t happen IF the client has been properly notified about these numbers before</span>
<a name="l00163"></a>00163 <span class="comment">//    sending his request.  Such notifications are dropped into the Nymbox AND related asset account inboxes.</span>
<a name="l00164"></a>00164 <span class="comment">//</span>
<a name="l00165"></a><a class="code" href="class_o_t_item.html#a7df2f7973839d7a270f6ea8de67d07b4">00165</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_item.html#a7df2f7973839d7a270f6ea8de67d07b4">OTItem::VerifyTransactionStatement</a>(<a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp; THE_NYM,  <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; TARGET_TRANSACTION,
<a name="l00166"></a>00166                                         <span class="keyword">const</span> <span class="keywordtype">bool</span> bIsRealTransaction<span class="comment">/*=true*/</span>) <span class="comment">// Sometimes the trans# is 0 (like when processing Nymbox)</span>
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">OTItem::transactionStatement</a>)
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: wrong item type. Expected OTItem::transactionStatement.\n&quot;</span>, __FUNCTION__);
<a name="l00171"></a>00171         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     
<a name="l00174"></a>00174     <span class="comment">//</span>
<a name="l00175"></a>00175     <span class="comment">// So if the caller was planning to remove a number, or clear a receipt from the inbox, he&#39;ll have to do</span>
<a name="l00176"></a>00176     <span class="comment">// so first before calling this function, and then ADD IT AGAIN if this function fails.  (Because the new</span>
<a name="l00177"></a>00177     <span class="comment">// Balance Agreement is always the user signing WHAT THE NEW VERSION WILL BE AFTER THE TRANSACTION IS PROCESSED.)</span>
<a name="l00178"></a>00178     <span class="comment">//</span>
<a name="l00179"></a>00179     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> SERVER_ID(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theRemovedNym;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (bIsRealTransaction) <span class="comment">// Sometimes my &quot;transaction number&quot; is 0 since we&#39;re accepting numbers from the Nymbox (which is done by message, not transaction.)</span>
<a name="l00184"></a>00184     {                       <span class="comment">//  In such cases, there&#39;s no point in checking the server-side to &quot;make sure it has number 0!&quot; (because it won&#39;t.)</span>
<a name="l00185"></a>00185         <span class="keywordtype">bool</span> bIWasFound = THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(SERVER_ID, <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00186"></a>00186         
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (!bIWasFound)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Transaction# (%lld) doesn&#39;t appear on Nym&#39;s issued list.\n&quot;</span>, 
<a name="l00190"></a>00190                            __FUNCTION__, <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00191"></a>00191             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="comment">// In the case that this is a real transaction, it must be a cancelCronItem, payment plan or </span>
<a name="l00195"></a>00195         <span class="comment">// market offer (since the other transaction types require a balance statement, not a transaction</span>
<a name="l00196"></a>00196         <span class="comment">// statement.) Also this might not be a transaction at all, but in that case we won&#39;t enter this</span>
<a name="l00197"></a>00197         <span class="comment">// block anyway.</span>
<a name="l00198"></a>00198         <span class="comment">//</span>
<a name="l00199"></a>00199         <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l00200"></a>00200         {
<a name="l00201"></a>00201             <span class="comment">// In the case of cancelCronItem(), we&#39;d expect, if success, the number would be removed, so we have </span>
<a name="l00202"></a>00202             <span class="comment">// to remove it now, to simulate success for the verification. Then we add it again afterwards, before</span>
<a name="l00203"></a>00203             <span class="comment">// returning.</span>
<a name="l00204"></a>00204             <span class="comment">//</span>
<a name="l00205"></a>00205             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00206"></a>00206                 <span class="comment">// Only adding it to theRemovedNym here since VerifyIssuedNum() is called just above.</span>
<a name="l00207"></a>00207                 <span class="comment">// (Don&#39;t want to &quot;add it back&quot; if it wasn&#39;t there in the first place!)</span>
<a name="l00208"></a>00208                 <span class="comment">//</span>
<a name="l00209"></a>00209                 <span class="keywordflow">if</span> (THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(SERVER_ID, this-&gt;GetTransactionNum())) <span class="comment">// doesn&#39;t save.</span>
<a name="l00210"></a>00210                     theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00211"></a>00211                 <span class="keywordflow">else</span>
<a name="l00212"></a>00212                     <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::VerifyTransactionStatemen: Expected THE_NYM to have trans# %lld but didn&#39;t find it.\n&quot;</span>,
<a name="l00213"></a>00213                                    this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00214"></a>00214                 <span class="keywordflow">break</span>;
<a name="l00215"></a>00215                 
<a name="l00216"></a>00216             <span class="comment">// IN the case of the offer/plan, we do NOT want to remove from issued list. That only happens when</span>
<a name="l00217"></a>00217             <span class="comment">// the plan or offer is removed from Cron and closed. As the plan or offer continues processing,</span>
<a name="l00218"></a>00218             <span class="comment">// the user is responsible for its main transaction number until he signs off on final closing,</span>
<a name="l00219"></a>00219             <span class="comment">// after many receipts have potentially been received.</span>
<a name="l00220"></a>00220             <span class="comment">//</span>
<a name="l00221"></a>00221             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00222"></a>00222             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00223"></a>00223             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00224"></a>00224 <span class="comment">//              THE_NYM.RemoveIssuedNum(SERVER_ID, this-&gt;GetTransactionNum()); // commented out, explained just above.</span>
<a name="l00225"></a>00225                 <span class="keywordflow">break</span>;
<a name="l00226"></a>00226             <span class="keywordflow">default</span>:
<a name="l00227"></a>00227                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTItem::VerifyTransactionStatement: Unexpected transaction type.\n&quot;</span>);
<a name="l00228"></a>00228                 <span class="keywordflow">break</span>;
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230         
<a name="l00231"></a>00231         <span class="comment">// Client side will NOT remove from issued list in this case (market offer, payment plan, which are</span>
<a name="l00232"></a>00232         <span class="comment">// the only transactions that use a transactionStatement, which is otherwise used for Nymbox.)</span>
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234     
<a name="l00235"></a>00235     <span class="comment">// ----------------------------------------------------</span>
<a name="l00236"></a>00236     <span class="comment">//</span>
<a name="l00237"></a>00237     <span class="comment">// VERIFY that the Nyms have a matching list of transaction numbers...</span>
<a name="l00238"></a>00238     
<a name="l00239"></a>00239     <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <a class="code" href="class_o_t_string.html">OTString</a>    strMessageNym; 
<a name="l00242"></a>00242     
<a name="l00243"></a>00243     this-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strMessageNym);
<a name="l00244"></a>00244     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym;
<a name="l00245"></a>00245     
<a name="l00246"></a>00246     <span class="comment">// ----------------------</span>
<a name="l00247"></a>00247         
<a name="l00248"></a>00248     <span class="keywordflow">if</span> ((strMessageNym.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2) &amp;&amp; theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strMessageNym))
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250         <span class="comment">// If success, I know the server-side copy of the user&#39;s Nym (THE_NYM) has the same number</span>
<a name="l00251"></a>00251         <span class="comment">// of transactions as the message nym, and that EVERY ONE OF THEM was found individually.</span>
<a name="l00252"></a>00252         <span class="comment">//</span>
<a name="l00253"></a>00253         bSuccess = THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a813cb5746e0f8461beca3c77f9f7457c" title="See if two nyms have identical lists of issued transaction numbers (#s currently signed for...">VerifyIssuedNumbersOnNym</a>(theMessageNym); <span class="comment">// &lt;==== ************************************</span>
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">// NOW let&#39;s set things back how they were before, so we can RETURN.</span>
<a name="l00258"></a>00258     <span class="comment">//</span>
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (bIsRealTransaction)
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261         <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00264"></a>00264                 <span class="comment">// Should only actually iterate once, in this case.</span>
<a name="l00265"></a>00265                 <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()); i++) 
<a name="l00266"></a>00266                 {
<a name="l00267"></a>00267                     int64_t lTemp = theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), i);
<a name="l00268"></a>00268                     
<a name="l00269"></a>00269                     <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00270"></a>00270                         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTItem::VerifyTransactionStatement: THIS SHOULD NOT HAPPEN.\n&quot;</span>);
<a name="l00271"></a>00271                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, lTemp)) <span class="comment">// doesn&#39;t save.</span>
<a name="l00272"></a>00272                         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Failed adding issued number back to THE_NYM in OTItem::VerifyTransactionStatement.\n&quot;</span>);
<a name="l00273"></a>00273                 }
<a name="l00274"></a>00274                 <span class="keywordflow">break</span>;
<a name="l00275"></a>00275                 
<a name="l00276"></a>00276             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00277"></a>00277             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00278"></a>00278             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00279"></a>00279             <span class="keywordflow">default</span>:
<a name="l00280"></a>00280 <span class="comment">//              THE_NYM.RemoveIssuedNum(SERVER_ID, this-&gt;GetTransactionNum()); // commented out, explained just above.</span>
<a name="l00281"></a>00281                 <span class="keywordflow">break</span>;
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     
<a name="l00285"></a>00285     <span class="comment">// Might want to consider saving the Nym here.</span>
<a name="l00286"></a>00286     <span class="comment">// Also want to save the latest signed receipt, since it VERIFIES.</span>
<a name="l00287"></a>00287     <span class="comment">// Or maybe let caller decide?</span>
<a name="l00288"></a>00288     
<a name="l00289"></a>00289     <span class="keywordflow">return</span> bSuccess;
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">// Server-side.</span>
<a name="l00294"></a>00294 <span class="comment">//</span>
<a name="l00295"></a>00295 <span class="comment">// By the time this is called, I know that the item, AND this balance item (this)</span>
<a name="l00296"></a>00296 <span class="comment">// both have the correct user id, server id, account id, and transaction id, and</span>
<a name="l00297"></a>00297 <span class="comment">// they have been signed properly by the owner.</span>
<a name="l00298"></a>00298 <span class="comment">//</span>
<a name="l00299"></a>00299 <span class="comment">// So what do I need to verify in this function?</span>
<a name="l00300"></a>00300 <span class="comment">//</span>
<a name="l00301"></a>00301 <span class="comment">// 1) That THE_ACCOUNT.GetBalance() + lActualAdjustment equals the amount in this-&gt;GetAmount().</span>
<a name="l00302"></a>00302 <span class="comment">//</span>
<a name="l00303"></a>00303 <span class="comment">// 2) That the inbox transactions and outbox transactions match up to the list of sub-items</span>
<a name="l00304"></a>00304 <span class="comment">//    on THIS balance item.</span>
<a name="l00305"></a>00305 <span class="comment">//</span>
<a name="l00306"></a>00306 <span class="comment">// 3) That the transactions on the Nym, minus the current transaction number being processed,</span>
<a name="l00307"></a>00307 <span class="comment">//    are all still there.</span>
<a name="l00308"></a>00308 <span class="comment">//</span>
<a name="l00309"></a><a class="code" href="class_o_t_item.html#a343a0c7a7a05ef4dade448cd551547ea">00309</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_item.html#a343a0c7a7a05ef4dade448cd551547ea">OTItem::VerifyBalanceStatement</a>(<span class="keyword">const</span> int64_t lActualAdjustment, 
<a name="l00310"></a>00310                                     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp; THE_NYM,
<a name="l00311"></a>00311                                     <a class="code" href="class_o_t_ledger.html">OTLedger</a> &amp; THE_INBOX,
<a name="l00312"></a>00312                                     <a class="code" href="class_o_t_ledger.html">OTLedger</a> &amp; THE_OUTBOX,
<a name="l00313"></a>00313                                     <span class="keyword">const</span> <a class="code" href="class_o_t_account.html">OTAccount</a> &amp; THE_ACCOUNT,
<a name="l00314"></a>00314                                     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; TARGET_TRANSACTION,
<a name="l00315"></a>00315                                     <span class="keyword">const</span> int64_t lOutboxTrnsNum<span class="comment">/*=0*/</span>) <span class="comment">// Only used in the case of transfer, where the user    </span>
<a name="l00316"></a>00316 {                                                                       <span class="comment">// doesn&#39;t know the outbox trans# in advance, so he sends</span>
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>)                          <span class="comment">// a dummy number (currently &#39;1&#39;) which we verify against</span>
<a name="l00318"></a>00318     {                                                                   <span class="comment">// the actual outbox trans# successfully, only in that special case.</span>
<a name="l00319"></a>00319         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: wrong item type.\n&quot;</span>,  __FUNCTION__);
<a name="l00320"></a>00320         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322     
<a name="l00323"></a>00323     <span class="comment">// We need to verify:</span>
<a name="l00324"></a>00324     <span class="comment">//</span>
<a name="l00325"></a>00325     <span class="comment">// 1) That THE_ACCOUNT.GetBalance() + lActualAdjustment equals the amount in this-&gt;GetAmount().</span>
<a name="l00326"></a>00326     
<a name="l00327"></a>00327     <span class="keywordflow">if</span> ((THE_ACCOUNT.<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() + lActualAdjustment) != this-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>()) <span class="comment">// this-&gt;GetAmount() contains what the balance WOULD be AFTER successful transaction.</span>
<a name="l00328"></a>00328     {
<a name="l00329"></a>00329         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: This balance statement has a value of %lld, but expected %lld. &quot;</span>
<a name="l00330"></a>00330                        <span class="stringliteral">&quot;(Acct balance of %lld plus actualAdjustment of %lld.)\n&quot;</span>, __FUNCTION__,
<a name="l00331"></a>00331                        this-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(), (THE_ACCOUNT.<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() + lActualAdjustment), 
<a name="l00332"></a>00332                        THE_ACCOUNT.<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>(), lActualAdjustment);
<a name="l00333"></a>00333         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     
<a name="l00336"></a>00336     <span class="comment">// 2) That the inbox transactions and outbox transactions match up to the list of sub-items</span>
<a name="l00337"></a>00337     <span class="comment">//    on THIS balance item.</span>
<a name="l00338"></a>00338     
<a name="l00339"></a>00339     int32_t nInboxItemCount = 0, nOutboxItemCount = 0;
<a name="l00340"></a>00340     
<a name="l00341"></a>00341     <span class="keyword">const</span> <span class="keywordtype">char</span> * szInbox  = <span class="stringliteral">&quot;Inbox&quot;</span>;
<a name="l00342"></a>00342     <span class="keyword">const</span> <span class="keywordtype">char</span> * szOutbox = <span class="stringliteral">&quot;Outbox&quot;</span>;
<a name="l00343"></a>00343     
<a name="l00344"></a>00344     <span class="keyword">const</span> <span class="keywordtype">char</span> * pszLedgerType = NULL;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="comment">//  OTLog::vOutput(1, &quot;OTItem::VerifyBalanceStatement: (ENTERING LOOP)... INBOX COUNT: %d\n&quot;</span>
<a name="l00347"></a>00347 <span class="comment">//                   &quot;# of inbox/outbox items on this balance statement: %d\n&quot;,</span>
<a name="l00348"></a>00348 <span class="comment">//                   THE_INBOX.GetTransactionCount(), this-&gt;GetItemCount());</span>
<a name="l00349"></a>00349     
<a name="l00350"></a>00350     <span class="keywordflow">for</span> (int32_t i=0; i &lt; this-&gt;<a class="code" href="class_o_t_item.html#a67cec1836d8607311227b2526b0ec4f5">GetItemCount</a>(); i++)
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <a class="code" href="class_o_t_item.html">OTItem</a> * pSubItem = this-&gt;<a class="code" href="class_o_t_item.html#a3db78fb28bf4d93b477a382b900a45ca">GetItem</a>(i);
<a name="l00353"></a>00353         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pSubItem);
<a name="l00354"></a>00354 <span class="comment">//      OTLog::Output(1, &quot;OTItem::VerifyBalanceStatement: TOP OF LOOP (through sub-items).......\n&quot;);</span>
<a name="l00355"></a>00355         
<a name="l00356"></a>00356         int64_t lReceiptAmountMultiplier = 1; <span class="comment">// needed for outbox items.</span>
<a name="l00357"></a>00357         
<a name="l00358"></a>00358         <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = NULL;
<a name="l00359"></a>00359         
<a name="l00360"></a>00360         <span class="keywordflow">switch</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
<a name="l00361"></a>00361         {
<a name="l00362"></a>00362             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:
<a name="l00363"></a>00363             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>:
<a name="l00364"></a>00364             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>:
<a name="l00365"></a>00365             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:
<a name="l00366"></a>00366             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>: 
<a name="l00367"></a>00367             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>: 
<a name="l00368"></a>00368             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>: 
<a name="l00369"></a>00369                 nInboxItemCount++;
<a name="l00370"></a>00370                 pLedger = &amp;THE_INBOX;
<a name="l00371"></a>00371                 pszLedgerType = szInbox;
<a name="l00372"></a>00372                 
<a name="l00373"></a>00373 <span class="comment">//              OTLog::Output(1, &quot;OTItem::VerifyBalanceStatement: Subitem is Inbox receipt item (NOT pending transfer)....\n&quot;);</span>
<a name="l00374"></a>00374 
<a name="l00375"></a>00375             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>:
<a name="l00376"></a>00376                 <span class="keywordflow">break</span>;
<a name="l00377"></a>00377             <span class="keywordflow">default</span>:
<a name="l00378"></a>00378             {
<a name="l00379"></a>00379                 <a class="code" href="class_o_t_string.html">OTString</a> strItemType;
<a name="l00380"></a>00380                 <a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strItemType);
<a name="l00381"></a>00381                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OTItem::%s: Ignoring %s item in balance statement while verifying it against inbox.\n&quot;</span>,
<a name="l00382"></a>00382                                __FUNCTION__, strItemType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00383"></a>00383             }               
<a name="l00384"></a>00384                 <span class="keywordflow">continue</span>;
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         
<a name="l00387"></a>00387         <span class="keywordflow">switch</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
<a name="l00388"></a>00388         {
<a name="l00389"></a>00389             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>:
<a name="l00390"></a>00390                 <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>() &lt; 0) <span class="comment">// it&#39;s an outbox item</span>
<a name="l00391"></a>00391                 {
<a name="l00392"></a>00392 <span class="comment">//                  OTLog::Output(1, &quot;OTItem::VerifyBalanceStatement: Subitem is pending transfer (in outbox)....\n&quot;);</span>
<a name="l00393"></a>00393                     
<a name="l00394"></a>00394                     lReceiptAmountMultiplier = -1; <span class="comment">// transfers out always reduce your balance.</span>
<a name="l00395"></a>00395                     nOutboxItemCount++;
<a name="l00396"></a>00396                     pLedger = &amp;THE_OUTBOX;
<a name="l00397"></a>00397                     pszLedgerType = szOutbox;
<a name="l00398"></a>00398                 }
<a name="l00399"></a>00399                 <span class="keywordflow">else</span>
<a name="l00400"></a>00400                 {
<a name="l00401"></a>00401 <span class="comment">//                  OTLog::Output(1, &quot;OTItem::VerifyBalanceStatement: Subitem is pending transfer (in inbox)....\n&quot;);</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                     lReceiptAmountMultiplier = 1; <span class="comment">// transfers in always increase your balance.</span>
<a name="l00404"></a>00404                     nInboxItemCount++;
<a name="l00405"></a>00405                     pLedger = &amp;THE_INBOX;
<a name="l00406"></a>00406                     pszLedgerType = szInbox;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408                 <span class="keywordflow">break</span>;
<a name="l00409"></a>00409             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>:
<a name="l00410"></a>00410                 <span class="comment">// Here: If there is a finalReceipt on this balance statement, then ALL the other</span>
<a name="l00411"></a>00411                 <span class="comment">// related receipts in the inbox (with same &quot;reference to&quot; value) had better ALSO</span>
<a name="l00412"></a>00412                 <span class="comment">// be on the same balance statement!</span>
<a name="l00413"></a>00413                 
<a name="l00414"></a>00414                 <span class="comment">// HMM that is true, but NOT HERE... That&#39;s only true when PROCESSING the final Receipt</span>
<a name="l00415"></a>00415                 <span class="comment">// from the inbox (in that case, all the marketReceipts must also be processed with it.)</span>
<a name="l00416"></a>00416                 <span class="comment">// But here, I am looping through the inbox report, and there happens to be a finalReceipt</span>
<a name="l00417"></a>00417                 <span class="comment">// on it. (Which doesn&#39;t mean necessarily that it&#39;s being processed out...)</span>
<a name="l00418"></a>00418             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>:
<a name="l00419"></a>00419                 
<a name="l00420"></a>00420             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>: 
<a name="l00421"></a>00421             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:
<a name="l00422"></a>00422             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>:
<a name="l00423"></a>00423             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>:
<a name="l00424"></a>00424             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:
<a name="l00425"></a>00425                 lReceiptAmountMultiplier = 1;
<a name="l00426"></a>00426                 <span class="keywordflow">break</span>;
<a name="l00427"></a>00427             <span class="keywordflow">default</span>:
<a name="l00428"></a>00428                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: Bad Subitem type (SHOULD NEVER HAPPEN)....\n&quot;</span>,  __FUNCTION__);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                 <span class="keywordflow">continue</span>; <span class="comment">// This will never happen, due to the first continue above in the first switch.</span>
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432         
<a name="l00433"></a>00433         <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l00434"></a>00434         
<a name="l00435"></a>00435         <span class="comment">// In the special case of account transfer, the user has put an outbox transaction</span>
<a name="l00436"></a>00436         <span class="comment">// into his balance agreement with the special number &#39;1&#39;, since he has no idea what</span>
<a name="l00437"></a>00437         <span class="comment">// actual number will be generated on the server side (for the outbox) when his</span>
<a name="l00438"></a>00438         <span class="comment">// message is received by the server.</span>
<a name="l00439"></a>00439         <span class="comment">//</span>
<a name="l00440"></a>00440         <span class="comment">// When that happens (ONLY in account transfer) then lOutboxTrnsNum will be passed</span>
<a name="l00441"></a>00441         <span class="comment">// in with the new transaction number chosen by the server (a real number, like 18736</span>
<a name="l00442"></a>00442         <span class="comment">// or whatever, instead of the default of 0 that will otherwise be passed in here.)</span>
<a name="l00443"></a>00443         <span class="comment">//</span>
<a name="l00444"></a>00444         <span class="comment">// Therefore, if lOutboxTrnsNum is larger than 0, AND if we&#39;re on an outbox item,</span>
<a name="l00445"></a>00445         <span class="comment">// then we can expect lOutboxTrnsNum to contain an actual transaction number, and</span>
<a name="l00446"></a>00446         <span class="comment">// we can expect there is a CHANCE that the sub-item will be trans# 1. (It might</span>
<a name="l00447"></a>00447         <span class="comment">// NOT be number 1, since there may be other outbox items-we&#39;re looping through them</span>
<a name="l00448"></a>00448         <span class="comment">// right now in this block.) So we&#39;ll check to see if this is the &#39;1&#39; and if so,</span>
<a name="l00449"></a>00449         <span class="comment">// we&#39;ll look up pTransaction from the outbox using the real transaction number,</span>
<a name="l00450"></a>00450         <span class="comment">// instead of &#39;1&#39; which of course would not find it (since the version in the ledger</span>
<a name="l00451"></a>00451         <span class="comment">// contains the ACTUAL number now, since the server just issued it.)</span>
<a name="l00452"></a>00452         <span class="comment">//</span>
<a name="l00453"></a>00453         <span class="keywordflow">if</span> ((lOutboxTrnsNum &gt; 0) &amp;&amp; (&amp;THE_OUTBOX == pLedger) &amp;&amp; (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() == 1)) <span class="comment">// TODO use a constant for this 1.</span>
<a name="l00454"></a>00454         {
<a name="l00455"></a>00455             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;OTItem::%s: Subitem is new Outbox Transaction... retrieving by special ID: %lld\n&quot;</span>,
<a name="l00456"></a>00456                            __FUNCTION__, lOutboxTrnsNum);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458             pTransaction = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lOutboxTrnsNum);         
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460         <span class="keywordflow">else</span>
<a name="l00461"></a>00461         {
<a name="l00462"></a>00462             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;OTItem::%s: Subitem is normal Transaction... retrieving by ID: %lld\n&quot;</span>,
<a name="l00463"></a>00463                             __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00464"></a>00464             
<a name="l00465"></a>00465             pTransaction = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467         <span class="comment">// -----------------------------------------------------------------</span>
<a name="l00468"></a>00468         <span class="comment">// Make sure that the transaction number of each sub-item is found</span>
<a name="l00469"></a>00469         <span class="comment">// on the appropriate ledger (inbox or outbox).</span>
<a name="l00470"></a>00470         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l00471"></a>00471         {
<a name="l00472"></a>00472             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: Expected %s transaction (serv %lld, client %lld) &quot;</span>
<a name="l00473"></a>00473                            <span class="stringliteral">&quot;not found. (Amount %lld.)\n&quot;</span>, __FUNCTION__,
<a name="l00474"></a>00474                            pszLedgerType, lOutboxTrnsNum, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), 
<a name="l00475"></a>00475                            pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
<a name="l00476"></a>00476             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         <span class="comment">// pTransaction is set below this point.</span>
<a name="l00479"></a>00479         <span class="comment">// -----------------------------------------------------------------</span>
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>())
<a name="l00481"></a>00481         {
<a name="l00482"></a>00482             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) mismatch Reference Num: %lld, expected %lld\n&quot;</span>,
<a name="l00483"></a>00483                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l00484"></a>00484                            pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l00485"></a>00485             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487         <span class="comment">// -----------------------------------------------------------------</span>
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>())
<a name="l00489"></a>00489         {
<a name="l00490"></a>00490             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) mismatch Origin Num: %lld, expected %lld\n&quot;</span>,
<a name="l00491"></a>00491                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l00492"></a>00492                            pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(), pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>());
<a name="l00493"></a>00493             
<a name="l00494"></a>00494             <span class="comment">// THE BELOW STUFF IS JUST FOR DEBUGGING PURPOSES.</span>
<a name="l00495"></a>00495             <span class="comment">// ERASE IT.</span>
<a name="l00496"></a>00496             
<a name="l00497"></a>00497             <span class="comment">/*</span>
<a name="l00498"></a>00498 <span class="comment">            OTString strTempType;</span>
<a name="l00499"></a>00499 <span class="comment">            pSubItem-&gt;GetTypeString(strTempType);</span>
<a name="l00500"></a>00500 <span class="comment">            </span>
<a name="l00501"></a>00501 <span class="comment">            int64_t lTempAmount = pSubItem-&gt;GetAmount();</span>
<a name="l00502"></a>00502 <span class="comment">                        </span>
<a name="l00503"></a>00503 <span class="comment">            OTIdentifier ACCOUNT_ID, SERVER_ID, USER_ID;</span>
<a name="l00504"></a>00504 <span class="comment">            </span>
<a name="l00505"></a>00505 <span class="comment">            ACCOUNT_ID = pSubItem-&gt;GetPurportedAccountID();</span>
<a name="l00506"></a>00506 <span class="comment">            SERVER_ID  = pSubItem-&gt;GetPurportedServerID();</span>
<a name="l00507"></a>00507 <span class="comment">            USER_ID    = pSubItem-&gt;GetUserID();</span>
<a name="l00508"></a>00508 <span class="comment">            </span>
<a name="l00509"></a>00509 <span class="comment">            const OTString strAccountID(ACCOUNT_ID), strServerID(SERVER_ID), strUserID(USER_ID);</span>
<a name="l00510"></a>00510 <span class="comment">            // --------------------</span>
<a name="l00511"></a>00511 <span class="comment"></span>
<a name="l00512"></a>00512 <span class="comment">            int64_t lTempNumOfOrigin = pSubItem-&gt;GetNumberOfOrigin();</span>
<a name="l00513"></a>00513 <span class="comment">            int64_t lTempTransNum    = pSubItem-&gt;GetTransactionNum();</span>
<a name="l00514"></a>00514 <span class="comment">            int64_t lTempRefNum      = pSubItem-&gt;GetReferenceToNum();</span>
<a name="l00515"></a>00515 <span class="comment">            int64_t lTempClosingNum  = pSubItem-&gt;GetClosingNum();</span>
<a name="l00516"></a>00516 <span class="comment">            </span>
<a name="l00517"></a>00517 <span class="comment">            </span>
<a name="l00518"></a>00518 <span class="comment">            const OTString strTrans(*pTransaction);</span>
<a name="l00519"></a>00519 <span class="comment">            OTLog::vOutput(0, &quot;OTItem::%s: %s transaction (%lld) mismatch Origin Num: %lld, expected %lld\n\nTRANSACTION:\n%s\n\n&quot;</span>
<a name="l00520"></a>00520 <span class="comment">                           &quot;SubItem Type: %s  Amount: %lld\nAccount: %s\nServer: %s\nUser: %s\n&quot;</span>
<a name="l00521"></a>00521 <span class="comment">                           &quot; Number of Origin: %lld\n Transaction Num: %lld\n In Reference To: %lld\n Closing Num: %d\n&quot;,</span>
<a name="l00522"></a>00522 <span class="comment">                           __FUNCTION__, pszLedgerType, pSubItem-&gt;GetTransactionNum(),</span>
<a name="l00523"></a>00523 <span class="comment">                           pSubItem-&gt;GetRawNumberOfOrigin(), pTransaction-&gt;GetRawNumberOfOrigin(),</span>
<a name="l00524"></a>00524 <span class="comment">                           strTrans.Get(),</span>
<a name="l00525"></a>00525 <span class="comment">                           strTempType.Get(), lTempAmount, strAccountID.Get(), strServerID.Get(), strUserID.Get(),</span>
<a name="l00526"></a>00526 <span class="comment">                           lTempNumOfOrigin, lTempTransNum, lTempRefNum, lTempClosingNum</span>
<a name="l00527"></a>00527 <span class="comment">                           );</span>
<a name="l00528"></a>00528 <span class="comment">             */</span>
<a name="l00529"></a>00529             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531         <span class="comment">// -----------------------------------------------------------</span>
<a name="l00532"></a>00532         int64_t lTransactionAmount   =  pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
<a name="l00533"></a>00533         lTransactionAmount      *=  lReceiptAmountMultiplier;
<a name="l00534"></a>00534         
<a name="l00535"></a>00535         <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>()   != lTransactionAmount)
<a name="l00536"></a>00536         {
<a name="l00537"></a>00537             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) &quot;</span>
<a name="l00538"></a>00538                            <span class="stringliteral">&quot;amounts don&#39;t match: report amount is %lld, but expected %lld. Trans Receipt Amt: %lld (this-&gt;GetAmount() == %lld.)\n&quot;</span>,
<a name="l00539"></a>00539                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l00540"></a>00540                            pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(), lTransactionAmount, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(),
<a name="l00541"></a>00541                            this-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
<a name="l00542"></a>00542             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544         
<a name="l00545"></a>00545         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>) &amp;&amp; 
<a name="l00546"></a>00546             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>))
<a name="l00547"></a>00547         {
<a name="l00548"></a>00548             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (transfer block)\n&quot;</span>,
<a name="l00549"></a>00549                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00550"></a>00550             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552         
<a name="l00553"></a>00553         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>) &amp;&amp;
<a name="l00554"></a>00554             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTTransaction::chequeReceipt</a>))
<a name="l00555"></a>00555         {
<a name="l00556"></a>00556             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (chequeReceipt block)\n&quot;</span>,
<a name="l00557"></a>00557                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00558"></a>00558             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560         
<a name="l00561"></a>00561         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>) &amp;&amp;
<a name="l00562"></a>00562             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTTransaction::voucherReceipt</a>))
<a name="l00563"></a>00563         {
<a name="l00564"></a>00564             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (voucherReceipt block)\n&quot;</span>,
<a name="l00565"></a>00565                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00566"></a>00566             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568         
<a name="l00569"></a>00569         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>) &amp;&amp;
<a name="l00570"></a>00570             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTTransaction::marketReceipt</a>))
<a name="l00571"></a>00571         {
<a name="l00572"></a>00572             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (marketReceipt block)\n&quot;</span>,
<a name="l00573"></a>00573                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00574"></a>00574             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576         
<a name="l00577"></a>00577         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>) &amp;&amp; 
<a name="l00578"></a>00578             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTTransaction::paymentReceipt</a>))
<a name="l00579"></a>00579         {
<a name="l00580"></a>00580             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (paymentReceipt block)\n&quot;</span>,
<a name="l00581"></a>00581                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00582"></a>00582             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>) &amp;&amp; 
<a name="l00586"></a>00586             (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTTransaction::transferReceipt</a>))
<a name="l00587"></a>00587         {
<a name="l00588"></a>00588             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type. (transferReceipt block)\n&quot;</span>,
<a name="l00589"></a>00589                            __FUNCTION__, pszLedgerType, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00590"></a>00590             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>) &amp;&amp; 
<a name="l00594"></a>00594             <span class="comment">// ------------------------------------------------------------</span>
<a name="l00595"></a>00595             ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTTransaction::basketReceipt</a>) ||
<a name="l00596"></a>00596              (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
<a name="l00597"></a>00597             )
<a name="l00598"></a>00598         {
<a name="l00599"></a>00599             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type or closing num (%lld). &quot;</span>
<a name="l00600"></a>00600                            <span class="stringliteral">&quot;(basketReceipt block)\n&quot;</span>, __FUNCTION__, pszLedgerType,
<a name="l00601"></a>00601                            pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>());
<a name="l00602"></a>00602             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00603"></a>00603         }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>) &amp;&amp; 
<a name="l00606"></a>00606             <span class="comment">// ------------------------------------------------------------</span>
<a name="l00607"></a>00607             ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTTransaction::finalReceipt</a>) ||
<a name="l00608"></a>00608              (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
<a name="l00609"></a>00609             )
<a name="l00610"></a>00610         {
<a name="l00611"></a>00611             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: %s transaction (%lld) wrong type or closing num (%lld). &quot;</span>
<a name="l00612"></a>00612                            <span class="stringliteral">&quot;(finalReceipt block)\n&quot;</span>, __FUNCTION__, pszLedgerType,
<a name="l00613"></a>00613                            pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>());
<a name="l00614"></a>00614             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     
<a name="l00619"></a>00619     <span class="comment">// By this point, I have an accurate count of the inbox items, and outbox items, represented</span>
<a name="l00620"></a>00620     <span class="comment">// by this. let&#39;s compare those counts to the actual inbox and outbox on my side:</span>
<a name="l00621"></a>00621     
<a name="l00622"></a>00622     <span class="keywordflow">if</span> ((nInboxItemCount    != THE_INBOX.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>()) || 
<a name="l00623"></a>00623         (nOutboxItemCount   != THE_OUTBOX.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>()))
<a name="l00624"></a>00624     {
<a name="l00625"></a>00625         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: Inbox or Outbox mismatch in expected transaction count.\n&quot;</span>
<a name="l00626"></a>00626                        <span class="stringliteral">&quot; --- THE_INBOX count: %d --- THE_OUTBOX count: %d\n&quot;</span>
<a name="l00627"></a>00627                        <span class="stringliteral">&quot;--- nInboxItemCount count: %d --- nOutboxItemCount count: %d\n\n&quot;</span>, 
<a name="l00628"></a>00628                        __FUNCTION__, THE_INBOX.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>(), THE_OUTBOX.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>(),
<a name="l00629"></a>00629                        nInboxItemCount, nOutboxItemCount);
<a name="l00630"></a>00630         
<a name="l00631"></a>00631         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633     
<a name="l00634"></a>00634     <span class="comment">// Now I KNOW that the inbox and outbox counts are the same, AND I know that EVERY transaction number</span>
<a name="l00635"></a>00635     <span class="comment">// on the balance item (this) was also found in the inbox or outbox, wherever it was expected to be found.</span>
<a name="l00636"></a>00636     <span class="comment">// I also know:</span>
<a name="l00637"></a>00637     <span class="comment">// the amount was correct, </span>
<a name="l00638"></a>00638     <span class="comment">// the &quot;in reference to&quot; number was correct, </span>
<a name="l00639"></a>00639     <span class="comment">// and the type was correct.</span>
<a name="l00640"></a>00640     <span class="comment">//</span>
<a name="l00641"></a>00641     <span class="comment">// So if the caller was planning to remove a number, or clear a receipt from the inbox, he&#39;ll have to do</span>
<a name="l00642"></a>00642     <span class="comment">// so first before calling this function, and then ADD IT AGAIN if this function fails.  (Because the new</span>
<a name="l00643"></a>00643     <span class="comment">// Balance Agreement is always the user signing WHAT THE NEW VERSION WILL BE AFTER THE TRANSACTION IS PROCESSED.</span>
<a name="l00644"></a>00644     <span class="comment">// Thus, if the transaction fails to process, the action hasn&#39;t really happened, so need to add it back again.)</span>
<a name="l00645"></a>00645     
<a name="l00646"></a>00646     <span class="comment">// ----------------------------------------------------------</span>
<a name="l00647"></a>00647     
<a name="l00648"></a>00648     <span class="comment">// 3) Also need to verify the transactions on the Nym, against the transactions stored on this</span>
<a name="l00649"></a>00649     <span class="comment">//    (in a message Nym attached to this.)  Check for presence of each, then compare count, like above.</span>
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theRemovedNym;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <a class="code" href="class_o_t_string.html">OTString</a> SERVER_ID(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
<a name="l00654"></a>00654     
<a name="l00655"></a>00655     <span class="comment">// GetTransactionNum() is the ID for this balance agreement, THUS it&#39;s also the ID</span>
<a name="l00656"></a>00656     <span class="comment">// for whatever actual transaction is being attempted. If that ID is not verified as</span>
<a name="l00657"></a>00657     <span class="comment">// on my issued list, then the whole transaction is invalid (not authorized.)</span>
<a name="l00658"></a>00658     <span class="comment">//</span>
<a name="l00659"></a>00659     <span class="keywordtype">bool</span> bIWasFound = THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(SERVER_ID, <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00660"></a>00660     
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (!bIWasFound)
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: Transaction has # that doesn&#39;t appear on Nym&#39;s issued list.\n&quot;</span>,
<a name="l00664"></a>00664                        __FUNCTION__);
<a name="l00665"></a>00665         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667     
<a name="l00668"></a>00668     <span class="comment">// BELOW THIS POINT, WE *KNOW* THE ISSUED NUM IS CURRENTLY ON THE LIST...</span>
<a name="l00669"></a>00669     <span class="comment">//</span>
<a name="l00670"></a>00670     <span class="comment">// (SO I CAN remove it and add it again, KNOWING that I&#39;m never re-adding a num that wasn&#39;t there in the first place.</span>
<a name="l00671"></a>00671     
<a name="l00672"></a>00672     <span class="comment">// For process inbox, deposit, and withdrawal, the client will remove from issued list as soon as he </span>
<a name="l00673"></a>00673     <span class="comment">// receives my acknowledgment OR rejection. He expects server (me) to remove, so he signs a balance</span>
<a name="l00674"></a>00674     <span class="comment">// agreement to that effect. (With the number removed from issued list.)</span>
<a name="l00675"></a>00675     <span class="comment">//</span>
<a name="l00676"></a>00676     <span class="comment">// Therefore, to verify the balance agreement, we remove it on our side as well, so that they will match.</span>
<a name="l00677"></a>00677     <span class="comment">// The picture thus formed is what would be correct assuming a successful transaction. That way if</span>
<a name="l00678"></a>00678     <span class="comment">// the transaction goes through, we have our signed receipt showing the new state of things (without</span>
<a name="l00679"></a>00679     <span class="comment">// which we would not permit the transaction to go through :)</span>
<a name="l00680"></a>00680     <span class="comment">//</span>
<a name="l00681"></a>00681     <span class="comment">// This allows the client side to then ACTUALLY remove the number when they receive our response,</span>
<a name="l00682"></a>00682     <span class="comment">// as well as permits me (server) to actually remove from issued list.</span>
<a name="l00683"></a>00683     <span class="comment">//</span>
<a name="l00684"></a>00684     <span class="comment">// If ANYTHING ELSE fails during this verify process (other than processInbox, deposit, and withdraw)</span>
<a name="l00685"></a>00685     <span class="comment">// then we have to ADD THE # AGAIN since we still don&#39;t have a valid signature on that number. So  </span>
<a name="l00686"></a>00686     <span class="comment">// you&#39;ll see this code repeated a few times in reverse, down inside this function. For example, </span>
<a name="l00687"></a>00687     <span class="comment">//  </span>
<a name="l00688"></a>00688     <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:
<a name="l00691"></a>00691         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:
<a name="l00692"></a>00692         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:
<a name="l00693"></a>00693         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:
<a name="l00694"></a>00694         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00695"></a>00695         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>:
<a name="l00696"></a>00696             <span class="comment">// We DID verify the issued num (above) but I&#39;m still just being safe here...</span>
<a name="l00697"></a>00697             <span class="comment">// ... since theRemovedNym contains numbers being re-added, just wanna make sure</span>
<a name="l00698"></a>00698             <span class="comment">// they were there in the first place.</span>
<a name="l00699"></a>00699             <span class="comment">//</span>
<a name="l00700"></a>00700             <span class="keywordflow">if</span> (THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(SERVER_ID, this-&gt;GetTransactionNum())) <span class="comment">// doesn&#39;t save.</span>
<a name="l00701"></a>00701                 theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l00702"></a>00702             <span class="keywordflow">break</span>;
<a name="l00703"></a>00703             
<a name="l00704"></a>00704         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:
<a name="l00705"></a>00705         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00706"></a>00706         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00707"></a>00707         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00708"></a>00708             <span class="comment">// These, assuming success, do NOT remove an issued number. So no need to anticipate setting up the list that way, to get a match.</span>
<a name="l00709"></a>00709             <span class="keywordflow">break</span>;
<a name="l00710"></a>00710         <span class="keywordflow">default</span>: 
<a name="l00711"></a>00711             <span class="comment">// Error</span>
<a name="l00712"></a>00712             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: wrong target transaction type: %s\n&quot;</span>,
<a name="l00713"></a>00713                          __FUNCTION__, TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l00714"></a>00714             <span class="keywordflow">break</span>;
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716     
<a name="l00717"></a>00717     <span class="comment">// ----------------------------------------------------</span>
<a name="l00718"></a>00718     
<a name="l00719"></a>00719     int64_t lTransactionNumber  = 0; <span class="comment">// Used in the loop below.</span>
<a name="l00720"></a>00720     
<a name="l00721"></a>00721     int32_t nNumberOfTransactionNumbers1 = 0; <span class="comment">// The Nym on this side</span>
<a name="l00722"></a>00722     int32_t nNumberOfTransactionNumbers2 = 0; <span class="comment">// The Message Nym.</span>
<a name="l00723"></a>00723     
<a name="l00724"></a>00724     <a class="code" href="class_o_t_string.html">OTString</a>    strMessageNym; 
<a name="l00725"></a>00725     
<a name="l00726"></a>00726     <span class="comment">// First, loop through the Nym on my side, and count how many numbers total he has...</span>
<a name="l00727"></a>00727     <span class="comment">//</span>
<a name="l00728"></a>00728     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_pseudonym_8hpp.html#ac99ad82dc6c392a0a8c851c6041b62f1">mapOfTransNums</a>, THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a74e834007bee7a45651a98257152da72">GetMapIssuedNum</a>())
<a name="l00729"></a>00729     {   
<a name="l00730"></a>00730         std::string strServerID     = (*it).first;
<a name="l00731"></a>00731         <a class="code" href="_o_t_pseudonym_8hpp.html#a94632bfde6cf91c8294122f77527bcf1">dequeOfTransNums</a> * pDeque   = (it-&gt;second);
<a name="l00732"></a>00732         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pDeque);
<a name="l00733"></a>00733         
<a name="l00734"></a>00734         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(strServerID.c_str());
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="keywordflow">if</span> (!(pDeque-&gt;empty()) &amp;&amp; (theServerID == this-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()))
<a name="l00737"></a>00737         {
<a name="l00738"></a>00738             nNumberOfTransactionNumbers1 += <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (pDeque-&gt;size());
<a name="l00739"></a>00739             <span class="keywordflow">break</span>; <span class="comment">// There&#39;s only one, in this loop, that would/could/should match. (Therefore, break after finding it.)</span>
<a name="l00740"></a>00740         }
<a name="l00741"></a>00741     } <span class="comment">// for</span>
<a name="l00742"></a>00742     
<a name="l00743"></a>00743     <span class="comment">// Next, loop through theMessageNym, and count his numbers as well...</span>
<a name="l00744"></a>00744     <span class="comment">// But ALSO verify that each one exists on THE_NYM, so that each individual</span>
<a name="l00745"></a>00745     <span class="comment">// number is checked.</span>
<a name="l00746"></a>00746     this-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strMessageNym);
<a name="l00747"></a>00747     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym;
<a name="l00748"></a>00748     
<a name="l00749"></a>00749     <span class="keywordflow">if</span> ((strMessageNym.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2) &amp;&amp; theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strMessageNym))
<a name="l00750"></a>00750     {
<a name="l00751"></a>00751         <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_pseudonym_8hpp.html#ac99ad82dc6c392a0a8c851c6041b62f1">mapOfTransNums</a>, theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a74e834007bee7a45651a98257152da72">GetMapIssuedNum</a>())
<a name="l00752"></a>00752         {   
<a name="l00753"></a>00753             std::string strServerID     = (*it).first;
<a name="l00754"></a>00754             <a class="code" href="_o_t_pseudonym_8hpp.html#a94632bfde6cf91c8294122f77527bcf1">dequeOfTransNums</a> * pDeque   = (it-&gt;second);
<a name="l00755"></a>00755             <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pDeque);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(strServerID.c_str());
<a name="l00758"></a>00758             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      OTstrServerID(theServerID);
<a name="l00759"></a>00759                         
<a name="l00760"></a>00760             <span class="keywordflow">if</span> (!(pDeque-&gt;empty()) &amp;&amp; (theServerID == this-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()))
<a name="l00761"></a>00761             {
<a name="l00762"></a>00762                 nNumberOfTransactionNumbers2 += <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (pDeque-&gt;size());
<a name="l00763"></a>00763                 
<a name="l00764"></a>00764                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; pDeque-&gt;size(); i++)
<a name="l00765"></a>00765                 {
<a name="l00766"></a>00766                     lTransactionNumber = pDeque-&gt;at(i);
<a name="l00767"></a>00767                     
<a name="l00768"></a>00768                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(OTstrServerID, lTransactionNumber)) <span class="comment">// FAILURE</span>
<a name="l00769"></a>00769                     {
<a name="l00770"></a>00770                         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: Issued transaction # %lld from Message Nym not found on this side.\n&quot;</span>, 
<a name="l00771"></a>00771                                       __FUNCTION__, lTransactionNumber);
<a name="l00772"></a>00772                         
<a name="l00773"></a>00773                         <span class="comment">// I have to do this whenever I RETURN :-(</span>
<a name="l00774"></a>00774                         <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
<a name="l00775"></a>00775                         {
<a name="l00776"></a>00776                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:
<a name="l00777"></a>00777                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:
<a name="l00778"></a>00778                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:
<a name="l00779"></a>00779                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:
<a name="l00780"></a>00780                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00781"></a>00781                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>:
<a name="l00782"></a>00782                                 <span class="comment">// Should only actually iterate once, in this case.</span>
<a name="l00783"></a>00783                                 <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()); i++) 
<a name="l00784"></a>00784                                 {
<a name="l00785"></a>00785                                     int64_t lTemp = theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), i);
<a name="l00786"></a>00786                                     
<a name="l00787"></a>00787                                     <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00788"></a>00788                                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: THIS SHOULD NOT HAPPEN.\n&quot;</span>, __FUNCTION__);
<a name="l00789"></a>00789                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, lTemp)) <span class="comment">// doesn&#39;t save.</span>
<a name="l00790"></a>00790                                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: Failed adding issued number back to THE_NYM.\n&quot;</span>,
<a name="l00791"></a>00791                                                       __FUNCTION__);
<a name="l00792"></a>00792                                 }
<a name="l00793"></a>00793                                 <span class="keywordflow">break</span>;
<a name="l00794"></a>00794                                 
<a name="l00795"></a>00795                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:
<a name="l00796"></a>00796                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00797"></a>00797                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00798"></a>00798                             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00799"></a>00799                                 <span class="keywordflow">break</span>;
<a name="l00800"></a>00800                             <span class="keywordflow">default</span>: 
<a name="l00801"></a>00801                                 <span class="comment">// Error</span>
<a name="l00802"></a>00802                                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: wrong target transaction type: %s\n&quot;</span>,
<a name="l00803"></a>00803                                               __FUNCTION__, TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l00804"></a>00804                                 <span class="keywordflow">break</span>;
<a name="l00805"></a>00805                         }
<a name="l00806"></a>00806                         
<a name="l00807"></a>00807                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00808"></a>00808                     }
<a name="l00809"></a>00809                 } <span class="comment">// for (numbers for a specific server.)</span>
<a name="l00810"></a>00810             <span class="keywordflow">break</span>; <span class="comment">// Only one server ID should match, so we can break after finding it.</span>
<a name="l00811"></a>00811             } <span class="comment">// If the server ID matches  </span>
<a name="l00812"></a>00812         } <span class="comment">// for (deques of numbers for each server)</span>
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814     
<a name="l00815"></a>00815     <span class="comment">// Finally, verify that the counts match...</span>
<a name="l00816"></a>00816     <span class="keywordflow">if</span> (nNumberOfTransactionNumbers1 != nNumberOfTransactionNumbers2)
<a name="l00817"></a>00817     {
<a name="l00818"></a>00818         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTItem::%s: Transaction # Count mismatch: %d and %d\n&quot;</span>,
<a name="l00819"></a>00819                       __FUNCTION__, nNumberOfTransactionNumbers1, nNumberOfTransactionNumbers2);
<a name="l00820"></a>00820         
<a name="l00821"></a>00821         <span class="comment">// I have to do this whenever I RETURN :-(</span>
<a name="l00822"></a>00822         <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
<a name="l00823"></a>00823         {
<a name="l00824"></a>00824             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:
<a name="l00825"></a>00825             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:
<a name="l00826"></a>00826             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:
<a name="l00827"></a>00827             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:
<a name="l00828"></a>00828             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00829"></a>00829             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>:
<a name="l00830"></a>00830                 <span class="comment">// Should only actually iterate once, in this case.</span>
<a name="l00831"></a>00831                 <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()); i++) 
<a name="l00832"></a>00832                 {
<a name="l00833"></a>00833                     int64_t lTemp = theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), i);
<a name="l00834"></a>00834                     
<a name="l00835"></a>00835                     <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00836"></a>00836                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: THIS SHOULD NOT HAPPEN.\n&quot;</span>, __FUNCTION__);
<a name="l00837"></a>00837                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, lTemp)) <span class="comment">// doesn&#39;t save.</span>
<a name="l00838"></a>00838                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: Failed adding issued number back to THE_NYM.\n&quot;</span>,
<a name="l00839"></a>00839                                       __FUNCTION__);
<a name="l00840"></a>00840                 }
<a name="l00841"></a>00841                 <span class="keywordflow">break</span>;
<a name="l00842"></a>00842                 
<a name="l00843"></a>00843             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:
<a name="l00844"></a>00844             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00845"></a>00845             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00846"></a>00846             <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00847"></a>00847                 <span class="keywordflow">break</span>;
<a name="l00848"></a>00848             <span class="keywordflow">default</span>: 
<a name="l00849"></a>00849                 <span class="comment">// Error</span>
<a name="l00850"></a>00850                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: wrong target transaction type: %s\n&quot;</span>,
<a name="l00851"></a>00851                               __FUNCTION__, TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l00852"></a>00852                 <span class="keywordflow">break</span>;
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857     
<a name="l00858"></a>00858     <span class="comment">// By this point, I know the local Nym has the same number of transactions as the message nym, and that</span>
<a name="l00859"></a>00859     <span class="comment">// EVERY ONE OF THEM was found individually.</span>
<a name="l00860"></a>00860     
<a name="l00861"></a>00861     <span class="comment">// Might want to consider saving the Nym here.</span>
<a name="l00862"></a>00862     <span class="comment">// Also want to save the latest signed receipt, since it VERIFIES.</span>
<a name="l00863"></a>00863     <span class="comment">// Or maybe let caller decide?</span>
<a name="l00864"></a>00864     
<a name="l00865"></a>00865     
<a name="l00866"></a>00866     <span class="comment">// I have to do this whenever I RETURN :-(</span>
<a name="l00867"></a>00867     <span class="comment">// EVEN IF SUCCESS, we have only succeeded to verify the balance statement.</span>
<a name="l00868"></a>00868     <span class="comment">// We must still go on to verify the transaction itself, and ONLY THEN will</span>
<a name="l00869"></a>00869     <span class="comment">// we (possibly) remove the issued number from the list. And the decision will</span>
<a name="l00870"></a>00870     <span class="comment">// change from situation to situation, depending on the instrument.</span>
<a name="l00871"></a>00871     <span class="comment">// Therefore I add it back here as well. We only fiddled with it in the first place</span>
<a name="l00872"></a>00872     <span class="comment">// in order to verify the balance statement. Done. So now let the other pieces decide</span>
<a name="l00873"></a>00873     <span class="comment">// their own logic from there.</span>
<a name="l00874"></a>00874     <span class="comment">//</span>
<a name="l00875"></a>00875     <span class="keywordflow">switch</span> (TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
<a name="l00876"></a>00876     {
<a name="l00877"></a>00877         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:
<a name="l00878"></a>00878         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:
<a name="l00879"></a>00879         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:
<a name="l00880"></a>00880         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:
<a name="l00881"></a>00881         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>:
<a name="l00882"></a>00882         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>:
<a name="l00883"></a>00883             <span class="comment">// Should only actually iterate once, in this case.</span>
<a name="l00884"></a>00884             <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()); i++) 
<a name="l00885"></a>00885             {
<a name="l00886"></a>00886                 int64_t lTemp = theRemovedNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), i);
<a name="l00887"></a>00887                 
<a name="l00888"></a>00888                 <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00889"></a>00889                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: THIS SHOULD NOT HAPPEN.\n&quot;</span>, __FUNCTION__);
<a name="l00890"></a>00890                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(SERVER_ID, lTemp)) <span class="comment">// doesn&#39;t save.</span>
<a name="l00891"></a>00891                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: Failed adding issued number back to THE_NYM.\n&quot;</span>,
<a name="l00892"></a>00892                                   __FUNCTION__);
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894             <span class="keywordflow">break</span>;
<a name="l00895"></a>00895             
<a name="l00896"></a>00896         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:
<a name="l00897"></a>00897         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:
<a name="l00898"></a>00898         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:
<a name="l00899"></a>00899         <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:
<a name="l00900"></a>00900             <span class="keywordflow">break</span>;
<a name="l00901"></a>00901         <span class="keywordflow">default</span>: 
<a name="l00902"></a>00902             <span class="comment">// Error</span>
<a name="l00903"></a>00903             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTItem::%s: wrong target transaction type: %s\n&quot;</span>,
<a name="l00904"></a>00904                           __FUNCTION__, TARGET_TRANSACTION.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l00905"></a>00905             <span class="keywordflow">break</span>;
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907     
<a name="l00908"></a>00908     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 <span class="comment">// You have to allocate the item on the heap and then pass it in as a reference. </span>
<a name="l00913"></a>00913 <span class="comment">// OTTransaction will take care of it from there and will delete it in destructor.</span>
<a name="l00914"></a><a class="code" href="class_o_t_item.html#aeb2726026df1021187b12ba760a91c2f">00914</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#aeb2726026df1021187b12ba760a91c2f">OTItem::AddItem</a>(<a class="code" href="class_o_t_item.html">OTItem</a> &amp; theItem) 
<a name="l00915"></a>00915 { 
<a name="l00916"></a>00916     <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>.push_back(&amp;theItem);  
<a name="l00917"></a>00917 } 
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 <span class="comment">// While processing a transaction, you may wish to query it for items of a certain type.</span>
<a name="l00921"></a><a class="code" href="class_o_t_item.html#a3db78fb28bf4d93b477a382b900a45ca">00921</a> <a class="code" href="class_o_t_item.html">OTItem</a> * <a class="code" href="class_o_t_item.html#a3db78fb28bf4d93b477a382b900a45ca">OTItem::GetItem</a>(int32_t nIndex) 
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923     int32_t nTempIndex = (-1);
<a name="l00924"></a>00924     
<a name="l00925"></a>00925     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>)
<a name="l00926"></a>00926     {
<a name="l00927"></a>00927         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l00928"></a>00928         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
<a name="l00929"></a>00929         
<a name="l00930"></a>00930         nTempIndex++; <span class="comment">// first iteration this becomes 0 here.</span>
<a name="l00931"></a>00931         
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (nTempIndex == nIndex)
<a name="l00933"></a>00933             <span class="keywordflow">return</span> pItem;
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935     
<a name="l00936"></a>00936     <span class="keywordflow">return</span> NULL;
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 
<a name="l00940"></a>00940 <span class="comment">// While processing an item, you may wish to query it for sub-items</span>
<a name="l00941"></a><a class="code" href="class_o_t_item.html#ac4b56f3a97ca6b8fd44738c9beeba4d1">00941</a> <a class="code" href="class_o_t_item.html">OTItem</a> * <a class="code" href="class_o_t_item.html#ac4b56f3a97ca6b8fd44738c9beeba4d1">OTItem::GetItemByTransactionNum</a>(<span class="keyword">const</span> int64_t lTransactionNumber) 
<a name="l00942"></a>00942 {
<a name="l00943"></a>00943     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>)
<a name="l00944"></a>00944     {
<a name="l00945"></a>00945         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l00946"></a>00946         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
<a name="l00947"></a>00947         
<a name="l00948"></a>00948         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() == lTransactionNumber)
<a name="l00949"></a>00949             <span class="keywordflow">return</span> pItem;
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951     
<a name="l00952"></a>00952     <span class="keywordflow">return</span> NULL;    
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="comment">// Count the number of items that are IN REFERENCE TO some transaction#.</span>
<a name="l00957"></a>00957 <span class="comment">//</span>
<a name="l00958"></a>00958 <span class="comment">// Might want to change this so that it only counts ACCEPTED receipts.</span>
<a name="l00959"></a>00959 <span class="comment">//</span>
<a name="l00960"></a><a class="code" href="class_o_t_item.html#a4cb410594f69720d0eb30600ba49f097">00960</a> int32_t <a class="code" href="class_o_t_item.html#a4cb410594f69720d0eb30600ba49f097">OTItem::GetItemCountInRefTo</a>(<span class="keyword">const</span> int64_t lReference)
<a name="l00961"></a>00961 {
<a name="l00962"></a>00962     int32_t nCount = 0;
<a name="l00963"></a>00963     
<a name="l00964"></a>00964     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>)
<a name="l00965"></a>00965     {
<a name="l00966"></a>00966         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l00967"></a>00967         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
<a name="l00968"></a>00968         
<a name="l00969"></a>00969         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReference)
<a name="l00970"></a>00970             nCount++;
<a name="l00971"></a>00971     }
<a name="l00972"></a>00972     
<a name="l00973"></a>00973     <span class="keywordflow">return</span> nCount;  
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 
<a name="l00977"></a>00977 <span class="comment">// The final receipt item MAY be present, and co-relates to others that share </span>
<a name="l00978"></a>00978 <span class="comment">// its &quot;in reference to&quot; value. (Others such as marketReceipts and paymentReceipts.)</span>
<a name="l00979"></a>00979 <span class="comment">//</span>
<a name="l00980"></a><a class="code" href="class_o_t_item.html#a08f07e59cd535830b158d45730908ad7">00980</a> <a class="code" href="class_o_t_item.html">OTItem</a> * <a class="code" href="class_o_t_item.html#a08f07e59cd535830b158d45730908ad7">OTItem::GetFinalReceiptItemByReferenceNum</a>(<span class="keyword">const</span> int64_t lReferenceNumber) 
<a name="l00981"></a>00981 {
<a name="l00982"></a>00982     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>)
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l00985"></a>00985         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
<a name="l00986"></a>00986         
<a name="l00987"></a>00987         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a> != pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
<a name="l00988"></a>00988             <span class="keywordflow">continue</span>;
<a name="l00989"></a>00989         <span class="comment">//----------------------</span>
<a name="l00990"></a>00990         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReferenceNumber)
<a name="l00991"></a>00991             <span class="keywordflow">return</span> pItem;
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993     
<a name="l00994"></a>00994     <span class="keywordflow">return</span> NULL;    
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 
<a name="l00998"></a>00998 <span class="comment">// For &quot;OTItem::acceptTransaction&quot;</span>
<a name="l00999"></a>00999 <span class="comment">//</span>
<a name="l01000"></a><a class="code" href="class_o_t_item.html#af71be628017c874b5bd63fafa277ee0e">01000</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_item.html#af71be628017c874b5bd63fafa277ee0e">OTItem::AddBlankNumbersToItem</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_num_list.html">OTNumList</a> &amp; theAddition)
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002     <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.Add(theAddition);
<a name="l01003"></a>01003 }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005 
<a name="l01006"></a>01006 <span class="comment">// Need to know the transaction number of the ORIGINAL transaction? Call this.</span>
<a name="l01007"></a>01007 <span class="comment">// virtual</span>
<a name="l01008"></a><a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">01008</a> int64_t <a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">OTItem::GetNumberOfOrigin</a>()
<a name="l01009"></a>01009 {
<a name="l01010"></a>01010     <span class="comment">// --------------------------------</span>
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (0 == <a class="code" href="class_o_t_transaction_type.html#a472b8131dde4747044a1784dd2935091">m_lNumberOfOrigin</a>)
<a name="l01012"></a>01012     {
<a name="l01013"></a>01013         <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
<a name="l01014"></a>01014         {
<a name="l01015"></a>01015             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">acceptPending</a>:         <span class="comment">// this item is a client-side acceptance of a pending transfer</span>
<a name="l01016"></a>01016             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">rejectPending</a>:         <span class="comment">// this item is a client-side rejection of a pending transfer</span>
<a name="l01017"></a>01017             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">acceptCronReceipt</a>:     <span class="comment">// this item is a client-side acceptance of a cron receipt in his inbox.</span>
<a name="l01018"></a>01018             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">acceptItemReceipt</a>:     <span class="comment">// this item is a client-side acceptance of an item receipt in his inbox.</span>
<a name="l01019"></a>01019             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">disputeCronReceipt</a>:    <span class="comment">// this item is a client dispute of a cron receipt in his inbox.</span>
<a name="l01020"></a>01020             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">disputeItemReceipt</a>:    <span class="comment">// this item is a client dispute of an item receipt in his inbox.</span>
<a name="l01021"></a>01021             <span class="comment">// --------------------------------------------</span>
<a name="l01022"></a>01022             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">acceptFinalReceipt</a>:    <span class="comment">// this item is a client-side acceptance of a final receipt in his inbox. (All related receipts must also be closed!)</span>
<a name="l01023"></a>01023             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">acceptBasketReceipt</a>:   <span class="comment">// this item is a client-side acceptance of a basket receipt in his inbox.</span>
<a name="l01024"></a>01024             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">disputeFinalReceipt</a>:   <span class="comment">// this item is a client-side rejection of a final receipt in his inbox. (All related receipts must also be closed!)</span>
<a name="l01025"></a>01025             <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">disputeBasketReceipt</a>:  <span class="comment">// this item is a client-side rejection of a basket receipt in his inbox.</span>
<a name="l01026"></a>01026                 <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01027"></a>01027                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: In this case, you can&#39;t calculate the origin number, you must set it explicitly.\n&quot;</span>,
<a name="l01028"></a>01028                               __FUNCTION__);
<a name="l01029"></a>01029                 <span class="comment">// Comment this out later so people can&#39;t use it to crash the server:</span>
<a name="l01030"></a>01030                 <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;In this case, you can&#39;t calculate the origin number, you must set it explicitly.&quot;</span>);
<a name="l01031"></a>01031                 <span class="keywordflow">break</span>;
<a name="l01032"></a>01032             <span class="keywordflow">default</span>:
<a name="l01033"></a>01033                 <span class="keywordflow">break</span>;
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         <span class="comment">// --------------------------------</span>
<a name="l01036"></a>01036         this-&gt;<a class="code" href="class_o_t_item.html#a8ae9ce908d25b10fb3329e0edf22e647">CalculateNumberOfOrigin</a>();
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038     <span class="comment">// --------------------------------</span>
<a name="l01039"></a>01039     <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction_type.html#a472b8131dde4747044a1784dd2935091">m_lNumberOfOrigin</a>;
<a name="l01040"></a>01040 }
<a name="l01041"></a>01041 
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="comment">//virtual</span>
<a name="l01044"></a><a class="code" href="class_o_t_item.html#a8ae9ce908d25b10fb3329e0edf22e647">01044</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a8ae9ce908d25b10fb3329e0edf22e647">OTItem::CalculateNumberOfOrigin</a>()
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046     <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
<a name="l01047"></a>01047     {
<a name="l01048"></a>01048         <span class="comment">// ------------------------------------------------------------------------------        </span>
<a name="l01049"></a>01049         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a8d437fea3122fe59247f606d7e240118">acceptTransaction</a>:     <span class="comment">// this item is a client-side acceptance of a transaction number (a blank) in my Nymbox</span>
<a name="l01050"></a>01050         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a00f43bf21e890c4dd11059fc834f1ef1">atAcceptTransaction</a>:   <span class="comment">// server reply</span>
<a name="l01051"></a>01051         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6d7747de96495046d982b4eb2a38e46f">acceptMessage</a>:         <span class="comment">// this item is a client-side acceptance of a message in my Nymbox</span>
<a name="l01052"></a>01052         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91caeadd2fc8999a11a392fb25b0b5c3">atAcceptMessage</a>:       <span class="comment">// server reply</span>
<a name="l01053"></a>01053         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a471cb7cb3653b339a64099dde1d26298">acceptNotice</a>:          <span class="comment">// this item is a client-side acceptance of a server notification in my Nymbox</span>
<a name="l01054"></a>01054         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3a3aa40758df2bff71b66962c0206a73">atAcceptNotice</a>:        <span class="comment">// server reply</span>
<a name="l01055"></a>01055         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2e7b5819c105436d507ee05b176026d2">replyNotice</a>:           <span class="comment">// server notice of a reply that nym should have already received as a response to a request. (Copy dropped in nymbox.)</span>
<a name="l01056"></a>01056         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab30dfb8a832a4094b8e75da6b47a8f5f">successNotice</a>:         <span class="comment">// server notice dropped into nymbox as result of a transaction# being successfully signed out.</span>
<a name="l01057"></a>01057         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a72e8b39a09399b486754d11771f5dc56">notice</a>:                <span class="comment">// server notice dropped into nymbox as result of a smart contract processing.</span>
<a name="l01058"></a>01058         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">transferReceipt</a>:       <span class="comment">// Currently don&#39;t create an OTItem for transfer receipt in inbox. Used only for inbox report.</span>
<a name="l01059"></a>01059         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">chequeReceipt</a>:         <span class="comment">// Currently don&#39;t create an OTItem for cheque receipt in inbox. Used only for inbox report.</span>
<a name="l01060"></a>01060         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">voucherReceipt</a>:        <span class="comment">// Currently don&#39;t create an OTItem for voucher receipt in inbox. Used only for inbox report.</span>
<a name="l01061"></a>01061             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01062"></a>01062             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);  <span class="comment">// Not applicable.</span>
<a name="l01063"></a>01063             <span class="keywordflow">break</span>;
<a name="l01064"></a>01064         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01065"></a>01065         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">acceptPending</a>:         <span class="comment">// this item is a client-side acceptance of a pending transfer</span>
<a name="l01066"></a>01066         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">rejectPending</a>:         <span class="comment">// this item is a client-side rejection of a pending transfer        </span>
<a name="l01067"></a>01067         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">acceptCronReceipt</a>:     <span class="comment">// this item is a client-side acceptance of a cron receipt in his inbox.</span>
<a name="l01068"></a>01068         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">acceptItemReceipt</a>:     <span class="comment">// this item is a client-side acceptance of an item receipt in his inbox.</span>
<a name="l01069"></a>01069         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">disputeCronReceipt</a>:    <span class="comment">// this item is a client dispute of a cron receipt in his inbox.</span>
<a name="l01070"></a>01070         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">disputeItemReceipt</a>:    <span class="comment">// this item is a client dispute of an item receipt in his inbox.</span>
<a name="l01071"></a>01071         <span class="comment">// --------------------------------------------</span>
<a name="l01072"></a>01072         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">acceptFinalReceipt</a>:    <span class="comment">// this item is a client-side acceptance of a final receipt in his inbox. (All related receipts must also be closed!)</span>
<a name="l01073"></a>01073         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">acceptBasketReceipt</a>:   <span class="comment">// this item is a client-side acceptance of a basket receipt in his inbox.</span>
<a name="l01074"></a>01074         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">disputeFinalReceipt</a>:   <span class="comment">// this item is a client-side rejection of a final receipt in his inbox. (All related receipts must also be closed!)</span>
<a name="l01075"></a>01075         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">disputeBasketReceipt</a>:  <span class="comment">// this item is a client-side rejection of a basket receipt in his inbox.</span>
<a name="l01076"></a>01076             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01077"></a>01077             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: In this case, you can&#39;t calculate the origin number, you must set it explicitly.\n&quot;</span>,
<a name="l01078"></a>01078                           __FUNCTION__);
<a name="l01079"></a>01079             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);  <span class="comment">// Not applicable.</span>
<a name="l01080"></a>01080             <span class="comment">// Comment this out later so people can&#39;t use it to crash the server:</span>
<a name="l01081"></a>01081             <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;In this case, you can&#39;t calculate the origin number, you must set it explicitly.&quot;</span>);
<a name="l01082"></a>01082             <span class="keywordflow">break</span>;
<a name="l01083"></a>01083         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01084"></a>01084         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">marketReceipt</a>:         <span class="comment">// server receipt dropped into inbox as result of market trading. Also used in inbox report.</span>
<a name="l01085"></a>01085         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">paymentReceipt</a>:        <span class="comment">// server receipt dropped into an inbox as result of payment occuring. Also used in inbox report.</span>
<a name="l01086"></a>01086         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">finalReceipt</a>:          <span class="comment">// server receipt dropped into inbox / nymbox as result of cron item expiring or being canceled.</span>
<a name="l01087"></a>01087         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">basketReceipt</a>:         <span class="comment">// server receipt dropped into inbox as result of a basket exchange.</span>
<a name="l01088"></a>01088             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01089"></a>01089             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(this-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()); <span class="comment">// pending is in reference to the original transfer.</span>
<a name="l01090"></a>01090             <span class="keywordflow">break</span>;
<a name="l01091"></a>01091         <span class="comment">// --------------------------------------------------------------------------------------</span>
<a name="l01092"></a>01092         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">depositCheque</a>:         <span class="comment">// this item is a request to deposit a cheque.</span>
<a name="l01093"></a>01093         {
<a name="l01094"></a>01094             <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque;
<a name="l01095"></a>01095             <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
<a name="l01096"></a>01096             this-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strAttachment);
<a name="l01097"></a>01097             
<a name="l01098"></a>01098             <span class="keywordflow">if</span> (!theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strAttachment))
<a name="l01099"></a>01099                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR loading cheque from string:\n%s\n&quot;</span>,
<a name="l01100"></a>01100                               __FUNCTION__, strAttachment.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01101"></a>01101             <span class="keywordflow">else</span>
<a name="l01102"></a>01102                 this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(theCheque.<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104             <span class="keywordflow">break</span>;
<a name="l01105"></a>01105         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01106"></a>01106         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae12946cd205221592c0fa44e4c7399b2">atDepositCheque</a>:           <span class="comment">// this item is a server response to that request.</span>
<a name="l01107"></a>01107         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5b0f7bfa18e29ce7d6ebcc861e541f4f">atAcceptPending</a>:           <span class="comment">// server reply to acceptPending.</span>
<a name="l01108"></a>01108         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a84f21da0049c428f2e74c573dfaff067">atRejectPending</a>:           <span class="comment">// server reply to rejectPending.</span>
<a name="l01109"></a>01109         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3c0d4b5c591948114dbd2550cccb3b48">atAcceptCronReceipt</a>:       <span class="comment">// this item is a server reply to that acceptance.</span>
<a name="l01110"></a>01110         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a919386d460c64f76c562aa216523aa9f">atAcceptItemReceipt</a>:       <span class="comment">// this item is a server reply to that acceptance.</span>
<a name="l01111"></a>01111         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a15fb11d5243db9056a4c340bc49cea43">atDisputeCronReceipt</a>:      <span class="comment">// Server reply to dispute message.</span>
<a name="l01112"></a>01112         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acd9426f6754691aebb202e9c14cdc681">atDisputeItemReceipt</a>:      <span class="comment">// Server reply to dispute message.</span>
<a name="l01113"></a>01113         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5034beca2e90df6b2b36022d365f1d38">atAcceptFinalReceipt</a>:      <span class="comment">// server reply</span>
<a name="l01114"></a>01114         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5901a9fad67b6756c6c6abcb131adc22">atAcceptBasketReceipt</a>:     <span class="comment">// server reply</span>
<a name="l01115"></a>01115         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9b353f70c54facca58998d250badcf27">atDisputeFinalReceipt</a>:     <span class="comment">// server reply</span>
<a name="l01116"></a>01116         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9fc8674f161335439c48b2e9db277b9b">atDisputeBasketReceipt</a>:    <span class="comment">// server reply</span>
<a name="l01117"></a>01117         {
<a name="l01118"></a>01118             <a class="code" href="class_o_t_string.html">OTString</a> strReference;
<a name="l01119"></a>01119             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
<a name="l01120"></a>01120             
<a name="l01121"></a>01121             <span class="comment">// &quot;In reference to&quot; number is my original deposit trans#, which I use here to load my</span>
<a name="l01122"></a>01122             <span class="comment">// original depositCheque item, which I use to get the cheque, which contains the number</span>
<a name="l01123"></a>01123             <span class="comment">// of origin as its transaction number.</span>
<a name="l01124"></a>01124             <span class="comment">//</span>
<a name="l01125"></a>01125             <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference,
<a name="l01126"></a>01126                                                                   this-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
<a name="l01127"></a>01127                                                                   this-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l01128"></a>01128             <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOriginalItem);
<a name="l01129"></a>01129             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel(pOriginalItem);
<a name="l01130"></a>01130             <span class="comment">// ------------------------------------------------            </span>
<a name="l01131"></a>01131             <span class="keywordflow">if</span> (
<a name="l01132"></a>01132                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae12946cd205221592c0fa44e4c7399b2">atDepositCheque</a>)        &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>         != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01133"></a>01133                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5b0f7bfa18e29ce7d6ebcc861e541f4f">atAcceptPending</a>)        &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>         != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01134"></a>01134                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a84f21da0049c428f2e74c573dfaff067">atRejectPending</a>)        &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">OTItem::rejectPending</a>         != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01135"></a>01135                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3c0d4b5c591948114dbd2550cccb3b48">atAcceptCronReceipt</a>)    &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>     != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01136"></a>01136                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a919386d460c64f76c562aa216523aa9f">atAcceptItemReceipt</a>)    &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>     != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01137"></a>01137                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a15fb11d5243db9056a4c340bc49cea43">atDisputeCronReceipt</a>)   &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">OTItem::disputeCronReceipt</a>    != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01138"></a>01138                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acd9426f6754691aebb202e9c14cdc681">atDisputeItemReceipt</a>)   &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">OTItem::disputeItemReceipt</a>    != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01139"></a>01139                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5034beca2e90df6b2b36022d365f1d38">atAcceptFinalReceipt</a>)   &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>    != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01140"></a>01140                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5901a9fad67b6756c6c6abcb131adc22">atAcceptBasketReceipt</a>)  &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>   != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01141"></a>01141                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9b353f70c54facca58998d250badcf27">atDisputeFinalReceipt</a>)  &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">OTItem::disputeFinalReceipt</a>   != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())) ||
<a name="l01142"></a>01142                 ((<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9fc8674f161335439c48b2e9db277b9b">atDisputeBasketReceipt</a>) &amp;&amp; (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">OTItem::disputeBasketReceipt</a>  != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()))
<a name="l01143"></a>01143             )
<a name="l01144"></a>01144             {
<a name="l01145"></a>01145                 <a class="code" href="class_o_t_string.html">OTString</a> strType;
<a name="l01146"></a>01146                 pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strType);
<a name="l01147"></a>01147                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Wrong item type as &#39;in reference to&#39; string on %s item.\n&quot;</span>,
<a name="l01148"></a>01148                               __FUNCTION__, strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01149"></a>01149                 this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);
<a name="l01150"></a>01150                 <span class="keywordflow">return</span>;
<a name="l01151"></a>01151             }
<a name="l01152"></a>01152             <span class="comment">// ------------------------------------------------</span>
<a name="l01153"></a>01153             <span class="comment">// Else:</span>
<a name="l01154"></a>01154             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>());
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156             <span class="keywordflow">break</span>;
<a name="l01157"></a>01157         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01158"></a>01158         <span class="comment">// FEEs</span>
<a name="l01159"></a>01159         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc891ffd6b8c7f2498f8bcda7a0831c">serverfee</a>:   <span class="comment">// this item is a fee from the transaction server (per contract)</span>
<a name="l01160"></a>01160         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a31746a29eea9bf6eaed3d29a1d2d8f8e">atServerfee</a>:
<a name="l01161"></a>01161         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a89f6f79d3f709412824c40619133f888">issuerfee</a>:   <span class="comment">// this item is a fee from the issuer (per contract)</span>
<a name="l01162"></a>01162         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abdb265afff50cc510218531a07efe1f7">atIssuerfee</a>:
<a name="l01163"></a>01163         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01164"></a>01164         <span class="comment">// INFO (BALANCE, HASH, etc) these are still all messages with replies.</span>
<a name="l01165"></a>01165         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">balanceStatement</a>:       <span class="comment">// this item is a statement of balance. (For asset account.)</span>
<a name="l01166"></a>01166         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">atBalanceStatement</a>:
<a name="l01167"></a>01167         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">transactionStatement</a>:   <span class="comment">// this item is a transaction statement. (For Nym -- which numbers are assigned to him.)</span>
<a name="l01168"></a>01168         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">atTransactionStatement</a>:
<a name="l01169"></a>01169         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01170"></a>01170         <span class="comment">// TRANSFER</span>
<a name="l01171"></a>01171         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">transfer</a>:          <span class="comment">// This item is an outgoing transfer, probably part of an outoing transaction.</span>
<a name="l01172"></a>01172         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac310111eca8eb295fb5dafddd884fc82">atTransfer</a>:        <span class="comment">// Server reply.</span>
<a name="l01173"></a>01173         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01174"></a>01174         <span class="comment">// CASH WITHDRAWAL / DEPOSIT</span>
<a name="l01175"></a>01175         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91dfa211f934207df229263a14672789">withdrawal</a>:        <span class="comment">// this item is a cash withdrawal (of chaumian blinded tokens)</span>
<a name="l01176"></a>01176         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a16a994b2323c05a6cd00ccbf57102be8">atWithdrawal</a>:
<a name="l01177"></a>01177         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afd6e878bfcdf2d554b0c814d5da084d1">deposit</a>:           <span class="comment">// this item is a cash deposit (of a purse containing blinded tokens.)</span>
<a name="l01178"></a>01178         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a814d6a51c7059307c8fe8d073fb9de9e">atDeposit</a>:
<a name="l01179"></a>01179         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01180"></a>01180         <span class="comment">// CHEQUES AND VOUCHERS</span>
<a name="l01181"></a>01181         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a044b299744ed5d88b526470c0a3bbcf4">withdrawVoucher</a>:   <span class="comment">// this item is a request to purchase a voucher (a cashier&#39;s cheque)</span>
<a name="l01182"></a>01182         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a36d4c6faf8ad5aae6ea36fe5a66012c8">atWithdrawVoucher</a>:
<a name="l01183"></a>01183         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01184"></a>01184         <span class="comment">// PAYING DIVIDEND ON SHARES OF STOCK</span>
<a name="l01185"></a>01185         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a76baae22af2df636d404516ecf5ea06a">payDividend</a>:       <span class="comment">// this item is a request to pay a dividend.</span>
<a name="l01186"></a>01186         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae8f15961c19cf2d7645061df47e59650">atPayDividend</a>:     <span class="comment">// the server reply to that request.</span>
<a name="l01187"></a>01187         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01188"></a>01188         <span class="comment">// TRADING ON MARKETS</span>
<a name="l01189"></a>01189         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae973afad2dc8a8349e8889304b20e73b">marketOffer</a>:       <span class="comment">// this item is an offer to be put on a market.</span>
<a name="l01190"></a>01190         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a229f0c7ace7a51840d7632910a0b92a6">atMarketOffer</a>:     <span class="comment">// server reply or updated notification regarding a market offer.</span>
<a name="l01191"></a>01191         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01192"></a>01192         <span class="comment">// PAYMENT PLANS</span>
<a name="l01193"></a>01193         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">paymentPlan</a>:       <span class="comment">// this item is a new payment plan</span>
<a name="l01194"></a>01194         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc3c7556a790e7a7b6be464f8ea058b">atPaymentPlan</a>:     <span class="comment">// server reply or updated notification regarding a payment plan.</span>
<a name="l01195"></a>01195         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01196"></a>01196         <span class="comment">// SMART CONTRACTS</span>
<a name="l01197"></a>01197         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">smartContract</a>:     <span class="comment">// this item is a new smart contract</span>
<a name="l01198"></a>01198         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1fe91e4cadee24de6acb9de56a55e4eb">atSmartContract</a>:   <span class="comment">// server reply or updated notification regarding a smart contract.</span>
<a name="l01199"></a>01199         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01200"></a>01200         <span class="comment">// CANCELLING: Market Offers and Payment Plans.</span>
<a name="l01201"></a>01201         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5db1c9a56286c66937eb57d460f2eb01">cancelCronItem</a>:    <span class="comment">// this item is intended to cancel a market offer or payment plan.</span>
<a name="l01202"></a>01202         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab3ded9d37de3a75d4b39735bb9aff341">atCancelCronItem</a>:  <span class="comment">// reply from the server regarding said cancellation.</span>
<a name="l01203"></a>01203         <span class="comment">// --------------------------------------------------------------------------------------</span>
<a name="l01204"></a>01204         <span class="comment">// EXCHANGE IN/OUT OF A BASKET CURRENCY</span>
<a name="l01205"></a>01205         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1332f32813f158436fd58abdddec855c">exchangeBasket</a>:    <span class="comment">// this item is an exchange in/out of a basket currency.</span>
<a name="l01206"></a>01206         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0b62f8efea6ed9bdefbc48ce2e97a8b6">atExchangeBasket</a>:  <span class="comment">// reply from the server regarding said exchange.</span>
<a name="l01207"></a>01207         <span class="comment">// ------------------------------------------------------------------------------            </span>
<a name="l01208"></a>01208         <span class="keywordflow">default</span>:
<a name="l01209"></a>01209             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l01210"></a>01210             <span class="keywordflow">break</span>;
<a name="l01211"></a>01211     } <span class="comment">// switch</span>
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 
<a name="l01215"></a><a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">01215</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">OTItem::GetAttachment</a>(<a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)<span class="keyword"> const</span>
<a name="l01216"></a>01216 <span class="keyword"></span>{
<a name="l01217"></a>01217     <a class="code" href="class_o_t_item.html#a0608b516a156e4f21eef59096bca6d49">m_ascAttachment</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(theStr);
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 
<a name="l01221"></a><a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">01221</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">OTItem::SetAttachment</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)
<a name="l01222"></a>01222 {
<a name="l01223"></a>01223     <a class="code" href="class_o_t_item.html#a0608b516a156e4f21eef59096bca6d49">m_ascAttachment</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(theStr);
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 
<a name="l01227"></a><a class="code" href="_o_t_item_8cpp.html#aaf37e88b95eb6ea77d8623919774a1ea">01227</a> <span class="preprocessor">#define MINIMUM_CLEARTEXT_SIZE_OTASCIIARMOR 100</span>
<a name="l01228"></a>01228 <span class="preprocessor"></span>
<a name="l01229"></a><a class="code" href="_o_t_item_8cpp.html#ac1d665e64d1cf5e8d6d888518ae458b7">01229</a> <span class="preprocessor">#define OTASSCIIARMOR_PADDING_TEXT  &quot; IGNORE -- NOTE PADDING -- IGNORE -- NOTE PADDING \nIGNORE -- NOTE PADDING -- IGNORE -- NOTE PADDING \n&quot;</span>
<a name="l01230"></a>01230 <span class="preprocessor"></span>
<a name="l01231"></a>01231 
<a name="l01232"></a><a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">01232</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">OTItem::SetNote</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)
<a name="l01233"></a>01233 {
<a name="l01234"></a>01234     <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theStr.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
<a name="l01235"></a>01235     {
<a name="l01236"></a>01236         <a class="code" href="class_o_t_string.html">OTString</a> theString(theStr);
<a name="l01237"></a>01237         <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &lt; <a class="code" href="_o_t_item_8cpp.html#aaf37e88b95eb6ea77d8623919774a1ea">MINIMUM_CLEARTEXT_SIZE_OTASCIIARMOR</a>)
<a name="l01238"></a>01238         {
<a name="l01239"></a>01239             <a class="code" href="class_o_t_string.html">OTString</a> strPadding(<a class="code" href="_o_t_item_8cpp.html#ac1d665e64d1cf5e8d6d888518ae458b7">OTASSCIIARMOR_PADDING_TEXT</a>);
<a name="l01240"></a>01240             
<a name="l01241"></a>01241             theString.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(strPadding);
<a name="l01242"></a>01242         }
<a name="l01243"></a>01243         
<a name="l01244"></a>01244         <a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(theString);
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246     <span class="keywordflow">else</span> 
<a name="l01247"></a>01247     {
<a name="l01248"></a>01248         <a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
<a name="l01249"></a>01249     }
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 
<a name="l01254"></a><a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">01254</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">OTItem::GetNote</a>(<a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)<span class="keyword"> const</span>
<a name="l01255"></a>01255 <span class="keyword"></span>{
<a name="l01256"></a>01256     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
<a name="l01257"></a>01257     {
<a name="l01258"></a>01258         <a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(theStr);
<a name="l01259"></a>01259         
<a name="l01260"></a>01260         <span class="keywordflow">if</span> (theStr.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<a class="code" href="_o_t_item_8cpp.html#ac1d665e64d1cf5e8d6d888518ae458b7">OTASSCIIARMOR_PADDING_TEXT</a>))
<a name="l01261"></a>01261             theStr.<a class="code" href="class_o_t_string.html#a90db02098377385a45f1ebac049f9a12">Truncate</a>(theStr.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() - <a class="code" href="_o_t_item_8cpp.html#aaf37e88b95eb6ea77d8623919774a1ea">MINIMUM_CLEARTEXT_SIZE_OTASCIIARMOR</a>);
<a name="l01262"></a>01262     }
<a name="l01263"></a>01263     <span class="keywordflow">else</span> 
<a name="l01264"></a>01264     {
<a name="l01265"></a>01265         theStr.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268 }
<a name="l01269"></a>01269         
<a name="l01270"></a>01270 
<a name="l01271"></a>01271 <span class="comment">// Let&#39;s say you have created a transaction, and you are creating an item to put into it.</span>
<a name="l01272"></a>01272 <span class="comment">// Well in that case, you don&#39;t care to verify that the real IDs match the purported IDs, since</span>
<a name="l01273"></a>01273 <span class="comment">// you are creating this item yourself, not verifying it from someone else.</span>
<a name="l01274"></a>01274 <span class="comment">// Use this function to create the new Item before you add it to your new Transaction.</span>
<a name="l01275"></a><a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">01275</a> <a class="code" href="class_o_t_item.html">OTItem</a> * <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; theOwner, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theType, <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> * pDestinationAcctID<span class="comment">/*=NULL*/</span>)
<a name="l01276"></a>01276 {
<a name="l01277"></a>01277     <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), theOwner, theType, pDestinationAcctID);
<a name="l01278"></a>01278     
<a name="l01279"></a>01279     <span class="keywordflow">if</span> (pItem)
<a name="l01280"></a>01280     {
<a name="l01281"></a>01281         pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>());
<a name="l01282"></a>01282         pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
<a name="l01283"></a>01283         <span class="keywordflow">return</span> pItem;
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285     <span class="keywordflow">return</span> NULL;
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 <span class="comment">// Sometimes I don&#39;t know user ID of the originator, or the account ID of the originator,</span>
<a name="l01290"></a>01290 <span class="comment">// until after I have loaded the item. It&#39;s simply impossible to set those values ahead</span>
<a name="l01291"></a>01291 <span class="comment">// of time, sometimes. In those cases, we set the values appropriately but then we need</span>
<a name="l01292"></a>01292 <span class="comment">// to verify that the user ID is actually the owner of the AccountID. TOdo that.</span>
<a name="l01293"></a><a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">01293</a> <a class="code" href="class_o_t_item.html">OTItem</a> * <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strItem, <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theServerID, int64_t lTransactionNumber)
<a name="l01294"></a>01294 {
<a name="l01295"></a>01295     <span class="keywordflow">if</span> (!strItem.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01296"></a>01296     {
<a name="l01297"></a>01297         <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTItem::CreateItemFromString: strItem is empty. (Expected an item.)\n&quot;</span>);
<a name="l01298"></a>01298         <span class="keywordflow">return</span> NULL;
<a name="l01299"></a>01299     }
<a name="l01300"></a>01300     
<a name="l01301"></a>01301     <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem</a>();
<a name="l01302"></a>01302 
<a name="l01303"></a>01303     <span class="comment">// So when it loads its own server ID, we can compare to this one.</span>
<a name="l01304"></a>01304     pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(theServerID);
<a name="l01305"></a>01305     
<a name="l01306"></a>01306     <span class="comment">// This loads up the purported account ID and the user ID.</span>
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strItem))
<a name="l01308"></a>01308     {
<a name="l01309"></a>01309         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; ACCOUNT_ID = pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>();
<a name="l01310"></a>01310         pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(ACCOUNT_ID);<span class="comment">// I do this because it&#39;s all we&#39;ve got in this case. It&#39;s what&#39;s in the</span>
<a name="l01311"></a>01311                                             <span class="comment">// xml, so it must be right. If it&#39;s a lie, the signature will fail or the</span>
<a name="l01312"></a>01312                                             <span class="comment">// user will not show as the owner of that account. But remember, the server</span>
<a name="l01313"></a>01313                                             <span class="comment">// sent the message in the first place.</span>
<a name="l01314"></a>01314     
<a name="l01315"></a>01315         pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(lTransactionNumber);
<a name="l01316"></a>01316         
<a name="l01317"></a>01317         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>()) <span class="comment">// this compares purported and real account IDs, as well as server IDs.</span>
<a name="l01318"></a>01318         {
<a name="l01319"></a>01319             <span class="keywordflow">return</span> pItem;
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <span class="keywordflow">else</span>
<a name="l01322"></a>01322         {
<a name="l01323"></a>01323             <span class="keyword">delete</span> pItem;
<a name="l01324"></a>01324             pItem = NULL;
<a name="l01325"></a>01325         }
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="keywordflow">return</span> NULL;
<a name="l01329"></a>01329 }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 
<a name="l01332"></a><a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">01332</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">OTItem::InitItem</a>()
<a name="l01333"></a>01333 {
<a name="l01334"></a>01334     <a class="code" href="class_o_t_item.html#ac2864f331e417eff2544f8c541112689">m_lAmount</a>           = 0; <span class="comment">// Accounts default to ZERO.  They can only change that amount by receiving from another account.</span>
<a name="l01335"></a>01335     <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>              = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l01336"></a>01336     <a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a>            = <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a16fa1b0df4dbad1367dbd0f6dbac9572">OTItem::request</a>;                  <span class="comment">// (Unless an issuer account, which can create currency </span>
<a name="l01337"></a>01337     <a class="code" href="class_o_t_item.html#abf3f938b875010e42bdf16e2668b1fd2">m_lNewOutboxTransNum</a>=0; <span class="comment">// When the user puts a &quot;1&quot; in his outbox for a balance agreement (since he doesn&#39;t know what trans# the actual outbox item</span>
<a name="l01338"></a>01338                             <span class="comment">// will have if the transaction is successful, since the server hasn&#39;t issued it yet) then the balance receipt will have 1 in</span>
<a name="l01339"></a>01339                             <span class="comment">// the user&#39;s portion for that outbox transaction, and the balance receipt will also have, say, #34 (the actual number) here</span>
<a name="l01340"></a>01340                             <span class="comment">// in this variable, in the server&#39;s reply portion of that same receipt.</span>
<a name="l01341"></a>01341     
<a name="l01342"></a>01342     <a class="code" href="class_o_t_item.html#a23162f8b538acbb6af67b1f771f791b9">m_lClosingTransactionNo</a> = 0;
<a name="l01343"></a>01343     
<a name="l01344"></a>01344     <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>   = <span class="stringliteral">&quot;TRANSACTION ITEM&quot;</span>; <span class="comment">// CONTRACT, MESSAGE, TRANSACTION, LEDGER, TRANSACTION ITEM </span>
<a name="l01345"></a>01345 }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <span class="comment">// this one is private (I hope to keep it that way.)</span>
<a name="l01349"></a>01349 <span class="comment">// probvably not actually. If I end up back here, it&#39;s because</span>
<a name="l01350"></a>01350 <span class="comment">// sometimes I dont&#39; WANT to assign the stuff, but leave it blank</span>
<a name="l01351"></a>01351 <span class="comment">// because I&#39;m about to load it.</span>
<a name="l01352"></a><a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">01352</a> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem::OTItem</a>() : <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a>(),
<a name="l01353"></a>01353     m_lAmount(0),
<a name="l01354"></a>01354     m_Type(<a class="code" href="class_o_t_item.html">OTItem</a>::error_state),
<a name="l01355"></a>01355     m_Status(<a class="code" href="class_o_t_item.html">OTItem</a>::request),
<a name="l01356"></a>01356     m_lNewOutboxTransNum(0),
<a name="l01357"></a>01357     m_lClosingTransactionNo(0)
<a name="l01358"></a>01358 {
<a name="l01359"></a>01359     <a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">InitItem</a>();
<a name="l01360"></a>01360 }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362 
<a name="l01363"></a>01363 <span class="comment">// From owner we can get acct ID, server ID, and transaction Num</span>
<a name="l01364"></a><a class="code" href="class_o_t_item.html#acf3d334896b88e098efd3f40a3be15ec">01364</a> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem::OTItem</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theUserID, <span class="keyword">const</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; theOwner) 
<a name="l01365"></a>01365 : <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a>(theUserID, theOwner.GetRealAccountID(), theOwner.GetRealServerID(), theOwner.GetTransactionNum()),
<a name="l01366"></a>01366     m_lAmount(0),
<a name="l01367"></a>01367     m_Type(<a class="code" href="class_o_t_item.html">OTItem</a>::error_state),
<a name="l01368"></a>01368     m_Status(<a class="code" href="class_o_t_item.html">OTItem</a>::request),
<a name="l01369"></a>01369     m_lNewOutboxTransNum(0),
<a name="l01370"></a>01370     m_lClosingTransactionNo(0)
<a name="l01371"></a>01371 {
<a name="l01372"></a>01372     <a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">InitItem</a>();
<a name="l01373"></a>01373     
<a name="l01374"></a>01374 }
<a name="l01375"></a>01375 
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 <span class="comment">// From owner we can get acct ID, server ID, and transaction Num</span>
<a name="l01378"></a><a class="code" href="class_o_t_item.html#a04658c7a59cf1dfeec6cd91278b72c68">01378</a> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem::OTItem</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theUserID, <span class="keyword">const</span> <a class="code" href="class_o_t_item.html">OTItem</a> &amp; theOwner) 
<a name="l01379"></a>01379 : <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a>(theUserID, theOwner.GetRealAccountID(), theOwner.GetRealServerID(), theOwner.GetTransactionNum()),
<a name="l01380"></a>01380     m_lAmount(0),
<a name="l01381"></a>01381     m_Type(<a class="code" href="class_o_t_item.html">OTItem</a>::error_state),
<a name="l01382"></a>01382     m_Status(<a class="code" href="class_o_t_item.html">OTItem</a>::request),
<a name="l01383"></a>01383     m_lNewOutboxTransNum(0),
<a name="l01384"></a>01384     m_lClosingTransactionNo(0)
<a name="l01385"></a>01385 {
<a name="l01386"></a>01386     <a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">InitItem</a>();
<a name="l01387"></a>01387     
<a name="l01388"></a>01388 }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390 
<a name="l01391"></a><a class="code" href="class_o_t_item.html#a66e2a726616905bd8109378f357a4679">01391</a> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem::OTItem</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theUserID, <span class="keyword">const</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; theOwner, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theType, <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> * pDestinationAcctID<span class="comment">/*=NULL*/</span>)
<a name="l01392"></a>01392         : <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a>(theUserID, theOwner.GetRealAccountID(), theOwner.GetRealServerID(), theOwner.GetTransactionNum()),
<a name="l01393"></a>01393     m_lAmount(0),
<a name="l01394"></a>01394     m_Type(<a class="code" href="class_o_t_item.html">OTItem</a>::error_state),
<a name="l01395"></a>01395     m_Status(<a class="code" href="class_o_t_item.html">OTItem</a>::request),
<a name="l01396"></a>01396     m_lNewOutboxTransNum(0),
<a name="l01397"></a>01397     m_lClosingTransactionNo(0)
<a name="l01398"></a>01398 {
<a name="l01399"></a>01399     <a class="code" href="class_o_t_item.html#a6d74f430a17311b58760f70fd445c9bd">InitItem</a>();
<a name="l01400"></a>01400     
<a name="l01401"></a>01401     <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>  = theType;  <span class="comment">// This has to be below the InitItem() call that appears just above</span>
<a name="l01402"></a>01402     
<a name="l01403"></a>01403     <span class="comment">// Most transactions items don&#39;t HAVE a &quot;to&quot; account, just a primary account.</span>
<a name="l01404"></a>01404     <span class="comment">// (If you deposit, or withdraw, you don&#39;t need a &quot;to&quot; account.)</span>
<a name="l01405"></a>01405     <span class="comment">// But for the ones that do, you can pass the &quot;to&quot; account&#39;s ID in </span>
<a name="l01406"></a>01406     <span class="comment">// as a pointer, and we&#39;ll set that too....</span>
<a name="l01407"></a>01407     <span class="keywordflow">if</span> (NULL != pDestinationAcctID)
<a name="l01408"></a>01408     {
<a name="l01409"></a>01409         <a class="code" href="class_o_t_item.html#a4edbde55bbf0770f9d1100b1d3750e38">m_AcctToID</a> = *pDestinationAcctID;
<a name="l01410"></a>01410     }   
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 
<a name="l01414"></a><a class="code" href="class_o_t_item.html#ab5075e429d52579375808be0caa93c2d">01414</a> <a class="code" href="class_o_t_item.html#ab5075e429d52579375808be0caa93c2d">OTItem::~OTItem</a>()
<a name="l01415"></a>01415 {
<a name="l01416"></a>01416     <a class="code" href="class_o_t_item.html#ad75db68db9f115259aa73f8d343a3f10">Release_Item</a>();
<a name="l01417"></a>01417 }
<a name="l01418"></a>01418 
<a name="l01419"></a>01419 
<a name="l01420"></a><a class="code" href="class_o_t_item.html#a5d9f9493c21479cad6bba7641f03f489">01420</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a5d9f9493c21479cad6bba7641f03f489">OTItem::Release</a>()
<a name="l01421"></a>01421 {
<a name="l01422"></a>01422     <a class="code" href="class_o_t_item.html#ad75db68db9f115259aa73f8d343a3f10">Release_Item</a>();
<a name="l01423"></a>01423     <span class="comment">// ----------------------</span>
<a name="l01424"></a>01424     <a class="code" href="class_o_t_transaction_type.html#aeec55f5abb43646745a532bf10aece24">ot_super::Release</a>();
<a name="l01425"></a>01425 }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 
<a name="l01428"></a><a class="code" href="class_o_t_item.html#ad75db68db9f115259aa73f8d343a3f10">01428</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#ad75db68db9f115259aa73f8d343a3f10">OTItem::Release_Item</a>()
<a name="l01429"></a>01429 {
<a name="l01430"></a>01430     <a class="code" href="class_o_t_item.html#a9f874bd43c5b62b1c4630a1f83899f6d">ReleaseItems</a>();
<a name="l01431"></a>01431     
<a name="l01432"></a>01432     <a class="code" href="class_o_t_item.html#a4edbde55bbf0770f9d1100b1d3750e38">m_AcctToID</a>.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
<a name="l01433"></a>01433     <a class="code" href="class_o_t_item.html#ac2864f331e417eff2544f8c541112689">m_lAmount</a> = 0;
<a name="l01434"></a>01434     <a class="code" href="class_o_t_item.html#abf3f938b875010e42bdf16e2668b1fd2">m_lNewOutboxTransNum</a> = 0;
<a name="l01435"></a>01435     <a class="code" href="class_o_t_item.html#a23162f8b538acbb6af67b1f771f791b9">m_lClosingTransactionNo</a> = 0;
<a name="l01436"></a>01436 }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438 
<a name="l01439"></a><a class="code" href="class_o_t_item.html#a9f874bd43c5b62b1c4630a1f83899f6d">01439</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a9f874bd43c5b62b1c4630a1f83899f6d">OTItem::ReleaseItems</a>()
<a name="l01440"></a>01440 {
<a name="l01441"></a>01441     <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = NULL;
<a name="l01442"></a>01442     
<a name="l01443"></a>01443     <span class="keywordflow">while</span> (!<a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>.empty())
<a name="l01444"></a>01444     {
<a name="l01445"></a>01445         pItem = <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>.front();
<a name="l01446"></a>01446         <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>.pop_front();
<a name="l01447"></a>01447         <span class="keyword">delete</span> pItem;
<a name="l01448"></a>01448         pItem = NULL;
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452 
<a name="l01453"></a><a class="code" href="_o_t_item_8cpp.html#acbf7c414ed402ee3e165e740d93714fc">01453</a> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> <a class="code" href="_o_t_item_8cpp.html#acbf7c414ed402ee3e165e740d93714fc">GetItemTypeFromString</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strType)
<a name="l01454"></a>01454 {
<a name="l01455"></a>01455     <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l01456"></a>01456     
<a name="l01457"></a>01457     <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transfer&quot;</span>))
<a name="l01458"></a>01458         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>;
<a name="l01459"></a>01459     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atTransfer&quot;</span>))
<a name="l01460"></a>01460         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac310111eca8eb295fb5dafddd884fc82">OTItem::atTransfer</a>;
<a name="l01461"></a>01461     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01462"></a>01462     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptTransaction&quot;</span>))
<a name="l01463"></a>01463         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a8d437fea3122fe59247f606d7e240118">OTItem::acceptTransaction</a>;
<a name="l01464"></a>01464     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptTransaction&quot;</span>))
<a name="l01465"></a>01465         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a00f43bf21e890c4dd11059fc834f1ef1">OTItem::atAcceptTransaction</a>;
<a name="l01466"></a>01466     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01467"></a>01467     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptMessage&quot;</span>))
<a name="l01468"></a>01468         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6d7747de96495046d982b4eb2a38e46f">OTItem::acceptMessage</a>;
<a name="l01469"></a>01469     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptMessage&quot;</span>))
<a name="l01470"></a>01470         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91caeadd2fc8999a11a392fb25b0b5c3">OTItem::atAcceptMessage</a>;
<a name="l01471"></a>01471     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01472"></a>01472     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptNotice&quot;</span>))
<a name="l01473"></a>01473         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a471cb7cb3653b339a64099dde1d26298">OTItem::acceptNotice</a>;
<a name="l01474"></a>01474     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptNotice&quot;</span>))
<a name="l01475"></a>01475         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3a3aa40758df2bff71b66962c0206a73">OTItem::atAcceptNotice</a>;
<a name="l01476"></a>01476     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01477"></a>01477     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptPending&quot;</span>))
<a name="l01478"></a>01478         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>;
<a name="l01479"></a>01479     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptPending&quot;</span>))
<a name="l01480"></a>01480         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5b0f7bfa18e29ce7d6ebcc861e541f4f">OTItem::atAcceptPending</a>;
<a name="l01481"></a>01481     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;rejectPending&quot;</span>))
<a name="l01482"></a>01482         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">OTItem::rejectPending</a>;
<a name="l01483"></a>01483     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atRejectPending&quot;</span>))
<a name="l01484"></a>01484         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a84f21da0049c428f2e74c573dfaff067">OTItem::atRejectPending</a>;
<a name="l01485"></a>01485     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01486"></a>01486     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptCronReceipt&quot;</span>))
<a name="l01487"></a>01487         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>;
<a name="l01488"></a>01488     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptCronReceipt&quot;</span>))
<a name="l01489"></a>01489         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3c0d4b5c591948114dbd2550cccb3b48">OTItem::atAcceptCronReceipt</a>;
<a name="l01490"></a>01490     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;disputeCronReceipt&quot;</span>))
<a name="l01491"></a>01491         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">OTItem::disputeCronReceipt</a>;
<a name="l01492"></a>01492     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDisputeCronReceipt&quot;</span>))
<a name="l01493"></a>01493         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a15fb11d5243db9056a4c340bc49cea43">OTItem::atDisputeCronReceipt</a>;
<a name="l01494"></a>01494     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptItemReceipt&quot;</span>))
<a name="l01495"></a>01495         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>;
<a name="l01496"></a>01496     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptItemReceipt&quot;</span>))
<a name="l01497"></a>01497         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a919386d460c64f76c562aa216523aa9f">OTItem::atAcceptItemReceipt</a>;
<a name="l01498"></a>01498     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;disputeItemReceipt&quot;</span>))
<a name="l01499"></a>01499         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">OTItem::disputeItemReceipt</a>;
<a name="l01500"></a>01500     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDisputeItemReceipt&quot;</span>))
<a name="l01501"></a>01501         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acd9426f6754691aebb202e9c14cdc681">OTItem::atDisputeItemReceipt</a>;
<a name="l01502"></a>01502     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01503"></a>01503 
<a name="l01504"></a>01504     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptFinalReceipt&quot;</span>))
<a name="l01505"></a>01505         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>;
<a name="l01506"></a>01506     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptFinalReceipt&quot;</span>))
<a name="l01507"></a>01507         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5034beca2e90df6b2b36022d365f1d38">OTItem::atAcceptFinalReceipt</a>;
<a name="l01508"></a>01508     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;disputeFinalReceipt&quot;</span>))
<a name="l01509"></a>01509         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">OTItem::disputeFinalReceipt</a>;
<a name="l01510"></a>01510     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDisputeFinalReceipt&quot;</span>))
<a name="l01511"></a>01511         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9b353f70c54facca58998d250badcf27">OTItem::atDisputeFinalReceipt</a>;
<a name="l01512"></a>01512     
<a name="l01513"></a>01513     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acceptBasketReceipt&quot;</span>))
<a name="l01514"></a>01514         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>;
<a name="l01515"></a>01515     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atAcceptBasketReceipt&quot;</span>))
<a name="l01516"></a>01516         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5901a9fad67b6756c6c6abcb131adc22">OTItem::atAcceptBasketReceipt</a>;
<a name="l01517"></a>01517     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;disputeBasketReceipt&quot;</span>))
<a name="l01518"></a>01518         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">OTItem::disputeBasketReceipt</a>;
<a name="l01519"></a>01519     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDisputeBasketReceipt&quot;</span>))
<a name="l01520"></a>01520         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9fc8674f161335439c48b2e9db277b9b">OTItem::atDisputeBasketReceipt</a>;
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01523"></a>01523     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;serverfee&quot;</span>))
<a name="l01524"></a>01524         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc891ffd6b8c7f2498f8bcda7a0831c">OTItem::serverfee</a>;
<a name="l01525"></a>01525     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atServerfee&quot;</span>))
<a name="l01526"></a>01526         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a31746a29eea9bf6eaed3d29a1d2d8f8e">OTItem::atServerfee</a>;
<a name="l01527"></a>01527     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;issuerfee&quot;</span>))
<a name="l01528"></a>01528         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a89f6f79d3f709412824c40619133f888">OTItem::issuerfee</a>;
<a name="l01529"></a>01529     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atIssuerfee&quot;</span>))
<a name="l01530"></a>01530         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abdb265afff50cc510218531a07efe1f7">OTItem::atIssuerfee</a>;
<a name="l01531"></a>01531     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01532"></a>01532     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;balanceStatement&quot;</span>))
<a name="l01533"></a>01533         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>;
<a name="l01534"></a>01534     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atBalanceStatement&quot;</span>))
<a name="l01535"></a>01535         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>;
<a name="l01536"></a>01536     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transactionStatement&quot;</span>))
<a name="l01537"></a>01537         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">OTItem::transactionStatement</a>;
<a name="l01538"></a>01538     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atTransactionStatement&quot;</span>))
<a name="l01539"></a>01539         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>;
<a name="l01540"></a>01540     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01541"></a>01541     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;withdrawal&quot;</span>))
<a name="l01542"></a>01542         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91dfa211f934207df229263a14672789">OTItem::withdrawal</a>;
<a name="l01543"></a>01543     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atWithdrawal&quot;</span>))
<a name="l01544"></a>01544         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a16a994b2323c05a6cd00ccbf57102be8">OTItem::atWithdrawal</a>;
<a name="l01545"></a>01545     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;deposit&quot;</span>))
<a name="l01546"></a>01546         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afd6e878bfcdf2d554b0c814d5da084d1">OTItem::deposit</a>;
<a name="l01547"></a>01547     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDeposit&quot;</span>))
<a name="l01548"></a>01548         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a814d6a51c7059307c8fe8d073fb9de9e">OTItem::atDeposit</a>;
<a name="l01549"></a>01549     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01550"></a>01550     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;withdrawVoucher&quot;</span>))
<a name="l01551"></a>01551         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a044b299744ed5d88b526470c0a3bbcf4">OTItem::withdrawVoucher</a>;
<a name="l01552"></a>01552     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atWithdrawVoucher&quot;</span>))
<a name="l01553"></a>01553         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a36d4c6faf8ad5aae6ea36fe5a66012c8">OTItem::atWithdrawVoucher</a>;
<a name="l01554"></a>01554     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;depositCheque&quot;</span>))
<a name="l01555"></a>01555         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>;
<a name="l01556"></a>01556     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDepositCheque&quot;</span>))
<a name="l01557"></a>01557         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae12946cd205221592c0fa44e4c7399b2">OTItem::atDepositCheque</a>;
<a name="l01558"></a>01558     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01559"></a>01559     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;payDividend&quot;</span>))
<a name="l01560"></a>01560         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a76baae22af2df636d404516ecf5ea06a">OTItem::payDividend</a>;
<a name="l01561"></a>01561     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atPayDividend&quot;</span>))
<a name="l01562"></a>01562         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae8f15961c19cf2d7645061df47e59650">OTItem::atPayDividend</a>;
<a name="l01563"></a>01563     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01564"></a>01564     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;marketOffer&quot;</span>))
<a name="l01565"></a>01565         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae973afad2dc8a8349e8889304b20e73b">OTItem::marketOffer</a>;
<a name="l01566"></a>01566     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atMarketOffer&quot;</span>))
<a name="l01567"></a>01567         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a229f0c7ace7a51840d7632910a0b92a6">OTItem::atMarketOffer</a>;
<a name="l01568"></a>01568     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01569"></a>01569     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentPlan&quot;</span>))
<a name="l01570"></a>01570         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">OTItem::paymentPlan</a>;
<a name="l01571"></a>01571     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atPaymentPlan&quot;</span>))
<a name="l01572"></a>01572         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc3c7556a790e7a7b6be464f8ea058b">OTItem::atPaymentPlan</a>;
<a name="l01573"></a>01573     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01574"></a>01574     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;smartContract&quot;</span>))
<a name="l01575"></a>01575         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">OTItem::smartContract</a>;
<a name="l01576"></a>01576     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atSmartContract&quot;</span>))
<a name="l01577"></a>01577         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1fe91e4cadee24de6acb9de56a55e4eb">OTItem::atSmartContract</a>;
<a name="l01578"></a>01578     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01579"></a>01579     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;cancelCronItem&quot;</span>))
<a name="l01580"></a>01580         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5db1c9a56286c66937eb57d460f2eb01">OTItem::cancelCronItem</a>;
<a name="l01581"></a>01581     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atCancelCronItem&quot;</span>))
<a name="l01582"></a>01582         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab3ded9d37de3a75d4b39735bb9aff341">OTItem::atCancelCronItem</a>;
<a name="l01583"></a>01583     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01584"></a>01584     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;exchangeBasket&quot;</span>))
<a name="l01585"></a>01585         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1332f32813f158436fd58abdddec855c">OTItem::exchangeBasket</a>;
<a name="l01586"></a>01586     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atExchangeBasket&quot;</span>))
<a name="l01587"></a>01587         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0b62f8efea6ed9bdefbc48ce2e97a8b6">OTItem::atExchangeBasket</a>;
<a name="l01588"></a>01588     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01589"></a>01589     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;chequeReceipt&quot;</span>))
<a name="l01590"></a>01590         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>;
<a name="l01591"></a>01591     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;voucherReceipt&quot;</span>))
<a name="l01592"></a>01592         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>;
<a name="l01593"></a>01593     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;marketReceipt&quot;</span>))
<a name="l01594"></a>01594         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>;
<a name="l01595"></a>01595     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentReceipt&quot;</span>))
<a name="l01596"></a>01596         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>;
<a name="l01597"></a>01597     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transferReceipt&quot;</span>))
<a name="l01598"></a>01598         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>;
<a name="l01599"></a>01599     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01600"></a>01600     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;finalReceipt&quot;</span>))
<a name="l01601"></a>01601         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>;
<a name="l01602"></a>01602     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;basketReceipt&quot;</span>))
<a name="l01603"></a>01603         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>;
<a name="l01604"></a>01604     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01605"></a>01605     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;replyNotice&quot;</span>))
<a name="l01606"></a>01606         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2e7b5819c105436d507ee05b176026d2">OTItem::replyNotice</a>;
<a name="l01607"></a>01607     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;successNotice&quot;</span>))
<a name="l01608"></a>01608         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab30dfb8a832a4094b8e75da6b47a8f5f">OTItem::successNotice</a>;
<a name="l01609"></a>01609     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;notice&quot;</span>))
<a name="l01610"></a>01610         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a72e8b39a09399b486754d11771f5dc56">OTItem::notice</a>;
<a name="l01611"></a>01611     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01612"></a>01612     <span class="keywordflow">else</span>
<a name="l01613"></a>01613         theType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l01614"></a>01614     <span class="comment">// --------------------------------------------------------------</span>
<a name="l01615"></a>01615     
<a name="l01616"></a>01616     <span class="keywordflow">return</span> theType;
<a name="l01617"></a>01617 }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619 
<a name="l01620"></a>01620 <span class="comment">// return -1 if error, 0 if nothing, and 1 if the node was processed.</span>
<a name="l01621"></a><a class="code" href="class_o_t_item.html#a372f9045cf80e7b35b59a808d0bfa8ee">01621</a> int32_t <a class="code" href="class_o_t_item.html#a372f9045cf80e7b35b59a808d0bfa8ee">OTItem::ProcessXMLNode</a>(<a class="code" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a>*&amp; xml)
<a name="l01622"></a>01622 {
<a name="l01623"></a>01623     <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;item&quot;</span>, xml-&gt;getNodeName()))
<a name="l01624"></a>01624     {   
<a name="l01625"></a>01625         <a class="code" href="class_o_t_string.html">OTString</a> strType, strStatus;
<a name="l01626"></a>01626         
<a name="l01627"></a>01627         strType     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>);
<a name="l01628"></a>01628         strStatus   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;status&quot;</span>);
<a name="l01629"></a>01629         
<a name="l01630"></a>01630         <span class="comment">// Type</span>
<a name="l01631"></a>01631         <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a> = <a class="code" href="_o_t_item_8cpp.html#acbf7c414ed402ee3e165e740d93714fc">GetItemTypeFromString</a>(strType); <span class="comment">// just above.</span>
<a name="l01632"></a>01632         <span class="comment">// ----------------------------------------</span>
<a name="l01633"></a>01633         <span class="comment">// Status</span>
<a name="l01634"></a>01634         <span class="keywordflow">if</span> (strStatus.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;request&quot;</span>))
<a name="l01635"></a>01635             <a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a> = <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a16fa1b0df4dbad1367dbd0f6dbac9572">OTItem::request</a>;
<a name="l01636"></a>01636         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strStatus.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;acknowledgement&quot;</span>))
<a name="l01637"></a>01637             <a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a> = <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>;
<a name="l01638"></a>01638         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strStatus.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;rejection&quot;</span>))
<a name="l01639"></a>01639             <a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a> = <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>;
<a name="l01640"></a>01640         <span class="keywordflow">else</span>
<a name="l01641"></a>01641             <a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a> = <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a9c66e01dc01aeab4ec0c3ed055e45012">OTItem::error_status</a>;
<a name="l01642"></a>01642         
<a name="l01643"></a>01643         <a class="code" href="class_o_t_string.html">OTString</a> strAcctFromID, strAcctToID, strServerID, strUserID, strOutboxNewTransNum;
<a name="l01644"></a>01644         
<a name="l01645"></a>01645         strAcctFromID       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;fromAccountID&quot;</span>); 
<a name="l01646"></a>01646         strAcctToID         = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;toAccountID&quot;</span>); 
<a name="l01647"></a>01647         strServerID         = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;serverID&quot;</span>);
<a name="l01648"></a>01648         strUserID           = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;userID&quot;</span>);
<a name="l01649"></a>01649         <span class="comment">// --------------------------------------------------------</span>
<a name="l01650"></a>01650         strOutboxNewTransNum = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;outboxNewTransNum&quot;</span>);
<a name="l01651"></a>01651 
<a name="l01652"></a>01652         <span class="keywordflow">if</span> (strOutboxNewTransNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01653"></a>01653             <a class="code" href="class_o_t_item.html#abf3f938b875010e42bdf16e2668b1fd2">m_lNewOutboxTransNum</a> = atol(strOutboxNewTransNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01654"></a>01654         <span class="comment">// --------------------------------------------------------</span>
<a name="l01655"></a>01655         <span class="comment">// an OTTransaction::blank may now contain 20 or 100 new numbers.</span>
<a name="l01656"></a>01656         <span class="comment">// Therefore, the OTItem::acceptTransaction must contain the same list,</span>
<a name="l01657"></a>01657         <span class="comment">// otherwise you haven&#39;t actually SIGNED for the list, have you!</span>
<a name="l01658"></a>01658         <span class="comment">//</span>
<a name="l01659"></a>01659         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a8d437fea3122fe59247f606d7e240118">OTItem::acceptTransaction</a>  == <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>)
<a name="l01660"></a>01660         {
<a name="l01661"></a>01661             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTotalList = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;totalListOfNumbers&quot;</span>);
<a name="l01662"></a>01662             <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
<a name="l01663"></a>01663             
<a name="l01664"></a>01664             <span class="keywordflow">if</span> (strTotalList.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01665"></a>01665                 <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.Add(strTotalList); <span class="comment">// (Comma-separated list of numbers now becomes std::set&lt;int64_t&gt;.)</span>
<a name="l01666"></a>01666         }
<a name="l01667"></a>01667         <span class="comment">// --------------------------------------------------------</span>
<a name="l01668"></a>01668         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    ACCOUNT_ID(strAcctFromID), 
<a name="l01669"></a>01669                         SERVER_ID(strServerID),
<a name="l01670"></a>01670                         DESTINATION_ACCOUNT(strAcctToID),
<a name="l01671"></a>01671                         USER_ID(strUserID);
<a name="l01672"></a>01672         <span class="comment">// --------------------------------------------------------</span>
<a name="l01673"></a>01673         <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(ACCOUNT_ID);      <span class="comment">// OTTransactionType::m_AcctID  the PURPORTED Account ID</span>
<a name="l01674"></a>01674         <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(SERVER_ID);        <span class="comment">// OTTransactionType::m_AcctServerID the PURPORTED Server ID</span>
<a name="l01675"></a>01675         <a class="code" href="class_o_t_item.html#a1c9bf7b456bb8891ce5632b6721ac22f">SetDestinationAcctID</a>(DESTINATION_ACCOUNT);
<a name="l01676"></a>01676         <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(USER_ID);
<a name="l01677"></a>01677         <span class="comment">// --------------------------------------------------------</span>
<a name="l01678"></a>01678         <span class="keywordflow">if</span> (<span class="keyword">false</span> ==  <a class="code" href="class_o_t_transaction_type.html#a05be1cf5d51725a4b427d5ac9714234b">m_bLoadSecurely</a>)
<a name="l01679"></a>01679         {
<a name="l01680"></a>01680             <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(ACCOUNT_ID);
<a name="l01681"></a>01681             <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(SERVER_ID);
<a name="l01682"></a>01682         }
<a name="l01683"></a>01683         <span class="comment">// -------------------------------------------</span>
<a name="l01684"></a>01684         <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l01685"></a>01685         
<a name="l01686"></a>01686         strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numberOfOrigin&quot;</span>);
<a name="l01687"></a>01687         <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01688"></a>01688             this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01689"></a>01689 
<a name="l01690"></a>01690         strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transactionNum&quot;</span>);
<a name="l01691"></a>01691         <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01692"></a>01692             this-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01693"></a>01693         
<a name="l01694"></a>01694         strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;inReferenceTo&quot;</span>);
<a name="l01695"></a>01695         <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01696"></a>01696             this-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01697"></a>01697         <span class="comment">// --------------------------------------------------------     </span>
<a name="l01698"></a>01698         <a class="code" href="class_o_t_item.html#ac2864f331e417eff2544f8c541112689">m_lAmount</a>   = atol(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;amount&quot;</span>));
<a name="l01699"></a>01699         <span class="comment">// --------------------------------------------------------</span>
<a name="l01700"></a>01700         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;Loaded transaction Item, transaction num %lld, In Reference To: %lld, type: %s, status: %s\n&quot;</span>,
<a name="l01701"></a>01701 <span class="comment">//              &quot;fromAccountID:\n%s\n UserID:\n%s\n toAccountID:\n%s\n serverID:\n%s\n----------\n&quot;, </span>
<a name="l01702"></a>01702                 <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l01703"></a>01703                 <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strStatus.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()
<a name="l01704"></a>01704 <span class="comment">//              strAcctFromID.Get(), strUserID.Get(), strAcctToID.Get(), strServerID.Get()</span>
<a name="l01705"></a>01705                 );
<a name="l01706"></a>01706         
<a name="l01707"></a>01707         <span class="keywordflow">return</span> 1;
<a name="l01708"></a>01708     }
<a name="l01709"></a>01709     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;note&quot;</span>, xml-&gt;getNodeName())) 
<a name="l01710"></a>01710     {       
<a name="l01711"></a>01711         <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, <a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>))
<a name="l01712"></a>01712         {
<a name="l01713"></a>01713             <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTItem::ProcessXMLNode: note field without value.\n&quot;</span>);
<a name="l01714"></a>01714             <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
<a name="l01715"></a>01715         }
<a name="l01716"></a>01716         
<a name="l01717"></a>01717         <span class="keywordflow">return</span> 1;
<a name="l01718"></a>01718     }
<a name="l01719"></a>01719     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;inReferenceTo&quot;</span>, xml-&gt;getNodeName())) 
<a name="l01720"></a>01720     {       
<a name="l01721"></a>01721         <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, <a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>))
<a name="l01722"></a>01722         {
<a name="l01723"></a>01723             <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTItem::ProcessXMLNode: inReferenceTo field without value.\n&quot;</span>);
<a name="l01724"></a>01724             <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
<a name="l01725"></a>01725         }
<a name="l01726"></a>01726         
<a name="l01727"></a>01727         <span class="keywordflow">return</span> 1;
<a name="l01728"></a>01728     }
<a name="l01729"></a>01729     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;attachment&quot;</span>, xml-&gt;getNodeName())) 
<a name="l01730"></a>01730     {       
<a name="l01731"></a>01731         <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, <a class="code" href="class_o_t_item.html#a0608b516a156e4f21eef59096bca6d49">m_ascAttachment</a>))
<a name="l01732"></a>01732         {
<a name="l01733"></a>01733             <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTItem::ProcessXMLNode: attachment field without value.\n&quot;</span>);
<a name="l01734"></a>01734             <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
<a name="l01735"></a>01735         }
<a name="l01736"></a>01736         
<a name="l01737"></a>01737         <span class="keywordflow">return</span> 1;
<a name="l01738"></a>01738     }
<a name="l01739"></a>01739     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;transactionReport&quot;</span>, xml-&gt;getNodeName())) 
<a name="l01740"></a>01740     {       
<a name="l01741"></a>01741         <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>   == <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>) ||
<a name="l01742"></a>01742             (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a> == <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>))
<a name="l01743"></a>01743         {
<a name="l01744"></a>01744             <span class="comment">// Notice it initializes with the wrong transaction number, in this case.</span>
<a name="l01745"></a>01745             <span class="comment">// That&#39;s okay, because I&#39;m setting it below with pItem-&gt;SetTransactionNum...</span>
<a name="l01746"></a>01746             <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_item.html#ae106d359e658dbfc747775a5f2cc1f14">OTItem</a>(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), *<span class="keyword">this</span>); <span class="comment">// But I&#39;ve also got ITEM types with the same names...</span>
<a name="l01747"></a>01747             <span class="comment">// That way, it will translate the string and set the type correctly.</span>
<a name="l01748"></a>01748             <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);                       <span class="comment">// That way I can use each item to REPRESENT an inbox transaction</span>
<a name="l01749"></a>01749             
<a name="l01750"></a>01750             <span class="comment">// Type</span>
<a name="l01751"></a>01751             <a class="code" href="class_o_t_string.html">OTString</a> strType;       
<a name="l01752"></a>01752             strType     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>); <span class="comment">// it&#39;s reading a TRANSACTION type: chequeReceipt, voucherReceipt, marketReceipt, or paymentReceipt. But I also have the same names for item types.</span>
<a name="l01753"></a>01753             
<a name="l01754"></a>01754             pItem-&gt;<a class="code" href="class_o_t_item.html#a3a771053c1f16e4538577f720b30c85a">SetType</a>(<a class="code" href="_o_t_item_8cpp.html#acbf7c414ed402ee3e165e740d93714fc">GetItemTypeFromString</a>(strType)); <span class="comment">// It&#39;s actually translating a transaction type to an item type. (Same names in the case of the 3 receipts that matter for inbox reports for balance agreements.)</span>
<a name="l01755"></a>01755             
<a name="l01756"></a>01756             pItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(atol(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;adjustment&quot;</span>)));
<a name="l01757"></a>01757             
<a name="l01758"></a>01758             <span class="comment">// Status</span>
<a name="l01759"></a>01759             pItem-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>); <span class="comment">// I don&#39;t need this, but I&#39;d rather it not say error state. This way if it changes to error_state later, I know I had a problem.</span>
<a name="l01760"></a>01760             
<a name="l01761"></a>01761             <a class="code" href="class_o_t_string.html">OTString</a> strAccountID, strServerID, strUserID;
<a name="l01762"></a>01762             
<a name="l01763"></a>01763             strAccountID    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;accountID&quot;</span>); 
<a name="l01764"></a>01764             strServerID     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;serverID&quot;</span>);
<a name="l01765"></a>01765             strUserID       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;userID&quot;</span>);
<a name="l01766"></a>01766             
<a name="l01767"></a>01767             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    ACCOUNT_ID(strAccountID), SERVER_ID(strServerID), USER_ID(strUserID);
<a name="l01768"></a>01768             
<a name="l01769"></a>01769             pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(ACCOUNT_ID);   <span class="comment">// OTTransactionType::m_AcctID  the PURPORTED Account ID</span>
<a name="l01770"></a>01770             pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(SERVER_ID);     <span class="comment">// OTTransactionType::m_AcctServerID the PURPORTED Server ID</span>
<a name="l01771"></a>01771             pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(USER_ID);
<a name="l01772"></a>01772             
<a name="l01773"></a>01773             <span class="comment">// --------------------</span>
<a name="l01774"></a>01774 
<a name="l01775"></a>01775             <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l01776"></a>01776             
<a name="l01777"></a>01777             strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numberOfOrigin&quot;</span>);
<a name="l01778"></a>01778             <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01779"></a>01779                 pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01780"></a>01780             
<a name="l01781"></a>01781             strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transactionNum&quot;</span>);
<a name="l01782"></a>01782             <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01783"></a>01783                 pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01784"></a>01784             
<a name="l01785"></a>01785             strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;inReferenceTo&quot;</span>);
<a name="l01786"></a>01786             <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01787"></a>01787                 pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01788"></a>01788             
<a name="l01789"></a>01789             strTemp = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;closingTransactionNum&quot;</span>); <span class="comment">// only used in the inbox report for balance agreement.</span>
<a name="l01790"></a>01790             <span class="keywordflow">if</span> (strTemp.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l01791"></a>01791                 pItem-&gt;<a class="code" href="class_o_t_item.html#ac32063404467c6754fd61727293d6b63">SetClosingNum</a>(atol(strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
<a name="l01792"></a>01792             
<a name="l01793"></a>01793             <span class="comment">// --------------------</span>
<a name="l01794"></a>01794             
<a name="l01795"></a>01795             <a class="code" href="class_o_t_item.html#aeb2726026df1021187b12ba760a91c2f">AddItem</a>(*pItem);    <span class="comment">// &lt;======= adding to list.</span>
<a name="l01796"></a>01796             
<a name="l01797"></a>01797             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;Loaded transactionReport Item, transaction num %lld, In Reference To: %lld, type: %s\n&quot;</span>,
<a name="l01798"></a>01798 <span class="comment">//                         &quot;fromAccountID:\n%s\n UserID:\n%s\n toAccountID:\n%s\n serverID:\n%s\n----------\n&quot;, </span>
<a name="l01799"></a>01799                            pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l01800"></a>01800                            pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()
<a name="l01801"></a>01801 <span class="comment">//                         strAcctFromID.Get(), strUserID.Get(), strAcctToID.Get(), strServerID.Get()</span>
<a name="l01802"></a>01802                            );
<a name="l01803"></a>01803         }
<a name="l01804"></a>01804         <span class="keywordflow">else</span> 
<a name="l01805"></a>01805         {
<a name="l01806"></a>01806             <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Outbox hash in item wrong type (expected balanceStatement or atBalanceStatement.\n&quot;</span>);
<a name="l01807"></a>01807         }
<a name="l01808"></a>01808         
<a name="l01809"></a>01809         <span class="keywordflow">return</span> 1;
<a name="l01810"></a>01810     }
<a name="l01811"></a>01811     
<a name="l01812"></a>01812     <span class="keywordflow">return</span> 0;   
<a name="l01813"></a>01813 }
<a name="l01814"></a>01814 
<a name="l01815"></a>01815 
<a name="l01816"></a>01816 <span class="comment">// Used in balance agreement, part of the inbox report.</span>
<a name="l01817"></a><a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">01817</a> int64_t <a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">OTItem::GetClosingNum</a>()<span class="keyword"> const</span>
<a name="l01818"></a>01818 <span class="keyword"></span>{
<a name="l01819"></a>01819     <span class="keywordflow">return</span> <a class="code" href="class_o_t_item.html#a23162f8b538acbb6af67b1f771f791b9">m_lClosingTransactionNo</a>; 
<a name="l01820"></a>01820 }   
<a name="l01821"></a>01821 
<a name="l01822"></a>01822 
<a name="l01823"></a><a class="code" href="class_o_t_item.html#ac32063404467c6754fd61727293d6b63">01823</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#ac32063404467c6754fd61727293d6b63">OTItem::SetClosingNum</a>(<span class="keyword">const</span> int64_t lClosingNum)
<a name="l01824"></a>01824 {
<a name="l01825"></a>01825     <a class="code" href="class_o_t_item.html#a23162f8b538acbb6af67b1f771f791b9">m_lClosingTransactionNo</a> = lClosingNum;
<a name="l01826"></a>01826 }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828 
<a name="l01829"></a><a class="code" href="class_o_t_item.html#a80ad2642c02d17a024ac84f976ae5488">01829</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#a80ad2642c02d17a024ac84f976ae5488">OTItem::GetStringFromType</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theType, <a class="code" href="class_o_t_string.html">OTString</a> &amp; strType)
<a name="l01830"></a>01830 {
<a name="l01831"></a>01831     <span class="keywordflow">switch</span> (theType) 
<a name="l01832"></a>01832     {
<a name="l01833"></a>01833         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>:
<a name="l01834"></a>01834             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;transfer&quot;</span>);
<a name="l01835"></a>01835             <span class="keywordflow">break</span>;
<a name="l01836"></a>01836         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a8d437fea3122fe59247f606d7e240118">OTItem::acceptTransaction</a>:
<a name="l01837"></a>01837             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptTransaction&quot;</span>);
<a name="l01838"></a>01838             <span class="keywordflow">break</span>;
<a name="l01839"></a>01839         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6d7747de96495046d982b4eb2a38e46f">OTItem::acceptMessage</a>:
<a name="l01840"></a>01840             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptMessage&quot;</span>);
<a name="l01841"></a>01841             <span class="keywordflow">break</span>;
<a name="l01842"></a>01842         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a471cb7cb3653b339a64099dde1d26298">OTItem::acceptNotice</a>:
<a name="l01843"></a>01843             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptNotice&quot;</span>);
<a name="l01844"></a>01844             <span class="keywordflow">break</span>;
<a name="l01845"></a>01845         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>:
<a name="l01846"></a>01846             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptPending&quot;</span>);
<a name="l01847"></a>01847             <span class="keywordflow">break</span>;
<a name="l01848"></a>01848         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">OTItem::rejectPending</a>:
<a name="l01849"></a>01849             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;rejectPending&quot;</span>);
<a name="l01850"></a>01850             <span class="keywordflow">break</span>;
<a name="l01851"></a>01851         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>:
<a name="l01852"></a>01852             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptCronReceipt&quot;</span>);
<a name="l01853"></a>01853             <span class="keywordflow">break</span>;
<a name="l01854"></a>01854         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">OTItem::disputeCronReceipt</a>:
<a name="l01855"></a>01855             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;disputeCronReceipt&quot;</span>);
<a name="l01856"></a>01856             <span class="keywordflow">break</span>;
<a name="l01857"></a>01857         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>:
<a name="l01858"></a>01858             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptItemReceipt&quot;</span>);
<a name="l01859"></a>01859             <span class="keywordflow">break</span>;
<a name="l01860"></a>01860         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">OTItem::disputeItemReceipt</a>:
<a name="l01861"></a>01861             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;disputeItemReceipt&quot;</span>);
<a name="l01862"></a>01862             <span class="keywordflow">break</span>;
<a name="l01863"></a>01863         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>:
<a name="l01864"></a>01864             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptFinalReceipt&quot;</span>);
<a name="l01865"></a>01865             <span class="keywordflow">break</span>;
<a name="l01866"></a>01866         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>:
<a name="l01867"></a>01867             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acceptBasketReceipt&quot;</span>);
<a name="l01868"></a>01868             <span class="keywordflow">break</span>;
<a name="l01869"></a>01869         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">OTItem::disputeFinalReceipt</a>:
<a name="l01870"></a>01870             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;disputeFinalReceipt&quot;</span>);
<a name="l01871"></a>01871             <span class="keywordflow">break</span>;
<a name="l01872"></a>01872         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">OTItem::disputeBasketReceipt</a>:
<a name="l01873"></a>01873             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;disputeBasketReceipt&quot;</span>);
<a name="l01874"></a>01874             <span class="keywordflow">break</span>;
<a name="l01875"></a>01875         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc891ffd6b8c7f2498f8bcda7a0831c">OTItem::serverfee</a>:
<a name="l01876"></a>01876             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;serverfee&quot;</span>);
<a name="l01877"></a>01877             <span class="keywordflow">break</span>;
<a name="l01878"></a>01878         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a89f6f79d3f709412824c40619133f888">OTItem::issuerfee</a>:
<a name="l01879"></a>01879             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;issuerfee&quot;</span>);
<a name="l01880"></a>01880             <span class="keywordflow">break</span>;
<a name="l01881"></a>01881         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91dfa211f934207df229263a14672789">OTItem::withdrawal</a>:
<a name="l01882"></a>01882             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;withdrawal&quot;</span>);
<a name="l01883"></a>01883             <span class="keywordflow">break</span>;
<a name="l01884"></a>01884         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afd6e878bfcdf2d554b0c814d5da084d1">OTItem::deposit</a>:
<a name="l01885"></a>01885             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;deposit&quot;</span>);
<a name="l01886"></a>01886             <span class="keywordflow">break</span>;
<a name="l01887"></a>01887         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a044b299744ed5d88b526470c0a3bbcf4">OTItem::withdrawVoucher</a>:
<a name="l01888"></a>01888             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;withdrawVoucher&quot;</span>);
<a name="l01889"></a>01889             <span class="keywordflow">break</span>;
<a name="l01890"></a>01890         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>:
<a name="l01891"></a>01891             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;depositCheque&quot;</span>);
<a name="l01892"></a>01892             <span class="keywordflow">break</span>;
<a name="l01893"></a>01893         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a76baae22af2df636d404516ecf5ea06a">OTItem::payDividend</a>:
<a name="l01894"></a>01894             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;payDividend&quot;</span>);
<a name="l01895"></a>01895             <span class="keywordflow">break</span>;
<a name="l01896"></a>01896         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae973afad2dc8a8349e8889304b20e73b">OTItem::marketOffer</a>:
<a name="l01897"></a>01897             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;marketOffer&quot;</span>);
<a name="l01898"></a>01898             <span class="keywordflow">break</span>;
<a name="l01899"></a>01899         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">OTItem::paymentPlan</a>:
<a name="l01900"></a>01900             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;paymentPlan&quot;</span>);
<a name="l01901"></a>01901             <span class="keywordflow">break</span>;
<a name="l01902"></a>01902         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">OTItem::smartContract</a>:
<a name="l01903"></a>01903             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;smartContract&quot;</span>);
<a name="l01904"></a>01904             <span class="keywordflow">break</span>;
<a name="l01905"></a>01905         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>:
<a name="l01906"></a>01906             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;balanceStatement&quot;</span>);
<a name="l01907"></a>01907             <span class="keywordflow">break</span>;
<a name="l01908"></a>01908         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">OTItem::transactionStatement</a>:
<a name="l01909"></a>01909             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;transactionStatement&quot;</span>);
<a name="l01910"></a>01910             <span class="keywordflow">break</span>;
<a name="l01911"></a>01911             
<a name="l01912"></a>01912         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5db1c9a56286c66937eb57d460f2eb01">OTItem::cancelCronItem</a>:
<a name="l01913"></a>01913             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;cancelCronItem&quot;</span>);
<a name="l01914"></a>01914             <span class="keywordflow">break</span>;
<a name="l01915"></a>01915         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1332f32813f158436fd58abdddec855c">OTItem::exchangeBasket</a>:
<a name="l01916"></a>01916             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;exchangeBasket&quot;</span>);
<a name="l01917"></a>01917             <span class="keywordflow">break</span>;
<a name="l01918"></a>01918             
<a name="l01919"></a>01919         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab3ded9d37de3a75d4b39735bb9aff341">OTItem::atCancelCronItem</a>:
<a name="l01920"></a>01920             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atCancelCronItem&quot;</span>);
<a name="l01921"></a>01921             <span class="keywordflow">break</span>;
<a name="l01922"></a>01922         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0b62f8efea6ed9bdefbc48ce2e97a8b6">OTItem::atExchangeBasket</a>:
<a name="l01923"></a>01923             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atExchangeBasket&quot;</span>);
<a name="l01924"></a>01924             <span class="keywordflow">break</span>;
<a name="l01925"></a>01925             
<a name="l01926"></a>01926         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>:         <span class="comment">// used for inbox statements in balance agreement.</span>
<a name="l01927"></a>01927             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;chequeReceipt&quot;</span>);
<a name="l01928"></a>01928             <span class="keywordflow">break</span>;
<a name="l01929"></a>01929         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:        <span class="comment">// used for inbox statements in balance agreement.</span>
<a name="l01930"></a>01930             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;voucherReceipt&quot;</span>);
<a name="l01931"></a>01931             <span class="keywordflow">break</span>;
<a name="l01932"></a>01932         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>:         <span class="comment">// used as market receipt, and also for inbox statement containing market receipt will use this as well.</span>
<a name="l01933"></a>01933             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;marketReceipt&quot;</span>);
<a name="l01934"></a>01934             <span class="keywordflow">break</span>;
<a name="l01935"></a>01935         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:        <span class="comment">// used as payment receipt, also used in inbox statement as payment receipt.</span>
<a name="l01936"></a>01936             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;paymentReceipt&quot;</span>);
<a name="l01937"></a>01937             <span class="keywordflow">break</span>;
<a name="l01938"></a>01938         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>:       <span class="comment">// used in inbox statement as transfer receipt.</span>
<a name="l01939"></a>01939             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;transferReceipt&quot;</span>);
<a name="l01940"></a>01940             <span class="keywordflow">break</span>;
<a name="l01941"></a>01941         <span class="comment">// -----------------------------------</span>
<a name="l01942"></a>01942         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>:      <span class="comment">// used for final receipt. Also used in inbox statement as final receipt. (For expiring or cancelled Cron Item.)</span>
<a name="l01943"></a>01943             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;finalReceipt&quot;</span>);
<a name="l01944"></a>01944             <span class="keywordflow">break</span>;
<a name="l01945"></a>01945         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>:     <span class="comment">// used in inbox statement as basket receipt. (For exchange.)</span>
<a name="l01946"></a>01946             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;basketReceipt&quot;</span>);
<a name="l01947"></a>01947             <span class="keywordflow">break</span>;
<a name="l01948"></a>01948         <span class="comment">// -----------------------------------</span>
<a name="l01949"></a>01949         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a72e8b39a09399b486754d11771f5dc56">OTItem::notice</a>:        <span class="comment">// used in Nymbox statement as notification from server.</span>
<a name="l01950"></a>01950             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;notice&quot;</span>);
<a name="l01951"></a>01951             <span class="keywordflow">break</span>;
<a name="l01952"></a>01952         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2e7b5819c105436d507ee05b176026d2">OTItem::replyNotice</a>:       <span class="comment">// some server replies (to your request) have a copy dropped into your nymbox, to make sure you received it.</span>
<a name="l01953"></a>01953             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;replyNotice&quot;</span>);
<a name="l01954"></a>01954             <span class="keywordflow">break</span>;
<a name="l01955"></a>01955         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab30dfb8a832a4094b8e75da6b47a8f5f">OTItem::successNotice</a>:     <span class="comment">// used in Nymbox statement as notification from server of successful sign-out of a trans#.</span>
<a name="l01956"></a>01956             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;successNotice&quot;</span>);
<a name="l01957"></a>01957             <span class="keywordflow">break</span>;
<a name="l01958"></a>01958             
<a name="l01959"></a>01959             
<a name="l01960"></a>01960             
<a name="l01961"></a>01961         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac310111eca8eb295fb5dafddd884fc82">OTItem::atTransfer</a>:
<a name="l01962"></a>01962             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atTransfer&quot;</span>);
<a name="l01963"></a>01963             <span class="keywordflow">break</span>;
<a name="l01964"></a>01964         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a00f43bf21e890c4dd11059fc834f1ef1">OTItem::atAcceptTransaction</a>:
<a name="l01965"></a>01965             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptTransaction&quot;</span>);
<a name="l01966"></a>01966             <span class="keywordflow">break</span>;
<a name="l01967"></a>01967         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91caeadd2fc8999a11a392fb25b0b5c3">OTItem::atAcceptMessage</a>:
<a name="l01968"></a>01968             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptMessage&quot;</span>);
<a name="l01969"></a>01969             <span class="keywordflow">break</span>;
<a name="l01970"></a>01970         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3a3aa40758df2bff71b66962c0206a73">OTItem::atAcceptNotice</a>:
<a name="l01971"></a>01971             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptNotice&quot;</span>);
<a name="l01972"></a>01972             <span class="keywordflow">break</span>;
<a name="l01973"></a>01973         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5b0f7bfa18e29ce7d6ebcc861e541f4f">OTItem::atAcceptPending</a>:
<a name="l01974"></a>01974             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptPending&quot;</span>);
<a name="l01975"></a>01975             <span class="keywordflow">break</span>;
<a name="l01976"></a>01976         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a84f21da0049c428f2e74c573dfaff067">OTItem::atRejectPending</a>:
<a name="l01977"></a>01977             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atRejectPending&quot;</span>);
<a name="l01978"></a>01978             <span class="keywordflow">break</span>;
<a name="l01979"></a>01979         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3c0d4b5c591948114dbd2550cccb3b48">OTItem::atAcceptCronReceipt</a>:
<a name="l01980"></a>01980             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptCronReceipt&quot;</span>);
<a name="l01981"></a>01981             <span class="keywordflow">break</span>;
<a name="l01982"></a>01982         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a15fb11d5243db9056a4c340bc49cea43">OTItem::atDisputeCronReceipt</a>:
<a name="l01983"></a>01983             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDisputeCronReceipt&quot;</span>);
<a name="l01984"></a>01984             <span class="keywordflow">break</span>;
<a name="l01985"></a>01985         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a919386d460c64f76c562aa216523aa9f">OTItem::atAcceptItemReceipt</a>:
<a name="l01986"></a>01986             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptItemReceipt&quot;</span>);
<a name="l01987"></a>01987             <span class="keywordflow">break</span>;
<a name="l01988"></a>01988         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acd9426f6754691aebb202e9c14cdc681">OTItem::atDisputeItemReceipt</a>:
<a name="l01989"></a>01989             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDisputeItemReceipt&quot;</span>);
<a name="l01990"></a>01990             <span class="keywordflow">break</span>;
<a name="l01991"></a>01991             
<a name="l01992"></a>01992         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5034beca2e90df6b2b36022d365f1d38">OTItem::atAcceptFinalReceipt</a>:
<a name="l01993"></a>01993             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptFinalReceipt&quot;</span>);
<a name="l01994"></a>01994             <span class="keywordflow">break</span>;
<a name="l01995"></a>01995         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5901a9fad67b6756c6c6abcb131adc22">OTItem::atAcceptBasketReceipt</a>:
<a name="l01996"></a>01996             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atAcceptBasketReceipt&quot;</span>);
<a name="l01997"></a>01997             <span class="keywordflow">break</span>;
<a name="l01998"></a>01998         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9b353f70c54facca58998d250badcf27">OTItem::atDisputeFinalReceipt</a>:
<a name="l01999"></a>01999             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDisputeFinalReceipt&quot;</span>);
<a name="l02000"></a>02000             <span class="keywordflow">break</span>;
<a name="l02001"></a>02001         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9fc8674f161335439c48b2e9db277b9b">OTItem::atDisputeBasketReceipt</a>:
<a name="l02002"></a>02002             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDisputeBasketReceipt&quot;</span>);
<a name="l02003"></a>02003             <span class="keywordflow">break</span>;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a31746a29eea9bf6eaed3d29a1d2d8f8e">OTItem::atServerfee</a>:
<a name="l02006"></a>02006             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atServerfee&quot;</span>);
<a name="l02007"></a>02007             <span class="keywordflow">break</span>;
<a name="l02008"></a>02008         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abdb265afff50cc510218531a07efe1f7">OTItem::atIssuerfee</a>:
<a name="l02009"></a>02009             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atIssuerfee&quot;</span>);
<a name="l02010"></a>02010             <span class="keywordflow">break</span>;
<a name="l02011"></a>02011         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a16a994b2323c05a6cd00ccbf57102be8">OTItem::atWithdrawal</a>:
<a name="l02012"></a>02012             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atWithdrawal&quot;</span>);
<a name="l02013"></a>02013             <span class="keywordflow">break</span>;
<a name="l02014"></a>02014         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a814d6a51c7059307c8fe8d073fb9de9e">OTItem::atDeposit</a>:
<a name="l02015"></a>02015             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDeposit&quot;</span>);
<a name="l02016"></a>02016             <span class="keywordflow">break</span>;
<a name="l02017"></a>02017         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a36d4c6faf8ad5aae6ea36fe5a66012c8">OTItem::atWithdrawVoucher</a>:
<a name="l02018"></a>02018             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atWithdrawVoucher&quot;</span>);
<a name="l02019"></a>02019             <span class="keywordflow">break</span>;
<a name="l02020"></a>02020         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae12946cd205221592c0fa44e4c7399b2">OTItem::atDepositCheque</a>:
<a name="l02021"></a>02021             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atDepositCheque&quot;</span>);
<a name="l02022"></a>02022             <span class="keywordflow">break</span>;
<a name="l02023"></a>02023         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae8f15961c19cf2d7645061df47e59650">OTItem::atPayDividend</a>:
<a name="l02024"></a>02024             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atPayDividend&quot;</span>);
<a name="l02025"></a>02025             <span class="keywordflow">break</span>;
<a name="l02026"></a>02026         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a229f0c7ace7a51840d7632910a0b92a6">OTItem::atMarketOffer</a>:
<a name="l02027"></a>02027             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atMarketOffer&quot;</span>);
<a name="l02028"></a>02028             <span class="keywordflow">break</span>;
<a name="l02029"></a>02029         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc3c7556a790e7a7b6be464f8ea058b">OTItem::atPaymentPlan</a>:
<a name="l02030"></a>02030             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atPaymentPlan&quot;</span>);
<a name="l02031"></a>02031             <span class="keywordflow">break</span>;
<a name="l02032"></a>02032         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1fe91e4cadee24de6acb9de56a55e4eb">OTItem::atSmartContract</a>:
<a name="l02033"></a>02033             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atSmartContract&quot;</span>);
<a name="l02034"></a>02034             <span class="keywordflow">break</span>;
<a name="l02035"></a>02035         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>:
<a name="l02036"></a>02036             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atBalanceStatement&quot;</span>);
<a name="l02037"></a>02037             <span class="keywordflow">break</span>;
<a name="l02038"></a>02038         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>:
<a name="l02039"></a>02039             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;atTransactionStatement&quot;</span>);
<a name="l02040"></a>02040             <span class="keywordflow">break</span>;
<a name="l02041"></a>02041             
<a name="l02042"></a>02042         <span class="keywordflow">default</span>:
<a name="l02043"></a>02043             strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;error-unknown&quot;</span>);
<a name="l02044"></a>02044             <span class="keywordflow">break</span>;
<a name="l02045"></a>02045     }
<a name="l02046"></a>02046     
<a name="l02047"></a>02047 }
<a name="l02048"></a>02048 
<a name="l02049"></a>02049 
<a name="l02050"></a><a class="code" href="class_o_t_item.html#ae12909b9f97f5b71b4ddeda5debdfa70">02050</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_item.html#ae12909b9f97f5b71b4ddeda5debdfa70">OTItem::UpdateContents</a>() <span class="comment">// Before transmission or serialization, this is where the ledger saves its contents </span>
<a name="l02051"></a>02051 {
<a name="l02052"></a>02052     <a class="code" href="class_o_t_string.html">OTString</a> strListOfBlanks;   <span class="comment">// IF this item is &quot;acceptTransaction&quot; then this will serialize the list of transaction numbers being accepted. (They now support multiple numbers.)</span>
<a name="l02053"></a>02053     <span class="comment">// ----------------------------------------</span>
<a name="l02054"></a>02054     <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>) 
<a name="l02055"></a>02055     {
<a name="l02056"></a>02056         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a8d437fea3122fe59247f606d7e240118">OTItem::acceptTransaction</a>:
<a name="l02057"></a>02057         {
<a name="l02058"></a>02058             <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0) <span class="comment">// This is always 0, except for OTItem::acceptTransaction.</span>
<a name="l02059"></a>02059             {
<a name="l02060"></a>02060                 <a class="code" href="class_o_t_string.html">OTString</a> strNumbers;
<a name="l02061"></a>02061                 <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strNumbers)) 
<a name="l02062"></a>02062                     strListOfBlanks.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; totalListOfNumbers=\&quot;%s\&quot;\n&quot;</span>, strNumbers.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02063"></a>02063                 <span class="keywordflow">else</span> <span class="comment">// (False just means m_Numlist was empty.)</span>
<a name="l02064"></a>02064                     strListOfBlanks.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;&quot;</span>);                    
<a name="l02065"></a>02065             }
<a name="l02066"></a>02066         }
<a name="l02067"></a>02067         <span class="keywordflow">default</span>:
<a name="l02068"></a>02068             <span class="keywordflow">break</span>;
<a name="l02069"></a>02069     }
<a name="l02070"></a>02070     <span class="comment">// -----------------------------------------------------</span>
<a name="l02071"></a>02071     <a class="code" href="class_o_t_string.html">OTString</a> strFromAcctID(<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()), strToAcctID(<a class="code" href="class_o_t_item.html#af9112e8a87e6cb1c785df0e0be59c99b">GetDestinationAcctID</a>()), strServerID(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()), 
<a name="l02072"></a>02072              strType, strStatus, strUserID(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
<a name="l02073"></a>02073     
<a name="l02074"></a>02074     <a class="code" href="class_o_t_item.html#a80ad2642c02d17a024ac84f976ae5488">GetStringFromType</a>(<a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>, strType);
<a name="l02075"></a>02075     
<a name="l02076"></a>02076     <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_item.html#a484f599a89c4c24e64924e02e7414e55">m_Status</a>) {
<a name="l02077"></a>02077         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a16fa1b0df4dbad1367dbd0f6dbac9572">OTItem::request</a>:
<a name="l02078"></a>02078             strStatus.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;request&quot;</span>);
<a name="l02079"></a>02079             <span class="keywordflow">break</span>;
<a name="l02080"></a>02080         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>:
<a name="l02081"></a>02081             strStatus.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;acknowledgement&quot;</span>);
<a name="l02082"></a>02082             <span class="keywordflow">break</span>;
<a name="l02083"></a>02083         <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>:
<a name="l02084"></a>02084             strStatus.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;rejection&quot;</span>);
<a name="l02085"></a>02085             <span class="keywordflow">break</span>;
<a name="l02086"></a>02086         <span class="keywordflow">default</span>:
<a name="l02087"></a>02087             strStatus.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;error-unknown&quot;</span>);
<a name="l02088"></a>02088             <span class="keywordflow">break</span>;
<a name="l02089"></a>02089     }
<a name="l02090"></a>02090     
<a name="l02091"></a>02091     <span class="comment">// I release this because I&#39;m about to repopulate it.</span>
<a name="l02092"></a>02092     <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
<a name="l02093"></a>02093         
<a name="l02094"></a>02094     
<a name="l02095"></a>02095     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#abf3f938b875010e42bdf16e2668b1fd2">m_lNewOutboxTransNum</a> &gt; 0) 
<a name="l02096"></a>02096         <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;item type=\&quot;%s\&quot;\n status=\&quot;%s\&quot;\n&quot;</span>  
<a name="l02097"></a>02097                                   <span class="stringliteral">&quot; outboxNewTransNum=\&quot;%lld\&quot;\n&quot;</span> <span class="comment">// only used in server reply item: atBalanceStatement. In cases where the statement includes a new outbox item, this variable is used to transport the new transaction number (generated on server side for that new outbox item) back to the client, so the client knows the transaction number to verify when he is verifying the outbox against the last signed receipt.</span>
<a name="l02098"></a>02098                                   <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02099"></a>02099                                   <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02100"></a>02100                                   <span class="stringliteral">&quot; serverID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02101"></a>02101                                   <span class="stringliteral">&quot; userID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02102"></a>02102                                   <span class="stringliteral">&quot; fromAccountID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02103"></a>02103                                   <span class="stringliteral">&quot; toAccountID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02104"></a>02104                                   <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot;\n&quot;</span> 
<a name="l02105"></a>02105                                   <span class="stringliteral">&quot; amount=\&quot;%lld\&quot; &gt;\n\n&quot;</span>, 
<a name="l02106"></a>02106                                   strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strStatus.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
<a name="l02107"></a>02107                                   <a class="code" href="class_o_t_item.html#abf3f938b875010e42bdf16e2668b1fd2">m_lNewOutboxTransNum</a>,
<a name="l02108"></a>02108                                   <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(), <span class="comment">// GetRaw so it doesn&#39;t calculate.</span>
<a name="l02109"></a>02109                                   <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l02110"></a>02110                                   strServerID.Get(),
<a name="l02111"></a>02111                                   strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
<a name="l02112"></a>02112                                   strFromAcctID.Get(), strToAcctID.Get(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), <a class="code" href="class_o_t_item.html#ac2864f331e417eff2544f8c541112689">m_lAmount</a>);
<a name="l02113"></a>02113     <span class="keywordflow">else</span>
<a name="l02114"></a>02114         <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;item type=\&quot;%s\&quot;\n status=\&quot;%s\&quot;\n&quot;</span>
<a name="l02115"></a>02115                                   <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02116"></a>02116                                   <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n%s&quot;</span>
<a name="l02117"></a>02117                                   <span class="stringliteral">&quot; serverID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02118"></a>02118                                   <span class="stringliteral">&quot; userID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02119"></a>02119                                   <span class="stringliteral">&quot; fromAccountID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02120"></a>02120                                   <span class="stringliteral">&quot; toAccountID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02121"></a>02121                                   <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot;\n&quot;</span> 
<a name="l02122"></a>02122                                   <span class="stringliteral">&quot; amount=\&quot;%lld\&quot; &gt;\n\n&quot;</span>, 
<a name="l02123"></a>02123                                   strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strStatus.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
<a name="l02124"></a>02124                                   <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(), <span class="comment">// GetRaw so it doesn&#39;t calculate.</span>
<a name="l02125"></a>02125                                   <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), strListOfBlanks.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
<a name="l02126"></a>02126                                   strServerID.Get(), 
<a name="l02127"></a>02127                                   strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
<a name="l02128"></a>02128                                   strFromAcctID.Get(), strToAcctID.Get(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), <a class="code" href="class_o_t_item.html#ac2864f331e417eff2544f8c541112689">m_lAmount</a>);
<a name="l02129"></a>02129         
<a name="l02130"></a>02130     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
<a name="l02131"></a>02131     {
<a name="l02132"></a>02132         <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;note&gt;\n%s&lt;/note&gt;\n\n&quot;</span>, <a class="code" href="class_o_t_item.html#a34b1d1073b9513674d71f31f48d29e64">m_ascNote</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02133"></a>02133     }
<a name="l02134"></a>02134     
<a name="l02135"></a>02135     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
<a name="l02136"></a>02136     {
<a name="l02137"></a>02137         <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;inReferenceTo&gt;\n%s&lt;/inReferenceTo&gt;\n\n&quot;</span>, <a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02138"></a>02138     }
<a name="l02139"></a>02139     
<a name="l02140"></a>02140     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a0608b516a156e4f21eef59096bca6d49">m_ascAttachment</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2)
<a name="l02141"></a>02141     {
<a name="l02142"></a>02142         <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;attachment&gt;\n%s&lt;/attachment&gt;\n\n&quot;</span>, <a class="code" href="class_o_t_item.html#a0608b516a156e4f21eef59096bca6d49">m_ascAttachment</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02143"></a>02143     }
<a name="l02144"></a>02144     
<a name="l02145"></a>02145     <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>   == <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>) ||
<a name="l02146"></a>02146         (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a> == <a class="code" href="class_o_t_item.html#abd4d8f3e226a88fdc3eb4a2f4de3b424">m_Type</a>))
<a name="l02147"></a>02147     {
<a name="l02148"></a>02148     
<a name="l02149"></a>02149         <span class="comment">// --------------------------------------------------------------</span>
<a name="l02150"></a>02150         <span class="comment">// loop through the sub-items (only used for balance agreement.)</span>
<a name="l02151"></a>02151         <span class="comment">//</span>
<a name="l02152"></a>02152         <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_item.html#afc184b72e183dc897b040443f3f7e939">m_listItems</a>)
<a name="l02153"></a>02153         {
<a name="l02154"></a>02154             <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l02155"></a>02155             <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
<a name="l02156"></a>02156             
<a name="l02157"></a>02157             <a class="code" href="class_o_t_string.html">OTString</a>    strAcctID(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()), 
<a name="l02158"></a>02158                         strServerID(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()),
<a name="l02159"></a>02159                         strUserID(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
<a name="l02160"></a>02160             
<a name="l02161"></a>02161             <a class="code" href="class_o_t_string.html">OTString</a> strReceiptType;
<a name="l02162"></a>02162             <a class="code" href="class_o_t_item.html#a80ad2642c02d17a024ac84f976ae5488">GetStringFromType</a>(pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>(), strReceiptType);
<a name="l02163"></a>02163             
<a name="l02164"></a>02164             <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;transactionReport type=\&quot;%s\&quot;\n&quot;</span>
<a name="l02165"></a>02165                                       <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02166"></a>02166                                       <span class="stringliteral">&quot; accountID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02167"></a>02167                                       <span class="stringliteral">&quot; userID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02168"></a>02168                                       <span class="stringliteral">&quot; serverID=\&quot;%s\&quot;\n&quot;</span>
<a name="l02169"></a>02169                                       <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02170"></a>02170                                       <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02171"></a>02171                                       <span class="stringliteral">&quot; closingTransactionNum=\&quot;%lld\&quot;\n&quot;</span>
<a name="l02172"></a>02172                                       <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
<a name="l02173"></a>02173                                       strReceiptType.Exists() ? strReceiptType.Get() : <span class="stringliteral">&quot;error_state&quot;</span>, 
<a name="l02174"></a>02174                                       pItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(),
<a name="l02175"></a>02175                                       strAcctID.Get(), 
<a name="l02176"></a>02176                                       strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
<a name="l02177"></a>02177                                       strServerID.Get(), 
<a name="l02178"></a>02178                                       pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
<a name="l02179"></a>02179                                       pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
<a name="l02180"></a>02180                                       pItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>(),
<a name="l02181"></a>02181                                       pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l02182"></a>02182         } <span class="comment">// FOR_EACH</span>
<a name="l02183"></a>02183         <span class="comment">// --------------------------------------------------------------</span>
<a name="l02184"></a>02184     }
<a name="l02185"></a>02185     
<a name="l02186"></a>02186     <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;/item&gt;\n&quot;</span>);                 
<a name="l02187"></a>02187 }
<a name="l02188"></a>02188 
<a name="l02189"></a>02189 
<a name="l02190"></a><a class="code" href="class_o_t_item.html#a5e7c7ddcd8add2a1d2bb90b8576346ba">02190</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_item.html#a5e7c7ddcd8add2a1d2bb90b8576346ba">OTItem::SaveContractWallet</a>(std::ofstream &amp; ofs)
<a name="l02191"></a>02191 {
<a name="l02192"></a>02192     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02193"></a>02193 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_o_t_item_8cpp.html">OTItem.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:03 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
