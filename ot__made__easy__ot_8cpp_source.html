<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otapi/ot_made_easy_ot.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ot__made__easy__ot_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otapi/ot_made_easy_ot.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ot__made__easy__ot_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// This is a library written in OTScript, which makes the OT-API</span>
<a name="l00003"></a>00003 <span class="comment">// much easier to use from inside your own OTScripts, by providing</span>
<a name="l00004"></a>00004 <span class="comment">// a higher-level layer.</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Think of it as the &quot;standard header&quot; for using OT from a script.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// There is similar code to this in Java also, in the OTAPI_Func and</span>
<a name="l00009"></a>00009 <span class="comment">// Utility classes, in the Moneychanger project. They also make the</span>
<a name="l00010"></a>00010 <span class="comment">// OTAPI much easier to use, by providing a higher-level layer.</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">//  http://www.chaiscript.com/doxygen/namespace_chai_script___language.html</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// *************************************************************************************</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">// This is even HIGHER level than otapi.ot!!  This uses those calls to provide a</span>
<a name="l00018"></a>00018 <span class="comment">// single function interface to most of OT.  Like, &quot;WithdrawVoucher&quot; would go here,</span>
<a name="l00019"></a>00019 <span class="comment">// and basically copy the Moneychanger code.</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="ot__made__easy__ot_8hpp.html">ot_made_easy_ot.hpp</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="ot__utility__ot_8hpp.html">ot_utility_ot.hpp</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="ot__otapi__ot_8hpp.html">ot_otapi_ot.hpp</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="ot__commands__ot_8hpp.html">ot_commands_ot.hpp</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_a_p_i_8hpp.html">OTAPI.hpp</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="_o_t___m_e_8hpp.html">OT_ME.hpp</a>&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">// Returns:</span>
<a name="l00037"></a>00037 <span class="comment">//  True if I have enough numbers, or if there was success getting more transaction numbers.</span>
<a name="l00038"></a>00038 <span class="comment">//  False if I didn&#39;t have enough numbers, tried to get more, and failed somehow.</span>
<a name="l00039"></a>00039 <span class="comment">//</span>
<a name="l00040"></a><a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">00040</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(<span class="keyword">const</span> int32_t nNumberNeeded, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID)
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042     <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l00043"></a>00043     <span class="keywordtype">bool</span> bReturnVal = <span class="keyword">true</span>;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nNumberNeeded))
<a name="l00046"></a>00046     {
<a name="l00047"></a>00047         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;insure_enough_nums: expected nNumberNeeded to be an integer. (Should never happen.)\n&quot;</span>);
<a name="l00048"></a>00048         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051     <span class="comment">// Make sure we have at least one transaction number (to write the cheque...)</span>
<a name="l00052"></a>00052     <span class="comment">//</span>
<a name="l00053"></a>00053     int32_t nTransCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a0b35639651447ceac951f602fb83beec">OTAPI_Wrap::GetNym_TransactionNumCount</a>(strMyServerID, strMyNymID);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     <span class="keywordflow">if</span> (nTransCount &lt; nNumberNeeded)
<a name="l00056"></a>00056     {
<a name="l00057"></a>00057         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;insure_enough_nums: I don&#39;t have enough transaction numbers. Grabbing more now...\n&quot;</span>);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         <span class="keywordtype">bool</span> bGotten = MsgUtil.<a class="code" href="class_utility.html#af469bfc39379af23989e185469bb9dbd">getTransactionNumbers</a>(strMyServerID, strMyNymID, <span class="keyword">true</span>);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="keywordtype">bool</span> bWasMsgSent = <span class="keyword">false</span>;
<a name="l00062"></a>00062         <span class="keywordtype">bool</span> bForceDownload = <span class="keyword">false</span>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="keywordtype">bool</span> bRefresh = <a class="code" href="class_o_t___command.html#aeea974132386efc333d2346bd50a7286">OT_Command::details_refresh_nym</a>(strMyServerID, strMyNymID, bWasMsgSent, bForceDownload);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         <span class="keywordflow">if</span> (!bRefresh)
<a name="l00067"></a>00067         {
<a name="l00068"></a>00068             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="comment">// Try again.</span>
<a name="l00072"></a>00072         <span class="comment">//</span>
<a name="l00073"></a>00073         nTransCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a0b35639651447ceac951f602fb83beec">OTAPI_Wrap::GetNym_TransactionNumCount</a>(strMyServerID, strMyNymID);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (nTransCount &lt; nNumberNeeded)
<a name="l00076"></a>00076         {
<a name="l00077"></a>00077             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;insure_enough_nums: I still don&#39;t have enough transaction numbers (I have &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nTransCount) + <span class="stringliteral">&quot;, but I need &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nNumberNeeded) + <span class="stringliteral">&quot;.)\n(Tried grabbing some, but failed somehow.)\n&quot;</span>);
<a name="l00078"></a>00078             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080         <span class="keywordflow">else</span> { bReturnVal = <span class="keyword">true</span>; }
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="keywordflow">return</span> bReturnVal;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">// REGISTER NYM AT SERVER (or download nymfile, if nym already registered.)</span>
<a name="l00088"></a>00088 <span class="comment">//</span>
<a name="l00089"></a><a class="code" href="class_made_easy.html#a07143f0e507862b06e83a539cd2ac25e">00089</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a07143f0e507862b06e83a539cd2ac25e">MadeEasy::register_nym</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56aaeefcfe6f24ec67eba1bcaa1f1868c9b">CREATE_USER_ACCT</a>, SERVER_ID, NYM_ID);
<a name="l00094"></a>00094     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;CREATE_USER_ACCT&quot;</span>);
<a name="l00095"></a>00095     int32_t nSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="keywordflow">if</span>(1 == nSuccess)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099          <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101          <span class="comment">// Use the getRequest command, thus insuring that the request number is in sync.</span>
<a name="l00102"></a>00102          <span class="comment">//</span>
<a name="l00103"></a>00103          <span class="keywordflow">if</span> (1 != MsgUtil.<a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(SERVER_ID, NYM_ID))
<a name="l00104"></a>00104          {
<a name="l00105"></a>00105              <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Succeeded in register_nym, but strange: then failed calling getRequest, to sync the request number for the first time.\n&quot;</span>);
<a name="l00106"></a>00106              <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00107"></a>00107          }
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="keywordflow">else</span>
<a name="l00110"></a>00110     {
<a name="l00111"></a>00111         <span class="comment">// maybe an invalid server ID or the server contract isn&#39;t available (do AddServerContract(..) first)</span>
<a name="l00112"></a>00112         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed to register_nym.\n&quot;</span>);
<a name="l00113"></a>00113         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="keywordflow">return</span> strResponse;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">// RETRIEVE NYM INTERMEDIARY FILES</span>
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="class_made_easy.html#a396a002b857819de530037a6ed584761">00122</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> int32_t <a class="code" href="class_made_easy.html#a396a002b857819de530037a6ed584761">MadeEasy::retrieve_nym</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keywordtype">bool</span> &amp; bWasMsgSent, <span class="keyword">const</span> <span class="keywordtype">bool</span> bForceDownload)
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (1 != MsgUtil.<a class="code" href="class_utility.html#afd115fbf7b749ce17059191a07865edf">getRequestNumber</a>(strServerID, strMyNymID))
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed calling getRequest, to sync the request number. (Finished.)\n&quot;</span>);
<a name="l00130"></a>00130         <span class="keywordflow">return</span> -1;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132     <span class="keywordflow">else</span> <span class="comment">// If it returns 1, we know for sure that the request number is in sync.</span>
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS syncronizing the request number.\n&quot;</span>);
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     int32_t nGetAndProcessNymbox = MsgUtil.<a class="code" href="class_utility.html#ad6d2691529e14cbcdc6023797428aa26">getAndProcessNymbox_4</a>(strServerID, strMyNymID, bWasMsgSent, bForceDownload);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">return</span> nGetAndProcessNymbox;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">// CHECK USER (download a public key)</span>
<a name="l00144"></a>00144 <span class="comment">//</span>
<a name="l00145"></a><a class="code" href="class_made_easy.html#acc13cef8eb96edf236d63387a4c8a53d">00145</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#acc13cef8eb96edf236d63387a4c8a53d">MadeEasy::check_user</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; TARGET_NYM_ID)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a31b2cfafd1333b01ea861ab852985466">CHECK_USER</a>, SERVER_ID, NYM_ID, TARGET_NYM_ID);
<a name="l00150"></a>00150     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;CHECK_USER&quot;</span>);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keywordflow">return</span> strResponse;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">//  CREATE NYM (pseudonym)</span>
<a name="l00157"></a>00157 <span class="comment">//  returns new Nym ID</span>
<a name="l00158"></a>00158 <span class="comment">//</span>
<a name="l00159"></a><a class="code" href="class_made_easy.html#acb35d04a0d75d93209922fe7e51e26ee">00159</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#acb35d04a0d75d93209922fe7e51e26ee">MadeEasy::create_pseudonym</a>(<span class="keyword">const</span> int32_t nKeybits, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymIDSource, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAltLocation)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;OT_ME_create_pseudonym&quot;</span>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordtype">string</span> strNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6bbf5aae22dd8c18eb4b9386900d39bf">OTAPI_Wrap::CreateNym</a>(nKeybits, strNymIDSource, strAltLocation);<span class="comment">// returns new Nym ID;</span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymID))
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failed in OT_API_CreateNym(keybits == &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nKeybits) + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">return</span> strNymID;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="comment">//  ISSUE ASSET TYPE</span>
<a name="l00175"></a>00175 <span class="comment">//</span>
<a name="l00176"></a><a class="code" href="class_made_easy.html#a597fed5020e986c6ef6c8ab42796533a">00176</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a597fed5020e986c6ef6c8ab42796533a">MadeEasy::issue_asset_type</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_CONTRACT)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a28e6e670ca0771db5218bae9da1d2499">ISSUE_ASSET_TYPE</a>, SERVER_ID, NYM_ID, THE_CONTRACT);
<a name="l00181"></a>00181     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;ISSUE_ASSET_TYPE&quot;</span>);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">return</span> strResponse;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">//  ISSUE BASKET CURRENCY</span>
<a name="l00188"></a>00188 <span class="comment">//</span>
<a name="l00189"></a><a class="code" href="class_made_easy.html#a027f244740ac52415d63ae63807a759d">00189</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a027f244740ac52415d63ae63807a759d">MadeEasy::issue_basket_currency</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_BASKET)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a052e44a405e75325b36be9d99cca9a9b">ISSUE_BASKET</a>, SERVER_ID, NYM_ID, THE_BASKET);
<a name="l00194"></a>00194     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;ISSUE_BASKET&quot;</span>);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">return</span> strResponse;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">//  EXCHANGE BASKET CURRENCY</span>
<a name="l00201"></a>00201 <span class="comment">//</span>
<a name="l00202"></a><a class="code" href="class_made_easy.html#ac0108669d340f7078a766e999d4509fc">00202</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#ac0108669d340f7078a766e999d4509fc">MadeEasy::exchange_basket_currency</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_TYPE, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_BASKET, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">bool</span> IN_OR_OUT)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     int32_t nTransNumsNeeded = (<a class="code" href="class_o_t_a_p_i___wrap.html#a146bb3bffd9449a4e03239715f6e6558">OTAPI_Wrap::Basket_GetMemberCount</a>(THE_BASKET) + 1);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a7c2e5d14c45f08dde80a0b8aee24f003">EXCHANGE_BASKET</a>, SERVER_ID, NYM_ID, ASSET_TYPE, THE_BASKET, ACCT_ID, IN_OR_OUT, nTransNumsNeeded);
<a name="l00209"></a>00209     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;EXCHANGE_BASKET&quot;</span>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <span class="keywordflow">return</span> strResponse;
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">//  RETRIEVE CONTRACT</span>
<a name="l00216"></a>00216 <span class="comment">//</span>
<a name="l00217"></a><a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">00217</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">MadeEasy::retrieve_contract</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; CONTRACT_ID)
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a19c97cfa57d9def51585ae4f051817f8">GET_CONTRACT</a>, SERVER_ID, NYM_ID, CONTRACT_ID);
<a name="l00222"></a>00222     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_CONTRACT&quot;</span>);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">return</span> strResponse;
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">//  LOAD OR RETRIEVE CONTRACT</span>
<a name="l00229"></a>00229 <span class="comment">//</span>
<a name="l00230"></a><a class="code" href="class_made_easy.html#a40fb6b2438337545a6d677259415c2ff">00230</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a40fb6b2438337545a6d677259415c2ff">MadeEasy::load_or_retrieve_contract</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; CONTRACT_ID)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordtype">string</span> strContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a2f31b0655824666123eb389bb06b92d4">OTAPI_Wrap::LoadAssetContract</a>(CONTRACT_ID);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l00237"></a>00237     {
<a name="l00238"></a>00238         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">retrieve_contract</a>(SERVER_ID, NYM_ID, CONTRACT_ID);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (1 == <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l00241"></a>00241         {
<a name="l00242"></a>00242             strContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a2f31b0655824666123eb389bb06b92d4">OTAPI_Wrap::LoadAssetContract</a>(CONTRACT_ID);
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">return</span> strContract; <span class="comment">// might be null.</span>
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">//  CREATE ASSET ACCOUNT</span>
<a name="l00251"></a>00251 <span class="comment">//</span>
<a name="l00252"></a><a class="code" href="class_made_easy.html#a31e2b75076aaf7a244b463b2d7edc54b">00252</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a31e2b75076aaf7a244b463b2d7edc54b">MadeEasy::create_asset_acct</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_TYPE_ID)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a7be5a8bff95b1b2d72380f76c4896f96">CREATE_ASSET_ACCT</a>, SERVER_ID, NYM_ID, ASSET_TYPE_ID);
<a name="l00257"></a>00257     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;CREATE_ASSET_ACCT&quot;</span>);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="keywordflow">return</span> strResponse;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="class_made_easy.html#a3ad1fb67e91e244734b63f24d93c686b">00263</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a3ad1fb67e91e244734b63f24d93c686b">MadeEasy::stat_asset_account</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCOUNT_ID)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265     <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a18999957d285b958c3f683d3460a0b3f">OTAPI_Wrap::GetAccountWallet_Name</a>(ACCOUNT_ID);
<a name="l00266"></a>00266     <span class="keywordtype">string</span> strNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(ACCOUNT_ID);
<a name="l00267"></a>00267     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(ACCOUNT_ID);
<a name="l00268"></a>00268     <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(ACCOUNT_ID);
<a name="l00269"></a>00269     int64_t lBalance = <a class="code" href="class_o_t_a_p_i___wrap.html#a8f2d5f06ab2a0527f589a5af757989c3">OTAPI_Wrap::GetAccountWallet_Balance</a>(ACCOUNT_ID);
<a name="l00270"></a>00270     <span class="keywordtype">string</span> strAssetTypeName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAssetID);
<a name="l00271"></a>00271     <span class="keywordtype">string</span> strNymName = <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strNymID);
<a name="l00272"></a>00272     <span class="keywordtype">string</span> strServerName = <a class="code" href="class_o_t_a_p_i___wrap.html#a856f371dd21dba6d6777b6bd087b9518">OTAPI_Wrap::GetServer_Name</a>(strServerID);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">return</span>(<span class="stringliteral">&quot;   Balance: &quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetID, lBalance) + <span class="stringliteral">&quot;   (&quot;</span> + strName + <span class="stringliteral">&quot;)\nAccount ID: &quot;</span> + ACCOUNT_ID + <span class="stringliteral">&quot; ( &quot;</span> + strName + <span class="stringliteral">&quot; )\nAsset Type: &quot;</span> + strAssetID + <span class="stringliteral">&quot; ( &quot;</span> + strAssetTypeName + <span class="stringliteral">&quot; )\nOwner Nym:  &quot;</span> + strNymID + <span class="stringliteral">&quot; ( &quot;</span> + strNymName + <span class="stringliteral">&quot; )\nServer:     &quot;</span> + strServerID + <span class="stringliteral">&quot; ( &quot;</span> + strServerName + <span class="stringliteral">&quot; )&quot;</span>);
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">// DOWNLOAD ACCOUNT FILES  (account balance, inbox, outbox, etc)</span>
<a name="l00279"></a>00279 <span class="comment">//</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">// returns true/false</span>
<a name="l00282"></a><a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">00282</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCOUNT_ID, <span class="keyword">const</span> <span class="keywordtype">bool</span> bForceDownload) <span class="comment">// bForceDownload=false</span>
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keywordtype">bool</span> bResponse = MsgUtil.<a class="code" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">getIntermediaryFiles</a>(SERVER_ID, NYM_ID, ACCOUNT_ID, bForceDownload);
<a name="l00287"></a>00287     <span class="keywordflow">return</span> bResponse;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">// SEND TRANSFER  -- TRANSACTION</span>
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="class_made_easy.html#a1b7b8f9b17b7d193dd34255b6d9e64ae">00293</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a1b7b8f9b17b7d193dd34255b6d9e64ae">MadeEasy::send_transfer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_FROM, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_TO, <span class="keyword">const</span> int64_t AMOUNT, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NOTE)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ac0211269544859d85ae9e90ac9262a4b">SEND_TRANSFER</a>, SERVER_ID, NYM_ID, ACCT_FROM, ACCT_TO, AMOUNT, NOTE);
<a name="l00298"></a>00298     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;SEND_TRANSFER&quot;</span>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">return</span> strResponse;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="comment">// PROCESS INBOX  -- TRANSACTION</span>
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="class_made_easy.html#a4882d47a967272a7314e875a70dd82a9">00306</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a4882d47a967272a7314e875a70dd82a9">MadeEasy::process_inbox</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCOUNT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RESPONSE_LEDGER)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a60f6b431e9777794b4f0066e7339adbe">PROCESS_INBOX</a>, SERVER_ID, NYM_ID, ACCOUNT_ID, RESPONSE_LEDGER);
<a name="l00311"></a>00311     <span class="keywordtype">string</span> strResponse = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;PROCESS_INBOX&quot;</span>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordflow">return</span> strResponse;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="comment">// load_public_key():</span>
<a name="l00320"></a>00320 <span class="comment">//</span>
<a name="l00321"></a>00321 <span class="comment">// Load a public key from local storage, and return it (or null).</span>
<a name="l00322"></a>00322 <span class="comment">//</span>
<a name="l00323"></a><a class="code" href="class_made_easy.html#a77f5bf87fe1efe5a66a573ac13ec53d2">00323</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a77f5bf87fe1efe5a66a573ac13ec53d2">MadeEasy::load_public_encryption_key</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID) <span class="comment">// from local storage.</span>
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nload_public_encryption_key: Trying to load public key, assuming Nym isn&#39;t in the local wallet...\n&quot;</span>);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordtype">string</span> strPubkey = <a class="code" href="class_o_t_a_p_i___wrap.html#a9cc42ef08cd1d0b30311df16a09df8cd">OTAPI_Wrap::LoadPubkey_Encryption</a>(NYM_ID);<span class="comment">// This version is for &quot;other people&quot;;</span>
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPubkey))
<a name="l00332"></a>00332     {
<a name="l00333"></a>00333         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nload_public_encryption_key: Didn&#39;t find the Nym (&quot;</span> + NYM_ID + <span class="stringliteral">&quot;) as an &#39;other&#39; user, so next, checking to see if there&#39;s a pubkey available for one of the local private Nyms...\n&quot;</span>);
<a name="l00334"></a>00334         strPubkey = <a class="code" href="class_o_t_a_p_i___wrap.html#a5929fd26fdd02068d9343dd2e19cf252">OTAPI_Wrap::LoadUserPubkey_Encryption</a>(NYM_ID);<span class="comment">// This version is for &quot;the user sitting at the machine.&quot;;</span>
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPubkey))
<a name="l00337"></a>00337         {
<a name="l00338"></a>00338             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nload_public_encryption_key: Didn&#39;t find him as a local Nym either... returning NULL.\n&quot;</span>);
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     <span class="keywordflow">return</span> strPubkey; <span class="comment">// might be null.;</span>
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment">// load_public_key():</span>
<a name="l00345"></a>00345 <span class="comment">//</span>
<a name="l00346"></a>00346 <span class="comment">// Load a public key from local storage, and return it (or null).</span>
<a name="l00347"></a>00347 <span class="comment">//</span>
<a name="l00348"></a><a class="code" href="class_made_easy.html#aeaa563a1ad38e7436690868534fa3d71">00348</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#aeaa563a1ad38e7436690868534fa3d71">MadeEasy::load_public_signing_key</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID) <span class="comment">// from local storage.</span>
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="keywordtype">string</span> strPubkey = <a class="code" href="class_o_t_a_p_i___wrap.html#ab3845bcdefeca96fef653e521fd4e6c4">OTAPI_Wrap::LoadPubkey_Signing</a>(NYM_ID);<span class="comment">// This version is for &quot;other people&quot;;</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPubkey))
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356         strPubkey = <a class="code" href="class_o_t_a_p_i___wrap.html#a63c22c3901a217243b4e4b4c14115ade">OTAPI_Wrap::LoadUserPubkey_Signing</a>(NYM_ID);<span class="comment">// This version is for &quot;the user sitting at the machine.&quot;;</span>
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358     <span class="keywordflow">return</span> strPubkey; <span class="comment">// might be null.;</span>
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">//</span>
<a name="l00362"></a>00362 <span class="comment">// load_or_retrieve_pubkey()</span>
<a name="l00363"></a>00363 <span class="comment">//</span>
<a name="l00364"></a>00364 <span class="comment">// Load TARGET_NYM_ID from local storage.</span>
<a name="l00365"></a>00365 <span class="comment">// If not there, then retrieve TARGET_NYM_ID from server,</span>
<a name="l00366"></a>00366 <span class="comment">// using NYM_ID to send check_user request. Then re-load</span>
<a name="l00367"></a>00367 <span class="comment">// and return. (Might still return null.)</span>
<a name="l00368"></a>00368 <span class="comment">//</span>
<a name="l00369"></a><a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">00369</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">MadeEasy::load_or_retrieve_encrypt_key</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; TARGET_NYM_ID)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="keywordtype">string</span> strPubkey = <a class="code" href="class_made_easy.html#a77f5bf87fe1efe5a66a573ac13ec53d2">load_public_encryption_key</a>(TARGET_NYM_ID);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPubkey))
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#acc13cef8eb96edf236d63387a4c8a53d">check_user</a>(SERVER_ID, NYM_ID, TARGET_NYM_ID);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         <span class="keywordflow">if</span> (1 == <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l00380"></a>00380         {
<a name="l00381"></a>00381             strPubkey = <a class="code" href="class_made_easy.html#a77f5bf87fe1efe5a66a573ac13ec53d2">load_public_encryption_key</a>(TARGET_NYM_ID);
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     <span class="keywordflow">return</span> strPubkey; <span class="comment">// might be null.</span>
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="class_made_easy.html#a35067419261a7d49ece80767fab0f020">00387</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a35067419261a7d49ece80767fab0f020">MadeEasy::load_or_retrieve_signing_key</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; TARGET_NYM_ID)
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordtype">string</span> strPubkey = <a class="code" href="class_made_easy.html#aeaa563a1ad38e7436690868534fa3d71">load_public_signing_key</a>(TARGET_NYM_ID);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPubkey))
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#acc13cef8eb96edf236d63387a4c8a53d">check_user</a>(SERVER_ID, NYM_ID, TARGET_NYM_ID);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (1 == <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l00398"></a>00398         {
<a name="l00399"></a>00399             strPubkey = <a class="code" href="class_made_easy.html#aeaa563a1ad38e7436690868534fa3d71">load_public_signing_key</a>(TARGET_NYM_ID);
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402     <span class="keywordflow">return</span> strPubkey; <span class="comment">// might be null.</span>
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="comment">// SEND USER MESSAGE  (requires recipient public key)</span>
<a name="l00407"></a>00407 <span class="comment">//</span>
<a name="l00408"></a><a class="code" href="class_made_easy.html#a2d19e90a54ca7af114a15bf4357c205f">00408</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a2d19e90a54ca7af114a15bf4357c205f">MadeEasy::send_user_msg_pubkey</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_PUBKEY, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_MESSAGE)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a369ee117ea33777d1c0f0a2c229613c8">SEND_USER_MESSAGE</a>, SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, RECIPIENT_PUBKEY, THE_MESSAGE);
<a name="l00413"></a>00413     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;SEND_USER_MESSAGE&quot;</span>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="keywordflow">return</span> strResponse;
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="comment">// SEND USER INSTRUMENT  (requires recipient public key)</span>
<a name="l00419"></a>00419 <span class="comment">//</span>
<a name="l00420"></a><a class="code" href="class_made_easy.html#a6cae23a81458ddc8504e95174f789d3d">00420</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a6cae23a81458ddc8504e95174f789d3d">MadeEasy::send_user_pmnt_pubkey</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_PUBKEY, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_INSTRUMENT)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ac2c6af3488ae02427ecc003edbff263b">SEND_USER_INSTRUMENT</a>, SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, RECIPIENT_PUBKEY, THE_INSTRUMENT);
<a name="l00425"></a>00425     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;SEND_USER_INSTRUMENT&quot;</span>);
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <span class="keywordflow">return</span> strResponse;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">// SEND USER CASH  (requires recipient public key)</span>
<a name="l00431"></a>00431 <span class="comment">//</span>
<a name="l00432"></a><a class="code" href="class_made_easy.html#a3d78407b9b43934523f969496bf403ba">00432</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a3d78407b9b43934523f969496bf403ba">MadeEasy::send_user_cash_pubkey</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_PUBKEY, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_INSTRUMENT, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; INSTRUMENT_FOR_SENDER)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ac2c6af3488ae02427ecc003edbff263b">SEND_USER_INSTRUMENT</a>, SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, RECIPIENT_PUBKEY, THE_INSTRUMENT, INSTRUMENT_FOR_SENDER);
<a name="l00437"></a>00437     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;SEND_USER_INSTRUMENT&quot;</span>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <span class="keywordflow">return</span> strResponse;
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="comment">// SEND USER MESSAGE  (only requires recipient&#39;s ID, and retrieves pubkey automatically)</span>
<a name="l00443"></a>00443 <span class="comment">//</span>
<a name="l00444"></a><a class="code" href="class_made_easy.html#a0ac863c8d07739cd08d16eaec082250b">00444</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a0ac863c8d07739cd08d16eaec082250b">MadeEasy::send_user_msg</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_MESSAGE)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordtype">string</span> strRecipientPubkey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">load_or_retrieve_encrypt_key</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientPubkey))
<a name="l00451"></a>00451     {
<a name="l00452"></a>00452         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_send_user_msg: Unable to load or retrieve public encryption key for recipient: &quot;</span>);
<a name="l00453"></a>00453         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(RECIPIENT_NYM_ID, <span class="stringliteral">&quot;\n&quot;</span>));
<a name="l00454"></a>00454         <span class="keywordflow">return</span> strRecipientPubkey; <span class="comment">// basically this means &quot;return null&quot;.</span>
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a2d19e90a54ca7af114a15bf4357c205f">send_user_msg_pubkey</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, strRecipientPubkey, THE_MESSAGE);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <span class="keywordflow">return</span> strResponse;
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">// SEND USER PAYMENT  (only requires recipient&#39;s ID, and retrieves pubkey automatically)</span>
<a name="l00464"></a>00464 <span class="comment">//</span>
<a name="l00465"></a><a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">00465</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_PAYMENT)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="keywordtype">string</span> strRecipientPubkey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">load_or_retrieve_encrypt_key</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientPubkey))
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_send_user_payment: Unable to load or retrieve public encryption key for recipient: &quot;</span>);
<a name="l00474"></a>00474         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(RECIPIENT_NYM_ID, <span class="stringliteral">&quot;\n&quot;</span>));
<a name="l00475"></a>00475         <span class="keywordflow">return</span> strRecipientPubkey; <span class="comment">// basically this means &quot;return null&quot;.</span>
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a6cae23a81458ddc8504e95174f789d3d">send_user_pmnt_pubkey</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, strRecipientPubkey, THE_PAYMENT);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">return</span> strResponse;
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 <span class="comment">// SEND USER CASH  (only requires recipient&#39;s ID, and retrieves pubkey automatically)</span>
<a name="l00484"></a>00484 <span class="comment">//</span>
<a name="l00485"></a><a class="code" href="class_made_easy.html#ad87d5a00dc024a7e2f7fa0cac7e21f53">00485</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#ad87d5a00dc024a7e2f7fa0cac7e21f53">MadeEasy::send_user_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_PAYMENT, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SENDERS_COPY)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <span class="keywordtype">string</span> strRecipientPubkey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">load_or_retrieve_encrypt_key</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientPubkey))
<a name="l00492"></a>00492     {
<a name="l00493"></a>00493         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_send_user_payment: Unable to load or retrieve public encryption key for recipient: &quot;</span>);
<a name="l00494"></a>00494         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(RECIPIENT_NYM_ID, <span class="stringliteral">&quot;\n&quot;</span>));
<a name="l00495"></a>00495         <span class="keywordflow">return</span> strRecipientPubkey; <span class="comment">// basically this means &quot;return null&quot;.</span>
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a3d78407b9b43934523f969496bf403ba">send_user_cash_pubkey</a>(SERVER_ID, NYM_ID, RECIPIENT_NYM_ID, strRecipientPubkey, THE_PAYMENT, SENDERS_COPY);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="keywordflow">return</span> strResponse;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="comment">// GET PAYMENT INSTRUMENT (from payments inbox, by index.)</span>
<a name="l00504"></a>00504 <span class="comment">//</span>
<a name="l00505"></a><a class="code" href="class_made_easy.html#a36be6514828e74506c8ef217b059d6cd">00505</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a36be6514828e74506c8ef217b059d6cd">MadeEasy::get_payment_instrument</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; PRELOADED_INBOX) <span class="comment">// PRELOADED_INBOX is optional.</span>
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507     <span class="keywordtype">string</span> strInstrument;
<a name="l00508"></a>00508     <span class="keywordtype">string</span> strInbox = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(PRELOADED_INBOX) ? PRELOADED_INBOX : <a class="code" href="class_o_t_a_p_i___wrap.html#a7e785f8c3a9ad9257c9e251b438a6087">OTAPI_Wrap::LoadPaymentInbox</a>(SERVER_ID, NYM_ID); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;\n\n get_payment_instrument:  OT_API_LoadPaymentInbox Failed. (Probably just doesn&#39;t exist yet.)\n\n&quot;</span>);
<a name="l00513"></a>00513         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(SERVER_ID, NYM_ID, NYM_ID, strInbox);
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l00518"></a>00518     {
<a name="l00519"></a>00519         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve size of payments inbox ledger. (Failure.)\n&quot;</span>);
<a name="l00520"></a>00520         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (nIndex &gt; (nCount - 1))
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; out of bounds. (The last index is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCount - 1) + <span class="stringliteral">&quot;. The first is 0.)\n&quot;</span>);
<a name="l00525"></a>00525         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     strInstrument = <a class="code" href="class_o_t_a_p_i___wrap.html#ae1bf653075e809afe55a82a2513d2958">OTAPI_Wrap::Ledger_GetInstrument</a>(SERVER_ID, NYM_ID, NYM_ID, strInbox, nIndex);
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed trying to get payment instrument from payments box.\n&quot;</span>);
<a name="l00532"></a>00532         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keywordflow">return</span> strInstrument;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">// GET BOX RECEIPT</span>
<a name="l00539"></a>00539 <span class="comment">// Note: nBoxType is 0 for Nymbox, 1 for Inbox, and 2 for Outbox.</span>
<a name="l00540"></a>00540 <span class="comment">// Also, if nBoxType is 0 (nymbox) then you have to pass the NymID in the ACCT_ID</span>
<a name="l00541"></a>00541 <span class="comment">// argument, as well as the NYM_ID argument (you have to pass it twice...)</span>
<a name="l00542"></a>00542 <span class="comment">// Otherwise for inbox/outbox, pass the actual ACCT_ID there as normal.</span>
<a name="l00543"></a>00543 <span class="comment">//</span>
<a name="l00544"></a><a class="code" href="class_made_easy.html#a94240ee78337fad202644e2a568a3a54">00544</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a94240ee78337fad202644e2a568a3a54">MadeEasy::get_box_receipt</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> int32_t nBoxType, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_TRANS_NUM)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a4be5ee3c3ee2c3f6a8d31acb80de380e">GET_BOX_RECEIPT</a>, SERVER_ID, NYM_ID, ACCT_ID, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nBoxType), <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(STR_TRANS_NUM));
<a name="l00549"></a>00549     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_BOX_RECEIPT&quot;</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">return</span> strResponse;
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="comment">// DOWNLOAD PUBLIC MINT</span>
<a name="l00556"></a>00556 <span class="comment">//</span>
<a name="l00557"></a><a class="code" href="class_made_easy.html#aa2554d2845af4cc37fbed309b3477890">00557</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#aa2554d2845af4cc37fbed309b3477890">MadeEasy::retrieve_mint</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_ID)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a31b758ec3707e4a86e8fdcdd6bd4def4">GET_MINT</a>, SERVER_ID, NYM_ID, ASSET_ID);
<a name="l00562"></a>00562     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_MINT&quot;</span>);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">return</span> strResponse;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">// LOAD MINT (from local storage)</span>
<a name="l00569"></a>00569 <span class="comment">//</span>
<a name="l00570"></a>00570 <span class="comment">// To load a mint withOUT retrieving it from server, call:</span>
<a name="l00571"></a>00571 <span class="comment">//</span>
<a name="l00572"></a>00572 <span class="comment">// var strMint = OTAPI_Wrap::LoadMint(SERVER_ID, ASSET_ID);</span>
<a name="l00573"></a>00573 <span class="comment">// It returns the mint, or null.</span>
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="comment">// LOAD MINT (from local storage).</span>
<a name="l00576"></a>00576 <span class="comment">// Also, if necessary, RETRIEVE it from the server first.</span>
<a name="l00577"></a>00577 <span class="comment">//</span>
<a name="l00578"></a>00578 <span class="comment">// Returns the mint, or null.</span>
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="class_made_easy.html#afe2b07045aea23451aa7144badf9faf8">00580</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#afe2b07045aea23451aa7144badf9faf8">MadeEasy::load_or_retrieve_mint</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_ID)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="comment">// HERE, WE MAKE SURE WE HAVE THE PROPER MINT...</span>
<a name="l00584"></a>00584     <span class="comment">//</span>
<a name="l00585"></a>00585     <span class="comment">// Download the public mintfile if it&#39;s not there, or if it&#39;s expired.</span>
<a name="l00586"></a>00586     <span class="comment">// Also load it up into memory as a string (just to make sure it works.)</span>
<a name="l00587"></a>00587     <span class="comment">//</span>
<a name="l00588"></a>00588     <span class="keywordtype">string</span> strMint = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="comment">// expired or missing.</span>
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#aafce100c5dc18327098d4c7e688bff45">OTAPI_Wrap::Mint_IsStillGood</a>(SERVER_ID, ASSET_ID))
<a name="l00592"></a>00592     {
<a name="l00593"></a>00593         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;OT_ME_load_or_retrieve_mint: Mint file is missing or expired. Downloading from server...\n&quot;</span>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#aa2554d2845af4cc37fbed309b3477890">retrieve_mint</a>(SERVER_ID, NYM_ID, ASSET_ID);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597         <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l00598"></a>00598         {
<a name="l00599"></a>00599             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_load_or_retrieve_mint: Unable to retrieve mint for IDs: \n&quot;</span>);
<a name="l00600"></a>00600             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;  Server ID: &quot;</span> + SERVER_ID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00601"></a>00601             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;   Asset ID: &quot;</span> + ASSET_ID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00602"></a>00602             <span class="keywordflow">return</span> strMint; <span class="comment">// basically this means &quot;return null&quot;.</span>
<a name="l00603"></a>00603         }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#aafce100c5dc18327098d4c7e688bff45">OTAPI_Wrap::Mint_IsStillGood</a>(SERVER_ID, ASSET_ID))
<a name="l00606"></a>00606         {
<a name="l00607"></a>00607             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_load_or_retrieve_mint: Retrieved mint, but still &#39;not good&#39; for IDs: \n&quot;</span>);
<a name="l00608"></a>00608             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;  Server ID: &quot;</span> + SERVER_ID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00609"></a>00609             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;   Asset ID: &quot;</span> + ASSET_ID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00610"></a>00610             <span class="keywordflow">return</span> strMint; <span class="comment">// basically this means &quot;return null&quot;.</span>
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613     <span class="comment">//else // current mint IS available already on local storage (and not expired.)</span>
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="comment">// By this point, the mint is definitely good, whether we had to download it or not.</span>
<a name="l00616"></a>00616     <span class="comment">// It&#39;s here, and it&#39;s NOT expired. (Or we would have returned already.)</span>
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     strMint = <a class="code" href="class_o_t_a_p_i___wrap.html#aeb47574d4cbbe7b26b0361726ed5c2e1">OTAPI_Wrap::LoadMint</a>(SERVER_ID, ASSET_ID);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMint))
<a name="l00621"></a>00621     {
<a name="l00622"></a>00622         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_load_or_retrieve_mint: Unable to load mint for IDs: \n&quot;</span>);
<a name="l00623"></a>00623         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Server ID: &quot;</span>, SERVER_ID)); <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00624"></a>00624         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot; Asset ID: &quot;</span>, ASSET_ID)); <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <span class="keywordflow">return</span> strMint;
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="comment">// QUERY ASSET TYPES</span>
<a name="l00631"></a>00631 <span class="comment">//</span>
<a name="l00632"></a>00632 <span class="comment">// See if some asset types are issued on the server.</span>
<a name="l00633"></a>00633 <span class="comment">//</span>
<a name="l00634"></a><a class="code" href="class_made_easy.html#a1ea54e4bfa576c0053d800ab93d809a7">00634</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a1ea54e4bfa576c0053d800ab93d809a7">MadeEasy::query_asset_types</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ENCODED_MAP)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ab8af167afa809088bfae8d951dfacfb6">QUERY_ASSET_TYPES</a>, SERVER_ID, NYM_ID, ENCODED_MAP);
<a name="l00639"></a>00639     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;QUERY_ASSET_TYPES&quot;</span>);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">return</span> strResponse;
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">// CREATE MARKET OFFER  -- TRANSACTION</span>
<a name="l00645"></a>00645 
<a name="l00646"></a><a class="code" href="class_made_easy.html#a40049fc8b5ab0ff2f7de843bef970d45">00646</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a40049fc8b5ab0ff2f7de843bef970d45">MadeEasy::create_market_offer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; CURRENCY_ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; scale, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; minIncrement, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; quantity, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; price, <span class="keyword">const</span> <span class="keywordtype">bool</span> bSelling, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strLifespanInSeconds, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strStopSign, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strActivationPrice)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(ASSET_ACCT_ID);
<a name="l00651"></a>00651     <span class="keywordtype">string</span> strUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(ASSET_ACCT_ID);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56afdfb7f121f851fb73a3095ecd8624b43">CREATE_MARKET_OFFER</a>, strServerID, strUserID, ASSET_ACCT_ID, CURRENCY_ACCT_ID, scale, minIncrement, quantity, price, bSelling);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="comment">// Cannot have more than 10 parameters in a function call, in this script.</span>
<a name="l00656"></a>00656     <span class="comment">// So I am forced to set the final parameters by hand, before sending the transaction:</span>
<a name="l00657"></a>00657     <span class="comment">//</span>
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLifespanInSeconds))
<a name="l00659"></a>00659     {
<a name="l00660"></a>00660         theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af6817b3d0897423d2d16b70b24adabd8">tData</a> = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strLifespanInSeconds));
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strStopSign))
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665         theRequest.<a class="code" href="class_o_t_a_p_i___func.html#aabace2463042346e27edc4df8b273b00">strData5</a> = strStopSign;
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strActivationPrice))
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a03897ebea94fa957bec9362d871193b1">lData</a> = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strActivationPrice);
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;CREATE_MARKET_OFFER&quot;</span>);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordflow">return</span> strResponse;
<a name="l00676"></a>00676 }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="comment">// KILL MARKET OFFER  -- TRANSACTION</span>
<a name="l00680"></a>00680 <span class="comment">//</span>
<a name="l00681"></a><a class="code" href="class_made_easy.html#adc73e14717ab84b80a450cffa3957c88">00681</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#adc73e14717ab84b80a450cffa3957c88">MadeEasy::kill_market_offer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ASSET_ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_TRANS_NUM)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a772868c27da6951683c7a134e9be9d6c">KILL_MARKET_OFFER</a>, SERVER_ID, NYM_ID, ASSET_ACCT_ID, STR_TRANS_NUM);
<a name="l00687"></a>00687     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;KILL_MARKET_OFFER&quot;</span>);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="keywordflow">return</span> strResponse;
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="comment">// KILL PAYMENT PLAN (an active one that&#39;s already running) -- TRANSACTION</span>
<a name="l00694"></a>00694 <span class="comment">//</span>
<a name="l00695"></a><a class="code" href="class_made_easy.html#a200f85c37d77902dcb0dc91ab407ecd9">00695</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a200f85c37d77902dcb0dc91ab407ecd9">MadeEasy::kill_payment_plan</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_TRANS_NUM)
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 
<a name="l00700"></a>00700     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a6304a58260dd098a17639d5f88121dd7">KILL_PAYMENT_PLAN</a>, SERVER_ID, NYM_ID, ACCT_ID, STR_TRANS_NUM);
<a name="l00701"></a>00701     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;KILL_PAYMENT_PLAN&quot;</span>);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordflow">return</span> strResponse;
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="comment">// ACTIVATE SMART CONTRACT  -- TRANSACTION</span>
<a name="l00708"></a>00708 <span class="comment">//</span>
<a name="l00709"></a><a class="code" href="class_made_easy.html#a19baeebf93ddebc5d846ef8ce41b6111">00709</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a19baeebf93ddebc5d846ef8ce41b6111">MadeEasy::activate_smart_contract</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; AGENT_NAME, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_SMART_CONTRACT)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="comment">//  int32_t OTAPI_Wrap::activateSmartContract(SERVER_ID, NYM_ID, THE_SMART_CONTRACT)</span>
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a0d477df90baa99968439872f90a3d26f">ACTIVATE_SMART_CONTRACT</a>, SERVER_ID, NYM_ID, ACCT_ID, AGENT_NAME, THE_SMART_CONTRACT);
<a name="l00716"></a>00716     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;ACTIVATE_SMART_CONTRACT&quot;</span>);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">return</span> strResponse;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 <span class="comment">// DEPOSIT PAYMENT PLAN  -- TRANSACTION</span>
<a name="l00723"></a>00723 <span class="comment">//</span>
<a name="l00724"></a><a class="code" href="class_made_easy.html#a5ad9721334cad1756df51f351d204f94">00724</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a5ad9721334cad1756df51f351d204f94">MadeEasy::deposit_payment_plan</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_PAYMENT_PLAN)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="comment">// NOTE: We have to include the account ID as well. Even though the API call itself</span>
<a name="l00729"></a>00729     <span class="comment">// doesn&#39;t need it (it retrieves it from the plan itself, as we are about to do here)</span>
<a name="l00730"></a>00730     <span class="comment">// we still have to provide the accountID for OTAPI_Func, which uses it to grab the</span>
<a name="l00731"></a>00731     <span class="comment">// intermediary files, as part of its automated sync duties. (FYI.)</span>
<a name="l00732"></a>00732     <span class="comment">//</span>
<a name="l00733"></a>00733     <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae7c2873a9439b938209438311652007e">OTAPI_Wrap::Instrmnt_GetSenderAcctID</a>(THE_PAYMENT_PLAN);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="comment">//  int32_t OTAPI_Wrap::depositPaymentPlan(SERVER_ID, NYM_ID, THE_PAYMENT_PLAN)</span>
<a name="l00736"></a>00736     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56af31ab2abc9c2225e92a90be888716ce2">DEPOSIT_PAYMENT_PLAN</a>, SERVER_ID, NYM_ID, strSenderAcctID, THE_PAYMENT_PLAN);
<a name="l00737"></a>00737     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;DEPOSIT_PAYMENT_PLAN&quot;</span>);
<a name="l00738"></a>00738     <span class="keywordflow">return</span> strResponse;
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="comment">// CANCEL PAYMENT PLAN (an inactive one that hasn&#39;t been activated yet) -- TRANSACTION</span>
<a name="l00743"></a>00743 <span class="comment">//</span>
<a name="l00744"></a><a class="code" href="class_made_easy.html#a2b79e8b9956b92dce9894820ffb17ce3">00744</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a2b79e8b9956b92dce9894820ffb17ce3">MadeEasy::cancel_payment_plan</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; THE_PAYMENT_PLAN)
<a name="l00745"></a>00745 {
<a name="l00746"></a>00746     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748     <span class="comment">// NOTE: We have to include the account ID as well. Even though the API call itself</span>
<a name="l00749"></a>00749     <span class="comment">// doesn&#39;t need it (it retrieves it from the plan itself, as we are about to do here)</span>
<a name="l00750"></a>00750     <span class="comment">// we still have to provide the accountID for OTAPI_Func, which uses it to grab the</span>
<a name="l00751"></a>00751     <span class="comment">// intermediary files, as part of its automated sync duties. (FYI.)</span>
<a name="l00752"></a>00752     <span class="comment">//</span>
<a name="l00753"></a>00753     <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#acdae4292ddffbea5ae32908f3587f98f">OTAPI_Wrap::Instrmnt_GetRecipientAcctID</a>(THE_PAYMENT_PLAN);
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;\n\n DEBUGGING: NYM_ID: &quot;+NYM_ID+&quot; strRecipientAcctID: &quot;+strRecipientAcctID+&quot; \n\n&quot;)</span>
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     <span class="comment">// NOTE: Normally the SENDER (PAYER) is the one who deposits a payment plan. But</span>
<a name="l00758"></a>00758     <span class="comment">// in this case, the RECIPIENT (PAYEE) deposits it -- which means &quot;Please cancel this plan.&quot;</span>
<a name="l00759"></a>00759     <span class="comment">// It SHOULD fail, since it&#39;s only been signed by the recipient, and not the sender.</span>
<a name="l00760"></a>00760     <span class="comment">// And that failure is what burns the transaction number on the plan, so that it can</span>
<a name="l00761"></a>00761     <span class="comment">// no longer be used.</span>
<a name="l00762"></a>00762     <span class="comment">//</span>
<a name="l00763"></a>00763     <span class="comment">// So how do we know the difference between an ACTUAL &quot;failure&quot; versus a purposeful &quot;failure&quot; ?</span>
<a name="l00764"></a>00764     <span class="comment">// Because if the failure comes from cancelling the plan, the server reply transaction will have</span>
<a name="l00765"></a>00765     <span class="comment">// IsCancelled() set to true.</span>
<a name="l00766"></a>00766     <span class="comment">//</span>
<a name="l00767"></a>00767     <span class="comment">// (Therefore theRequest.SendTransaction is smart enough to check for that.)</span>
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56af31ab2abc9c2225e92a90be888716ce2">DEPOSIT_PAYMENT_PLAN</a>, SERVER_ID, NYM_ID, strRecipientAcctID, THE_PAYMENT_PLAN);
<a name="l00770"></a>00770     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;CANCEL_PAYMENT_PLAN&quot;</span>);
<a name="l00771"></a>00771     <span class="keywordflow">return</span> strResponse;
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 <span class="comment">// TRIGGER CLAUSE (on running smart contract)  -- TRANSACTION</span>
<a name="l00776"></a>00776 <span class="comment">//</span>
<a name="l00777"></a><a class="code" href="class_made_easy.html#aa52e195e4bdc3c741c9397e31949c10b">00777</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#aa52e195e4bdc3c741c9397e31949c10b">MadeEasy::trigger_clause</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_TRANS_NUM, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; CLAUSE_NAME, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_PARAM)
<a name="l00778"></a>00778 {
<a name="l00779"></a>00779     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     <span class="comment">//  int32_t OTAPI_Wrap::triggerClause(const char * SERVER_ID,</span>
<a name="l00783"></a>00783     <span class="comment">//                                    const char * USER_ID,</span>
<a name="l00784"></a>00784     <span class="comment">//                                    const char * TRANSACTION_NUMBER,</span>
<a name="l00785"></a>00785     <span class="comment">//                                    const char * CLAUSE_NAME,</span>
<a name="l00786"></a>00786     <span class="comment">//                                    const char * STR_PARAM);</span>
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a94fe2cc13e68ff7f65b9f3714500db09">TRIGGER_CLAUSE</a>, SERVER_ID, NYM_ID, STR_TRANS_NUM, CLAUSE_NAME, STR_PARAM);
<a name="l00789"></a>00789     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;TRIGGER_CLAUSE&quot;</span>);
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <span class="keywordflow">return</span> strResponse;
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="comment">// WITHDRAW CASH  -- TRANSACTION</span>
<a name="l00796"></a>00796 <span class="comment">//</span>
<a name="l00797"></a><a class="code" href="class_made_easy.html#a93bef2b6b1857dc20fd8f466f7db62b3">00797</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a93bef2b6b1857dc20fd8f466f7db62b3">MadeEasy::withdraw_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> int64_t AMOUNT)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ae6ebbdc3d3c5e0450e73ccb7b9f95c22">WITHDRAW_CASH</a>, SERVER_ID, NYM_ID, ACCT_ID, AMOUNT);
<a name="l00802"></a>00802     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;WITHDRAW_CASH&quot;</span>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <span class="keywordflow">return</span> strResponse;
<a name="l00805"></a>00805 }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="comment">// WITHDRAW VOUCHER  -- TRANSACTION</span>
<a name="l00809"></a>00809 <span class="comment">//</span>
<a name="l00810"></a><a class="code" href="class_made_easy.html#ad5d4824f1eaab616ef76ca09e2b259cb">00810</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#ad5d4824f1eaab616ef76ca09e2b259cb">MadeEasy::withdraw_voucher</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; RECIP_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_MEMO, <span class="keyword">const</span> int64_t AMOUNT)
<a name="l00811"></a>00811 {
<a name="l00812"></a>00812     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56add164dc65e6a859f61d650c5926b84df">WITHDRAW_VOUCHER</a>, SERVER_ID, NYM_ID, ACCT_ID, RECIP_NYM_ID, STR_MEMO, AMOUNT);
<a name="l00816"></a>00816     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;WITHDRAW_VOUCHER&quot;</span>);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     <span class="keywordflow">return</span> strResponse;
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 
<a name="l00822"></a>00822 <span class="comment">// PAY DIVIDEND  -- TRANSACTION</span>
<a name="l00823"></a>00823 <span class="comment">//</span>
<a name="l00824"></a><a class="code" href="class_made_easy.html#a60520eac696de86b1211646bd33cc19c">00824</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a60520eac696de86b1211646bd33cc19c">MadeEasy::pay_dividend</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SOURCE_ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SHARES_ASSET_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_MEMO, <span class="keyword">const</span> int64_t AMOUNT_PER_SHARE)
<a name="l00825"></a>00825 {
<a name="l00826"></a>00826     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56adfa7768d8a5127c2b01fb746a91e58df">PAY_DIVIDEND</a>, SERVER_ID, NYM_ID, SOURCE_ACCT_ID, SHARES_ASSET_ID, STR_MEMO, AMOUNT_PER_SHARE);
<a name="l00829"></a>00829     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;PAY_DIVIDEND&quot;</span>);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">return</span> strResponse;
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 
<a name="l00835"></a><a class="code" href="class_made_easy.html#a1ca8c8c4941acb858886b9d9dddfc74d">00835</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a1ca8c8c4941acb858886b9d9dddfc74d">MadeEasy::deposit_cheque</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_CHEQUE)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a62c48b635e56ae5d57dce20c7b245f7a">DEPOSIT_CHEQUE</a>, SERVER_ID, NYM_ID, ACCT_ID, STR_CHEQUE);
<a name="l00840"></a>00840     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;DEPOSIT_CHEQUE&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="keywordflow">return</span> strResponse;
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 
<a name="l00846"></a><a class="code" href="class_made_easy.html#a7284e1a867921939a71ec8e22f67b203">00846</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a7284e1a867921939a71ec8e22f67b203">MadeEasy::get_market_list</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID)
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56aafc4076c6e8d660f0acef79c96f3e349">GET_MARKET_LIST</a>, SERVER_ID, NYM_ID);
<a name="l00851"></a>00851     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_MARKET_LIST&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <span class="keywordflow">return</span> strResponse;
<a name="l00854"></a>00854 }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856 <span class="comment">//int32_t OTAPI_Wrap::getMarketOffers(const char * SERVER_ID,</span>
<a name="l00857"></a>00857 <span class="comment">//                           const char * USER_ID,</span>
<a name="l00858"></a>00858 <span class="comment">//                           const char * MARKET_ID,</span>
<a name="l00859"></a>00859 <span class="comment">//                           const char * MAX_DEPTH)</span>
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="class_made_easy.html#a1774517c42ee33951cace002698e59e0">00861</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a1774517c42ee33951cace002698e59e0">MadeEasy::get_market_offers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; MARKET_ID, int64_t MAX_DEPTH)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56aa467915eed1c223646fda62408918cb4">GET_MARKET_OFFERS</a>, SERVER_ID, NYM_ID, MARKET_ID, MAX_DEPTH);
<a name="l00866"></a>00866     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_MARKET_OFFERS&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868     <span class="keywordflow">return</span> strResponse;
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a><a class="code" href="class_made_easy.html#a043b3208fb158d53ee2ea4382ac3c130">00871</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a043b3208fb158d53ee2ea4382ac3c130">MadeEasy::get_nym_market_offers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID)
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a23d8e3035ccc04efe05436db425ba865">GET_NYM_MARKET_OFFERS</a>, SERVER_ID, NYM_ID);
<a name="l00876"></a>00876     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_NYM_MARKET_OFFERS&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keywordflow">return</span> strResponse;
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 
<a name="l00882"></a><a class="code" href="class_made_easy.html#acad2edd5a1fea279b8ab8ee7be732964">00882</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#acad2edd5a1fea279b8ab8ee7be732964">MadeEasy::get_market_recent_trades</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; MARKET_ID)
<a name="l00883"></a>00883 {
<a name="l00884"></a>00884     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a05051fdbd7cfc3dc0958f212180905de">GET_MARKET_RECENT_TRADES</a>, SERVER_ID, NYM_ID, MARKET_ID);
<a name="l00887"></a>00887     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;GET_MARKET_RECENT_TRADES&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <span class="keywordflow">return</span> strResponse;
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 
<a name="l00893"></a><a class="code" href="class_made_easy.html#aa98334efd4d5ed9e76d99c894c0f51a2">00893</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#aa98334efd4d5ed9e76d99c894c0f51a2">MadeEasy::adjust_usage_credits</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; USER_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; TARGET_NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ADJUSTMENT)
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a6b10be4dfef2c046bf1f81a4f3bf4368">ADJUST_USAGE_CREDITS</a>, SERVER_ID, USER_NYM_ID, TARGET_NYM_ID, ADJUSTMENT);
<a name="l00898"></a>00898     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#a45d76b10dfb67d094b6c0ce419d7aa07">SendRequest</a>(theRequest, <span class="stringliteral">&quot;ADJUST_USAGE_CREDITS&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <span class="keywordflow">return</span> strResponse;
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 <span class="comment">// ******************************************************************************************</span>
<a name="l00905"></a>00905 <span class="comment">// Imports a purse into the wallet.</span>
<a name="l00906"></a>00906 
<a name="l00907"></a>00907 <span class="comment">// NOTE:   UNUSED currently.</span>
<a name="l00908"></a><a class="code" href="class_made_easy.html#a22c1189b02af72b980cc3ad9a09eb635">00908</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_made_easy.html#a22c1189b02af72b980cc3ad9a09eb635">MadeEasy::importCashPurse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; nymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; assetID, <span class="keywordtype">string</span> &amp; userInput, <span class="keyword">const</span> <span class="keywordtype">bool</span> isPurse)
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910     <span class="keywordtype">bool</span> isSuccess = <span class="keyword">true</span>;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, serverID:&quot; + serverID + &quot; nymID:&quot; + nymID + &quot; assetID:&quot; + assetID);</span>
<a name="l00913"></a>00913     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, userInput purse:&quot; + userInput);</span>
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(isPurse) &amp;&amp; !isPurse) <span class="comment">// it&#39;s not a purse. Must be a token, so let&#39;s create a purse for it.</span>
<a name="l00916"></a>00916     {
<a name="l00917"></a>00917         <span class="comment">//      OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, isPurse:&quot; + isPurse)</span>
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         <span class="keywordtype">string</span> purse = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c4e30e9b6259f014206840a05a66b5">OTAPI_Wrap::CreatePurse</a>(serverID, assetID, nymID, nymID);<span class="comment">// nymID, nymID == owner, signer;</span>
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(purse))
<a name="l00922"></a>00922         {
<a name="l00923"></a>00923             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_importCashPurse: Error: OT_API_CreatePurse returned null\n&quot;</span>);
<a name="l00924"></a>00924             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926         <span class="comment">//      OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, OT_API_CreatePurse return :&quot; + purse);</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="keywordtype">string</span> newPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, nymID, purse, userInput);
<a name="l00929"></a>00929         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurse))
<a name="l00930"></a>00930         {
<a name="l00931"></a>00931             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_importCashPurse: Error: OT_API_Purse_Push returned null\n&quot;</span>);
<a name="l00932"></a>00932             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934         <span class="comment">//      OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, OT_API_Purse_Push returned :&quot; + newPurse);</span>
<a name="l00935"></a>00935         userInput = newPurse;
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse, Before calling OT_API_Wallet_ImportPurse, final purse:&quot; + userInput);</span>
<a name="l00938"></a>00938     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_importCashPurse just before api , serverID:&quot; + serverID + &quot; nymID:&quot; + nymID + &quot; assetID:&quot; + assetID);</span>
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="comment">// Here we have either a purse that was passed in, or a purse that we created so</span>
<a name="l00941"></a>00941     <span class="comment">// we could add the token that was passed in. Either way, we have a purse now, so</span>
<a name="l00942"></a>00942     <span class="comment">// let&#39;s import it into the wallet.</span>
<a name="l00943"></a>00943     <span class="comment">//</span>
<a name="l00944"></a>00944     isSuccess = <a class="code" href="class_o_t_a_p_i___wrap.html#a94256b991cbfda07261cf037c7c13f0a" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Wrap::Wallet_ImportPurse</a>(serverID, assetID, nymID, userInput) == 1 ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">return</span> isSuccess;
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 <span class="comment">// processCashPurse pops the selected tokens off of oldPurse, changes their owner to recipientNymID,</span>
<a name="l00951"></a>00951 <span class="comment">// and pushes them onto newPurse, owned by recipientNymID. Meanwhile any unselected tokens are pushed</span>
<a name="l00952"></a>00952 <span class="comment">// onto newPurseUnselectedTokens, owned by nymID, which is saved to local storage (overwriting...)</span>
<a name="l00953"></a>00953 <span class="comment">// newPurse is returned from this function.</span>
<a name="l00954"></a>00954 <span class="comment">//</span>
<a name="l00955"></a>00955 <span class="comment">// Thus, for example, if there&#39;s a problem depositing/exporting/exchanging newPurse, then it needs</span>
<a name="l00956"></a>00956 <span class="comment">// to be merged back into the old purse again, which is otherwise still missing those tokens. (We</span>
<a name="l00957"></a>00957 <span class="comment">// should keep a copy of them in the payments outbox or something like that, in the meantime.)</span>
<a name="l00958"></a>00958 <span class="comment">//</span>
<a name="l00959"></a>00959 <span class="comment">// What is newPurseForSender for?</span>
<a name="l00960"></a>00960 <span class="comment">// Sometimes when processCashPurse is called, a Nym is just removing tokens from his purse so he can</span>
<a name="l00961"></a>00961 <span class="comment">// deposit them into his own account. Meaning the &quot;sender&quot; Nym (who owns the purse) is the same as the</span>
<a name="l00962"></a>00962 <span class="comment">// &quot;recipient&quot; Nym (who owns the account.) In which case, newPurse (for recipient) and newPurseForSender</span>
<a name="l00963"></a>00963 <span class="comment">// will contain the exact same thing. But in the case where they are different Nyms (like if I am</span>
<a name="l00964"></a>00964 <span class="comment">// exporting these tokens from my purse in order to give them to someone else) then I will want a copy</span>
<a name="l00965"></a>00965 <span class="comment">// of the exported purse for the recipient, and a copy of the same exported purse for the sender.</span>
<a name="l00966"></a>00966 <span class="comment">// processCashPurse returns both of those for me. The reason is because otherwise, if I just encrypted</span>
<a name="l00967"></a>00967 <span class="comment">// some of my cash tokens to some external Nym, then only THAT Nym&#39;s private key will ever open them up</span>
<a name="l00968"></a>00968 <span class="comment">// again. Even if I have them in my outpayments box, I can never recover them because I can never again</span>
<a name="l00969"></a>00969 <span class="comment">// decrypt them. Therefore I make a special copy of the outgoing purse which is encrypted to my own key,</span>
<a name="l00970"></a>00970 <span class="comment">// and put that into my outpayments box instead of the one I sent to the recipient (or including both</span>
<a name="l00971"></a>00971 <span class="comment">// of them.) That way the cash can still be recovered if necessary, from my outpayments box, and re-imported</span>
<a name="l00972"></a>00972 <span class="comment">// back into my cash purse again.</span>
<a name="l00973"></a>00973 <span class="comment">//</span>
<a name="l00974"></a><a class="code" href="class_made_easy.html#aa5560a5eba4d4a845694762d36b489ce">00974</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_made_easy.html#aa5560a5eba4d4a845694762d36b489ce">MadeEasy::processCashPurse</a>(<span class="keywordtype">string</span> &amp; newPurse, <span class="keywordtype">string</span> &amp; newPurseForSender, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; assetID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; nymID, <span class="keywordtype">string</span> &amp; oldPurse, <span class="keyword">const</span> vector&lt;string&gt; &amp; selectedTokens, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; recipientNymID, <span class="keyword">const</span> <span class="keywordtype">bool</span> bPWProtectOldPurse, <span class="keyword">const</span> <span class="keywordtype">bool</span> bPWProtectNewPurse)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976     <span class="comment">// By this point, we know that &quot;selected tokens&quot; has a size of 0, or MORE THAN ONE. (But NOT 1 exactly.)</span>
<a name="l00977"></a>00977     <span class="comment">// (At least, if this function was called by exportCashPurse.)</span>
<a name="l00978"></a>00978     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;OT_ME_processCashPurse&quot;</span>;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="comment">// This block handles cases where NO TOKENS ARE SELECTED.</span>
<a name="l00981"></a>00981     <span class="comment">//</span>
<a name="l00982"></a>00982     <span class="comment">// (Meaning: &quot;PROCESS&quot; THEM ALL.)</span>
<a name="l00983"></a>00983     <span class="comment">//</span>
<a name="l00984"></a>00984     <span class="keywordflow">if</span> (selectedTokens.size() &lt; 1)
<a name="l00985"></a>00985     {
<a name="l00986"></a>00986         <span class="comment">// newPurse is created, OWNED BY RECIPIENT.</span>
<a name="l00987"></a>00987         <span class="comment">//</span>
<a name="l00988"></a>00988         newPurse = (bPWProtectNewPurse ? <a class="code" href="class_o_t_a_p_i___wrap.html#aaea4b648e7f517b1cedfc70d3562e8be">OTAPI_Wrap::CreatePurse_Passphrase</a>(serverID, assetID, nymID) : <a class="code" href="class_o_t_a_p_i___wrap.html#a51c4e30e9b6259f014206840a05a66b5">OTAPI_Wrap::CreatePurse</a>(serverID, assetID, recipientNymID, nymID));<span class="comment">// recipientNymID is owner, nymID is signer;</span>
<a name="l00989"></a>00989 
<a name="l00990"></a>00990         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurse))
<a name="l00991"></a>00991         {
<a name="l00992"></a>00992             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: &quot;</span> + (bPWProtectNewPurse ? <span class="stringliteral">&quot;OT_API_CreatePurse_Passphrase&quot;</span> : <span class="stringliteral">&quot;OT_API_CreatePurse&quot;</span>) + <span class="stringliteral">&quot; returned null\n&quot;</span>);
<a name="l00993"></a>00993             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         <span class="comment">// We&#39;ll create an extra copy of the newPurse, which is encrypted to the sender (instead of the recipient or</span>
<a name="l00997"></a>00997         <span class="comment">// some passphrase.) We&#39;ll call it newPurseForSender. This way the sender can later have the option to recover</span>
<a name="l00998"></a>00998         <span class="comment">// the cash from his outbox.</span>
<a name="l00999"></a>00999         <span class="comment">//</span>
<a name="l01000"></a>01000         newPurseForSender = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c4e30e9b6259f014206840a05a66b5">OTAPI_Wrap::CreatePurse</a>(serverID, assetID, nymID, nymID);<span class="comment">// nymID is owner, nymID is signer;</span>
<a name="l01001"></a>01001 
<a name="l01002"></a>01002         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurseForSender))
<a name="l01003"></a>01003         {
<a name="l01004"></a>01004             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: OT_API_CreatePurse returned null\n&quot;</span>);
<a name="l01005"></a>01005             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008         <span class="comment">// Iterate through the OLD PURSE. (as tempOldPurse.)</span>
<a name="l01009"></a>01009         <span class="comment">//</span>
<a name="l01010"></a>01010         int32_t count = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(serverID, assetID, oldPurse);
<a name="l01011"></a>01011         <span class="keywordtype">string</span> tempOldPurse = oldPurse;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013         <span class="keywordflow">for</span> (int32_t i = 0; i &lt; count; ++i)
<a name="l01014"></a>01014         {
<a name="l01015"></a>01015             <span class="comment">// Peek into TOKEN, from the top token on the stack. (And it&#39;s STILL on top after this call.)</span>
<a name="l01016"></a>01016             <span class="comment">//</span>
<a name="l01017"></a>01017             <span class="keywordtype">string</span> token = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(serverID, assetID, nymID, tempOldPurse);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019             <span class="comment">// Now pop the token off of tempOldPurse (our iterator for the old purse).</span>
<a name="l01020"></a>01020             <span class="comment">// Store updated copy of purse (sans token) into &quot;str1&quot;.</span>
<a name="l01021"></a>01021             <span class="comment">//</span>
<a name="l01022"></a>01022             <span class="keywordtype">string</span> str1 = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(serverID, assetID, nymID, tempOldPurse);
<a name="l01023"></a>01023 
<a name="l01024"></a>01024             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(token) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(str1))
<a name="l01025"></a>01025             {
<a name="l01026"></a>01026                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Purse_Peek or OT_API_Purse_Pop returned null... SHOULD NEVER HAPPEN. Returning null.\n&quot;</span>);
<a name="l01027"></a>01027                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01028"></a>01028             }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030             <span class="comment">// Since pop succeeded, copy the output to tempOldPurse</span>
<a name="l01031"></a>01031             <span class="comment">// (for next iteration, in case any continues happen below.)</span>
<a name="l01032"></a>01032             <span class="comment">// Now tempOldPurse contains what it did before, MINUS ONE TOKEN. (The exported one.)</span>
<a name="l01033"></a>01033             <span class="comment">//</span>
<a name="l01034"></a>01034             tempOldPurse = str1;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036             <span class="keywordtype">string</span> strSender = bPWProtectOldPurse ? oldPurse : nymID;
<a name="l01037"></a>01037             <span class="keywordtype">string</span> strRecipient = bPWProtectNewPurse ? newPurse : recipientNymID;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039             <span class="keywordtype">string</span> strSenderAsRecipient = nymID;<span class="comment">// Used as the &quot;owner&quot; of newPurseForSender. (So the sender can recover his sent coins that got encrypted to someone else&#39;s key.);</span>
<a name="l01040"></a>01040 
<a name="l01041"></a>01041             <span class="comment">// Change the OWNER on token, from NymID to RECIPIENT.</span>
<a name="l01042"></a>01042             <span class="comment">// (In this block, we change ALL the tokens in the purse.)</span>
<a name="l01043"></a>01043             <span class="comment">//</span>
<a name="l01044"></a>01044             <span class="keywordtype">string</span> exportedToken = <a class="code" href="class_o_t_a_p_i___wrap.html#a6be05e7828d1c37b99e45b96d27f0065">OTAPI_Wrap::Token_ChangeOwner</a>(serverID, assetID, token,
<a name="l01045"></a>01045                 nymID,        <span class="comment">// signer ID</span>
<a name="l01046"></a>01046                 strSender,    <span class="comment">// old owner</span>
<a name="l01047"></a>01047                 strRecipient); <span class="comment">// new owner</span>
<a name="l01048"></a>01048             <span class="comment">// If change failed, then continue.</span>
<a name="l01049"></a>01049             <span class="comment">//</span>
<a name="l01050"></a>01050             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(exportedToken))
<a name="l01051"></a>01051             {
<a name="l01052"></a>01052                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: 1, OT_API_Token_ChangeOwner returned null...(should never happen) Returning null.\n&quot;</span>);
<a name="l01053"></a>01053                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01054"></a>01054             }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056             <span class="comment">// SAVE A COPY FOR THE SENDER...</span>
<a name="l01057"></a>01057             <span class="comment">//</span>
<a name="l01058"></a>01058             <span class="keywordtype">string</span> retainedToken = <a class="code" href="class_o_t_a_p_i___wrap.html#a6be05e7828d1c37b99e45b96d27f0065">OTAPI_Wrap::Token_ChangeOwner</a>(serverID, assetID, token,
<a name="l01059"></a>01059                 nymID,                <span class="comment">// signer ID</span>
<a name="l01060"></a>01060                 strSender,            <span class="comment">// old owner</span>
<a name="l01061"></a>01061                 strSenderAsRecipient); <span class="comment">// new owner</span>
<a name="l01062"></a>01062             <span class="comment">// If change failed, then continue.</span>
<a name="l01063"></a>01063             <span class="comment">//</span>
<a name="l01064"></a>01064             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(retainedToken))
<a name="l01065"></a>01065             {
<a name="l01066"></a>01066                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  2, OT_API_Token_ChangeOwner returned null...(should never happen) Returning null.\n&quot;</span>);
<a name="l01067"></a>01067                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01068"></a>01068             }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070 
<a name="l01071"></a>01071             <span class="comment">//          strSender    = bPWProtectOldPurse ? &quot;&quot; : nymID // unused here. not needed.</span>
<a name="l01072"></a>01072             strRecipient = bPWProtectNewPurse ? <span class="stringliteral">&quot;&quot;</span> : recipientNymID;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074             <span class="comment">// PUSH the EXPORTED TOKEN (new owner) into the new purse (again, recipient/newPurse is new owner) and save results in &quot;strPushedForRecipient&quot;.</span>
<a name="l01075"></a>01075             <span class="comment">// Results are, FYI, newPurse+exportedToken.</span>
<a name="l01076"></a>01076             <span class="comment">//</span>
<a name="l01077"></a>01077             <span class="keywordtype">string</span> strPushedForRecipient = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, <span class="comment">// server, asset, signer</span>
<a name="l01078"></a>01078                 strRecipient, <span class="comment">// owner is either NULL (for password-protected purse) or recipientNymID</span>
<a name="l01079"></a>01079                 newPurse, exportedToken);  <span class="comment">// purse, token</span>
<a name="l01080"></a>01080 
<a name="l01081"></a>01081             <span class="comment">// If push failed, then continue.</span>
<a name="l01082"></a>01082             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPushedForRecipient))
<a name="l01083"></a>01083             {
<a name="l01084"></a>01084                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Push 1 returned null... (should never happen) Returning null.\n&quot;</span>);
<a name="l01085"></a>01085                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01086"></a>01086             }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088             <span class="comment">// PUSH the RETAINED TOKEN (copy for original owner) into the newPurseForSender and save results in &quot;strPushedForRetention&quot;.</span>
<a name="l01089"></a>01089             <span class="comment">// Results are, FYI, newPurseForSender+retainedToken.</span>
<a name="l01090"></a>01090             <span class="comment">//</span>
<a name="l01091"></a>01091             <span class="keywordtype">string</span> strPushedForRetention = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, <span class="comment">// server, asset, signer</span>
<a name="l01092"></a>01092                 strSenderAsRecipient, <span class="comment">// This version of the purse is the outgoing copy (for the SENDER&#39;s notes). Thus strSenderAsRecipient.</span>
<a name="l01093"></a>01093                 newPurseForSender, retainedToken);  <span class="comment">// purse, token</span>
<a name="l01094"></a>01094 
<a name="l01095"></a>01095             <span class="comment">// If push failed, then continue.</span>
<a name="l01096"></a>01096             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPushedForRetention))
<a name="l01097"></a>01097             {
<a name="l01098"></a>01098                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Push 2 returned null... (should never happen) Returning null.\n&quot;</span>);
<a name="l01099"></a>01099                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01100"></a>01100             }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102             <span class="comment">// Since push succeeded, copy &quot;strPushedForRecipient&quot; (containing newPurse         +exportedToken) into newPurse.</span>
<a name="l01103"></a>01103             <span class="comment">// Since push succeeded, copy &quot;strPushedForRetention&quot; (containing newPurseForSender+retainedToken) into newPurseForSender.</span>
<a name="l01104"></a>01104             <span class="comment">//</span>
<a name="l01105"></a>01105             newPurse = strPushedForRecipient;
<a name="l01106"></a>01106             newPurseForSender = strPushedForRetention;
<a name="l01107"></a>01107         } <span class="comment">// for</span>
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         <span class="comment">// Save tempOldPurse to local storage. (For OLD Owner.)</span>
<a name="l01110"></a>01110         <span class="comment">// By now, all of the tokens have been popped off of this purse, so it is EMPTY.</span>
<a name="l01111"></a>01111         <span class="comment">// We&#39;re now saving the empty purse, since the user exported all of the tokens.</span>
<a name="l01112"></a>01112         <span class="comment">//</span>
<a name="l01113"></a>01113         <span class="comment">// THERE MAYBE SHOULD BE AN EXTRA MODAL HERE, that says,</span>
<a name="l01114"></a>01114         <span class="comment">// &quot;Moneychanger will now save your purse, EMPTY, back to local storage. Are you sure you want to do this?&quot;</span>
<a name="l01115"></a>01115         <span class="comment">//</span>
<a name="l01116"></a>01116 
<a name="l01117"></a>01117         <span class="keywordflow">if</span> (!bPWProtectOldPurse)  <span class="comment">// If old purse is NOT password-protected (that is, it&#39;s encrypted to a Nym.)</span>
<a name="l01118"></a>01118         {
<a name="l01119"></a>01119             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a12442adf837af9b72795250c29fe8009">OTAPI_Wrap::SavePurse</a>(serverID, assetID, nymID, tempOldPurse)) <span class="comment">// if FAILURE.</span>
<a name="l01120"></a>01120             {
<a name="l01121"></a>01121                 <span class="comment">// No error message if saving fails??</span>
<a name="l01122"></a>01122                 <span class="comment">// No modal?</span>
<a name="l01123"></a>01123                 <span class="comment">//</span>
<a name="l01124"></a>01124                 <span class="comment">// FT: adding log.</span>
<a name="l01125"></a>01125                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_SavePurse FAILED. SHOULD NEVER HAPPEN!!!!!!\n&quot;</span>);
<a name="l01126"></a>01126                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01127"></a>01127             }
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129         <span class="keywordflow">else</span> <span class="comment">// old purse IS password protected. (So return its updated version.)</span>
<a name="l01130"></a>01130         {
<a name="l01131"></a>01131             oldPurse = tempOldPurse;<span class="comment">// We never cared about this with Nym-owned old purse, since it saves to storage anyway, in the above block. But now in the case of password-protected purses, we set the oldPurse to contain the new version of itself (containing the tokens that had been left unselected) so the caller can do what he wills with it.;</span>
<a name="l01132"></a>01132         }
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="comment">// Else, SPECIFIC TOKENS were selected, so process those only...</span>
<a name="l01136"></a>01136     <span class="comment">//</span>
<a name="l01137"></a>01137     <span class="keywordflow">else</span>
<a name="l01138"></a>01138     {
<a name="l01139"></a>01139         <span class="comment">//      OTAPI_Wrap::Output(0, &quot;Tokens in Cash Purse being processed&quot;);</span>
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         <span class="comment">// newPurseSelectedTokens is created (CORRECTLY) with recipientNymID as owner. (Or with a symmetric key / passphrase.)</span>
<a name="l01143"></a>01143         <span class="comment">// newPurseUnSelectedTokens is created (CORRECTLY) with NymID as owner. (Unselected tokens aren&#39;t being exported...)</span>
<a name="l01144"></a>01144         <span class="comment">//</span>
<a name="l01145"></a>01145         <span class="keywordtype">string</span> newPurseUnSelectedTokens = <a class="code" href="class_o_t_a_p_i___wrap.html#adf744c9a782a341654a78d2bc37eb943">OTAPI_Wrap::Purse_Empty</a>(serverID, assetID, nymID, oldPurse);<span class="comment">// Creates an empty copy of oldPurse.;</span>
<a name="l01146"></a>01146         <span class="keywordtype">string</span> newPurseSelectedTokens = (bPWProtectNewPurse ? <a class="code" href="class_o_t_a_p_i___wrap.html#aaea4b648e7f517b1cedfc70d3562e8be">OTAPI_Wrap::CreatePurse_Passphrase</a>(serverID, assetID, nymID) : <a class="code" href="class_o_t_a_p_i___wrap.html#a51c4e30e9b6259f014206840a05a66b5">OTAPI_Wrap::CreatePurse</a>(serverID, assetID, recipientNymID, nymID));<span class="comment">// recipientNymID = owner, nymID = signer;</span>
<a name="l01147"></a>01147         <span class="keywordtype">string</span> newPurseSelectedForSender = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c4e30e9b6259f014206840a05a66b5">OTAPI_Wrap::CreatePurse</a>(serverID, assetID, nymID, nymID);<span class="comment">// nymID = owner, nymID = signer. This is a copy of newPurseSelectedTokens that&#39;s encrypted to the SENDER (for putting in his outpayments box, so he can still decrypt if necessary.);</span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurseSelectedForSender))
<a name="l01150"></a>01150         {
<a name="l01151"></a>01151             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_CreatePurse returned null\n&quot;</span>);
<a name="l01152"></a>01152             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01153"></a>01153         }
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurseSelectedTokens))
<a name="l01155"></a>01155         {
<a name="l01156"></a>01156             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_CreatePurse or OT_API_CreatePurse_Passphrase returned null\n&quot;</span>);
<a name="l01157"></a>01157             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01158"></a>01158         }
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>((newPurseUnSelectedTokens)))
<a name="l01160"></a>01160         {
<a name="l01161"></a>01161             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Empty returned null\n&quot;</span>);
<a name="l01162"></a>01162             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01163"></a>01163         }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165         <span class="comment">// Iterate through oldPurse, using tempOldPurse as iterator.</span>
<a name="l01166"></a>01166         <span class="comment">//</span>
<a name="l01167"></a>01167         int32_t count = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(serverID, assetID, oldPurse);
<a name="l01168"></a>01168         <span class="keywordtype">string</span> tempOldPurse = oldPurse;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">for</span> (int32_t i = 0; i &lt; count; ++i)
<a name="l01171"></a>01171         {
<a name="l01172"></a>01172             <span class="comment">// Peek at the token on top of the stack.</span>
<a name="l01173"></a>01173             <span class="comment">// (Without removing it.)</span>
<a name="l01174"></a>01174             <span class="comment">//</span>
<a name="l01175"></a>01175             <span class="keywordtype">string</span> token = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(serverID, assetID, nymID, tempOldPurse);
<a name="l01176"></a>01176 
<a name="l01177"></a>01177             <span class="comment">// Remove the top token from the stack, and return the updated stack in &quot;str1&quot;.</span>
<a name="l01178"></a>01178             <span class="comment">//</span>
<a name="l01179"></a>01179             <span class="keywordtype">string</span> str1 = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(serverID, assetID, nymID, tempOldPurse);
<a name="l01180"></a>01180 
<a name="l01181"></a>01181             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(str1) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(token))
<a name="l01182"></a>01182             {
<a name="l01183"></a>01183                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Peek or OT_API_Purse_Pop returned null... returning Null. (SHOULD NEVER HAPPEN.)\n&quot;</span>);
<a name="l01184"></a>01184                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187             <span class="comment">// Putting updated purse into iterator, so any subsequent continues will work properly.</span>
<a name="l01188"></a>01188             <span class="comment">//</span>
<a name="l01189"></a>01189             tempOldPurse = str1;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 
<a name="l01192"></a>01192             <span class="comment">// Grab the TokenID for that token. (Token still has OLD OWNER.)</span>
<a name="l01193"></a>01193             <span class="comment">//</span>
<a name="l01194"></a>01194             <span class="keywordtype">string</span> tokenID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6ecf16a9173a0ca9842a07ba771763d1">OTAPI_Wrap::Token_GetID</a>(serverID, assetID, token);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(tokenID))
<a name="l01197"></a>01197             {
<a name="l01198"></a>01198                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Token_GetID returned null... SHOULD NEVER HAPPEN. Returning now.\n&quot;</span>);
<a name="l01199"></a>01199                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01200"></a>01200             }
<a name="l01201"></a>01201 
<a name="l01202"></a>01202             <span class="comment">// At this point, we check TokenID (identifying the current token) to see if it&#39;s on the SELECTED LIST.</span>
<a name="l01203"></a>01203             <span class="comment">//</span>
<a name="l01204"></a>01204             <span class="keywordflow">if</span> (std::find(selectedTokens.begin(), selectedTokens.end(), tokenID) != selectedTokens.end()) <span class="comment">// We ARE exporting this token. (Its ID was on the list.)</span>
<a name="l01205"></a>01205             {
<a name="l01206"></a>01206                 <span class="comment">// CHANGE OWNER from NYM to RECIPIENT</span>
<a name="l01207"></a>01207                 <span class="comment">// &quot;token&quot; will now contain the EXPORTED TOKEN, with the NEW OWNER.</span>
<a name="l01208"></a>01208                 <span class="comment">//</span>
<a name="l01209"></a>01209                 <span class="keywordtype">string</span> strSender = bPWProtectOldPurse ? oldPurse : nymID;
<a name="l01210"></a>01210                 <span class="keywordtype">string</span> strRecipient = bPWProtectNewPurse ? newPurseSelectedTokens : recipientNymID;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212                 <span class="keywordtype">string</span> strSenderAsRecipient = nymID;<span class="comment">// Used as the &quot;owner&quot; of newPurseSelectedForSender. (So the sender can recover his sent coins that got encrypted to someone else&#39;s key.);</span>
<a name="l01213"></a>01213 
<a name="l01214"></a>01214                 <span class="keywordtype">string</span> exportedToken = <a class="code" href="class_o_t_a_p_i___wrap.html#a6be05e7828d1c37b99e45b96d27f0065">OTAPI_Wrap::Token_ChangeOwner</a>(serverID, assetID, token, <span class="comment">// server, asset, token,;</span>
<a name="l01215"></a>01215                     nymID,        <span class="comment">// signer nym</span>
<a name="l01216"></a>01216                     strSender,    <span class="comment">// old owner</span>
<a name="l01217"></a>01217                     strRecipient); <span class="comment">// new owner</span>
<a name="l01218"></a>01218                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(exportedToken))
<a name="l01219"></a>01219                 {
<a name="l01220"></a>01220                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: 1  OT_API_Token_ChangeOwner returned null... SHOULD NEVER HAPPEN. Returning now.\n&quot;</span>);
<a name="l01221"></a>01221                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01222"></a>01222                 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224                 <span class="keywordtype">string</span> retainedToken = <a class="code" href="class_o_t_a_p_i___wrap.html#a6be05e7828d1c37b99e45b96d27f0065">OTAPI_Wrap::Token_ChangeOwner</a>(serverID, assetID, token, <span class="comment">// server, asset, token,;</span>
<a name="l01225"></a>01225                     nymID,                <span class="comment">// signer nym</span>
<a name="l01226"></a>01226                     strSender,            <span class="comment">// old owner</span>
<a name="l01227"></a>01227                     strSenderAsRecipient); <span class="comment">// new owner</span>
<a name="l01228"></a>01228                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(retainedToken))
<a name="l01229"></a>01229                 {
<a name="l01230"></a>01230                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: 2  OT_API_Token_ChangeOwner returned null... SHOULD NEVER HAPPEN. Returning now.\n&quot;</span>);
<a name="l01231"></a>01231                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01232"></a>01232                 }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234                 <span class="comment">// Push exported version of token into new purse for recipient (for selected tokens.)</span>
<a name="l01235"></a>01235                 <span class="comment">//</span>
<a name="l01236"></a>01236                 <span class="comment">//              strSender    = bPWProtectOldPurse ? &quot;&quot; : nymID  // unused here. Not needed.</span>
<a name="l01237"></a>01237                 strRecipient = bPWProtectNewPurse ? <span class="stringliteral">&quot;&quot;</span> : recipientNymID;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239                 <span class="keywordtype">string</span> strPushedForRecipient = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, <span class="comment">// server, asset, signer;</span>
<a name="l01240"></a>01240                     strRecipient, <span class="comment">// owner is either NULL (for password-protected purse) or recipientNymID</span>
<a name="l01241"></a>01241                     newPurseSelectedTokens, exportedToken); <span class="comment">// purse, token</span>
<a name="l01242"></a>01242                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPushedForRecipient))
<a name="l01243"></a>01243                 {
<a name="l01244"></a>01244                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Push newPurseSelectedTokens returned null... SHOULD NEVER HAPPEN (returning.)\n&quot;</span>);
<a name="l01245"></a>01245                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01246"></a>01246                 }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248                 <span class="comment">// Done: push a copy of these into a purse for the original owner as well, so he has his OWN copy</span>
<a name="l01249"></a>01249                 <span class="comment">// to save in his payments outbox (that HE can decrypt...) so if the cash is lost, for example, he can still</span>
<a name="l01250"></a>01250                 <span class="comment">// recover it. If the recipient receives it and deposits it correctly, the cash in your payment outbox is now</span>
<a name="l01251"></a>01251                 <span class="comment">// worthless and can be discarded, although its existence may be valuable to you as a receipt.</span>
<a name="l01252"></a>01252                 <span class="comment">//</span>
<a name="l01253"></a>01253                 <span class="keywordtype">string</span> strPushedForRetention = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, <span class="comment">// server, asset, signer;</span>
<a name="l01254"></a>01254                     strSenderAsRecipient,
<a name="l01255"></a>01255                     newPurseSelectedForSender, retainedToken); <span class="comment">// purse, token</span>
<a name="l01256"></a>01256                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPushedForRetention))
<a name="l01257"></a>01257                 {
<a name="l01258"></a>01258                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_Purse_Push newPurseSelectedForSender returned null... SHOULD NEVER HAPPEN (returning.)\n&quot;</span>);
<a name="l01259"></a>01259                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01260"></a>01260                 }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262                 newPurseSelectedTokens = strPushedForRecipient;
<a name="l01263"></a>01263                 newPurseSelectedForSender = strPushedForRetention;
<a name="l01264"></a>01264 
<a name="l01265"></a>01265             }
<a name="l01266"></a>01266             <span class="keywordflow">else</span> <span class="comment">// The token, this iteration, is NOT being exported, but is remaining with the original owner.</span>
<a name="l01267"></a>01267             {
<a name="l01268"></a>01268                 <span class="keywordtype">string</span> strSender = bPWProtectOldPurse ? <span class="stringliteral">&quot;&quot;</span> : nymID;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270                 <span class="keywordtype">string</span> str = <a class="code" href="class_o_t_a_p_i___wrap.html#a093b22b42ba6e2844037265f7d02c3ee">OTAPI_Wrap::Purse_Push</a>(serverID, assetID, nymID, <span class="comment">// server, asset, signer;</span>
<a name="l01271"></a>01271                     strSender, <span class="comment">// owner is either NULL (for password-protected purse) or nymID</span>
<a name="l01272"></a>01272                     newPurseUnSelectedTokens, token); <span class="comment">// purse, token</span>
<a name="l01273"></a>01273                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(str))
<a name="l01274"></a>01274                 {
<a name="l01275"></a>01275                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Purse_Push newPurseUnSelectedTokens returned null... SHOULD NEVER HAPPEN. Returning false.\n&quot;</span>);
<a name="l01276"></a>01276                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01277"></a>01277                 }
<a name="l01278"></a>01278 
<a name="l01279"></a>01279                 newPurseUnSelectedTokens = str;
<a name="l01280"></a>01280             }
<a name="l01281"></a>01281         } <span class="comment">// for</span>
<a name="l01282"></a>01282 
<a name="l01283"></a>01283         <span class="keywordflow">if</span> (!bPWProtectOldPurse)  <span class="comment">// If old purse is NOT password-protected (that is, it&#39;s encrypted to a Nym.)</span>
<a name="l01284"></a>01284         {
<a name="l01285"></a>01285             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a12442adf837af9b72795250c29fe8009">OTAPI_Wrap::SavePurse</a>(serverID, assetID, nymID, newPurseUnSelectedTokens)) <span class="comment">// if FAILURE.</span>
<a name="l01286"></a>01286             {
<a name="l01287"></a>01287                 <span class="comment">// No error message if saving fails??</span>
<a name="l01288"></a>01288                 <span class="comment">// No modal?</span>
<a name="l01289"></a>01289                 <span class="comment">//</span>
<a name="l01290"></a>01290                 <span class="comment">// FT: adding log.</span>
<a name="l01291"></a>01291                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;:  OT_API_SavePurse FAILED. SHOULD NEVER HAPPEN!!!!!!\n&quot;</span>);
<a name="l01292"></a>01292                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01293"></a>01293             }
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295         <span class="keywordflow">else</span> <span class="comment">// old purse IS password protected. (So return its updated version.)</span>
<a name="l01296"></a>01296         {
<a name="l01297"></a>01297             oldPurse = newPurseUnSelectedTokens;<span class="comment">// We never cared about this with Nym-owned old purse, since it saves to storage anyway, in the above block. But now in the case of password-protected purses, we set the oldPurse to contain the new version of itself (containing the tokens that had been left unselected) so the caller can do what he wills with it.;</span>
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300         <span class="comment">// The SELECTED tokens (with Recipient as owner of purse AND tokens within) are returned as the &quot;newPurse&quot;.</span>
<a name="l01301"></a>01301         <span class="comment">// The SELECTED tokens (with Sender as owner of purse AND tokens within) are returned as &quot;newPurseForSender&quot;.</span>
<a name="l01302"></a>01302         <span class="comment">//</span>
<a name="l01303"></a>01303         newPurse = newPurseSelectedTokens;
<a name="l01304"></a>01304         newPurseForSender = newPurseSelectedForSender;
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01308"></a>01308 }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 <span class="comment">// Input: server ID, assetID, Nym of current owner, existing purse, list of selected tokens, Nym of Recipient, and bool bPasswordProtected.</span>
<a name="l01312"></a>01312 <span class="comment">// Returns: &quot;new Purse&quot;</span>
<a name="l01313"></a>01313 <span class="comment">//</span>
<a name="l01314"></a><a class="code" href="class_made_easy.html#aa55b3d84e22f5f8ff15df9e3603ec6d4">01314</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#aa55b3d84e22f5f8ff15df9e3603ec6d4">MadeEasy::exportCashPurse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; assetID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; nymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; oldPurse, <span class="keyword">const</span> vector&lt;string&gt; &amp; selectedTokens, <span class="keywordtype">string</span> &amp; recipientNymID, <span class="keyword">const</span> <span class="keywordtype">bool</span> bPasswordProtected, <span class="keywordtype">string</span> &amp; strRetainedCopy)
<a name="l01315"></a>01315 {
<a name="l01316"></a>01316     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_exportCashPurse starts, selectedTokens:&quot; + selectedTokens + &quot;\n&quot;);</span>
<a name="l01317"></a>01317     <span class="comment">//  Utility.setObj(null);</span>
<a name="l01318"></a>01318 
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     <span class="keywordflow">if</span> (!bPasswordProtected)
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322         <span class="comment">// If no recipient, then recipient == Nym.</span>
<a name="l01323"></a>01323         <span class="comment">//</span>
<a name="l01324"></a>01324         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(recipientNymID) || (recipientNymID.size() == 0))
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_exportCashPurse: recipientNym empty--using NymID for recipient instead: &quot;</span> + nymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01327"></a>01327             recipientNymID = nymID;
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330         <span class="keywordflow">if</span> (!(recipientNymID == nymID))
<a name="l01331"></a>01331         {
<a name="l01332"></a>01332             <span class="comment">// Even though we don&#39;t use this variable after this point,</span>
<a name="l01333"></a>01333             <span class="comment">// we&#39;ve still done something important: loaded and possibly</span>
<a name="l01334"></a>01334             <span class="comment">// downloaded the recipient Nym, so that later in this function</span>
<a name="l01335"></a>01335             <span class="comment">// we can reference that recipientNymID in other calls and we know</span>
<a name="l01336"></a>01336             <span class="comment">// it will work.</span>
<a name="l01337"></a>01337             <span class="comment">//</span>
<a name="l01338"></a>01338             <span class="keywordtype">string</span> recipientPubKey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">load_or_retrieve_encrypt_key</a>(serverID, nymID, recipientNymID);<span class="comment">// this function handles partial IDs for recipient.;</span>
<a name="l01339"></a>01339 
<a name="l01340"></a>01340             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(recipientPubKey))
<a name="l01341"></a>01341             {
<a name="l01342"></a>01342                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_exportCashPurse: recipientPubKey is null\n&quot;</span>);
<a name="l01343"></a>01343                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01344"></a>01344             }
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348     <span class="comment">// By this point, we have verified that we can load the public key for the recipient.</span>
<a name="l01349"></a>01349     <span class="comment">// (IF the exported purse isn&#39;t meant to be password-protected.)</span>
<a name="l01350"></a>01350     <span class="comment">//</span>
<a name="l01351"></a>01351     <span class="keywordtype">string</span> token = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01352"></a>01352     <span class="keywordtype">string</span> exportedToken = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01353"></a>01353     <span class="keywordtype">string</span> exportedPurse = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01354"></a>01354 
<a name="l01355"></a>01355     <span class="comment">// Next I create another &quot;newPurse&quot; by calling this function.</span>
<a name="l01356"></a>01356     <span class="comment">//</span>
<a name="l01357"></a>01357     <span class="keywordtype">string</span> newPurse = <span class="stringliteral">&quot;&quot;</span>;<span class="comment">// for recipient;</span>
<a name="l01358"></a>01358     <span class="keywordtype">string</span> newPurseForSender = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01359"></a>01359     <span class="keywordtype">string</span> copyOfOldPurse = oldPurse;
<a name="l01360"></a>01360     <span class="keywordtype">bool</span> bSuccessProcess = <a class="code" href="class_made_easy.html#aa5560a5eba4d4a845694762d36b489ce">processCashPurse</a>(newPurse, newPurseForSender, serverID, assetID, nymID, copyOfOldPurse, selectedTokens, recipientNymID, <span class="keyword">false</span>, bPasswordProtected);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     <span class="keywordflow">if</span> (bSuccessProcess)
<a name="l01363"></a>01363     {
<a name="l01364"></a>01364         strRetainedCopy = newPurseForSender;
<a name="l01365"></a>01365     }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367     <span class="comment">// Whatever is returned from that function, I return here also. Presumably a purse...</span>
<a name="l01368"></a>01368     <span class="comment">//</span>
<a name="l01369"></a>01369     <span class="keywordflow">return</span> newPurse;
<a name="l01370"></a>01370 }
<a name="l01371"></a>01371 
<a name="l01372"></a>01372 
<a name="l01373"></a><a class="code" href="class_made_easy.html#aea3d47969329579e5f2fc078482fe9ef">01373</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> int32_t <a class="code" href="class_made_easy.html#aea3d47969329579e5f2fc078482fe9ef">MadeEasy::depositCashPurse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; assetID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; nymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; oldPurse, <span class="keyword">const</span> vector&lt;string&gt; &amp; selectedTokens, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; accountID, <span class="keyword">const</span> <span class="keywordtype">bool</span> bReimportIfFailure) <span class="comment">// So we don&#39;t re-import a purse that wasn&#39;t internal to begin with.</span>
<a name="l01374"></a>01374 {
<a name="l01375"></a>01375     <span class="keywordtype">string</span> recipientNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(accountID);
<a name="l01376"></a>01376     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(recipientNymID))
<a name="l01377"></a>01377     {
<a name="l01378"></a>01378         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\ndepositCashPurse: Unable to find recipient Nym based on myacct. \n&quot;</span>);
<a name="l01379"></a>01379         <span class="keywordflow">return</span> -1;
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381 
<a name="l01382"></a>01382     <span class="keywordtype">bool</span> bPasswordProtected = <a class="code" href="class_o_t_a_p_i___wrap.html#a5998cc36adb2d2f60b65e441a9263806">OTAPI_Wrap::Purse_HasPassword</a>(serverID, oldPurse);
<a name="l01383"></a>01383 
<a name="l01384"></a>01384     <span class="keywordtype">string</span> newPurse;<span class="comment">// being deposited.;</span>
<a name="l01385"></a>01385     <span class="keywordtype">string</span> newPurseForSender = <span class="stringliteral">&quot;&quot;</span>;<span class="comment">// Probably unused in this case.;</span>
<a name="l01386"></a>01386     <span class="keywordtype">string</span> copyOfOldPurse = oldPurse;
<a name="l01387"></a>01387     <span class="keywordtype">bool</span> bSuccessProcess = <a class="code" href="class_made_easy.html#aa5560a5eba4d4a845694762d36b489ce">processCashPurse</a>(newPurse, newPurseForSender, serverID, assetID, nymID, copyOfOldPurse, selectedTokens, recipientNymID, bPasswordProtected, <span class="keyword">false</span>);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389     <span class="keywordflow">if</span> (!bSuccessProcess || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurse))
<a name="l01390"></a>01390     {
<a name="l01391"></a>01391         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_depositCashPurse: new Purse is empty, after processing it for deposit. \n&quot;</span>);
<a name="l01392"></a>01392         <span class="keywordflow">return</span> -1;
<a name="l01393"></a>01393     }
<a name="l01394"></a>01394 
<a name="l01395"></a>01395     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l01396"></a>01396     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ae58bce5de40dd139240a9b765c191f93">DEPOSIT_CASH</a>, serverID, recipientNymID, accountID, newPurse);
<a name="l01397"></a>01397     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;DEPOSIT_CASH&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l01398"></a>01398 
<a name="l01399"></a>01399     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;deposit_cash&quot;</span>;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     <span class="comment">// ***************************************************************</span>
<a name="l01402"></a>01402 
<a name="l01403"></a>01403     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(serverID, recipientNymID, accountID, strAttempt, strResponse);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l01408"></a>01408     {
<a name="l01409"></a>01409         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l01410"></a>01410         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l01411"></a>01411         <span class="comment">//</span>
<a name="l01412"></a>01412         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">retrieve_account</a>(serverID, recipientNymID, accountID, <span class="keyword">true</span>);<span class="comment">//bForceDownload defaults to false.;</span>
<a name="l01413"></a>01413 
<a name="l01414"></a>01414         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS depositing cash!\n&quot;</span>);
<a name="l01415"></a>01415         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417     <span class="keywordflow">else</span> <span class="comment">// failure. (so we re-import the cash, so as not to lose it...)</span>
<a name="l01418"></a>01418     {
<a name="l01419"></a>01419 
<a name="l01420"></a>01420         <span class="keywordflow">if</span> (!bPasswordProtected &amp;&amp; bReimportIfFailure)
<a name="l01421"></a>01421         {
<a name="l01422"></a>01422             <span class="keywordtype">bool</span> importStatus = <a class="code" href="class_o_t_a_p_i___wrap.html#a94256b991cbfda07261cf037c7c13f0a" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Wrap::Wallet_ImportPurse</a>(serverID, assetID, recipientNymID, newPurse);
<a name="l01423"></a>01423             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Since failure in OT_ME_depositCashPurse, OT_API_Wallet_ImportPurse called. Status of import: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(importStatus) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01424"></a>01424 
<a name="l01425"></a>01425             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(importStatus) &amp;&amp; !importStatus)
<a name="l01426"></a>01426             {
<a name="l01427"></a>01427                 <span class="comment">// Raise the alarm here that we failed depositing the purse, and then we failed</span>
<a name="l01428"></a>01428                 <span class="comment">// importing it back into our wallet again.</span>
<a name="l01429"></a>01429                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Failed depositing the cash purse, and then failed re-importing it back to wallet. Therefore YOU must copy the purse NOW and save it to a safe place! \n&quot;</span>);
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(newPurse);
<a name="l01432"></a>01432 
<a name="l01433"></a>01433                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;AGAIN: Be sure to copy the above purse to a safe place, since it FAILED to deposit and FAILED to re-import back into the wallet. \n&quot;</span>);
<a name="l01434"></a>01434             }
<a name="l01435"></a>01435         }
<a name="l01436"></a>01436         <span class="keywordflow">else</span>
<a name="l01437"></a>01437         {
<a name="l01438"></a>01438             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Failed depositing the cash purse. Therefore YOU must copy the purse NOW and save it to a safe place! \n&quot;</span>);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(newPurse);
<a name="l01441"></a>01441 
<a name="l01442"></a>01442             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;AGAIN: Be sure to copy the above purse to a safe place, since it FAILED to deposit. \n&quot;</span>);
<a name="l01443"></a>01443         }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445         <span class="keywordflow">return</span> -1;
<a name="l01446"></a>01446     }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <span class="comment">// ***************************************************************</span>
<a name="l01449"></a>01449     <span class="comment">//</span>
<a name="l01450"></a>01450     <span class="comment">// Return status to caller.</span>
<a name="l01451"></a>01451     <span class="comment">//</span>
<a name="l01452"></a>01452     <span class="keywordflow">return</span> nInterpretReply;
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01455"></a>01455 
<a name="l01456"></a><a class="code" href="class_made_easy.html#a66c8eba91af497ea7b9945d2d6317911">01456</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_made_easy.html#a66c8eba91af497ea7b9945d2d6317911">MadeEasy::exchangeCashPurse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; assetID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; nymID, <span class="keywordtype">string</span> &amp; oldPurse, <span class="keyword">const</span> vector&lt;string&gt; &amp; selectedTokens)
<a name="l01457"></a>01457 {
<a name="l01458"></a>01458     <span class="comment">//  Utility.setObj(null);</span>
<a name="l01459"></a>01459     <span class="comment">//  OTAPI_Wrap::Output(0, &quot; Cash Purse exchange starts, selectedTokens:&quot; + selectedTokens + &quot;\n&quot;)</span>
<a name="l01460"></a>01460 
<a name="l01461"></a>01461     <span class="keywordtype">string</span> newPurse;
<a name="l01462"></a>01462     <span class="keywordtype">string</span> newPurseForSender = <span class="stringliteral">&quot;&quot;</span>;<span class="comment">// Probably unused in this case.;</span>
<a name="l01463"></a>01463 
<a name="l01464"></a>01464     <span class="keywordtype">bool</span> bProcessSuccess = <a class="code" href="class_made_easy.html#aa5560a5eba4d4a845694762d36b489ce">processCashPurse</a>(newPurse, newPurseForSender, serverID, assetID, nymID, oldPurse, selectedTokens, nymID, <span class="keyword">false</span>, <span class="keyword">false</span>);<span class="comment">// bIsPasswordProtected=false;</span>
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <span class="keywordflow">if</span> (bProcessSuccess &amp;&amp; !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(newPurse))
<a name="l01467"></a>01467     {
<a name="l01468"></a>01468         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;OT_ME_exchangeCashPurse: Before server OT_API_exchangePurse call, new Purse is empty. returning false \n&quot;</span>);
<a name="l01469"></a>01469         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l01473"></a>01473     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56a042fed12284149b08a956bb3216e9ccf">EXCHANGE_CASH</a>, serverID, nymID, assetID, newPurse);
<a name="l01474"></a>01474     <span class="keywordtype">string</span>  strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;EXCHANGE_CASH&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l01475"></a>01475 
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l01477"></a>01477     {
<a name="l01478"></a>01478         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;IN OT_ME_exchangeCashPurse: theRequest.SendTransaction(() failed. (I give up.) \n&quot;</span>);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480         <span class="keywordtype">bool</span> importStatus = <a class="code" href="class_o_t_a_p_i___wrap.html#a94256b991cbfda07261cf037c7c13f0a" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Wrap::Wallet_ImportPurse</a>(serverID, assetID, nymID, newPurse);
<a name="l01481"></a>01481         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Since failure in OT_ME_exchangeCashPurse, OT_API_Wallet_ImportPurse called, status of import: &quot;</span> + <span class="keywordtype">string</span>(importStatus ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01482"></a>01482         <span class="keywordflow">if</span> (!importStatus)
<a name="l01483"></a>01483         {
<a name="l01484"></a>01484             <span class="comment">//          Utility.setObj(newPurse)</span>
<a name="l01485"></a>01485         }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490     <span class="comment">//  OTAPI_Wrap::Output(0, &quot;OT_ME_exchangeCashPurse ends, status: success.\n&quot;)</span>
<a name="l01491"></a>01491 
<a name="l01492"></a>01492     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 
<a name="l01496"></a><a class="code" href="class_made_easy.html#a09f8952b61cc6f484d9d8c880e1a780d">01496</a> <a class="code" href="ot__made__easy__ot_8hpp.html#ac9d42bf780515e3da41d0a2d19a8bd3b">OT_MADE_EASY_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_made_easy.html#a09f8952b61cc6f484d9d8c880e1a780d">MadeEasy::deposit_purse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; SERVER_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; NYM_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; ACCT_ID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; STR_PURSE)
<a name="l01497"></a>01497 {
<a name="l01498"></a>01498     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> ot_Msg;
<a name="l01499"></a>01499 
<a name="l01500"></a>01500     <a class="code" href="class_o_t_a_p_i___func.html">OTAPI_Func</a> theRequest(<a class="code" href="ot__otapi__ot_8hpp.html#ae75abacc42c6f0203f280d4992d4af56ae58bce5de40dd139240a9b765c191f93">DEPOSIT_CASH</a>, SERVER_ID, NYM_ID, ACCT_ID, STR_PURSE);
<a name="l01501"></a>01501     <span class="keywordtype">string</span> strResponse = theRequest.<a class="code" href="class_o_t_a_p_i___func.html#af1a7900cccc3e48e5db8bce1bcb9217b">SendTransaction</a>(theRequest, <span class="stringliteral">&quot;DEPOSIT_CASH&quot;</span>);<span class="comment">// &lt;========================;</span>
<a name="l01502"></a>01502 
<a name="l01503"></a>01503     <span class="keywordflow">return</span> strResponse;
<a name="l01504"></a>01504 }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506 
<a name="l01507"></a>01507 <span class="comment">/*</span>
<a name="l01508"></a>01508 <span class="comment"></span>
<a name="l01509"></a>01509 <span class="comment">DONE:  create nym, register nym, issue asset type, send transfer, accept entire inbox, write cheque.</span>
<a name="l01510"></a>01510 <span class="comment"></span>
<a name="l01511"></a>01511 <span class="comment">Next ones:  show purse, withdraw cash, deposit cash, withdraw voucher, deposit cheque.</span>
<a name="l01512"></a>01512 <span class="comment"></span>
<a name="l01513"></a>01513 <span class="comment">Need to add functions (like check_user above) for all of these:</span>
<a name="l01514"></a>01514 <span class="comment"></span>
<a name="l01515"></a>01515 <span class="comment">attr OTAPI_Func::CREATE_USER_ACCT (register nym)DONE</span>
<a name="l01516"></a>01516 <span class="comment">attr OTAPI_Func::DELETE_USER_ACCT</span>
<a name="l01517"></a>01517 <span class="comment">attr OTAPI_Func::CHECK_USER DONE</span>
<a name="l01518"></a>01518 <span class="comment">attr OTAPI_Func::SEND_USER_MESSAGE DONE</span>
<a name="l01519"></a>01519 <span class="comment">attr OTAPI_Func::ISSUE_ASSET_TYPE               DONE</span>
<a name="l01520"></a>01520 <span class="comment">attr OTAPI_Func::ISSUE_BASKET                   DONE</span>
<a name="l01521"></a>01521 <span class="comment">attr OTAPI_Func::CREATE_ASSET_ACCT DONE</span>
<a name="l01522"></a>01522 <span class="comment">attr OTAPI_Func::DELETE_ASSET_ACCT</span>
<a name="l01523"></a>01523 <span class="comment">attr OTAPI_Func::EXCHANGE_BASKET                DONE</span>
<a name="l01524"></a>01524 <span class="comment">attr OTAPI_Func::PROCESS_INBOX                  DONE</span>
<a name="l01525"></a>01525 <span class="comment">attr OTAPI_Func::DEPOSIT_CASH                   DONE</span>
<a name="l01526"></a>01526 <span class="comment">attr OTAPI_Func::EXCHANGE_CASH</span>
<a name="l01527"></a>01527 <span class="comment">attr OTAPI_Func::DEPOSIT_CHEQUE                 DONE</span>
<a name="l01528"></a>01528 <span class="comment">attr OTAPI_Func::WITHDRAW_VOUCHER               DONE</span>
<a name="l01529"></a>01529 <span class="comment">attr OTAPI_Func::WITHDRAW_CASH                  DONE</span>
<a name="l01530"></a>01530 <span class="comment">attr OTAPI_Func::PAY_DIVIDEND                   DONE</span>
<a name="l01531"></a>01531 <span class="comment">attr OTAPI_Func::GET_CONTRACT                   DONE</span>
<a name="l01532"></a>01532 <span class="comment">attr OTAPI_Func::SEND_TRANSFER                  DONE</span>
<a name="l01533"></a>01533 <span class="comment">attr OTAPI_Func::GET_MARKET_LIST                DONE</span>
<a name="l01534"></a>01534 <span class="comment">attr OTAPI_Func::CREATE_MARKET_OFFER DONE</span>
<a name="l01535"></a>01535 <span class="comment">attr OTAPI_Func::KILL_MARKET_OFFER              DONE</span>
<a name="l01536"></a>01536 <span class="comment">attr OTAPI_Func::KILL_PAYMENT_PLAN              DONE</span>
<a name="l01537"></a>01537 <span class="comment">attr OTAPI_Func::GET_NYM_MARKET_OFFERS          DONE</span>
<a name="l01538"></a>01538 <span class="comment">attr OTAPI_Func::GET_MARKET_OFFERS              DONE</span>
<a name="l01539"></a>01539 <span class="comment">attr OTAPI_Func::GET_MARKET_RECENT_TRADES</span>
<a name="l01540"></a>01540 <span class="comment">attr OTAPI_Func::GET_MINT DONE</span>
<a name="l01541"></a>01541 <span class="comment">attr OTAPI_Func::QUERY_ASSET_TYPES DONE</span>
<a name="l01542"></a>01542 <span class="comment">attr OTAPI_Func::GET_BOX_RECEIPT DONE</span>
<a name="l01543"></a>01543 <span class="comment"></span>
<a name="l01544"></a>01544 <span class="comment">--- Activate Payment Plan</span>
<a name="l01545"></a>01545 <span class="comment"></span>
<a name="l01546"></a>01546 <span class="comment">------ TANGENT -----------------------------------------</span>
<a name="l01547"></a>01547 <span class="comment">Use cases that do not require a server message, and thus will have representative</span>
<a name="l01548"></a>01548 <span class="comment">functions in ot_made_easy.ot EVEN WHEN there is no corresponding server message</span>
<a name="l01549"></a>01549 <span class="comment">in ot.</span>
<a name="l01550"></a>01550 <span class="comment">--- stat wallet               DONE</span>
<a name="l01551"></a>01551 <span class="comment">--- Stat cash purse           DONE</span>
<a name="l01552"></a>01552 <span class="comment">--- Stat account              DONE</span>
<a name="l01553"></a>01553 <span class="comment">--- Stat account inbox        DONE</span>
<a name="l01554"></a>01554 <span class="comment">--- Stat account outbox       DONE</span>
<a name="l01555"></a>01555 <span class="comment">--- Stat payment inbox        DONE</span>
<a name="l01556"></a>01556 <span class="comment">--- Stat record box           DONE</span>
<a name="l01557"></a>01557 <span class="comment">--- encode / decode           DONE</span>
<a name="l01558"></a>01558 <span class="comment">--- encrypt/decrypt           DONE</span>
<a name="l01559"></a>01559 <span class="comment">--- Password encrypt/decrypt  DONE</span>
<a name="l01560"></a>01560 <span class="comment">--- Sign / Verify             DONE</span>
<a name="l01561"></a>01561 <span class="comment">--- Create asset contract     DONE</span>
<a name="l01562"></a>01562 <span class="comment">--- Create server contract    DONE</span>
<a name="l01563"></a>01563 <span class="comment">--- Create symmetric key      DONE</span>
<a name="l01564"></a>01564 <span class="comment">--- Create pseudonym          DONE</span>
<a name="l01565"></a>01565 <span class="comment">--- Write cheque              DONE</span>
<a name="l01566"></a>01566 <span class="comment">--- Verify last acct receipt  DONE</span>
<a name="l01567"></a>01567 <span class="comment">--- Refresh (download latest) DONE</span>
<a name="l01568"></a>01568 <span class="comment">--- Refresh Nym               DONE</span>
<a name="l01569"></a>01569 <span class="comment">--- Propose Payment Plan</span>
<a name="l01570"></a>01570 <span class="comment">--- Confirm Payment Plan</span>
<a name="l01571"></a>01571 <span class="comment">--- Balance                   DONE</span>
<a name="l01572"></a>01572 <span class="comment">---</span>
<a name="l01573"></a>01573 <span class="comment"></span>
<a name="l01574"></a>01574 <span class="comment">------ END TANGENT -------------------------------------</span>
<a name="l01575"></a>01575 <span class="comment"></span>
<a name="l01576"></a>01576 <span class="comment"></span>
<a name="l01577"></a>01577 <span class="comment">Here are parameters for the first group above.</span>
<a name="l01578"></a>01578 <span class="comment">(They are called in OTAPI_Func, this code is from there):</span>
<a name="l01579"></a>01579 <span class="comment"></span>
<a name="l01580"></a>01580 <span class="comment">else if (funcType == DELETE_USER_ACCT)</span>
<a name="l01581"></a>01581 <span class="comment">{ OTAPI_Wrap::deleteUserAccount(serverID, nymID); }</span>
<a name="l01582"></a>01582 <span class="comment">else if (funcType == GET_NYM_MARKET_OFFERS)</span>
<a name="l01583"></a>01583 <span class="comment">{ OTAPI_Wrap::getNym_MarketOffers(serverID, nymID); }</span>
<a name="l01584"></a>01584 <span class="comment">else if (funcType == CREATE_ASSET_ACCT)</span>
<a name="l01585"></a>01585 <span class="comment">{ OTAPI_Wrap::createAssetAccount(serverID, nymID, assetID); }</span>
<a name="l01586"></a>01586 <span class="comment">else if (funcType == DELETE_ASSET_ACCT)</span>
<a name="l01587"></a>01587 <span class="comment">{ OTAPI_Wrap::deleteAssetAccount(serverID, nymID, accountID); }</span>
<a name="l01588"></a>01588 <span class="comment">else if (funcType == EXCHANGE_BASKET)</span>
<a name="l01589"></a>01589 <span class="comment">{ OTAPI_Wrap::exchangeBasket(serverID, nymID, assetID, basket, bBool); }</span>
<a name="l01590"></a>01590 <span class="comment">else if (funcType == GET_CONTRACT)</span>
<a name="l01591"></a>01591 <span class="comment">{ OTAPI_Wrap::getContract(serverID, nymID, assetID); }</span>
<a name="l01592"></a>01592 <span class="comment">else if (funcType == ISSUE_ASSET_TYPE)</span>
<a name="l01593"></a>01593 <span class="comment">{ OTAPI_Wrap::issueAssetType(serverID, nymID, strData); }</span>
<a name="l01594"></a>01594 <span class="comment">else if (funcType == ISSUE_BASKET)</span>
<a name="l01595"></a>01595 <span class="comment">{ OTAPI_Wrap::issueBasket(serverID, nymID, basket); }</span>
<a name="l01596"></a>01596 <span class="comment">else if (funcType == EXCHANGE_CASH)</span>
<a name="l01597"></a>01597 <span class="comment">{ OTAPI_Wrap::exchangePurse(serverID, assetID, nymID, strData); }</span>
<a name="l01598"></a>01598 <span class="comment">else if (funcType == KILL_MARKET_OFFER)</span>
<a name="l01599"></a>01599 <span class="comment">{ OTAPI_Wrap::cancelMarketOffer(serverID, nymID, accountID, strData); }</span>
<a name="l01600"></a>01600 <span class="comment">else if (funcType == PROCESS_INBOX)</span>
<a name="l01601"></a>01601 <span class="comment">{ OTAPI_Wrap::processInbox(serverID, nymID, accountID, strData); }</span>
<a name="l01602"></a>01602 <span class="comment">else if (funcType == DEPOSIT_CASH)</span>
<a name="l01603"></a>01603 <span class="comment">{ OTAPI_Wrap::notarizeDeposit(serverID, nymID, accountID, strData); }</span>
<a name="l01604"></a>01604 <span class="comment">else if (funcType == DEPOSIT_CHEQUE)</span>
<a name="l01605"></a>01605 <span class="comment">{ OTAPI_Wrap::depositCheque(serverID, nymID, accountID, strData); }</span>
<a name="l01606"></a>01606 <span class="comment">else if (funcType == WITHDRAW_CASH)</span>
<a name="l01607"></a>01607 <span class="comment">{ OTAPI_Wrap::notarizeWithdrawal(serverID, nymID, accountID, strData); }</span>
<a name="l01608"></a>01608 <span class="comment">else if (funcType == WITHDRAW_VOUCHER)</span>
<a name="l01609"></a>01609 <span class="comment">{ OTAPI_Wrap::withdrawVoucher(serverID, nymID, accountID, nymID2, strData, strData2); }</span>
<a name="l01610"></a>01610 <span class="comment">else if (funcType == SEND_TRANSFER)</span>
<a name="l01611"></a>01611 <span class="comment">{ OTAPI_Wrap::notarizeTransfer(serverID, nymID, accountID, accountID2,   strData, strData2); } // amount and note, for the last two.</span>
<a name="l01612"></a>01612 <span class="comment">else if (funcType == GET_MARKET_LIST)</span>
<a name="l01613"></a>01613 <span class="comment">{ OTAPI_Wrap::getMarketList(serverID, nymID); }</span>
<a name="l01614"></a>01614 <span class="comment">else if (funcType == GET_MARKET_OFFERS)</span>
<a name="l01615"></a>01615 <span class="comment">{ OTAPI_Wrap::getMarketOffers(serverID, nymID, strData, strData2); }</span>
<a name="l01616"></a>01616 <span class="comment">else if (funcType == GET_MARKET_RECENT_TRADES)</span>
<a name="l01617"></a>01617 <span class="comment">{ OTAPI_Wrap::getMarketRecentTrades(serverID, nymID, strData); }</span>
<a name="l01618"></a>01618 <span class="comment">else if (funcType == CREATE_MARKET_OFFER)</span>
<a name="l01619"></a>01619 <span class="comment">{ OTAPI_Wrap::issueMarketOffer(serverID, nymID, assetID, accountID, assetID2, accountID2,</span>
<a name="l01620"></a>01620 <span class="comment">strData, strData2, strData3, strData4, bBool);</span>
<a name="l01621"></a>01621 <span class="comment">}</span>
<a name="l01622"></a>01622 <span class="comment"></span>
<a name="l01623"></a>01623 <span class="comment">*/</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ot__made__easy__ot_8cpp.html">ot_made_easy_ot.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:01 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
