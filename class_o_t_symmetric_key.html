<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTSymmetricKey Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_symmetric_key.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OTSymmetricKey Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTSymmetricKey" -->
<p><code>#include &lt;<a class="el" href="_o_t_symmetric_key_8hpp_source.html">OTSymmetricKey.hpp</a>&gt;</code></p>

<p><a href="class_o_t_symmetric_key-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">SerializeTo</a> (<a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;theOutput) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">SerializeFrom</a> (<a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;theInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#aa3b444f4a615eb4b020f23089088e6fd">SerializeTo</a> (<a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;ascOutput) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#af49b67936c16577a90f531d0299097e1">SerializeFrom</a> (const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;ascInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ac7063cc96832cd524c648ad1255223cb">SerializeTo</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, bool bEscaped=false) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a73decb41b01032c1cd28a42df4df9d3d">SerializeFrom</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strInput, bool bEscaped=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">IsGenerated</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a70cc2a2c32250ae5c005df3fac0497ba">GetIdentifier</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theIdentifier) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a1fa4797eca8e110a9396b551bc8121cd">GetIdentifier</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strIdentifier) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ad91f8bb8c8384b0719204df381fa693f">CalculateDerivedKeyFromPassphrase</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase, const bool bCheckForHashCheck=true) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a7784859786cd0bfb61def268a6dbb9a7">CalculateNewDerivedKeyFromPassphrase</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a6930ce6ccea45d4259a8e44171d27763">GetRawKeyFromPassphrase</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase, <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;theRawKeyOutput, <a class="el" href="class_o_t_password.html">OTPassword</a> *pDerivedKey=NULL) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a99470a8be3349bb0d0336802aeff60fb">GetRawKeyFromDerivedKey</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;theDerivedKey, <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;theRawKeyOutput) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a2ef54d17c58afc9edea214ea0a2dcf13">GenerateKey</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase, <a class="el" href="class_o_t_password.html">OTPassword</a> **ppDerivedKey=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a9e5ce58cbef7f7799b93803b71950b5e">GenerateHashCheck</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a0fe3f33b0b6446d24fcd4e6d34cb32d3">ReGenerateHashCheck</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassphrase)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a6e88d85b92f72038ff411899de611440">OTSymmetricKey</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a2721ae3bb5f05ff559ebe1e611e7c26b">OTSymmetricKey</a> (const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassword)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ac9fc306ac1320982b4da03f36d8f6418">~OTSymmetricKey</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ac08f410138a273455dc2c53314eccd8e">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a56ebf8fa33f04f5f2e7c27806f10e2d7">Release_SymmetricKey</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">GetPassphraseFromUser</a> (const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const bool bAskTwice=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a386861ca9897dbbfc1a5fb50d2cfd814">CreateNewKey</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const <a class="el" href="class_o_t_password.html">OTPassword</a> *pAlreadyHavePW=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ab26cb376c0bb66dfb68002713137aff5">Encrypt</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strKey, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPlaintext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const bool bBookends=true, const <a class="el" href="class_o_t_password.html">OTPassword</a> *pAlreadyHavePW=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a89f40aac440c8c25fdc42a7b72b348a6">Decrypt</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strKey, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strCiphertext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const <a class="el" href="class_o_t_password.html">OTPassword</a> *pAlreadyHavePW=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#ac3c3bfdb5573de45c3f56277cad7bebd">Encrypt</a> (const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;theKey, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strPlaintext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const bool bBookends=true, const <a class="el" href="class_o_t_password.html">OTPassword</a> *pAlreadyHavePW=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_symmetric_key.html#a02cb259a9299c3cc8d5fb4f979656756">Decrypt</a> (const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;theKey, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strCiphertext, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput, const <a class="el" href="class_o_t_string.html">OTString</a> *pstrDisplay=NULL, const <a class="el" href="class_o_t_password.html">OTPassword</a> *pAlreadyHavePW=NULL)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_symmetric_key_8hpp_source.html#l00147">147</a> of file <a class="el" href="_o_t_symmetric_key_8hpp_source.html">OTSymmetricKey.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6e88d85b92f72038ff411899de611440"></a><!-- doxytag: member="OTSymmetricKey::OTSymmetricKey" ref="a6e88d85b92f72038ff411899de611440" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_symmetric_key.html#a6e88d85b92f72038ff411899de611440">OTSymmetricKey::OTSymmetricKey</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l01189">1189</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">:   m_bIsGenerated(<span class="keyword">false</span>),
    m_bHasHashCheck(<span class="keyword">false</span>),
    m_nKeySize(<a class="code" href="class_o_t_crypto_config.html#a835596fd28dc8f14d62e6a141e6b4c11">OTCryptoConfig::SymmetricKeySize</a>() * 8), <span class="comment">// 128 (in bits)</span>
    m_uIterationCount(<a class="code" href="class_o_t_crypto_config.html#a4689bd532160fb559daf7432e022fa9e">OTCryptoConfig::IterationCount</a>())
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="a2721ae3bb5f05ff559ebe1e611e7c26b"></a><!-- doxytag: member="OTSymmetricKey::OTSymmetricKey" ref="a2721ae3bb5f05ff559ebe1e611e7c26b" args="(const OTPassword &amp;thePassword)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_symmetric_key.html#a6e88d85b92f72038ff411899de611440">OTSymmetricKey::OTSymmetricKey</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassword</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l01199">1199</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">:   m_bIsGenerated(<span class="keyword">false</span>),
    m_bHasHashCheck(<span class="keyword">false</span>),
    m_nKeySize(<a class="code" href="class_o_t_crypto_config.html#a835596fd28dc8f14d62e6a141e6b4c11">OTCryptoConfig::SymmetricKeySize</a>() * 8), <span class="comment">// 128 (in bits)</span>
    m_uIterationCount(<a class="code" href="class_o_t_crypto_config.html#a4689bd532160fb559daf7432e022fa9e">OTCryptoConfig::IterationCount</a>())
{
<span class="comment">//  const bool bGenerated =</span>
    this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a2ef54d17c58afc9edea214ea0a2dcf13">GenerateKey</a>(thePassword);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac9fc306ac1320982b4da03f36d8f6418"></a><!-- doxytag: member="OTSymmetricKey::~OTSymmetricKey" ref="ac9fc306ac1320982b4da03f36d8f6418" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_symmetric_key.html#ac9fc306ac1320982b4da03f36d8f6418">OTSymmetricKey::~OTSymmetricKey</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l01210">1210</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_symmetric_key.html#a56ebf8fa33f04f5f2e7c27806f10e2d7">Release_SymmetricKey</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad91f8bb8c8384b0719204df381fa693f"></a><!-- doxytag: member="OTSymmetricKey::CalculateDerivedKeyFromPassphrase" ref="ad91f8bb8c8384b0719204df381fa693f" args="(const OTPassword &amp;thePassphrase, const bool bCheckForHashCheck=true) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_password.html">OTPassword</a> * <a class="el" href="class_o_t_symmetric_key.html#ad91f8bb8c8384b0719204df381fa693f">OTSymmetricKey::CalculateDerivedKeyFromPassphrase</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bCheckForHashCheck</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00361">361</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">//  OT_ASSERT(m_bIsGenerated);</span>
<span class="comment">//  OT_ASSERT(thePassphrase.isPassword());</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pDerivedKey = NULL;

    <a class="code" href="class_o_t_payload.html">OTPayload</a> tmpDataHashCheck = this-&gt;m_dataHashCheck;

    <span class="keywordflow">if</span> (bCheckForHashCheck)
    {
        <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to calculate derived key, as hash check is missing!&quot;</span>, __FUNCTION__);
            <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
        }
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!tmpDataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>());
    }
    <span class="keywordflow">else</span>
    {
        <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Warning!! No hash check, ignoring... (since bCheckForHashCheck was set false)&quot;</span>, __FUNCTION__);
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(tmpDataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>());
        }
    }

    pDerivedKey = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a9ecdaf1a1b3f601d5ab2dfae81c1f4e7">DeriveNewKey</a>(thePassphrase, this-&gt;m_dataSalt, this-&gt;m_uIterationCount, tmpDataHashCheck);

    <span class="keywordflow">return</span> pDerivedKey; <span class="comment">// can be null</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7784859786cd0bfb61def268a6dbb9a7"></a><!-- doxytag: member="OTSymmetricKey::CalculateNewDerivedKeyFromPassphrase" ref="a7784859786cd0bfb61def268a6dbb9a7" args="(const OTPassword &amp;thePassphrase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_password.html">OTPassword</a> * <a class="el" href="class_o_t_symmetric_key.html#a7784859786cd0bfb61def268a6dbb9a7">OTSymmetricKey::CalculateNewDerivedKeyFromPassphrase</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00394">394</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">//  OT_ASSERT(m_bIsGenerated);</span>
<span class="comment">//  OT_ASSERT(thePassphrase.isPassword());</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pDerivedKey = NULL;

    <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
    {
        this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a98bbbe9647687fae720fc79460c96006">zeroMemory</a>();

        pDerivedKey = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a9ecdaf1a1b3f601d5ab2dfae81c1f4e7">DeriveNewKey</a>(thePassphrase, this-&gt;m_dataSalt, this-&gt;m_uIterationCount, this-&gt;m_dataHashCheck);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Calling Wrong function!! Hash check already exists!&quot;</span>, __FUNCTION__);
    }

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pDerivedKey);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>());

    this-&gt;m_bHasHashCheck = <span class="keyword">true</span>;

    <span class="keywordflow">return</span> pDerivedKey;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a386861ca9897dbbfc1a5fb50d2cfd814"></a><!-- doxytag: member="OTSymmetricKey::CreateNewKey" ref="a386861ca9897dbbfc1a5fb50d2cfd814" args="(OTString &amp;strOutput, const OTString *pstrDisplay=NULL, const OTPassword *pAlreadyHavePW=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a386861ca9897dbbfc1a5fb50d2cfd814">OTSymmetricKey::CreateNewKey</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pAlreadyHavePW</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00534">534</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pPassUserInput = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> thePWAngel;

    <span class="keywordflow">if</span> (NULL == pAlreadyHavePW)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *    szDisplay = <span class="stringliteral">&quot;Creating new symmetric key.&quot;</span>;
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strDisplay((NULL == pstrDisplay) ? szDisplay : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// -----------------------------------------------</span>
        pPassUserInput = <a class="code" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">OTSymmetricKey::GetPassphraseFromUser</a>(&amp;strDisplay, <span class="keyword">true</span>);<span class="comment">//bAskTwice=false by default.</span>
        thePWAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pPassUserInput); <span class="comment">// may be NULL.</span>
    }
    <span class="keywordflow">else</span>
        pPassUserInput = <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_password.html">OTPassword</a> *<span class="keyword">&gt;</span>(pAlreadyHavePW);
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (NULL != pPassUserInput) <span class="comment">// Success retrieving the passphrase from the user. (Now let&#39;s generate the key...)</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: Calling OTSymmetricKey theKey.GenerateKey()...\n&quot;</span>, __FUNCTION__);
        <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> theKey(*pPassUserInput);
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bGenerated = theKey.IsGenerated();
<span class="comment">//      OTLog::vOutput(0, &quot;%s: Finished calling OTSymmetricKey theKey.GenerateKey()...\n&quot;, __FUNCTION__);</span>

        <span class="keywordflow">if</span> (bGenerated &amp;&amp; theKey.SerializeTo(strOutput))
            bSuccess = <span class="keyword">true</span>;
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Sorry, unable to generate key. (Failure.)\n&quot;</span>, __FUNCTION__);
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Sorry, unable to retrieve password from user. (Failure.)\n&quot;</span>, __FUNCTION__);

    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a89f40aac440c8c25fdc42a7b72b348a6"></a><!-- doxytag: member="OTSymmetricKey::Decrypt" ref="a89f40aac440c8c25fdc42a7b72b348a6" args="(const OTString &amp;strKey, OTString &amp;strCiphertext, OTString &amp;strOutput, const OTString *pstrDisplay=NULL, const OTPassword *pAlreadyHavePW=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a89f40aac440c8c25fdc42a7b72b348a6">OTSymmetricKey::Decrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strCiphertext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pAlreadyHavePW</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00680">680</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">if</span> (!strKey.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Nonexistent: The symmetric key. Please supply. (Failure.)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> theKey;

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">SerializeFrom</a>(strKey))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failed trying to load symmetric key from string. (Returning false.)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// By this point, we know we have a ciphertext envelope and a symmetric Key.</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_symmetric_key.html#a89f40aac440c8c25fdc42a7b72b348a6">OTSymmetricKey::Decrypt</a>(theKey, strCiphertext,
                                   strOutput,
                                   pstrDisplay, pAlreadyHavePW);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a02cb259a9299c3cc8d5fb4f979656756"></a><!-- doxytag: member="OTSymmetricKey::Decrypt" ref="a02cb259a9299c3cc8d5fb4f979656756" args="(const OTSymmetricKey &amp;theKey, OTString &amp;strCiphertext, OTString &amp;strOutput, const OTString *pstrDisplay=NULL, const OTPassword *pAlreadyHavePW=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a89f40aac440c8c25fdc42a7b72b348a6">OTSymmetricKey::Decrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;&#160;</td>
          <td class="paramname"><em>theKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strCiphertext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pAlreadyHavePW</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00712">712</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!theKey.<a class="code" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">IsGenerated</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failure: theKey.IsGenerated() was false. (The calling &quot;</span>
                       <span class="stringliteral">&quot;code probably should have checked for that...)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascArmor;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadedArmor = <a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">OTASCIIArmor::LoadFromString</a>(ascArmor, strCiphertext); <span class="comment">// str_bookend=&quot;-----BEGIN&quot; by default</span>
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keywordflow">if</span> (!bLoadedArmor || !ascArmor.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading ciphertext envelope:\n\n%s\n\n&quot;</span>,
                      __FUNCTION__, strCiphertext.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// By this point, we know we have a ciphertext envelope and a symmetric Key.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pPassUserInput = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> thePWAngel;

    <span class="keywordflow">if</span> (NULL == pAlreadyHavePW)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *    szDisplay = <span class="stringliteral">&quot;Decrypting a password-protected ciphertext.&quot;</span>;
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strDisplay((NULL == pstrDisplay) ? szDisplay : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// -----------------------------------------------</span>
        pPassUserInput = <a class="code" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">OTSymmetricKey::GetPassphraseFromUser</a>(&amp;strDisplay);<span class="comment">//bAskTwice=false by default.</span>
        thePWAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pPassUserInput); <span class="comment">// may be NULL.</span>
    }
    <span class="keywordflow">else</span>
        pPassUserInput = <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_password.html">OTPassword</a> *<span class="keyword">&gt;</span>(pAlreadyHavePW);
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordtype">bool</span>  bSuccess  = <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pPassUserInput) <span class="comment">// Success retrieving the passphrase from the user. (Now let&#39;s decrypt...)</span>
    {
        <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope(ascArmor);

        <span class="keywordflow">if</span> (theEnvelope.Decrypt(strOutput, theKey, *pPassUserInput))
        {
            bSuccess = <span class="keyword">true</span>;
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failed trying to decrypt. (Sorry.)\n&quot;</span>,
                           __FUNCTION__);
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Sorry, unable to retrieve passphrase from user. (Failure.)\n&quot;</span>,
                       __FUNCTION__);

    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab26cb376c0bb66dfb68002713137aff5"></a><!-- doxytag: member="OTSymmetricKey::Encrypt" ref="ab26cb376c0bb66dfb68002713137aff5" args="(const OTString &amp;strKey, const OTString &amp;strPlaintext, OTString &amp;strOutput, const OTString *pstrDisplay=NULL, const bool bBookends=true, const OTPassword *pAlreadyHavePW=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#ab26cb376c0bb66dfb68002713137aff5">OTSymmetricKey::Encrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPlaintext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bBookends</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pAlreadyHavePW</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00574">574</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!strKey.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strPlaintext.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Nonexistent: either the key or the plaintext. Please supply. (Failure.)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> theKey;

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">SerializeFrom</a>(strKey))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failed trying to load symmetric key from string. (Returning false.)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// By this point, we know we have a plaintext and a symmetric Key.</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_symmetric_key.html#ab26cb376c0bb66dfb68002713137aff5">OTSymmetricKey::Encrypt</a>(theKey, strPlaintext,
                                   strOutput,
                                   pstrDisplay, bBookends, pAlreadyHavePW);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3c3bfdb5573de45c3f56277cad7bebd"></a><!-- doxytag: member="OTSymmetricKey::Encrypt" ref="ac3c3bfdb5573de45c3f56277cad7bebd" args="(const OTSymmetricKey &amp;theKey, const OTString &amp;strPlaintext, OTString &amp;strOutput, const OTString *pstrDisplay=NULL, const bool bBookends=true, const OTPassword *pAlreadyHavePW=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#ab26cb376c0bb66dfb68002713137aff5">OTSymmetricKey::Encrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;&#160;</td>
          <td class="paramname"><em>theKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strPlaintext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bBookends</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pAlreadyHavePW</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00606">606</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!theKey.<a class="code" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">IsGenerated</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failure: theKey.IsGenerated() was false. (The calling &quot;</span>
                       <span class="stringliteral">&quot;code probably should have checked that key already...)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <span class="keywordflow">if</span> (!strPlaintext.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Plaintext is empty. Please supply. (Failure.)\n&quot;</span>,
                       __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------</span>
    <span class="comment">// By this point, we know we have a plaintext and a symmetric Key.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pPassUserInput = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> thePWAngel;

    <span class="keywordflow">if</span> (NULL == pAlreadyHavePW)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *    szDisplay = <span class="stringliteral">&quot;Password-protecting a plaintext.&quot;</span>;
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strDisplay((NULL == pstrDisplay) ? szDisplay : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// -----------------------------------------------</span>
        pPassUserInput = <a class="code" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">OTSymmetricKey::GetPassphraseFromUser</a>(&amp;strDisplay);<span class="comment">//bAskTwice=false by default.</span>
        thePWAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pPassUserInput); <span class="comment">// may be NULL.</span>
    }
    <span class="keywordflow">else</span>
        pPassUserInput = <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_password.html">OTPassword</a> *<span class="keyword">&gt;</span>(pAlreadyHavePW);
    <span class="comment">// -----------------------------------------------</span>
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascOutput;
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL != pPassUserInput) <span class="comment">// Success retrieving the passphrase from the user. (Now let&#39;s encrypt...)</span>
    {
        <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope;

        <span class="keywordflow">if</span> (theEnvelope.<a class="code" href="class_o_t_envelope.html#aabf0fe42b8839ed8e531d576d45d5d82">Encrypt</a>(strPlaintext, const_cast&lt;OTSymmetricKey &amp;&gt;(theKey), *pPassUserInput) &amp;&amp;
            theEnvelope.<a class="code" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">GetAsciiArmoredData</a>(ascOutput))
        {
            bSuccess = <span class="keyword">true</span>;

            <span class="keywordflow">if</span> (bBookends)
            {
                <span class="keywordflow">return</span> ascOutput.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strOutput, <span class="stringliteral">&quot;SYMMETRIC MSG&quot;</span>, <span class="comment">// todo hardcoding.</span>
                                                    <span class="keyword">false</span>);<span class="comment">//bEscaped=false</span>
            }
            <span class="keywordflow">else</span>
            {
                strOutput.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(ascOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            }
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Failed trying to encrypt. (Sorry.)\n&quot;</span>,
                           __FUNCTION__);
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,<span class="stringliteral">&quot;%s: Sorry, unable to retrieve passphrase from user. (Failure.)\n&quot;</span>,
                       __FUNCTION__);

    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e5ce58cbef7f7799b93803b71950b5e"></a><!-- doxytag: member="OTSymmetricKey::GenerateHashCheck" ref="a9e5ce58cbef7f7799b93803b71950b5e" args="(const OTPassword &amp;thePassphrase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a9e5ce58cbef7f7799b93803b71950b5e">OTSymmetricKey::GenerateHashCheck</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00273">273</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(m_uIterationCount &gt; 1000);

    <span class="keywordflow">if</span> (!m_bIsGenerated)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No Key Generated, run GenerateKey(), and this function will not be needed!&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Already have a HashCheck, no need to create one!&quot;</span>,__FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>());

    <a class="code" href="class_o_t_password.html">OTPassword</a> * pDerivedKey = this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a7784859786cd0bfb61def268a6dbb9a7">CalculateNewDerivedKeyFromPassphrase</a>(thePassphrase); <span class="comment">// asserts already.</span>

    <span class="keywordflow">if</span> (NULL == pDerivedKey) <span class="comment">// A pointerpointer was passed in... (caller will be responsible then, to delete.)</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: failed to calculate derived key&quot;</span>,__FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Still don&#39;t have a hash check (even after generating one)\n!&quot;</span>
            <span class="stringliteral">&quot;this is bad. Will assert.&quot;</span>,__FUNCTION__);
        <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2ef54d17c58afc9edea214ea0a2dcf13"></a><!-- doxytag: member="OTSymmetricKey::GenerateKey" ref="a2ef54d17c58afc9edea214ea0a2dcf13" args="(const OTPassword &amp;thePassphrase, OTPassword **ppDerivedKey=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a2ef54d17c58afc9edea214ea0a2dcf13">OTSymmetricKey::GenerateKey</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> **&#160;</td>
          <td class="paramname"><em>ppDerivedKey</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00185">185</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(m_uIterationCount &gt; 1000);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!m_bIsGenerated);
<span class="comment">//  OT_ASSERT(thePassphrase.isPassword());</span>
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTSymmetricKey::GenerateKey&quot;</span>;

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;  Begin: %s: GENERATING keys and passwords...\n&quot;</span>, szFunc);
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_dataIV.<a class="code" href="class_o_t_data.html#aa4b4bd29833edcce5ddd0f51c5cdbb3c">Randomize</a>( <a class="code" href="class_o_t_crypto_config.html#ae6a1a4137bd87e84c342bb4e0149ca56">OTCryptoConfig::SymmetricIvSize</a>() ))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed generating iv for encrypting a symmetric key. (Returning false.)\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_dataSalt.<a class="code" href="class_o_t_data.html#aa4b4bd29833edcce5ddd0f51c5cdbb3c">Randomize</a>( <a class="code" href="class_o_t_crypto_config.html#a8ef27ed3967ca9cc50278997f83d0de4">OTCryptoConfig::SymmetricSaltSize</a>() ))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed generating random salt. (Returning false.)\n&quot;</span>,
                      szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Generate actual key (a randomized memory space.)</span>
    <span class="comment">// We will use the derived key for encrypting the actual key.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a>  theActualKey;

    {
        int32_t nRes = theActualKey.<a class="code" href="class_o_t_password.html#afcf148c0f8fdc26702d9448e97cedcc4">randomizeMemory</a>(<a class="code" href="class_o_t_crypto_config.html#a835596fd28dc8f14d62e6a141e6b4c11">OTCryptoConfig::SymmetricKeySize</a>()); <span class="keywordflow">if</span> (0 &gt; nRes) { <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
        uint32_t uRes = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(nRes); <span class="comment">// we need an uint32_t value.</span>

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_crypto_config.html#a835596fd28dc8f14d62e6a141e6b4c11">OTCryptoConfig::SymmetricKeySize</a>() != uRes)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed generating symmetric key. (Returning false.)\n&quot;</span>, szFunc);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// We didn&#39;t bother generating the derived key if the above three randomizations failed.</span>
    <span class="comment">//</span>
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="comment">// Generate derived key from passphrase.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> theDerivedAngel;
    <span class="comment">// ------------------------</span>

    <a class="code" href="class_o_t_password.html">OTPassword</a> * pDerivedKey = this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a7784859786cd0bfb61def268a6dbb9a7">CalculateNewDerivedKeyFromPassphrase</a>(thePassphrase); <span class="comment">// asserts already.</span>

    <span class="keywordflow">if</span> (NULL != ppDerivedKey) <span class="comment">// A pointerpointer was passed in... (caller will be responsible then, to delete.)</span>
    {
        *ppDerivedKey = pDerivedKey;
    }
    <span class="keywordflow">else</span> <span class="comment">// We only clean it up in this case, where the caller didn&#39;t want the pointer passed back.</span>
    {
        theDerivedAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pDerivedKey);
    }
    <span class="comment">// Below this point, pDerivedKey is NOT null. (And we only clean it up later if we created it.)</span>
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Below this point, pDerivedKey contains a symmetric key derived from the salt, the iteration</span>
    <span class="comment">// count, and the password that was passed in. We will store the salt and iteration count inside this</span>
    <span class="comment">// OTSymmetricKey object, and we&#39;ll store an encrypted copy of the ActualKey, encrypted to pDerivedKey.</span>
    <span class="comment">// We&#39;ll also store the IV, which is generated while encrypting the actual key, and which must be used</span>
    <span class="comment">// while decrypting it later.</span>
    <span class="comment">//</span>
    <span class="comment">// Encrypt theActualKey using pDerivedKey, which is clear/raw already. (Both are OTPasswords.)</span>
    <span class="comment">// Put the result into the OTPayload m_dataEncryptedKey.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bEncryptedKey = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a4fa0bfe14ed42ebf60e696603ae53c0b">Encrypt</a>(*pDerivedKey,  <span class="comment">// pDerivedKey is a symmetric key, in clear form. Used for encrypting theActualKey.</span>
                                                       <span class="comment">// -------------------------------</span>
                                                       reinterpret_cast&lt;const char *&gt;(theActualKey.<a class="code" href="class_o_t_password.html#af3c2834981627910da5408018c588ad1">getMemory_uint8</a>()), <span class="comment">// This is the Plaintext that&#39;s being encrypted.</span>
                                                       static_cast&lt;uint32_t&gt;(theActualKey.<a class="code" href="class_o_t_password.html#a9733667570f4ee91a4c8993d11f198a8">getMemorySize</a>()),
                                                       <span class="comment">// -------------------------------</span>
                                                       m_dataIV, <span class="comment">// generated above.</span>
                                                       <span class="comment">// -------------------------------</span>
                                                       m_dataEncryptedKey); <span class="comment">// OUTPUT. (Ciphertext.)</span>
    m_bIsGenerated = bEncryptedKey;

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;  End: %s: (GENERATING keys and passwords...) %s\n&quot;</span>,
                   szFunc, m_bIsGenerated ? <span class="stringliteral">&quot;SUCCESS&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);

    <span class="keywordflow">return</span> m_bIsGenerated;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a70cc2a2c32250ae5c005df3fac0497ba"></a><!-- doxytag: member="OTSymmetricKey::GetIdentifier" ref="a70cc2a2c32250ae5c005df3fac0497ba" args="(OTIdentifier &amp;theIdentifier) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_symmetric_key.html#a70cc2a2c32250ae5c005df3fac0497ba">OTSymmetricKey::GetIdentifier</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theIdentifier</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00159">159</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">//  const bool bCalc =</span>
        theIdentifier.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(m_dataEncryptedKey);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1fa4797eca8e110a9396b551bc8121cd"></a><!-- doxytag: member="OTSymmetricKey::GetIdentifier" ref="a1fa4797eca8e110a9396b551bc8121cd" args="(OTString &amp;strIdentifier) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_symmetric_key.html#a70cc2a2c32250ae5c005df3fac0497ba">OTSymmetricKey::GetIdentifier</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strIdentifier</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00166">166</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theIdentifier;
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bCalc =
        theIdentifier.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(m_dataEncryptedKey);
    <span class="keywordflow">if</span> (bCalc)
        theIdentifier.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strIdentifier);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae44e319c2200c279a14720cff7c4ae4c"></a><!-- doxytag: member="OTSymmetricKey::GetPassphraseFromUser" ref="ae44e319c2200c279a14720cff7c4ae4c" args="(const OTString *pstrDisplay=NULL, const bool bAskTwice=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_password.html">OTPassword</a> * <a class="el" href="class_o_t_symmetric_key.html#ae44e319c2200c279a14720cff7c4ae4c">OTSymmetricKey::GetPassphraseFromUser</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrDisplay</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bAskTwice</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00497">497</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Caller MUST delete!</span>
    <span class="comment">// ---------------------------------------------------</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a> * pPassUserInput = <a class="code" href="class_o_t_password.html#a9d2847ff2f726967fbd7816be9b949bb">OTPassword::CreateTextBuffer</a>(); <span class="comment">// already asserts.</span>
<span class="comment">//  pPassUserInput-&gt;zeroMemory(); // This was causing the password to come out blank.</span>
    <span class="comment">//</span>
    <span class="comment">// Below this point, pPassUserInput must be returned, or deleted. (Or it will leak.)</span>
    <span class="comment">// -----------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    szDisplay = <span class="stringliteral">&quot;OTSymmetricKey::GetPassphraseFromUser&quot;</span>;
    <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>  thePWData((NULL == pstrDisplay) ? szDisplay : pstrDisplay-&gt;<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    thePWData.<a class="code" href="class_o_t_password_data.html#a11ca259c6e392ea9334d7e90b9898ce2">setUsingOldSystem</a>(); <span class="comment">// So the cached key doesn&#39;t interfere, since this is for a plain symmetric key.</span>
    <span class="comment">// -----------------------------------------------</span>
    <span class="keyword">const</span> int32_t nCallback = <a class="code" href="_o_t_asymmetric_key_8hpp.html#a79d50d373e469219a3c6d17f9bee6bd1">souped_up_pass_cb</a>(pPassUserInput-&gt;<a class="code" href="class_o_t_password.html#a76a7156aa0d0d87a7eb3b9b5b869e014">getPasswordWritable_char</a>(),
                                            pPassUserInput-&gt;<a class="code" href="class_o_t_password.html#a8a596bf908d5410df57568639d171fe7">getBlockSize</a>(),
                                            bAskTwice ? 1 : 0,
                                            <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(&amp;thePWData));
    <span class="keyword">const</span> uint32_t uCallback = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(nCallback);
    <span class="keywordflow">if</span> ((nCallback &gt; 0) &amp;&amp;<span class="comment">// Success retrieving the passphrase from the user.</span>
        pPassUserInput-&gt;<a class="code" href="class_o_t_password.html#aa1a20005994cc550df4c72a2df2a2dee">SetSize</a>(uCallback))
    {
<span class="comment">//      OTLog::vOutput(0, &quot;%s: Retrieved passphrase (blocksize %d, actual size %d) from user: %s\n&quot;, __FUNCTION__,</span>
<span class="comment">//                     pPassUserInput-&gt;getBlockSize(), nCallback, pPassUserInput-&gt;getPassword());</span>
        <span class="keywordflow">return</span> pPassUserInput; <span class="comment">// Caller MUST delete!</span>
    }
    <span class="keywordflow">else</span>
    {
        <span class="keyword">delete</span> pPassUserInput; pPassUserInput = NULL;
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Sorry, unable to retrieve passphrase from user. (Failure.)\n&quot;</span>, __FUNCTION__);
    }

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a99470a8be3349bb0d0336802aeff60fb"></a><!-- doxytag: member="OTSymmetricKey::GetRawKeyFromDerivedKey" ref="a99470a8be3349bb0d0336802aeff60fb" args="(const OTPassword &amp;theDerivedKey, OTPassword &amp;theRawKeyOutput) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a99470a8be3349bb0d0336802aeff60fb">OTSymmetricKey::GetRawKeyFromDerivedKey</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>theDerivedKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>theRawKeyOutput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00461">461</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(m_bIsGenerated);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(theDerivedKey.<a class="code" href="class_o_t_password.html#a59342b6d2f7224d6436e4950d0432612">isMemory</a>());
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTSymmetricKey::GetRawKeyFromDerivedKey&quot;</span>;
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Decrypt theActualKey using theDerivedKey, which is clear/raw already. (Both are OTPasswords.)</span>
    <span class="comment">// Put the result into theRawKeyOutput.</span>
    <span class="comment">//</span>
    <span class="comment">// theDerivedKey is a symmetric key, in clear form. Used here</span>
    <span class="comment">// for decrypting m_dataEncryptedKey into theRawKeyOutput.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: *Begin) Attempting to recover actual key using derived key...\n&quot;</span>, szFunc);

    <span class="keyword">const</span> <span class="keywordtype">bool</span> bDecryptedKey = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a26d95569b445dd5f8f599543a8ede627">Decrypt</a>(theDerivedKey, <span class="comment">// We&#39;re using theDerivedKey to decrypt m_dataEncryptedKey.</span>
                                                       <span class="comment">// -------------------------------</span>
                                                       <span class="comment">// Here&#39;s what we&#39;re trying to decrypt: the encrypted</span>
                                                       <span class="comment">// form of the symmetric key.</span>
                                                       <span class="comment">//</span>
                                                       static_cast&lt;const char *&gt;(m_dataEncryptedKey.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>()), <span class="comment">// The Ciphertext.</span>
                                                       m_dataEncryptedKey.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>(),
                                                       <span class="comment">// -------------------------------</span>
                                                       m_dataIV, <span class="comment">// Created when *this symmetric key was generated. Both are already stored.</span>
                                                       <span class="comment">// -------------------------------</span>
                                                       theRawKeyOutput); <span class="comment">// OUTPUT. (Recovered plaintext of symmetric key.) You can pass OTPassword&amp; OR OTPayload&amp; here (either will work.)</span>

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: (End) attempt to recover actual key using derived key...\n&quot;</span>, szFunc);
    <span class="keywordflow">return</span> bDecryptedKey;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6930ce6ccea45d4259a8e44171d27763"></a><!-- doxytag: member="OTSymmetricKey::GetRawKeyFromPassphrase" ref="a6930ce6ccea45d4259a8e44171d27763" args="(const OTPassword &amp;thePassphrase, OTPassword &amp;theRawKeyOutput, OTPassword *pDerivedKey=NULL) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a6930ce6ccea45d4259a8e44171d27763">OTSymmetricKey::GetRawKeyFromPassphrase</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>theRawKeyOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password.html">OTPassword</a> *&#160;</td>
          <td class="paramname"><em>pDerivedKey</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00423">423</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(m_bIsGenerated);
<span class="comment">//  OT_ASSERT(thePassphrase.isPassword());</span>
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPassword&gt;</a> theDerivedAngel;
    <span class="comment">// ------------------------</span>
    <span class="keywordflow">if</span> (NULL == pDerivedKey)
    {
        <span class="comment">// todo, security: Do we have to create all these OTPassword objects on the stack, just</span>
        <span class="comment">// as a general practice? In which case I can&#39;t use this factory how I&#39;m using it now...</span>
        <span class="comment">//</span>

        pDerivedKey = this-&gt;<a class="code" href="class_o_t_symmetric_key.html#ad91f8bb8c8384b0719204df381fa693f">CalculateDerivedKeyFromPassphrase</a>(thePassphrase,<span class="keyword">false</span>); <span class="comment">// asserts already.</span>

        theDerivedAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pDerivedKey);
    }
    <span class="comment">// Below this point, pDerivedKey is NOT null. And we only clean it up if we created it.</span>
    <span class="comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Below this point, pDerivedKey contains a derived symmetric key, from the salt, the iteration</span>
    <span class="comment">// count, and the password that was passed in. The salt and iteration count were both stored inside this</span>
    <span class="comment">// OTSymmetricKey object since this key was originally generated, and we store an encrypted copy of the</span>
    <span class="comment">// ActualKey already, as well-- it&#39;s encrypted to the Derived Key. (We also store the IV from that</span>
    <span class="comment">// encryption bit.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a99470a8be3349bb0d0336802aeff60fb">GetRawKeyFromDerivedKey</a>(*pDerivedKey, theRawKeyOutput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a213fa5c52407fa234f8396c4f795f783"></a><!-- doxytag: member="OTSymmetricKey::HasHashCheck" ref="a213fa5c52407fa234f8396c4f795f783" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">OTSymmetricKey::HasHashCheck</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8hpp_source.html#l00230">230</a> of file <a class="el" href="_o_t_symmetric_key_8hpp_source.html">OTSymmetricKey.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_bHasHashCheck; }
</pre></div>
</div>
</div>
<a class="anchor" id="a9e2eced2ded569ff96ddace6488a7968"></a><!-- doxytag: member="OTSymmetricKey::IsGenerated" ref="a9e2eced2ded569ff96ddace6488a7968" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">OTSymmetricKey::IsGenerated</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8hpp_source.html#l00229">229</a> of file <a class="el" href="_o_t_symmetric_key_8hpp_source.html">OTSymmetricKey.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_bIsGenerated; }
</pre></div>
</div>
</div>
<a class="anchor" id="a0fe3f33b0b6446d24fcd4e6d34cb32d3"></a><!-- doxytag: member="OTSymmetricKey::ReGenerateHashCheck" ref="a0fe3f33b0b6446d24fcd4e6d34cb32d3" args="(const OTPassword &amp;thePassphrase)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a0fe3f33b0b6446d24fcd4e6d34cb32d3">OTSymmetricKey::ReGenerateHashCheck</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassphrase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00310">310</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,<span class="stringliteral">&quot;%s: Warning! We don&#39;t have a hash-check yet... &quot;</span>
                       <span class="stringliteral">&quot;will create one anyway.&quot;</span>, __FUNCTION__);
    }

    <span class="keywordflow">if</span> (!this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
        this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a98bbbe9647687fae720fc79460c96006">zeroMemory</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(this-&gt;m_dataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>());

    this-&gt;m_bHasHashCheck = <span class="keyword">false</span>;

    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a9e5ce58cbef7f7799b93803b71950b5e">GenerateHashCheck</a>(thePassphrase);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac08f410138a273455dc2c53314eccd8e"></a><!-- doxytag: member="OTSymmetricKey::Release" ref="ac08f410138a273455dc2c53314eccd8e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_symmetric_key.html#ac08f410138a273455dc2c53314eccd8e">OTSymmetricKey::Release</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l01228">1228</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_symmetric_key.html#a56ebf8fa33f04f5f2e7c27806f10e2d7">Release_SymmetricKey</a>();

    <span class="comment">// no call to ot_super::Release() here, since this is a base class (currently with no children...)</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a56ebf8fa33f04f5f2e7c27806f10e2d7"></a><!-- doxytag: member="OTSymmetricKey::Release_SymmetricKey" ref="a56ebf8fa33f04f5f2e7c27806f10e2d7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_symmetric_key.html#a56ebf8fa33f04f5f2e7c27806f10e2d7">OTSymmetricKey::Release_SymmetricKey</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l01216">1216</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    m_bIsGenerated    = <span class="keyword">false</span>;
    m_uIterationCount = <a class="code" href="class_o_t_crypto_config.html#a4689bd532160fb559daf7432e022fa9e">OTCryptoConfig::IterationCount</a>();
    m_nKeySize        = <a class="code" href="class_o_t_crypto_config.html#a835596fd28dc8f14d62e6a141e6b4c11">OTCryptoConfig::SymmetricKeySize</a>() * 8; <span class="comment">// 128 (in bits)</span>

    m_dataSalt.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
    m_dataIV.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
    m_dataEncryptedKey.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac1a0a93da93305492ecebca03110a954"></a><!-- doxytag: member="OTSymmetricKey::SerializeFrom" ref="ac1a0a93da93305492ecebca03110a954" args="(OTPayload &amp;theInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">OTSymmetricKey::SerializeFrom</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00901">901</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTSymmetricKey::SerializeFrom&quot;</span>;

    uint32_t  nRead  = 0;

    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;is generated&quot; flag. (convert to host order)</span>
    <span class="comment">//</span>
    uint16_t  n_is_generated = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_is_generated),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_is_generated)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_is_generated.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>
    <span class="comment">//</span>
    uint16_t host_is_generated = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(ntohs(static_cast&lt;uint16_t&gt;(n_is_generated)));

    <span class="keywordflow">if</span> (1 == host_is_generated)
        m_bIsGenerated = <span class="keyword">true</span>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == host_is_generated)
        m_bIsGenerated = <span class="keyword">false</span>;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: host_is_generated, Bad value: %d. (Expected 0 or 1.)\n&quot;</span>,
                      szFunc, static_cast&lt;int32_t&gt;(host_is_generated));
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ****************************************************************************</span>

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: is_generated: %d \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int32_t&gt;(host_is_generated)
                   );

    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;key size in bits&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint16_t  n_key_size_bits = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_key_size_bits),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_key_size_bits)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_key_size_bits.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    m_nKeySize = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(ntohs(n_key_size_bits));

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: key_size_bits: %d \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int32_t&gt;(m_nKeySize)
                   );


    <span class="comment">// ****************************************************************************</span>



    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;iteration count&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint32_t  n_iteration_count = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_iteration_count),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iteration_count)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_iteration_count.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iteration_count)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    m_uIterationCount = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(ntohl(n_iteration_count));

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: iteration_count: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(m_uIterationCount)
                   );

    <span class="comment">// ****************************************************************************</span>


    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;salt size&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint32_t  n_salt_size = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_salt_size),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_salt_size)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_salt_size.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_salt_size)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    <span class="keyword">const</span> uint32_t lSaltSize = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(ntohl(static_cast&lt;uint32_t&gt;(n_salt_size)));

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: salt_size value: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(lSaltSize)
                   );

    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Then read the Salt itself.</span>
    <span class="comment">//</span>
    m_dataSalt.<a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lSaltSize);

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(static_cast&lt;uint8_t*&gt;(const_cast&lt;void *&gt;(m_dataSalt.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>())),
                                       <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(lSaltSize))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading salt for symmetric key.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: salt length actually read: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(nRead)
                   );
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(lSaltSize));
    <span class="comment">// ****************************************************************************</span>


    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;IV size&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint32_t  n_iv_size = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_iv_size),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iv_size)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_iv_size.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iv_size)));

    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    <span class="keyword">const</span> uint32_t lIVSize = ntohl(n_iv_size);

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: iv_size value: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(lIVSize)
                   );

    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Then read the IV itself.</span>
    <span class="comment">//</span>
    m_dataIV.<a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lIVSize);

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(static_cast&lt;uint8_t*&gt;(const_cast&lt;void *&gt;(m_dataIV.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>())),
                                       <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(lIVSize))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading IV for symmetric key.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: iv length actually read: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(nRead)
                   );

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(lIVSize));
    <span class="comment">// ****************************************************************************</span>



    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;encrypted key size&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint32_t  n_enc_key_size = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_enc_key_size),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_enc_key_size)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_enc_key_size.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_enc_key_size)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    <span class="keyword">const</span> uint32_t lEncKeySize = ntohl(n_enc_key_size);

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: enc_key_size value: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(lEncKeySize)
                   );

    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Then read the Encrypted Key itself.</span>
    <span class="comment">//</span>
    m_dataEncryptedKey.<a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lEncKeySize);

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(static_cast&lt;uint8_t*&gt;(const_cast&lt;void *&gt;(m_dataEncryptedKey.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>())),
                                       <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(lEncKeySize))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading encrypted symmetric key.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: encrypted key length actually read: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(nRead)
                   );

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(lEncKeySize));
    <span class="comment">// ****************************************************************************</span>




    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order &quot;hash check size&quot;. (convert to host order)</span>
    <span class="comment">//</span>
    uint32_t  n_hash_check_size = 0;

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;n_hash_check_size),
                                       static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_hash_check_size)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading n_hash_check_size.\n&quot;</span>, szFunc);
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Looks like we don&#39;t have a hash check yet! (will make one)\n&quot;</span>, szFunc);
        m_bHasHashCheck = <span class="keyword">false</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_hash_check_size)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert from network to HOST endian.</span>

    <span class="keyword">const</span> uint32_t lHashCheckSize = ntohl(n_hash_check_size);

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: hash_check_size value: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(lHashCheckSize)
                   );

    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Then read the Hashcheck itself.</span>
    <span class="comment">//</span>
    m_dataHashCheck.<a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lHashCheckSize);

    <span class="keywordflow">if</span> (0 == (nRead = theInput.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(static_cast&lt;uint8_t*&gt;(const_cast&lt;void *&gt;(m_dataHashCheck.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>())),
                                       <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(lHashCheckSize))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading hash check data.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: hash check data actually read: %lld \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int64_t&gt;(nRead)
                   );

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(lHashCheckSize));

    m_bHasHashCheck = !m_dataHashCheck.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>();

    <span class="comment">// ****************************************************************************</span>





    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af49b67936c16577a90f531d0299097e1"></a><!-- doxytag: member="OTSymmetricKey::SerializeFrom" ref="af49b67936c16577a90f531d0299097e1" args="(const OTASCIIArmor &amp;ascInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">OTSymmetricKey::SerializeFrom</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>ascInput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00815">815</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theInput;

    <span class="keywordflow">if</span> (ascInput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; ascInput.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a5564f05ead3366c5b97c8b7edfea083b">GetData</a>(theInput))
    {
        <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">SerializeFrom</a>(theInput);
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a73decb41b01032c1cd28a42df4df9d3d"></a><!-- doxytag: member="OTSymmetricKey::SerializeFrom" ref="a73decb41b01032c1cd28a42df4df9d3d" args="(const OTString &amp;strInput, bool bEscaped=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">OTSymmetricKey::SerializeFrom</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strInput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bEscaped</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00786">786</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascInput;

    <span class="keywordflow">if</span> (strInput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; ascInput.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">LoadFromString</a>(const_cast&lt;OTString &amp;&gt;(strInput),
                                                     bEscaped,
                                                     <span class="stringliteral">&quot;-----BEGIN OT ARMORED SYMMETRIC KEY&quot;</span>))
    {
        <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_symmetric_key.html#ac1a0a93da93305492ecebca03110a954">SerializeFrom</a>(ascInput);
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9d5d084b9986a338d28d171b8721ac2a"></a><!-- doxytag: member="OTSymmetricKey::SerializeTo" ref="a9d5d084b9986a338d28d171b8721ac2a" args="(OTPayload &amp;theOutput) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">OTSymmetricKey::SerializeTo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00827">827</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------</span>
    uint16_t   from_bool_is_generated = (m_bIsGenerated ? 1 : 0);
    uint16_t   n_is_generated    = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(htons(static_cast&lt;uint16_t&gt;(from_bool_is_generated)));
    uint16_t   n_key_size_bits   = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(htons(static_cast&lt;uint16_t&gt;(m_nKeySize)));
    <span class="comment">// ----------------------------------------------------------------------------------------</span>
    uint32_t   n_iteration_count = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(htonl(static_cast&lt;uint32_t&gt;(m_uIterationCount)));

    uint32_t   n_salt_size       = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(htonl(static_cast&lt;uint32_t&gt;(m_dataSalt.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>())));
    uint32_t   n_iv_size         = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(htonl(static_cast&lt;uint32_t&gt;(m_dataIV.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>())));
    uint32_t   n_enc_key_size    = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(htonl(static_cast&lt;uint32_t&gt;(m_dataEncryptedKey.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>())));

    uint32_t   n_hash_check_size  = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(htonl(static_cast&lt;uint32_t&gt;(m_dataHashCheck.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>())));
    <span class="comment">// -----------------------------------------------</span>
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(5, <span class="stringliteral">&quot;%s: is_generated: %d   key_size_bits: %d   iteration_count: %lld   \n  &quot;</span>
                   <span class="stringliteral">&quot;salt_size: %lld   iv_size: %lld   enc_key_size: %lld   \n&quot;</span>,
                   __FUNCTION__,
                   static_cast&lt;int32_t&gt;(ntohs(n_is_generated)),
                   static_cast&lt;int32_t&gt;(ntohs(n_key_size_bits)),

                   static_cast&lt;int64_t&gt;(ntohl(n_iteration_count)),
                   static_cast&lt;int64_t&gt;(ntohl(n_salt_size)),
                   static_cast&lt;int64_t&gt;(ntohl(n_iv_size)),
                   static_cast&lt;int64_t&gt;(ntohl(n_enc_key_size))
                   );
    <span class="comment">// -----------------------------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_is_generated),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_is_generated)));
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_key_size_bits),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_key_size_bits)));
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_iteration_count),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iteration_count)));
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_salt_size),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_salt_size)));
    <span class="comment">// -------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != m_dataSalt.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>());
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(m_dataSalt.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(),
                          m_dataSalt.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>());
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_iv_size),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_iv_size)));
    <span class="comment">// -------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != m_dataIV.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>());
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(m_dataIV.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(),
                          m_dataIV.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>());
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_enc_key_size),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_enc_key_size)));
    <span class="comment">// -------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != m_dataEncryptedKey.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>());
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(m_dataEncryptedKey.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(),
                          m_dataEncryptedKey.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>());
    <span class="comment">// -------------------------</span>
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;n_hash_check_size),
                          static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(n_hash_check_size)));
    <span class="comment">// -------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != m_dataHashCheck.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>());
    theOutput.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(m_dataHashCheck.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(),
                          m_dataHashCheck.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>());
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa3b444f4a615eb4b020f23089088e6fd"></a><!-- doxytag: member="OTSymmetricKey::SerializeTo" ref="aa3b444f4a615eb4b020f23089088e6fd" args="(OTASCIIArmor &amp;ascOutput) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">OTSymmetricKey::SerializeTo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>ascOutput</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00801">801</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theOutput;

    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">SerializeTo</a>(theOutput))
    {
        ascOutput.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a48e0e2e2eff86ad382a2cc63298a0b8b">SetData</a>(theOutput);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac7063cc96832cd524c648ad1255223cb"></a><!-- doxytag: member="OTSymmetricKey::SerializeTo" ref="ac7063cc96832cd524c648ad1255223cb" args="(OTString &amp;strOutput, bool bEscaped=false) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">OTSymmetricKey::SerializeTo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bEscaped</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_symmetric_key_8cpp_source.html#l00775">775</a> of file <a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascOutput;

    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_symmetric_key.html#a9d5d084b9986a338d28d171b8721ac2a">SerializeTo</a>(ascOutput))
        <span class="keywordflow">return</span> ascOutput.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strOutput, <span class="stringliteral">&quot;SYMMETRIC KEY&quot;</span>, bEscaped);

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_symmetric_key_8hpp_source.html">OTSymmetricKey.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_symmetric_key_8cpp_source.html">OTSymmetricKey.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:17 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
