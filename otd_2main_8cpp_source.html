<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otd/main.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('otd_2main_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otd/main.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="otd_2main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *  main.cpp  (Uses ZMQ for transport.)</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00009"></a>00009 <span class="comment"> Hash: SHA1</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00014"></a>00014 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00017"></a>00017 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> *  EMAIL:</span>
<a name="l00027"></a>00027 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00032"></a>00032 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00035"></a>00035 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00036"></a>00036 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> *  WEBSITE:</span>
<a name="l00039"></a>00039 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *  Components and licensing:</span>
<a name="l00042"></a>00042 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00043"></a>00043 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00048"></a>00048 <span class="comment"> *</span>
<a name="l00049"></a>00049 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00050"></a>00050 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00051"></a>00051 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00052"></a>00052 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *   LICENSE:</span>
<a name="l00057"></a>00057 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00058"></a>00058 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00059"></a>00059 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00060"></a>00060 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00061"></a>00061 <span class="comment"> *   option) any later version.</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00064"></a>00064 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00065"></a>00065 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00066"></a>00066 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00067"></a>00067 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00068"></a>00068 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00069"></a>00069 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00070"></a>00070 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00071"></a>00071 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00072"></a>00072 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00073"></a>00073 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00074"></a>00074 <span class="comment"> *</span>
<a name="l00075"></a>00075 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00076"></a>00076 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00077"></a>00077 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00078"></a>00078 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00079"></a>00079 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00080"></a>00080 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00081"></a>00081 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00082"></a>00082 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00083"></a>00083 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00084"></a>00084 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *   Lucre License:</span>
<a name="l00087"></a>00087 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00088"></a>00088 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00089"></a>00089 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00090"></a>00090 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00091"></a>00091 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00092"></a>00092 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00093"></a>00093 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00094"></a>00094 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00095"></a>00095 <span class="comment"> *   will continue to operate.</span>
<a name="l00096"></a>00096 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00097"></a>00097 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00098"></a>00098 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00099"></a>00099 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00100"></a>00100 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00101"></a>00101 <span class="comment"> *</span>
<a name="l00102"></a>00102 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00103"></a>00103 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00104"></a>00104 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00105"></a>00105 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00106"></a>00106 <span class="comment"> *</span>
<a name="l00107"></a>00107 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00108"></a>00108 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00109"></a>00109 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00110"></a>00110 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00111"></a>00111 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00112"></a>00112 <span class="comment"> *   more details.</span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00115"></a>00115 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00116"></a>00116 <span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00118"></a>00118 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00119"></a>00119 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00120"></a>00120 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00121"></a>00121 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00122"></a>00122 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00123"></a>00123 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00124"></a>00124 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00125"></a>00125 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00126"></a>00126 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00127"></a>00127 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00128"></a>00128 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00129"></a>00129 <span class="comment"> =uSzz</span>
<a name="l00130"></a>00130 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00131"></a>00131 <span class="comment"> **************************************************************/</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="preprocessor">#include &lt;anyoption.hpp&gt;</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_a_p_i_8hpp.html">OTAPI.hpp</a>&gt;</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &lt;<a class="code" href="_open_transactions_8hpp.html">OpenTransactions.hpp</a>&gt;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &lt;<a class="code" href="_o_t___m_e_8hpp.html">OT_ME.hpp</a>&gt;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_client_8hpp.html">OTClient.hpp</a>&gt;</span>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_log_8hpp.html">OTLog.hpp</a>&gt;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_paths_8hpp.html">OTPaths.hpp</a>&gt;</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_wallet_8hpp.html">OTWallet.hpp</a>&gt;</span>
<a name="l00145"></a>00145 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_server_contract_8hpp.html">OTServerContract.hpp</a>&gt;</span>
<a name="l00146"></a>00146 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_message_8hpp.html">OTMessage.hpp</a>&gt;</span>
<a name="l00147"></a>00147 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_purse_8hpp.html">OTPurse.hpp</a>&gt;</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_envelope_8hpp.html">OTEnvelope.hpp</a>&gt;</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_account_8hpp.html">OTAccount.hpp</a>&gt;</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="preprocessor">#include &quot;<a class="code" href="ot__me__switch_8hpp.html">ot_me_switch.hpp</a>&quot;</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="preprocessor">#ifdef __APPLE__</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">#include &quot;TargetConditionals.h&quot;</span>
<a name="l00157"></a>00157 <span class="preprocessor">#endif</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="otd_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">00161</a> <span class="preprocessor">#define OT_OPTIONS_FILE_DEFAULT &quot;command-line-ot.opt&quot;</span>
<a name="l00162"></a><a class="code" href="otd_2main_8cpp.html#a2dc726b0ac838ad497799e6a133406be">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define CLIENT_PATH_DEFAULT &quot;client_data&quot; //should get programmatically</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="otd_2main_8cpp.html#acb842c842033e836cb504f29b1de8479">00165</a> <span class="preprocessor">#define CA_FILE             &quot;certs/special/ca.crt&quot;</span>
<a name="l00166"></a><a class="code" href="otd_2main_8cpp.html#a28b23a8efb961adcb6459e388ddd2b45">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_FILE            &quot;certs/special/client.pem&quot;</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="keywordtype">void</span> <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>(int32_t argc, <span class="keywordtype">char</span>* argv[], AnyOption * opt);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/*</span>
<a name="l00174"></a>00174 <span class="comment"></span>
<a name="l00175"></a>00175 <span class="comment">--server     (SERVER_ID)</span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">USAGE:  ot -COMMAND [AMOUNT] [--from ACCT/NYM/ASSET] [--to ACCT or NYM]</span>
<a name="l00178"></a>00178 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">ot -w 100    (WITHDRAW 100 FROM DEFAULT ACCOUNT.)</span>
<a name="l00180"></a>00180 <span class="comment">ot -d 100    (DEPOSIT FROM DEFAULT PURSE TO DEFAULT ACCOUNT.)</span>
<a name="l00181"></a>00181 <span class="comment">ot -t 100 --to j43k  (TRANSFER 100 FROM DEFAULT ACCT TO ACCT STARTING WITH j43k)</span>
<a name="l00182"></a>00182 <span class="comment">ot -t 100 --from qwer --to j43k  (TRANSFER 100 from ACCT STARTING WITH qwer TO ACCT starting j43k)</span>
<a name="l00183"></a>00183 <span class="comment"></span>
<a name="l00184"></a>00184 <span class="comment">*/</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">// -------------------------------------------------------------------------------</span>
<a name="l00191"></a>00191 <span class="comment">// If false, error happened, usually based on what user just attemped.</span>
<a name="l00192"></a>00192 <span class="comment">//</span>
<a name="l00193"></a><a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">00193</a> <span class="keywordtype">bool</span> <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(std::string &amp; str_ServerID,
<a name="l00194"></a>00194     std::string &amp; str_MyNym,
<a name="l00195"></a>00195     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *&amp; pMyNym,
<a name="l00196"></a>00196     <a class="code" href="class_o_t_wallet.html">OTWallet</a> *&amp; pWallet,
<a name="l00197"></a>00197     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> *&amp; pServerContract)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199     <span class="comment">// If we got down here, that means there were no commands on the command line</span>
<a name="l00200"></a>00200     <span class="comment">// (That&#39;s why we dropped into the OT prompt.)</span>
<a name="l00201"></a>00201     <span class="comment">// However, there still may have been OPTIONS -- and if so, we&#39;ll go ahead and</span>
<a name="l00202"></a>00202     <span class="comment">// load the wallet. (If there were NOT ANY OPTIONS, then we do NOT load the wallet,</span>
<a name="l00203"></a>00203     <span class="comment">// although there is a COMMAND for doing that.)</span>
<a name="l00204"></a>00204     <span class="comment">//</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a>();
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="comment">// -----------------------------------------------------</span>
<a name="l00209"></a>00209     <span class="comment">//</span>
<a name="l00210"></a>00210     pWallet = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>();
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (NULL == pWallet)
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;The wallet object is still NULL, somehow. Please load it.\n&quot;</span>);
<a name="l00215"></a>00215         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="comment">// Below this point, pWallet is available :-)</span>
<a name="l00219"></a>00219     <span class="comment">// -----------------------------------------------------</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (str_ServerID.size() &gt; 0 )
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> SERVER_ID(str_ServerID.c_str());
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ae897619f652a0d3d9fba99a8bc747993">GetServerContract</a>(SERVER_ID);
<a name="l00226"></a>00226         <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (NULL == pServerContract)
<a name="l00228"></a>00228             pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a2c08b5bd12930371f99e793762819dd5">GetServerContractPartialMatch</a>(str_ServerID);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (NULL != pServerContract)
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232             <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00233"></a>00233             pServerContract-&gt;GetIdentifier(strTemp);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235             str_ServerID = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00236"></a>00236             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as server: %s\n&quot;</span>, str_ServerID.c_str());
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         <span class="keywordflow">else</span>
<a name="l00239"></a>00239         {
<a name="l00240"></a>00240             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract. Please use the option:  --server SERVER_ID\n&quot;</span>
<a name="l00241"></a>00241                           <span class="stringliteral">&quot;(Where SERVER_ID is the server ID. Partial matches are accepted if the contract is already in the wallet.)\n&quot;</span>
<a name="l00242"></a>00242                           <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
<a name="l00243"></a>00243 <span class="comment">//          return false;</span>
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246     <span class="comment">// Below this point, pServerContract MAY be available, but also may be NULL.</span>
<a name="l00247"></a>00247     <span class="comment">//</span>
<a name="l00248"></a>00248     <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="keywordflow">if</span> ( str_MyNym.size() &gt; 0 )
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_NYM_ID(str_MyNym.c_str());
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(MY_NYM_ID);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (NULL == pMyNym)
<a name="l00258"></a>00258             pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>( str_MyNym );
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (NULL != pMyNym)
<a name="l00261"></a>00261         {
<a name="l00262"></a>00262             <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00263"></a>00263             pMyNym-&gt;GetIdentifier(strTemp);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265             str_MyNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00266"></a>00266             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mynym: %s\n&quot;</span>, str_MyNym.c_str());
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268         <span class="keywordflow">else</span>
<a name="l00269"></a>00269         {
<a name="l00270"></a>00270             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;==&gt; Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
<a name="l00271"></a>00271                           <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches are accepted if the nym is already in the wallet.)\n&quot;</span>
<a name="l00272"></a>00272                           <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
<a name="l00273"></a>00273 <span class="comment">//          return false;</span>
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275     } <span class="comment">// Below this point, pMyNym MIGHT be a valid pointer, or MIGHT be NULL.</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="comment">// Below THIS point, there&#39;s no guarantee of pWallet, though it MIGHT be there.</span>
<a name="l00278"></a>00278     <span class="comment">// Same with pServerContract. (MIGHT be there.)</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">00287</a> <span class="keywordtype">void</span> <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>( int32_t argc, <span class="keywordtype">char</span>* argv[], AnyOption * opt)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (NULL == opt)
<a name="l00290"></a>00290         <span class="keywordflow">return</span>;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath(<a class="code" href="class_o_t_paths.html#a6634797ea86b0da2d66a816e604b538b">OTPaths::AppDataFolder</a>());
<a name="l00293"></a>00293     { <span class="keywordtype">bool</span> GetConfigPathSuccess = strConfigPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; 3 &lt; strConfigPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>();
<a name="l00294"></a>00294     <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(GetConfigPathSuccess,<span class="stringliteral">&quot;HandleCommandLineArguments:  Must Set Conifg Path First!&quot;</span>); }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="comment">/* 1. CREATE AN OBJECT */</span>
<a name="l00299"></a>00299     <span class="comment">//    AnyOption *opt = new AnyOption();</span>
<a name="l00300"></a>00300     <span class="comment">//    OT_ASSERT(NULL != opt);</span>
<a name="l00301"></a>00301     <span class="comment">//    OTCleanup&lt;AnyOption&gt; theOptionAngel(opt);</span>
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="comment">// -----------------------------------------------------</span>
<a name="l00304"></a>00304     <span class="comment">/* 2. SET PREFERENCES  */</span>
<a name="l00305"></a>00305     <span class="comment">//opt-&gt;noPOSIX(); /* do not check for POSIX style character options */</span>
<a name="l00306"></a>00306     <span class="comment">//opt-&gt;setVerbose(); /* print warnings about unknown options */</span>
<a name="l00307"></a>00307     <span class="comment">//opt-&gt;autoUsagePrint(true); /* print usage for bad options */</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">// -----------------------------------------------------</span>
<a name="l00310"></a>00310     <span class="comment">/* 3. SET THE USAGE/HELP   */</span>
<a name="l00311"></a>00311     opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
<a name="l00312"></a>00312     opt-&gt;addUsage( <span class="stringliteral">&quot; **** NOTE: DO NOT USE &#39;ot&#39; !! Use &#39;opentxs help&#39; instead! *** OT CLI Usage:  &quot;</span> );
<a name="l00313"></a>00313     opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
<a name="l00314"></a>00314     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --stat (Prints the wallet contents)    ot --prompt (Enter the OT prompt)&quot;</span> );
<a name="l00315"></a>00315     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  [-h|-?|--help]    (Prints this help)   ot --script &lt;filename&gt; [--args \&quot;key value ...\&quot;]&quot;</span> );
<a name="l00316"></a>00316     opt-&gt;addUsage( <span class="stringliteral">&quot;The &#39;|&#39; symbol means use --balance or -b, use --withdraw or -w, etc.&quot;</span> );
<a name="l00317"></a>00317     opt-&gt;addUsage( <span class="stringliteral">&quot;The brackets &#39;[]&#39; show required arguments, where default values are&quot;</span> );
<a name="l00318"></a>00318     opt-&gt;addUsage( <span class="stringliteral">&quot;normally expected to be found in:   ~/.ot/command-line-ot.opt&quot;</span> );
<a name="l00319"></a>00319     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --balance  | -b          [--myacct &lt;acct_id&gt;]   (Display account balance)&quot;</span> );
<a name="l00320"></a>00320     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --withdraw | -w &lt;amount&gt; [--myacct &lt;acct_id&gt;]   (Withdraw as CASH)&quot;</span> );
<a name="l00321"></a>00321     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --transfer | -t &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisacct &lt;acct_id&gt;]&quot;</span> );
<a name="l00322"></a>00322     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --cheque   | -c &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisnym  &lt;nym_id&gt; ]&quot;</span> );
<a name="l00323"></a>00323     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --voucher  | -v &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisnym  &lt;nym_id&gt; ]&quot;</span> );
<a name="l00324"></a>00324     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --depositcheque  [--myacct &lt;acct_id&gt;]   (Deposit a cheque.)&quot;</span> );
<a name="l00325"></a>00325     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --depositpurse   [--myacct &lt;acct_id&gt;]   (Deposit a cash purse.)&quot;</span> );
<a name="l00326"></a>00326     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --deposittokens  [--myacct &lt;acct_id&gt;]   (Deposit individual cash tokens.)&quot;</span> );
<a name="l00327"></a>00327     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --inbox    | -i  [--myacct &lt;acct_id&gt;]   (Display the inbox.)&quot;</span> );
<a name="l00328"></a>00328     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --sign     | -s  [--mynym  &lt;nym_id&gt; ]   (Sign a contract.)&quot;</span> );
<a name="l00329"></a>00329     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --verify         [--mynym  &lt;nym_id&gt; ]   (Verify a signature.)&quot;</span> );
<a name="l00330"></a>00330     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --purse    | -p   &lt;arguments&gt;           (Display a purse.)&quot;</span>);
<a name="l00331"></a>00331     opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments:     [--mynym  &lt;nym_id&gt; ] [--mypurse &lt;asset_type_id&gt;]&quot;</span> );
<a name="l00332"></a>00332     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --refresh  | -r  [--myacct &lt;acct_id&gt;]    (Download account files from server.)&quot;</span>);
<a name="l00333"></a>00333     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --refreshnym     [--mynym  &lt;nym_id&gt; ]    (Download nym files from server.)&quot;</span>);
<a name="l00334"></a>00334     opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --marketoffer    [--mynym  &lt;nym_id&gt; ]    (Place an offer on a market.)&quot;</span> );
<a name="l00335"></a>00335     opt-&gt;addUsage( <span class="stringliteral">&quot;Also, [--server &lt;server_id&gt;] will work with all of the above.&quot;</span> );
<a name="l00336"></a>00336     opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
<a name="l00337"></a>00337     opt-&gt;addUsage( <span class="stringliteral">&quot;Recurring payments:&quot;</span> );
<a name="l00338"></a>00338     opt-&gt;addUsage( <span class="stringliteral">&quot;ot --proposeplan  &lt;arguments&gt;   (Merchant)&quot;</span> );
<a name="l00339"></a>00339     opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments: [--mynym  &lt;nym_id&gt; ] [--myacct  &lt;acct_id&gt;]  (continued.)&quot;</span> );
<a name="l00340"></a>00340     opt-&gt;addUsage( <span class="stringliteral">&quot;  Continued: [--hisnym &lt;nym_id&gt; ] [--hisacct &lt;acct_id&gt; ]&quot;</span>);
<a name="l00341"></a>00341     opt-&gt;addUsage( <span class="stringliteral">&quot;ot --confirmplan  &lt;arguments&gt;   (Customer)&quot;</span> );
<a name="l00342"></a>00342     opt-&gt;addUsage( <span class="stringliteral">&quot;ot --activateplan &lt;arguments&gt;   (Customer again)&quot;</span> );
<a name="l00343"></a>00343     opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments: [--mynym  &lt;nym_id&gt; ] [--myacct  &lt;acct_id&gt;]&quot;</span> );
<a name="l00344"></a>00344     opt-&gt;addUsage( <span class="stringliteral">&quot; **** NOTE: DO NOT USE &#39;ot&#39; !! Use &#39;opentxs help&#39; instead! ***&quot;</span> );
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="comment">// -----------------------------------------------------</span>
<a name="l00347"></a>00347     <span class="comment">/* 4. SET THE OPTION STRINGS/CHARACTERS */</span>
<a name="l00348"></a>00348     <span class="comment">//</span>
<a name="l00349"></a>00349     <span class="comment">// COMMAND LINE *AND* RESOURCE FILE</span>
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">//  opt-&gt;setOption(  &quot;server&quot; );      /* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">// -----------------------------------------------------</span>
<a name="l00354"></a>00354     <span class="comment">/* 4. SET THE OPTION STRINGS/CHARACTERS */</span>
<a name="l00355"></a>00355     <span class="comment">//</span>
<a name="l00356"></a>00356     <span class="comment">// COMMAND LINE *AND* RESOURCE FILE</span>
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">//  opt-&gt;setOption(  &quot;server&quot; );      /* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="comment">// -----------------------------------------------------</span>
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="comment">// COMMAND LINE ONLY</span>
<a name="l00363"></a>00363     <span class="comment">/* for options that will be checked only on the command and line not in option/resource file */</span>
<a name="l00364"></a>00364     <span class="comment">//    opt-&gt;setCommandFlag(  &quot;zip&quot; , &#39;z&#39;); /* a flag (takes no argument), supporting int64_t and short form */</span>
<a name="l00365"></a>00365     opt-&gt;setCommandOption(<span class="stringliteral">&quot;withdraw&quot;</span> , <span class="charliteral">&#39;w&#39;</span>);   <span class="comment">// withdraw from acct to purse, myacct, topurse</span>
<a name="l00366"></a>00366     opt-&gt;setCommandOption(<span class="stringliteral">&quot;transfer&quot;</span> , <span class="charliteral">&#39;t&#39;</span>);   <span class="comment">// transfer acct-to-acct, myacct, toacct</span>
<a name="l00367"></a>00367     opt-&gt;setCommandOption(<span class="stringliteral">&quot;cheque&quot;</span> ,   <span class="charliteral">&#39;c&#39;</span>);   <span class="comment">// write a cheque   myacct, tonym</span>
<a name="l00368"></a>00368     opt-&gt;setCommandOption(<span class="stringliteral">&quot;voucher&quot;</span> ,  <span class="charliteral">&#39;v&#39;</span>);   <span class="comment">// withdraw voucher myacct, tonym</span>
<a name="l00369"></a>00369     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;marketoffer&quot;</span>   );   <span class="comment">// add an offer to the market.</span>
<a name="l00370"></a>00370     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;balance&quot;</span> ,  <span class="charliteral">&#39;b&#39;</span>);   <span class="comment">// Display account balance</span>
<a name="l00371"></a>00371     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;depositcheque&quot;</span> );   <span class="comment">// deposit a cheque to myacct</span>
<a name="l00372"></a>00372     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;depositpurse&quot;</span>  );   <span class="comment">// deposit cash purse to myacct</span>
<a name="l00373"></a>00373     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;deposittokens&quot;</span> );   <span class="comment">// deposit individual cash tokens to myacct</span>
<a name="l00374"></a>00374     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;proposeplan&quot;</span>   );   <span class="comment">// Merchant proposes a payment plan.</span>
<a name="l00375"></a>00375     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;confirmplan&quot;</span>   );   <span class="comment">// Customer confirms a payment plan.</span>
<a name="l00376"></a>00376     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;activateplan&quot;</span>  );   <span class="comment">// Customer activates a payment plan.</span>
<a name="l00377"></a>00377     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;inbox&quot;</span> ,    <span class="charliteral">&#39;i&#39;</span>);   <span class="comment">// displays inbox (for ACCT_ID...)</span>
<a name="l00378"></a>00378     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;sign&quot;</span> ,     <span class="charliteral">&#39;s&#39;</span>);   <span class="comment">// sign a contract  mynym</span>
<a name="l00379"></a>00379     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;verify&quot;</span>        );   <span class="comment">// verify a signature</span>
<a name="l00380"></a>00380     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;purse&quot;</span> ,    <span class="charliteral">&#39;p&#39;</span>);   <span class="comment">// display purse contents.</span>
<a name="l00381"></a>00381     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;refresh&quot;</span> ,  <span class="charliteral">&#39;r&#39;</span>);   <span class="comment">// refresh intermediary files from server + verify against last receipt.</span>
<a name="l00382"></a>00382     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;refreshnym&quot;</span>    );   <span class="comment">// refresh intermediary files from server + verify against last receipt.</span>
<a name="l00383"></a>00383     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;stat&quot;</span> );            <span class="comment">// print out the wallet contents.</span>
<a name="l00384"></a>00384     opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;prompt&quot;</span> );          <span class="comment">// Enter the OT prompt.</span>
<a name="l00385"></a>00385     opt-&gt;setCommandOption(<span class="stringliteral">&quot;script&quot;</span> );          <span class="comment">// Process a script from out of a scriptfile</span>
<a name="l00386"></a>00386     opt-&gt;setCommandOption(<span class="stringliteral">&quot;args&quot;</span>);             <span class="comment">// Pass custom arguments from command line: --args &quot;key1 value1 key2 \&quot;here is value2\&quot; key3 value3&quot;</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     opt-&gt;setCommandFlag(<span class="stringliteral">&quot;help&quot;</span>, <span class="charliteral">&#39;h&#39;</span>);   <span class="comment">// the Help screen.</span>
<a name="l00389"></a>00389     opt-&gt;setCommandFlag(<span class="charliteral">&#39;?&#39;</span>);           <span class="comment">// the Help screen.</span>
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">/*</span>
<a name="l00392"></a>00392 <span class="comment">    --myacct   (ACCT ID)</span>
<a name="l00393"></a>00393 <span class="comment">    --mynym    (NYM ID)</span>
<a name="l00394"></a>00394 <span class="comment">    --mypurse  (ASSET TYPE ID)</span>
<a name="l00395"></a>00395 <span class="comment"></span>
<a name="l00396"></a>00396 <span class="comment">    --toacct   (ACCT ID)</span>
<a name="l00397"></a>00397 <span class="comment">    --tonym    (NYM ID)</span>
<a name="l00398"></a>00398 <span class="comment">    --topurse  (ASSET TYPE ID)</span>
<a name="l00399"></a>00399 <span class="comment">    */</span>
<a name="l00400"></a>00400     opt-&gt;setCommandOption(<span class="stringliteral">&quot;server&quot;</span>);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     opt-&gt;setCommandOption(<span class="stringliteral">&quot;myacct&quot;</span>);
<a name="l00403"></a>00403     opt-&gt;setCommandOption(<span class="stringliteral">&quot;mynym&quot;</span>);
<a name="l00404"></a>00404     opt-&gt;setCommandOption(<span class="stringliteral">&quot;mypurse&quot;</span>);
<a name="l00405"></a>00405     opt-&gt;setCommandOption(<span class="stringliteral">&quot;hisacct&quot;</span>);
<a name="l00406"></a>00406     opt-&gt;setCommandOption(<span class="stringliteral">&quot;hisnym&quot;</span>);
<a name="l00407"></a>00407     opt-&gt;setCommandOption(<span class="stringliteral">&quot;hispurse&quot;</span>);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">// NOTE: Above and Below me are IDs. This interface should allow PARTIAL IDs.</span>
<a name="l00410"></a>00410     <span class="comment">// -----------------------------------------------------</span>
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="comment">// RESOURCE FILE ONLY</span>
<a name="l00413"></a>00413     <span class="comment">/* for options that will be checked only from the option/resource file */</span>
<a name="l00414"></a>00414     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultserver&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmyacct&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00417"></a>00417     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmynym&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00418"></a>00418     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmypurse&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00419"></a>00419     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthisacct&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00420"></a>00420     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthisnym&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00421"></a>00421     opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthispurse&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
<a name="l00422"></a>00422     <span class="comment">/*</span>
<a name="l00423"></a>00423 <span class="comment">    --defaultmyacct   (ACCT ID)</span>
<a name="l00424"></a>00424 <span class="comment">    --defaultmynym    (NYM ID)</span>
<a name="l00425"></a>00425 <span class="comment">    --defaultmypurse  (ASSET TYPE ID)</span>
<a name="l00426"></a>00426 <span class="comment"></span>
<a name="l00427"></a>00427 <span class="comment">    --defaulttoacct   (ACCT ID)</span>
<a name="l00428"></a>00428 <span class="comment">    --defaulttonym    (NYM ID)</span>
<a name="l00429"></a>00429 <span class="comment">    --defaulttopurse  (ASSET TYPE ID)</span>
<a name="l00430"></a>00430 <span class="comment">    */</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="comment">// -----------------------------------------------------</span>
<a name="l00433"></a>00433     <span class="comment">/* 5. PROCESS THE COMMANDLINE AND RESOURCE FILE */</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="comment">/* read options from a option/resource file with &#39;:&#39; separated options or flags, one per line */</span>
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <a class="code" href="class_o_t_string.html">OTString</a> strOptionsFile(<a class="code" href="otd_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>), strIniFileExact;
<a name="l00438"></a>00438     { <span class="keywordtype">bool</span> bBuildFullPathSuccess = <a class="code" href="class_o_t_paths.html#a73f191305215a5a10158a927b01f53da">OTPaths::RelativeToCanonical</a>(strIniFileExact,strConfigPath,strOptionsFile);
<a name="l00439"></a>00439     <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bBuildFullPathSuccess,<span class="stringliteral">&quot;Unalbe to set Full Path&quot;</span>); }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">// -----------------------------------------------------</span>
<a name="l00442"></a>00442     opt-&gt;processFile( strIniFileExact.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() );
<a name="l00443"></a>00443     <span class="comment">// -----------------------------------------------------</span>
<a name="l00444"></a>00444     opt-&gt;processCommandArgs( argc, argv );
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="comment">/*</span>
<a name="l00450"></a>00450 <span class="comment">I&#39;m starting to need this in possibly multiple places below, so I</span>
<a name="l00451"></a>00451 <span class="comment">made a function to avoid duplicating code. These are values such</span>
<a name="l00452"></a>00452 <span class="comment">as &quot;my account ID&quot; and &quot;his NymID&quot; that are provided on the command</span>
<a name="l00453"></a>00453 <span class="comment">line, and which also can be defaulted in a config file in ~/.ot</span>
<a name="l00454"></a>00454 <span class="comment">*/</span>
<a name="l00455"></a><a class="code" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">00455</a> <span class="keywordtype">void</span> <a class="code" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">CollectDefaultedCLValues</a>(AnyOption *opt,
<a name="l00456"></a>00456     std::string &amp; str_ServerID,
<a name="l00457"></a>00457     std::string &amp; str_MyAcct,
<a name="l00458"></a>00458     std::string &amp; str_MyNym,
<a name="l00459"></a>00459     std::string &amp; str_MyPurse,
<a name="l00460"></a>00460     std::string &amp; str_HisAcct,
<a name="l00461"></a>00461     std::string &amp; str_HisNym,
<a name="l00462"></a>00462     std::string &amp; str_HisPurse)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != opt);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <span class="comment">// First we pre-set all the values based on the defaults from the options file.</span>
<a name="l00469"></a>00469     <span class="comment">//</span>
<a name="l00470"></a>00470     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultserver&quot;</span> ) != NULL )
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472 <span class="comment">//      cerr &lt;&lt; &quot;Server default: &quot; &lt;&lt; (str_ServerID = opt-&gt;getValue( &quot;defaultserver&quot; )) &lt;&lt; endl;</span>
<a name="l00473"></a>00473         str_ServerID = opt-&gt;getValue( <span class="stringliteral">&quot;defaultserver&quot;</span> );
<a name="l00474"></a>00474         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Server default: %s \n&quot;</span>, str_ServerID.c_str());
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmyacct&quot;</span> ) != NULL )
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479 <span class="comment">//      cerr &lt;&lt; &quot;MyAcct default: &quot; &lt;&lt; (str_MyAcct = opt-&gt;getValue( &quot;defaultmyacct&quot; )) &lt;&lt; endl;</span>
<a name="l00480"></a>00480         str_MyAcct = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmyacct&quot;</span> );
<a name="l00481"></a>00481         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyAcct default: %s \n&quot;</span>, str_MyAcct.c_str());
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmynym&quot;</span> ) != NULL )
<a name="l00484"></a>00484     {
<a name="l00485"></a>00485 <span class="comment">//      cerr &lt;&lt; &quot;MyNym default: &quot; &lt;&lt; (str_MyNym = opt-&gt;getValue( &quot;defaultmynym&quot; )) &lt;&lt; endl;</span>
<a name="l00486"></a>00486         str_MyNym = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmynym&quot;</span> );
<a name="l00487"></a>00487         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyNym default: %s \n&quot;</span>, str_MyNym.c_str());
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmypurse&quot;</span> ) != NULL )
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491 <span class="comment">//      cerr &lt;&lt; &quot;MyPurse default: &quot; &lt;&lt; (str_MyPurse = opt-&gt;getValue( &quot;defaultmypurse&quot; )) &lt;&lt; endl;</span>
<a name="l00492"></a>00492         str_MyPurse = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmypurse&quot;</span> );
<a name="l00493"></a>00493         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyPurse default: %s \n&quot;</span>, str_MyPurse.c_str());
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisacct&quot;</span> ) != NULL )
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498 <span class="comment">//      cerr &lt;&lt; &quot;HisAcct default: &quot; &lt;&lt; (str_HisAcct = opt-&gt;getValue( &quot;defaulthisacct&quot; )) &lt;&lt; endl;</span>
<a name="l00499"></a>00499         str_HisAcct = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisacct&quot;</span> );
<a name="l00500"></a>00500         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisAcct default: %s \n&quot;</span>, str_HisAcct.c_str());
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisnym&quot;</span> ) != NULL )
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504 <span class="comment">//      cerr &lt;&lt; &quot;HisNym default: &quot; &lt;&lt; (str_HisNym = opt-&gt;getValue( &quot;defaulthisnym&quot; )) &lt;&lt; endl;</span>
<a name="l00505"></a>00505         str_HisNym = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisnym&quot;</span> );
<a name="l00506"></a>00506         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisNym default: %s \n&quot;</span>, str_HisNym.c_str());
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthispurse&quot;</span> ) != NULL )
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510 <span class="comment">//      cerr &lt;&lt; &quot;HisPurse default: &quot; &lt;&lt; (str_HisPurse = opt-&gt;getValue( &quot;defaulthispurse&quot; )) &lt;&lt; endl;</span>
<a name="l00511"></a>00511         str_HisPurse = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthispurse&quot;</span> );
<a name="l00512"></a>00512         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisPurse default: %s \n&quot;</span>, str_HisPurse.c_str());
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">// --------------</span>
<a name="l00516"></a>00516     <span class="comment">// Next, we overwrite those with any that were passed in on the command line.</span>
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;server&quot;</span> ) != NULL )
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520 <span class="comment">//      cerr &lt;&lt; &quot;Server from command-line: &quot; &lt;&lt; (str_ServerID = opt-&gt;getValue( &quot;server&quot; )) &lt;&lt; endl;</span>
<a name="l00521"></a>00521         str_ServerID = opt-&gt;getValue( <span class="stringliteral">&quot;server&quot;</span> );
<a name="l00522"></a>00522         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Server from command-line: %s \n&quot;</span>, str_ServerID.c_str());
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;myacct&quot;</span> ) != NULL )
<a name="l00526"></a>00526     {
<a name="l00527"></a>00527 <span class="comment">//      cerr &lt;&lt; &quot;MyAcct from command-line: &quot; &lt;&lt; (str_MyAcct = opt-&gt;getValue( &quot;myacct&quot; )) &lt;&lt; endl;</span>
<a name="l00528"></a>00528         str_MyAcct = opt-&gt;getValue( <span class="stringliteral">&quot;myacct&quot;</span> );
<a name="l00529"></a>00529         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyAcct from command-line: %s \n&quot;</span>, str_MyAcct.c_str());
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;mynym&quot;</span> ) != NULL )
<a name="l00532"></a>00532     {
<a name="l00533"></a>00533 <span class="comment">//      cerr &lt;&lt; &quot;MyNym from command-line: &quot; &lt;&lt; (str_MyNym = opt-&gt;getValue( &quot;mynym&quot; )) &lt;&lt; endl;</span>
<a name="l00534"></a>00534         str_MyNym = opt-&gt;getValue( <span class="stringliteral">&quot;mynym&quot;</span> );
<a name="l00535"></a>00535         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyNym from command-line: %s \n&quot;</span>, str_MyNym.c_str());
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;mypurse&quot;</span> ) != NULL )
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539 <span class="comment">//      cerr &lt;&lt; &quot;MyPurse from command-line: &quot; &lt;&lt; (str_MyPurse = opt-&gt;getValue( &quot;mypurse&quot; )) &lt;&lt; endl;</span>
<a name="l00540"></a>00540         str_MyPurse = opt-&gt;getValue( <span class="stringliteral">&quot;mypurse&quot;</span> );
<a name="l00541"></a>00541         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyPurse from command-line: %s \n&quot;</span>, str_MyPurse.c_str());
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hisacct&quot;</span> ) != NULL )
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546 <span class="comment">//      cerr &lt;&lt; &quot;HisAcct from command-line: &quot; &lt;&lt; (str_HisAcct = opt-&gt;getValue( &quot;hisacct&quot; )) &lt;&lt; endl;</span>
<a name="l00547"></a>00547         str_HisAcct = opt-&gt;getValue( <span class="stringliteral">&quot;hisacct&quot;</span> );
<a name="l00548"></a>00548         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisAcct from command-line: %s \n&quot;</span>, str_HisAcct.c_str());
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hisnym&quot;</span> ) != NULL )
<a name="l00551"></a>00551     {
<a name="l00552"></a>00552 <span class="comment">//      cerr &lt;&lt; &quot;HisNym from command-line: &quot; &lt;&lt; (str_HisNym = opt-&gt;getValue( &quot;hisnym&quot; )) &lt;&lt; endl;</span>
<a name="l00553"></a>00553         str_HisNym = opt-&gt;getValue( <span class="stringliteral">&quot;hisnym&quot;</span> );
<a name="l00554"></a>00554         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisNym from command-line: %s \n&quot;</span>, str_HisNym.c_str());
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hispurse&quot;</span> ) != NULL )
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558 <span class="comment">//      cerr &lt;&lt; &quot;HisPurse from command-line: &quot; &lt;&lt; (str_HisPurse = opt-&gt;getValue( &quot;hispurse&quot; )) &lt;&lt; endl;</span>
<a name="l00559"></a>00559         str_HisPurse = opt-&gt;getValue( <span class="stringliteral">&quot;hispurse&quot;</span> );
<a name="l00560"></a>00560         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisPurse from command-line: %s \n&quot;</span>, str_HisPurse.c_str());
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="comment">// *************************************   MAIN FUNCTION   *************************************</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="keyword">using</span> std::cerr;
<a name="l00568"></a>00568 <span class="keyword">using</span> std::endl;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 
<a name="l00571"></a><a class="code" href="otd_2main_8cpp.html#abbc50c23c5192bfa8579c0c06a87fcd9">00571</a> int32_t <a class="code" href="xmlrpcxx__server_8cpp.html#abbc50c23c5192bfa8579c0c06a87fcd9">main</a>(int32_t argc, <span class="keywordtype">char</span>* argv[])
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573     <span class="comment">// --------------------------------------------</span>
<a name="l00574"></a>00574     <span class="keyword">class </span>__OTclient_RAII
<a name="l00575"></a>00575     {
<a name="l00576"></a>00576     <span class="keyword">public</span>:
<a name="l00577"></a>00577         __OTclient_RAII()
<a name="l00578"></a>00578         {
<a name="l00579"></a>00579             <span class="comment">// OT_API class exists only on the client side.</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581             <a class="code" href="class_o_t_a_p_i___wrap.html#a8be8d3b92ff715548929dfecc1919801">OTAPI_Wrap::AppInit</a>();     <span class="comment">// SSL gets initialized in here, before any keys are loaded.</span>
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583         ~__OTclient_RAII()
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585             <a class="code" href="class_o_t_a_p_i___wrap.html#a3fc341c4f43727c1b195d8d86e47e9db">OTAPI_Wrap::AppCleanup</a>();
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587     };
<a name="l00588"></a>00588     <span class="comment">// --------------------------------------------</span>
<a name="l00589"></a>00589     <span class="comment">//</span>
<a name="l00590"></a>00590     <span class="comment">// This makes SURE that AppCleanup() gets called before main() exits (without any</span>
<a name="l00591"></a>00591     <span class="comment">// twisted logic being necessary below, for that to happen.)</span>
<a name="l00592"></a>00592     <span class="comment">//</span>
<a name="l00593"></a>00593     __OTclient_RAII   the_client_cleanup;
<a name="l00594"></a>00594     <span class="comment">// -------------------------------------------------------------------</span>
<a name="l00595"></a>00595     <span class="comment">//</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()) <span class="keywordflow">return</span> -1;  <span class="comment">// error out if we don&#39;t have the API.</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath(<a class="code" href="class_o_t_paths.html#a6634797ea86b0da2d66a816e604b538b">OTPaths::AppDataFolder</a>());
<a name="l00600"></a>00600     <span class="keywordtype">bool</span> bConfigPathFound = strConfigPath.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; 3 &lt; strConfigPath.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>();
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bConfigPathFound,<span class="stringliteral">&quot;RegisterAPIWithScript: Must set Config Path first!\n&quot;</span>);
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Using configuration path:  %s\n&quot;</span>, strConfigPath.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="comment">//    OTLog::vOutput(0, &quot;Prefix Path:  %s\n&quot;, OTPaths::PrefixFolder().Get());</span>
<a name="l00607"></a>00607 <span class="comment">//    OTLog::vOutput(0, &quot;Scripts Path:  %s\n&quot;, OTPaths::ScriptsFolder().Get());</span>
<a name="l00608"></a>00608 <span class="comment">//</span>
<a name="l00609"></a>00609 <span class="comment">//    OTString out_strHomeFolder;</span>
<a name="l00610"></a>00610 <span class="comment">//    OTPaths::GetHomeFromSystem(out_strHomeFolder);</span>
<a name="l00611"></a>00611 <span class="comment">//    OTLog::vOutput(0, &quot;Home from System:  %s\n&quot;, out_strHomeFolder.Get());</span>
<a name="l00612"></a>00612     <span class="comment">// -------------------------------------------------------------------</span>
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">// COMMAND-LINE OPTIONS (and default values from files.)</span>
<a name="l00615"></a>00615     <span class="comment">//</span>
<a name="l00616"></a>00616     AnyOption *opt = <span class="keyword">new</span> AnyOption();
<a name="l00617"></a>00617     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != opt);
<a name="l00618"></a>00618     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;AnyOption&gt;</a> theOptionAngel(opt);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="comment">// Process the command line args</span>
<a name="l00621"></a>00621     <span class="comment">//</span>
<a name="l00622"></a>00622     <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>( argc, argv, opt);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">// command line values such as account ID, Nym ID, etc.</span>
<a name="l00626"></a>00626     <span class="comment">// Also available as defaults in a config file in the ~/.ot folder</span>
<a name="l00627"></a>00627     <span class="comment">//</span>
<a name="l00628"></a>00628     std::string str_ServerID;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     std::string str_MyAcct;
<a name="l00631"></a>00631     std::string str_MyNym;
<a name="l00632"></a>00632     std::string str_MyPurse;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     std::string str_HisAcct;
<a name="l00635"></a>00635     std::string str_HisNym;
<a name="l00636"></a>00636     std::string str_HisPurse;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <a class="code" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">CollectDefaultedCLValues</a>(opt,
<a name="l00639"></a>00639         str_ServerID,
<a name="l00640"></a>00640         str_MyAcct,
<a name="l00641"></a>00641         str_MyNym,
<a name="l00642"></a>00642         str_MyPurse,
<a name="l00643"></a>00643         str_HisAcct,
<a name="l00644"></a>00644         str_HisNym,
<a name="l00645"></a>00645         str_HisPurse);
<a name="l00646"></a>00646     <span class="comment">// -----------------------------------------------------</span>
<a name="l00647"></a>00647     <span class="comment">// Users can put --args &quot;key value key value key value etc&quot;</span>
<a name="l00648"></a>00648     <span class="comment">// Then they can access those values from within their scripts.</span>
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     std::string str_Args;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;args&quot;</span> ) != NULL )
<a name="l00653"></a>00653         cerr &lt;&lt; <span class="stringliteral">&quot;User-defined arguments aka:  --args &quot;</span> &lt;&lt; (str_Args = opt-&gt;getValue( <span class="stringliteral">&quot;args&quot;</span> )) &lt;&lt; endl;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="comment">// -----------------------------------------------------</span>
<a name="l00656"></a>00656     <span class="comment">/*  USAGE SCREEN (HELP) */</span>
<a name="l00657"></a>00657     <span class="comment">//</span>
<a name="l00658"></a>00658     <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;help&quot;</span> ) || opt-&gt;getFlag( <span class="charliteral">&#39;h&#39;</span> )  || opt-&gt;getFlag( <span class="charliteral">&#39;?&#39;</span> ) )
<a name="l00659"></a>00659     {
<a name="l00660"></a>00660         opt-&gt;printUsage();
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         <span class="keywordflow">return</span> 0;
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     <span class="comment">// -----------------------------------------------------</span>
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="keywordtype">bool</span> bIsCommandProvided = <span class="keyword">false</span>;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <span class="comment">// See if there&#39;s a COMMAND chosen at command line.</span>
<a name="l00669"></a>00669     <span class="comment">//</span>
<a name="l00670"></a>00670     <span class="keywordflow">if</span> ( opt -&gt;hasOptions())
<a name="l00671"></a>00671     {
<a name="l00672"></a>00672         <span class="comment">// Below are COMMANDS (only one of them can be true...)</span>
<a name="l00673"></a>00673         <span class="comment">//</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;withdraw&quot;</span> ) != NULL  )
<a name="l00676"></a>00676         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;withdraw amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) &lt;&lt; endl ; }
<a name="l00677"></a>00677         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;transfer&quot;</span> ) != NULL  )
<a name="l00678"></a>00678         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;transfer amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) &lt;&lt; endl ; }
<a name="l00679"></a>00679         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;cheque&quot;</span> ) != NULL  )
<a name="l00680"></a>00680         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;cheque amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) &lt;&lt; endl ; }
<a name="l00681"></a>00681         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(  opt-&gt;getFlag( <span class="stringliteral">&quot;marketoffer&quot;</span> ) == true  )
<a name="l00682"></a>00682         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;marketoffer flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00683"></a>00683         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;voucher&quot;</span> ) != NULL  )
<a name="l00684"></a>00684         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;voucher amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) &lt;&lt; endl ; }
<a name="l00685"></a>00685         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;depositcheque&quot;</span> ) )
<a name="l00686"></a>00686         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit cheque flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00687"></a>00687         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;depositpurse&quot;</span> ) )
<a name="l00688"></a>00688         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit purse flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00689"></a>00689         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;deposittokens&quot;</span> ) )
<a name="l00690"></a>00690         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit tokens flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00691"></a>00691         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;proposepaymentplan&quot;</span> ) )
<a name="l00692"></a>00692         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;proposepaymentplan flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00693"></a>00693         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;confirmpaymentplan&quot;</span> ) )
<a name="l00694"></a>00694         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;confirm payment plan flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00695"></a>00695         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;activatepaymentplan&quot;</span> ) )
<a name="l00696"></a>00696         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;activate payment plan flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00697"></a>00697         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;b&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;balance&quot;</span> )  )
<a name="l00698"></a>00698         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;balance flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00699"></a>00699         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;i&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;inbox&quot;</span> )  )
<a name="l00700"></a>00700         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;inbox flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00701"></a>00701         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;p&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;purse&quot;</span> )  )
<a name="l00702"></a>00702         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;purse flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00703"></a>00703         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;s&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;sign&quot;</span> ))
<a name="l00704"></a>00704         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;sign flag set &quot;</span> &lt;&lt; endl ; }
<a name="l00705"></a>00705         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;verify&quot;</span> )  )
<a name="l00706"></a>00706         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;verify flag set &quot;</span> &lt;&lt; endl; }
<a name="l00707"></a>00707         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;stat&quot;</span> )   )
<a name="l00708"></a>00708         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;stat flag set &quot;</span>  &lt;&lt; endl ; }
<a name="l00709"></a>00709         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> )   )
<a name="l00710"></a>00710         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;prompt flag set &quot;</span>  &lt;&lt; endl ; }
<a name="l00711"></a>00711         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> )  != NULL )
<a name="l00712"></a>00712         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;script filename: &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ) &lt;&lt; endl ; }
<a name="l00713"></a>00713         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;r&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;refresh&quot;</span> )   )
<a name="l00714"></a>00714         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;refresh flag set &quot;</span>  &lt;&lt; endl ; }
<a name="l00715"></a>00715         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;refreshnym&quot;</span> )   )
<a name="l00716"></a>00716         { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;refreshnym flag set &quot;</span>  &lt;&lt; endl ; }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718         cerr &lt;&lt; endl ;
<a name="l00719"></a>00719     }
<a name="l00720"></a>00720     <span class="keywordflow">else</span>
<a name="l00721"></a>00721         bIsCommandProvided = <span class="keyword">false</span>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="comment">// ---------------------------------------------------------------------------------------</span>
<a name="l00724"></a>00724     <span class="comment">//</span>
<a name="l00725"></a>00725     <span class="keywordflow">if</span>(!(opt-&gt;getArgc() &gt; 0) &amp;&amp;
<a name="l00726"></a>00726         (<span class="keyword">false</span> == bIsCommandProvided) )   <span class="comment">// If no command was provided (though other command-line options may have been...)</span>
<a name="l00727"></a>00727     {                           <span class="comment">// then we expect a script to come in through stdin, and we run it through the script interpreter!</span>
<a name="l00728"></a>00728         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n\nYou probably don&#39;t want to do this... Use CTRL-C, and try \&quot;ot --help\&quot; for instructions.\n\n &quot;</span>
<a name="l00729"></a>00729             <span class="stringliteral">&quot;==&gt; Expecting ot script from standard input. (Terminate with CTRL-D):\n\n&quot;</span>);
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         <span class="comment">// ----------------------------------------</span>
<a name="l00732"></a>00732         <span class="comment">// don&#39;t skip the whitespace while reading</span>
<a name="l00733"></a>00733         std::cin &gt;&gt; std::noskipws;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735         <span class="comment">// use stream iterators to copy the stream to a string</span>
<a name="l00736"></a>00736         std::istream_iterator&lt;char&gt; it(std::cin);
<a name="l00737"></a>00737         std::istream_iterator&lt;char&gt; end;
<a name="l00738"></a>00738         std::string results(it, end);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740         <span class="comment">// -----------------------------------------------</span>
<a name="l00741"></a>00741         <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;
<a name="l00742"></a>00742         madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();
<a name="l00743"></a>00743         madeEasy.<a class="code" href="class_o_t___m_e.html#abd1a0c946ffba242d38fc909937a4145">ExecuteScript_ReturnVoid</a>(results, (<span class="stringliteral">&quot;stdin&quot;</span>));
<a name="l00744"></a>00744         <span class="comment">// --------------------------------------------------------------------</span>
<a name="l00745"></a>00745 
<a name="l00746"></a>00746         <span class="keywordflow">return</span> 0;
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <span class="comment">// Otherwise a command WAS provided at the command line, so we execute a single time, once just for that command.</span>
<a name="l00750"></a>00750     {
<a name="l00751"></a>00751         <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = NULL;
<a name="l00752"></a>00752         <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServerContract = NULL;
<a name="l00753"></a>00753         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMyNym = NULL;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755         <span class="comment">// This does LoadWallet, andif Nym or Server IDs were provided, loads those up as well.</span>
<a name="l00756"></a>00756         <span class="comment">// (They may still be NULL after this call, however.)</span>
<a name="l00757"></a>00757         <span class="comment">//</span>
<a name="l00758"></a>00758         <span class="keywordtype">bool</span> bMainPointersSetupSuccessful =
<a name="l00759"></a>00759             <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym, pMyNym, pWallet, pServerContract);
<a name="l00760"></a>00760 
<a name="l00761"></a>00761         <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bMainPointersSetupSuccessful,<span class="stringliteral">&quot;main: SetupPointersForWalletMyNymAndServerContract failed to return true&quot;</span>);
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         <span class="comment">// Below this point, pWallet is available :-)</span>
<a name="l00764"></a>00764         <span class="comment">// -----------------------------------------------------</span>
<a name="l00765"></a>00765         <span class="comment">// Later I can split the below commands into &quot;those that need a server contract&quot;</span>
<a name="l00766"></a>00766         <span class="comment">// and &quot;those that don&#39;t need a server contract&quot;, and put this code between them.</span>
<a name="l00767"></a>00767         <span class="comment">// That&#39;s what the OT Prompt loop does. For now I&#39;m making things easy here by just</span>
<a name="l00768"></a>00768         <span class="comment">// making it a blanket requirement.</span>
<a name="l00769"></a>00769         <span class="comment">//</span>
<a name="l00770"></a>00770         <span class="keywordflow">if</span> (NULL == pServerContract)
<a name="l00771"></a>00771         {
<a name="l00772"></a>00772             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract to use. Please use the option: --server SERVER_ID\n&quot;</span>
<a name="l00773"></a>00773                           <span class="stringliteral">&quot;(Where SERVER_ID is the Server&#39;s ID. Partial matches ARE accepted.)\n&quot;</span>);
<a name="l00774"></a>00774 <span class="comment">//          return 0;</span>
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID;
<a name="l00778"></a>00778         <a class="code" href="class_o_t_string.html">OTString</a>     strServerID;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780         <span class="keywordflow">if</span> (NULL != pServerContract)
<a name="l00781"></a>00781         {
<a name="l00782"></a>00782             pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(theServerID);
<a name="l00783"></a>00783             theServerID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strServerID);
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785         <span class="comment">// -----------------------------------------------------</span>
<a name="l00786"></a>00786 <span class="comment">//      int32_t       nServerPort = 0;</span>
<a name="l00787"></a>00787 <span class="comment">//      OTString  strServerHostname;</span>
<a name="l00788"></a>00788         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l00789"></a>00789         <span class="comment">// You can&#39;t just connect to any hostname and port.</span>
<a name="l00790"></a>00790         <span class="comment">// Instead, you give me the Server Contract, and *I&#39;ll* look up all that stuff FOR you...</span>
<a name="l00791"></a>00791         <span class="comment">// (We verify this up here, but use it at the bottom of the function once the message is set up.)</span>
<a name="l00792"></a>00792         <span class="comment">//</span>
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">//      if (false == pServerContract-&gt;GetConnectInfo(strServerHostname, nServerPort))</span>
<a name="l00795"></a>00795 <span class="comment">//      {</span>
<a name="l00796"></a>00796 <span class="comment">//          OTLog::vError(&quot;Failed retrieving connection info from server contract: %s\n&quot;,</span>
<a name="l00797"></a>00797 <span class="comment">//                        strServerID.Get());</span>
<a name="l00798"></a>00798 <span class="comment">//          return 0;</span>
<a name="l00799"></a>00799 <span class="comment">//      }</span>
<a name="l00800"></a>00800 
<a name="l00801"></a>00801         <span class="comment">// Below this point, pWallet and pServerContract are both available.</span>
<a name="l00802"></a>00802         <span class="comment">// UPDATE: Not necessarily... (pServerContract may be NULL...)</span>
<a name="l00803"></a>00803         <span class="comment">//</span>
<a name="l00804"></a>00804         <span class="comment">// ***********************************************************</span>
<a name="l00805"></a>00805 
<a name="l00806"></a>00806         <a class="code" href="class_o_t_account.html">OTAccount</a> * pMyAccount  = NULL;
<a name="l00807"></a>00807         <a class="code" href="class_o_t_account.html">OTAccount</a> * pHisAccount = NULL;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         <span class="keywordflow">if</span>( str_MyAcct.size() &gt; 0 )
<a name="l00810"></a>00810         {
<a name="l00811"></a>00811             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_ACCOUNT_ID(str_MyAcct.c_str());
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(MY_ACCOUNT_ID);
<a name="l00814"></a>00814 
<a name="l00815"></a>00815             <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00816"></a>00816             <span class="keywordflow">if</span> (NULL == pMyAccount)
<a name="l00817"></a>00817                 pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>( str_MyAcct );
<a name="l00818"></a>00818 
<a name="l00819"></a>00819             <span class="keywordflow">if</span> (NULL != pMyAccount)
<a name="l00820"></a>00820             {
<a name="l00821"></a>00821                 <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00822"></a>00822                 pMyAccount-&gt;GetPurportedAccountID().GetString(strTemp);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824                 str_MyAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00825"></a>00825                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as myacct: %s\n&quot;</span>, str_MyAcct.c_str());
<a name="l00826"></a>00826             }
<a name="l00827"></a>00827             <span class="keywordflow">else</span> <span class="comment">// Execution aborts if we cannot find MyAcct when one was provided.</span>
<a name="l00828"></a>00828             {
<a name="l00829"></a>00829                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Aborting: Unable to find specified myacct: %s\n&quot;</span>, str_MyAcct.c_str());
<a name="l00830"></a>00830                 <span class="keywordflow">return</span> 0;
<a name="l00831"></a>00831             }
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833         <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l00834"></a>00834         <span class="comment">// TODO: I wouldn&#39;t have HIS account in MY wallet -- I&#39;d only have his account ID.</span>
<a name="l00835"></a>00835         <span class="comment">// Therefore need to be able to retrieve this info from the ADDRESS BOOK (in order</span>
<a name="l00836"></a>00836         <span class="comment">// to be able to do PARTIAL MATCHES...)</span>
<a name="l00837"></a>00837         <span class="comment">//</span>
<a name="l00838"></a>00838         <span class="keywordflow">if</span> ( str_HisAcct.size() &gt; 0 )
<a name="l00839"></a>00839         {
<a name="l00840"></a>00840             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCOUNT_ID(str_HisAcct.c_str());
<a name="l00841"></a>00841 
<a name="l00842"></a>00842             pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(HIS_ACCOUNT_ID);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844             <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00845"></a>00845             <span class="keywordflow">if</span> (NULL == pHisAccount)
<a name="l00846"></a>00846                 pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>( str_HisAcct );
<a name="l00847"></a>00847             <span class="comment">// ------------------------------------------</span>
<a name="l00848"></a>00848             <span class="keywordflow">if</span> (NULL != pHisAccount)
<a name="l00849"></a>00849             {
<a name="l00850"></a>00850                 <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00851"></a>00851                 pHisAccount-&gt;GetPurportedAccountID().GetString(strTemp);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853                 str_HisAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00854"></a>00854                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisacct: %s\n&quot;</span>, str_HisAcct.c_str());
<a name="l00855"></a>00855             }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857             <span class="comment">// Execution continues, even if we fail to find his account.</span>
<a name="l00858"></a>00858             <span class="comment">// (Only my accounts will be in my wallet. Anyone else&#39;s account</span>
<a name="l00859"></a>00859             <span class="comment">// will exist on the server, even if it&#39;s not in my wallet. Therefore</span>
<a name="l00860"></a>00860             <span class="comment">// we still allow users to use HisAcctID since their server messages</span>
<a name="l00861"></a>00861             <span class="comment">// will usually actually work.)</span>
<a name="l00862"></a>00862             <span class="comment">//</span>
<a name="l00863"></a>00863             <span class="comment">// Again: Just because account lkjsf09234lkjafkljasd098q345lkjasdf doesn&#39;t</span>
<a name="l00864"></a>00864             <span class="comment">// appear in my wallet, doesn&#39;t mean the account doesn&#39;t exist on the server</span>
<a name="l00865"></a>00865             <span class="comment">// and in reality. Therefore I must assume, if I didn&#39;t find it by abbreviation,</span>
<a name="l00866"></a>00866             <span class="comment">// that it exists exactly as entered. The server message will just fail, if it</span>
<a name="l00867"></a>00867             <span class="comment">// doesn&#39;t exist. (But then that&#39;s the user&#39;s fault...)</span>
<a name="l00868"></a>00868             <span class="comment">//</span>
<a name="l00869"></a>00869             <span class="comment">// We can still keep account IDs in the address book, even if they aren&#39;t</span>
<a name="l00870"></a>00870             <span class="comment">// in the wallet (since they&#39;re owned by someone else...)</span>
<a name="l00871"></a>00871             <span class="comment">//</span>
<a name="l00872"></a>00872         }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874         <span class="comment">// ***********************************************************</span>
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         <span class="comment">// I put this here too since I think it&#39;s required in all cases.</span>
<a name="l00877"></a>00877         <span class="comment">// Update: commented out the return in order to allow for empty wallets.</span>
<a name="l00878"></a>00878         <span class="comment">//</span>
<a name="l00879"></a>00879         <span class="keywordflow">if</span> (NULL == pMyNym) <span class="comment">// Todo maybe move this check to the commands below (ONLY the ones that use a nym.)</span>
<a name="l00880"></a>00880         {
<a name="l00881"></a>00881             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
<a name="l00882"></a>00882                           <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches and names are accepted.)\n&quot;</span>);
<a name="l00883"></a>00883 <span class="comment">//          return 0;</span>
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_NYM_ID;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="keywordflow">if</span> (NULL != pMyNym)
<a name="l00889"></a>00889             pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(MY_NYM_ID);
<a name="l00890"></a>00890         <span class="comment">// -----------------------------------------------</span>
<a name="l00891"></a>00891         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pHisNym = NULL;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893         <span class="keywordflow">if</span> ( str_HisNym.size() &gt; 0 )
<a name="l00894"></a>00894         {
<a name="l00895"></a>00895             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID(str_HisNym.c_str());
<a name="l00896"></a>00896 
<a name="l00897"></a>00897             pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(HIS_NYM_ID);
<a name="l00898"></a>00898             <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00899"></a>00899             <span class="keywordflow">if</span> (NULL == pHisNym)
<a name="l00900"></a>00900                 pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>( str_HisNym );
<a name="l00901"></a>00901             <span class="comment">// ----------------------------</span>
<a name="l00902"></a>00902             <span class="keywordflow">if</span> (NULL != pHisNym)
<a name="l00903"></a>00903             {
<a name="l00904"></a>00904                 <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00905"></a>00905                 pHisNym-&gt;GetIdentifier(strTemp);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                 str_HisNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00908"></a>00908                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisnym: %s\n&quot;</span>, str_HisNym.c_str());
<a name="l00909"></a>00909             }
<a name="l00910"></a>00910         }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <span class="comment">// Below this point, if Nyms or Accounts were specified, they are now available.</span>
<a name="l00913"></a>00913         <span class="comment">// (Pointers might be null, though currently My Nym is required to be there.)</span>
<a name="l00914"></a>00914         <span class="comment">//</span>
<a name="l00915"></a>00915         <span class="comment">// Execution continues, even if we fail to find his nym.</span>
<a name="l00916"></a>00916         <span class="comment">// This is so the script has the opportunity to &quot;check nym&quot; (Download it)</span>
<a name="l00917"></a>00917         <span class="comment">// based on the ID that the user has entered here.</span>
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         <span class="comment">// ***********************************************************</span>
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> thePurseAssetTypeID;
<a name="l00922"></a>00922         <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pMyAssetContract = NULL;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <span class="keywordflow">if</span> ( str_MyPurse.size() &gt; 0 )
<a name="l00925"></a>00925         {
<a name="l00926"></a>00926             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_ASSET_TYPE_ID(str_MyPurse.c_str());
<a name="l00927"></a>00927             pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(MY_ASSET_TYPE_ID);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929             <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00930"></a>00930             <span class="keywordflow">if</span> (NULL == pMyAssetContract)
<a name="l00931"></a>00931                 pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>( str_MyPurse );
<a name="l00932"></a>00932 
<a name="l00933"></a>00933             <span class="comment">// ------------------------------------------</span>
<a name="l00934"></a>00934             <span class="keywordflow">if</span> (NULL != pMyAssetContract)
<a name="l00935"></a>00935             {
<a name="l00936"></a>00936                 <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00937"></a>00937                 pMyAssetContract-&gt;GetIdentifier(strTemp);
<a name="l00938"></a>00938 
<a name="l00939"></a>00939                 str_MyPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00940"></a>00940                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mypurse: %s\n&quot;</span>, str_MyPurse.c_str());
<a name="l00941"></a>00941                 <span class="comment">// ------------------------------------------</span>
<a name="l00942"></a>00942                 pMyAssetContract-&gt;GetIdentifier(thePurseAssetTypeID);
<a name="l00943"></a>00943             }
<a name="l00944"></a>00944             <span class="comment">// Execution continues here, so the script has the option to download</span>
<a name="l00945"></a>00945             <span class="comment">// any asset contract, if it can&#39;t find it in the wallet.</span>
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947         <span class="comment">// if no purse (asset type) ID was provided, but MyAccount WAS provided, then</span>
<a name="l00948"></a>00948         <span class="comment">// use the asset type for the account instead.</span>
<a name="l00949"></a>00949         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pMyAccount)
<a name="l00950"></a>00950             thePurseAssetTypeID = pMyAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
<a name="l00951"></a>00951         <span class="comment">// ------------------</span>
<a name="l00952"></a>00952         <span class="keywordflow">if</span> (!thePurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
<a name="l00953"></a>00953 
<a name="l00954"></a>00954         {
<a name="l00955"></a>00955             <a class="code" href="class_o_t_string.html">OTString</a> strTempAssetType(thePurseAssetTypeID);
<a name="l00956"></a>00956             str_MyPurse = strTempAssetType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00957"></a>00957         }
<a name="l00958"></a>00958         <span class="comment">// BELOW THIS POINT, pMyAssetContract MIGHT be NULL, or MIGHT be an asset type specified by the user.</span>
<a name="l00959"></a>00959         <span class="comment">// There&#39;s no guarantee that it&#39;s available, but if it IS, then it WILL be available below this point.</span>
<a name="l00960"></a>00960         <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00961"></a>00961         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> hisPurseAssetTypeID;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963         <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pHisAssetContract = NULL;
<a name="l00964"></a>00964 
<a name="l00965"></a>00965         <span class="keywordflow">if</span> ( str_HisPurse.size() &gt; 0 )
<a name="l00966"></a>00966         {
<a name="l00967"></a>00967             <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ASSET_TYPE_ID(str_HisPurse.c_str());
<a name="l00968"></a>00968             pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(HIS_ASSET_TYPE_ID);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970             <span class="comment">// If failure, then we try PARTIAL match.</span>
<a name="l00971"></a>00971             <span class="keywordflow">if</span> (NULL == pHisAssetContract)
<a name="l00972"></a>00972                 pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>( str_HisPurse );
<a name="l00973"></a>00973 
<a name="l00974"></a>00974             <span class="comment">// ------------------------------------------</span>
<a name="l00975"></a>00975             <span class="keywordflow">if</span> (NULL != pHisAssetContract)
<a name="l00976"></a>00976             {
<a name="l00977"></a>00977                 <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
<a name="l00978"></a>00978                 pHisAssetContract-&gt;GetIdentifier(strTemp);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980                 str_HisPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00981"></a>00981                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hispurse: %s\n&quot;</span>, str_HisPurse.c_str());
<a name="l00982"></a>00982                 <span class="comment">// ------------------------------------------</span>
<a name="l00983"></a>00983                 pHisAssetContract-&gt;GetIdentifier(hisPurseAssetTypeID);
<a name="l00984"></a>00984             }
<a name="l00985"></a>00985         }
<a name="l00986"></a>00986         <span class="comment">// If no &quot;HisPurse&quot; was provided, but HisAcct WAS, then we use the</span>
<a name="l00987"></a>00987         <span class="comment">// asset type of HisAcct as HisPurse.</span>
<a name="l00988"></a>00988         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pHisAccount)
<a name="l00989"></a>00989             hisPurseAssetTypeID = pHisAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
<a name="l00990"></a>00990         <span class="comment">// ------------------</span>
<a name="l00991"></a>00991         <span class="keywordflow">if</span> (!hisPurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
<a name="l00992"></a>00992 
<a name="l00993"></a>00993         {
<a name="l00994"></a>00994             <a class="code" href="class_o_t_string.html">OTString</a> strTempAssetType(hisPurseAssetTypeID);
<a name="l00995"></a>00995             str_HisPurse = strTempAssetType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00996"></a>00996         }
<a name="l00997"></a>00997         <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00998"></a>00998 
<a name="l00999"></a>00999         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01000"></a>01000 
<a name="l01001"></a>01001         <span class="comment">// Also, pAccount and pMyAssetContract have not be validated AGAINST EACH OTHER (yet)...</span>
<a name="l01002"></a>01002         <span class="comment">// Also, pHisAccount and pHisAssetContract have not be validated AGAINST EACH OTHER (yet)...</span>
<a name="l01003"></a>01003 
<a name="l01004"></a>01004         <span class="comment">// -----------------------------------------------------</span>
<a name="l01005"></a>01005         <span class="comment">/*  GET THE ACTUAL ARGUMENTS AFTER THE OPTIONS */</span>
<a name="l01006"></a>01006 <span class="comment">//</span>
<a name="l01007"></a>01007 <span class="comment">//      for( int32_t i = 0 ; i &lt; opt-&gt;getArgc() ; i++ )</span>
<a name="l01008"></a>01008 <span class="comment">//      {</span>
<a name="l01009"></a>01009 <span class="comment">//         cerr &lt;&lt; &quot;arg = &quot; &lt;&lt;  opt-&gt;getArgv( i ) &lt;&lt; endl ;</span>
<a name="l01010"></a>01010 <span class="comment">//      }</span>
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordtype">bool</span> bSendCommand   = <span class="keyword">false</span>; <span class="comment">// Determines whether to actually send a message to the server.</span>
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         <span class="comment">// If we can match the user&#39;s request to a client command,</span>
<a name="l01017"></a>01017         <span class="comment">// AND theClient object is able to process that request into</span>
<a name="l01018"></a>01018         <span class="comment">// theMessage, then we send it down the pipe.</span>
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 
<a name="l01021"></a>01021         <span class="comment">// In lieu of maintaining a constant connection to the server, in ZMQ mode, the</span>
<a name="l01022"></a>01022         <span class="comment">// client updates its internal &quot;connection&quot; object to make sure the right pointers</span>
<a name="l01023"></a>01023         <span class="comment">// are in place (since in ZMQ mode, each message could be from a different nym</span>
<a name="l01024"></a>01024         <span class="comment">// and to a different server.)</span>
<a name="l01025"></a>01025         <span class="comment">//</span>
<a name="l01026"></a>01026         <span class="keywordflow">if</span> ((NULL != pServerContract) &amp;&amp; (NULL != pMyNym))
<a name="l01027"></a>01027             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServerContract, *pMyNym, <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetTransportCallback());
<a name="l01028"></a>01028         <span class="comment">// NOTE -- This MAY be unnecessary for ProcessUserCommand (since these args are passed</span>
<a name="l01029"></a>01029         <span class="comment">// in there already) but it&#39;s definitely necessary soon after for ProcessServerReply()</span>
<a name="l01030"></a>01030         <span class="comment">// (which comes next.)</span>
<a name="l01031"></a>01031 
<a name="l01032"></a>01032 
<a name="l01033"></a>01033         <span class="comment">//        (OTClient::OT_CLIENT_CMD_TYPE requestedCommand,</span>
<a name="l01034"></a>01034         <span class="comment">//         OTMessage &amp; theMessage,</span>
<a name="l01035"></a>01035         <span class="comment">//         OTPseudonym &amp; theNym,</span>
<a name="l01036"></a>01036         <span class="comment">//         OTServerContract &amp; theServer,</span>
<a name="l01037"></a>01037         <span class="comment">//         OTAccount * pAccount/*=NULL*/,</span>
<a name="l01038"></a>01038         <span class="comment">//         lAmount</span>
<a name="l01039"></a>01039         <span class="comment">//         OTAssetContract * pMyAssetType/*=NULL*/,</span>
<a name="l01040"></a>01040         <span class="comment">//         OTAccount * pHisAcct/*=NULL*/,</span>
<a name="l01041"></a>01041         <span class="comment">//         OTPseudonym * pHisNym/*=NULL*/)</span>
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044         <span class="comment">// COMMANDS</span>
<a name="l01045"></a>01045 
<a name="l01046"></a>01046 
<a name="l01047"></a>01047         <span class="keywordflow">if</span>( ( opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ) != NULL ) ||
<a name="l01048"></a>01048             ( opt-&gt;getArgc() &gt; 0) )
<a name="l01049"></a>01049         {
<a name="l01050"></a>01050             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a7b1155d15226f5b512d7dd2c839a8cb9">SetRunningAsScript</a>(); <span class="comment">// This way it won&#39;t go firing off messages automatically based on receiving certain server replies to previous requests.</span>
<a name="l01051"></a>01051             <span class="comment">// Todo: Research whether the above call is still necessary. (OTAPI no longer fires off ANY auto messages based on server replies. API CLIENT MUST do those things itself now.)</span>
<a name="l01052"></a>01052 
<a name="l01053"></a>01053             std::string strFilename;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055             <span class="comment">// If a filename is provided as a normal argument (like this: ot &lt;filename&gt;)</span>
<a name="l01056"></a>01056             <span class="comment">// then it will work...</span>
<a name="l01057"></a>01057             <span class="comment">//</span>
<a name="l01058"></a>01058             <span class="keywordflow">if</span> (opt-&gt;getArgc() &gt; 0)
<a name="l01059"></a>01059             {
<a name="l01060"></a>01060                 strFilename = opt-&gt;getArgv( 0 );
<a name="l01061"></a>01061             }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063             <span class="comment">// the --script option will ALSO work for the filename, and will override the above.</span>
<a name="l01064"></a>01064             <span class="comment">// so:   ot --script &lt;filename&gt;</span>
<a name="l01065"></a>01065             <span class="comment">// also: ot --script &lt;actual_filename&gt; &lt;ignored_filename&gt;</span>
<a name="l01066"></a>01066             <span class="comment">//</span>
<a name="l01067"></a>01067             <span class="comment">// In this above example, ignored_filename WOULD have been used, but then it got</span>
<a name="l01068"></a>01068             <span class="comment">// overridden by the --script actual_filename.</span>
<a name="l01069"></a>01069 
<a name="l01070"></a>01070             <span class="keywordflow">if</span> (NULL != opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ))
<a name="l01071"></a>01071             {
<a name="l01072"></a>01072                 strFilename = opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> );
<a name="l01073"></a>01073             }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075             std::ifstream t(strFilename.c_str(), std::ios::in | std::ios::binary);
<a name="l01076"></a>01076             std::stringstream buffer;
<a name="l01077"></a>01077             buffer &lt;&lt; t.rdbuf();
<a name="l01078"></a>01078             std::string results = buffer.str();
<a name="l01079"></a>01079             <span class="comment">// ----------------------------------------</span>
<a name="l01080"></a>01080             <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a>   angelArgs; <span class="comment">// For user-defined arguments that may have been passed in.</span>
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 <span class="comment">//          OTParty     * pPartyMyNym   = NULL;</span>
<a name="l01085"></a>01085 <span class="comment">//          OTParty     * pPartyHisNym  = NULL;</span>
<a name="l01086"></a>01086 <span class="comment">//</span>
<a name="l01087"></a>01087 <span class="comment">//          OTCleanup&lt;OTParty&gt; angelMyNym;</span>
<a name="l01088"></a>01088 <span class="comment">//          OTCleanup&lt;OTParty&gt; angelHisNym;</span>
<a name="l01089"></a>01089             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyNymVar;
<a name="l01090"></a>01090             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisNymVar;
<a name="l01091"></a>01091             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelServer;
<a name="l01092"></a>01092             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyAcct;
<a name="l01093"></a>01093             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisAcct;
<a name="l01094"></a>01094             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyPurse;
<a name="l01095"></a>01095             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisPurse;
<a name="l01096"></a>01096             <span class="comment">// -------------------------</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098             <span class="keywordflow">if</span> ((str_Args.size() &gt; 0) || (opt-&gt;getArgc() &gt; 1))
<a name="l01099"></a>01099             {
<a name="l01100"></a>01100                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;Args&quot;</span>);
<a name="l01101"></a>01101                 std::string str_var_value, str_command;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103                 <span class="keywordflow">if</span> (str_Args.size() &gt; 0)
<a name="l01104"></a>01104                     str_var_value += str_Args;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106                 <span class="keywordflow">if</span> (opt-&gt;getArgc() &gt; 1)
<a name="l01107"></a>01107                 {
<a name="l01108"></a>01108                     <span class="keywordflow">if</span> (str_Args.size() &gt; 0)
<a name="l01109"></a>01109                         str_var_value += <span class="stringliteral">&quot; &quot;</span>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111                     str_command = opt-&gt;getArgv( 1 );
<a name="l01112"></a>01112                     str_var_value += <span class="stringliteral">&quot;ot_cli_command &quot;</span>;
<a name="l01113"></a>01113                     str_var_value += str_command;
<a name="l01114"></a>01114                 }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding user-defined command line arguments as &#39;%s&#39; containing value: %s\n&quot;</span>,
<a name="l01117"></a>01117                     str_var_name.c_str(), str_var_value.c_str());
<a name="l01118"></a>01118 
<a name="l01119"></a>01119                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;Args&quot;</span>
<a name="l01120"></a>01120                     str_var_value,      <span class="comment">// &quot;key1 value1 key2 value2 key3 value3 key4 value4&quot;</span>
<a name="l01121"></a>01121                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01122"></a>01122                 angelArgs.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01123"></a>01123                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01124"></a>01124                 <span class="comment">// ------------------------------------------</span>
<a name="l01125"></a>01125                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01126"></a>01126             }
<a name="l01127"></a>01127             <span class="keywordflow">else</span>
<a name="l01128"></a>01128             {
<a name="l01129"></a>01129                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Args variable (optional user-defined arguments) isn&#39;t set...\n&quot;</span>);
<a name="l01130"></a>01130             }
<a name="l01131"></a>01131 
<a name="l01132"></a>01132             <span class="comment">// -------------------------</span>
<a name="l01133"></a>01133             <span class="keywordflow">if</span> (str_ServerID.size() &gt; 0)
<a name="l01134"></a>01134             {
<a name="l01135"></a>01135                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;Server&quot;</span>);
<a name="l01136"></a>01136                 <span class="keyword">const</span> std::string str_var_value(str_ServerID);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());
<a name="l01139"></a>01139 
<a name="l01140"></a>01140                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;Server&quot;</span>
<a name="l01141"></a>01141                     str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01142"></a>01142                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01143"></a>01143                 angelServer.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01144"></a>01144                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01145"></a>01145                 <span class="comment">// ------------------------------------------</span>
<a name="l01146"></a>01146                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01147"></a>01147             }
<a name="l01148"></a>01148             <span class="keywordflow">else</span>
<a name="l01149"></a>01149             {
<a name="l01150"></a>01150                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Server variable isn&#39;t set...\n&quot;</span>);
<a name="l01151"></a>01151             }
<a name="l01152"></a>01152             <span class="comment">// -------------------------</span>
<a name="l01153"></a>01153 
<a name="l01154"></a>01154             <span class="keywordflow">if</span> (NULL != pMyNym)
<a name="l01155"></a>01155             {
<a name="l01156"></a>01156                 <span class="keyword">const</span> std::string str_party_name(<span class="stringliteral">&quot;MyNym&quot;</span>);
<a name="l01157"></a>01157 
<a name="l01158"></a>01158                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_party_name.c_str(), str_MyNym.c_str());
<a name="l01159"></a>01159 
<a name="l01160"></a>01160                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_party_name,  <span class="comment">// &quot;MyNym&quot;</span>
<a name="l01161"></a>01161                     str_MyNym,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01162"></a>01162                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01163"></a>01163                 angelMyNymVar.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01164"></a>01164                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01165"></a>01165                 <span class="comment">// ------------------------------------------</span>
<a name="l01166"></a>01166                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_party_name, *pVar);
<a name="l01167"></a>01167             }
<a name="l01168"></a>01168             <span class="keywordflow">else</span>
<a name="l01169"></a>01169             {
<a name="l01170"></a>01170                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyNym variable isn&#39;t set...\n&quot;</span>);
<a name="l01171"></a>01171             }
<a name="l01172"></a>01172             <span class="comment">// -------------------------</span>
<a name="l01173"></a>01173 
<a name="l01174"></a>01174             <span class="keywordflow">if</span> ((NULL != pHisNym) || (str_HisNym.size() &gt; 0)) <span class="comment">// Even if we didn&#39;t find him, we still let the ID through, if there is one.</span>
<a name="l01175"></a>01175             {
<a name="l01176"></a>01176                 <span class="keyword">const</span> std::string str_party_name(<span class="stringliteral">&quot;HisNym&quot;</span>);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_party_name.c_str(), str_HisNym.c_str());
<a name="l01179"></a>01179 
<a name="l01180"></a>01180                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_party_name,  <span class="comment">// &quot;HisNym&quot;</span>
<a name="l01181"></a>01181                     str_HisNym,     <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01182"></a>01182                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01183"></a>01183                 angelHisNymVar.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01184"></a>01184                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01185"></a>01185                 <span class="comment">// ------------------------------------------</span>
<a name="l01186"></a>01186                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_party_name, *pVar);
<a name="l01187"></a>01187             }
<a name="l01188"></a>01188             <span class="keywordflow">else</span>
<a name="l01189"></a>01189             {
<a name="l01190"></a>01190                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;HisNym variable isn&#39;t set...\n&quot;</span>);
<a name="l01191"></a>01191             }
<a name="l01192"></a>01192             <span class="comment">// -------------------------</span>
<a name="l01193"></a>01193             <span class="comment">// WE NO LONGER PASS THE PARTY DIRECTLY TO THE SCRIPT,</span>
<a name="l01194"></a>01194             <span class="comment">// BUT INSTEAD, ONLY THE PARTY&#39;S NAME.</span>
<a name="l01195"></a>01195             <span class="comment">//</span>
<a name="l01196"></a>01196             <span class="comment">// (Because often, &quot;HisNym&quot; isn&#39;t in my wallet and wouldn&#39;t be found anyway,</span>
<a name="l01197"></a>01197             <span class="comment">//  even though it ends up to contain a perfectly legitimate Nym ID.)</span>
<a name="l01198"></a>01198             <span class="comment">/*</span>
<a name="l01199"></a>01199 <span class="comment">            if (NULL != pMyNym)</span>
<a name="l01200"></a>01200 <span class="comment">            {</span>
<a name="l01201"></a>01201 <span class="comment">                const std::string str_party_name(&quot;MyNym&quot;), str_agent_name(&quot;mynym&quot;), str_acct_name(&quot;myacct&quot;);</span>
<a name="l01202"></a>01202 <span class="comment"></span>
<a name="l01203"></a>01203 <span class="comment">                pPartyMyNym = new OTParty (str_party_name, *pMyNym, str_agent_name, pMyAccount, &amp;str_acct_name);</span>
<a name="l01204"></a>01204 <span class="comment">                angelMyNym.SetCleanupTargetPointer(pPartyMyNym);</span>
<a name="l01205"></a>01205 <span class="comment">                OT_ASSERT(NULL != pPartyMyNym);</span>
<a name="l01206"></a>01206 <span class="comment">                // ------------------------------------------</span>
<a name="l01207"></a>01207 <span class="comment">                pScript-&gt; AddParty(&quot;MyNym&quot;, *pPartyMyNym);</span>
<a name="l01208"></a>01208 <span class="comment">            }</span>
<a name="l01209"></a>01209 <span class="comment">            else</span>
<a name="l01210"></a>01210 <span class="comment">            {</span>
<a name="l01211"></a>01211 <span class="comment">                OTLog::Error(&quot;MyNym variable isn&#39;t set...\n&quot;);</span>
<a name="l01212"></a>01212 <span class="comment">            }</span>
<a name="l01213"></a>01213 <span class="comment">            // -------------------------</span>
<a name="l01214"></a>01214 <span class="comment">            if (NULL != pHisNym)</span>
<a name="l01215"></a>01215 <span class="comment">            {</span>
<a name="l01216"></a>01216 <span class="comment">                const std::string str_party_name(&quot;HisNym&quot;), str_agent_name(&quot;hisnym&quot;), str_acct_name(&quot;hisacct&quot;);</span>
<a name="l01217"></a>01217 <span class="comment"></span>
<a name="l01218"></a>01218 <span class="comment">                pPartyHisNym = new OTParty (str_party_name, *pHisNym, str_agent_name, pHisAccount, &amp;str_acct_name);</span>
<a name="l01219"></a>01219 <span class="comment">                angelHisNym.SetCleanupTargetPointer(pPartyHisNym);</span>
<a name="l01220"></a>01220 <span class="comment">                OT_ASSERT(NULL != pPartyHisNym);</span>
<a name="l01221"></a>01221 <span class="comment">                // ------------------------------------------</span>
<a name="l01222"></a>01222 <span class="comment">                pScript-&gt; AddParty(&quot;HisNym&quot;, *pPartyHisNym);</span>
<a name="l01223"></a>01223 <span class="comment">            }</span>
<a name="l01224"></a>01224 <span class="comment">            else</span>
<a name="l01225"></a>01225 <span class="comment">            {</span>
<a name="l01226"></a>01226 <span class="comment">                OTLog::Error(&quot;HisNym variable isn&#39;t set...\n&quot;);</span>
<a name="l01227"></a>01227 <span class="comment">            }</span>
<a name="l01228"></a>01228 <span class="comment">            */</span>
<a name="l01229"></a>01229             <span class="comment">// -------------------------</span>
<a name="l01230"></a>01230 
<a name="l01231"></a>01231             <span class="keywordflow">if</span> (str_MyAcct.size() &gt; 0)
<a name="l01232"></a>01232             {
<a name="l01233"></a>01233                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;MyAcct&quot;</span>);
<a name="l01234"></a>01234                 <span class="keyword">const</span> std::string str_var_value(str_MyAcct);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());
<a name="l01237"></a>01237 
<a name="l01238"></a>01238                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;MyAcct&quot;</span>
<a name="l01239"></a>01239                     str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01240"></a>01240                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01241"></a>01241                 angelMyAcct.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01242"></a>01242                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01243"></a>01243                 <span class="comment">// ------------------------------------------</span>
<a name="l01244"></a>01244                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01245"></a>01245             }
<a name="l01246"></a>01246             <span class="keywordflow">else</span>
<a name="l01247"></a>01247             {
<a name="l01248"></a>01248                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyAcct variable isn&#39;t set...\n&quot;</span>);
<a name="l01249"></a>01249             }
<a name="l01250"></a>01250             <span class="comment">// -------------------------</span>
<a name="l01251"></a>01251 
<a name="l01252"></a>01252             <span class="keywordflow">if</span> (str_MyPurse.size() &gt; 0)
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;MyPurse&quot;</span>);
<a name="l01255"></a>01255                 <span class="keyword">const</span> std::string str_var_value(str_MyPurse);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());
<a name="l01258"></a>01258 
<a name="l01259"></a>01259                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;MyPurse&quot;</span>
<a name="l01260"></a>01260                     str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01261"></a>01261                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01262"></a>01262                 angelMyPurse.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01263"></a>01263                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01264"></a>01264                 <span class="comment">// ------------------------------------------</span>
<a name="l01265"></a>01265                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01266"></a>01266             }
<a name="l01267"></a>01267             <span class="keywordflow">else</span>
<a name="l01268"></a>01268             {
<a name="l01269"></a>01269                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyPurse variable isn&#39;t set...\n&quot;</span>);
<a name="l01270"></a>01270             }
<a name="l01271"></a>01271             <span class="comment">// -------------------------</span>
<a name="l01272"></a>01272 
<a name="l01273"></a>01273             <span class="keywordflow">if</span> (str_HisAcct.size() &gt; 0)
<a name="l01274"></a>01274             {
<a name="l01275"></a>01275                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;HisAcct&quot;</span>);
<a name="l01276"></a>01276                 <span class="keyword">const</span> std::string str_var_value(str_HisAcct);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());
<a name="l01279"></a>01279 
<a name="l01280"></a>01280                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;HisAcct&quot;</span>
<a name="l01281"></a>01281                     str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01282"></a>01282                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01283"></a>01283                 angelHisAcct.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01284"></a>01284                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01285"></a>01285                 <span class="comment">// ------------------------------------------</span>
<a name="l01286"></a>01286                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01287"></a>01287             }
<a name="l01288"></a>01288             <span class="keywordflow">else</span>
<a name="l01289"></a>01289             {
<a name="l01290"></a>01290                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;HisAcct variable isn&#39;t set...\n&quot;</span>);
<a name="l01291"></a>01291             }
<a name="l01292"></a>01292             <span class="comment">// -------------------------</span>
<a name="l01293"></a>01293 
<a name="l01294"></a>01294             <span class="keywordflow">if</span> (str_HisPurse.size() &gt; 0)
<a name="l01295"></a>01295             {
<a name="l01296"></a>01296                 <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;HisPurse&quot;</span>);
<a name="l01297"></a>01297                 <span class="keyword">const</span> std::string str_var_value(str_HisPurse);
<a name="l01298"></a>01298 
<a name="l01299"></a>01299                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());
<a name="l01300"></a>01300 
<a name="l01301"></a>01301                 <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;HisPurse&quot;</span>
<a name="l01302"></a>01302                     str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
<a name="l01303"></a>01303                     <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
<a name="l01304"></a>01304                 angelHisPurse.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
<a name="l01305"></a>01305                 <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
<a name="l01306"></a>01306                 <span class="comment">// ------------------------------------------</span>
<a name="l01307"></a>01307                 madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
<a name="l01308"></a>01308             }
<a name="l01309"></a>01309             <span class="keywordflow">else</span>
<a name="l01310"></a>01310             {
<a name="l01311"></a>01311                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyPurse variable isn&#39;t set...\n&quot;</span>);
<a name="l01312"></a>01312             }
<a name="l01313"></a>01313             <span class="comment">// ************************************************</span>
<a name="l01314"></a>01314 
<a name="l01315"></a>01315             madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();
<a name="l01316"></a>01316 
<a name="l01317"></a>01317             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(1, <span class="stringliteral">&quot;Script output:\n\n&quot;</span>);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319             <span class="comment">// OT SCRIPT PROMPT --------------------------------------------</span>
<a name="l01320"></a>01320 <span class="preprocessor">#if USE_OLD_CHAISCRIPT == 0</span>
<a name="l01321"></a>01321 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (strFilename.size() &gt;= 8)
<a name="l01322"></a>01322             {
<a name="l01323"></a>01323                 <span class="comment">// request to run opentxs command line script?</span>
<a name="l01324"></a>01324                 std::string endsWith = strFilename.substr(strFilename.size() - 8, 8);
<a name="l01325"></a>01325                 <span class="keywordflow">if</span> (endsWith == <span class="stringliteral">&quot;\\opentxs&quot;</span> || endsWith == <span class="stringliteral">&quot;/opentxs&quot;</span>)
<a name="l01326"></a>01326                 {
<a name="l01327"></a>01327                     <span class="keywordflow">return</span> madeEasy.<a class="code" href="class_o_t___m_e.html#a78acf0395f07f0f958c1616b406343b8">opentxs_main_loop</a>();
<a name="l01328"></a>01328                 }
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330 <span class="preprocessor">#endif</span>
<a name="l01331"></a>01331 <span class="preprocessor"></span>            <span class="keywordflow">return</span> madeEasy.<a class="code" href="class_o_t___m_e.html#a0e872f5e07b213ae48084a762bf96c8e">ExecuteScript_ReturnInt</a>(results, strFilename);
<a name="l01332"></a>01332         }
<a name="l01333"></a>01333         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01334"></a>01334         <span class="comment">// OT SCRIPT ABOVE.</span>
<a name="l01335"></a>01335         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 
<a name="l01338"></a>01338         <span class="comment">// *******************************************************************</span>
<a name="l01339"></a>01339 
<a name="l01340"></a>01340         <span class="keywordflow">if</span> ((NULL == pServerContract) || (NULL == pMyNym))
<a name="l01341"></a>01341         {
<a name="l01342"></a>01342             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Unexpected NULL: %s %s\n&quot;</span>,
<a name="l01343"></a>01343                 (NULL == pServerContract) ? <span class="stringliteral">&quot;pServerContract&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l01344"></a>01344                 (NULL == pMyNym)          ? <span class="stringliteral">&quot;pMyNym&quot;</span>          : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;withdraw&quot;</span> ) != NULL  )
<a name="l01347"></a>01347         {
<a name="l01348"></a>01348             <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ));
<a name="l01349"></a>01349 
<a name="l01350"></a>01350             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw cash...)\n&quot;</span>);
<a name="l01351"></a>01351 
<a name="l01352"></a>01352             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01353"></a>01353             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01354"></a>01354 
<a name="l01355"></a>01355             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a6a1880142e9d121429e7a48189e82654">OTClient::notarizeWithdrawal</a>, theMessage,
<a name="l01356"></a>01356                 *pMyNym, *pServerContract,
<a name="l01357"></a>01357                 pMyAccount, lAmount))
<a name="l01358"></a>01358             {
<a name="l01359"></a>01359                 bSendCommand = <span class="keyword">true</span>;
<a name="l01360"></a>01360             }
<a name="l01361"></a>01361             <span class="keywordflow">else</span>
<a name="l01362"></a>01362                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing withdraw command in ProcessMessage.\n&quot;</span>);
<a name="l01363"></a>01363             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01364"></a>01364         }
<a name="l01365"></a>01365         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;transfer&quot;</span> ) != NULL  )
<a name="l01366"></a>01366         {
<a name="l01367"></a>01367             <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ));
<a name="l01368"></a>01368 
<a name="l01369"></a>01369             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCT_ID((str_HisAcct.size() &gt; 0) ? str_HisAcct.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);
<a name="l01370"></a>01370 
<a name="l01371"></a>01371             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to send a Transfer command (Notarize Transactions)...\n&quot;</span>);
<a name="l01372"></a>01372 
<a name="l01373"></a>01373             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01374"></a>01374             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01375"></a>01375 
<a name="l01376"></a>01376             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab982770b40b71822dc40f0bb3617d6ec">OTClient::notarizeTransfer</a>, theMessage,
<a name="l01377"></a>01377                 *pMyNym,  *pServerContract,
<a name="l01378"></a>01378                 pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
<a name="l01379"></a>01379                 NULL, <span class="comment">// his Nym</span>
<a name="l01380"></a>01380                 (str_HisAcct.size() &gt; 0) ? &amp;HIS_ACCT_ID : NULL)) <span class="comment">// his acct</span>
<a name="l01381"></a>01381             {
<a name="l01382"></a>01382                 bSendCommand = <span class="keyword">true</span>;
<a name="l01383"></a>01383             }
<a name="l01384"></a>01384             <span class="keywordflow">else</span>
<a name="l01385"></a>01385                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing notarizeTransactions (transfer) command in ProcessMessage.\n&quot;</span>);
<a name="l01386"></a>01386         }
<a name="l01387"></a>01387         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;cheque&quot;</span> ) != NULL  )
<a name="l01388"></a>01388         {
<a name="l01389"></a>01389             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to write a cheque...)\n&quot;</span>);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391             <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ));
<a name="l01392"></a>01392 
<a name="l01393"></a>01393             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size() &gt; 0)  ? str_HisNym.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>); <span class="comment">// todo hardcoding</span>
<a name="l01394"></a>01394 
<a name="l01395"></a>01395             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab15b3869502823da3286c4a3be9b83bc">OTClient::writeCheque</a>, theMessage,
<a name="l01396"></a>01396                 *pMyNym, *pServerContract,
<a name="l01397"></a>01397                 pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
<a name="l01398"></a>01398                 (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL);
<a name="l01399"></a>01399         }
<a name="l01400"></a>01400         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;voucher&quot;</span> ) != NULL  )
<a name="l01401"></a>01401         {
<a name="l01402"></a>01402             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw a voucher...)\n&quot;</span>);
<a name="l01403"></a>01403 
<a name="l01404"></a>01404             <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ));
<a name="l01405"></a>01405 
<a name="l01406"></a>01406             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size() &gt; 0)  ? str_HisNym.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);
<a name="l01407"></a>01407 
<a name="l01408"></a>01408             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac31b4267e60dbdc9c28b5c7ba8fde62c">OTClient::withdrawVoucher</a>, theMessage,
<a name="l01409"></a>01409                 *pMyNym, *pServerContract,
<a name="l01410"></a>01410                 pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
<a name="l01411"></a>01411                 (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL))
<a name="l01412"></a>01412             {
<a name="l01413"></a>01413                 bSendCommand = <span class="keyword">true</span>;
<a name="l01414"></a>01414             }
<a name="l01415"></a>01415             <span class="keywordflow">else</span>
<a name="l01416"></a>01416                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing withdraw voucher command in ProcessMessage.\n&quot;</span>);
<a name="l01417"></a>01417 
<a name="l01418"></a>01418         }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420         <span class="comment">// make an offer and put it onto a market.</span>
<a name="l01421"></a>01421         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;getValue( <span class="stringliteral">&quot;marketoffer&quot;</span> ) != NULL)
<a name="l01422"></a>01422         {
<a name="l01423"></a>01423             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a marketOffer command to the server...)\n&quot;</span>);
<a name="l01424"></a>01424 
<a name="l01425"></a>01425             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01426"></a>01426             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01427"></a>01427 
<a name="l01428"></a>01428             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aa3e1744621c050d38a934d77749d891e">OTClient::marketOffer</a>, theMessage,
<a name="l01429"></a>01429                 *pMyNym, *pServerContract,
<a name="l01430"></a>01430                 NULL)) <span class="comment">// for now, keeping it simple. Can add options later.</span>
<a name="l01431"></a>01431             {
<a name="l01432"></a>01432                 bSendCommand = <span class="keyword">true</span>;
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434             <span class="keywordflow">else</span>
<a name="l01435"></a>01435                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing marketOffer command in ProcessMessage.\n&quot;</span>);
<a name="l01436"></a>01436             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         <span class="comment">// ********************************************************</span>
<a name="l01440"></a>01440         <span class="comment">/*</span>
<a name="l01441"></a>01441 <span class="comment">        bool ProcessUserCommand(OT_CLIENT_CMD_TYPE requestedCommand,</span>
<a name="l01442"></a>01442 <span class="comment">            OTMessage &amp; theMessage,</span>
<a name="l01443"></a>01443 <span class="comment">            OTPseudonym &amp; theNym,</span>
<a name="l01444"></a>01444 <span class="comment">//          OTAssetContract &amp; theContract,</span>
<a name="l01445"></a>01445 <span class="comment">            OTServerContract &amp; theServer,</span>
<a name="l01446"></a>01446 <span class="comment">            OTAccount * pAccount=NULL,</span>
<a name="l01447"></a>01447 <span class="comment">            int64_t lTransactionAmount = 0,</span>
<a name="l01448"></a>01448 <span class="comment">            OTAssetContract * pMyAssetType=NULL,</span>
<a name="l01449"></a>01449 <span class="comment">            OTIdentifier * pHisAcctID=NULL,</span>
<a name="l01450"></a>01450 <span class="comment">            OTIdentifier * pHisNymID=NULL);</span>
<a name="l01451"></a>01451 <span class="comment">        */</span>
<a name="l01452"></a>01452         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;proposepaymentplan&quot;</span> ) )
<a name="l01453"></a>01453         {
<a name="l01454"></a>01454             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to propose a payment plan...)\n&quot;</span>);
<a name="l01455"></a>01455 
<a name="l01456"></a>01456             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size()  &gt; 0) ? str_HisNym.c_str() :<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);
<a name="l01457"></a>01457             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCT_ID((str_HisAcct.size() &gt; 0) ? str_HisAcct.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);
<a name="l01458"></a>01458 
<a name="l01459"></a>01459             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a2e9a6e919c7ee32a962aaf24b1ffb697">OTClient::proposePaymentPlan</a>, theMessage,
<a name="l01460"></a>01460                 *pMyNym, *pServerContract,
<a name="l01461"></a>01461                 pMyAccount, 0, pMyAssetContract,
<a name="l01462"></a>01462                 (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL,
<a name="l01463"></a>01463                 (str_HisAcct.size() &gt; 0) ? &amp;HIS_ACCT_ID : NULL
<a name="l01464"></a>01464                 );
<a name="l01465"></a>01465         }
<a name="l01466"></a>01466         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01467"></a>01467         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;confirmpaymentplan&quot;</span> ) )
<a name="l01468"></a>01468         {
<a name="l01469"></a>01469             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to confirm a payment plan...)\n&quot;</span>);
<a name="l01470"></a>01470 
<a name="l01471"></a>01471             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a901ce90148ddf82944a19bc4338682ad">OTClient::confirmPaymentPlan</a>, theMessage,
<a name="l01472"></a>01472                 *pMyNym, *pServerContract,
<a name="l01473"></a>01473                 NULL); <span class="comment">// the account info is already on the plan, right?</span>
<a name="l01474"></a>01474         }
<a name="l01475"></a>01475         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01476"></a>01476         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;activatepaymentplan&quot;</span> ) )
<a name="l01477"></a>01477         {
<a name="l01478"></a>01478             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to activate a payment plan...)\n&quot;</span>);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab70cae2211349300334a71529c942b75">OTClient::paymentPlan</a>, theMessage,
<a name="l01481"></a>01481                 *pMyNym, *pServerContract,
<a name="l01482"></a>01482                 pMyAccount)) <span class="comment">// if user DOES specify an account (unnecessary)</span>
<a name="l01483"></a>01483             {                                   <span class="comment">// then OT will verify that they match, and error otherwise.</span>
<a name="l01484"></a>01484                 bSendCommand = <span class="keyword">true</span>;
<a name="l01485"></a>01485             }
<a name="l01486"></a>01486             <span class="keywordflow">else</span>
<a name="l01487"></a>01487                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing activate payment plan command in ProcessMessage.\n&quot;</span>);
<a name="l01488"></a>01488         }
<a name="l01489"></a>01489         <span class="comment">// *******************************************************</span>
<a name="l01490"></a>01490 
<a name="l01491"></a>01491         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;depositcheque&quot;</span> ) )
<a name="l01492"></a>01492         {
<a name="l01493"></a>01493             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a cheque...)\n&quot;</span>);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01496"></a>01496             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01497"></a>01497 
<a name="l01498"></a>01498             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a393f2048b156f634595bd6d628c80209">OTClient::notarizeCheque</a>, theMessage,
<a name="l01499"></a>01499                 *pMyNym, *pServerContract,
<a name="l01500"></a>01500                 pMyAccount))
<a name="l01501"></a>01501             {
<a name="l01502"></a>01502                 bSendCommand = <span class="keyword">true</span>;
<a name="l01503"></a>01503             }
<a name="l01504"></a>01504             <span class="keywordflow">else</span>
<a name="l01505"></a>01505                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit cheque command in ProcessMessage.\n&quot;</span>);
<a name="l01506"></a>01506             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01507"></a>01507         }
<a name="l01508"></a>01508         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;getFlag( <span class="stringliteral">&quot;depositpurse&quot;</span> ) )
<a name="l01509"></a>01509         {
<a name="l01510"></a>01510             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a cash purse...)\n&quot;</span>);
<a name="l01511"></a>01511 
<a name="l01512"></a>01512             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01513"></a>01513             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01514"></a>01514 
<a name="l01515"></a>01515             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9f04f3ee9323ef6ab4319c78a6139506">OTClient::notarizePurse</a>, theMessage,
<a name="l01516"></a>01516                 *pMyNym, *pServerContract,
<a name="l01517"></a>01517                 pMyAccount,
<a name="l01518"></a>01518                 0, <span class="comment">// amount (unused here)</span>
<a name="l01519"></a>01519                 pMyAssetContract))
<a name="l01520"></a>01520             {
<a name="l01521"></a>01521                 bSendCommand = <span class="keyword">true</span>;
<a name="l01522"></a>01522             }
<a name="l01523"></a>01523             <span class="keywordflow">else</span>
<a name="l01524"></a>01524                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit purse command in ProcessMessage.\n&quot;</span>);
<a name="l01525"></a>01525             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01526"></a>01526         }
<a name="l01527"></a>01527         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;deposittokens&quot;</span> ) )
<a name="l01528"></a>01528         {
<a name="l01529"></a>01529             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit individual cash tokens...)\n&quot;</span>);
<a name="l01530"></a>01530 
<a name="l01531"></a>01531             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01532"></a>01532             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01533"></a>01533 
<a name="l01534"></a>01534             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac0d3b6c44604abdd3b07bab8e69ea602">OTClient::notarizeDeposit</a>, theMessage,
<a name="l01535"></a>01535                 *pMyNym, *pServerContract,
<a name="l01536"></a>01536                 pMyAccount))
<a name="l01537"></a>01537             {
<a name="l01538"></a>01538                 bSendCommand = <span class="keyword">true</span>;
<a name="l01539"></a>01539             }
<a name="l01540"></a>01540             <span class="keywordflow">else</span>
<a name="l01541"></a>01541                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit cash tokens command in ProcessMessage.\n&quot;</span>);
<a name="l01542"></a>01542             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;i&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;inbox&quot;</span> )  )
<a name="l01545"></a>01545         {
<a name="l01546"></a>01546             cerr &lt;&lt; <span class="stringliteral">&quot;DISPLAY INBOX CONTENTS HERE... (When I code this. What can I say? Use the GUI.)&quot;</span> &lt;&lt; endl ;
<a name="l01547"></a>01547         }
<a name="l01548"></a>01548         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;s&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;sign&quot;</span> ))
<a name="l01549"></a>01549         {
<a name="l01550"></a>01550             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to sign a contract...)\n&quot;</span>);
<a name="l01551"></a>01551 
<a name="l01552"></a>01552             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac5c8e57a658c61b11369d11204b73cbd">OTClient::signContract</a>, theMessage,
<a name="l01553"></a>01553                 *pMyNym, *pServerContract,
<a name="l01554"></a>01554                 NULL);
<a name="l01555"></a>01555         }
<a name="l01556"></a>01556         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;p&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;purse&quot;</span> )  )
<a name="l01557"></a>01557         {
<a name="l01558"></a>01558             cerr &lt;&lt; <span class="stringliteral">&quot;User wants to display purse contents (not coded yet here.)&quot;</span> &lt;&lt; endl ;
<a name="l01559"></a>01559         }
<a name="l01560"></a>01560         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;verify&quot;</span> )  )
<a name="l01561"></a>01561         {
<a name="l01562"></a>01562             cerr &lt;&lt; <span class="stringliteral">&quot;User wants to verify a signature on a contract (not coded yet here) &quot;</span> &lt;&lt; endl ;
<a name="l01563"></a>01563         }
<a name="l01564"></a>01564         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;stat&quot;</span> )   )
<a name="l01565"></a>01565         {
<a name="l01566"></a>01566             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display wallet contents...\n&quot;</span>);
<a name="l01567"></a>01567 
<a name="l01568"></a>01568             <a class="code" href="class_o_t_string.html">OTString</a> strStat;
<a name="l01569"></a>01569             pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aed7e71a27cd1442399f16acd6b191372">DisplayStatistics</a>(strStat);
<a name="l01570"></a>01570             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s\n&quot;</span>, strStat.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01571"></a>01571         }
<a name="l01572"></a>01572         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> )   )
<a name="l01573"></a>01573         {
<a name="l01574"></a>01574             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to enter the OT prompt...\n&quot;</span>);
<a name="l01575"></a>01575         }
<a name="l01576"></a>01576         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="charliteral">&#39;b&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;balance&quot;</span> )   )
<a name="l01577"></a>01577         {
<a name="l01578"></a>01578             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n ACCT BALANCE (server-side): %lld\n\n&quot;</span>, pMyAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>());
<a name="l01579"></a>01579 
<a name="l01580"></a>01580             <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">LoadPurse</a>(theServerID, thePurseAssetTypeID, MY_NYM_ID);
<a name="l01581"></a>01581             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse);
<a name="l01582"></a>01582             <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l01583"></a>01583                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot; CASH PURSE (client-side): %lld\n&quot;</span>, pPurse-&gt;GetTotalValue());
<a name="l01584"></a>01584         }
<a name="l01585"></a>01585         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;r&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;refresh&quot;</span> )   )
<a name="l01586"></a>01586         {
<a name="l01587"></a>01587             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to download intermediary files for an asset account...)\n&quot;</span>);
<a name="l01588"></a>01588 
<a name="l01589"></a>01589             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01590"></a>01590             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01591"></a>01591 
<a name="l01592"></a>01592             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a83dc60e33659baf6d5ce60c3aa254f06">OTClient::getAccount</a>, theMessage,
<a name="l01593"></a>01593                 *pMyNym,  *pServerContract,
<a name="l01594"></a>01594                 pMyAccount))
<a name="l01595"></a>01595             {
<a name="l01596"></a>01596                 bSendCommand = <span class="keyword">true</span>;
<a name="l01597"></a>01597             }
<a name="l01598"></a>01598             <span class="keywordflow">else</span>
<a name="l01599"></a>01599                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing getAccount command in ProcessMessage.\n&quot;</span>);
<a name="l01600"></a>01600             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;refreshnym&quot;</span> )   )
<a name="l01603"></a>01603         {
<a name="l01604"></a>01604             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to download intermediary files for a Nym...)\n&quot;</span>);
<a name="l01605"></a>01605 
<a name="l01606"></a>01606             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l01607"></a>01607             <span class="comment">// if successful setting up the command payload...</span>
<a name="l01608"></a>01608 
<a name="l01609"></a>01609             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a81f19a83547bbc089eb7efa134c9e22a">OTClient::getNymbox</a>, theMessage,
<a name="l01610"></a>01610                 *pMyNym,  *pServerContract,
<a name="l01611"></a>01611                 NULL))
<a name="l01612"></a>01612             {
<a name="l01613"></a>01613                 bSendCommand = <span class="keyword">true</span>;
<a name="l01614"></a>01614             }
<a name="l01615"></a>01615             <span class="keywordflow">else</span>
<a name="l01616"></a>01616                 <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing getNymbox command in ProcessMessage.\n&quot;</span>);
<a name="l01617"></a>01617         }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619         <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l01620"></a>01620         <span class="comment">//</span>
<a name="l01621"></a>01621         <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServerContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l01622"></a>01622 
<a name="l01623"></a>01623         <span class="keywordflow">if</span> ((NULL == pServerNym) || (<span class="keyword">false</span> == pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>()))
<a name="l01624"></a>01624         {
<a name="l01625"></a>01625             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;The server Nym was NULL or failed to verify on server contract: %s\n&quot;</span>,
<a name="l01626"></a>01626                 strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01627"></a>01627             <span class="keywordflow">return</span> 0;
<a name="l01628"></a>01628         }
<a name="l01629"></a>01629         <span class="comment">//</span>
<a name="l01630"></a>01630         <span class="comment">// ***********************************************************</span>
<a name="l01631"></a>01631 
<a name="l01632"></a>01632         <span class="keywordflow">if</span> (bSendCommand &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>())
<a name="l01633"></a>01633         {
<a name="l01634"></a>01634             <a class="code" href="class_o_t_string.html">OTString</a> strEnvelopeContents(theMessage);
<a name="l01635"></a>01635             <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope; <span class="comment">// Seal the string up into an encrypted Envelope</span>
<a name="l01636"></a>01636             theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pServerNym, strEnvelopeContents);
<a name="l01637"></a>01637             <span class="comment">// -----------------------------------</span>
<a name="l01638"></a>01638 
<a name="l01639"></a>01639             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">GetTransportCallback</a>()-&gt;operator()(*pServerContract, theEnvelope);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         } <span class="comment">// if bSendCommand</span>
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 
<a name="l01644"></a>01644         <span class="keywordflow">if</span> ( !opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> ) ) <span class="comment">// If the user selected to enter the OT prompt, then we drop down below... (otherwise return.)</span>
<a name="l01645"></a>01645         {
<a name="l01646"></a>01646             <span class="keywordflow">return</span> 0;
<a name="l01647"></a>01647         }
<a name="l01648"></a>01648     } <span class="comment">// Command line interface (versus below, which is the PROMPT interface.)</span>
<a name="l01649"></a>01649 
<a name="l01650"></a>01650     <span class="comment">// ****************************************************************************</span>
<a name="l01651"></a>01651 
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 
<a name="l01654"></a>01654 
<a name="l01655"></a>01655 
<a name="l01656"></a>01656 
<a name="l01657"></a>01657 
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 
<a name="l01662"></a>01662 
<a name="l01663"></a>01663     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nLOOKING FOR INSTRUCTIONS for the OT COMMAND LINE?\n&quot;</span>
<a name="l01664"></a>01664         <span class="stringliteral">&quot;Try:   quit\n&quot;</span>
<a name="l01665"></a>01665         <span class="stringliteral">&quot;Followed by:  ot -?\n&quot;</span>
<a name="l01666"></a>01666         <span class="stringliteral">&quot;or:    ot -h\n&quot;</span>
<a name="l01667"></a>01667         <span class="stringliteral">&quot;or:    ot --help\n&quot;</span>
<a name="l01668"></a>01668         <span class="stringliteral">&quot;\n&quot;</span>
<a name="l01669"></a>01669         <span class="stringliteral">&quot;(NOW ENTERING OT PROMPT) \n&quot;</span>
<a name="l01670"></a>01670         <span class="stringliteral">&quot;See docs/CLIENT-COMMANDS.txt\n\n&quot;</span>);
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 
<a name="l01673"></a>01673     <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l01674"></a>01674     <span class="comment">//</span>
<a name="l01675"></a>01675     <span class="comment">//  THE OPEN-TRANSACTIONS PROMPT</span>
<a name="l01676"></a>01676     <span class="comment">//</span>
<a name="l01677"></a>01677     <span class="comment">// OT&gt;</span>
<a name="l01678"></a>01678     <span class="comment">//</span>
<a name="l01679"></a>01679     <span class="comment">// Basically, loop:</span>
<a name="l01680"></a>01680     <span class="comment">//</span>
<a name="l01681"></a>01681     <span class="comment">//  1) Present a prompt, and get a user string of input. Wait for that.</span>
<a name="l01682"></a>01682     <span class="comment">//</span>
<a name="l01683"></a>01683     <span class="comment">//  2) Process it out as an OTMessage to the server. It goes down the pipe.</span>
<a name="l01684"></a>01684     <span class="comment">//</span>
<a name="l01685"></a>01685     <span class="comment">//  3) Sleep for 1 second.</span>
<a name="l01686"></a>01686     <span class="comment">//</span>
<a name="l01687"></a>01687     <span class="comment">//  4) Awake and check for messages to be read in response from the server.</span>
<a name="l01688"></a>01688     <span class="comment">//     Loop. As long as there are any responses there, then process and handle</span>
<a name="l01689"></a>01689     <span class="comment">//     them all.</span>
<a name="l01690"></a>01690     <span class="comment">//     Then continue back up to the prompt at step (1).</span>
<a name="l01691"></a>01691 
<a name="l01692"></a>01692 
<a name="l01693"></a>01693 
<a name="l01694"></a>01694     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMyNym = NULL;
<a name="l01695"></a>01695     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = NULL;
<a name="l01696"></a>01696     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServerContract = NULL;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698     <span class="comment">// If we got down here, that means there were no commands on the command line</span>
<a name="l01699"></a>01699     <span class="comment">// (That&#39;s why we dropped into the OT prompt.)</span>
<a name="l01700"></a>01700     <span class="comment">// However, there still may have been OPTIONS -- and if so, we&#39;ll go ahead and</span>
<a name="l01701"></a>01701     <span class="comment">// load the wallet. (If there were NOT ANY OPTIONS, then we do NOT load the wallet,</span>
<a name="l01702"></a>01702     <span class="comment">// although there is a COMMAND for doing that.)</span>
<a name="l01703"></a>01703     <span class="comment">//</span>
<a name="l01704"></a>01704     <span class="keywordflow">if</span> ( (str_ServerID.size() &gt; 0) || (str_MyNym.size() &gt; 0) )
<a name="l01705"></a>01705     {
<a name="l01706"></a>01706         <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym,
<a name="l01707"></a>01707             pMyNym, pWallet, pServerContract))
<a name="l01708"></a>01708         {
<a name="l01709"></a>01709             <span class="keywordflow">return</span> 0;
<a name="l01710"></a>01710         }
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712     <span class="keywordflow">else</span>
<a name="l01713"></a>01713         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nYou may wish to &#39;load&#39; then &#39;stat&#39;.\n&quot;</span>
<a name="l01714"></a>01714         <span class="stringliteral">&quot;(FYI, --server SERVER_ID  and  --mynym NYM_ID  were both valid options.)\n&quot;</span>
<a name="l01715"></a>01715         <span class="stringliteral">&quot;Also, see:  ~/.ot/command-line-ot.opt for defaults.\n&quot;</span>);
<a name="l01716"></a>01716 
<a name="l01717"></a>01717     <span class="comment">// Below this point, pWallet is available and loaded, IF opt-&gt;HasOptions().</span>
<a name="l01718"></a>01718     <span class="comment">// Otherwise, pWallet is NOT loaded, and we&#39;re waiting for the Load command.</span>
<a name="l01719"></a>01719 
<a name="l01720"></a>01720     <span class="comment">// Below this point, pMyNym MIGHT be a valid pointer (if it was specified),</span>
<a name="l01721"></a>01721     <span class="comment">// or MIGHT be NULL. Same with pServerContract. (MIGHT be there.)</span>
<a name="l01722"></a>01722     <span class="comment">//</span>
<a name="l01723"></a>01723     <span class="comment">// ***********************************************************</span>
<a name="l01724"></a>01724 
<a name="l01725"></a>01725     <span class="keywordtype">char</span> buf[200] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01726"></a>01726 
<a name="l01727"></a>01727     int32_t nExpectResponse = 0;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729     <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;Starting client loop.\n&quot;</span>, <a class="code" href="_o_t_server_connection_8hpp.html#afaeb50bea942aef8c7952cdab7fcd91d">OT_CMD_HEADER_SIZE</a>);
<a name="l01730"></a>01730 
<a name="l01731"></a>01731 
<a name="l01732"></a>01732     <span class="comment">// Set the logging level for the network transport code.</span>
<a name="l01733"></a>01733 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l01734"></a>01734 <span class="preprocessor"></span>    <span class="comment">//  XmlRpc::setVerbosity(1);</span>
<a name="l01735"></a>01735 <span class="preprocessor">#endif</span>
<a name="l01736"></a>01736 <span class="preprocessor"></span>
<a name="l01737"></a>01737 
<a name="l01738"></a>01738     <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l01739"></a>01739 
<a name="l01740"></a>01740     <span class="keywordflow">for</span>(;;)
<a name="l01741"></a>01741     {
<a name="l01742"></a>01742         buf[0] = 0; <span class="comment">// Making it fresh again.</span>
<a name="l01743"></a>01743 
<a name="l01744"></a>01744         nExpectResponse = 0;
<a name="l01745"></a>01745 
<a name="l01746"></a>01746         <span class="comment">// 1) Present a prompt, and get a user string of input. Wait for that.</span>
<a name="l01747"></a>01747         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nOT -- WARNING: This prompt is too low-level for you.\nType &#39;quit&#39;, and then try &#39;opentxs help&#39; and &#39;opentxs list&#39;.\n\nOT&gt; &quot;</span>);
<a name="l01748"></a>01748 
<a name="l01749"></a>01749         <span class="keywordflow">if</span> (NULL == fgets(buf, 190, stdin)) <span class="comment">// Leaving myself 10 extra bytes at the end for safety&#39;s sake.</span>
<a name="l01750"></a>01750             <span class="keywordflow">break</span>;
<a name="l01751"></a>01751 
<a name="l01752"></a>01752         <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;.\n..\n...\n....\n.....\n......\n.......\n........\n.........\n..........\n&quot;</span>
<a name="l01753"></a>01753             <span class="stringliteral">&quot;...........\n............\n.............\n&quot;</span>);
<a name="l01754"></a>01754 
<a name="l01755"></a>01755         <span class="comment">// so we can process the user input</span>
<a name="l01756"></a>01756         std::string strLine = buf;
<a name="l01757"></a>01757 
<a name="l01758"></a>01758         <span class="comment">// Load wallet.xml</span>
<a name="l01759"></a>01759         <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;load&quot;</span>) == 0)
<a name="l01760"></a>01760         {
<a name="l01761"></a>01761             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to load wallet.xml...\n&quot;</span>);
<a name="l01762"></a>01762 
<a name="l01763"></a>01763             <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym,
<a name="l01764"></a>01764                 pMyNym, pWallet, pServerContract))
<a name="l01765"></a>01765             {
<a name="l01766"></a>01766                 <span class="keywordflow">return</span> 0;
<a name="l01767"></a>01767             }
<a name="l01768"></a>01768 
<a name="l01769"></a>01769             <span class="keywordflow">continue</span>;
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771 
<a name="l01772"></a>01772         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;\0&#39;</span> == buf[0])
<a name="l01773"></a>01773         {
<a name="l01774"></a>01774             <span class="keywordflow">continue</span>;
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777         <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01778"></a>01778 
<a name="l01779"></a>01779         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;test&quot;</span>) == 0)
<a name="l01780"></a>01780         {
<a name="l01781"></a>01781             std::string strScript =<span class="stringliteral">&quot;print(\&quot;Hello, world\&quot;)&quot;</span>;
<a name="l01782"></a>01782             <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;
<a name="l01783"></a>01783             madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();
<a name="l01784"></a>01784             madeEasy.<a class="code" href="class_o_t___m_e.html#abd1a0c946ffba242d38fc909937a4145">ExecuteScript_ReturnVoid</a>(strScript, <span class="stringliteral">&quot;hardcoded&quot;</span>);
<a name="l01785"></a>01785 
<a name="l01786"></a>01786             <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01787"></a>01787             <span class="comment">/*</span>
<a name="l01788"></a>01788 <span class="comment">            // TODO: Make sure there&#39;s no issues with a known plaintext attack.</span>
<a name="l01789"></a>01789 <span class="comment">            // (Not here, but I am doing a similar thing in OTASCIIArmor to maintain a minimum size,</span>
<a name="l01790"></a>01790 <span class="comment">            // due to a bug in some other library that I can&#39;t recall at this time.)</span>
<a name="l01791"></a>01791 <span class="comment">            //</span>
<a name="l01792"></a>01792 <span class="comment">            const char * szBlah = &quot;Transaction processor featuring Untraceable Digital Cash, &quot;</span>
<a name="l01793"></a>01793 <span class="comment">            &quot;Anonymous Numbered Accounts, Triple-Signed Receipts, Basket Currencies, and Signed &quot;</span>
<a name="l01794"></a>01794 <span class="comment">            &quot;XML Contracts. Also supports cheques, invoices, payment plans, markets with trades, &quot;</span>
<a name="l01795"></a>01795 <span class="comment">            &quot;and other instruments... it&#39;s like PGP for Money.... Uses OpenSSL and Lucre blinded tokens.\n&quot;;</span>
<a name="l01796"></a>01796 <span class="comment"></span>
<a name="l01797"></a>01797 <span class="comment">            OTASCIIArmor theArmoredText(szBlah);</span>
<a name="l01798"></a>01798 <span class="comment">            OTLog::vOutput(0, &quot;Armored text:\n%s\n&quot;, theArmoredText.Get());</span>
<a name="l01799"></a>01799 <span class="comment"></span>
<a name="l01800"></a>01800 <span class="comment">            OTString theFixedText(theArmoredText);</span>
<a name="l01801"></a>01801 <span class="comment">            OTLog::vOutput(0, &quot;Uncompressed, etc text:\n%s\n&quot;, theFixedText.Get());</span>
<a name="l01802"></a>01802 <span class="comment">            */</span>
<a name="l01803"></a>01803 
<a name="l01804"></a>01804             <span class="keywordflow">continue</span>;
<a name="l01805"></a>01805         }
<a name="l01806"></a>01806         <span class="comment">// --------------------------------</span>
<a name="l01807"></a>01807 
<a name="l01808"></a>01808         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,8,<span class="stringliteral">&quot;clearreq&quot;</span>) == 0) <span class="comment">// clear request numbers</span>
<a name="l01809"></a>01809         {
<a name="l01810"></a>01810             <span class="keywordflow">if</span> (NULL == pMyNym)
<a name="l01811"></a>01811             {
<a name="l01812"></a>01812                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available. Try &#39;load&#39;.\n&quot;</span>);
<a name="l01813"></a>01813                 <span class="keywordflow">continue</span>;
<a name="l01814"></a>01814             }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816             <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
<a name="l01817"></a>01817             pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);
<a name="l01818"></a>01818 
<a name="l01819"></a>01819             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (clear your) request numbers.\n&quot;</span>
<a name="l01820"></a>01820                 <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01821"></a>01821 
<a name="l01822"></a>01822             std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01823"></a>01823 
<a name="l01824"></a>01824             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReqNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01825"></a>01825 
<a name="l01826"></a>01826             <span class="comment">// --------------------------------</span>
<a name="l01827"></a>01827 
<a name="l01828"></a>01828             pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1bce78db719b7733ba2a3fb19f963b24">RemoveReqNumbers</a>(&amp;strReqNumServerID);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830             pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pMyNym);
<a name="l01831"></a>01831 
<a name="l01832"></a>01832             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Successfully removed request number for server %s. Saving nym...\n&quot;</span>,
<a name="l01833"></a>01833                 strReqNumServerID.Get());
<a name="l01834"></a>01834             <span class="keywordflow">continue</span>;
<a name="l01835"></a>01835         }
<a name="l01836"></a>01836         <span class="comment">// --------------------------------</span>
<a name="l01837"></a>01837         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,5,<span class="stringliteral">&quot;clear&quot;</span>) == 0)
<a name="l01838"></a>01838         {
<a name="l01839"></a>01839             <span class="keywordflow">if</span> (NULL == pMyNym)
<a name="l01840"></a>01840             {
<a name="l01841"></a>01841                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available. Try &#39;load&#39;.\n&quot;</span>);
<a name="l01842"></a>01842                 <span class="keywordflow">continue</span>;
<a name="l01843"></a>01843             }
<a name="l01844"></a>01844 
<a name="l01845"></a>01845             <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
<a name="l01846"></a>01846             pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);
<a name="l01847"></a>01847 
<a name="l01848"></a>01848             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (clear your) transaction numbers.\n&quot;</span>
<a name="l01849"></a>01849                 <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01850"></a>01850 
<a name="l01851"></a>01851             std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01852"></a>01852 
<a name="l01853"></a>01853             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01854"></a>01854 
<a name="l01855"></a>01855             <span class="comment">// --------------------------------</span>
<a name="l01856"></a>01856 
<a name="l01857"></a>01857             pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a482952f1676f239415215a1835b45f60">RemoveAllNumbers</a>(&amp;strTransNumServerID, <span class="keyword">true</span>); <span class="comment">// bRemoveHighestNum = true.</span>
<a name="l01858"></a>01858             pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pMyNym);
<a name="l01859"></a>01859 
<a name="l01860"></a>01860             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Successfully removed all issued and transaction numbers for server %s. Saving nym...\n&quot;</span>,
<a name="l01861"></a>01861                 strTransNumServerID.Get());
<a name="l01862"></a>01862             <span class="keywordflow">continue</span>;
<a name="l01863"></a>01863         }
<a name="l01864"></a>01864         <span class="comment">// --------------------------------</span>
<a name="l01865"></a>01865         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,7,<span class="stringliteral">&quot;decrypt&quot;</span>) == 0)
<a name="l01866"></a>01866         {
<a name="l01867"></a>01867             <span class="keywordflow">if</span> (NULL == pMyNym)
<a name="l01868"></a>01868             {
<a name="l01869"></a>01869                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available to decrypt with.\n&quot;</span>);
<a name="l01870"></a>01870                 <span class="keywordflow">continue</span>;
<a name="l01871"></a>01871             }
<a name="l01872"></a>01872 
<a name="l01873"></a>01873             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be decrypted:\n&gt; &quot;</span>);
<a name="l01874"></a>01874 
<a name="l01875"></a>01875             <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
<a name="l01876"></a>01876             <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1</span>
<a name="l01877"></a>01877 
<a name="l01878"></a>01878             <span class="keywordflow">do</span> {
<a name="l01879"></a>01879                 decode_buffer[0] = 0;
<a name="l01880"></a>01880                 <span class="keywordflow">if</span> (NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin))
<a name="l01881"></a>01881                 {
<a name="l01882"></a>01882                     theArmoredText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
<a name="l01883"></a>01883                     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
<a name="l01884"></a>01884                 }
<a name="l01885"></a>01885                 <span class="keywordflow">else</span>
<a name="l01886"></a>01886                 {
<a name="l01887"></a>01887                     <span class="keywordflow">break</span>;
<a name="l01888"></a>01888                 }
<a name="l01889"></a>01889             } <span class="keywordflow">while</span> (strlen(decode_buffer)&gt;1);
<a name="l01890"></a>01890 
<a name="l01891"></a>01891 
<a name="l01892"></a>01892             <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>  theEnvelope(theArmoredText);
<a name="l01893"></a>01893             <a class="code" href="class_o_t_string.html">OTString</a>    strDecodedText;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895             theEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(*pMyNym, strDecodedText);
<a name="l01896"></a>01896 
<a name="l01897"></a>01897             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nDECRYPTED TEXT:\n\n%s\n\n&quot;</span>, strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01898"></a>01898 
<a name="l01899"></a>01899             <span class="keywordflow">continue</span>;
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901         <span class="comment">// --------------------------------</span>
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,6,<span class="stringliteral">&quot;decode&quot;</span>) == 0)
<a name="l01904"></a>01904         {
<a name="l01905"></a>01905             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be decoded:\n&gt; &quot;</span>);
<a name="l01906"></a>01906 
<a name="l01907"></a>01907             <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
<a name="l01908"></a>01908             <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>
<a name="l01909"></a>01909 
<a name="l01910"></a>01910             <span class="keywordflow">do</span> {
<a name="l01911"></a>01911                 decode_buffer[0] = 0;
<a name="l01912"></a>01912                 <span class="keywordflow">if</span> (NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin))
<a name="l01913"></a>01913                 {
<a name="l01914"></a>01914                     theArmoredText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
<a name="l01915"></a>01915                     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
<a name="l01916"></a>01916                 }
<a name="l01917"></a>01917                 <span class="keywordflow">else</span>
<a name="l01918"></a>01918                 {
<a name="l01919"></a>01919                     <span class="keywordflow">break</span>;
<a name="l01920"></a>01920                 }
<a name="l01921"></a>01921 
<a name="l01922"></a>01922             } <span class="keywordflow">while</span> (strlen(decode_buffer)&gt;1);
<a name="l01923"></a>01923 
<a name="l01924"></a>01924             <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText(theArmoredText);
<a name="l01925"></a>01925 
<a name="l01926"></a>01926             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nDECODED TEXT:\n\n%s\n\n&quot;</span>, strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01927"></a>01927 
<a name="l01928"></a>01928             <span class="keywordflow">continue</span>;
<a name="l01929"></a>01929         }
<a name="l01930"></a>01930 
<a name="l01931"></a>01931         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,6,<span class="stringliteral">&quot;encode&quot;</span>) == 0)
<a name="l01932"></a>01932         {
<a name="l01933"></a>01933             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be ascii-encoded (terminate with ~ on a new line):\n&gt; &quot;</span>);
<a name="l01934"></a>01934 
<a name="l01935"></a>01935             <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText;
<a name="l01936"></a>01936             <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>
<a name="l01937"></a>01937 
<a name="l01938"></a>01938             <span class="keywordflow">do</span> {
<a name="l01939"></a>01939                 decode_buffer[0] = 0;
<a name="l01940"></a>01940 
<a name="l01941"></a>01941                 <span class="keywordflow">if</span> ((NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin)) &amp;&amp;
<a name="l01942"></a>01942                     (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>))
<a name="l01943"></a>01943                 {
<a name="l01944"></a>01944                     strDecodedText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s&quot;</span>, decode_buffer);
<a name="l01945"></a>01945                     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
<a name="l01946"></a>01946                 }
<a name="l01947"></a>01947                 <span class="keywordflow">else</span>
<a name="l01948"></a>01948                 {
<a name="l01949"></a>01949                     <span class="keywordflow">break</span>;
<a name="l01950"></a>01950                 }
<a name="l01951"></a>01951 
<a name="l01952"></a>01952             } <span class="keywordflow">while</span> (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>);
<a name="l01953"></a>01953 
<a name="l01954"></a>01954             <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText(strDecodedText);
<a name="l01955"></a>01955 
<a name="l01956"></a>01956             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nENCODED TEXT:\n\n%s\n\n&quot;</span>, theArmoredText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01957"></a>01957 
<a name="l01958"></a>01958             <span class="keywordflow">continue</span>;
<a name="l01959"></a>01959         }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;hash&quot;</span>) == 0)
<a name="l01962"></a>01962         {
<a name="l01963"></a>01963             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be hashed (terminate with ~ on a new line):\n&gt; &quot;</span>);
<a name="l01964"></a>01964 
<a name="l01965"></a>01965             <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText;
<a name="l01966"></a>01966             <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>
<a name="l01967"></a>01967 
<a name="l01968"></a>01968             <span class="keywordflow">do</span> {
<a name="l01969"></a>01969                 decode_buffer[0] = 0;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971                 <span class="keywordflow">if</span> ((NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin)) &amp;&amp;
<a name="l01972"></a>01972                     (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>))
<a name="l01973"></a>01973                 {
<a name="l01974"></a>01974                     strDecodedText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
<a name="l01975"></a>01975                     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
<a name="l01976"></a>01976                 }
<a name="l01977"></a>01977                 <span class="keywordflow">else</span>
<a name="l01978"></a>01978                 {
<a name="l01979"></a>01979                     <span class="keywordflow">break</span>;
<a name="l01980"></a>01980                 }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982             } <span class="keywordflow">while</span> (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>);
<a name="l01983"></a>01983 
<a name="l01984"></a>01984 
<a name="l01985"></a>01985             std::string str_Trim(strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01986"></a>01986             std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01987"></a>01987             strDecodedText.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(str_Trim2.c_str());
<a name="l01988"></a>01988 
<a name="l01989"></a>01989             <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theIdentifier;
<a name="l01990"></a>01990             theIdentifier.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(strDecodedText);
<a name="l01991"></a>01991 
<a name="l01992"></a>01992             <a class="code" href="class_o_t_string.html">OTString</a> strHash(theIdentifier);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nMESSAGE DIGEST:\n\n%s\n\n&quot;</span>, strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01995"></a>01995 
<a name="l01996"></a>01996             <span class="keywordflow">continue</span>;
<a name="l01997"></a>01997         }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;stat&quot;</span>) == 0)
<a name="l02000"></a>02000         {
<a name="l02001"></a>02001             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display wallet contents...\n&quot;</span>);
<a name="l02002"></a>02002 
<a name="l02003"></a>02003             <span class="keywordflow">if</span> (pWallet)
<a name="l02004"></a>02004             {
<a name="l02005"></a>02005                 <a class="code" href="class_o_t_string.html">OTString</a> strStat;
<a name="l02006"></a>02006                 pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aed7e71a27cd1442399f16acd6b191372">DisplayStatistics</a>(strStat);
<a name="l02007"></a>02007                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s\n&quot;</span>, strStat.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02008"></a>02008             }
<a name="l02009"></a>02009             <span class="keywordflow">else</span>
<a name="l02010"></a>02010                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No wallet is loaded...\n&quot;</span>);
<a name="l02011"></a>02011 
<a name="l02012"></a>02012             <span class="keywordflow">continue</span>;
<a name="l02013"></a>02013         }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;help&quot;</span>) == 0)
<a name="l02016"></a>02016         {
<a name="l02017"></a>02017             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display the help file...\nPlease see this file: docs/CLIENT_COMMANDS.txt\n&quot;</span>);
<a name="l02018"></a>02018 
<a name="l02019"></a>02019             <span class="keywordflow">continue</span>;
<a name="l02020"></a>02020         }
<a name="l02021"></a>02021 
<a name="l02022"></a>02022         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;quit&quot;</span>) == 0)
<a name="l02023"></a>02023         {
<a name="l02024"></a>02024             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to exit the wallet...\n&quot;</span>);
<a name="l02025"></a>02025 
<a name="l02026"></a>02026             <span class="keywordflow">break</span>;
<a name="l02027"></a>02027         }
<a name="l02028"></a>02028 
<a name="l02029"></a>02029 
<a name="l02030"></a>02030         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02031"></a>02031 
<a name="l02032"></a>02032         <span class="comment">/*</span>
<a name="l02033"></a>02033 <span class="comment">        --myacct   (ACCT ID)</span>
<a name="l02034"></a>02034 <span class="comment">        --mynym    (NYM ID)</span>
<a name="l02035"></a>02035 <span class="comment">        --mypurse  (ASSET TYPE ID)</span>
<a name="l02036"></a>02036 <span class="comment"></span>
<a name="l02037"></a>02037 <span class="comment">        --toacct   (ACCT ID)</span>
<a name="l02038"></a>02038 <span class="comment">        --tonym    (NYM ID)</span>
<a name="l02039"></a>02039 <span class="comment">        --topurse  (ASSET TYPE ID)</span>
<a name="l02040"></a>02040 <span class="comment"></span>
<a name="l02041"></a>02041 <span class="comment">        OTPseudonym *       GetNymByIDPartialMatch(const std::string PARTIAL_ID);</span>
<a name="l02042"></a>02042 <span class="comment">        OTServerContract *  GetServerContractPartialMatch(const std::string PARTIAL_ID);</span>
<a name="l02043"></a>02043 <span class="comment">        OTAssetContract *   GetAssetContractPartialMatch(const std::string PARTIAL_ID);</span>
<a name="l02044"></a>02044 <span class="comment">        OTAccount *         GetAccountPartialMatch(const std::string PARTIAL_ID);</span>
<a name="l02045"></a>02045 <span class="comment">        */</span>
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 
<a name="l02048"></a>02048         <span class="keywordflow">if</span> (NULL == pServerContract)
<a name="l02049"></a>02049         {
<a name="l02050"></a>02050             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract. Please restart using the option:  --server SERVER_ID\n&quot;</span>
<a name="l02051"></a>02051                 <span class="stringliteral">&quot;(Where SERVER_ID is the server ID. Partial matches ARE accepted.)\n&quot;</span>);
<a name="l02052"></a>02052             <span class="keywordflow">continue</span>;
<a name="l02053"></a>02053         }
<a name="l02054"></a>02054 
<a name="l02055"></a>02055 
<a name="l02056"></a>02056         <span class="comment">// You can&#39;t just connect to any hostname and port.</span>
<a name="l02057"></a>02057         <span class="comment">// Instead, you give me the Server Contract, and *I&#39;ll* look up all that stuff FOR you...</span>
<a name="l02058"></a>02058         <span class="comment">// (We verify this up here, but use it at the bottom of the function once the message is set up.)</span>
<a name="l02059"></a>02059         <span class="comment">//</span>
<a name="l02060"></a>02060 <span class="comment">//      int32_t         nServerPort = 0;</span>
<a name="l02061"></a>02061 <span class="comment">//      OTString    strServerHostname;</span>
<a name="l02062"></a>02062 <span class="comment">//</span>
<a name="l02063"></a>02063 <span class="comment">//      if (false == pServerContract-&gt;GetConnectInfo(strServerHostname, nServerPort))</span>
<a name="l02064"></a>02064 <span class="comment">//      {</span>
<a name="l02065"></a>02065 <span class="comment">//          OTLog::Error(&quot;Failed retrieving connection info from server contract.\n&quot;);</span>
<a name="l02066"></a>02066 <span class="comment">//          continue;</span>
<a name="l02067"></a>02067 <span class="comment">//      }</span>
<a name="l02068"></a>02068 
<a name="l02069"></a>02069         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02070"></a>02070 
<a name="l02071"></a>02071         <span class="comment">// I put this here too since I think it&#39;s required in all cases below.</span>
<a name="l02072"></a>02072         <span class="comment">//</span>
<a name="l02073"></a>02073         <span class="keywordflow">if</span> (NULL == pMyNym) <span class="comment">// Todo maybe move this check to the commands below (ONLY the ones that use a nym.)</span>
<a name="l02074"></a>02074         {
<a name="l02075"></a>02075             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find My Nym. Please restart and use the option:\n&quot;</span>
<a name="l02076"></a>02076                 <span class="stringliteral">&quot;   --mynym USER_ID\n&quot;</span>
<a name="l02077"></a>02077                 <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches ARE accepted.)\n&quot;</span>);
<a name="l02078"></a>02078             <span class="keywordflow">continue</span>;
<a name="l02079"></a>02079         }
<a name="l02080"></a>02080 
<a name="l02081"></a>02081         <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02082"></a>02082 
<a name="l02083"></a>02083         <span class="keywordtype">bool</span> bSendCommand   = <span class="keyword">false</span>; <span class="comment">// Determines whether to actually send a message to the server.</span>
<a name="l02084"></a>02084 
<a name="l02085"></a>02085         <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087         <span class="comment">// If we can match the user&#39;s request to a client command,</span>
<a name="l02088"></a>02088         <span class="comment">// AND theClient object is able to process that request into</span>
<a name="l02089"></a>02089         <span class="comment">// theMessage, then we send it down the pipe.</span>
<a name="l02090"></a>02090 
<a name="l02091"></a>02091         <span class="comment">// *******************************************************************************</span>
<a name="l02092"></a>02092 
<a name="l02093"></a>02093 
<a name="l02094"></a>02094         <span class="comment">// In lieu of maintaining a constant connection to the server, in RPC mode, the</span>
<a name="l02095"></a>02095         <span class="comment">// client updates its internal &quot;connection&quot; object to make sure the right pointers</span>
<a name="l02096"></a>02096         <span class="comment">// are in place (since in RPC mode, each message could be from a different nym</span>
<a name="l02097"></a>02097         <span class="comment">// and to a different server.)</span>
<a name="l02098"></a>02098         <span class="comment">//</span>
<a name="l02099"></a>02099         <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServerContract, *pMyNym, <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetTransportCallback());
<a name="l02100"></a>02100         <span class="comment">// NOTE -- This MAY be unnecessary for ProcessUserCommand (since these args are passed</span>
<a name="l02101"></a>02101         <span class="comment">// in there already) but it&#39;s definitely necessary soon after for ProcessServerReply()</span>
<a name="l02102"></a>02102         <span class="comment">// (which comes next.)</span>
<a name="l02103"></a>02103 
<a name="l02104"></a>02104         <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l02105"></a>02105 
<a name="l02106"></a>02106         <span class="comment">// &#39;check server ID&#39; command</span>
<a name="l02107"></a>02107         <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;c&#39;</span>)
<a name="l02108"></a>02108         {
<a name="l02109"></a>02109             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;(User has instructed to send a checkServerID command to the server...)\n&quot;</span>);
<a name="l02110"></a>02110 
<a name="l02111"></a>02111             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02112"></a>02112             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02113"></a>02113 
<a name="l02114"></a>02114             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a89596b609fbd84aa6151ca9d1b107c13">OTClient::checkServerID</a>, theMessage,
<a name="l02115"></a>02115                 *pMyNym, *pServerContract,
<a name="l02116"></a>02116                 NULL)) <span class="comment">// NULL pAccount on this command (so far).</span>
<a name="l02117"></a>02117             {
<a name="l02118"></a>02118                 bSendCommand = <span class="keyword">true</span>;
<a name="l02119"></a>02119             }
<a name="l02120"></a>02120             <span class="keywordflow">else</span>
<a name="l02121"></a>02121                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing checkServerID command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02122"></a>02122             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02123"></a>02123         }
<a name="l02124"></a>02124 
<a name="l02125"></a>02125         <span class="comment">// register new user account</span>
<a name="l02126"></a>02126         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;r&#39;</span>)
<a name="l02127"></a>02127         {
<a name="l02128"></a>02128             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a createUserAccount command to the server...)\n&quot;</span>);
<a name="l02129"></a>02129 
<a name="l02130"></a>02130             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02131"></a>02131             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02132"></a>02132 
<a name="l02133"></a>02133             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afb333a78adbe626a0dc596eed05f63f2">OTClient::createUserAccount</a>, theMessage,
<a name="l02134"></a>02134                 *pMyNym, *pServerContract,
<a name="l02135"></a>02135                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02136"></a>02136             {
<a name="l02137"></a>02137                 bSendCommand = <span class="keyword">true</span>;
<a name="l02138"></a>02138             }
<a name="l02139"></a>02139             <span class="keywordflow">else</span>
<a name="l02140"></a>02140                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing createUserAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02141"></a>02141             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02142"></a>02142         }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144         <span class="comment">// ALL MESSAGES BELOW THIS POINT SHOULD ATTACH A REQUEST NUMBER IF THEY EXPECT THE SERVER TO PROCESS THEM.</span>
<a name="l02145"></a>02145         <span class="comment">// (Handled inside ProcessUserCommand)</span>
<a name="l02146"></a>02146 
<a name="l02147"></a>02147         <span class="comment">// checkUser</span>
<a name="l02148"></a>02148         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;u&#39;</span>)
<a name="l02149"></a>02149         {
<a name="l02150"></a>02150             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a checkUser command to the server...)\n&quot;</span>);
<a name="l02151"></a>02151 
<a name="l02152"></a>02152             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02153"></a>02153             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02154"></a>02154 
<a name="l02155"></a>02155             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a29479df423e07d29409fc18b20862871">OTClient::checkUser</a>, theMessage,
<a name="l02156"></a>02156                 *pMyNym, *pServerContract,
<a name="l02157"></a>02157                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02158"></a>02158             {
<a name="l02159"></a>02159                 bSendCommand = <span class="keyword">true</span>;
<a name="l02160"></a>02160             }
<a name="l02161"></a>02161             <span class="keywordflow">else</span>
<a name="l02162"></a>02162                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing checkUser command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02163"></a>02163             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02164"></a>02164         }
<a name="l02165"></a>02165 
<a name="l02166"></a>02166         <span class="comment">// register new asset account</span>
<a name="l02167"></a>02167         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;a&#39;</span>)
<a name="l02168"></a>02168         {
<a name="l02169"></a>02169             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a createAccount command to the server...)\n&quot;</span>);
<a name="l02170"></a>02170 
<a name="l02171"></a>02171             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02172"></a>02172             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02173"></a>02173 
<a name="l02174"></a>02174             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aab742ba1837ac9ac107806ba97b66e13">OTClient::createAccount</a>, theMessage,
<a name="l02175"></a>02175                 *pMyNym, *pServerContract,
<a name="l02176"></a>02176                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02177"></a>02177             {
<a name="l02178"></a>02178                 bSendCommand = <span class="keyword">true</span>;
<a name="l02179"></a>02179             }
<a name="l02180"></a>02180             <span class="keywordflow">else</span>
<a name="l02181"></a>02181                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing createAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02182"></a>02182             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02183"></a>02183         }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185         <span class="comment">// issue a new asset type</span>
<a name="l02186"></a>02186         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;issue\n&quot;</span>))
<a name="l02187"></a>02187         {
<a name="l02188"></a>02188             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an issueAssetType command to the server...)\n&quot;</span>);
<a name="l02189"></a>02189 
<a name="l02190"></a>02190             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02191"></a>02191             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02192"></a>02192 
<a name="l02193"></a>02193             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a7d1c1bcc58abf8b966d3abf5736f3eee">OTClient::issueAssetType</a>, theMessage,
<a name="l02194"></a>02194                 *pMyNym, *pServerContract,
<a name="l02195"></a>02195                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02196"></a>02196             {
<a name="l02197"></a>02197                 bSendCommand = <span class="keyword">true</span>;
<a name="l02198"></a>02198             }
<a name="l02199"></a>02199             <span class="keywordflow">else</span>
<a name="l02200"></a>02200                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing issueAssetType command in ProcessMessage: %s\n&quot;</span>, buf);
<a name="l02201"></a>02201             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02202"></a>02202         }
<a name="l02203"></a>02203 
<a name="l02204"></a>02204         <span class="comment">// issue a new basket asset type</span>
<a name="l02205"></a>02205         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;basket\n&quot;</span>))
<a name="l02206"></a>02206         {
<a name="l02207"></a>02207             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an issueBasket command to the server...)\n&quot;</span>);
<a name="l02208"></a>02208 
<a name="l02209"></a>02209             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02210"></a>02210             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02211"></a>02211 
<a name="l02212"></a>02212             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a92257b2272c666c28d7b73b4376636c3">OTClient::issueBasket</a>, theMessage,
<a name="l02213"></a>02213                 *pMyNym, *pServerContract,
<a name="l02214"></a>02214                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02215"></a>02215             {
<a name="l02216"></a>02216                 bSendCommand = <span class="keyword">true</span>;
<a name="l02217"></a>02217             }
<a name="l02218"></a>02218             <span class="keywordflow">else</span>
<a name="l02219"></a>02219                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing issueBasket command in ProcessMessage: %s\n&quot;</span>, buf);
<a name="l02220"></a>02220             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02221"></a>02221         }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223         <span class="comment">// exchange in/out of a basket currency</span>
<a name="l02224"></a>02224         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;exchange\n&quot;</span>))
<a name="l02225"></a>02225         {
<a name="l02226"></a>02226             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an exchangeBasket command to the server...)\n&quot;</span>);
<a name="l02227"></a>02227 
<a name="l02228"></a>02228             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02229"></a>02229             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02230"></a>02230 
<a name="l02231"></a>02231             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7af5d28fce545520f3fba25ca7e51f8374">OTClient::exchangeBasket</a>, theMessage,
<a name="l02232"></a>02232                 *pMyNym, *pServerContract,
<a name="l02233"></a>02233                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02234"></a>02234             {
<a name="l02235"></a>02235                 bSendCommand = <span class="keyword">true</span>;
<a name="l02236"></a>02236             }
<a name="l02237"></a>02237             <span class="keywordflow">else</span>
<a name="l02238"></a>02238                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing exchangeBasket command in ProcessMessage: %s\n&quot;</span>, buf);
<a name="l02239"></a>02239             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02240"></a>02240         }
<a name="l02241"></a>02241 
<a name="l02242"></a>02242         <span class="comment">// make an offer and put it onto a market.</span>
<a name="l02243"></a>02243         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;offer\n&quot;</span>))
<a name="l02244"></a>02244         {
<a name="l02245"></a>02245             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a marketOffer command to the server...)\n&quot;</span>);
<a name="l02246"></a>02246 
<a name="l02247"></a>02247             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02248"></a>02248             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02249"></a>02249 
<a name="l02250"></a>02250             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aa3e1744621c050d38a934d77749d891e">OTClient::marketOffer</a>, theMessage,
<a name="l02251"></a>02251                 *pMyNym, *pServerContract,
<a name="l02252"></a>02252                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02253"></a>02253             {
<a name="l02254"></a>02254                 bSendCommand = <span class="keyword">true</span>;
<a name="l02255"></a>02255             }
<a name="l02256"></a>02256             <span class="keywordflow">else</span>
<a name="l02257"></a>02257                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing marketOffer command in ProcessMessage: %s\n&quot;</span>, buf);
<a name="l02258"></a>02258             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02259"></a>02259         }
<a name="l02260"></a>02260 
<a name="l02261"></a>02261         <span class="comment">// Set a Server Contract&#39;s client-side name (merely a label.)</span>
<a name="l02262"></a>02262         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setservername\n&quot;</span>))
<a name="l02263"></a>02263         {
<a name="l02264"></a>02264             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set a Server Contract&#39;s client-side name...)\n&quot;</span>);
<a name="l02265"></a>02265 
<a name="l02266"></a>02266             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02267"></a>02267             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02268"></a>02268 
<a name="l02269"></a>02269             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7abac2774f1d2494b6e545436b9b39b5b2">OTClient::setServerName</a>, theMessage,
<a name="l02270"></a>02270                 *pMyNym, *pServerContract,
<a name="l02271"></a>02271                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02272"></a>02272             {
<a name="l02273"></a>02273                 <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
<a name="l02274"></a>02274             }
<a name="l02275"></a>02275             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02276"></a>02276         }
<a name="l02277"></a>02277 
<a name="l02278"></a>02278         <span class="comment">// Set an Asset Contract&#39;s client-side name (merely a label.)</span>
<a name="l02279"></a>02279         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setassetname\n&quot;</span>))
<a name="l02280"></a>02280         {
<a name="l02281"></a>02281             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set an Asset Contract&#39;s client-side name...)\n&quot;</span>);
<a name="l02282"></a>02282 
<a name="l02283"></a>02283             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02284"></a>02284             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02285"></a>02285 
<a name="l02286"></a>02286             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5a1a6394ec07704c99303e9e5fafd96f">OTClient::setAssetName</a>, theMessage,
<a name="l02287"></a>02287                 *pMyNym, *pServerContract,
<a name="l02288"></a>02288                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02289"></a>02289             {
<a name="l02290"></a>02290                 <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
<a name="l02291"></a>02291             }
<a name="l02292"></a>02292             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02293"></a>02293         }
<a name="l02294"></a>02294 
<a name="l02295"></a>02295         <span class="comment">// Set a Nym&#39;s client-side name (merely a label.)</span>
<a name="l02296"></a>02296         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setnymname\n&quot;</span>))
<a name="l02297"></a>02297         {
<a name="l02298"></a>02298             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set a Nym&#39;s client-side name...)\n&quot;</span>);
<a name="l02299"></a>02299 
<a name="l02300"></a>02300             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02301"></a>02301             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02302"></a>02302 
<a name="l02303"></a>02303             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a00d77f12e9e7f03560b1554f74c1eae5">OTClient::setNymName</a>, theMessage,
<a name="l02304"></a>02304                 *pMyNym, *pServerContract,
<a name="l02305"></a>02305                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02306"></a>02306             {
<a name="l02307"></a>02307                 <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
<a name="l02308"></a>02308             }
<a name="l02309"></a>02309             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02310"></a>02310         }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312         <span class="comment">// Set an Asset Account&#39;s client-side name (merely a label.)</span>
<a name="l02313"></a>02313         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setaccountname\n&quot;</span>))
<a name="l02314"></a>02314         {
<a name="l02315"></a>02315             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set an Asset Account&#39;s client-side name...)\n&quot;</span>);
<a name="l02316"></a>02316 
<a name="l02317"></a>02317             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02318"></a>02318             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02319"></a>02319 
<a name="l02320"></a>02320             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a408a59824c97ac7fed449e944f950da9">OTClient::setAccountName</a>, theMessage,
<a name="l02321"></a>02321                 *pMyNym, *pServerContract,
<a name="l02322"></a>02322                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02323"></a>02323             {
<a name="l02324"></a>02324                 <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
<a name="l02325"></a>02325             }
<a name="l02326"></a>02326 
<a name="l02327"></a>02327             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02328"></a>02328         }
<a name="l02329"></a>02329 
<a name="l02330"></a>02330         <span class="comment">// sign contract</span>
<a name="l02331"></a>02331         <span class="comment">// This doesn&#39;t message the server, but it DOES require the user&#39;s Nym to be loaded.</span>
<a name="l02332"></a>02332         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;signcontract\n&quot;</span>))
<a name="l02333"></a>02333         {
<a name="l02334"></a>02334             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to sign a contract...)\n&quot;</span>);
<a name="l02335"></a>02335 
<a name="l02336"></a>02336             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac5c8e57a658c61b11369d11204b73cbd">OTClient::signContract</a>, theMessage,
<a name="l02337"></a>02337                 *pMyNym, *pServerContract,
<a name="l02338"></a>02338                 NULL);
<a name="l02339"></a>02339             <span class="keywordflow">continue</span>;
<a name="l02340"></a>02340         }
<a name="l02341"></a>02341 
<a name="l02342"></a>02342         <span class="comment">// sendUserMessage</span>
<a name="l02343"></a>02343         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;s&#39;</span>)
<a name="l02344"></a>02344         {
<a name="l02345"></a>02345             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a sendUserMessage command to the server...)\n&quot;</span>);
<a name="l02346"></a>02346 
<a name="l02347"></a>02347             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02348"></a>02348             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02349"></a>02349 
<a name="l02350"></a>02350             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aca0882f708bf1fc33dfc9768b0ed956b">OTClient::sendUserMessage</a>, theMessage,
<a name="l02351"></a>02351                 *pMyNym, *pServerContract,
<a name="l02352"></a>02352                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02353"></a>02353             {
<a name="l02354"></a>02354                 bSendCommand = <span class="keyword">true</span>;
<a name="l02355"></a>02355             }
<a name="l02356"></a>02356             <span class="keywordflow">else</span>
<a name="l02357"></a>02357                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing sendUserMessage command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02358"></a>02358             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02359"></a>02359         }
<a name="l02360"></a>02360 
<a name="l02361"></a>02361         <span class="comment">// process nymbox</span>
<a name="l02362"></a>02362         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,2,<span class="stringliteral">&quot;py&quot;</span>) == 0)
<a name="l02363"></a>02363         {
<a name="l02364"></a>02364             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a processNymbox command to the server...)\n&quot;</span>);
<a name="l02365"></a>02365 
<a name="l02366"></a>02366             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02367"></a>02367             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02368"></a>02368 
<a name="l02369"></a>02369             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a371b16fad327b8e308761027a59e4a00">OTClient::processEntireNymbox</a>, theMessage,
<a name="l02370"></a>02370                 *pMyNym, *pServerContract,
<a name="l02371"></a>02371                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02372"></a>02372             {
<a name="l02373"></a>02373                 bSendCommand = <span class="keyword">true</span>;
<a name="l02374"></a>02374             }
<a name="l02375"></a>02375             <span class="keywordflow">else</span>
<a name="l02376"></a>02376                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error in processNymbox command in ProcessMessage: %s\n&quot;</span>, strLine.c_str());
<a name="l02377"></a>02377             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02378"></a>02378         }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380         <span class="comment">// get nymbox</span>
<a name="l02381"></a>02381         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;y&#39;</span>)
<a name="l02382"></a>02382         {
<a name="l02383"></a>02383             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getNymbox command to the server...)\n&quot;</span>);
<a name="l02384"></a>02384 
<a name="l02385"></a>02385             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02386"></a>02386             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02387"></a>02387 
<a name="l02388"></a>02388             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a81f19a83547bbc089eb7efa134c9e22a">OTClient::getNymbox</a>, theMessage,
<a name="l02389"></a>02389                 *pMyNym, *pServerContract,
<a name="l02390"></a>02390                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02391"></a>02391             {
<a name="l02392"></a>02392                 bSendCommand = <span class="keyword">true</span>;
<a name="l02393"></a>02393             }
<a name="l02394"></a>02394             <span class="keywordflow">else</span>
<a name="l02395"></a>02395                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getNymbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02396"></a>02396             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02397"></a>02397         }
<a name="l02398"></a>02398 
<a name="l02399"></a>02399         <span class="comment">// Nym, Account, Server ID, Server Contract</span>
<a name="l02400"></a>02400 
<a name="l02401"></a>02401         <span class="comment">// process inbox</span>
<a name="l02402"></a>02402         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,2,<span class="stringliteral">&quot;pi&quot;</span>) == 0)
<a name="l02403"></a>02403         {
<a name="l02404"></a>02404             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a processInbox command to the server...)\n&quot;</span>);
<a name="l02405"></a>02405 
<a name="l02406"></a>02406             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02407"></a>02407             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02408"></a>02408 
<a name="l02409"></a>02409             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ae5da54e97abe09fdebbf73f36a957222">OTClient::processEntireInbox</a>, theMessage,
<a name="l02410"></a>02410                 *pMyNym, *pServerContract,
<a name="l02411"></a>02411                 NULL)) <span class="comment">// have to allow this to be defaulted at some point...</span>
<a name="l02412"></a>02412             {
<a name="l02413"></a>02413                 bSendCommand = <span class="keyword">true</span>;
<a name="l02414"></a>02414             }
<a name="l02415"></a>02415             <span class="keywordflow">else</span>
<a name="l02416"></a>02416                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error in processInbox command in ProcessMessage: %s\n&quot;</span>, strLine.c_str());
<a name="l02417"></a>02417             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02418"></a>02418         }
<a name="l02419"></a>02419 
<a name="l02420"></a>02420         <span class="comment">// get inbox</span>
<a name="l02421"></a>02421         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;i&#39;</span>)
<a name="l02422"></a>02422         {
<a name="l02423"></a>02423             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getInbox command to the server...)\n&quot;</span>);
<a name="l02424"></a>02424 
<a name="l02425"></a>02425             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02426"></a>02426             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02427"></a>02427 
<a name="l02428"></a>02428             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9072509cb34ebc5805957ebeb0866d76">OTClient::getInbox</a>, theMessage,
<a name="l02429"></a>02429                 *pMyNym, *pServerContract,
<a name="l02430"></a>02430                 NULL))
<a name="l02431"></a>02431             {
<a name="l02432"></a>02432                 bSendCommand = <span class="keyword">true</span>;
<a name="l02433"></a>02433             }
<a name="l02434"></a>02434             <span class="keywordflow">else</span>
<a name="l02435"></a>02435                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getInbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02436"></a>02436             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02437"></a>02437         }
<a name="l02438"></a>02438 
<a name="l02439"></a>02439         <span class="comment">// get outbox</span>
<a name="l02440"></a>02440         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;o&#39;</span>)
<a name="l02441"></a>02441         {
<a name="l02442"></a>02442             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getOutbox command to the server...)\n&quot;</span>);
<a name="l02443"></a>02443 
<a name="l02444"></a>02444             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02445"></a>02445             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02446"></a>02446 
<a name="l02447"></a>02447             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5711ae103a3c7b16a3769fd95b907113">OTClient::getOutbox</a>, theMessage,
<a name="l02448"></a>02448                 *pMyNym, *pServerContract,
<a name="l02449"></a>02449                 NULL))
<a name="l02450"></a>02450             {
<a name="l02451"></a>02451                 bSendCommand = <span class="keyword">true</span>;
<a name="l02452"></a>02452             }
<a name="l02453"></a>02453             <span class="keywordflow">else</span>
<a name="l02454"></a>02454                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getOutbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02455"></a>02455             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02456"></a>02456         }
<a name="l02457"></a>02457 
<a name="l02458"></a>02458         <span class="comment">// deposit cheque</span>
<a name="l02459"></a>02459         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;q&#39;</span>)
<a name="l02460"></a>02460         {
<a name="l02461"></a>02461             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to deposit a cheque...\n&quot;</span>);
<a name="l02462"></a>02462 
<a name="l02463"></a>02463             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02464"></a>02464             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02465"></a>02465 
<a name="l02466"></a>02466             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a393f2048b156f634595bd6d628c80209">OTClient::notarizeCheque</a>, theMessage,
<a name="l02467"></a>02467                 *pMyNym, *pServerContract,
<a name="l02468"></a>02468                 NULL))
<a name="l02469"></a>02469             {
<a name="l02470"></a>02470                 bSendCommand = <span class="keyword">true</span>;
<a name="l02471"></a>02471             }
<a name="l02472"></a>02472             <span class="keywordflow">else</span>
<a name="l02473"></a>02473                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit cheque command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02474"></a>02474             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476 
<a name="l02477"></a>02477         <span class="comment">// deposit purse</span>
<a name="l02478"></a>02478         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;p&#39;</span>)
<a name="l02479"></a>02479         {
<a name="l02480"></a>02480             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a purse containing cash...)\n&quot;</span>);
<a name="l02481"></a>02481 
<a name="l02482"></a>02482             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02483"></a>02483             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02484"></a>02484 
<a name="l02485"></a>02485             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9f04f3ee9323ef6ab4319c78a6139506">OTClient::notarizePurse</a>, theMessage,
<a name="l02486"></a>02486                 *pMyNym, *pServerContract,
<a name="l02487"></a>02487                 NULL))
<a name="l02488"></a>02488             {
<a name="l02489"></a>02489                 bSendCommand = <span class="keyword">true</span>;
<a name="l02490"></a>02490             }
<a name="l02491"></a>02491             <span class="keywordflow">else</span>
<a name="l02492"></a>02492                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02493"></a>02493             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02494"></a>02494         }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496         <span class="comment">// deposit tokens</span>
<a name="l02497"></a>02497         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;d&#39;</span>)
<a name="l02498"></a>02498         {
<a name="l02499"></a>02499             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit cash tokens...)\n&quot;</span>);
<a name="l02500"></a>02500 
<a name="l02501"></a>02501             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02502"></a>02502             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02503"></a>02503 
<a name="l02504"></a>02504             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac0d3b6c44604abdd3b07bab8e69ea602">OTClient::notarizeDeposit</a>, theMessage,
<a name="l02505"></a>02505                 *pMyNym, *pServerContract,
<a name="l02506"></a>02506                 NULL))
<a name="l02507"></a>02507             {
<a name="l02508"></a>02508                 bSendCommand = <span class="keyword">true</span>;
<a name="l02509"></a>02509             }
<a name="l02510"></a>02510             <span class="keywordflow">else</span>
<a name="l02511"></a>02511                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02512"></a>02512             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02513"></a>02513         }
<a name="l02514"></a>02514 
<a name="l02515"></a>02515         <span class="comment">// withdraw voucher</span>
<a name="l02516"></a>02516         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;v&#39;</span>)
<a name="l02517"></a>02517         {
<a name="l02518"></a>02518             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to withdraw a voucher (like a cashier&#39;s cheque)...\n&quot;</span>);
<a name="l02519"></a>02519 
<a name="l02520"></a>02520             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02521"></a>02521             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02522"></a>02522 
<a name="l02523"></a>02523             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac31b4267e60dbdc9c28b5c7ba8fde62c">OTClient::withdrawVoucher</a>, theMessage,
<a name="l02524"></a>02524                 *pMyNym, *pServerContract,
<a name="l02525"></a>02525                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02526"></a>02526             {
<a name="l02527"></a>02527                 bSendCommand = <span class="keyword">true</span>;
<a name="l02528"></a>02528             }
<a name="l02529"></a>02529             <span class="keywordflow">else</span>
<a name="l02530"></a>02530                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing withdraw voucher command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02531"></a>02531             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02532"></a>02532         }
<a name="l02533"></a>02533 
<a name="l02534"></a>02534         <span class="comment">// withdraw cash</span>
<a name="l02535"></a>02535         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;w&#39;</span>)
<a name="l02536"></a>02536         {
<a name="l02537"></a>02537             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw cash...)\n&quot;</span>);
<a name="l02538"></a>02538 
<a name="l02539"></a>02539             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02540"></a>02540             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02541"></a>02541 
<a name="l02542"></a>02542             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a6a1880142e9d121429e7a48189e82654">OTClient::notarizeWithdrawal</a>, theMessage,
<a name="l02543"></a>02543                 *pMyNym, *pServerContract,
<a name="l02544"></a>02544                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02545"></a>02545             {
<a name="l02546"></a>02546                 bSendCommand = <span class="keyword">true</span>;
<a name="l02547"></a>02547             }
<a name="l02548"></a>02548             <span class="keywordflow">else</span>
<a name="l02549"></a>02549                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing withdraw command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02550"></a>02550             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02551"></a>02551         }
<a name="l02552"></a>02552 
<a name="l02553"></a>02553         <span class="comment">// activate payment plan</span>
<a name="l02554"></a>02554         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;activate\n&quot;</span>))
<a name="l02555"></a>02555         {
<a name="l02556"></a>02556             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to activate a payment plan...\n&quot;</span>);
<a name="l02557"></a>02557 
<a name="l02558"></a>02558             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02559"></a>02559             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02560"></a>02560 
<a name="l02561"></a>02561             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab70cae2211349300334a71529c942b75">OTClient::paymentPlan</a>, theMessage,
<a name="l02562"></a>02562                 *pMyNym, *pServerContract,
<a name="l02563"></a>02563                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02564"></a>02564             {
<a name="l02565"></a>02565                 bSendCommand = <span class="keyword">true</span>;
<a name="l02566"></a>02566             }
<a name="l02567"></a>02567             <span class="keywordflow">else</span>
<a name="l02568"></a>02568                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing payment plan command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02569"></a>02569             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02570"></a>02570         }
<a name="l02571"></a>02571 
<a name="l02572"></a>02572         <span class="comment">// get account</span>
<a name="l02573"></a>02573         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;get\n&quot;</span>))
<a name="l02574"></a>02574         {
<a name="l02575"></a>02575             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getAccount command to the server...)\n&quot;</span>);
<a name="l02576"></a>02576 
<a name="l02577"></a>02577             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02578"></a>02578             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02579"></a>02579 
<a name="l02580"></a>02580             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a83dc60e33659baf6d5ce60c3aa254f06">OTClient::getAccount</a>, theMessage,
<a name="l02581"></a>02581                 *pMyNym,  *pServerContract,
<a name="l02582"></a>02582                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02583"></a>02583             {
<a name="l02584"></a>02584                 bSendCommand = <span class="keyword">true</span>;
<a name="l02585"></a>02585             }
<a name="l02586"></a>02586             <span class="keywordflow">else</span>
<a name="l02587"></a>02587                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02588"></a>02588             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02589"></a>02589         }
<a name="l02590"></a>02590 
<a name="l02591"></a>02591         <span class="comment">// get contract</span>
<a name="l02592"></a>02592         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;getcontract\n&quot;</span>))
<a name="l02593"></a>02593         {
<a name="l02594"></a>02594             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getContract command to the server...)\n&quot;</span>);
<a name="l02595"></a>02595 
<a name="l02596"></a>02596             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02597"></a>02597             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02598"></a>02598 
<a name="l02599"></a>02599             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5b059c3a4ea9668eeb8fab51ed52926c">OTClient::getContract</a>, theMessage,
<a name="l02600"></a>02600                 *pMyNym, *pServerContract,
<a name="l02601"></a>02601                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02602"></a>02602             {
<a name="l02603"></a>02603                 bSendCommand = <span class="keyword">true</span>;
<a name="l02604"></a>02604             }
<a name="l02605"></a>02605             <span class="keywordflow">else</span>
<a name="l02606"></a>02606                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getContract command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02607"></a>02607             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02608"></a>02608         }
<a name="l02609"></a>02609 
<a name="l02610"></a>02610         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02611"></a>02611 
<a name="l02612"></a>02612         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;propose\n&quot;</span>))
<a name="l02613"></a>02613         {
<a name="l02614"></a>02614             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to propose a payment plan...)\n&quot;</span>);
<a name="l02615"></a>02615 
<a name="l02616"></a>02616             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a2e9a6e919c7ee32a962aaf24b1ffb697">OTClient::proposePaymentPlan</a>, theMessage,
<a name="l02617"></a>02617                 *pMyNym, *pServerContract,
<a name="l02618"></a>02618                 NULL); <span class="comment">// User owns Merchant (recipient) account</span>
<a name="l02619"></a>02619             <span class="keywordflow">continue</span>;
<a name="l02620"></a>02620         }
<a name="l02621"></a>02621 
<a name="l02622"></a>02622         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;confirm\n&quot;</span>))
<a name="l02623"></a>02623         {
<a name="l02624"></a>02624             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to confirm a payment plan...)\n&quot;</span>);
<a name="l02625"></a>02625 
<a name="l02626"></a>02626             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a901ce90148ddf82944a19bc4338682ad">OTClient::confirmPaymentPlan</a>, theMessage,
<a name="l02627"></a>02627                 *pMyNym, *pServerContract,
<a name="l02628"></a>02628                 NULL); <span class="comment">// the account info is already on the plan, right?</span>
<a name="l02629"></a>02629             <span class="keywordflow">continue</span>;
<a name="l02630"></a>02630         }
<a name="l02631"></a>02631 
<a name="l02632"></a>02632         <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02633"></a>02633 
<a name="l02634"></a>02634         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;cheque\n&quot;</span>))
<a name="l02635"></a>02635         {
<a name="l02636"></a>02636             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to write a cheque...)\n&quot;</span>);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab15b3869502823da3286c4a3be9b83bc">OTClient::writeCheque</a>, theMessage,
<a name="l02639"></a>02639                 *pMyNym, *pServerContract,
<a name="l02640"></a>02640                 NULL); <span class="comment">// It will ascertain the account inside the call.</span>
<a name="l02641"></a>02641             <span class="keywordflow">continue</span>;
<a name="l02642"></a>02642         }
<a name="l02643"></a>02643 
<a name="l02644"></a>02644         <span class="comment">// get mint</span>
<a name="l02645"></a>02645         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;getmint\n&quot;</span>))
<a name="l02646"></a>02646         {
<a name="l02647"></a>02647             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getMint command to the server...)\n&quot;</span>);
<a name="l02648"></a>02648 
<a name="l02649"></a>02649             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02650"></a>02650             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02651"></a>02651 
<a name="l02652"></a>02652             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a4c340c363c96261623287d7bbb988ab4">OTClient::getMint</a>, theMessage,
<a name="l02653"></a>02653                 *pMyNym,  *pServerContract,
<a name="l02654"></a>02654                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02655"></a>02655             {
<a name="l02656"></a>02656                 bSendCommand = <span class="keyword">true</span>;
<a name="l02657"></a>02657             }
<a name="l02658"></a>02658             <span class="keywordflow">else</span>
<a name="l02659"></a>02659                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getMint command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02660"></a>02660             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02661"></a>02661         }
<a name="l02662"></a>02662 
<a name="l02663"></a>02663         <span class="comment">// notarize transfer</span>
<a name="l02664"></a>02664         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;t&#39;</span>)
<a name="l02665"></a>02665         {
<a name="l02666"></a>02666             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a Transfer command (Notarize Transactions) to the server...)\n&quot;</span>);
<a name="l02667"></a>02667 
<a name="l02668"></a>02668             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02669"></a>02669             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02670"></a>02670 
<a name="l02671"></a>02671             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab982770b40b71822dc40f0bb3617d6ec">OTClient::notarizeTransfer</a>, theMessage,
<a name="l02672"></a>02672                 *pMyNym,  *pServerContract,
<a name="l02673"></a>02673                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02674"></a>02674             {
<a name="l02675"></a>02675                 bSendCommand = <span class="keyword">true</span>;
<a name="l02676"></a>02676             }
<a name="l02677"></a>02677             <span class="keywordflow">else</span>
<a name="l02678"></a>02678                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing notarizeTransactions command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02679"></a>02679             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02680"></a>02680         }
<a name="l02681"></a>02681 
<a name="l02682"></a>02682         <span class="comment">// getRequest</span>
<a name="l02683"></a>02683         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;g&#39;</span>)
<a name="l02684"></a>02684         {
<a name="l02685"></a>02685             <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getRequest command to the server...)\n&quot;</span>);
<a name="l02686"></a>02686 
<a name="l02687"></a>02687             <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02688"></a>02688             <span class="comment">// if successful setting up the command payload...</span>
<a name="l02689"></a>02689 
<a name="l02690"></a>02690             <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ad2b66c0cf1b0a4bc0d12ae557679c004">OTClient::getRequest</a>, theMessage,
<a name="l02691"></a>02691                 *pMyNym, *pServerContract,
<a name="l02692"></a>02692                 NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02693"></a>02693             {
<a name="l02694"></a>02694                 bSendCommand = <span class="keyword">true</span>;
<a name="l02695"></a>02695             }
<a name="l02696"></a>02696             <span class="keywordflow">else</span>
<a name="l02697"></a>02697                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getRequest command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02698"></a>02698             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02699"></a>02699         }
<a name="l02700"></a>02700 
<a name="l02701"></a>02701         <span class="comment">// getTransactionNum</span>
<a name="l02702"></a>02702         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;n&#39;</span>)
<a name="l02703"></a>02703         {
<a name="l02704"></a>02704             <span class="comment">// I just coded (here) for myself a secret option (for testing)...</span>
<a name="l02705"></a>02705             <span class="comment">// Optionally instead of JUST &#39;n&#39;, I can put n &lt;number&gt;, (without brackets) and</span>
<a name="l02706"></a>02706             <span class="comment">// this code will add that number to my list of issued and transaction numbers.</span>
<a name="l02707"></a>02707             <span class="comment">// I already have the ability to clear the list, so now I can add numbers to it as well.</span>
<a name="l02708"></a>02708             <span class="comment">// (Which adds to both lists.)</span>
<a name="l02709"></a>02709             <span class="comment">// I can also remove a number from the transaction list but LEAVE it on the issued list,</span>
<a name="l02710"></a>02710             <span class="comment">// for example by writing a cheque and throwing it away.</span>
<a name="l02711"></a>02711             <span class="comment">//</span>
<a name="l02712"></a>02712             <span class="comment">// This code is for testing and allows me to find and patch any problems without</span>
<a name="l02713"></a>02713             <span class="comment">// having to re-create my data each time -- speeds up debugging.</span>
<a name="l02714"></a>02714             <span class="comment">//</span>
<a name="l02715"></a>02715             int64_t lTransactionNumber = ((strlen(buf) &gt; 2) ? atol(&amp;(buf[2])) : 0);
<a name="l02716"></a>02716 
<a name="l02717"></a>02717             <span class="keywordflow">if</span> (lTransactionNumber &gt; 0)
<a name="l02718"></a>02718             {
<a name="l02719"></a>02719                 <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
<a name="l02720"></a>02720                 pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);
<a name="l02721"></a>02721 
<a name="l02722"></a>02722                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (add to your) transaction numbers.\n&quot;</span>
<a name="l02723"></a>02723                     <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02724"></a>02724 
<a name="l02725"></a>02725                 std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02726"></a>02726 
<a name="l02727"></a>02727                 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02728"></a>02728 
<a name="l02729"></a>02729                 <span class="comment">// --------------------------</span>
<a name="l02730"></a>02730 
<a name="l02731"></a>02731                 pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pMyNym, strTransNumServerID, lTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bool bSave=true</span>
<a name="l02732"></a>02732 
<a name="l02733"></a>02733                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Transaction number %lld added to both lists (on client side.)\n&quot;</span>,
<a name="l02734"></a>02734                     lTransactionNumber);
<a name="l02735"></a>02735             }
<a name="l02736"></a>02736 
<a name="l02737"></a>02737             <span class="keywordflow">else</span>
<a name="l02738"></a>02738             {
<a name="l02739"></a>02739                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getTransactionNum command to the server...)\n&quot;</span>);
<a name="l02740"></a>02740 
<a name="l02741"></a>02741                 <span class="comment">// ------------------------------------------------------------------------------</span>
<a name="l02742"></a>02742                 <span class="comment">// if successful setting up the command payload...</span>
<a name="l02743"></a>02743 
<a name="l02744"></a>02744                 <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afd0f3ab4babfe3e62c93e6af743c3645">OTClient::getTransactionNum</a>, theMessage,
<a name="l02745"></a>02745                     *pMyNym,  *pServerContract,
<a name="l02746"></a>02746                     NULL)) <span class="comment">// NULL pAccount on this command.</span>
<a name="l02747"></a>02747                 {
<a name="l02748"></a>02748                     bSendCommand = <span class="keyword">true</span>;
<a name="l02749"></a>02749                 }
<a name="l02750"></a>02750                 <span class="keywordflow">else</span>
<a name="l02751"></a>02751                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getTransactionNum command in ProcessMessage: %c\n&quot;</span>, buf[0]);
<a name="l02752"></a>02752             }
<a name="l02753"></a>02753 
<a name="l02754"></a>02754             <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02755"></a>02755         }
<a name="l02756"></a>02756 
<a name="l02757"></a>02757         <span class="keywordflow">else</span>
<a name="l02758"></a>02758         {
<a name="l02759"></a>02759             {
<a name="l02760"></a>02760                 <span class="comment">//gDebugLog.Write(&quot;unknown user command in ProcessMessage in main.cpp&quot;);</span>
<a name="l02761"></a>02761                 <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02762"></a>02762                 <span class="comment">//              OTLog::vError( &quot;unknown user command in ProcessMessage in main.cpp: %d\n&quot;, buf[0]);</span>
<a name="l02763"></a>02763             }
<a name="l02764"></a>02764             <span class="keywordflow">continue</span>;
<a name="l02765"></a>02765         }
<a name="l02766"></a>02766 
<a name="l02767"></a>02767 
<a name="l02768"></a>02768         <span class="comment">// ************************************************************************</span>
<a name="l02769"></a>02769 
<a name="l02770"></a>02770 
<a name="l02771"></a>02771         <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServerContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l02772"></a>02772 
<a name="l02773"></a>02773         <span class="keywordflow">if</span> (bSendCommand &amp;&amp; (NULL != pServerNym) &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>())
<a name="l02774"></a>02774         {
<a name="l02775"></a>02775             <a class="code" href="class_o_t_string.html">OTString</a> strEnvelopeContents(theMessage);
<a name="l02776"></a>02776             <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope;
<a name="l02777"></a>02777             theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pServerNym, strEnvelopeContents);
<a name="l02778"></a>02778             <span class="comment">// -----------------------------------</span>
<a name="l02779"></a>02779 
<a name="l02780"></a>02780             <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">GetTransportCallback</a>()-&gt;operator()(*pServerContract, theEnvelope);
<a name="l02781"></a>02781 
<a name="l02782"></a>02782         } <span class="comment">// if bSendCommand</span>
<a name="l02783"></a>02783     } <span class="comment">// for</span>
<a name="l02784"></a>02784 
<a name="l02785"></a>02785     <span class="comment">// -----------------------------------------------------------</span>
<a name="l02786"></a>02786 
<a name="l02787"></a>02787 
<a name="l02788"></a>02788     <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Exiting OT prompt.\n&quot;</span>);
<a name="l02789"></a>02789 
<a name="l02790"></a>02790     <span class="comment">// NOTE: Cleanup is handled via a nested class at the top of this main function.</span>
<a name="l02791"></a>02791 
<a name="l02792"></a>02792     <span class="keywordflow">return</span> 0;
<a name="l02793"></a>02793 }
<a name="l02794"></a>02794 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="otd_2main_8cpp.html">main.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:02 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
