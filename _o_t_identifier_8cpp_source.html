<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otlib/OTIdentifier.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_o_t_identifier_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otlib/OTIdentifier.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_o_t_identifier_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *    </span>
<a name="l00003"></a>00003 <span class="comment"> *  OTIdentifier.cpp</span>
<a name="l00004"></a>00004 <span class="comment"> *  </span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00009"></a>00009 <span class="comment"> Hash: SHA1</span>
<a name="l00010"></a>00010 <span class="comment"> </span>
<a name="l00011"></a>00011 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00014"></a>00014 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00017"></a>00017 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> *  EMAIL:</span>
<a name="l00027"></a>00027 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00032"></a>00032 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00035"></a>00035 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00036"></a>00036 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> *  WEBSITE:</span>
<a name="l00039"></a>00039 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *  Components and licensing:</span>
<a name="l00042"></a>00042 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00043"></a>00043 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00048"></a>00048 <span class="comment"> *</span>
<a name="l00049"></a>00049 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00050"></a>00050 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00051"></a>00051 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00052"></a>00052 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *   LICENSE:</span>
<a name="l00057"></a>00057 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00058"></a>00058 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00059"></a>00059 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00060"></a>00060 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00061"></a>00061 <span class="comment"> *   option) any later version.</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00064"></a>00064 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00065"></a>00065 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00066"></a>00066 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00067"></a>00067 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00068"></a>00068 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00069"></a>00069 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00070"></a>00070 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00071"></a>00071 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00072"></a>00072 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00073"></a>00073 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00074"></a>00074 <span class="comment"> *</span>
<a name="l00075"></a>00075 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00076"></a>00076 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00077"></a>00077 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00078"></a>00078 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00079"></a>00079 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00080"></a>00080 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00081"></a>00081 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00082"></a>00082 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00083"></a>00083 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00084"></a>00084 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *   Lucre License:</span>
<a name="l00087"></a>00087 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00088"></a>00088 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00089"></a>00089 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00090"></a>00090 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00091"></a>00091 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00092"></a>00092 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00093"></a>00093 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00094"></a>00094 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00095"></a>00095 <span class="comment"> *   will continue to operate.</span>
<a name="l00096"></a>00096 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00097"></a>00097 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00098"></a>00098 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00099"></a>00099 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00100"></a>00100 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00101"></a>00101 <span class="comment"> *</span>
<a name="l00102"></a>00102 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00103"></a>00103 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00104"></a>00104 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00105"></a>00105 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00106"></a>00106 <span class="comment"> *</span>
<a name="l00107"></a>00107 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00108"></a>00108 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00109"></a>00109 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00110"></a>00110 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00111"></a>00111 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00112"></a>00112 <span class="comment"> *   more details.</span>
<a name="l00113"></a>00113 <span class="comment"> </span>
<a name="l00114"></a>00114 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00115"></a>00115 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00116"></a>00116 <span class="comment"> </span>
<a name="l00117"></a>00117 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00118"></a>00118 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00119"></a>00119 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00120"></a>00120 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00121"></a>00121 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00122"></a>00122 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00123"></a>00123 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00124"></a>00124 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00125"></a>00125 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00126"></a>00126 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00127"></a>00127 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00128"></a>00128 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00129"></a>00129 <span class="comment"> =uSzz</span>
<a name="l00130"></a>00130 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00131"></a>00131 <span class="comment"> **************************************************************/</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_identifier_8hpp.html">OTIdentifier.hpp</a>&gt;</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_assert_8hpp.html">OTAssert.hpp</a>&gt;</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_pseudonym_8hpp.html">OTPseudonym.hpp</a>&gt;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_symmetric_key_8hpp.html">OTSymmetricKey.hpp</a>&gt;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_offer_8hpp.html">OTOffer.hpp</a>&gt;</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_market_8hpp.html">OTMarket.hpp</a>&gt;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_cached_key_8hpp.html">OTCachedKey.hpp</a>&gt;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_crypto_8hpp.html">OTCrypto.hpp</a>&gt;</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">00146</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>() : <a class="code" href="class_o_t_data.html">OTData</a>()  { }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="class_o_t_identifier.html#a4403f1e9a7f8eb016bae5688c9e6a556">00149</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theID) : <a class="code" href="class_o_t_data.html">OTData</a>(theID) { }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="class_o_t_identifier.html#a039b3f01f22948d295893a77bad461b0">00152</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * szStr) : <a class="code" href="class_o_t_data.html">OTData</a>()
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != szStr);
<a name="l00155"></a>00155     <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(szStr);
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="class_o_t_identifier.html#ad8252bf0eadc6c52baf5a8ba26e9fabb">00159</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> std::string &amp; theStr) : <a class="code" href="class_o_t_data.html">OTData</a>()
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!theStr.empty());
<a name="l00162"></a>00162     <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theStr.c_str());
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="class_o_t_identifier.html#abb4ad7c2796c095f9f3ae7b3079852bd">00166</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr) : <a class="code" href="class_o_t_data.html">OTData</a>()
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theStr);
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="class_o_t_identifier.html#aa7836b76123bea360656ea6475528664">00172</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_contract.html">OTContract</a> &amp;theContract)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Get the contract&#39;s ID into this identifier.</span>
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_contract.html">OTContract</a> &amp;<span class="keyword">&gt;</span>(theContract)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="class_o_t_identifier.html#ad428359116de55b6e959b3de47ca3d47">00178</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Get the Nym&#39;s ID into this identifier.</span>
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;<span class="keyword">&gt;</span>(theNym)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="class_o_t_identifier.html#aabcfbd7c6adebd34e1769bd11adf57e5">00184</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_offer.html">OTOffer</a> &amp;theOffer)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Get the Offer&#39;s Market ID into this identifier.</span>
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_offer.html">OTOffer</a> &amp;<span class="keyword">&gt;</span>(theOffer)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="class_o_t_identifier.html#aee7e4e4ecc44cfd014d827d9e991f524">00190</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_market.html">OTMarket</a> &amp;theMarket)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Get the Market ID into this identifier.</span>
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192     (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_market.html">OTMarket</a> &amp;<span class="keyword">&gt;</span>(theMarket)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="class_o_t_identifier.html#a5e602fb2ed8bc5b58898c06928d49e41">00196</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;theKey)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Get the Symmetric Key&#39;s ID into *this. (It&#39;s a hash of the encrypted form of the symmetric key.)</span>
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198     (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;<span class="keyword">&gt;</span>(theKey)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="class_o_t_identifier.html#a7ec351459a2d454fc9bc851e2fd69c25">00202</a> <a class="code" href="class_o_t_identifier.html#adba55114dd294022cb4f4d14392b1411">OTIdentifier::OTIdentifier</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_cached_key.html">OTCachedKey</a> &amp;theKey)  : <a class="code" href="class_o_t_data.html">OTData</a>() <span class="comment">// Cached Key stores a symmetric key inside, so this actually captures the ID for that symmetrickey.</span>
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     <span class="keyword">const</span> <span class="keywordtype">bool</span> bSuccess = (<span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_cached_key.html">OTCachedKey</a> &amp;<span class="keyword">&gt;</span>(theKey)).GetIdentifier(*<span class="keyword">this</span>);
<a name="l00205"></a>00205     
<a name="l00206"></a>00206     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(bSuccess); <span class="comment">// should never fail. If it does, then we are calling this function at a time we shouldn&#39;t, when we aren&#39;t sure the master key has even been generated yet. (If this asserts, need to examine the line of code that tried to do this, and figure out where its logic went wrong, since it should have made sure this would not happen, before constructing like this.)</span>
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">00210</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">OTIdentifier::SetString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * szString)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != szString);
<a name="l00213"></a>00213     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> theStr(szString);
<a name="l00214"></a>00214     <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theStr);
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="class_o_t_identifier.html#a5517e8e3fcf317cddf68f58972934b3b">00218</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a5517e8e3fcf317cddf68f58972934b3b">OTIdentifier::operator==</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword"> const</span>
<a name="l00219"></a>00219 <span class="keyword"></span>{
<a name="l00220"></a>00220     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00221"></a>00221     <span class="keywordflow">return</span> ots1.Compare(ots2);  
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="class_o_t_identifier.html#a3ff492d7eb5b5af01a953e9e4895211b">00225</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a3ff492d7eb5b5af01a953e9e4895211b">OTIdentifier::operator!=</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword"> const</span>
<a name="l00226"></a>00226 <span class="keyword"></span>{
<a name="l00227"></a>00227     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00228"></a>00228     <span class="keywordflow">return</span> !(ots1.Compare(ots2));   
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="class_o_t_identifier.html#a2b31431e60a6aeab59ae373ab728dd31">00232</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a2b31431e60a6aeab59ae373ab728dd31">OTIdentifier::operator &gt;</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword"> const </span>
<a name="l00233"></a>00233 <span class="keyword"></span>{
<a name="l00234"></a>00234     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00235"></a>00235     <span class="keywordflow">return</span> ots1.operator&gt;(ots2);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00239"></a><a class="code" href="class_o_t_identifier.html#a8ec73da3c4510f349a8ab9a253970cad">00239</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a8ec73da3c4510f349a8ab9a253970cad">OTIdentifier::operator &lt;</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword">  const </span>
<a name="l00240"></a>00240 <span class="keyword"></span>{
<a name="l00241"></a>00241     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00242"></a>00242     <span class="keywordflow">return</span> ots1.operator&lt;(ots2);
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="class_o_t_identifier.html#aa8fdf384c5b80947bbf6d82e462d0895">00246</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#aa8fdf384c5b80947bbf6d82e462d0895">OTIdentifier::operator &lt;=</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword">  const</span>
<a name="l00247"></a>00247 <span class="keyword"></span>{
<a name="l00248"></a>00248     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00249"></a>00249     <span class="keywordflow">return</span> ots1.operator&lt;=(ots2);
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="class_o_t_identifier.html#ac2a4a6a5b718b6354f9ce1ae47fd834b">00253</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#ac2a4a6a5b718b6354f9ce1ae47fd834b">OTIdentifier::operator &gt;=</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp;s2)<span class="keyword">  const</span>
<a name="l00254"></a>00254 <span class="keyword"></span>{
<a name="l00255"></a>00255     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> ots1(*<span class="keyword">this</span>), ots2(s2);
<a name="l00256"></a>00256     <span class="keywordflow">return</span> ots1.operator&gt;=(ots2);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="class_o_t_identifier.html#aab58dadae4886d34602da2982c1504a4">00260</a> <a class="code" href="class_o_t_identifier.html#aab58dadae4886d34602da2982c1504a4">OTIdentifier::~OTIdentifier</a>() { }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="class_o_t_identifier.html#acc00c00c750e2c5ea1e4c01db533c3dc">00263</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_identifier.html#acc00c00c750e2c5ea1e4c01db533c3dc">OTIdentifier::CopyTo</a>(uint8_t * szNewLocation)<span class="keyword"> const</span>
<a name="l00264"></a>00264 <span class="keyword"></span>{
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>())
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267         memcpy((<span class="keywordtype">void</span>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), szNewLocation, <a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>()); <span class="comment">// todo cast</span>
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">// On the advice of SAMY, our default hash algorithm will be an XOR</span>
<a name="l00273"></a>00273 <span class="comment">// of two reputable algorithms. This way, if one of them gets broken,</span>
<a name="l00274"></a>00274 <span class="comment">// our signatures are still safe. </span>
<a name="l00275"></a>00275 <span class="comment">// Smart, eh?  So I named it in his honor.</span>
<a name="l00276"></a>00276 <span class="comment">// (I have chosen SHA-256 and RIPEMD-256.)</span>
<a name="l00277"></a>00277 <span class="comment">// UPDATE: SHA-512 and WHIRLPOOL</span>
<a name="l00278"></a>00278 <span class="comment">// UPDATE: SHA-256 and WHIRLPOOL</span>
<a name="l00279"></a>00279 <span class="comment">// We now have 256-bit keysize, though half of WHIRLPOOL output is still XORed onto it.</span>
<a name="l00280"></a>00280 <span class="comment">// We also now input/output the string values with Base62 instead of Hex. (More compact.)</span>
<a name="l00281"></a>00281 <span class="comment">//</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">//#ifndef ANDROID</span>
<a name="l00284"></a>00284 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> <a class="code" href="class_o_t_identifier.html#a1179b45355107bf4511249a823217c94">OTIdentifier::DefaultHashAlgorithm</a>(<span class="stringliteral">&quot;SAMY&quot;</span>);
<a name="l00285"></a>00285 <span class="comment">//#else</span>
<a name="l00286"></a>00286 <span class="comment">//const OTString OTIdentifier::DefaultHashAlgorithm(&quot;SHA256&quot;);</span>
<a name="l00287"></a>00287 <span class="comment">//#endif // ANDROID</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> <a class="code" href="class_o_t_identifier.html#a1999830fc99ab7f152a28322c32af45f">OTIdentifier::HashAlgorithm1</a>(<span class="stringliteral">&quot;SHA256&quot;</span>);
<a name="l00290"></a>00290 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> <a class="code" href="class_o_t_identifier.html#a1bd0ea93b2eeecc25f20b71bfad4f2b2">OTIdentifier::HashAlgorithm2</a>(<span class="stringliteral">&quot;WHIRLPOOL&quot;</span>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">// This method implements the SAMY hash</span>
<a name="l00294"></a><a class="code" href="class_o_t_identifier.html#a81c594f32055ddbcab342d3e95f4287f">00294</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">OTIdentifier::CalculateDigest</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strInput)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296 <span class="comment">//#ifndef ANDROID // If NOT Android...</span>
<a name="l00297"></a>00297     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idSecondHash;
<a name="l00298"></a>00298     
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (idSecondHash.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(strInput, <a class="code" href="class_o_t_identifier.html#a1bd0ea93b2eeecc25f20b71bfad4f2b2">HashAlgorithm2</a>) &amp;&amp;
<a name="l00300"></a>00300         <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(strInput, <a class="code" href="class_o_t_identifier.html#a1999830fc99ab7f152a28322c32af45f">HashAlgorithm1</a>))
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <span class="comment">// At this point, we have successfully generated the WHRLPOOL hash in </span>
<a name="l00303"></a>00303         <span class="comment">// idSecondHash, and we&#39;ve successfully generated the SHA-256 hash in </span>
<a name="l00304"></a>00304         <span class="comment">// this object.</span>
<a name="l00305"></a>00305         <span class="comment">// Next we XOR them together for the final product.</span>
<a name="l00306"></a>00306         <span class="keywordflow">return</span> <a class="code" href="class_o_t_identifier.html#a81979c14be0d19373d2623a2fef333c6">XOR</a>(idSecondHash);
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 <span class="comment">//#else // SHA256 on Android; no whirlpool until OpenSSL 1.0.0 is added.</span>
<a name="l00309"></a>00309 <span class="comment">//  if (CalculateDigest(strInput, HashAlgorithm1))</span>
<a name="l00310"></a>00310 <span class="comment">//  {</span>
<a name="l00311"></a>00311 <span class="comment">//      return true;</span>
<a name="l00312"></a>00312 <span class="comment">//  }   </span>
<a name="l00313"></a>00313 <span class="comment">//#endif // ANDROID</span>
<a name="l00314"></a>00314     
<a name="l00315"></a>00315     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="comment">// This method implements the SAMY hash</span>
<a name="l00320"></a><a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">00320</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">OTIdentifier::CalculateDigest</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_data.html">OTData</a> &amp; dataInput)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322 <span class="comment">//#ifndef ANDROID // SHA256 on Android; no whirlpool until OpenSSL 1.0.0 is added.</span>
<a name="l00323"></a>00323     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idSecondHash;
<a name="l00324"></a>00324     
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (idSecondHash.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(dataInput, <a class="code" href="class_o_t_identifier.html#a1bd0ea93b2eeecc25f20b71bfad4f2b2">HashAlgorithm2</a>) &amp;&amp;
<a name="l00326"></a>00326         <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(dataInput, <a class="code" href="class_o_t_identifier.html#a1999830fc99ab7f152a28322c32af45f">HashAlgorithm1</a>))
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328         <span class="comment">// At this point, we have successfully generated the WHRLPOOL hash in </span>
<a name="l00329"></a>00329         <span class="comment">// idSecondHash, and we&#39;ve successfully generated the SHA-256 hash in </span>
<a name="l00330"></a>00330         <span class="comment">// this object.</span>
<a name="l00331"></a>00331         <span class="comment">// Next we XOR them together for the final product.</span>
<a name="l00332"></a>00332         <span class="keywordflow">return</span> <a class="code" href="class_o_t_identifier.html#a81979c14be0d19373d2623a2fef333c6">XOR</a>(idSecondHash);
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 <span class="comment">//#else // ANDROID</span>
<a name="l00335"></a>00335 <span class="comment">//  if (CalculateDigest(dataInput, HashAlgorithm1)) // SHA256 only until I add the new OpenSSL 1.0 for Android</span>
<a name="l00336"></a>00336 <span class="comment">//  {</span>
<a name="l00337"></a>00337 <span class="comment">//      return true;</span>
<a name="l00338"></a>00338 <span class="comment">//  }   </span>
<a name="l00339"></a>00339 <span class="comment">//#endif // ANDROID</span>
<a name="l00340"></a>00340     
<a name="l00341"></a>00341     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">// Some of the digest calculations are done by crypto++, instead of OpenSSL.</span>
<a name="l00346"></a>00346 <span class="comment">// (UPDATE that is no longer true.)</span>
<a name="l00347"></a>00347 <span class="comment">// Also, at least one of the algorithms (SAMY) is an internal name, and again not</span>
<a name="l00348"></a>00348 <span class="comment">// handled by OpenSSL.  So I call this function first to see if the hash type requres</span>
<a name="l00349"></a>00349 <span class="comment">// internal handling. If not, then I return false and the caller knows to use OpenSSL</span>
<a name="l00350"></a>00350 <span class="comment">// instead.</span>
<a name="l00351"></a><a class="code" href="class_o_t_identifier.html#a429dfc5afc3854ae51dfb4348b6a3d99">00351</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a429dfc5afc3854ae51dfb4348b6a3d99">OTIdentifier::CalculateDigestInternal</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strInput, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strHashAlgorithm)
<a name="l00352"></a>00352 {
<a name="l00353"></a>00353     <span class="comment">// See if they wanted to use the SAMY hash</span>
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (strHashAlgorithm.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<a class="code" href="class_o_t_identifier.html#a1179b45355107bf4511249a823217c94">DefaultHashAlgorithm</a>)) 
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356         <span class="keywordflow">return</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(strInput);
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358     
<a name="l00359"></a>00359     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="comment">// Some of the digest calculations are done by crypto++, instead of OpenSSL.</span>
<a name="l00364"></a>00364 <span class="comment">// (UPDATE: above is no longer true...)</span>
<a name="l00365"></a>00365 <span class="comment">// Also, at least one of the algorithms (SAMY) is an internal name, and again not</span>
<a name="l00366"></a>00366 <span class="comment">// handled by OpenSSL.  So I call this function first to see if the hash type requres</span>
<a name="l00367"></a>00367 <span class="comment">// internal handling. If not, then I return false and the caller knows to use OpenSSL</span>
<a name="l00368"></a>00368 <span class="comment">// instead.</span>
<a name="l00369"></a>00369 
<a name="l00370"></a><a class="code" href="class_o_t_identifier.html#a97b334a3362a3d01cc47110464cb101a">00370</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a429dfc5afc3854ae51dfb4348b6a3d99">OTIdentifier::CalculateDigestInternal</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_data.html">OTData</a> &amp; dataInput, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strHashAlgorithm)
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     <span class="comment">// See if they wanted to use the SAMY hash</span>
<a name="l00373"></a>00373     <span class="keywordflow">if</span> (strHashAlgorithm.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<a class="code" href="class_o_t_identifier.html#a1179b45355107bf4511249a823217c94">DefaultHashAlgorithm</a>)) 
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375         <span class="keywordflow">return</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(dataInput);
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377     
<a name="l00378"></a>00378     <span class="keywordflow">return</span> <span class="keyword">false</span>;   
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="comment">// This function lets you choose the hash algorithm by string.</span>
<a name="l00383"></a>00383 <span class="comment">// (For example, if you read &quot;SHA-256&quot; out of a signed file and you</span>
<a name="l00384"></a>00384 <span class="comment">// needed to get the hash function based on that string, you could use this.)</span>
<a name="l00385"></a>00385 <span class="comment">//</span>
<a name="l00386"></a><a class="code" href="class_o_t_identifier.html#afdbf34734912f7c1155b811bc2bbda23">00386</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">OTIdentifier::CalculateDigest</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strInput, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strHashAlgorithm)
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388     <span class="keywordflow">return</span> <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a318a1ac8323809ecbcb266c4bae379c5">CalculateDigest</a>(strInput, strHashAlgorithm, *<span class="keyword">this</span>);
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="class_o_t_identifier.html#ac32ff44c17a5dd19006725f00f1565e0">00392</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">OTIdentifier::CalculateDigest</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_data.html">OTData</a> &amp; dataInput, <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strHashAlgorithm)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394     <span class="keywordflow">return</span> <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a318a1ac8323809ecbcb266c4bae379c5">CalculateDigest</a>(dataInput, strHashAlgorithm, *<span class="keyword">this</span>);
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">// So we can implement the SAMY hash, which is currently an XOR of SHA-256 with WHRLPOOL</span>
<a name="l00399"></a>00399 <span class="comment">//</span>
<a name="l00400"></a>00400 <span class="comment">// Originally, it was SHA512 and WHRLPOOL, which both have a 512-bit output-size.</span>
<a name="l00401"></a>00401 <span class="comment">// I was then going to cut the result in half and XOR together again. But then I </span>
<a name="l00402"></a>00402 <span class="comment">// though, for now, instead of doing all that extra work, I&#39;ll just change the</span>
<a name="l00403"></a>00403 <span class="comment">// two &quot;HashAlgorithms&quot; from SHA512 and WHRLPOOL to SHA256 and WHIRLPOOL.</span>
<a name="l00404"></a>00404 <span class="comment">//</span>
<a name="l00405"></a>00405 <span class="comment">// This was very much easier, as I only had to change the little &quot;512&quot; to say </span>
<a name="l00406"></a>00406 <span class="comment">// &quot;256&quot; instead, and basically the job was done. Of course, this means that OT</span>
<a name="l00407"></a>00407 <span class="comment">// is generating a 256-bit hash in THIS object, and a 512-bit WHIRLPOOL hash in</span>
<a name="l00408"></a>00408 <span class="comment">// the other object. i.e. There is still one 512-bit hash that you are forced to</span>
<a name="l00409"></a>00409 <span class="comment">// calculate, even if you throw away half of it after the calculation is done.</span>
<a name="l00410"></a>00410 <span class="comment">//</span>
<a name="l00411"></a>00411 <span class="comment">// Since the main object has a 256-bit hash, the XOR() function below was already</span>
<a name="l00412"></a>00412 <span class="comment">// coded to XOR the minimum length based on the smallest of the two objects.</span>
<a name="l00413"></a>00413 <span class="comment">// Therefore, it will XOR 256 bits of the WHRLPOOL output into the 256 bits of</span>
<a name="l00414"></a>00414 <span class="comment">// the main output (SHA256) and stop there: we now have a 256 bit ID. </span>
<a name="l00415"></a>00415 <span class="comment">//</span>
<a name="l00416"></a>00416 <span class="comment">// The purpose here is to reduce the ID size so that it will work on Windows with</span>
<a name="l00417"></a>00417 <span class="comment">// the filenames. The current 512bit output is 64 bytes, or 128 characters when</span>
<a name="l00418"></a>00418 <span class="comment">// exported to a hex string (in all the OT contracts for example, over and over </span>
<a name="l00419"></a>00419 <span class="comment">// again.)</span>
<a name="l00420"></a>00420 <span class="comment">//</span>
<a name="l00421"></a>00421 <span class="comment">// The new size will be 256bit, which is 32 bytes of binary. In hex string that</span>
<a name="l00422"></a>00422 <span class="comment">// would be 64 characters. But we&#39;re also converting from Hex to Base62, which</span>
<a name="l00423"></a>00423 <span class="comment">// means we&#39;ll get it down to around 43 characters.</span>
<a name="l00424"></a>00424 <span class="comment">//</span>
<a name="l00425"></a>00425 <span class="comment">// This means our IDs are going to go from this:</span>
<a name="l00426"></a>00426 <span class="comment">//</span>
<a name="l00427"></a>00427 <span class="comment">//</span>
<a name="l00428"></a>00428 <span class="comment">// To this:</span>
<a name="l00429"></a>00429 <span class="comment">//</span>
<a name="l00430"></a>00430 <span class="comment">//</span>
<a name="l00431"></a>00431 <span class="comment">// You might ask: is 256 bits big enough of a hash size to be safe from collisions?</span>
<a name="l00432"></a>00432 <span class="comment">// Practically speaking, I believe so.  The IDs are used for accounts, servers, asset types,</span>
<a name="l00433"></a>00433 <span class="comment">// and users. How many different asset types do you expect there will be, where changing the</span>
<a name="l00434"></a>00434 <span class="comment">// contract to anything still intelligible would result in a still-valid signature? To find</span>
<a name="l00435"></a>00435 <span class="comment">// a collision in a contract, where the signature would still work, would you expect the necessary</span>
<a name="l00436"></a>00436 <span class="comment">// changed plaintext to be something that would still make sense in the contract? Would such</span>
<a name="l00437"></a>00437 <span class="comment">// a random piece of data turn out to form proper XML?</span>
<a name="l00438"></a>00438 <span class="comment">//</span>
<a name="l00439"></a>00439 <span class="comment">// 256bits is enough to store the number of atoms in the Universe. If we ever need a bigger</span>
<a name="l00440"></a>00440 <span class="comment">// hashsize, just go change the HashAlgorithm1 back to &quot;SHA512&quot; instead of &quot;SHA256&quot;, and you&#39;ll</span>
<a name="l00441"></a>00441 <span class="comment">// instantly have a doubled hash output size  :-)</span>
<a name="l00442"></a>00442 <span class="comment">//</span>
<a name="l00443"></a><a class="code" href="class_o_t_identifier.html#a81979c14be0d19373d2623a2fef333c6">00443</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_identifier.html#a81979c14be0d19373d2623a2fef333c6">OTIdentifier::XOR</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theInput)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <span class="comment">// Go with the smallest of the two</span>
<a name="l00446"></a>00446     <span class="keyword">const</span> int64_t lSize = (<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() &gt; theInput.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() ? theInput.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() : <a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>());
<a name="l00447"></a>00447     
<a name="l00448"></a>00448     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; lSize; i++)
<a name="l00449"></a>00449     {
<a name="l00450"></a>00450         <span class="comment">// When converting to BigInteger internally, this will be a bit more efficient.</span>
<a name="l00451"></a>00451         ((<span class="keywordtype">char</span>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>())[i] ^= ((<span class="keywordtype">char</span>*)theInput.<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>())[i]; <span class="comment">// todo cast</span>
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453     
<a name="l00454"></a>00454     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">// SET (binary id) FROM BASE62-ENCODED STRING</span>
<a name="l00459"></a>00459 <span class="comment">//</span>
<a name="l00460"></a><a class="code" href="class_o_t_identifier.html#aa36fdacd381e9031171de1985b8e7565">00460</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">OTIdentifier::SetString</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)
<a name="l00461"></a>00461 {
<a name="l00462"></a>00462     <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a151c7b3cc15886ffcad90fb099cd9b34">SetIDFromBase62String</a>(theStr, *<span class="keyword">this</span>); <span class="comment">// theStr input, *this output.</span>
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="comment">// GET (binary id) AS BASE62-ENCODED STRING</span>
<a name="l00467"></a>00467 <span class="comment">//</span>
<a name="l00468"></a>00468 <span class="comment">// This Identifier is stored in binary form.</span>
<a name="l00469"></a>00469 <span class="comment">// But what if you want a pretty base62 string version of it?</span>
<a name="l00470"></a>00470 <span class="comment">// Just call this function.</span>
<a name="l00471"></a>00471 <span class="comment">//</span>
<a name="l00472"></a><a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">00472</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">OTIdentifier::GetString</a>(<a class="code" href="class_o_t_string.html">OTString</a> &amp; theStr)<span class="keyword"> const</span>
<a name="l00473"></a>00473 <span class="keyword"></span>{
<a name="l00474"></a>00474     <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a0b2e5702bb5ed607397262311d845189">SetBase62StringFromID</a>(*<span class="keyword">this</span>, theStr); <span class="comment">// *this input, theStr output.</span>
<a name="l00475"></a>00475 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_o_t_identifier_8cpp.html">OTIdentifier.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:03 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
