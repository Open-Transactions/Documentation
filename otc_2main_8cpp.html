<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otc/main.cpp File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('otc_2main_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">src/otc/main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="stdafx_8hpp_source.html">stdafx.hpp</a>&gt;</code><br/>
<code>#include &lt;algorithm&gt;</code><br/>
<code>#include &lt;cctype&gt;</code><br/>
<code>#include &lt;functional&gt;</code><br/>
<code>#include &lt;iostream&gt;</code><br/>
<code>#include &lt;locale&gt;</code><br/>
<code>#include &lt;map&gt;</code><br/>
<code>#include &lt;vector&gt;</code><br/>
<code>#include &lt;anyoption.hpp&gt;</code><br/>
<code>#include &lt;<a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t___m_e_8hpp_source.html">OT_ME.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_client_8hpp_source.html">OTClient.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_log_8hpp_source.html">OTLog.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_paths_8hpp_source.html">OTPaths.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_wallet_8hpp_source.html">OTWallet.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_server_contract_8hpp_source.html">OTServerContract.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_account_8hpp_source.html">OTAccount.hpp</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ot__otapi__ot_8hpp_source.html">ot_otapi_ot.hpp</a>&quot;</code><br/>
</div>
<p><a href="otc_2main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>&#160;&#160;&#160;&quot;command-line-ot.opt&quot;</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#aeae1ff01fe9cbe8c4849f63e134babfb">HandleCommandLineArguments</a> (int argc, char *argv[], AnyOption &amp;opt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a> (AnyOption &amp;opt, const char *pDefaultName, const char *pOptionName)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_variable.html">OTVariable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a> (<a class="el" href="class_o_t___m_e.html">OT_ME</a> &amp;madeEasy, const string &amp;name, const string &amp;value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#ab3b1490f77cb396537aaf1059fca6fe5">ProcessCommand</a> (<a class="el" href="class_o_t___m_e.html">OT_ME</a> &amp;madeEasy, AnyOption &amp;opt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otc_2main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac81684a3952e5289a620e3d1cb58d80c"></a><!-- doxytag: member="main.cpp::OT_OPTIONS_FILE_DEFAULT" ref="ac81684a3952e5289a620e3d1cb58d80c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="otc_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>&#160;&#160;&#160;&quot;command-line-ot.opt&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00158">158</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5a8fb76be874fcf5e2bb9a285b0684e6"></a><!-- doxytag: member="main.cpp::GetOption" ref="a5a8fb76be874fcf5e2bb9a285b0684e6" args="(AnyOption &amp;opt, const char *pDefaultName, const char *pOptionName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a> </td>
          <td>(</td>
          <td class="paramtype">AnyOption &amp;&#160;</td>
          <td class="paramname"><em>opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pDefaultName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pOptionName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00243">243</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// can we get the default value from the command line?</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pValue = opt.getValue(pOptionName);
    <span class="keywordflow">if</span> (NULL != pValue)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Option  %s: %s\n&quot;</span>, pOptionName, pValue);
        <span class="keywordflow">return</span> pValue;
    }

    <span class="comment">// can we get the default value from the options file?</span>
    pValue = opt.getValue(pDefaultName);
    <span class="keywordflow">if</span> (NULL != pValue)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Default %s: %s\n&quot;</span>, pOptionName, pValue);
        <span class="keywordflow">return</span> pValue;
    }

    <span class="comment">// clear option value</span>
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aeae1ff01fe9cbe8c4849f63e134babfb"></a><!-- doxytag: member="main.cpp::HandleCommandLineArguments" ref="aeae1ff01fe9cbe8c4849f63e134babfb" args="(int argc, char *argv[], AnyOption &amp;opt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="otc_2main_8cpp.html#aeae1ff01fe9cbe8c4849f63e134babfb">HandleCommandLineArguments</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnyOption &amp;&#160;</td>
          <td class="paramname"><em>opt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00194">194</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath(<a class="code" href="class_o_t_paths.html#a6634797ea86b0da2d66a816e604b538b">OTPaths::AppDataFolder</a>());
    <span class="keywordtype">bool</span> bConfigPathFound = strConfigPath.Exists() &amp;&amp; 3 &lt; strConfigPath.GetLength();
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bConfigPathFound, <span class="stringliteral">&quot;RegisterAPIWithScript: Must set Config Path first!\n&quot;</span>);
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Using configuration path:  %s\n&quot;</span>, strConfigPath.Get());

    opt.addUsage(<span class="stringliteral">&quot;&quot;</span>);
    opt.addUsage(<span class="stringliteral">&quot; Opentxs CLI Usage:  &quot;</span>);
    opt.addUsage(<span class="stringliteral">&quot;&quot;</span>);

    opt.setCommandFlag(<span class="stringliteral">&quot;echocommand&quot;</span>);
    opt.setCommandFlag(<span class="stringliteral">&quot;echoexpand&quot;</span>);
    opt.setCommandFlag(<span class="stringliteral">&quot;errorlist&quot;</span>);
    opt.setCommandFlag(<span class="stringliteral">&quot;noprompt&quot;</span>);
    opt.setCommandFlag(<span class="stringliteral">&quot;test&quot;</span>);

    opt.setCommandOption(<span class="stringliteral">&quot;args&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;myacct&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;mynym&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;mypurse&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;hisacct&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;hisnym&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;hispurse&quot;</span>);
    opt.setCommandOption(<span class="stringliteral">&quot;server&quot;</span>);

    <span class="comment">// RESOURCE FILE ONLY</span>
    <span class="comment">/* for options that will be checked only from the option/resource file */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaultserver&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaultmyacct&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaultmynym&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaultmypurse&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaulthisacct&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaulthisnym&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>
    opt.setFileOption(<span class="stringliteral">&quot;defaulthispurse&quot;</span>); <span class="comment">/* an option (takes an argument), supporting only long form */</span>

    <span class="comment">/* PROCESS THE COMMANDLINE AND RESOURCE FILE */</span>

    <span class="comment">/* read options from a option/resource file with &#39;:&#39; separated options or flags, one per line */</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strOptionsFile(<a class="code" href="otc_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>), strIniFileExact;
    <span class="keywordtype">bool</span> bBuildFullPathSuccess = <a class="code" href="class_o_t_paths.html#a73f191305215a5a10158a927b01f53da">OTPaths::RelativeToCanonical</a>(strIniFileExact, strConfigPath, strOptionsFile);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bBuildFullPathSuccess, <span class="stringliteral">&quot;Unalbe to set Full Path&quot;</span>);

    opt.processFile(strIniFileExact.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    opt.processCommandArgs(argc, argv);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="main.cpp::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="otc_2main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00521">521</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">class </span>__OTclient_RAII
    {
    <span class="keyword">public</span>:
        __OTclient_RAII()
        {
             <a class="code" href="class_o_t_a_p_i___wrap.html#a8be8d3b92ff715548929dfecc1919801">OTAPI_Wrap::AppInit</a>(); 
        }
        ~__OTclient_RAII()
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#a3fc341c4f43727c1b195d8d86e47e9db">OTAPI_Wrap::AppCleanup</a>();
        }
    };

    <span class="comment">//</span>
    <span class="comment">// This makes SURE that AppCleanup() gets called before main() exits (without any</span>
    <span class="comment">// twisted logic being necessary below, for that to happen.)</span>
    <span class="comment">//</span>
    __OTclient_RAII the_client_cleanup;

    <span class="comment">//</span>

    <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()) <span class="keywordflow">return</span> -1;  <span class="comment">// error out if we don&#39;t have the API.</span>

    <span class="comment">// COMMAND-LINE OPTIONS (and default values from files.)</span>
    <span class="comment">//</span>

    <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a>();

    std::map&lt;string, string&gt; macros;
    std::vector&lt;int&gt; errorLineNumbers;
    std::vector&lt;string&gt; errorCommands;

    <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;

    AnyOption opt;
    <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>(argc, argv, opt);

    <span class="keywordflow">if</span> (opt.getArgc() != 0)
    {
        <span class="keywordflow">return</span> <a class="code" href="otc_2main_8cpp.html#ab3b1490f77cb396537aaf1059fca6fe5">ProcessCommand</a>(madeEasy, opt);
    }

    <span class="keywordtype">int</span> lineNumber = 0;
    <span class="keywordtype">bool</span> bEchoCommand = opt.getFlag(<span class="stringliteral">&quot;echocommand&quot;</span>) || opt.getFlag(<span class="stringliteral">&quot;test&quot;</span>);
    <span class="keywordtype">bool</span> bEchoExpand = opt.getFlag(<span class="stringliteral">&quot;echoexpand&quot;</span>) || opt.getFlag(<span class="stringliteral">&quot;test&quot;</span>);
    <span class="keywordtype">bool</span> bNoPrompt = opt.getFlag(<span class="stringliteral">&quot;noprompt&quot;</span>) || opt.getFlag(<span class="stringliteral">&quot;test&quot;</span>);
    <span class="keywordtype">int</span> processed = 0;
    <span class="keywordtype">int</span> failed = 0;
    <span class="keywordflow">while</span> (<span class="keyword">true</span>)
    {
        <span class="comment">// get next command line from input stream</span>
        <span class="keywordflow">if</span> (!bNoPrompt)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;\nopentxs&gt; &quot;</span>;
        }
        <span class="keywordtype">string</span> cmd;
        getline(std::cin, cmd);

        <span class="comment">// end of file stops processing commands</span>
        <span class="keywordflow">if</span> (std::cin.eof())
        {
            <span class="keywordflow">break</span>;
        }

        lineNumber++;

        <span class="comment">// quit/exit the command loop?</span>
        cmd = trim(cmd);
        <span class="keywordflow">if</span> (bEchoCommand)
        {
            std::cout &lt;&lt; cmd &lt;&lt; std::endl;
        }

        <span class="keywordflow">if</span> (cmd == <span class="stringliteral">&quot;quit&quot;</span> || cmd == <span class="stringliteral">&quot;exit&quot;</span>)
        {
            <span class="keywordflow">break</span>;
        }

        <span class="comment">// empty lines and lines starting with a hash character are seen as comments</span>
        <span class="keywordflow">if</span> (cmd.size() == 0 || cmd[0] == <span class="charliteral">&#39;#&#39;</span>)
        {
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordtype">string</span> originalCmd = cmd;

        <span class="comment">// lines starting with a dollar sign character denote the definition of a macro of the form:</span>
        <span class="comment">// $macroName = macroValue</span>
        <span class="comment">// whitespace around the equal sign is optional</span>
        <span class="comment">// &lt;macroName&gt; can be any combination of A-Z, a-z, 0-9, or _</span>
        <span class="comment">// &lt;macroValue&gt; is anything after the equal sign and whitespace-trimmed</span>
        <span class="comment">// note that &lt;macroValue&gt; can be an empty string</span>
        <span class="comment">// note that the dollar sign itself is part of the immediately following macro name</span>
        <span class="comment">// note that a macro value stays valid for the entire lifetime of the command loop</span>
        <span class="comment">// note that macro expansion is done on the command line before processing the line</span>
        <span class="comment">//      this means that a macro is allowed to contain command line escape characters</span>
        <span class="comment">// note that macro expansion is recursive until no expansions are found any more</span>
        <span class="comment">//      this means that a macro is allowed to contain other macros</span>
        <span class="keywordflow">if</span> (cmd[0] == <span class="charliteral">&#39;$&#39;</span>)
        {
            <span class="comment">// determine the macro name</span>
            <span class="keywordtype">size_t</span> nameLength = 1;
            <span class="keywordflow">while</span> (nameLength &lt; cmd.length() &amp;&amp; (std::isalnum(cmd[nameLength]) || cmd[nameLength] == <span class="charliteral">&#39;_&#39;</span>))
            {
                nameLength++;
            }
            <span class="keywordtype">string</span> macroName = cmd.substr(0, nameLength);

            <span class="comment">// skip whitespace</span>
            <span class="keywordtype">size_t</span> i = nameLength;
            <span class="keywordflow">while</span> (i &lt; cmd.length() &amp;&amp; std::isspace(cmd[i]))
            {
                i++;
            }

            <span class="keywordflow">if</span> (i == cmd.length() || cmd[i] != <span class="charliteral">&#39;=&#39;</span>)
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\n&quot;</span>
                    <span class="stringliteral">&quot;Expected macro definition of the form: $macroName = macroValue\n&quot;</span>
                    <span class="stringliteral">&quot;Command was: %s&quot;</span>, cmd.c_str());
                <span class="keywordflow">continue</span>;
            }

            <span class="comment">// remainder of line after trimming whitespace is macro value</span>
            <span class="keywordtype">string</span> macroValue = cmd.substr(i + 1);
            macros[macroName] = trim(macroValue);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// now replace any macro in the command line with its value</span>
        <span class="comment">// unknown macro names will cause an error message instead of command execution</span>
        <span class="comment">// note that all macro names are &#39;maximum munch&#39;</span>
        <span class="keywordtype">int</span> expansions = 0;
        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> macro = cmd.find_first_of(<span class="stringliteral">&quot;$&quot;</span>); macro != string::npos; macro = cmd.find_first_of(<span class="stringliteral">&quot;$&quot;</span>, macro + 1))
        {
            <span class="comment">// first see if this is an escaped literal</span>
            <span class="keywordflow">if</span> (macro &gt; 0 &amp;&amp; cmd[macro - 1] == <span class="charliteral">&#39;\\&#39;</span>)
            {
                <span class="keywordflow">continue</span>;
            }

            <span class="comment">// gather rest of macro name &#39;maximum munch&#39;</span>
            <span class="keywordtype">size_t</span> macroEnd = macro + 1;
            <span class="keywordflow">while</span> (macroEnd &lt; cmd.length() &amp;&amp; (std::isalnum(cmd[macroEnd]) || cmd[macroEnd] == <span class="charliteral">&#39;_&#39;</span>))
            {
                macroEnd++;
            }
            
            <span class="comment">// has this macro been defined?</span>
            <span class="keywordtype">string</span> macroName = cmd.substr(macro, macroEnd - macro);
            std::map&lt;string, string&gt;::iterator found = macros.find(macroName);
            <span class="keywordflow">if</span> (found == macros.end())
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\n&quot;</span>
                    <span class="stringliteral">&quot;Macro expansion failed.\n&quot;</span>
                    <span class="stringliteral">&quot;Unknown macro: %s\n&quot;</span>
                    <span class="stringliteral">&quot;Command was: %s&quot;</span>, macroName.c_str(), cmd.c_str());
                expansions = 100;
                <span class="keywordflow">break</span>;
            }

            <span class="keywordtype">string</span> &amp; macroValue = found-&gt;second;

            <span class="comment">// limit to 100 expansions to avoid endless recusion loop</span>
            expansions++;
            <span class="keywordflow">if</span> (expansions &gt; 100)
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\n&quot;</span>
                    <span class="stringliteral">&quot;Macro expansion failed.\n&quot;</span>
                    <span class="stringliteral">&quot;Too many expansions at macro: %s\n&quot;</span>
                    <span class="stringliteral">&quot;Command was: %s&quot;</span>, macroName.c_str(), cmd.c_str());
                <span class="keywordflow">break</span>;
            }

            <span class="comment">// limit to 10000 characters to avoid crazy recursive expansions</span>
            <span class="keywordflow">if</span> (cmd.length() + macroValue.length() &gt; 10000)
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\n&quot;</span>
                    <span class="stringliteral">&quot;Macro expansion failed.\n&quot;</span>
                    <span class="stringliteral">&quot;Command length exceeded at macro: %s\n&quot;</span>
                    <span class="stringliteral">&quot;Macro value is: %s\n&quot;</span>
                    <span class="stringliteral">&quot;Command was: %s&quot;</span>, macroName.c_str(), macroValue.c_str(), cmd.c_str());
                expansions = 100;
                <span class="keywordflow">break</span>;
            }

            <span class="comment">// expand the command line</span>
            cmd = cmd.substr(0, macro) + macroValue + cmd.substr(macroEnd);
        }

        <span class="keywordflow">if</span> (bEchoExpand &amp;&amp; cmd != originalCmd)
        {
            std::cout &lt;&lt; cmd &lt;&lt; std::endl;
        }

        <span class="comment">// skip command when anything during macro expansion failed</span>
        <span class="keywordflow">if</span> (expansions &gt; 99)
        {
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// &#39;!&#39; indicates that we expect this command to fail</span>
        <span class="comment">//     which is very useful for running a test script</span>
        <span class="keywordtype">bool</span> bExpectFailure = cmd[0] == <span class="charliteral">&#39;!&#39;</span>;

        <span class="comment">// Parse command string into its separate parts so it can be passed as an argc/argv combo</span>
        <span class="comment">// Whitespace separates args as usual.</span>
        <span class="comment">// To include whitespace in an arg surround the entire arg with double quotes</span>
        <span class="comment">// An unterminated double-quoted arg will auto-terminate at end of line</span>
        <span class="comment">// All characters are taken literal except for: double quote, dollar sign, and backslash</span>
        <span class="comment">// To take any character literal, precede it with a backslash</span>
        std::vector&lt;string&gt; arguments;

        <span class="comment">// add original command name</span>
        arguments.push_back(argv[0]);

        <span class="comment">// set up buffer that will receive the separate arguments</span>
        <span class="keywordtype">char</span> * pBuf = <span class="keyword">new</span> <span class="keywordtype">char</span>[cmd.length() + 1];
        <span class="keywordtype">char</span> * pArg = pBuf;

        <span class="comment">// start at actual command</span>
        <span class="keywordtype">size_t</span> i = bExpectFailure ? 1 : 0;
        <span class="keywordflow">while</span> (i &lt; cmd.length())
        {
            <span class="comment">// skip any whitespace</span>
            <span class="keywordflow">while</span> (i &lt; cmd.length() &amp;&amp; std::isspace(cmd[i]))
            {
                i++;
            }
            <span class="keywordflow">if</span> (i == cmd.length())
            {
                <span class="comment">// it was trailing whitespace; we&#39;re done</span>
                <span class="keywordflow">break</span>;
            }

            <span class="comment">// remember where we start this new argument in the buffer</span>
            <span class="keywordtype">char</span> * pStart = pArg;

            <span class="comment">// unquoted argument?</span>
            <span class="keywordflow">if</span> (cmd[i] != <span class="charliteral">&#39;&quot;&#39;</span>)
            {
                <span class="comment">// take everything until end of line or next whitespace</span>
                <span class="keywordflow">while</span> (i &lt; cmd.length() &amp;&amp; !std::isspace(cmd[i]))
                {
                    <span class="comment">// unescaped literal character?</span>
                    <span class="keywordflow">if</span> (cmd[i] != <span class="charliteral">&#39;\\&#39;</span>)
                    {
                        <span class="comment">// yep, add to buffer and go for next</span>
                        *pArg++ = cmd[i++];
                        <span class="keywordflow">continue</span>;
                    }

                    <span class="comment">// take next character literal unless it was the end of line</span>
                    <span class="comment">// in which case we simply add the backslash as a literal character</span>
                    *pArg++ = i &lt; cmd.length() ? cmd[i++] : <span class="charliteral">&#39;\\&#39;</span>;
                }

                <span class="comment">// end of argument reached, terminate an add to arguments array</span>
                *pArg++ = <span class="charliteral">&#39;\0&#39;</span>;
                arguments.push_back(pStart);

                <span class="comment">// look for next argument</span>
                <span class="keywordflow">continue</span>;
            }

            <span class="comment">// double quoted argument, skip the quote</span>
            i++;

            <span class="comment">// take everything until end of line or next double quote</span>
            <span class="keywordflow">while</span> (i &lt; cmd.length() &amp;&amp; cmd[i] != <span class="charliteral">&#39;&quot;&#39;</span>)
            {
                <span class="comment">// unescaped literal character?</span>
                <span class="keywordflow">if</span> (cmd[i] != <span class="charliteral">&#39;\\&#39;</span>)
                {
                    <span class="comment">// yep, add to buffer and go for next</span>
                    *pArg++ = cmd[i++];
                    <span class="keywordflow">continue</span>;
                }

                <span class="comment">// take next character literal unless it was the end of line</span>
                <span class="comment">// in which case we simply add the backslash as a literal character</span>
                *pArg++ = i &lt; cmd.length() ? cmd[i++] : <span class="charliteral">&#39;\\&#39;</span>;
            }

            <span class="comment">// end of argument reached, terminate an add to arguments array</span>
            *pArg++ = <span class="charliteral">&#39;\0&#39;</span>;
            arguments.push_back(pStart);

            <span class="comment">// skip terminating double quote or end of line</span>
            i++;
        }

        <span class="comment">//set up a new argc/argv combo</span>
        <span class="keywordtype">int</span> newArgc = arguments.size();
        <span class="keywordtype">char</span> ** newArgv = <span class="keyword">new</span> <span class="keywordtype">char</span> *[newArgc];
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; newArgc; i++)
        {
            newArgv[i] = <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(arguments[i].c_str());
        }

        <span class="comment">// preprocess the command line</span>
        AnyOption opt;
        <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>(newArgc, newArgv, opt);

        <span class="keywordtype">bool</span> bFailedCommand = 0 != <a class="code" href="otc_2main_8cpp.html#ab3b1490f77cb396537aaf1059fca6fe5">ProcessCommand</a>(madeEasy, opt);
        <span class="keywordflow">if</span> (bExpectFailure)
        {
            <span class="keywordflow">if</span> (!bFailedCommand)
            {
                failed++;
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\nExpected command to fail.\nSucceeding command was: %s&quot;</span>, cmd.c_str());
                errorLineNumbers.push_back(lineNumber);
                errorCommands.push_back(originalCmd);
            }
        }
        <span class="keywordflow">else</span>
        {
            <span class="keywordflow">if</span> (bFailedCommand)
            {
                failed++;
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\n***ERROR***\nFailed command was: %s&quot;</span>, cmd.c_str());
                errorLineNumbers.push_back(lineNumber);
                errorCommands.push_back(originalCmd);
            }
        }

        <span class="keyword">delete</span> [] newArgv;
        <span class="keyword">delete</span> [] pBuf;

        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
        processed++;
    }

    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span> &lt;&lt; processed &lt;&lt; <span class="stringliteral">&quot; commands were processed.\n&quot;</span> &lt;&lt; failed &lt;&lt; <span class="stringliteral">&quot; commands failed.\n&quot;</span> &lt;&lt; std::endl;

    <span class="keywordflow">if</span> (opt.getFlag(<span class="stringliteral">&quot;errorList&quot;</span>) || opt.getFlag(<span class="stringliteral">&quot;test&quot;</span>))
    {
        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; errorLineNumbers.size(); i++)
        {
            std::cout &lt;&lt; <span class="stringliteral">&quot;\nFailed line &quot;</span> &lt;&lt; errorLineNumbers[i] &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; errorCommands[i] &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl;
        }
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab3b1490f77cb396537aaf1059fca6fe5"></a><!-- doxytag: member="main.cpp::ProcessCommand" ref="ab3b1490f77cb396537aaf1059fca6fe5" args="(OT_ME &amp;madeEasy, AnyOption &amp;opt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="otc_2main_8cpp.html#ab3b1490f77cb396537aaf1059fca6fe5">ProcessCommand</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t___m_e.html">OT_ME</a> &amp;&#160;</td>
          <td class="paramname"><em>madeEasy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnyOption &amp;&#160;</td>
          <td class="paramname"><em>opt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00283">283</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// process command line values such as account ID, Nym ID, etc.</span>
    <span class="comment">// Also available as defaults in a config file in the ~/.ot folder</span>
    str_Args = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaultargs&quot;</span>, <span class="stringliteral">&quot;args&quot;</span>);
    str_HisAcct = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaulthisacct&quot;</span>, <span class="stringliteral">&quot;hisacct&quot;</span>);
    str_HisNym = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaulthisnym&quot;</span>, <span class="stringliteral">&quot;hisnym&quot;</span>);
    str_HisPurse = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaulthispurse&quot;</span>, <span class="stringliteral">&quot;hispurse&quot;</span>);
    str_MyAcct = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaultmyacct&quot;</span>, <span class="stringliteral">&quot;myacct&quot;</span>);
    str_MyNym = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaultmynym&quot;</span>, <span class="stringliteral">&quot;mynym&quot;</span>);
    str_MyPurse = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaultmypurse&quot;</span>, <span class="stringliteral">&quot;mypurse&quot;</span>);
    str_Server = <a class="code" href="otc_2main_8cpp.html#a5a8fb76be874fcf5e2bb9a285b0684e6">GetOption</a>(opt, <span class="stringliteral">&quot;defaultserver&quot;</span>, <span class="stringliteral">&quot;server&quot;</span>);

    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pWallet, <span class="stringliteral">&quot;The wallet object is still NULL, somehow. Please load it.\n&quot;</span>);

    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServerContract = NULL;
    <span class="keywordflow">if</span> (str_Server.size() &gt; 0)
    {
        pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ae897619f652a0d3d9fba99a8bc747993">GetServerContract</a>(str_Server);
        <span class="keywordflow">if</span> (NULL == pServerContract)
        {
            pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a2c08b5bd12930371f99e793762819dd5">GetServerContractPartialMatch</a>(str_Server);
            <span class="keywordflow">if</span> (NULL == pServerContract)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract. Please use the option:  --server SERVER_ID\n&quot;</span>
                    <span class="stringliteral">&quot;(Where SERVER_ID is the server ID. Partial matches are accepted if the contract is already in the wallet.)\n&quot;</span>
                    <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
            }
        }
        <span class="keywordflow">if</span> (NULL != pServerContract)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strTemp);
            str_Server = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as server: %s\n&quot;</span>, str_Server.c_str());
        }
    }
    <span class="keywordflow">if</span> (NULL == pServerContract)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract to use. Please use the option: --server SERVER_ID\n&quot;</span>
            <span class="stringliteral">&quot;(Where SERVER_ID is the str_Server&#39;s ID. Partial matches ARE accepted.)\n&quot;</span>);
    }

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMyNym = NULL;
    <span class="keywordflow">if</span> (str_MyNym.size() &gt; 0)
    {
        pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(str_MyNym);
        <span class="keywordflow">if</span> (NULL == pMyNym)
        {
            pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>(str_MyNym);
            <span class="keywordflow">if</span> (NULL == pMyNym)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;==&gt; Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
                    <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches are accepted if the nym is already in the wallet.)\n&quot;</span>
                    <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
            }
        }
        <span class="keywordflow">if</span> (NULL != pMyNym)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strTemp);
            str_MyNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mynym: %s\n&quot;</span>, str_MyNym.c_str());
        }
    }
    <span class="keywordflow">if</span> (NULL == pMyNym)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
            <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches and names are accepted.)\n&quot;</span>);
    }

    <a class="code" href="class_o_t_account.html">OTAccount</a> * pMyAccount = NULL;
    <span class="keywordflow">if</span> (str_MyAcct.size() &gt; 0)
    {
        pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(str_MyAcct);
        <span class="keywordflow">if</span> (NULL == pMyAccount)
        {
            pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>(str_MyAcct);
            <span class="keywordflow">if</span> (NULL == pMyAccount)
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Aborting: Unable to find specified myacct: %s\n&quot;</span>, str_MyAcct.c_str());
                <span class="keywordflow">return</span> 0;
            }
        }
        <span class="keywordflow">if</span> (NULL != pMyAccount)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pMyAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>().<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strTemp);
            str_MyAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as myacct: %s\n&quot;</span>, str_MyAcct.c_str());
        }
    }

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pHisNym = NULL;
    <span class="keywordflow">if</span> (str_HisNym.size() &gt; 0)
    {
        pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(str_HisNym);
        <span class="keywordflow">if</span> (NULL == pHisNym)
        {
            pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>(str_HisNym);
        }
        <span class="keywordflow">if</span> (NULL != pHisNym)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pHisNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strTemp);
            str_HisNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisnym: %s\n&quot;</span>, str_HisNym.c_str());
        }
    }

    <a class="code" href="class_o_t_account.html">OTAccount</a> * pHisAccount = NULL;
    <span class="keywordflow">if</span> (str_HisAcct.size() &gt; 0)
    {
        pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(str_HisAcct);
        <span class="keywordflow">if</span> (NULL == pHisAccount)
        {
            pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>(str_HisAcct);
        }
        <span class="keywordflow">if</span> (NULL != pHisAccount)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pHisAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>().<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strTemp);
            str_HisAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisacct: %s\n&quot;</span>, str_HisAcct.c_str());
        }
    }

    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> thePurseAssetTypeID;
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pMyAssetContract = NULL;
    <span class="keywordflow">if</span> (str_MyPurse.size() &gt; 0)
    {
        pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(str_MyPurse);
        <span class="keywordflow">if</span> (NULL == pMyAssetContract)
        {
            pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>(str_MyPurse);
        }
        <span class="keywordflow">if</span> (NULL != pMyAssetContract)
        {
            pMyAssetContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(thePurseAssetTypeID);
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pMyAssetContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strTemp);
            str_MyPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mypurse: %s\n&quot;</span>, str_MyPurse.c_str());
        }
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// if no purse (asset type) ID was provided, but MyAccount WAS provided, then</span>
        <span class="comment">// use the asset type for the account instead.</span>
        <span class="keywordflow">if</span> (NULL != pMyAccount)
        {
            thePurseAssetTypeID = pMyAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
            <span class="keywordflow">if</span> (!thePurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp(thePurseAssetTypeID);
                str_MyPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mypurse: %s\n&quot;</span>, str_MyPurse.c_str());
            }
        }
    }

    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> hisPurseAssetTypeID;
    <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pHisAssetContract = NULL;
    <span class="keywordflow">if</span> (str_HisPurse.size() &gt; 0)
    {
        pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(str_HisPurse);
        <span class="keywordflow">if</span> (NULL == pHisAssetContract)
        {
            pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>(str_HisPurse);
        }
        <span class="keywordflow">if</span> (NULL != pHisAssetContract)
        {
            pHisAssetContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(hisPurseAssetTypeID);
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pHisAssetContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strTemp);
            str_HisPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hispurse: %s\n&quot;</span>, str_HisPurse.c_str());
        }
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// If no &quot;HisPurse&quot; was provided, but str_HisAcct WAS, then we use the</span>
        <span class="comment">// asset type of str_HisAcct as str_HisPurse.</span>
        <span class="keywordflow">if</span> (NULL != pHisAccount)
        {
            hisPurseAssetTypeID = pHisAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>();
        }
    }

    <span class="keywordflow">if</span> (!hisPurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strTempAssetType(hisPurseAssetTypeID);
        str_HisPurse = strTempAssetType.Get();
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hispurse: %s\n&quot;</span>, str_HisPurse.c_str());
    }

    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);

    <span class="keywordflow">if</span> (NULL != pServerContract &amp;&amp; NULL != pMyNym)
    {
        <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServerContract, *pMyNym, <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetTransportCallback());
    }

    <span class="keywordflow">if</span> (str_Args.size() &gt; 0)
    {
        str_Args += <span class="stringliteral">&quot; &quot;</span>;
    }
    str_Args += <span class="stringliteral">&quot;ot_cli_command &quot;</span>;

    <span class="keywordflow">if</span> (opt.getArgc() == 1)
    {
        str_Args += opt.getArgv(0);;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Expecting a single opentxs command:\n\n&quot;</span>);
        str_Args += <span class="stringliteral">&quot;list&quot;</span>;
    }

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelArgs(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;Args&quot;</span>, str_Args));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyAcct(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;MyAcct&quot;</span>, str_MyAcct));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyNym(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;MyNym&quot;</span>, str_MyNym));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyPurse(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;MyPurse&quot;</span>, str_MyPurse));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisAcct(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;HisAcct&quot;</span>, str_HisAcct));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisNym(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;HisNym&quot;</span>, str_HisNym));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisPurse(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;HisPurse&quot;</span>, str_HisPurse));
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelServer(<a class="code" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a>(madeEasy, <span class="stringliteral">&quot;Server&quot;</span>, str_Server));

    madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();

    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(1, <span class="stringliteral">&quot;Script output:\n\n&quot;</span>);

    <span class="keywordtype">int</span> result = madeEasy.<a class="code" href="class_o_t___m_e.html#a78acf0395f07f0f958c1616b406343b8">opentxs_main_loop</a>();
    <span class="keywordflow">return</span> opt.getArgc() == 1 ? result : -2;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a78c2ccdd15bf5e3638258c350d4d5bc3"></a><!-- doxytag: member="main.cpp::SetGlobalVariable" ref="a78c2ccdd15bf5e3638258c350d4d5bc3" args="(OT_ME &amp;madeEasy, const string &amp;name, const string &amp;value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_variable.html">OTVariable</a>* <a class="el" href="otc_2main_8cpp.html#a78c2ccdd15bf5e3638258c350d4d5bc3">SetGlobalVariable</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t___m_e.html">OT_ME</a> &amp;&#160;</td>
          <td class="paramname"><em>madeEasy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otc_2main_8cpp_source.html#l00266">266</a> of file <a class="el" href="otc_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (value.size() == 0)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;Variable %s isn&#39;t set\n&quot;</span>, name.c_str());
        <span class="keywordflow">return</span> NULL;
    }

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Variable %s has value: %s\n&quot;</span>, name.c_str(), value.c_str());

    <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(name, value, <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
    madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(name, *pVar);
    <span class="keywordflow">return</span> pVar;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="otc_2main_8cpp.html">main.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:05 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
