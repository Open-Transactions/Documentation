<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otd/main.cpp File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('otd_2main_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">src/otd/main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="stdafx_8hpp_source.html">stdafx.hpp</a>&gt;</code><br/>
<code>#include &lt;anyoption.hpp&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_a_p_i_8hpp_source.html">OTAPI.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_open_transactions_8hpp_source.html">OpenTransactions.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t___m_e_8hpp_source.html">OT_ME.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_client_8hpp_source.html">OTClient.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_log_8hpp_source.html">OTLog.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_paths_8hpp_source.html">OTPaths.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_wallet_8hpp_source.html">OTWallet.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_server_contract_8hpp_source.html">OTServerContract.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_message_8hpp_source.html">OTMessage.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_purse_8hpp_source.html">OTPurse.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_envelope_8hpp_source.html">OTEnvelope.hpp</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="_o_t_account_8hpp_source.html">OTAccount.hpp</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ot__me__switch_8hpp_source.html">ot_me_switch.hpp</a>&quot;</code><br/>
<code>#include &lt;iterator&gt;</code><br/>
</div>
<p><a href="otd_2main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>&#160;&#160;&#160;&quot;command-line-ot.opt&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#a2dc726b0ac838ad497799e6a133406be">CLIENT_PATH_DEFAULT</a>&#160;&#160;&#160;&quot;client_data&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#acb842c842033e836cb504f29b1de8479">CA_FILE</a>&#160;&#160;&#160;&quot;certs/special/ca.crt&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#a28b23a8efb961adcb6459e388ddd2b45">KEY_FILE</a>&#160;&#160;&#160;&quot;certs/special/client.pem&quot;</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a> (int32_t argc, char *argv[], AnyOption *opt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a> (std::string &amp;str_ServerID, std::string &amp;str_MyNym, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&amp;pMyNym, <a class="el" href="class_o_t_wallet.html">OTWallet</a> *&amp;pWallet, <a class="el" href="class_o_t_server_contract.html">OTServerContract</a> *&amp;pServerContract)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">CollectDefaultedCLValues</a> (AnyOption *opt, std::string &amp;str_ServerID, std::string &amp;str_MyAcct, std::string &amp;str_MyNym, std::string &amp;str_MyPurse, std::string &amp;str_HisAcct, std::string &amp;str_HisNym, std::string &amp;str_HisPurse)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otd_2main_8cpp.html#abbc50c23c5192bfa8579c0c06a87fcd9">main</a> (int32_t argc, char *argv[])</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="acb842c842033e836cb504f29b1de8479"></a><!-- doxytag: member="main.cpp::CA_FILE" ref="acb842c842033e836cb504f29b1de8479" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="otd_2main_8cpp.html#acb842c842033e836cb504f29b1de8479">CA_FILE</a>&#160;&#160;&#160;&quot;certs/special/ca.crt&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00165">165</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2dc726b0ac838ad497799e6a133406be"></a><!-- doxytag: member="main.cpp::CLIENT_PATH_DEFAULT" ref="a2dc726b0ac838ad497799e6a133406be" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="otd_2main_8cpp.html#a2dc726b0ac838ad497799e6a133406be">CLIENT_PATH_DEFAULT</a>&#160;&#160;&#160;&quot;client_data&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00162">162</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a28b23a8efb961adcb6459e388ddd2b45"></a><!-- doxytag: member="main.cpp::KEY_FILE" ref="a28b23a8efb961adcb6459e388ddd2b45" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="otd_2main_8cpp.html#a28b23a8efb961adcb6459e388ddd2b45">KEY_FILE</a>&#160;&#160;&#160;&quot;certs/special/client.pem&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00166">166</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac81684a3952e5289a620e3d1cb58d80c"></a><!-- doxytag: member="main.cpp::OT_OPTIONS_FILE_DEFAULT" ref="ac81684a3952e5289a620e3d1cb58d80c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="otc_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>&#160;&#160;&#160;&quot;command-line-ot.opt&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00161">161</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abde9c51a6c92e2d836ed010c533ffede"></a><!-- doxytag: member="main.cpp::CollectDefaultedCLValues" ref="abde9c51a6c92e2d836ed010c533ffede" args="(AnyOption *opt, std::string &amp;str_ServerID, std::string &amp;str_MyAcct, std::string &amp;str_MyNym, std::string &amp;str_MyPurse, std::string &amp;str_HisAcct, std::string &amp;str_HisNym, std::string &amp;str_HisPurse)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">CollectDefaultedCLValues</a> </td>
          <td>(</td>
          <td class="paramtype">AnyOption *&#160;</td>
          <td class="paramname"><em>opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_ServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_MyAcct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_MyNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_MyPurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_HisAcct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_HisNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_HisPurse</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00455">455</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != opt);

    <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;\n&quot;</span>);

    <span class="comment">// First we pre-set all the values based on the defaults from the options file.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultserver&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;Server default: &quot; &lt;&lt; (str_ServerID = opt-&gt;getValue( &quot;defaultserver&quot; )) &lt;&lt; endl;</span>
        str_ServerID = opt-&gt;getValue( <span class="stringliteral">&quot;defaultserver&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Server default: %s \n&quot;</span>, str_ServerID.c_str());
    }

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmyacct&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyAcct default: &quot; &lt;&lt; (str_MyAcct = opt-&gt;getValue( &quot;defaultmyacct&quot; )) &lt;&lt; endl;</span>
        str_MyAcct = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmyacct&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyAcct default: %s \n&quot;</span>, str_MyAcct.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmynym&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyNym default: &quot; &lt;&lt; (str_MyNym = opt-&gt;getValue( &quot;defaultmynym&quot; )) &lt;&lt; endl;</span>
        str_MyNym = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmynym&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyNym default: %s \n&quot;</span>, str_MyNym.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaultmypurse&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyPurse default: &quot; &lt;&lt; (str_MyPurse = opt-&gt;getValue( &quot;defaultmypurse&quot; )) &lt;&lt; endl;</span>
        str_MyPurse = opt-&gt;getValue( <span class="stringliteral">&quot;defaultmypurse&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyPurse default: %s \n&quot;</span>, str_MyPurse.c_str());
    }

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisacct&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisAcct default: &quot; &lt;&lt; (str_HisAcct = opt-&gt;getValue( &quot;defaulthisacct&quot; )) &lt;&lt; endl;</span>
        str_HisAcct = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisacct&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisAcct default: %s \n&quot;</span>, str_HisAcct.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisnym&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisNym default: &quot; &lt;&lt; (str_HisNym = opt-&gt;getValue( &quot;defaulthisnym&quot; )) &lt;&lt; endl;</span>
        str_HisNym = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthisnym&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisNym default: %s \n&quot;</span>, str_HisNym.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;defaulthispurse&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisPurse default: &quot; &lt;&lt; (str_HisPurse = opt-&gt;getValue( &quot;defaulthispurse&quot; )) &lt;&lt; endl;</span>
        str_HisPurse = opt-&gt;getValue( <span class="stringliteral">&quot;defaulthispurse&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisPurse default: %s \n&quot;</span>, str_HisPurse.c_str());
    }

    <span class="comment">// --------------</span>
    <span class="comment">// Next, we overwrite those with any that were passed in on the command line.</span>

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;server&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;Server from command-line: &quot; &lt;&lt; (str_ServerID = opt-&gt;getValue( &quot;server&quot; )) &lt;&lt; endl;</span>
        str_ServerID = opt-&gt;getValue( <span class="stringliteral">&quot;server&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Server from command-line: %s \n&quot;</span>, str_ServerID.c_str());
    }

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;myacct&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyAcct from command-line: &quot; &lt;&lt; (str_MyAcct = opt-&gt;getValue( &quot;myacct&quot; )) &lt;&lt; endl;</span>
        str_MyAcct = opt-&gt;getValue( <span class="stringliteral">&quot;myacct&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyAcct from command-line: %s \n&quot;</span>, str_MyAcct.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;mynym&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyNym from command-line: &quot; &lt;&lt; (str_MyNym = opt-&gt;getValue( &quot;mynym&quot; )) &lt;&lt; endl;</span>
        str_MyNym = opt-&gt;getValue( <span class="stringliteral">&quot;mynym&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyNym from command-line: %s \n&quot;</span>, str_MyNym.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;mypurse&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;MyPurse from command-line: &quot; &lt;&lt; (str_MyPurse = opt-&gt;getValue( &quot;mypurse&quot; )) &lt;&lt; endl;</span>
        str_MyPurse = opt-&gt;getValue( <span class="stringliteral">&quot;mypurse&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;MyPurse from command-line: %s \n&quot;</span>, str_MyPurse.c_str());
    }

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hisacct&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisAcct from command-line: &quot; &lt;&lt; (str_HisAcct = opt-&gt;getValue( &quot;hisacct&quot; )) &lt;&lt; endl;</span>
        str_HisAcct = opt-&gt;getValue( <span class="stringliteral">&quot;hisacct&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisAcct from command-line: %s \n&quot;</span>, str_HisAcct.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hisnym&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisNym from command-line: &quot; &lt;&lt; (str_HisNym = opt-&gt;getValue( &quot;hisnym&quot; )) &lt;&lt; endl;</span>
        str_HisNym = opt-&gt;getValue( <span class="stringliteral">&quot;hisnym&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisNym from command-line: %s \n&quot;</span>, str_HisNym.c_str());
    }
    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;hispurse&quot;</span> ) != NULL )
    {
<span class="comment">//      cerr &lt;&lt; &quot;HisPurse from command-line: &quot; &lt;&lt; (str_HisPurse = opt-&gt;getValue( &quot;hispurse&quot; )) &lt;&lt; endl;</span>
        str_HisPurse = opt-&gt;getValue( <span class="stringliteral">&quot;hispurse&quot;</span> );
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;HisPurse from command-line: %s \n&quot;</span>, str_HisPurse.c_str());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33a81b8c50c444068b7358df3ba22b0c"></a><!-- doxytag: member="main.cpp::HandleCommandLineArguments" ref="a33a81b8c50c444068b7358df3ba22b0c" args="(int32_t argc, char *argv[], AnyOption *opt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="otc_2main_8cpp.html#aeae1ff01fe9cbe8c4849f63e134babfb">HandleCommandLineArguments</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AnyOption *&#160;</td>
          <td class="paramname"><em>opt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00287">287</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (NULL == opt)
        <span class="keywordflow">return</span>;

    <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath(<a class="code" href="class_o_t_paths.html#a6634797ea86b0da2d66a816e604b538b">OTPaths::AppDataFolder</a>());
    { <span class="keywordtype">bool</span> GetConfigPathSuccess = strConfigPath.Exists() &amp;&amp; 3 &lt; strConfigPath.GetLength();
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(GetConfigPathSuccess,<span class="stringliteral">&quot;HandleCommandLineArguments:  Must Set Conifg Path First!&quot;</span>); }



    <span class="comment">/* 1. CREATE AN OBJECT */</span>
    <span class="comment">//    AnyOption *opt = new AnyOption();</span>
    <span class="comment">//    OT_ASSERT(NULL != opt);</span>
    <span class="comment">//    OTCleanup&lt;AnyOption&gt; theOptionAngel(opt);</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/* 2. SET PREFERENCES  */</span>
    <span class="comment">//opt-&gt;noPOSIX(); /* do not check for POSIX style character options */</span>
    <span class="comment">//opt-&gt;setVerbose(); /* print warnings about unknown options */</span>
    <span class="comment">//opt-&gt;autoUsagePrint(true); /* print usage for bad options */</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/* 3. SET THE USAGE/HELP   */</span>
    opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot; **** NOTE: DO NOT USE &#39;ot&#39; !! Use &#39;opentxs help&#39; instead! *** OT CLI Usage:  &quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --stat (Prints the wallet contents)    ot --prompt (Enter the OT prompt)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  [-h|-?|--help]    (Prints this help)   ot --script &lt;filename&gt; [--args \&quot;key value ...\&quot;]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;The &#39;|&#39; symbol means use --balance or -b, use --withdraw or -w, etc.&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;The brackets &#39;[]&#39; show required arguments, where default values are&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;normally expected to be found in:   ~/.ot/command-line-ot.opt&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --balance  | -b          [--myacct &lt;acct_id&gt;]   (Display account balance)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --withdraw | -w &lt;amount&gt; [--myacct &lt;acct_id&gt;]   (Withdraw as CASH)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --transfer | -t &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisacct &lt;acct_id&gt;]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --cheque   | -c &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisnym  &lt;nym_id&gt; ]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --voucher  | -v &lt;amount&gt; [--myacct &lt;acct_id&gt;] [--hisnym  &lt;nym_id&gt; ]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --depositcheque  [--myacct &lt;acct_id&gt;]   (Deposit a cheque.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --depositpurse   [--myacct &lt;acct_id&gt;]   (Deposit a cash purse.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --deposittokens  [--myacct &lt;acct_id&gt;]   (Deposit individual cash tokens.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --inbox    | -i  [--myacct &lt;acct_id&gt;]   (Display the inbox.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --sign     | -s  [--mynym  &lt;nym_id&gt; ]   (Sign a contract.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --verify         [--mynym  &lt;nym_id&gt; ]   (Verify a signature.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --purse    | -p   &lt;arguments&gt;           (Display a purse.)&quot;</span>);
    opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments:     [--mynym  &lt;nym_id&gt; ] [--mypurse &lt;asset_type_id&gt;]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --refresh  | -r  [--myacct &lt;acct_id&gt;]    (Download account files from server.)&quot;</span>);
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --refreshnym     [--mynym  &lt;nym_id&gt; ]    (Download nym files from server.)&quot;</span>);
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot  --marketoffer    [--mynym  &lt;nym_id&gt; ]    (Place an offer on a market.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;Also, [--server &lt;server_id&gt;] will work with all of the above.&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;Recurring payments:&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot --proposeplan  &lt;arguments&gt;   (Merchant)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments: [--mynym  &lt;nym_id&gt; ] [--myacct  &lt;acct_id&gt;]  (continued.)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;  Continued: [--hisnym &lt;nym_id&gt; ] [--hisacct &lt;acct_id&gt; ]&quot;</span>);
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot --confirmplan  &lt;arguments&gt;   (Customer)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;ot --activateplan &lt;arguments&gt;   (Customer again)&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot;  Arguments: [--mynym  &lt;nym_id&gt; ] [--myacct  &lt;acct_id&gt;]&quot;</span> );
    opt-&gt;addUsage( <span class="stringliteral">&quot; **** NOTE: DO NOT USE &#39;ot&#39; !! Use &#39;opentxs help&#39; instead! ***&quot;</span> );

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/* 4. SET THE OPTION STRINGS/CHARACTERS */</span>
    <span class="comment">//</span>
    <span class="comment">// COMMAND LINE *AND* RESOURCE FILE</span>

<span class="comment">//  opt-&gt;setOption(  &quot;server&quot; );      /* an option (takes an argument), supporting only int64_t form */</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/* 4. SET THE OPTION STRINGS/CHARACTERS */</span>
    <span class="comment">//</span>
    <span class="comment">// COMMAND LINE *AND* RESOURCE FILE</span>

    <span class="comment">//  opt-&gt;setOption(  &quot;server&quot; );      /* an option (takes an argument), supporting only int64_t form */</span>

    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// COMMAND LINE ONLY</span>
    <span class="comment">/* for options that will be checked only on the command and line not in option/resource file */</span>
    <span class="comment">//    opt-&gt;setCommandFlag(  &quot;zip&quot; , &#39;z&#39;); /* a flag (takes no argument), supporting int64_t and short form */</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;withdraw&quot;</span> , <span class="charliteral">&#39;w&#39;</span>);   <span class="comment">// withdraw from acct to purse, myacct, topurse</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;transfer&quot;</span> , <span class="charliteral">&#39;t&#39;</span>);   <span class="comment">// transfer acct-to-acct, myacct, toacct</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;cheque&quot;</span> ,   <span class="charliteral">&#39;c&#39;</span>);   <span class="comment">// write a cheque   myacct, tonym</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;voucher&quot;</span> ,  <span class="charliteral">&#39;v&#39;</span>);   <span class="comment">// withdraw voucher myacct, tonym</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;marketoffer&quot;</span>   );   <span class="comment">// add an offer to the market.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;balance&quot;</span> ,  <span class="charliteral">&#39;b&#39;</span>);   <span class="comment">// Display account balance</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;depositcheque&quot;</span> );   <span class="comment">// deposit a cheque to myacct</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;depositpurse&quot;</span>  );   <span class="comment">// deposit cash purse to myacct</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;deposittokens&quot;</span> );   <span class="comment">// deposit individual cash tokens to myacct</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;proposeplan&quot;</span>   );   <span class="comment">// Merchant proposes a payment plan.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;confirmplan&quot;</span>   );   <span class="comment">// Customer confirms a payment plan.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;activateplan&quot;</span>  );   <span class="comment">// Customer activates a payment plan.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;inbox&quot;</span> ,    <span class="charliteral">&#39;i&#39;</span>);   <span class="comment">// displays inbox (for ACCT_ID...)</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;sign&quot;</span> ,     <span class="charliteral">&#39;s&#39;</span>);   <span class="comment">// sign a contract  mynym</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;verify&quot;</span>        );   <span class="comment">// verify a signature</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;purse&quot;</span> ,    <span class="charliteral">&#39;p&#39;</span>);   <span class="comment">// display purse contents.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;refresh&quot;</span> ,  <span class="charliteral">&#39;r&#39;</span>);   <span class="comment">// refresh intermediary files from server + verify against last receipt.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;refreshnym&quot;</span>    );   <span class="comment">// refresh intermediary files from server + verify against last receipt.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;stat&quot;</span> );            <span class="comment">// print out the wallet contents.</span>
    opt-&gt;setCommandFlag(  <span class="stringliteral">&quot;prompt&quot;</span> );          <span class="comment">// Enter the OT prompt.</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;script&quot;</span> );          <span class="comment">// Process a script from out of a scriptfile</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;args&quot;</span>);             <span class="comment">// Pass custom arguments from command line: --args &quot;key1 value1 key2 \&quot;here is value2\&quot; key3 value3&quot;</span>

    opt-&gt;setCommandFlag(<span class="stringliteral">&quot;help&quot;</span>, <span class="charliteral">&#39;h&#39;</span>);   <span class="comment">// the Help screen.</span>
    opt-&gt;setCommandFlag(<span class="charliteral">&#39;?&#39;</span>);           <span class="comment">// the Help screen.</span>

    <span class="comment">/*</span>
<span class="comment">    --myacct   (ACCT ID)</span>
<span class="comment">    --mynym    (NYM ID)</span>
<span class="comment">    --mypurse  (ASSET TYPE ID)</span>
<span class="comment"></span>
<span class="comment">    --toacct   (ACCT ID)</span>
<span class="comment">    --tonym    (NYM ID)</span>
<span class="comment">    --topurse  (ASSET TYPE ID)</span>
<span class="comment">    */</span>
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;server&quot;</span>);

    opt-&gt;setCommandOption(<span class="stringliteral">&quot;myacct&quot;</span>);
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;mynym&quot;</span>);
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;mypurse&quot;</span>);
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;hisacct&quot;</span>);
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;hisnym&quot;</span>);
    opt-&gt;setCommandOption(<span class="stringliteral">&quot;hispurse&quot;</span>);

    <span class="comment">// NOTE: Above and Below me are IDs. This interface should allow PARTIAL IDs.</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// RESOURCE FILE ONLY</span>
    <span class="comment">/* for options that will be checked only from the option/resource file */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultserver&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>

    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmyacct&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmynym&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaultmypurse&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthisacct&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthisnym&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    opt-&gt;setFileOption(  <span class="stringliteral">&quot;defaulthispurse&quot;</span> ); <span class="comment">/* an option (takes an argument), supporting only int64_t form */</span>
    <span class="comment">/*</span>
<span class="comment">    --defaultmyacct   (ACCT ID)</span>
<span class="comment">    --defaultmynym    (NYM ID)</span>
<span class="comment">    --defaultmypurse  (ASSET TYPE ID)</span>
<span class="comment"></span>
<span class="comment">    --defaulttoacct   (ACCT ID)</span>
<span class="comment">    --defaulttonym    (NYM ID)</span>
<span class="comment">    --defaulttopurse  (ASSET TYPE ID)</span>
<span class="comment">    */</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/* 5. PROCESS THE COMMANDLINE AND RESOURCE FILE */</span>

    <span class="comment">/* read options from a option/resource file with &#39;:&#39; separated options or flags, one per line */</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strOptionsFile(<a class="code" href="otd_2main_8cpp.html#ac81684a3952e5289a620e3d1cb58d80c">OT_OPTIONS_FILE_DEFAULT</a>), strIniFileExact;
    { <span class="keywordtype">bool</span> bBuildFullPathSuccess = <a class="code" href="class_o_t_paths.html#a73f191305215a5a10158a927b01f53da">OTPaths::RelativeToCanonical</a>(strIniFileExact,strConfigPath,strOptionsFile);
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bBuildFullPathSuccess,<span class="stringliteral">&quot;Unalbe to set Full Path&quot;</span>); }

    <span class="comment">// -----------------------------------------------------</span>
    opt-&gt;processFile( strIniFileExact.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() );
    <span class="comment">// -----------------------------------------------------</span>
    opt-&gt;processCommandArgs( argc, argv );
}
</pre></div>
</div>
</div>
<a class="anchor" id="abbc50c23c5192bfa8579c0c06a87fcd9"></a><!-- doxytag: member="main.cpp::main" ref="abbc50c23c5192bfa8579c0c06a87fcd9" args="(int32_t argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="otc_2main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00571">571</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------------------</span>
    <span class="keyword">class </span>__OTclient_RAII
    {
    <span class="keyword">public</span>:
        __OTclient_RAII()
        {
            <span class="comment">// OT_API class exists only on the client side.</span>

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8be8d3b92ff715548929dfecc1919801">OTAPI_Wrap::AppInit</a>();     <span class="comment">// SSL gets initialized in here, before any keys are loaded.</span>
        }
        ~__OTclient_RAII()
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#a3fc341c4f43727c1b195d8d86e47e9db">OTAPI_Wrap::AppCleanup</a>();
        }
    };
    <span class="comment">// --------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// This makes SURE that AppCleanup() gets called before main() exits (without any</span>
    <span class="comment">// twisted logic being necessary below, for that to happen.)</span>
    <span class="comment">//</span>
    __OTclient_RAII   the_client_cleanup;
    <span class="comment">// -------------------------------------------------------------------</span>
    <span class="comment">//</span>

    <span class="keywordflow">if</span> (NULL == <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()) <span class="keywordflow">return</span> -1;  <span class="comment">// error out if we don&#39;t have the API.</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strConfigPath(<a class="code" href="class_o_t_paths.html#a6634797ea86b0da2d66a816e604b538b">OTPaths::AppDataFolder</a>());
    <span class="keywordtype">bool</span> bConfigPathFound = strConfigPath.Exists() &amp;&amp; 3 &lt; strConfigPath.GetLength();

    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bConfigPathFound,<span class="stringliteral">&quot;RegisterAPIWithScript: Must set Config Path first!\n&quot;</span>);

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Using configuration path:  %s\n&quot;</span>, strConfigPath.Get());

<span class="comment">//    OTLog::vOutput(0, &quot;Prefix Path:  %s\n&quot;, OTPaths::PrefixFolder().Get());</span>
<span class="comment">//    OTLog::vOutput(0, &quot;Scripts Path:  %s\n&quot;, OTPaths::ScriptsFolder().Get());</span>
<span class="comment">//</span>
<span class="comment">//    OTString out_strHomeFolder;</span>
<span class="comment">//    OTPaths::GetHomeFromSystem(out_strHomeFolder);</span>
<span class="comment">//    OTLog::vOutput(0, &quot;Home from System:  %s\n&quot;, out_strHomeFolder.Get());</span>
    <span class="comment">// -------------------------------------------------------------------</span>

    <span class="comment">// COMMAND-LINE OPTIONS (and default values from files.)</span>
    <span class="comment">//</span>
    AnyOption *opt = <span class="keyword">new</span> AnyOption();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != opt);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;AnyOption&gt;</a> theOptionAngel(opt);

    <span class="comment">// Process the command line args</span>
    <span class="comment">//</span>
    <a class="code" href="otd_2main_8cpp.html#a33a81b8c50c444068b7358df3ba22b0c">HandleCommandLineArguments</a>( argc, argv, opt);


    <span class="comment">// command line values such as account ID, Nym ID, etc.</span>
    <span class="comment">// Also available as defaults in a config file in the ~/.ot folder</span>
    <span class="comment">//</span>
    std::string str_ServerID;

    std::string str_MyAcct;
    std::string str_MyNym;
    std::string str_MyPurse;

    std::string str_HisAcct;
    std::string str_HisNym;
    std::string str_HisPurse;

    <a class="code" href="otd_2main_8cpp.html#abde9c51a6c92e2d836ed010c533ffede">CollectDefaultedCLValues</a>(opt,
        str_ServerID,
        str_MyAcct,
        str_MyNym,
        str_MyPurse,
        str_HisAcct,
        str_HisNym,
        str_HisPurse);
    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Users can put --args &quot;key value key value key value etc&quot;</span>
    <span class="comment">// Then they can access those values from within their scripts.</span>

    std::string str_Args;

    <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;args&quot;</span> ) != NULL )
        cerr &lt;&lt; <span class="stringliteral">&quot;User-defined arguments aka:  --args &quot;</span> &lt;&lt; (str_Args = opt-&gt;getValue( <span class="stringliteral">&quot;args&quot;</span> )) &lt;&lt; endl;

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">/*  USAGE SCREEN (HELP) */</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;help&quot;</span> ) || opt-&gt;getFlag( <span class="charliteral">&#39;h&#39;</span> )  || opt-&gt;getFlag( <span class="charliteral">&#39;?&#39;</span> ) )
    {
        opt-&gt;printUsage();

        <span class="keywordflow">return</span> 0;
    }
    <span class="comment">// -----------------------------------------------------</span>

    <span class="keywordtype">bool</span> bIsCommandProvided = <span class="keyword">false</span>;

    <span class="comment">// See if there&#39;s a COMMAND chosen at command line.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ( opt -&gt;hasOptions())
    {
        <span class="comment">// Below are COMMANDS (only one of them can be true...)</span>
        <span class="comment">//</span>

        <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;withdraw&quot;</span> ) != NULL  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;withdraw amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;transfer&quot;</span> ) != NULL  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;transfer amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;cheque&quot;</span> ) != NULL  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;cheque amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(  opt-&gt;getFlag( <span class="stringliteral">&quot;marketoffer&quot;</span> ) == true  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;marketoffer flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;voucher&quot;</span> ) != NULL  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;voucher amount = &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;depositcheque&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit cheque flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;depositpurse&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit purse flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;deposittokens&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;deposit tokens flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;proposepaymentplan&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;proposepaymentplan flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;confirmpaymentplan&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;confirm payment plan flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;activatepaymentplan&quot;</span> ) )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;activate payment plan flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;b&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;balance&quot;</span> )  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;balance flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;i&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;inbox&quot;</span> )  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;inbox flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;p&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;purse&quot;</span> )  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;purse flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;s&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;sign&quot;</span> ))
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;sign flag set &quot;</span> &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;verify&quot;</span> )  )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;verify flag set &quot;</span> &lt;&lt; endl; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;stat&quot;</span> )   )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;stat flag set &quot;</span>  &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> )   )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;prompt flag set &quot;</span>  &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> )  != NULL )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;script filename: &quot;</span> &lt;&lt; opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ) &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;r&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;refresh&quot;</span> )   )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;refresh flag set &quot;</span>  &lt;&lt; endl ; }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;refreshnym&quot;</span> )   )
        { bIsCommandProvided = <span class="keyword">true</span>; cerr &lt;&lt; <span class="stringliteral">&quot;refreshnym flag set &quot;</span>  &lt;&lt; endl ; }

        cerr &lt;&lt; endl ;
    }
    <span class="keywordflow">else</span>
        bIsCommandProvided = <span class="keyword">false</span>;

    <span class="comment">// ---------------------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span>(!(opt-&gt;getArgc() &gt; 0) &amp;&amp;
        (<span class="keyword">false</span> == bIsCommandProvided) )   <span class="comment">// If no command was provided (though other command-line options may have been...)</span>
    {                           <span class="comment">// then we expect a script to come in through stdin, and we run it through the script interpreter!</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n\nYou probably don&#39;t want to do this... Use CTRL-C, and try \&quot;ot --help\&quot; for instructions.\n\n &quot;</span>
            <span class="stringliteral">&quot;==&gt; Expecting ot script from standard input. (Terminate with CTRL-D):\n\n&quot;</span>);

        <span class="comment">// ----------------------------------------</span>
        <span class="comment">// don&#39;t skip the whitespace while reading</span>
        std::cin &gt;&gt; std::noskipws;

        <span class="comment">// use stream iterators to copy the stream to a string</span>
        std::istream_iterator&lt;char&gt; it(std::cin);
        std::istream_iterator&lt;char&gt; end;
        std::string results(it, end);

        <span class="comment">// -----------------------------------------------</span>
        <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;
        madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();
        madeEasy.<a class="code" href="class_o_t___m_e.html#abd1a0c946ffba242d38fc909937a4145">ExecuteScript_ReturnVoid</a>(results, (<span class="stringliteral">&quot;stdin&quot;</span>));
        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="keywordflow">return</span> 0;
    }

    <span class="comment">// Otherwise a command WAS provided at the command line, so we execute a single time, once just for that command.</span>
    {
        <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = NULL;
        <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServerContract = NULL;
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMyNym = NULL;

        <span class="comment">// This does LoadWallet, andif Nym or Server IDs were provided, loads those up as well.</span>
        <span class="comment">// (They may still be NULL after this call, however.)</span>
        <span class="comment">//</span>
        <span class="keywordtype">bool</span> bMainPointersSetupSuccessful =
            <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym, pMyNym, pWallet, pServerContract);

        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(bMainPointersSetupSuccessful,<span class="stringliteral">&quot;main: SetupPointersForWalletMyNymAndServerContract failed to return true&quot;</span>);

        <span class="comment">// Below this point, pWallet is available :-)</span>
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// Later I can split the below commands into &quot;those that need a server contract&quot;</span>
        <span class="comment">// and &quot;those that don&#39;t need a server contract&quot;, and put this code between them.</span>
        <span class="comment">// That&#39;s what the OT Prompt loop does. For now I&#39;m making things easy here by just</span>
        <span class="comment">// making it a blanket requirement.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL == pServerContract)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract to use. Please use the option: --server SERVER_ID\n&quot;</span>
                          <span class="stringliteral">&quot;(Where SERVER_ID is the Server&#39;s ID. Partial matches ARE accepted.)\n&quot;</span>);
<span class="comment">//          return 0;</span>
        }

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID;
        <a class="code" href="class_o_t_string.html">OTString</a>     strServerID;

        <span class="keywordflow">if</span> (NULL != pServerContract)
        {
            pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(theServerID);
            theServerID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strServerID);
        }
        <span class="comment">// -----------------------------------------------------</span>
<span class="comment">//      int32_t       nServerPort = 0;</span>
<span class="comment">//      OTString  strServerHostname;</span>
        <span class="comment">// ------------------------------------------------------------------------------</span>
        <span class="comment">// You can&#39;t just connect to any hostname and port.</span>
        <span class="comment">// Instead, you give me the Server Contract, and *I&#39;ll* look up all that stuff FOR you...</span>
        <span class="comment">// (We verify this up here, but use it at the bottom of the function once the message is set up.)</span>
        <span class="comment">//</span>

<span class="comment">//      if (false == pServerContract-&gt;GetConnectInfo(strServerHostname, nServerPort))</span>
<span class="comment">//      {</span>
<span class="comment">//          OTLog::vError(&quot;Failed retrieving connection info from server contract: %s\n&quot;,</span>
<span class="comment">//                        strServerID.Get());</span>
<span class="comment">//          return 0;</span>
<span class="comment">//      }</span>

        <span class="comment">// Below this point, pWallet and pServerContract are both available.</span>
        <span class="comment">// UPDATE: Not necessarily... (pServerContract may be NULL...)</span>
        <span class="comment">//</span>
        <span class="comment">// ***********************************************************</span>

        <a class="code" href="class_o_t_account.html">OTAccount</a> * pMyAccount  = NULL;
        <a class="code" href="class_o_t_account.html">OTAccount</a> * pHisAccount = NULL;

        <span class="keywordflow">if</span>( str_MyAcct.size() &gt; 0 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_ACCOUNT_ID(str_MyAcct.c_str());

            pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(MY_ACCOUNT_ID);

            <span class="comment">// If failure, then we try PARTIAL match.</span>
            <span class="keywordflow">if</span> (NULL == pMyAccount)
                pMyAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>( str_MyAcct );

            <span class="keywordflow">if</span> (NULL != pMyAccount)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
                pMyAccount-&gt;GetPurportedAccountID().GetString(strTemp);

                str_MyAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as myacct: %s\n&quot;</span>, str_MyAcct.c_str());
            }
            <span class="keywordflow">else</span> <span class="comment">// Execution aborts if we cannot find MyAcct when one was provided.</span>
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Aborting: Unable to find specified myacct: %s\n&quot;</span>, str_MyAcct.c_str());
                <span class="keywordflow">return</span> 0;
            }
        }
        <span class="comment">// -------------------------------------------------------------------------</span>
        <span class="comment">// TODO: I wouldn&#39;t have HIS account in MY wallet -- I&#39;d only have his account ID.</span>
        <span class="comment">// Therefore need to be able to retrieve this info from the ADDRESS BOOK (in order</span>
        <span class="comment">// to be able to do PARTIAL MATCHES...)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> ( str_HisAcct.size() &gt; 0 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCOUNT_ID(str_HisAcct.c_str());

            pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aee1809973c356a82e9c0f80d201668f4">GetAccount</a>(HIS_ACCOUNT_ID);

            <span class="comment">// If failure, then we try PARTIAL match.</span>
            <span class="keywordflow">if</span> (NULL == pHisAccount)
                pHisAccount = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab25801b4fc2815bd397b523acf65c2d6">GetAccountPartialMatch</a>( str_HisAcct );
            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">if</span> (NULL != pHisAccount)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
                pHisAccount-&gt;GetPurportedAccountID().GetString(strTemp);

                str_HisAcct = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisacct: %s\n&quot;</span>, str_HisAcct.c_str());
            }

            <span class="comment">// Execution continues, even if we fail to find his account.</span>
            <span class="comment">// (Only my accounts will be in my wallet. Anyone else&#39;s account</span>
            <span class="comment">// will exist on the server, even if it&#39;s not in my wallet. Therefore</span>
            <span class="comment">// we still allow users to use HisAcctID since their server messages</span>
            <span class="comment">// will usually actually work.)</span>
            <span class="comment">//</span>
            <span class="comment">// Again: Just because account lkjsf09234lkjafkljasd098q345lkjasdf doesn&#39;t</span>
            <span class="comment">// appear in my wallet, doesn&#39;t mean the account doesn&#39;t exist on the server</span>
            <span class="comment">// and in reality. Therefore I must assume, if I didn&#39;t find it by abbreviation,</span>
            <span class="comment">// that it exists exactly as entered. The server message will just fail, if it</span>
            <span class="comment">// doesn&#39;t exist. (But then that&#39;s the user&#39;s fault...)</span>
            <span class="comment">//</span>
            <span class="comment">// We can still keep account IDs in the address book, even if they aren&#39;t</span>
            <span class="comment">// in the wallet (since they&#39;re owned by someone else...)</span>
            <span class="comment">//</span>
        }

        <span class="comment">// ***********************************************************</span>

        <span class="comment">// I put this here too since I think it&#39;s required in all cases.</span>
        <span class="comment">// Update: commented out the return in order to allow for empty wallets.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL == pMyNym) <span class="comment">// Todo maybe move this check to the commands below (ONLY the ones that use a nym.)</span>
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
                          <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches and names are accepted.)\n&quot;</span>);
<span class="comment">//          return 0;</span>
        }

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_NYM_ID;

        <span class="keywordflow">if</span> (NULL != pMyNym)
            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(MY_NYM_ID);
        <span class="comment">// -----------------------------------------------</span>
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pHisNym = NULL;

        <span class="keywordflow">if</span> ( str_HisNym.size() &gt; 0 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID(str_HisNym.c_str());

            pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(HIS_NYM_ID);
            <span class="comment">// If failure, then we try PARTIAL match.</span>
            <span class="keywordflow">if</span> (NULL == pHisNym)
                pHisNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>( str_HisNym );
            <span class="comment">// ----------------------------</span>
            <span class="keywordflow">if</span> (NULL != pHisNym)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
                pHisNym-&gt;GetIdentifier(strTemp);

                str_HisNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hisnym: %s\n&quot;</span>, str_HisNym.c_str());
            }
        }

        <span class="comment">// Below this point, if Nyms or Accounts were specified, they are now available.</span>
        <span class="comment">// (Pointers might be null, though currently My Nym is required to be there.)</span>
        <span class="comment">//</span>
        <span class="comment">// Execution continues, even if we fail to find his nym.</span>
        <span class="comment">// This is so the script has the opportunity to &quot;check nym&quot; (Download it)</span>
        <span class="comment">// based on the ID that the user has entered here.</span>

        <span class="comment">// ***********************************************************</span>

        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> thePurseAssetTypeID;
        <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pMyAssetContract = NULL;

        <span class="keywordflow">if</span> ( str_MyPurse.size() &gt; 0 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_ASSET_TYPE_ID(str_MyPurse.c_str());
            pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(MY_ASSET_TYPE_ID);

            <span class="comment">// If failure, then we try PARTIAL match.</span>
            <span class="keywordflow">if</span> (NULL == pMyAssetContract)
                pMyAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>( str_MyPurse );

            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">if</span> (NULL != pMyAssetContract)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
                pMyAssetContract-&gt;GetIdentifier(strTemp);

                str_MyPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mypurse: %s\n&quot;</span>, str_MyPurse.c_str());
                <span class="comment">// ------------------------------------------</span>
                pMyAssetContract-&gt;GetIdentifier(thePurseAssetTypeID);
            }
            <span class="comment">// Execution continues here, so the script has the option to download</span>
            <span class="comment">// any asset contract, if it can&#39;t find it in the wallet.</span>
        }
        <span class="comment">// if no purse (asset type) ID was provided, but MyAccount WAS provided, then</span>
        <span class="comment">// use the asset type for the account instead.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pMyAccount)
            thePurseAssetTypeID = pMyAccount-&gt;GetAssetTypeID();
        <span class="comment">// ------------------</span>
        <span class="keywordflow">if</span> (!thePurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())

        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTempAssetType(thePurseAssetTypeID);
            str_MyPurse = strTempAssetType.Get();
        }
        <span class="comment">// BELOW THIS POINT, pMyAssetContract MIGHT be NULL, or MIGHT be an asset type specified by the user.</span>
        <span class="comment">// There&#39;s no guarantee that it&#39;s available, but if it IS, then it WILL be available below this point.</span>
        <span class="comment">// ---------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> hisPurseAssetTypeID;

        <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pHisAssetContract = NULL;

        <span class="keywordflow">if</span> ( str_HisPurse.size() &gt; 0 )
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ASSET_TYPE_ID(str_HisPurse.c_str());
            pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a4daee51036b24439e687383a6c66c6f7">GetAssetContract</a>(HIS_ASSET_TYPE_ID);

            <span class="comment">// If failure, then we try PARTIAL match.</span>
            <span class="keywordflow">if</span> (NULL == pHisAssetContract)
                pHisAssetContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aaab24113b89af3d58010e308bf2dce8f">GetAssetContractPartialMatch</a>( str_HisPurse );

            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">if</span> (NULL != pHisAssetContract)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
                pHisAssetContract-&gt;GetIdentifier(strTemp);

                str_HisPurse = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as hispurse: %s\n&quot;</span>, str_HisPurse.c_str());
                <span class="comment">// ------------------------------------------</span>
                pHisAssetContract-&gt;GetIdentifier(hisPurseAssetTypeID);
            }
        }
        <span class="comment">// If no &quot;HisPurse&quot; was provided, but HisAcct WAS, then we use the</span>
        <span class="comment">// asset type of HisAcct as HisPurse.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pHisAccount)
            hisPurseAssetTypeID = pHisAccount-&gt;GetAssetTypeID();
        <span class="comment">// ------------------</span>
        <span class="keywordflow">if</span> (!hisPurseAssetTypeID.<a class="code" href="class_o_t_data.html#a947528765516223eb03bee7745eb8c07">IsEmpty</a>())

        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTempAssetType(hisPurseAssetTypeID);
            str_HisPurse = strTempAssetType.Get();
        }
        <span class="comment">// --------------------------------------------------------------------------</span>

        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);

        <span class="comment">// Also, pAccount and pMyAssetContract have not be validated AGAINST EACH OTHER (yet)...</span>
        <span class="comment">// Also, pHisAccount and pHisAssetContract have not be validated AGAINST EACH OTHER (yet)...</span>

        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">/*  GET THE ACTUAL ARGUMENTS AFTER THE OPTIONS */</span>
<span class="comment">//</span>
<span class="comment">//      for( int32_t i = 0 ; i &lt; opt-&gt;getArgc() ; i++ )</span>
<span class="comment">//      {</span>
<span class="comment">//         cerr &lt;&lt; &quot;arg = &quot; &lt;&lt;  opt-&gt;getArgv( i ) &lt;&lt; endl ;</span>
<span class="comment">//      }</span>

        <span class="keywordtype">bool</span> bSendCommand   = <span class="keyword">false</span>; <span class="comment">// Determines whether to actually send a message to the server.</span>

        <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

        <span class="comment">// If we can match the user&#39;s request to a client command,</span>
        <span class="comment">// AND theClient object is able to process that request into</span>
        <span class="comment">// theMessage, then we send it down the pipe.</span>


        <span class="comment">// In lieu of maintaining a constant connection to the server, in ZMQ mode, the</span>
        <span class="comment">// client updates its internal &quot;connection&quot; object to make sure the right pointers</span>
        <span class="comment">// are in place (since in ZMQ mode, each message could be from a different nym</span>
        <span class="comment">// and to a different server.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> ((NULL != pServerContract) &amp;&amp; (NULL != pMyNym))
            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServerContract, *pMyNym, <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetTransportCallback());
        <span class="comment">// NOTE -- This MAY be unnecessary for ProcessUserCommand (since these args are passed</span>
        <span class="comment">// in there already) but it&#39;s definitely necessary soon after for ProcessServerReply()</span>
        <span class="comment">// (which comes next.)</span>


        <span class="comment">//        (OTClient::OT_CLIENT_CMD_TYPE requestedCommand,</span>
        <span class="comment">//         OTMessage &amp; theMessage,</span>
        <span class="comment">//         OTPseudonym &amp; theNym,</span>
        <span class="comment">//         OTServerContract &amp; theServer,</span>
        <span class="comment">//         OTAccount * pAccount/*=NULL*/,</span>
        <span class="comment">//         lAmount</span>
        <span class="comment">//         OTAssetContract * pMyAssetType/*=NULL*/,</span>
        <span class="comment">//         OTAccount * pHisAcct/*=NULL*/,</span>
        <span class="comment">//         OTPseudonym * pHisNym/*=NULL*/)</span>


        <span class="comment">// COMMANDS</span>


        <span class="keywordflow">if</span>( ( opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ) != NULL ) ||
            ( opt-&gt;getArgc() &gt; 0) )
        {
            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a7b1155d15226f5b512d7dd2c839a8cb9">SetRunningAsScript</a>(); <span class="comment">// This way it won&#39;t go firing off messages automatically based on receiving certain server replies to previous requests.</span>
            <span class="comment">// Todo: Research whether the above call is still necessary. (OTAPI no longer fires off ANY auto messages based on server replies. API CLIENT MUST do those things itself now.)</span>

            std::string strFilename;

            <span class="comment">// If a filename is provided as a normal argument (like this: ot &lt;filename&gt;)</span>
            <span class="comment">// then it will work...</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (opt-&gt;getArgc() &gt; 0)
            {
                strFilename = opt-&gt;getArgv( 0 );
            }

            <span class="comment">// the --script option will ALSO work for the filename, and will override the above.</span>
            <span class="comment">// so:   ot --script &lt;filename&gt;</span>
            <span class="comment">// also: ot --script &lt;actual_filename&gt; &lt;ignored_filename&gt;</span>
            <span class="comment">//</span>
            <span class="comment">// In this above example, ignored_filename WOULD have been used, but then it got</span>
            <span class="comment">// overridden by the --script actual_filename.</span>

            <span class="keywordflow">if</span> (NULL != opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> ))
            {
                strFilename = opt-&gt;getValue( <span class="stringliteral">&quot;script&quot;</span> );
            }

            std::ifstream t(strFilename.c_str(), std::ios::in | std::ios::binary);
            std::stringstream buffer;
            buffer &lt;&lt; t.rdbuf();
            std::string results = buffer.str();
            <span class="comment">// ----------------------------------------</span>
            <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;

            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a>   angelArgs; <span class="comment">// For user-defined arguments that may have been passed in.</span>

<span class="comment">//          OTParty     * pPartyMyNym   = NULL;</span>
<span class="comment">//          OTParty     * pPartyHisNym  = NULL;</span>
<span class="comment">//</span>
<span class="comment">//          OTCleanup&lt;OTParty&gt; angelMyNym;</span>
<span class="comment">//          OTCleanup&lt;OTParty&gt; angelHisNym;</span>
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyNymVar;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisNymVar;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelServer;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyAcct;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisAcct;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelMyPurse;
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTVariable&gt;</a> angelHisPurse;
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> ((str_Args.size() &gt; 0) || (opt-&gt;getArgc() &gt; 1))
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;Args&quot;</span>);
                std::string str_var_value, str_command;

                <span class="keywordflow">if</span> (str_Args.size() &gt; 0)
                    str_var_value += str_Args;

                <span class="keywordflow">if</span> (opt-&gt;getArgc() &gt; 1)
                {
                    <span class="keywordflow">if</span> (str_Args.size() &gt; 0)
                        str_var_value += <span class="stringliteral">&quot; &quot;</span>;

                    str_command = opt-&gt;getArgv( 1 );
                    str_var_value += <span class="stringliteral">&quot;ot_cli_command &quot;</span>;
                    str_var_value += str_command;
                }

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding user-defined command line arguments as &#39;%s&#39; containing value: %s\n&quot;</span>,
                    str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;Args&quot;</span>
                    str_var_value,      <span class="comment">// &quot;key1 value1 key2 value2 key3 value3 key4 value4&quot;</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelArgs.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Args variable (optional user-defined arguments) isn&#39;t set...\n&quot;</span>);
            }

            <span class="comment">// -------------------------</span>
            <span class="keywordflow">if</span> (str_ServerID.size() &gt; 0)
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;Server&quot;</span>);
                <span class="keyword">const</span> std::string str_var_value(str_ServerID);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;Server&quot;</span>
                    str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelServer.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;Server variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> (NULL != pMyNym)
            {
                <span class="keyword">const</span> std::string str_party_name(<span class="stringliteral">&quot;MyNym&quot;</span>);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_party_name.c_str(), str_MyNym.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_party_name,  <span class="comment">// &quot;MyNym&quot;</span>
                    str_MyNym,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelMyNymVar.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_party_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyNym variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> ((NULL != pHisNym) || (str_HisNym.size() &gt; 0)) <span class="comment">// Even if we didn&#39;t find him, we still let the ID through, if there is one.</span>
            {
                <span class="keyword">const</span> std::string str_party_name(<span class="stringliteral">&quot;HisNym&quot;</span>);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding constant with name %s and value: %s ...\n&quot;</span>, str_party_name.c_str(), str_HisNym.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_party_name,  <span class="comment">// &quot;HisNym&quot;</span>
                    str_HisNym,     <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelHisNymVar.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_party_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;HisNym variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>
            <span class="comment">// WE NO LONGER PASS THE PARTY DIRECTLY TO THE SCRIPT,</span>
            <span class="comment">// BUT INSTEAD, ONLY THE PARTY&#39;S NAME.</span>
            <span class="comment">//</span>
            <span class="comment">// (Because often, &quot;HisNym&quot; isn&#39;t in my wallet and wouldn&#39;t be found anyway,</span>
            <span class="comment">//  even though it ends up to contain a perfectly legitimate Nym ID.)</span>
            <span class="comment">/*</span>
<span class="comment">            if (NULL != pMyNym)</span>
<span class="comment">            {</span>
<span class="comment">                const std::string str_party_name(&quot;MyNym&quot;), str_agent_name(&quot;mynym&quot;), str_acct_name(&quot;myacct&quot;);</span>
<span class="comment"></span>
<span class="comment">                pPartyMyNym = new OTParty (str_party_name, *pMyNym, str_agent_name, pMyAccount, &amp;str_acct_name);</span>
<span class="comment">                angelMyNym.SetCleanupTargetPointer(pPartyMyNym);</span>
<span class="comment">                OT_ASSERT(NULL != pPartyMyNym);</span>
<span class="comment">                // ------------------------------------------</span>
<span class="comment">                pScript-&gt; AddParty(&quot;MyNym&quot;, *pPartyMyNym);</span>
<span class="comment">            }</span>
<span class="comment">            else</span>
<span class="comment">            {</span>
<span class="comment">                OTLog::Error(&quot;MyNym variable isn&#39;t set...\n&quot;);</span>
<span class="comment">            }</span>
<span class="comment">            // -------------------------</span>
<span class="comment">            if (NULL != pHisNym)</span>
<span class="comment">            {</span>
<span class="comment">                const std::string str_party_name(&quot;HisNym&quot;), str_agent_name(&quot;hisnym&quot;), str_acct_name(&quot;hisacct&quot;);</span>
<span class="comment"></span>
<span class="comment">                pPartyHisNym = new OTParty (str_party_name, *pHisNym, str_agent_name, pHisAccount, &amp;str_acct_name);</span>
<span class="comment">                angelHisNym.SetCleanupTargetPointer(pPartyHisNym);</span>
<span class="comment">                OT_ASSERT(NULL != pPartyHisNym);</span>
<span class="comment">                // ------------------------------------------</span>
<span class="comment">                pScript-&gt; AddParty(&quot;HisNym&quot;, *pPartyHisNym);</span>
<span class="comment">            }</span>
<span class="comment">            else</span>
<span class="comment">            {</span>
<span class="comment">                OTLog::Error(&quot;HisNym variable isn&#39;t set...\n&quot;);</span>
<span class="comment">            }</span>
<span class="comment">            */</span>
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> (str_MyAcct.size() &gt; 0)
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;MyAcct&quot;</span>);
                <span class="keyword">const</span> std::string str_var_value(str_MyAcct);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;MyAcct&quot;</span>
                    str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelMyAcct.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyAcct variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> (str_MyPurse.size() &gt; 0)
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;MyPurse&quot;</span>);
                <span class="keyword">const</span> std::string str_var_value(str_MyPurse);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;MyPurse&quot;</span>
                    str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelMyPurse.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyPurse variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> (str_HisAcct.size() &gt; 0)
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;HisAcct&quot;</span>);
                <span class="keyword">const</span> std::string str_var_value(str_HisAcct);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;HisAcct&quot;</span>
                    str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelHisAcct.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;HisAcct variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// -------------------------</span>

            <span class="keywordflow">if</span> (str_HisPurse.size() &gt; 0)
            {
                <span class="keyword">const</span> std::string str_var_name(<span class="stringliteral">&quot;HisPurse&quot;</span>);
                <span class="keyword">const</span> std::string str_var_value(str_HisPurse);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Adding variable with name %s and value: %s ...\n&quot;</span>, str_var_name.c_str(), str_var_value.c_str());

                <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = <span class="keyword">new</span> <a class="code" href="class_o_t_variable.html">OTVariable</a>(str_var_name,        <span class="comment">// &quot;HisPurse&quot;</span>
                    str_var_value,      <span class="comment">// &quot;lkjsdf09834lk5j34lidf09&quot; (Whatever)</span>
                    <a class="code" href="class_o_t_variable.html#a649f74cb58ba9ed9aeb8601750c98672a3663696326da4cd07edb796beec5c324">OTVariable::Var_Constant</a>);  <span class="comment">// constant, persistent, or important.</span>
                angelHisPurse.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pVar);
                <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pVar);
                <span class="comment">// ------------------------------------------</span>
                madeEasy.<a class="code" href="class_o_t___m_e.html#ab5da473b836df45158a8709e02e2fb97">AddVariable</a>(str_var_name, *pVar);
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(2, <span class="stringliteral">&quot;MyPurse variable isn&#39;t set...\n&quot;</span>);
            }
            <span class="comment">// ************************************************</span>

            madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();

            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(1, <span class="stringliteral">&quot;Script output:\n\n&quot;</span>);

            <span class="comment">// OT SCRIPT PROMPT --------------------------------------------</span>
<span class="preprocessor">#if USE_OLD_CHAISCRIPT == 0</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (strFilename.size() &gt;= 8)
            {
                <span class="comment">// request to run opentxs command line script?</span>
                std::string endsWith = strFilename.substr(strFilename.size() - 8, 8);
                <span class="keywordflow">if</span> (endsWith == <span class="stringliteral">&quot;\\opentxs&quot;</span> || endsWith == <span class="stringliteral">&quot;/opentxs&quot;</span>)
                {
                    <span class="keywordflow">return</span> madeEasy.<a class="code" href="class_o_t___m_e.html#a78acf0395f07f0f958c1616b406343b8">opentxs_main_loop</a>();
                }
            }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <span class="keywordflow">return</span> madeEasy.<a class="code" href="class_o_t___m_e.html#a0e872f5e07b213ae48084a762bf96c8e">ExecuteScript_ReturnInt</a>(results, strFilename);
        }
        <span class="comment">// ------------------------------------------------------------------------</span>
        <span class="comment">// OT SCRIPT ABOVE.</span>
        <span class="comment">// ------------------------------------------------------------------------</span>


        <span class="comment">// *******************************************************************</span>

        <span class="keywordflow">if</span> ((NULL == pServerContract) || (NULL == pMyNym))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Unexpected NULL: %s %s\n&quot;</span>,
                (NULL == pServerContract) ? <span class="stringliteral">&quot;pServerContract&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
                (NULL == pMyNym)          ? <span class="stringliteral">&quot;pMyNym&quot;</span>          : <span class="stringliteral">&quot;&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;withdraw&quot;</span> ) != NULL  )
        {
            <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;w&#39;</span> ));

            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw cash...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a6a1880142e9d121429e7a48189e82654">OTClient::notarizeWithdrawal</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount, lAmount))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing withdraw command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;transfer&quot;</span> ) != NULL  )
        {
            <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;t&#39;</span> ));

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCT_ID((str_HisAcct.size() &gt; 0) ? str_HisAcct.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);

            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to send a Transfer command (Notarize Transactions)...\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab982770b40b71822dc40f0bb3617d6ec">OTClient::notarizeTransfer</a>, theMessage,
                *pMyNym,  *pServerContract,
                pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
                NULL, <span class="comment">// his Nym</span>
                (str_HisAcct.size() &gt; 0) ? &amp;HIS_ACCT_ID : NULL)) <span class="comment">// his acct</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing notarizeTransactions (transfer) command in ProcessMessage.\n&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;cheque&quot;</span> ) != NULL  )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to write a cheque...)\n&quot;</span>);

            <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;c&#39;</span> ));

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size() &gt; 0)  ? str_HisNym.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>); <span class="comment">// todo hardcoding</span>

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab15b3869502823da3286c4a3be9b83bc">OTClient::writeCheque</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
                (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ) != NULL  || opt-&gt;getValue( <span class="stringliteral">&quot;voucher&quot;</span> ) != NULL  )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw a voucher...)\n&quot;</span>);

            <span class="keyword">const</span> int64_t lAmount = atol(opt-&gt;getValue( <span class="charliteral">&#39;v&#39;</span> ));

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size() &gt; 0)  ? str_HisNym.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac31b4267e60dbdc9c28b5c7ba8fde62c">OTClient::withdrawVoucher</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount, lAmount, NULL, <span class="comment">// asset contract</span>
                (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing withdraw voucher command in ProcessMessage.\n&quot;</span>);

        }

        <span class="comment">// make an offer and put it onto a market.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;getValue( <span class="stringliteral">&quot;marketoffer&quot;</span> ) != NULL)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a marketOffer command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aa3e1744621c050d38a934d77749d891e">OTClient::marketOffer</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// for now, keeping it simple. Can add options later.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing marketOffer command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// ********************************************************</span>
        <span class="comment">/*</span>
<span class="comment">        bool ProcessUserCommand(OT_CLIENT_CMD_TYPE requestedCommand,</span>
<span class="comment">            OTMessage &amp; theMessage,</span>
<span class="comment">            OTPseudonym &amp; theNym,</span>
<span class="comment">//          OTAssetContract &amp; theContract,</span>
<span class="comment">            OTServerContract &amp; theServer,</span>
<span class="comment">            OTAccount * pAccount=NULL,</span>
<span class="comment">            int64_t lTransactionAmount = 0,</span>
<span class="comment">            OTAssetContract * pMyAssetType=NULL,</span>
<span class="comment">            OTIdentifier * pHisAcctID=NULL,</span>
<span class="comment">            OTIdentifier * pHisNymID=NULL);</span>
<span class="comment">        */</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;proposepaymentplan&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to propose a payment plan...)\n&quot;</span>);

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_NYM_ID ((str_HisNym.size()  &gt; 0) ? str_HisNym.c_str() :<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);
            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> HIS_ACCT_ID((str_HisAcct.size() &gt; 0) ? str_HisAcct.c_str():<span class="stringliteral">&quot;aaaaaaaa&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a2e9a6e919c7ee32a962aaf24b1ffb697">OTClient::proposePaymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount, 0, pMyAssetContract,
                (str_HisNym.size() &gt; 0)  ? &amp;HIS_NYM_ID : NULL,
                (str_HisAcct.size() &gt; 0) ? &amp;HIS_ACCT_ID : NULL
                );
        }
        <span class="comment">// ------------------------------------------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;confirmpaymentplan&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to confirm a payment plan...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a901ce90148ddf82944a19bc4338682ad">OTClient::confirmPaymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL); <span class="comment">// the account info is already on the plan, right?</span>
        }
        <span class="comment">// ------------------------------------------------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;activatepaymentplan&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to activate a payment plan...)\n&quot;</span>);

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab70cae2211349300334a71529c942b75">OTClient::paymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount)) <span class="comment">// if user DOES specify an account (unnecessary)</span>
            {                                   <span class="comment">// then OT will verify that they match, and error otherwise.</span>
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing activate payment plan command in ProcessMessage.\n&quot;</span>);
        }
        <span class="comment">// *******************************************************</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;depositcheque&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a cheque...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a393f2048b156f634595bd6d628c80209">OTClient::notarizeCheque</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit cheque command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;getFlag( <span class="stringliteral">&quot;depositpurse&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a cash purse...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9f04f3ee9323ef6ab4319c78a6139506">OTClient::notarizePurse</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount,
                0, <span class="comment">// amount (unused here)</span>
                pMyAssetContract))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit purse command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="stringliteral">&quot;deposittokens&quot;</span> ) )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit individual cash tokens...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac0d3b6c44604abdd3b07bab8e69ea602">OTClient::notarizeDeposit</a>, theMessage,
                *pMyNym, *pServerContract,
                pMyAccount))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing deposit cash tokens command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;i&#39;</span> )  || opt-&gt;getFlag( <span class="stringliteral">&quot;inbox&quot;</span> )  )
        {
            cerr &lt;&lt; <span class="stringliteral">&quot;DISPLAY INBOX CONTENTS HERE... (When I code this. What can I say? Use the GUI.)&quot;</span> &lt;&lt; endl ;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;s&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;sign&quot;</span> ))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to sign a contract...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac5c8e57a658c61b11369d11204b73cbd">OTClient::signContract</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;p&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;purse&quot;</span> )  )
        {
            cerr &lt;&lt; <span class="stringliteral">&quot;User wants to display purse contents (not coded yet here.)&quot;</span> &lt;&lt; endl ;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;verify&quot;</span> )  )
        {
            cerr &lt;&lt; <span class="stringliteral">&quot;User wants to verify a signature on a contract (not coded yet here) &quot;</span> &lt;&lt; endl ;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;stat&quot;</span> )   )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display wallet contents...\n&quot;</span>);

            <a class="code" href="class_o_t_string.html">OTString</a> strStat;
            pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aed7e71a27cd1442399f16acd6b191372">DisplayStatistics</a>(strStat);
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s\n&quot;</span>, strStat.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> )   )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to enter the OT prompt...\n&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opt-&gt;getFlag( <span class="charliteral">&#39;b&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;balance&quot;</span> )   )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n ACCT BALANCE (server-side): %lld\n\n&quot;</span>, pMyAccount-&gt;GetBalance());

            <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">LoadPurse</a>(theServerID, thePurseAssetTypeID, MY_NYM_ID);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse);
            <span class="keywordflow">if</span> (NULL != pPurse)
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot; CASH PURSE (client-side): %lld\n&quot;</span>, pPurse-&gt;GetTotalValue());
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="charliteral">&#39;r&#39;</span> ) || opt-&gt;getFlag( <span class="stringliteral">&quot;refresh&quot;</span> )   )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to download intermediary files for an asset account...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a83dc60e33659baf6d5ce60c3aa254f06">OTClient::getAccount</a>, theMessage,
                *pMyNym,  *pServerContract,
                pMyAccount))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing getAccount command in ProcessMessage.\n&quot;</span>);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opt-&gt;getFlag( <span class="stringliteral">&quot;refreshnym&quot;</span> )   )
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to download intermediary files for a Nym...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a81f19a83547bbc089eb7efa134c9e22a">OTClient::getNymbox</a>, theMessage,
                *pMyNym,  *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error processing getNymbox command in ProcessMessage.\n&quot;</span>);
        }

        <span class="comment">// ----------------------------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServerContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();

        <span class="keywordflow">if</span> ((NULL == pServerNym) || (<span class="keyword">false</span> == pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>()))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;The server Nym was NULL or failed to verify on server contract: %s\n&quot;</span>,
                strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> 0;
        }
        <span class="comment">//</span>
        <span class="comment">// ***********************************************************</span>

        <span class="keywordflow">if</span> (bSendCommand &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strEnvelopeContents(theMessage);
            <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope; <span class="comment">// Seal the string up into an encrypted Envelope</span>
            theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pServerNym, strEnvelopeContents);
            <span class="comment">// -----------------------------------</span>

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">GetTransportCallback</a>()-&gt;operator()(*pServerContract, theEnvelope);

        } <span class="comment">// if bSendCommand</span>


        <span class="keywordflow">if</span> ( !opt-&gt;getFlag( <span class="stringliteral">&quot;prompt&quot;</span> ) ) <span class="comment">// If the user selected to enter the OT prompt, then we drop down below... (otherwise return.)</span>
        {
            <span class="keywordflow">return</span> 0;
        }
    } <span class="comment">// Command line interface (versus below, which is the PROMPT interface.)</span>

    <span class="comment">// ****************************************************************************</span>












    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nLOOKING FOR INSTRUCTIONS for the OT COMMAND LINE?\n&quot;</span>
        <span class="stringliteral">&quot;Try:   quit\n&quot;</span>
        <span class="stringliteral">&quot;Followed by:  ot -?\n&quot;</span>
        <span class="stringliteral">&quot;or:    ot -h\n&quot;</span>
        <span class="stringliteral">&quot;or:    ot --help\n&quot;</span>
        <span class="stringliteral">&quot;\n&quot;</span>
        <span class="stringliteral">&quot;(NOW ENTERING OT PROMPT) \n&quot;</span>
        <span class="stringliteral">&quot;See docs/CLIENT-COMMANDS.txt\n\n&quot;</span>);


    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">//  THE OPEN-TRANSACTIONS PROMPT</span>
    <span class="comment">//</span>
    <span class="comment">// OT&gt;</span>
    <span class="comment">//</span>
    <span class="comment">// Basically, loop:</span>
    <span class="comment">//</span>
    <span class="comment">//  1) Present a prompt, and get a user string of input. Wait for that.</span>
    <span class="comment">//</span>
    <span class="comment">//  2) Process it out as an OTMessage to the server. It goes down the pipe.</span>
    <span class="comment">//</span>
    <span class="comment">//  3) Sleep for 1 second.</span>
    <span class="comment">//</span>
    <span class="comment">//  4) Awake and check for messages to be read in response from the server.</span>
    <span class="comment">//     Loop. As long as there are any responses there, then process and handle</span>
    <span class="comment">//     them all.</span>
    <span class="comment">//     Then continue back up to the prompt at step (1).</span>



    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pMyNym = NULL;
    <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = NULL;
    <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServerContract = NULL;

    <span class="comment">// If we got down here, that means there were no commands on the command line</span>
    <span class="comment">// (That&#39;s why we dropped into the OT prompt.)</span>
    <span class="comment">// However, there still may have been OPTIONS -- and if so, we&#39;ll go ahead and</span>
    <span class="comment">// load the wallet. (If there were NOT ANY OPTIONS, then we do NOT load the wallet,</span>
    <span class="comment">// although there is a COMMAND for doing that.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ( (str_ServerID.size() &gt; 0) || (str_MyNym.size() &gt; 0) )
    {
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym,
            pMyNym, pWallet, pServerContract))
        {
            <span class="keywordflow">return</span> 0;
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nYou may wish to &#39;load&#39; then &#39;stat&#39;.\n&quot;</span>
        <span class="stringliteral">&quot;(FYI, --server SERVER_ID  and  --mynym NYM_ID  were both valid options.)\n&quot;</span>
        <span class="stringliteral">&quot;Also, see:  ~/.ot/command-line-ot.opt for defaults.\n&quot;</span>);

    <span class="comment">// Below this point, pWallet is available and loaded, IF opt-&gt;HasOptions().</span>
    <span class="comment">// Otherwise, pWallet is NOT loaded, and we&#39;re waiting for the Load command.</span>

    <span class="comment">// Below this point, pMyNym MIGHT be a valid pointer (if it was specified),</span>
    <span class="comment">// or MIGHT be NULL. Same with pServerContract. (MIGHT be there.)</span>
    <span class="comment">//</span>
    <span class="comment">// ***********************************************************</span>

    <span class="keywordtype">char</span> buf[200] = <span class="stringliteral">&quot;&quot;</span>;

    int32_t nExpectResponse = 0;

    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;Starting client loop.\n&quot;</span>, <a class="code" href="_o_t_server_connection_8hpp.html#afaeb50bea942aef8c7952cdab7fcd91d">OT_CMD_HEADER_SIZE</a>);


    <span class="comment">// Set the logging level for the network transport code.</span>
<span class="preprocessor">#ifndef _WIN32</span>
<span class="preprocessor"></span>    <span class="comment">//  XmlRpc::setVerbosity(1);</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

    <span class="comment">// -----------------------------------------------------------------------</span>

    <span class="keywordflow">for</span>(;;)
    {
        buf[0] = 0; <span class="comment">// Making it fresh again.</span>

        nExpectResponse = 0;

        <span class="comment">// 1) Present a prompt, and get a user string of input. Wait for that.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\nOT -- WARNING: This prompt is too low-level for you.\nType &#39;quit&#39;, and then try &#39;opentxs help&#39; and &#39;opentxs list&#39;.\n\nOT&gt; &quot;</span>);

        <span class="keywordflow">if</span> (NULL == fgets(buf, 190, stdin)) <span class="comment">// Leaving myself 10 extra bytes at the end for safety&#39;s sake.</span>
            <span class="keywordflow">break</span>;

        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;.\n..\n...\n....\n.....\n......\n.......\n........\n.........\n..........\n&quot;</span>
            <span class="stringliteral">&quot;...........\n............\n.............\n&quot;</span>);

        <span class="comment">// so we can process the user input</span>
        std::string strLine = buf;

        <span class="comment">// Load wallet.xml</span>
        <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;load&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to load wallet.xml...\n&quot;</span>);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a>(str_ServerID, str_MyNym,
                pMyNym, pWallet, pServerContract))
            {
                <span class="keywordflow">return</span> 0;
            }

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;\0&#39;</span> == buf[0])
        {
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;test&quot;</span>) == 0)
        {
            std::string strScript =<span class="stringliteral">&quot;print(\&quot;Hello, world\&quot;)&quot;</span>;
            <a class="code" href="class_o_t___m_e.html">OT_ME</a> madeEasy;
            madeEasy.<a class="code" href="class_o_t___m_e.html#afef61e27fc9761fa9e5446ec78c62887">opentxs_copy_variables</a>();
            madeEasy.<a class="code" href="class_o_t___m_e.html#abd1a0c946ffba242d38fc909937a4145">ExecuteScript_ReturnVoid</a>(strScript, <span class="stringliteral">&quot;hardcoded&quot;</span>);

            <span class="comment">// --------------------------------------------------------------------</span>
            <span class="comment">/*</span>
<span class="comment">            // TODO: Make sure there&#39;s no issues with a known plaintext attack.</span>
<span class="comment">            // (Not here, but I am doing a similar thing in OTASCIIArmor to maintain a minimum size,</span>
<span class="comment">            // due to a bug in some other library that I can&#39;t recall at this time.)</span>
<span class="comment">            //</span>
<span class="comment">            const char * szBlah = &quot;Transaction processor featuring Untraceable Digital Cash, &quot;</span>
<span class="comment">            &quot;Anonymous Numbered Accounts, Triple-Signed Receipts, Basket Currencies, and Signed &quot;</span>
<span class="comment">            &quot;XML Contracts. Also supports cheques, invoices, payment plans, markets with trades, &quot;</span>
<span class="comment">            &quot;and other instruments... it&#39;s like PGP for Money.... Uses OpenSSL and Lucre blinded tokens.\n&quot;;</span>
<span class="comment"></span>
<span class="comment">            OTASCIIArmor theArmoredText(szBlah);</span>
<span class="comment">            OTLog::vOutput(0, &quot;Armored text:\n%s\n&quot;, theArmoredText.Get());</span>
<span class="comment"></span>
<span class="comment">            OTString theFixedText(theArmoredText);</span>
<span class="comment">            OTLog::vOutput(0, &quot;Uncompressed, etc text:\n%s\n&quot;, theFixedText.Get());</span>
<span class="comment">            */</span>

            <span class="keywordflow">continue</span>;
        }
        <span class="comment">// --------------------------------</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,8,<span class="stringliteral">&quot;clearreq&quot;</span>) == 0) <span class="comment">// clear request numbers</span>
        {
            <span class="keywordflow">if</span> (NULL == pMyNym)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available. Try &#39;load&#39;.\n&quot;</span>);
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
            pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (clear your) request numbers.\n&quot;</span>
                <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();

            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReqNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            <span class="comment">// --------------------------------</span>

            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1bce78db719b7733ba2a3fb19f963b24">RemoveReqNumbers</a>(&amp;strReqNumServerID);

            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pMyNym);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Successfully removed request number for server %s. Saving nym...\n&quot;</span>,
                strReqNumServerID.Get());
            <span class="keywordflow">continue</span>;
        }
        <span class="comment">// --------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,5,<span class="stringliteral">&quot;clear&quot;</span>) == 0)
        {
            <span class="keywordflow">if</span> (NULL == pMyNym)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available. Try &#39;load&#39;.\n&quot;</span>);
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
            pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (clear your) transaction numbers.\n&quot;</span>
                <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();

            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            <span class="comment">// --------------------------------</span>

            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a482952f1676f239415215a1835b45f60">RemoveAllNumbers</a>(&amp;strTransNumServerID, <span class="keyword">true</span>); <span class="comment">// bRemoveHighestNum = true.</span>
            pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pMyNym);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Successfully removed all issued and transaction numbers for server %s. Saving nym...\n&quot;</span>,
                strTransNumServerID.Get());
            <span class="keywordflow">continue</span>;
        }
        <span class="comment">// --------------------------------</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,7,<span class="stringliteral">&quot;decrypt&quot;</span>) == 0)
        {
            <span class="keywordflow">if</span> (NULL == pMyNym)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No Nym yet available to decrypt with.\n&quot;</span>);
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be decrypted:\n&gt; &quot;</span>);

            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
            <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1</span>

            <span class="keywordflow">do</span> {
                decode_buffer[0] = 0;
                <span class="keywordflow">if</span> (NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin))
                {
                    theArmoredText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
                }
                <span class="keywordflow">else</span>
                {
                    <span class="keywordflow">break</span>;
                }
            } <span class="keywordflow">while</span> (strlen(decode_buffer)&gt;1);


            <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>  theEnvelope(theArmoredText);
            <a class="code" href="class_o_t_string.html">OTString</a>    strDecodedText;

            theEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(*pMyNym, strDecodedText);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nDECRYPTED TEXT:\n\n%s\n\n&quot;</span>, strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            <span class="keywordflow">continue</span>;
        }
        <span class="comment">// --------------------------------</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,6,<span class="stringliteral">&quot;decode&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be decoded:\n&gt; &quot;</span>);

            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
            <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>

            <span class="keywordflow">do</span> {
                decode_buffer[0] = 0;
                <span class="keywordflow">if</span> (NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin))
                {
                    theArmoredText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
                }
                <span class="keywordflow">else</span>
                {
                    <span class="keywordflow">break</span>;
                }

            } <span class="keywordflow">while</span> (strlen(decode_buffer)&gt;1);

            <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText(theArmoredText);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nDECODED TEXT:\n\n%s\n\n&quot;</span>, strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,6,<span class="stringliteral">&quot;encode&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be ascii-encoded (terminate with ~ on a new line):\n&gt; &quot;</span>);

            <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText;
            <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>

            <span class="keywordflow">do</span> {
                decode_buffer[0] = 0;

                <span class="keywordflow">if</span> ((NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin)) &amp;&amp;
                    (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>))
                {
                    strDecodedText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s&quot;</span>, decode_buffer);
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
                }
                <span class="keywordflow">else</span>
                {
                    <span class="keywordflow">break</span>;
                }

            } <span class="keywordflow">while</span> (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>);

            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText(strDecodedText);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nENCODED TEXT:\n\n%s\n\n&quot;</span>, theArmoredText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;hash&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Enter text to be hashed (terminate with ~ on a new line):\n&gt; &quot;</span>);

            <a class="code" href="class_o_t_string.html">OTString</a> strDecodedText;
            <span class="keywordtype">char</span> decode_buffer[200]; <span class="comment">// Safe since we only read sizeof - 1.</span>

            <span class="keywordflow">do</span> {
                decode_buffer[0] = 0;

                <span class="keywordflow">if</span> ((NULL != fgets(decode_buffer, <span class="keyword">sizeof</span>(decode_buffer)-1, stdin)) &amp;&amp;
                    (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>))
                {
                    strDecodedText.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, decode_buffer);
                    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;&gt; &quot;</span>);
                }
                <span class="keywordflow">else</span>
                {
                    <span class="keywordflow">break</span>;
                }

            } <span class="keywordflow">while</span> (decode_buffer[0] != <span class="charliteral">&#39;~&#39;</span>);


            std::string str_Trim(strDecodedText.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
            strDecodedText.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(str_Trim2.c_str());

            <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theIdentifier;
            theIdentifier.<a class="code" href="class_o_t_identifier.html#ac50b356cf5d5d04c08eaf568d07bcc46">CalculateDigest</a>(strDecodedText);

            <a class="code" href="class_o_t_string.html">OTString</a> strHash(theIdentifier);

            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;\n\nMESSAGE DIGEST:\n\n%s\n\n&quot;</span>, strHash.Get());

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;stat&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display wallet contents...\n&quot;</span>);

            <span class="keywordflow">if</span> (pWallet)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strStat;
                pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aed7e71a27cd1442399f16acd6b191372">DisplayStatistics</a>(strStat);
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s\n&quot;</span>, strStat.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No wallet is loaded...\n&quot;</span>);

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;help&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to display the help file...\nPlease see this file: docs/CLIENT_COMMANDS.txt\n&quot;</span>);

            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,4,<span class="stringliteral">&quot;quit&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to exit the wallet...\n&quot;</span>);

            <span class="keywordflow">break</span>;
        }


        <span class="comment">// ------------------------------------------------------------------------------</span>

        <span class="comment">/*</span>
<span class="comment">        --myacct   (ACCT ID)</span>
<span class="comment">        --mynym    (NYM ID)</span>
<span class="comment">        --mypurse  (ASSET TYPE ID)</span>
<span class="comment"></span>
<span class="comment">        --toacct   (ACCT ID)</span>
<span class="comment">        --tonym    (NYM ID)</span>
<span class="comment">        --topurse  (ASSET TYPE ID)</span>
<span class="comment"></span>
<span class="comment">        OTPseudonym *       GetNymByIDPartialMatch(const std::string PARTIAL_ID);</span>
<span class="comment">        OTServerContract *  GetServerContractPartialMatch(const std::string PARTIAL_ID);</span>
<span class="comment">        OTAssetContract *   GetAssetContractPartialMatch(const std::string PARTIAL_ID);</span>
<span class="comment">        OTAccount *         GetAccountPartialMatch(const std::string PARTIAL_ID);</span>
<span class="comment">        */</span>


        <span class="keywordflow">if</span> (NULL == pServerContract)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract. Please restart using the option:  --server SERVER_ID\n&quot;</span>
                <span class="stringliteral">&quot;(Where SERVER_ID is the server ID. Partial matches ARE accepted.)\n&quot;</span>);
            <span class="keywordflow">continue</span>;
        }


        <span class="comment">// You can&#39;t just connect to any hostname and port.</span>
        <span class="comment">// Instead, you give me the Server Contract, and *I&#39;ll* look up all that stuff FOR you...</span>
        <span class="comment">// (We verify this up here, but use it at the bottom of the function once the message is set up.)</span>
        <span class="comment">//</span>
<span class="comment">//      int32_t         nServerPort = 0;</span>
<span class="comment">//      OTString    strServerHostname;</span>
<span class="comment">//</span>
<span class="comment">//      if (false == pServerContract-&gt;GetConnectInfo(strServerHostname, nServerPort))</span>
<span class="comment">//      {</span>
<span class="comment">//          OTLog::Error(&quot;Failed retrieving connection info from server contract.\n&quot;);</span>
<span class="comment">//          continue;</span>
<span class="comment">//      }</span>

        <span class="comment">// ------------------------------------------------------------------------------</span>

        <span class="comment">// I put this here too since I think it&#39;s required in all cases below.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL == pMyNym) <span class="comment">// Todo maybe move this check to the commands below (ONLY the ones that use a nym.)</span>
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find My Nym. Please restart and use the option:\n&quot;</span>
                <span class="stringliteral">&quot;   --mynym USER_ID\n&quot;</span>
                <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches ARE accepted.)\n&quot;</span>);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// ------------------------------------------------------------------------------</span>

        <span class="keywordtype">bool</span> bSendCommand   = <span class="keyword">false</span>; <span class="comment">// Determines whether to actually send a message to the server.</span>

        <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;

        <span class="comment">// If we can match the user&#39;s request to a client command,</span>
        <span class="comment">// AND theClient object is able to process that request into</span>
        <span class="comment">// theMessage, then we send it down the pipe.</span>

        <span class="comment">// *******************************************************************************</span>


        <span class="comment">// In lieu of maintaining a constant connection to the server, in RPC mode, the</span>
        <span class="comment">// client updates its internal &quot;connection&quot; object to make sure the right pointers</span>
        <span class="comment">// are in place (since in RPC mode, each message could be from a different nym</span>
        <span class="comment">// and to a different server.)</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a36a2c3be7c495a38f4ee0089527df638">SetFocusToServerAndNym</a>(*pServerContract, *pMyNym, <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetTransportCallback());
        <span class="comment">// NOTE -- This MAY be unnecessary for ProcessUserCommand (since these args are passed</span>
        <span class="comment">// in there already) but it&#39;s definitely necessary soon after for ProcessServerReply()</span>
        <span class="comment">// (which comes next.)</span>

        <span class="comment">// -------------------------------------------------------------------------</span>

        <span class="comment">// &#39;check server ID&#39; command</span>
        <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;c&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;(User has instructed to send a checkServerID command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a89596b609fbd84aa6151ca9d1b107c13">OTClient::checkServerID</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command (so far).</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing checkServerID command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// register new user account</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;r&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a createUserAccount command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afb333a78adbe626a0dc596eed05f63f2">OTClient::createUserAccount</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing createUserAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// ALL MESSAGES BELOW THIS POINT SHOULD ATTACH A REQUEST NUMBER IF THEY EXPECT THE SERVER TO PROCESS THEM.</span>
        <span class="comment">// (Handled inside ProcessUserCommand)</span>

        <span class="comment">// checkUser</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;u&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a checkUser command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a29479df423e07d29409fc18b20862871">OTClient::checkUser</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing checkUser command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// register new asset account</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;a&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a createAccount command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aab742ba1837ac9ac107806ba97b66e13">OTClient::createAccount</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing createAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// issue a new asset type</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;issue\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an issueAssetType command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a7d1c1bcc58abf8b966d3abf5736f3eee">OTClient::issueAssetType</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing issueAssetType command in ProcessMessage: %s\n&quot;</span>, buf);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// issue a new basket asset type</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;basket\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an issueBasket command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a92257b2272c666c28d7b73b4376636c3">OTClient::issueBasket</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing issueBasket command in ProcessMessage: %s\n&quot;</span>, buf);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// exchange in/out of a basket currency</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;exchange\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send an exchangeBasket command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7af5d28fce545520f3fba25ca7e51f8374">OTClient::exchangeBasket</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing exchangeBasket command in ProcessMessage: %s\n&quot;</span>, buf);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// make an offer and put it onto a market.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;offer\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a marketOffer command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aa3e1744621c050d38a934d77749d891e">OTClient::marketOffer</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing marketOffer command in ProcessMessage: %s\n&quot;</span>, buf);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// Set a Server Contract&#39;s client-side name (merely a label.)</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setservername\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set a Server Contract&#39;s client-side name...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7abac2774f1d2494b6e545436b9b39b5b2">OTClient::setServerName</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
            }
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// Set an Asset Contract&#39;s client-side name (merely a label.)</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setassetname\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set an Asset Contract&#39;s client-side name...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5a1a6394ec07704c99303e9e5fafd96f">OTClient::setAssetName</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
            }
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// Set a Nym&#39;s client-side name (merely a label.)</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setnymname\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set a Nym&#39;s client-side name...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a00d77f12e9e7f03560b1554f74c1eae5">OTClient::setNymName</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
            }
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// Set an Asset Account&#39;s client-side name (merely a label.)</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;setaccountname\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User wants to set an Asset Account&#39;s client-side name...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a408a59824c97ac7fed449e944f950da9">OTClient::setAccountName</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                <span class="comment">//                  bSendCommand = true; // No message needed. Local data only.</span>
            }

            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// sign contract</span>
        <span class="comment">// This doesn&#39;t message the server, but it DOES require the user&#39;s Nym to be loaded.</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;signcontract\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to sign a contract...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac5c8e57a658c61b11369d11204b73cbd">OTClient::signContract</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// sendUserMessage</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;s&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a sendUserMessage command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7aca0882f708bf1fc33dfc9768b0ed956b">OTClient::sendUserMessage</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing sendUserMessage command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// process nymbox</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,2,<span class="stringliteral">&quot;py&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a processNymbox command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a371b16fad327b8e308761027a59e4a00">OTClient::processEntireNymbox</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error in processNymbox command in ProcessMessage: %s\n&quot;</span>, strLine.c_str());
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// get nymbox</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;y&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getNymbox command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a81f19a83547bbc089eb7efa134c9e22a">OTClient::getNymbox</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getNymbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// Nym, Account, Server ID, Server Contract</span>

        <span class="comment">// process inbox</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strLine.compare(0,2,<span class="stringliteral">&quot;pi&quot;</span>) == 0)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a processInbox command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ae5da54e97abe09fdebbf73f36a957222">OTClient::processEntireInbox</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// have to allow this to be defaulted at some point...</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error in processInbox command in ProcessMessage: %s\n&quot;</span>, strLine.c_str());
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// get inbox</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;i&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getInbox command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9072509cb34ebc5805957ebeb0866d76">OTClient::getInbox</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getInbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// get outbox</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;o&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getOutbox command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5711ae103a3c7b16a3769fd95b907113">OTClient::getOutbox</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getOutbox command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// deposit cheque</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;q&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to deposit a cheque...\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a393f2048b156f634595bd6d628c80209">OTClient::notarizeCheque</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit cheque command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// deposit purse</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;p&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit a purse containing cash...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a9f04f3ee9323ef6ab4319c78a6139506">OTClient::notarizePurse</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// deposit tokens</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;d&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to deposit cash tokens...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac0d3b6c44604abdd3b07bab8e69ea602">OTClient::notarizeDeposit</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL))
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing deposit command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// withdraw voucher</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;v&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to withdraw a voucher (like a cashier&#39;s cheque)...\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ac31b4267e60dbdc9c28b5c7ba8fde62c">OTClient::withdrawVoucher</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing withdraw voucher command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// withdraw cash</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;w&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to withdraw cash...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a6a1880142e9d121429e7a48189e82654">OTClient::notarizeWithdrawal</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing withdraw command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// activate payment plan</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;activate\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;User has instructed to activate a payment plan...\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab70cae2211349300334a71529c942b75">OTClient::paymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing payment plan command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// get account</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;get\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getAccount command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a83dc60e33659baf6d5ce60c3aa254f06">OTClient::getAccount</a>, theMessage,
                *pMyNym,  *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getAccount command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// get contract</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;getcontract\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getContract command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a5b059c3a4ea9668eeb8fab51ed52926c">OTClient::getContract</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getContract command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// ------------------------------------------------------------------------</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;propose\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to propose a payment plan...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a2e9a6e919c7ee32a962aaf24b1ffb697">OTClient::proposePaymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL); <span class="comment">// User owns Merchant (recipient) account</span>
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;confirm\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to confirm a payment plan...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a901ce90148ddf82944a19bc4338682ad">OTClient::confirmPaymentPlan</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL); <span class="comment">// the account info is already on the plan, right?</span>
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// ------------------------------------------------------------------------</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;cheque\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to write a cheque...)\n&quot;</span>);

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa9455394ab05c2013abd0c6249d8d619">GetClient</a>()-&gt;<a class="code" href="class_o_t_client.html#a65b35501e13456c8086c66d4dfda2545">ProcessUserCommand</a>(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab15b3869502823da3286c4a3be9b83bc">OTClient::writeCheque</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL); <span class="comment">// It will ascertain the account inside the call.</span>
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">// get mint</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(buf, <span class="stringliteral">&quot;getmint\n&quot;</span>))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getMint command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7a4c340c363c96261623287d7bbb988ab4">OTClient::getMint</a>, theMessage,
                *pMyNym,  *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getMint command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// notarize transfer</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;t&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a Transfer command (Notarize Transactions) to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ab982770b40b71822dc40f0bb3617d6ec">OTClient::notarizeTransfer</a>, theMessage,
                *pMyNym,  *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing notarizeTransactions command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// getRequest</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;g&#39;</span>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getRequest command to the server...)\n&quot;</span>);

            <span class="comment">// ------------------------------------------------------------------------------</span>
            <span class="comment">// if successful setting up the command payload...</span>

            <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7ad2b66c0cf1b0a4bc0d12ae557679c004">OTClient::getRequest</a>, theMessage,
                *pMyNym, *pServerContract,
                NULL)) <span class="comment">// NULL pAccount on this command.</span>
            {
                bSendCommand = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getRequest command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="comment">// getTransactionNum</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (buf[0] == <span class="charliteral">&#39;n&#39;</span>)
        {
            <span class="comment">// I just coded (here) for myself a secret option (for testing)...</span>
            <span class="comment">// Optionally instead of JUST &#39;n&#39;, I can put n &lt;number&gt;, (without brackets) and</span>
            <span class="comment">// this code will add that number to my list of issued and transaction numbers.</span>
            <span class="comment">// I already have the ability to clear the list, so now I can add numbers to it as well.</span>
            <span class="comment">// (Which adds to both lists.)</span>
            <span class="comment">// I can also remove a number from the transaction list but LEAVE it on the issued list,</span>
            <span class="comment">// for example by writing a cheque and throwing it away.</span>
            <span class="comment">//</span>
            <span class="comment">// This code is for testing and allows me to find and patch any problems without</span>
            <span class="comment">// having to re-create my data each time -- speeds up debugging.</span>
            <span class="comment">//</span>
            int64_t lTransactionNumber = ((strlen(buf) &gt; 2) ? atol(&amp;(buf[2])) : 0);

            <span class="keywordflow">if</span> (lTransactionNumber &gt; 0)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strServerID;
                pServerContract-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strServerID);

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;You are trying to mess around with your (add to your) transaction numbers.\n&quot;</span>
                    <span class="stringliteral">&quot;Enter the relevant server ID [%s]: &quot;</span>, strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                std::string str_ServerID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();

                <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNumServerID((str_ServerID.size() &gt; 0) ? str_ServerID.c_str() : strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

                <span class="comment">// --------------------------</span>

                pMyNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pMyNym, strTransNumServerID, lTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bool bSave=true</span>

                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Transaction number %lld added to both lists (on client side.)\n&quot;</span>,
                    lTransactionNumber);
            }

            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;(User has instructed to send a getTransactionNum command to the server...)\n&quot;</span>);

                <span class="comment">// ------------------------------------------------------------------------------</span>
                <span class="comment">// if successful setting up the command payload...</span>

                <span class="keywordflow">if</span> (0 &lt; <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;GetClient()-&gt;ProcessUserCommand(<a class="code" href="class_o_t_client.html#af16093cbd49040c8968e26f8456da0f7afd0f3ab4babfe3e62c93e6af743c3645">OTClient::getTransactionNum</a>, theMessage,
                    *pMyNym,  *pServerContract,
                    NULL)) <span class="comment">// NULL pAccount on this command.</span>
                {
                    bSendCommand = <span class="keyword">true</span>;
                }
                <span class="keywordflow">else</span>
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Error processing getTransactionNum command in ProcessMessage: %c\n&quot;</span>, buf[0]);
            }

            <span class="comment">// ------------------------------------------------------------------------</span>
        }

        <span class="keywordflow">else</span>
        {
            {
                <span class="comment">//gDebugLog.Write(&quot;unknown user command in ProcessMessage in main.cpp&quot;);</span>
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
                <span class="comment">//              OTLog::vError( &quot;unknown user command in ProcessMessage in main.cpp: %d\n&quot;, buf[0]);</span>
            }
            <span class="keywordflow">continue</span>;
        }


        <span class="comment">// ************************************************************************</span>


        <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServerContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();

        <span class="keywordflow">if</span> (bSendCommand &amp;&amp; (NULL != pServerNym) &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strEnvelopeContents(theMessage);
            <a class="code" href="class_o_t_envelope.html">OTEnvelope</a> theEnvelope;
            theEnvelope.<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(*pServerNym, strEnvelopeContents);
            <span class="comment">// -----------------------------------</span>

            <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a86e129f94dfef872f8809ae9bb1bbb75">GetTransportCallback</a>()-&gt;operator()(*pServerContract, theEnvelope);

        } <span class="comment">// if bSendCommand</span>
    } <span class="comment">// for</span>

    <span class="comment">// -----------------------------------------------------------</span>


    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Exiting OT prompt.\n&quot;</span>);

    <span class="comment">// NOTE: Cleanup is handled via a nested class at the top of this main function.</span>

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa72c739ce2d67b70b4ebcb457e799826"></a><!-- doxytag: member="main.cpp::SetupPointersForWalletMyNymAndServerContract" ref="aa72c739ce2d67b70b4ebcb457e799826" args="(std::string &amp;str_ServerID, std::string &amp;str_MyNym, OTPseudonym *&amp;pMyNym, OTWallet *&amp;pWallet, OTServerContract *&amp;pServerContract)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="otd_2main_8cpp.html#aa72c739ce2d67b70b4ebcb457e799826">SetupPointersForWalletMyNymAndServerContract</a> </td>
          <td>(</td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_ServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>str_MyNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&amp;&#160;</td>
          <td class="paramname"><em>pMyNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_wallet.html">OTWallet</a> *&amp;&#160;</td>
          <td class="paramname"><em>pWallet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_server_contract.html">OTServerContract</a> *&amp;&#160;</td>
          <td class="paramname"><em>pServerContract</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="otd_2main_8cpp_source.html#l00193">193</a> of file <a class="el" href="otd_2main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// If we got down here, that means there were no commands on the command line</span>
    <span class="comment">// (That&#39;s why we dropped into the OT prompt.)</span>
    <span class="comment">// However, there still may have been OPTIONS -- and if so, we&#39;ll go ahead and</span>
    <span class="comment">// load the wallet. (If there were NOT ANY OPTIONS, then we do NOT load the wallet,</span>
    <span class="comment">// although there is a COMMAND for doing that.)</span>
    <span class="comment">//</span>

    <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a>();

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">//</span>
    pWallet = <a class="code" href="class_o_t_a_p_i___wrap.html#a8867c48885173f01d0f9f08aa83d3587">OTAPI_Wrap::OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>();

    <span class="keywordflow">if</span> (NULL == pWallet)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;The wallet object is still NULL, somehow. Please load it.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// Below this point, pWallet is available :-)</span>
    <span class="comment">// -----------------------------------------------------</span>

    <span class="keywordflow">if</span> (str_ServerID.size() &gt; 0 )
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> SERVER_ID(str_ServerID.c_str());

        pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ae897619f652a0d3d9fba99a8bc747993">GetServerContract</a>(SERVER_ID);
        <span class="comment">// If failure, then we try PARTIAL match.</span>
        <span class="keywordflow">if</span> (NULL == pServerContract)
            pServerContract = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a2c08b5bd12930371f99e793762819dd5">GetServerContractPartialMatch</a>(str_ServerID);

        <span class="keywordflow">if</span> (NULL != pServerContract)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pServerContract-&gt;GetIdentifier(strTemp);

            str_ServerID = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as server: %s\n&quot;</span>, str_ServerID.c_str());
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to find a server contract. Please use the option:  --server SERVER_ID\n&quot;</span>
                          <span class="stringliteral">&quot;(Where SERVER_ID is the server ID. Partial matches are accepted if the contract is already in the wallet.)\n&quot;</span>
                          <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
<span class="comment">//          return false;</span>
        }
    }
    <span class="comment">// Below this point, pServerContract MAY be available, but also may be NULL.</span>
    <span class="comment">//</span>
    <span class="comment">// ------------------------------------------------------------------------------</span>

    <span class="keywordflow">if</span> ( str_MyNym.size() &gt; 0 )
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> MY_NYM_ID(str_MyNym.c_str());

        pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aab65a5710311cc6eeb9fbd0d7f881f0e">GetNymByID</a>(MY_NYM_ID);

        <span class="comment">// If failure, then we try PARTIAL match.</span>
        <span class="keywordflow">if</span> (NULL == pMyNym)
            pMyNym = pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a66e64e6ea0c2a9d74099b83b8fe87637">GetNymByIDPartialMatch</a>( str_MyNym );

        <span class="keywordflow">if</span> (NULL != pMyNym)
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strTemp;
            pMyNym-&gt;GetIdentifier(strTemp);

            str_MyNym = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Using as mynym: %s\n&quot;</span>, str_MyNym.c_str());
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;==&gt; Unable to find My Nym. Please use the option:   --mynym USER_ID\n&quot;</span>
                          <span class="stringliteral">&quot;(Where USER_ID is the Nym&#39;s ID. Partial matches are accepted if the nym is already in the wallet.)\n&quot;</span>
                          <span class="stringliteral">&quot;Also, see default values located in ~/.ot/comand-line-ot.opt \n&quot;</span>);
<span class="comment">//          return false;</span>
        }
    } <span class="comment">// Below this point, pMyNym MIGHT be a valid pointer, or MIGHT be NULL.</span>

    <span class="comment">// Below THIS point, there&#39;s no guarantee of pWallet, though it MIGHT be there.</span>
    <span class="comment">// Same with pServerContract. (MIGHT be there.)</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="otd_2main_8cpp.html">main.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:05 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
