<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTTransaction Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_transaction.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">OTTransaction Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTTransaction" --><!-- doxytag: inherits="OTTransactionType" -->
<p><code>#include &lt;<a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTTransaction:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_transaction.png" usemap="#OTTransaction_map" alt=""/>
  <map id="OTTransaction_map" name="OTTransaction_map">
<area href="class_o_t_transaction_type.html" alt="OTTransactionType" shape="rect" coords="0,56,123,80"/>
<area href="class_o_t_contract.html" alt="OTContract" shape="rect" coords="0,0,123,24"/>
</map>
 </div></div>

<p><a href="class_o_t_transaction-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> { <br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">blank</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f">message</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">notice</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">replyNotice</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">successNotice</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">pending</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">transferReceipt</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">chequeReceipt</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">voucherReceipt</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">marketReceipt</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">paymentReceipt</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">finalReceipt</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">basketReceipt</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">instrumentNotice</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">instrumentRejection</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d">processNymbox</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7">atProcessNymbox</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">processInbox</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e">atProcessInbox</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">transfer</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585">atTransfer</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">deposit</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3">atDeposit</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">withdrawal</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949">atWithdrawal</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">marketOffer</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74">atMarketOffer</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">paymentPlan</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc">atPaymentPlan</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">smartContract</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363">atSmartContract</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">cancelCronItem</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d">atCancelCronItem</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">exchangeBasket</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61">atExchangeBasket</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">payDividend</a>, 
<br/>
&#160;&#160;<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594">atPayDividend</a>, 
<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">error_state</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aeabba0a2b6a52c8f50a329f7d14a1ba1">IsCancelled</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a897714409d64aefd879ea08ec2e1731a">SetAsCancelled</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aceb0b4c83da5f50512bf6045fef6583b">SetParent</a> (const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theParent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a492f3f835f309bd2e76e5d7cc4dc10a1">AddNumbersToTransaction</a> (const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;theAddition)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aa068df53b397fd48fe4af07910eeb86d">SetAbbrevAdjustment</a> (const int64_t lAmount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a93386652206ed5d439ed03abf9798d92">SetAbbrevDisplayAmount</a> (const int64_t lAmount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a5d52aa9eeff78830b9ba53585e36a2ad">GetAbbrevInRefDisplay</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a46dc320ee8a88d5a647c014a1cdbbd65">SetAbbrevInRefDisplay</a> (const int64_t lAmount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const int64_t &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aa90624fb50b1b0edb72c6d4bd7b01a4c">GetRequestNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a8db20f109eab5bf715673bfcf3b3bb4f">SetRequestNum</a> (const int64_t &amp;lNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aa2d20865cc45e7b94df2cc4b84cb5911">GetReplyTransSuccess</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a3099413a51aa3ec99b783a4e89144150">SetReplyTransSuccess</a> (const bool bVal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#af3c025bbdeb70a053c6149a32d8b9940">SetClosingNum</a> (const int64_t lClosingNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac20ace2092e06d5bf3d624b03eb6d623">CalculateNumberOfOrigin</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a1091822e3072f014a8b2f64b93917ca7">GetSenderUserIDForDisplay</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theReturnID)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">For display purposes. The "ref #" you actually display (versus the one you use internally) might change based on transaction type. (Like with a cheque receipt you actually have to load up the original cheque.)  <a href="#a1091822e3072f014a8b2f64b93917ca7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a829e1dc63a933dae6fd3761091a9a2b1">GetRecipientUserIDForDisplay</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theReturnID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#acf66d9f8f5d3a6e4ee0a418a41db6019">GetSenderAcctIDForDisplay</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theReturnID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a54221d2117096fd673147492a67f6755">GetRecipientAcctIDForDisplay</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theReturnID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#abc54a3c74c5235cfe1debe4a2f97c2cd">GetMemo</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strMemo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac5ffc9f0e274bbc617185a5335c061a3">GetSuccess</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ad003537b610664b2a1bb6ccf9191f9a1">OTTransaction</a> (const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theOwner)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ae41b05f6008dade937e8a355a4a86feb">OTTransaction</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a722238fe05144806bcf8ec09976a229c">OTTransaction</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, int64_t lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a58c686431f3ff2bb448640a809160f2b">OTTransaction</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, const int64_t &amp;lNumberOfOrigin, const int64_t &amp;lTransactionNum, const int64_t &amp;lInRefTo, const int64_t &amp;lInRefDisplay, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> the_DATE_SIGNED, const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> theType, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strHash, const int64_t &amp;lAdjustment, const int64_t &amp;lDisplayValue, const int64_t &amp;lClosingNum, const int64_t &amp;lRequestNum, bool bReplyTransSuccess, <a class="el" href="class_o_t_num_list.html">OTNumList</a> *pNumList=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a428b050396c72e438cd39349f6ea8948">~OTTransaction</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">GenerateTransaction</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, int64_t lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#af729ee60ed39ff6f918873aedfc7a0af">ReleaseItems</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a4f9c8be70e01dfcd7bedbac7d6af887b">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a6548cbe73252c7554db6f6ceddebc5ae">Release_Transaction</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a12494b5a0460ce08f67033e0523caf97">SetType</a> (const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> theType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a> (const int64_t lLedgerType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ad755606f8f828547f3ddbd78fe370b30">SaveBoxReceipt</a> (<a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theLedger)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac2e9b2e8e4a00f439109273b6a7ea658">DeleteBoxReceipt</a> (<a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theLedger)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a51fc66087f5a0acdfc4a1054298b23b7">VerifyBoxReceipt</a> (<a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theFullVersion)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#abb94fbee174343f38ca30eaa25487cb4">VerifyBalanceReceipt</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;SERVER_NYM, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;THE_NYM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a3133d3def40d31a08f169b406f847b5f">VerifyTransactionReceipt</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;SERVER_NYM, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;THE_NYM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a196bf845f57deaf4e04493e462fd6d97">VerifyItems</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#afba0d981b40568e307178f908788fd7b">VerifyAccount</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aab7ec90e81dc8f273b8c29617e40bab6">GetItemCount</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a95246c5281488bbde41f3be2cc096a5f">GetItemCountInRefTo</a> (const int64_t lReference)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_item.html">OTItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a> (const <a class="el" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT <a class="el" href="class_o_t_item.html">OTItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a45f5abaf0110fbd5abe7ab3a00699703">GetItemInRefTo</a> (const int64_t lReference)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a> (<a class="el" href="class_o_t_item.html">OTItem</a> &amp;theItem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">GetItemList</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a23e270a9dfc3b85d48d64582814232e5">SaveContractWallet</a> (std::ofstream &amp;ofs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#add17ff12beaf8f0ba84b73b6b564f5b0">SaveAbbreviatedNymboxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a0ea6c7483a961acfdef55cd992e4065d">SaveAbbreviatedOutboxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ab15380c235814aeb89779fb5f42401d4">SaveAbbreviatedInboxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac30eb05906f92766b5ce895854e682a3">SaveAbbrevPaymentInboxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a08424e75b8906896335609d7ca45c729">SaveAbbrevRecordBoxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#af73fe383da8254ef5cd2c8a27de79a29">SaveAbbrevExpiredBoxRecord</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOutput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a4a89382fb0a9a3500c19fe9107df3122">ProduceInboxReportItem</a> (<a class="el" href="class_o_t_item.html">OTItem</a> &amp;theBalanceItem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a1820ab7e64e5cd46baf19f21ce2f0bf0">ProduceOutboxReportItem</a> (<a class="el" href="class_o_t_item.html">OTItem</a> &amp;theBalanceItem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ac8a30dd62230f12131a77471796fd88a">HarvestOpeningNumber</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a024827b70ceaf1f9fbf10bd505de348a">HarvestClosingNumbers</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aa0726f273b313b03bad0390ed2b8bb19">LoadAbbreviatedRecord</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml, int64_t &amp;lNumberOfOrigin, int64_t &amp;lTransactionNum, int64_t &amp;lInRefTo, int64_t &amp;lInRefDisplay, <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;the_DATE_SIGNED, <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> &amp;theType, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strHash, int64_t &amp;lAdjustment, int64_t &amp;lDisplayValue, int64_t &amp;lClosingNum, int64_t &amp;lRequestNum, bool &amp;bReplyTransSuccess, <a class="el" href="class_o_t_num_list.html">OTNumList</a> *pNumList=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a7674b6e41e6cf8c9cc26c35e15fc21d8">GenerateTransaction</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theUserID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAccountID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theServerID, <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> theType, int64_t lTransactionNum=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a640621b2732e9f97dc94be142f0c648b">GenerateTransaction</a> (const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theOwner, <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> theType, int64_t lTransactionNum=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">LoadBoxReceipt</a> (<a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theAbbrev, <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theLedger)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_transaction.html">OTTransaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a6e8558a4ea21189062fcc224dd6fe6a9">LoadBoxReceipt</a> (<a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theAbbrev, const int64_t lLedgerType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#acf756f8e3b1d1b9f1e9d2bcb48cbe927">VerifyBoxReceiptExists</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">SetupBoxReceiptFilename</a> (const int64_t lLedgerType, <a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theTransaction, const char *szCaller, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder1name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder2name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder3name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFilename)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a26ed98e266bb7462e2d5fc8609f3d60d">SetupBoxReceiptFilename</a> (<a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;theLedger, <a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;theTransaction, const char *szCaller, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder1name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder2name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder3name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFilename)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a73b0080083ff18496554155dcdd5c197">SetupBoxReceiptFilename</a> (const int64_t lLedgerType, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strUserOrAcctID, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strServerID, const int64_t &amp;lTransactionNum, const char *szCaller, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder1name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder2name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFolder3name, <a class="el" href="class_o_t_string.html">OTString</a> &amp;strFilename)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ae4bcd8edaf9b3cb72b0a68d503af804c">VerifyBalanceReceipt</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;SERVER_NYM, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;THE_NYM, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a3ce6cac1f366f808f0296473138363eb">VerifyTransactionReceipt</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;SERVER_NYM, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;THE_NYM, <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a806b1bd373a5777b5a41d5141e9e914d">GetTypeFromString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strType)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ab32a4098c75d0e48616e65caafa60fe0">_GetTypeString</a> (<a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> theType)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a18d4d5da09f16aac3ccb97984ec021b1">ProcessXMLNode</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a903a5b5d56e7f2856a51e2cdee6d511d">UpdateContents</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="class_o_t_ledger.html">OTLedger</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a115f7417f09e3e815212d770e7b60a1b">m_ascCancellationRequest</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_transaction_type.html">OTTransactionType</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_transaction.html#a50cdde745e8606b4c07fd2ca1a18251f">OTTransactionType::TransactionFactory</a> (<a class="el" href="class_o_t_string.html">OTString</a> strInput)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00348">348</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8"></a><!-- doxytag: member="OTTransaction::transactionType" ref="af6b54636f1000e09f19d1c7a7886e1f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e"></a><!-- doxytag: member="blank" ref="af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e" args="" -->blank</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f"></a><!-- doxytag: member="message" ref="af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f" args="" -->message</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da"></a><!-- doxytag: member="notice" ref="af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da" args="" -->notice</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c"></a><!-- doxytag: member="replyNotice" ref="af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c" args="" -->replyNotice</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9"></a><!-- doxytag: member="successNotice" ref="af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9" args="" -->successNotice</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08"></a><!-- doxytag: member="pending" ref="af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08" args="" -->pending</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb"></a><!-- doxytag: member="transferReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb" args="" -->transferReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af"></a><!-- doxytag: member="chequeReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af" args="" -->chequeReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8"></a><!-- doxytag: member="voucherReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8" args="" -->voucherReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63"></a><!-- doxytag: member="marketReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63" args="" -->marketReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d"></a><!-- doxytag: member="paymentReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d" args="" -->paymentReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4"></a><!-- doxytag: member="finalReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4" args="" -->finalReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377"></a><!-- doxytag: member="basketReceipt" ref="af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377" args="" -->basketReceipt</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f"></a><!-- doxytag: member="instrumentNotice" ref="af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f" args="" -->instrumentNotice</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b"></a><!-- doxytag: member="instrumentRejection" ref="af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b" args="" -->instrumentRejection</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d"></a><!-- doxytag: member="processNymbox" ref="af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d" args="" -->processNymbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7"></a><!-- doxytag: member="atProcessNymbox" ref="af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7" args="" -->atProcessNymbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada"></a><!-- doxytag: member="processInbox" ref="af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada" args="" -->processInbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e"></a><!-- doxytag: member="atProcessInbox" ref="af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e" args="" -->atProcessInbox</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d"></a><!-- doxytag: member="transfer" ref="af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d" args="" -->transfer</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585"></a><!-- doxytag: member="atTransfer" ref="af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585" args="" -->atTransfer</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228"></a><!-- doxytag: member="deposit" ref="af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228" args="" -->deposit</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3"></a><!-- doxytag: member="atDeposit" ref="af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3" args="" -->atDeposit</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7"></a><!-- doxytag: member="withdrawal" ref="af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7" args="" -->withdrawal</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949"></a><!-- doxytag: member="atWithdrawal" ref="af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949" args="" -->atWithdrawal</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0"></a><!-- doxytag: member="marketOffer" ref="af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0" args="" -->marketOffer</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74"></a><!-- doxytag: member="atMarketOffer" ref="af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74" args="" -->atMarketOffer</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0"></a><!-- doxytag: member="paymentPlan" ref="af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0" args="" -->paymentPlan</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc"></a><!-- doxytag: member="atPaymentPlan" ref="af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc" args="" -->atPaymentPlan</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0"></a><!-- doxytag: member="smartContract" ref="af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0" args="" -->smartContract</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363"></a><!-- doxytag: member="atSmartContract" ref="af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363" args="" -->atSmartContract</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5"></a><!-- doxytag: member="cancelCronItem" ref="af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5" args="" -->cancelCronItem</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d"></a><!-- doxytag: member="atCancelCronItem" ref="af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d" args="" -->atCancelCronItem</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a"></a><!-- doxytag: member="exchangeBasket" ref="af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a" args="" -->exchangeBasket</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61"></a><!-- doxytag: member="atExchangeBasket" ref="af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61" args="" -->atExchangeBasket</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4"></a><!-- doxytag: member="payDividend" ref="af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4" args="" -->payDividend</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594"></a><!-- doxytag: member="atPayDividend" ref="af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594" args="" -->atPayDividend</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91"></a><!-- doxytag: member="error_state" ref="af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91" args="" -->error_state</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00361">361</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="comment">// ***** INBOX / OUTBOX / NYMBOX</span>

<span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="comment">// NYMBOX</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">blank</a>,          <span class="comment">// freshly issued transaction number, not used yet</span>
                        <span class="comment">// (the server drops these into the nymbox.)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f">message</a>,        <span class="comment">// A message from one user to another, also in the nymbox.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">notice</a>,         <span class="comment">// A notice from the server. Used in Nymbox.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">replyNotice</a>,    <span class="comment">// A copy of a server reply to a previous request you sent. (To make SURE you get the reply.)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">successNotice</a>,  <span class="comment">// A transaction # has successfully been signed out.</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>

        <span class="comment">// INBOX / OUTBOX (pending transfer)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">pending</a>,        <span class="comment">// Server puts this in your outbox (when sending) and recipient&#39;s inbox.</span>

        <span class="comment">// INBOX / receipts</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">transferReceipt</a>,<span class="comment">// the server drops this into your inbox, when someone accepts your transfer.</span>

        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">chequeReceipt</a>,  <span class="comment">// the server drops this into your inbox, when someone deposits your cheque.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">voucherReceipt</a>, <span class="comment">// the server drops this into your inbox, when someone deposits your voucher.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">marketReceipt</a>,  <span class="comment">// server periodically drops this into your inbox if an offer is live.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">paymentReceipt</a>, <span class="comment">// the server drops this into people&#39;s inboxes, every time a payment processes. (from a payment plan or a smart contract)</span>

        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">finalReceipt</a>,   <span class="comment">// the server drops this into your in/nym box(es), when a CronItem expires or is canceled.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">basketReceipt</a>,  <span class="comment">// the server drops this into your inboxes, when a basket exchange is processed.</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>

        <span class="comment">// PAYMENT INBOX / PAYMENT OUTBOX / RECORD BOX</span>

        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">instrumentNotice</a>,       <span class="comment">// Receive these in paymentInbox (by way of Nymbox), and send in Outpayments (like Outmail).) (When done, they go to recordBox or expiredBox to await deletion.)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">instrumentRejection</a>,    <span class="comment">// When someone rejects your invoice from his paymentInbox, you get one of these in YOUR paymentInbox.</span>

<span class="comment">// --------------------------------------------------------------------------------------</span>

        <span class="comment">// **** MESSAGES ****</span>

        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d">processNymbox</a>,  <span class="comment">// process nymbox transaction    // comes from client</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7">atProcessNymbox</a>,<span class="comment">// process nymbox reply          // comes from server</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">processInbox</a>,   <span class="comment">// process inbox transaction     // comes from client</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e">atProcessInbox</a>, <span class="comment">// process inbox reply           // comes from server</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">transfer</a>,       <span class="comment">// or &quot;spend&quot;. This transaction is a request to transfer from one account to another</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585">atTransfer</a>,     <span class="comment">// reply from the server regarding a transfer request</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">deposit</a>,        <span class="comment">// this transaction is a deposit (cash or cheque)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3">atDeposit</a>,      <span class="comment">// reply from the server regarding a deposit request</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">withdrawal</a>,     <span class="comment">// this transaction is a withdrawal (cash or voucher)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949">atWithdrawal</a>,   <span class="comment">// reply from the server regarding a withdrawal request</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">marketOffer</a>,    <span class="comment">// this transaction is a market offer</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74">atMarketOffer</a>,  <span class="comment">// reply from the server regarding a market offer</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">paymentPlan</a>,    <span class="comment">// this transaction is a payment plan</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc">atPaymentPlan</a>,  <span class="comment">// reply from the server regarding a payment plan</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">smartContract</a>,  <span class="comment">// this transaction is a smart contract</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363">atSmartContract</a>,<span class="comment">// reply from the server regarding a smart contract</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">cancelCronItem</a>, <span class="comment">// this transaction is intended to cancel a market offer or payment plan.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d">atCancelCronItem</a>,<span class="comment">// reply from the server regarding said cancellation.</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">exchangeBasket</a>, <span class="comment">// this transaction is an exchange in/out of a basket currency.</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61">atExchangeBasket</a>,<span class="comment">// reply from the server regarding said exchange.</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">payDividend</a>,    <span class="comment">// this transaction is dividend payment (to all shareholders...)</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594">atPayDividend</a>,  <span class="comment">// reply from the server regarding said dividend payment.</span>
<span class="comment">// --------------------------------------------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">error_state</a>
    };   <span class="comment">// If you add any types to this list, update the list of strings at the top of the .CPP file.</span>
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a0c71e0fea951a8d757e69ec369c5add0"></a><!-- doxytag: member="OTTransaction::OTTransaction" ref="a0c71e0fea951a8d757e69ec369c5add0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction::OTTransaction</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03396">3396</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                             : ot_super(),
    <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>(NULL),
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>(<span class="keyword">false</span>), <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>(0),
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>),
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>(0), <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>(0), 
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad003537b610664b2a1bb6ccf9191f9a1"></a><!-- doxytag: member="OTTransaction::OTTransaction" ref="ad003537b610664b2a1bb6ccf9191f9a1" args="(const OTLedger &amp;theOwner)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction::OTTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theOwner</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03413">3413</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: ot_super(theOwner.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), theOwner.<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>(), theOwner.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()),
<span class="comment">// --------</span>
    <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>(&amp;theOwner),
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>(<span class="keyword">false</span>), <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>(0),
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>),
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>(0), <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>(0), 
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a>();

}
</pre></div>
</div>
</div>
<a class="anchor" id="ae41b05f6008dade937e8a355a4a86feb"></a><!-- doxytag: member="OTTransaction::OTTransaction" ref="ae41b05f6008dade937e8a355a4a86feb" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction::OTTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03434">3434</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: ot_super(theUserID, theAccountID, theServerID),
<span class="comment">// --------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>(NULL),
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>(<span class="keyword">false</span>), <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>(0),
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>),
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>(0), <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>(0), 
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a>();
    
<span class="comment">//  m_AcctID    = theID;        // these must be loaded or generated. NOT set in constructor, for security reasons.</span>
<span class="comment">//  m_ServerID  = theServerID;  // There are only here in ghostly form as a WARNING to you!</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a722238fe05144806bcf8ec09976a229c"></a><!-- doxytag: member="OTTransaction::OTTransaction" ref="a722238fe05144806bcf8ec09976a229c" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID, int64_t lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction::OTTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03451">3451</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: ot_super(theUserID, theAccountID, theServerID, lTransactionNum),
<span class="comment">// --------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>(NULL),
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>(<span class="keyword">false</span>), <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>(0), <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>(0),
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>), <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>(0), <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>(0),
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a>();
    
<span class="comment">//  m_lTransactionNum = lTransactionNum;    // This is set in OTTransactionType&#39;s constructor, as are m_ID and m_ServerID</span>
<span class="comment">//  m_AcctID    = theID;                    // these must be loaded or generated. NOT set in constructor, for security reasons.</span>
<span class="comment">//  m_ServerID  = theServerID;              // There are only here in ghostly form as a WARNING to you!</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a58c686431f3ff2bb448640a809160f2b"></a><!-- doxytag: member="OTTransaction::OTTransaction" ref="a58c686431f3ff2bb448640a809160f2b" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID, const int64_t &amp;lNumberOfOrigin, const int64_t &amp;lTransactionNum, const int64_t &amp;lInRefTo, const int64_t &amp;lInRefDisplay, const time64_t the_DATE_SIGNED, const transactionType theType, const OTString &amp;strHash, const int64_t &amp;lAdjustment, const int64_t &amp;lDisplayValue, const int64_t &amp;lClosingNum, const int64_t &amp;lRequestNum, bool bReplyTransSuccess, OTNumList *pNumList=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction::OTTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNumberOfOrigin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lInRefTo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lInRefDisplay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>the_DATE_SIGNED</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lAdjustment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lDisplayValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lClosingNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bReplyTransSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> *&#160;</td>
          <td class="paramname"><em>pNumList</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03489">3489</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">: ot_super(theUserID, theAccountID, theServerID, lTransactionNum), 
<span class="comment">//--------------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>(NULL),
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>(<span class="keyword">true</span>), <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>(lAdjustment), <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>(lDisplayValue), 
    <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>(lInRefDisplay), <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>(strHash),
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>(the_DATE_SIGNED), <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>(theType), <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>(lClosingNum),
    <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>(lRequestNum),
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>(bReplyTransSuccess),
    <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">InitTransaction</a>();
    
    <span class="comment">// This gets zeroed out in InitTransaction() above. But since we set it in this</span>
    <span class="comment">// constructor, I&#39;m setting it back again.</span>
    <span class="comment">// Then why call it? I don&#39;t know, convention? For the sake of future subclasses?</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>            = <span class="keyword">true</span>;
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>               = the_DATE_SIGNED; 
    <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>                      = theType; <span class="comment">// This one is same story as date signed. Setting it back.</span>
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>     = lClosingNum;
    <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>             = lAdjustment;
    <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>            = lDisplayValue;
    <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>             = lInRefDisplay;

    <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>            = lRequestNum;          <span class="comment">// for replyNotice</span>
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>        = bReplyTransSuccess;   <span class="comment">// for replyNotice</span>
    
    <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(strHash);
    <a class="code" href="class_o_t_transaction_type.html#a9635c291325b18d1d219a6286d0f8a72">m_lTransactionNum</a>           = lTransactionNum;  <span class="comment">// This is set in OTTransactionType&#39;s constructor, as are m_ID and m_ServerID</span>

    <a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lInRefTo);
    <a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(lNumberOfOrigin);
    
    <span class="comment">// NOTE: For THIS CONSTRUCTOR ONLY, we DO set the purported AcctID and purported ServerID.</span>
    <span class="comment">// (AFTER the constructor has executed, in OTLedger::ProcessXMLNode();</span>
    <span class="comment">//</span>
    <span class="comment">// WHY? Normally you set the &quot;real&quot; IDs at construction, and then set the &quot;purported&quot; IDs</span>
    <span class="comment">// when loading from string. But this constructor (only this one) is actually used when </span>
    <span class="comment">// loading abbreviated receipts as you load their inbox/outbox/nymbox.</span>
    <span class="comment">// Abbreviated receipts are not like real transactions, which have serverID, AcctID, userID,</span>
    <span class="comment">// and signature attached, and the whole thing is base64-encoded and then added to the ledger</span>
    <span class="comment">// as part of a list of contained objects. Rather, with abbreviated receipts, there are a series</span>
    <span class="comment">// of XML records loaded up as PART OF the ledger itself. None of these individual XML records</span>
    <span class="comment">// has its own signature, or its own record of the main IDs -- those are assumed to be on the parent</span>
    <span class="comment">// ledger.</span>
    <span class="comment">// That&#39;s the whole point: abbreviated records don&#39;t store redundant info, and don&#39;t each have their</span>
    <span class="comment">// own signature, because we want them to be as small as possible inside their parent ledger.</span>
    <span class="comment">// Therefore I will pass in the parent ledger&#39;s &quot;real&quot; IDs at construction, and immediately thereafter</span>
    <span class="comment">// set the parent ledger&#39;s &quot;purported&quot; IDs onto the abbreviated transaction. That way, VerifyContractID()</span>
    <span class="comment">// will still work and do its job properly with these abbreviated records.</span>
    
    <span class="comment">// Note: I&#39;m going to go ahead and set it in here for now. This is a special constructor (abbreviated receipt constructor)</span>
    <span class="comment">// todo: come back to this during security sweep.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(theAccountID);
    <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theAccountID);
    
    <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(theServerID);
    <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theServerID);
    
    <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(theUserID);
    <span class="comment">// ---------------------</span>
    
    <span class="keywordflow">if</span> (NULL != pNumList)
        <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a> = *pNumList;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a428b050396c72e438cd39349f6ea8948"></a><!-- doxytag: member="OTTransaction::~OTTransaction" ref="a428b050396c72e438cd39349f6ea8948" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#a428b050396c72e438cd39349f6ea8948">OTTransaction::~OTTransaction</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03647">3647</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html#a6548cbe73252c7554db6f6ceddebc5ae">Release_Transaction</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab32a4098c75d0e48616e65caafa60fe0"></a><!-- doxytag: member="OTTransaction::_GetTypeString" ref="ab32a4098c75d0e48616e65caafa60fe0" args="(transactionType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * <a class="el" href="class_o_t_transaction.html#ab32a4098c75d0e48616e65caafa60fe0">OTTransaction::_GetTypeString</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00211">211</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                  {
    int32_t nType = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (theType);
    <span class="keywordflow">return</span> <a class="code" href="_o_t_account_8cpp.html#a26fff90a622c312ec2140eb6ae9f819c">__TypeStrings</a>[nType];
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5abc071b7eeddc40ea151cccd011e4d6"></a><!-- doxytag: member="OTTransaction::AddItem" ref="a5abc071b7eeddc40ea151cccd011e4d6" args="(OTItem &amp;theItem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">OTTransaction::AddItem</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_item.html">OTItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theItem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03685">3685</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{ 
    <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.push_back(&amp;theItem);  
} 
</pre></div>
</div>
</div>
<a class="anchor" id="a492f3f835f309bd2e76e5d7cc4dc10a1"></a><!-- doxytag: member="OTTransaction::AddNumbersToTransaction" ref="a492f3f835f309bd2e76e5d7cc4dc10a1" args="(const OTNumList &amp;theAddition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a492f3f835f309bd2e76e5d7cc4dc10a1">OTTransaction::AddNumbersToTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>theAddition</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04632">4632</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.Add(theAddition);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac20ace2092e06d5bf3d624b03eb6d623"></a><!-- doxytag: member="OTTransaction::CalculateNumberOfOrigin" ref="ac20ace2092e06d5bf3d624b03eb6d623" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#ac20ace2092e06d5bf3d624b03eb6d623">OTTransaction::CalculateNumberOfOrigin</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#ae3f4b46eb4a75b7c8e0b47cf692efb38">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06103">6103</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(!<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>());
    <span class="comment">// ----------------------------    </span>
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">blank</a>:           <span class="comment">// freshly issued transaction number, not used yet</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f">message</a>:         <span class="comment">// A message from one user to another, also in the nymbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">notice</a>:          <span class="comment">// A notice from the server. Used in Nymbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">replyNotice</a>:     <span class="comment">// A copy of a server reply to a previous request you sent. (To make SURE you get the reply.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">successNotice</a>:   <span class="comment">// A transaction # has successfully been signed out.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d">processNymbox</a>:   <span class="comment">// process nymbox transaction    // comes from client</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7">atProcessNymbox</a>: <span class="comment">// process nymbox reply          // comes from server</span>
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);  <span class="comment">// Not applicable.</span>
            <span class="keywordflow">break</span>;
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">pending</a>:         <span class="comment">// Server puts this in your outbox (when sending) and recipient&#39;s inbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">marketReceipt</a>:   <span class="comment">// server periodically drops this into your inbox if an offer is live.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">paymentReceipt</a>:  <span class="comment">// the server drops this into people&#39;s inboxes, every time a payment processes.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">finalReceipt</a>:    <span class="comment">// the server drops this into your in/nym box(es), when a CronItem expires or is canceled.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">basketReceipt</a>:   <span class="comment">// the server drops this into your inboxes, when a basket exchange is processed.</span>
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(this-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()); <span class="comment">// pending is in reference to the original transfer.</span>
            <span class="keywordflow">break</span>;
        <span class="comment">// --------------------------------------------------------------------------------------            </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">transferReceipt</a>:       <span class="comment">// the server drops this into your inbox, when someone accepts your transfer.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">deposit</a>:               <span class="comment">// this transaction is a deposit (cash or cheque)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3">atDeposit</a>:             <span class="comment">// reply from the server regarding a deposit request</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">instrumentNotice</a>:      <span class="comment">// Receive these in paymentInbox (by way of Nymbox), and send in Outpayments.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">instrumentRejection</a>:   <span class="comment">// When someone rejects your invoice, you get one of these in YOUR paymentInbox.</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: In this case, you can&#39;t calculate the origin number, you must set it explicitly.\n&quot;</span>,
                          __FUNCTION__);
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);  <span class="comment">// Not applicable.</span>
            <span class="comment">// Comment this out later so people can&#39;t use it to crash the server:</span>
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;In this case, you can&#39;t calculate the origin number, you must set it explicitly.&quot;</span>);
            <span class="keywordflow">break</span>;
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">chequeReceipt</a>:   <span class="comment">// the server drops this into your inbox, when someone deposits your cheque.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">voucherReceipt</a>:  <span class="comment">// the server drops this into your inbox, when someone deposits your voucher.</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strReference;
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
            
            <span class="comment">// &quot;In reference to&quot; is the depositor&#39;s trans#, which I use here to load the depositor&#39;s</span>
            <span class="comment">// depositCheque item, which I use to get the cheque, which contains the number of origin</span>
            <span class="comment">// as its transaction number.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference,
                                                                  this-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
                                                                  this-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOriginalItem);
            <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel(pOriginalItem);
            <span class="comment">// ------------------------------------------------</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a> != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR: Wrong item type attached to %s &quot;</span>
                              <span class="stringliteral">&quot;(expected OTItem::depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">chequeReceipt</a> == this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);
                <span class="keywordflow">return</span>;
            }
            <span class="comment">// ------------------------------------------------</span>
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>());
        }
            <span class="keywordflow">break</span>;
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">processInbox</a>:      <span class="comment">// process inbox transaction    // comes from client</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e">atProcessInbox</a>:    <span class="comment">// process inbox reply          // comes from server</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">transfer</a>:          <span class="comment">// or &quot;spend&quot;. This transaction is a request to transfer from one account to another</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585">atTransfer</a>:        <span class="comment">// reply from the server regarding a transfer request</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">withdrawal</a>:        <span class="comment">// this transaction is a withdrawal (cash or voucher)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949">atWithdrawal</a>:      <span class="comment">// reply from the server regarding a withdrawal request</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">marketOffer</a>:       <span class="comment">// this transaction is a market offer</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74">atMarketOffer</a>:     <span class="comment">// reply from the server regarding a market offer</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">paymentPlan</a>:       <span class="comment">// this transaction is a payment plan</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc">atPaymentPlan</a>:     <span class="comment">// reply from the server regarding a payment plan</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">smartContract</a>:     <span class="comment">// this transaction is a smart contract</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363">atSmartContract</a>:   <span class="comment">// reply from the server regarding a smart contract</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">cancelCronItem</a>:    <span class="comment">// this transaction is intended to cancel a market offer or payment plan.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d">atCancelCronItem</a>:  <span class="comment">// reply from the server regarding said cancellation.</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">exchangeBasket</a>:    <span class="comment">// this transaction is an exchange in/out of a basket currency.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61">atExchangeBasket</a>:  <span class="comment">// reply from the server regarding said exchange.</span>
        <span class="comment">// --------------------------------------------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">payDividend</a>:       <span class="comment">// this transaction is dividend payment (to all shareholders...)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594">atPayDividend</a>:     <span class="comment">// reply from the server regarding said dividend payment.</span>
        <span class="comment">// --------------------------------------------------------------------------------------            </span>
        <span class="keywordflow">default</span>:
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
            <span class="keywordflow">break</span>;
    } <span class="comment">// switch</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac2e9b2e8e4a00f439109273b6a7ea658"></a><!-- doxytag: member="OTTransaction::DeleteBoxReceipt" ref="ac2e9b2e8e4a00f439109273b6a7ea658" args="(OTLedger &amp;theLedger)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ac2e9b2e8e4a00f439109273b6a7ea658">OTTransaction::DeleteBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theLedger</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l02929">2929</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strFolder1name, strFolder2name, strFolder3name, strFilename;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(theLedger, *<span class="keyword">this</span>, 
                                                        <span class="stringliteral">&quot;OTTransaction::DeleteBoxReceipt&quot;</span>,
                                                        strFolder1name, strFolder2name, strFolder3name,
                                                        strFilename))
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// This already logs -- no need to log twice, here.</span>
    <span class="comment">// -------------------------------------------------------------------- </span>
    <span class="comment">// See if the box receipt exists before trying to save over it...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Box receipt already doesn&#39;t exist, thus no need to delete: &quot;</span>
                       <span class="stringliteral">&quot;At location: %s%s%s%s%s%s%s\n&quot;</span>, __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                       <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                       strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                       <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>

    <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp;
    
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        ascTemp.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>);
    
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strFinal, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error deleting (writing over) box receipt (failed writing armored string):\n%s%s%s%s%s%s%s\n&quot;</span>, 
                          __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                          <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                          strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    <span class="comment">// --------------------------------------------------------------------</span>

    <span class="comment">// NOTE: I do the armored string FIRST, THEN add the &quot;marked for deletion&quot; </span>
    <span class="comment">// part as I save it. (This way, it&#39;s still searchable with grep.)</span>
    
    <span class="comment">//</span>
    <span class="comment">// Try to save the deleted box receipt to local storage.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
    
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        strOutput.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s\n\n%s\n&quot;</span>, strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <span class="stringliteral">&quot;MARKED_FOR_DELETION&quot;</span>); <span class="comment">// todo hardcoded.</span>
    <span class="keywordflow">else</span> 
        strOutput.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s\n\n%s\n&quot;</span>, 
                         <span class="stringliteral">&quot;(Transaction was already empty -- strange.)&quot;</span>, 
                         <span class="stringliteral">&quot;MARKED_FOR_DELETION&quot;</span>); <span class="comment">// todo hardcoded.</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    
    <span class="keywordtype">bool</span> bDeleted = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                                           strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                           strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bDeleted)
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error deleting (writing over) file: &quot;</span>
                      <span class="stringliteral">&quot;%s%s%s%s%s%s%s\nContents:\n\n%s\n\n&quot;</span>, 
                      __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                      <a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> bDeleted;    
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5bfc7ce34aa67cf9dad96e661e118020"></a><!-- doxytag: member="OTTransaction::GenerateTransaction" ref="a5bfc7ce34aa67cf9dad96e661e118020" args="(const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID, int64_t lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03624">3624</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Presumably the constructor was just called, so m_ID and m_ServerID are already set properly.</span>
    <span class="comment">// I might make a class factory in order to enforce this. Sounds like an appropriate situation.</span>
    <span class="comment">//m_ID</span>
    <span class="comment">//m_ServerID</span>
    
    <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theAccountID);
    <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theServerID);
    
    <a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(lTransactionNum);
    
    <span class="comment">// Make sure these match with the ones that were passed into the constructor.</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7674b6e41e6cf8c9cc26c35e15fc21d8"></a><!-- doxytag: member="OTTransaction::GenerateTransaction" ref="a7674b6e41e6cf8c9cc26c35e15fc21d8" args="(const OTIdentifier &amp;theUserID, const OTIdentifier &amp;theAccountID, const OTIdentifier &amp;theServerID, transactionType theType, int64_t lTransactionNum=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theUserID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03596">3596</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <span class="keyword">new</span> <a class="code" href="class_o_t_transaction.html#a0c71e0fea951a8d757e69ec369c5add0">OTTransaction</a>(theUserID, theAccountID, theServerID, lTransactionNum);
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);
    
    pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a> = theType;
    
    <span class="comment">// Since we&#39;re actually generating this transaction, then we can go ahead</span>
    <span class="comment">// and set the purported account and server IDs (we have already set the</span>
    <span class="comment">// real ones in the constructor). Now both sets are fill with matching data.</span>
    <span class="comment">// No need to security check the IDs since we are creating this transaction</span>
    <span class="comment">// versus loading and inspecting it.</span>
    pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(theAccountID);
    pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(theServerID);
    
    <span class="keywordflow">return</span> pTransaction;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a640621b2732e9f97dc94be142f0c648b"></a><!-- doxytag: member="OTTransaction::GenerateTransaction" ref="a640621b2732e9f97dc94be142f0c648b" args="(const OTLedger &amp;theOwner, transactionType theType, int64_t lTransactionNum=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theOwner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lTransactionNum</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03584">3584</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">GenerateTransaction</a>(theOwner.<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), theOwner.<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>(), 
                                                       theOwner.<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), theType, lTransactionNum);  
    <span class="keywordflow">if</span> (NULL != pTransaction)
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aceb0b4c83da5f50512bf6045fef6583b">SetParent</a>(theOwner);
    
    <span class="keywordflow">return</span> pTransaction;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a26f3f7cf81e9b5fdd2c66646713a4e95"></a><!-- doxytag: member="OTTransaction::GetAbbrevAdjustment" ref="a26f3f7cf81e9b5fdd2c66646713a4e95" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">OTTransaction::GetAbbrevAdjustment</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00588">588</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a9ef2e2e40960239f6cbd0d1c1ded42f4"></a><!-- doxytag: member="OTTransaction::GetAbbrevDisplayAmount" ref="a9ef2e2e40960239f6cbd0d1c1ded42f4" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">OTTransaction::GetAbbrevDisplayAmount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00591">591</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a5d52aa9eeff78830b9ba53585e36a2ad"></a><!-- doxytag: member="OTTransaction::GetAbbrevInRefDisplay" ref="a5d52aa9eeff78830b9ba53585e36a2ad" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a5d52aa9eeff78830b9ba53585e36a2ad">OTTransaction::GetAbbrevInRefDisplay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00594">594</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="aeaa0c946e4a737e0144cbbf102f37ed4"></a><!-- doxytag: member="OTTransaction::GetClosingNum" ref="aeaa0c946e4a737e0144cbbf102f37ed4" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">OTTransaction::GetClosingNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00218">218</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>; 
}   
</pre></div>
</div>
</div>
<a class="anchor" id="afb069b9f7ab72f90e9e42aed0ba3b17c"></a><!-- doxytag: member="OTTransaction::GetDateSigned" ref="afb069b9f7ab72f90e9e42aed0ba3b17c" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="el" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">OTTransaction::GetDateSigned</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00624">624</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a62bf5069d7a7fda92fa1d6746a75bb49"></a><!-- doxytag: member="OTTransaction::GetItem" ref="a62bf5069d7a7fda92fa1d6746a75bb49" args="(const OTItem::itemType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_item.html">OTItem</a> * <a class="el" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">OTTransaction::GetItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03692">3692</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
    {
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
        
        <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == theType)
            <span class="keywordflow">return</span> pItem;
    }
    
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aab7ec90e81dc8f273b8c29617e40bab6"></a><!-- doxytag: member="OTTransaction::GetItemCount" ref="aab7ec90e81dc8f273b8c29617e40bab6" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_transaction.html#aab7ec90e81dc8f273b8c29617e40bab6">OTTransaction::GetItemCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00757">757</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (<a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.size()); }
</pre></div>
</div>
</div>
<a class="anchor" id="a95246c5281488bbde41f3be2cc096a5f"></a><!-- doxytag: member="OTTransaction::GetItemCountInRefTo" ref="a95246c5281488bbde41f3be2cc096a5f" args="(const int64_t lReference)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_transaction.html#a95246c5281488bbde41f3be2cc096a5f">OTTransaction::GetItemCountInRefTo</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lReference</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03734">3734</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nCount = 0;
    
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
    {
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
        
        <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReference)
            nCount++;
    }
    
    <span class="keywordflow">return</span> nCount;  
}
</pre></div>
</div>
</div>
<a class="anchor" id="a45f5abaf0110fbd5abe7ab3a00699703"></a><!-- doxytag: member="OTTransaction::GetItemInRefTo" ref="a45f5abaf0110fbd5abe7ab3a00699703" args="(const int64_t lReference)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_item.html">OTItem</a> * <a class="el" href="class_o_t_transaction.html#a45f5abaf0110fbd5abe7ab3a00699703">OTTransaction::GetItemInRefTo</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lReference</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03710">3710</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#a95246c5281488bbde41f3be2cc096a5f">GetItemCountInRefTo</a>(lReference) &gt; 1)
    {
        <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;CAN&#39;T USE GetItemInRefTo! (There are multiple items in reference to the same number...) SWITCH to using NumberOfOrigin?&quot;</span>);
    }
    <span class="comment">// -----------------------------------</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
    {
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
        
        <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == lReference)
            <span class="keywordflow">return</span> pItem;
    }
    
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9821c541d3d5f92e378320c6aa190c18"></a><!-- doxytag: member="OTTransaction::GetItemList" ref="a9821c541d3d5f92e378320c6aa190c18" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>&amp; <a class="el" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">OTTransaction::GetItemList</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00769">769</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="abc54a3c74c5235cfe1debe4a2f97c2cd"></a><!-- doxytag: member="OTTransaction::GetMemo" ref="abc54a3c74c5235cfe1debe4a2f97c2cd" args="(OTString &amp;strMemo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#abc54a3c74c5235cfe1debe4a2f97c2cd">OTTransaction::GetMemo</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strMemo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l07040">7040</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <a class="code" href="class_o_t_item.html">OTItem</a>     * pOriginalItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a>     theItemAngel;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem     = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strReference;
    this-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
    
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   
<span class="comment">//      case OTTransaction::marketReceipt: </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem;
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            
            <span class="keywordflow">if</span> (NULL != pItem)
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strUpdatedCronItem);
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failed trying to get paymentReceipt item from paymentReceipt transaction.\n&quot;</span>,
                              __FUNCTION__);

            pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strUpdatedCronItem);
            theCronItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pCronItem);
            
            <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmart = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pCronItem);
            <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   * pPlan  = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> *<span class="keyword">&gt;</span>(pCronItem);
            
            <span class="keywordflow">if</span> (NULL != pSmart) <span class="comment">// if it&#39;s a smart contract...</span>
            {
                <span class="comment">// NOTE: smart contracts currently do not have a &quot;memo&quot; field.</span>
                
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pPlan) <span class="comment">// else if it is a payment plan.</span>
            {
                <span class="keywordflow">if</span> (pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a242e72e1d0344a0ca85892468ded3dea">GetConsideration</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    strMemo.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a242e72e1d0344a0ca85892468ded3dea">GetConsideration</a>());

                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="comment">// else if it&#39;s any other kind of cron item.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to load Cron Item. Should never happen. Receipt: %lld  Origin: %lld\n&quot;</span>,
                              __FUNCTION__, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
            <span class="keywordflow">break</span>; <span class="comment">// this break never actually happens. Above always returns, if triggered.</span>
        <span class="comment">// ------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }
        <span class="keywordflow">default</span>: 
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------        </span>
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
        
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to transferReceipt\n&quot;</span>, __FUNCTION__);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> 
            {
                pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">GetNote</a>(strMemo);
                bSuccess = strMemo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>();
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> 
            {
                <a class="code" href="class_o_t_cheque.html">OTCheque</a>   theCheque;
                <a class="code" href="class_o_t_string.html">OTString</a>   strCheque;
                pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strCheque);
                <span class="comment">// -------------------------------------</span>
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == ((strCheque.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2) &amp;&amp;
                              theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strCheque)))
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading cheque or voucher from string:\n%s\n&quot;</span>,
                                  __FUNCTION__, strCheque.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
                <span class="comment">// ---------------------------------</span>
                <span class="comment">// Success loading the cheque.</span>
                <span class="comment">//</span>
                strMemo  = theCheque.<a class="code" href="class_o_t_cheque.html#a4990938b437cc95ab48ade4a80584023">GetMemo</a>();
                bSuccess = strMemo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>();
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: 
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to pending transfer\n&quot;</span>, __FUNCTION__);
            }
            <span class="keywordflow">else</span>
            {
                pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">GetNote</a>(strMemo);
                bSuccess = strMemo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>();
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">default</span>: 
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad39211b22193f35493b07e2eea92d3f5"></a><!-- doxytag: member="OTTransaction::GetNumberOfOrigin" ref="ad39211b22193f35493b07e2eea92d3f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">OTTransaction::GetNumberOfOrigin</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#a9e885f1dfd527880d0a0bf12cd28ed2e">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06072">6072</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// --------------------------------</span>
    <span class="keywordflow">if</span> (0 == <a class="code" href="class_o_t_transaction_type.html#a472b8131dde4747044a1784dd2935091">m_lNumberOfOrigin</a>)
    {
        <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        {
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">transferReceipt</a>:       <span class="comment">// the server drops this into your inbox, when someone accepts your transfer.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">deposit</a>:               <span class="comment">// this transaction is a deposit (cash or cheque)</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3">atDeposit</a>:             <span class="comment">// reply from the server regarding a deposit request</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">instrumentNotice</a>:      <span class="comment">// Receive these in paymentInbox (by way of Nymbox), and send in Outpayments.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">instrumentRejection</a>:   <span class="comment">// When someone rejects your invoice, you get one of these in YOUR paymentInbox.</span>
                <span class="comment">// ------------------------------------------------------------------------------</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: In this case, you can&#39;t calculate the origin number, you must set it explicitly.\n&quot;</span>,
                              __FUNCTION__);
                this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(0);  <span class="comment">// Not applicable.</span>
                <span class="comment">// Comment this out later so people can&#39;t use it to crash the server:</span>
                <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;In this case, you can&#39;t calculate the origin number, you must set it explicitly.&quot;</span>);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
                <span class="keywordflow">break</span>;
        }
        <span class="comment">// -----------------------------</span>
        this-&gt;<a class="code" href="class_o_t_transaction.html#ac20ace2092e06d5bf3d624b03eb6d623">CalculateNumberOfOrigin</a>();
    }
    <span class="comment">// -----------------------------    </span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction_type.html#a472b8131dde4747044a1784dd2935091">m_lNumberOfOrigin</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a01fdc95811465496f953c5a50dcef6"></a><!-- doxytag: member="OTTransaction::GetReceiptAmount" ref="a7a01fdc95811465496f953c5a50dcef6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">OTTransaction::GetReceiptAmount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05905">5905</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
    <span class="comment">// ---------------------------</span>
    int64_t lAdjustment = 0;
        
    <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel;

    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   <span class="comment">// These are the types that have an amount (somehow)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>: <span class="comment">// amount is stored on ** marketReceipt item **, on MY LIST of items.</span>
            pOriginalItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>); <span class="comment">// (The Reference string contains an OTCronItem with the Original Trade.)</span>
            <span class="keywordflow">break</span>;                                          <span class="comment">// The &quot;reference to&quot; ID is </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>: <span class="comment">// amount is stored on ** paymentReceipt ** item, on MY LIST of items.</span>
            pOriginalItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:  <span class="comment">// amount is stored on ** basketReceipt ** item, on MY LIST of items.</span>
            pOriginalItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on the ** transfer item **, here as reference string.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>: <span class="comment">// amount is stored on *cheque* (attached to ** depositCheque ITEM **, which is here as reference string.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on *voucher* (attached to ** depositCheque ITEM **, which is here as reference string.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:    <span class="comment">// amount is stored on ** acceptPending ITEM **, (here as reference string.)</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strReference;
            <a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);

            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }   
            
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> 0;
    }
    <span class="comment">// -------------------------------------------------</span>
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to find original item. Should never happen.\n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> 0; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    }
    <span class="comment">// -------------------------------------------------    </span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>

    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   <span class="comment">// These are the types that have an amount (somehow)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>: <span class="comment">// amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on voucher (attached to depositCheque item, attached.)</span>
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s. (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> 0;
            }
            
            <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strAttachment);
            <span class="keywordtype">bool</span> bLoadContractFromString = theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strAttachment);
            
            <span class="keywordflow">if</span> (!bLoadContractFromString)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strCheque(theCheque);
                
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR loading cheque from string in OTTransaction::%s:\n%s\n&quot;</span>,
                              __FUNCTION__, strCheque.Get());
            }
            <span class="keywordflow">else</span> 
            {
                lAdjustment = (theCheque.<a class="code" href="class_o_t_cheque.html#a84e570d654f20e69f64f0037b96b7c7e">GetAmount</a>()*(-1)); <span class="comment">// a cheque reduces my balance, unless it&#39;s negative.</span>
            }                                               <span class="comment">// So if I wrote a 100 clam cheque, that  means -100 hit my account when I got the</span>
                                                            <span class="comment">// chequeReceipt, and writing a -100c cheque means 100 went in when I got the chequeReceipt.</span>
        }
            <span class="keywordflow">break</span>;
            
            <span class="comment">// NOTE: a voucherReceipt (above) doesn&#39;t actually change your balance,</span>
            <span class="comment">// and neither does a transferReceipt. (below) But they both have a</span>
            <span class="comment">// &quot;receipt amount&quot; for display purposes.</span>
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: <span class="comment">// amount is stored on acceptPending item. (Server refuses acceptPendings with wrong amount on them.)</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to transferReceipt\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {   <span class="comment">// If I transfer 100 clams to someone, then my account is smaller by 100 clams. -100 has hit my account.</span>
                <span class="comment">// So the pending will show as -100 in my outbox, not 100, because that is the adjustment actually made to my account.</span>
                <span class="comment">// This positive/negative aspect of pending transactions is not stored in the data itself, since it switches based</span>
                <span class="comment">// on whether the pending appears in the inbox or the outbox. It&#39;s based on context. Whereas the transferReceipt</span>
                <span class="comment">// is IN REFERENCE TO that same transaction--it appears in my inbox when the recipient accepts the pending transfer</span>
                <span class="comment">// I sent him.) Therefore the transferReceipt is &quot;worth&quot; -100 (just as the pending in my outbox was &quot;worth&quot; -100), even</span>
                <span class="comment">// though its actual value is 0.</span>
                <span class="comment">// (Since the transferReceipt itself doesn&#39;t change my balance, but merely is a notice that such has happened.) You could</span>
                <span class="comment">// say, for example in the SaveAbbreviatedToInbox() function, that the transferReceipt has an &quot;actual value&quot; of 0 and a</span>
                <span class="comment">// &quot;display value&quot; of -100 clams, when it is in reference to an original transfer of 100 clams.</span>
                <span class="comment">// This function is clearly returning the display value, since the actual value (of 0) is useless, since balance</span>
                <span class="comment">// agreements already discount transferReceipts as having any impact on the balance.</span>
                <span class="comment">//</span>
                lAdjustment = (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>()*(-1)); <span class="comment">// &lt;====================</span>
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on transfer item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to pending transfer\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">// Pending transfer adds to my account if this is inbox, and removes if outbox. </span>
                <span class="comment">// I&#39;ll let the caller multiply by (-1) or not. His choice.</span>
                <span class="comment">// Note: Indeed, if you look in ProduceOutboxReportItem(), it is multiplying by (-1).</span>
                lAdjustment = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();   
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>: <span class="comment">// amount is stored on marketReceipt item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTItem::marketReceipt</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to marketReceipt\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();   <span class="comment">// THIS WILL ALSO USE THE POSITIVE / NEGATIVE THING. (Already.)</span>
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>: <span class="comment">// amount is stored on paymentReceipt item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTItem::paymentReceipt</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to paymentReceipt\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();   <span class="comment">// THIS WILL ALSO USE THE POSITIVE / NEGATIVE THING. (Already.)</span>
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:  <span class="comment">// amount is stored on basketReceipt item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTItem::basketReceipt</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to basketReceipt\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();   <span class="comment">// THIS WILL ALSO USE THE POSITIVE / NEGATIVE THING. (Already.)</span>
            }
            
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> 0;
    }

    <span class="keywordflow">return</span> lAdjustment;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a54221d2117096fd673147492a67f6755"></a><!-- doxytag: member="OTTransaction::GetRecipientAcctIDForDisplay" ref="a54221d2117096fd673147492a67f6755" args="(OTIdentifier &amp;theReturnID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a54221d2117096fd673147492a67f6755">OTTransaction::GetRecipientAcctIDForDisplay</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theReturnID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06908">6908</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <a class="code" href="class_o_t_item.html">OTItem</a>     * pOriginalItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a>     theItemAngel;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem     = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strReference;
    this-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
    
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   
<span class="comment">//      case OTTransaction::marketReceipt: </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem;
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            
            <span class="keywordflow">if</span> (NULL != pItem)
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strUpdatedCronItem);
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failed trying to get paymentReceipt item from paymentReceipt transaction.\n&quot;</span>,
                              __FUNCTION__);

            pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strUpdatedCronItem);
            theCronItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pCronItem);
            
            <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmart = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pCronItem);
            <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   * pPlan  = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> *<span class="keyword">&gt;</span>(pCronItem);
            
            <span class="keywordflow">if</span> (NULL != pSmart) <span class="comment">// if it&#39;s a smart contract...</span>
            {
                <span class="keywordflow">if</span> (!pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#a3493a6e50d526fd228d71eb3d571fda1">GetLastRecipientAcctID</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                
                theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#a3493a6e50d526fd228d71eb3d571fda1">GetLastRecipientAcctID</a>());
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pPlan) <span class="comment">// else if it&#39;s a payment plan.</span>
            {
                theReturnID = pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a66300d99a12d32b6825e7e11dfca8614">GetRecipientAcctID</a>();
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="comment">// else if it is any other kind of cron item...</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to load Cron Item. Should never happen. Receipt: %lld  Origin: %lld\n&quot;</span>,
                              __FUNCTION__, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
            <span class="keywordflow">break</span>; <span class="comment">// this break never actually happens. Above always returns, if triggered.</span>
        <span class="comment">// ------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------        </span>
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
        
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to transferReceipt\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> 
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>();  
                bSuccess = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> 
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>(); <span class="comment">// Here&#39;s the depositor&#39;s account ID (even though the cheque was made out to a user, not an account, it still eventually had to be DEPOSITED into an account... right?)</span>
                bSuccess = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on transfer item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to pending transfer\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#af9112e8a87e6cb1c785df0e0be59c99b">GetDestinationAcctID</a>();    
                bSuccess = <span class="keyword">true</span>;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a829e1dc63a933dae6fd3761091a9a2b1"></a><!-- doxytag: member="OTTransaction::GetRecipientUserIDForDisplay" ref="a829e1dc63a933dae6fd3761091a9a2b1" args="(OTIdentifier &amp;theReturnID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a829e1dc63a933dae6fd3761091a9a2b1">OTTransaction::GetRecipientUserIDForDisplay</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theReturnID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06582">6582</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strReference;
    <a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
    
    <span class="keywordflow">switch</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   
<span class="comment">//      case OTTransaction::marketReceipt: </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>: <span class="comment">// Used for paymentPlans AND for smart contracts...</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem;
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            
            <span class="keywordflow">if</span> (NULL != pItem)
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strUpdatedCronItem);
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failed trying to get paymentReceipt item from paymentReceipt transaction.\n&quot;</span>,
                              __FUNCTION__);

            pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strUpdatedCronItem);
            theCronItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pCronItem);
            
            <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmart = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pCronItem);
            <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> * pPlan = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> *<span class="keyword">&gt;</span>(pCronItem);
            
            <span class="keywordflow">if</span> (NULL != pSmart) <span class="comment">// if it&#39;s a smart contract...</span>
            {
                <span class="keywordflow">if</span> (!pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#a5e4cc7155d92196c3031a725fd199230">GetLastRecipientUserID</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                
                theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#a5e4cc7155d92196c3031a725fd199230">GetLastRecipientUserID</a>());
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pPlan) <span class="comment">// else if it is any other kind of cron item...</span>
            {
                theReturnID = pPlan-&gt;<a class="code" href="class_o_t_agreement.html#a87e9b6e7028af7ddfebaee86925e8e7b">GetRecipientUserID</a>();
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to load Cron Item. Should never happen. Receipt: %lld  Origin: %lld\n&quot;</span>,
                              __FUNCTION__, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
            <span class="keywordflow">break</span>; <span class="comment">// this break never actually happens. Above always returns, if triggered.</span>
            <span class="comment">// --------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
        {
            <span class="comment">/*</span>
<span class="comment">             Therefore, if I am looping through my Nymbox, iterating through transactions, and one of them</span>
<span class="comment">             is an *** instrumentNotice *** then I should expect this-&gt;GetReferenceString(strOutput) to:</span>
<span class="comment">             </span>
<span class="comment">             1. load up from string as an OTMessage of type &quot;sendUserInstrument&quot;,</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             2. and I should expect the PAYLOAD of that message to contain an encrypted OTEnvelope,</span>
<span class="comment">             3. which can be decrypted by Msg.m_strNymID2&#39;s private key,</span>
<span class="comment">             4. And the resulting plaintext can be loaded into memory as an OTPayment object,</span>
<span class="comment">             5. ...which contains an instrument of ambiguous type.</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             FYI:</span>
<span class="comment">             OTPayment provides a consistent interface, and consolidation of handling, for </span>
<span class="comment">             the several financial instruments that appear on the PAYMENTS page, in the PaymentsInbox.</span>
<span class="comment">             For example: </span>
<span class="comment">                [ Cheques, Invoices, Vouchers ], </span>
<span class="comment">                Payment Plans, Smart Contracts, ...and Purses.</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             (In this block we don&#39;t need to go any farther than step 1 above.)</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             */</span>
<span class="comment">//          OTString strReference;              // (Already done above.)</span>
<span class="comment">//          GetReferenceString(strReference);   // (Already done above.)</span>
            
            <a class="code" href="class_o_t_message.html">OTMessage</a> theSentMsg;
            
            <span class="keywordflow">if</span> (strReference.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theSentMsg.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strReference))
            {
                <span class="comment">// All we need is this message itself. We aren&#39;t going to decrypt</span>
                <span class="comment">// the payload, we&#39;re just going to grab the sender/receiver data</span>
                <span class="comment">// from the msg.</span>
                <span class="comment">//</span>
                <span class="comment">// We can&#39;t decrypt the payload (the OTPayment object) but we still have sender / recipient.</span>
                <span class="comment">// todo security need to consider security implications of that and maybe improve it a bit.</span>
                <span class="comment">// (But I do NOT want to get into the messaging business.)</span>
                <span class="comment">//</span>
<span class="comment">//              theSentMsg.m_strCommand     = &quot;sendUserInstrument&quot;;</span>
<span class="comment">//              theSentMsg.m_strNymID       = strNymID;     //   ===&gt; sender &lt;===</span>
<span class="comment">//              theSentMsg.m_strNymID2      = strNymID2;    // ===&gt; recipient &lt;===</span>
                
                <span class="keywordflow">if</span> (theSentMsg.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                {
                    theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theSentMsg.<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>);
                    <span class="keywordflow">return</span> <span class="keyword">true</span>;
                }                
            }            
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        } <span class="comment">// case OTTransaction::instrumentNotice:</span>
            <span class="keywordflow">break</span>;
        <span class="comment">// --------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return false.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;

    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to transferReceipt\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">else</span> 
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>();  <span class="comment">// Even though a transfer has no recipient user (just a recipient acct) I still get the User ID when he accepts it!</span>
                bSuccess = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:  <span class="comment">// amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on voucher (attached to depositCheque item, attached.)</span>
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strAttachment);
            <span class="keywordtype">bool</span> bLoadContractFromString = theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strAttachment);
            
            <span class="keywordflow">if</span> (!bLoadContractFromString)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strCheque(theCheque);
                
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR loading cheque or voucher from string in OTTransaction::%s:\n%s\n&quot;</span>,
                              __FUNCTION__, strCheque.Get());
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theCheque.<a class="code" href="class_o_t_cheque.html#abcc7ebe7be1754456681a25a012040ee">HasRecipient</a>())
            {
                theReturnID = theCheque.<a class="code" href="class_o_t_cheque.html#a2628b445784aa1f6cdea370acca92077">GetRecipientUserID</a>();
                bSuccess    = <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>();  <span class="comment">// Even though the cheque has no recipient, I still get the User ID when he deposits it!</span>
                bSuccess    = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no recipient user ID -- return false.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a4463450cc735aea9b924011f073bb3"></a><!-- doxytag: member="OTTransaction::GetReferenceNumForDisplay" ref="a7a4463450cc735aea9b924011f073bb3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">OTTransaction::GetReferenceNumForDisplay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>for display purposes. The "reference #" we show the user is not the same one we used internally.</p>
<p>The "display reference #" that we want to display for the User might be different depending on the type.</p>
<p>For example, if pending, then it's in ref to the original transfer request (sender's transaction #) But if chequeReceipt, then it's in reference to the original cheque (also sender's transaction #) But if marketReceipt, then it's in reference to the original market offer (which is my own trans#) But if paymentReceipt, then it's in reference to the original "activate payment plan" request, which may or may not be mine.</p>
<p>Internally of course, a chequeReceipt is "in reference to" the depositor's deposit request. But the user doesn't care about that number -- he wants to see the original cheque # from when he first wrote it. Thus we have this function for resolving the "display reference #" in cases like that.</p>
<p>Another example: with market trades, you want the "in reference to" to show the trans# of the original market offer request. Of course, if you load up the item within, you can get the "in reference to" showing a different trans# for EACH TRADE THAT HAS OCCURRED. We use that internally, we need to be able to reference each of those trades. But the user merely wants to see that his receipt is in reference to the original market offer, so he can line up his receipts with his offers. What else does he care? </p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06224">6224</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
   <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
      <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a5d52aa9eeff78830b9ba53585e36a2ad">GetAbbrevInRefDisplay</a>();
   <span class="comment">// ----------------------------</span>
   int64_t lReferenceNum = 0;
   
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel;
        
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {
            <span class="comment">// &quot;in ref to #&quot; is stored on me: GetReferenceToNum()</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: 
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>:
            lReferenceNum = <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>();
            <span class="keywordflow">break</span>;
            
            <span class="comment">// A transferReceipt ACTUALLY references the acceptPending (recipient&#39;s trans#) that accepted it.</span>
            <span class="comment">// But I don&#39;t care about the recipient&#39;s transaction #s! This function is for DISPLAY. I am the sender,</span>
            <span class="comment">// and I want to see a reference to my original transfer that I sent.  This receipt, as far as I care, </span>
            <span class="comment">// is for THAT TRANSFER.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
            lReferenceNum = this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>();
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> 0;
    }
    <span class="comment">// -------------------------------------------------    </span>
    <span class="keywordflow">return</span> lReferenceNum;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa2d20865cc45e7b94df2cc4b84cb5911"></a><!-- doxytag: member="OTTransaction::GetReplyTransSuccess" ref="aa2d20865cc45e7b94df2cc4b84cb5911" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#aa2d20865cc45e7b94df2cc4b84cb5911">OTTransaction::GetReplyTransSuccess</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00603">603</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="aa90624fb50b1b0edb72c6d4bd7b01a4c"></a><!-- doxytag: member="OTTransaction::GetRequestNum" ref="aa90624fb50b1b0edb72c6d4bd7b01a4c" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int64_t&amp; <a class="el" href="class_o_t_transaction.html#aa90624fb50b1b0edb72c6d4bd7b01a4c">OTTransaction::GetRequestNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00600">600</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="acf66d9f8f5d3a6e4ee0a418a41db6019"></a><!-- doxytag: member="OTTransaction::GetSenderAcctIDForDisplay" ref="acf66d9f8f5d3a6e4ee0a418a41db6019" args="(OTIdentifier &amp;theReturnID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#acf66d9f8f5d3a6e4ee0a418a41db6019">OTTransaction::GetSenderAcctIDForDisplay</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theReturnID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06771">6771</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
        
    <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theItemAngel;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strReference;
    <a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
    
    <span class="keywordflow">if</span> (strReference.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &lt; 2)
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
    {
<span class="comment">//      case OTTransaction::marketReceipt:</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem;
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            
            <span class="keywordflow">if</span> (NULL != pItem)
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strUpdatedCronItem);
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failed trying to get paymentReceipt item from paymentReceipt transaction.\n&quot;</span>,
                              __FUNCTION__);

            pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strUpdatedCronItem);
            theCronItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pCronItem);
            
            <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmart = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pCronItem);
            
            <span class="keywordflow">if</span> (NULL != pSmart) <span class="comment">// if it&#39;s a smart contract...</span>
            {
                <span class="keywordflow">if</span> (!pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#af1cf6cb6b4d53612f587f5cf5fa70c2d">GetLastSenderAcctID</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                
                theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#af1cf6cb6b4d53612f587f5cf5fa70c2d">GetLastSenderAcctID</a>());
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pCronItem) <span class="comment">// else if it is any other kind of cron item...</span>
            {
                theReturnID = pCronItem-&gt;<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>();
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to load Cron Item. Should never happen. Receipt: %lld  Origin: %lld\n&quot;</span>,
                              __FUNCTION__, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on the transfer item, on my list of items.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>: <span class="comment">// amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on voucher (attached to depositCheque item, attached.)</span>
        {
            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no sender acct ID -- return false.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
        
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: couldn&#39;t load original item, should never happen. \n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    }
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
        
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   <span class="comment">// These are the types that have an amount (somehow)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:  <span class="comment">// amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on voucher (attached to depositCheque item, attached.)</span>
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strAttachment);
            <span class="keywordtype">bool</span> bLoadContractFromString = theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strAttachment);
            
            <span class="keywordflow">if</span> (!bLoadContractFromString)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strCheque(theCheque);
                
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR loading cheque from string in OTTransaction::%s:\n%s\n&quot;</span>,
                              __FUNCTION__, strCheque.Get());
            }
            <span class="keywordflow">else</span> 
            {
                <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
                    theReturnID = theCheque.<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>();
                <span class="keywordflow">else</span>
                    theReturnID = theCheque.<a class="code" href="class_o_t_cheque.html#a749bbaa8f7d864a16b95eaf9a8d5b684">GetRemitterAcctID</a>();

                bSuccess = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on transfer item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to pending transfer\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>();   
                bSuccess = <span class="keyword">true</span>;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">default</span>: <span class="comment">// All other types have no amount -- return 0.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1091822e3072f014a8b2f64b93917ca7"></a><!-- doxytag: member="OTTransaction::GetSenderUserIDForDisplay" ref="a1091822e3072f014a8b2f64b93917ca7" args="(OTIdentifier &amp;theReturnID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a1091822e3072f014a8b2f64b93917ca7">OTTransaction::GetSenderUserIDForDisplay</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theReturnID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>For display purposes. The "ref #" you actually display (versus the one you use internally) might change based on transaction type. (Like with a cheque receipt you actually have to load up the original cheque.) </p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l06394">6394</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a>        theItemAngel;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = NULL; <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a>    theCronItemAngel;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strReference;
    <a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);

    <span class="keywordflow">if</span> (strReference.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &lt; 2)
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
        
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {
<span class="comment">//      case OTTransaction::marketReceipt: </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>: <span class="comment">// for paymentPlans AND smartcontracts. (If the smart contract does a payment, it leaves a paymentReceipt...)</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem;
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            
            <span class="keywordflow">if</span> (NULL != pItem)
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strUpdatedCronItem);
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failed trying to get paymentReceipt item from paymentReceipt transaction.\n&quot;</span>,
                              __FUNCTION__);
                        
            pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strUpdatedCronItem);
            theCronItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pCronItem);

            <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> * pSmart = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> *<span class="keyword">&gt;</span>(pCronItem);
            
            <span class="keywordflow">if</span> (NULL != pSmart) <span class="comment">// if it&#39;s a smart contract...</span>
            {
                <span class="keywordflow">if</span> (!pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#aeb06c37756e2188d2f05eb3a2102a14a">GetLastSenderUserID</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                
                theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(pSmart-&gt;<a class="code" href="class_o_t_smart_contract.html#aeb06c37756e2188d2f05eb3a2102a14a">GetLastSenderUserID</a>());
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL != pCronItem) <span class="comment">// else if it is any other kind of cron item...</span>
            {
                theReturnID = pCronItem-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>();
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unable to load Cron Item. Should never happen. Receipt: %lld  Origin: %lld\n&quot;</span>,
                              __FUNCTION__, this-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="keywordflow">break</span>;
        }
        <span class="comment">// --------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
        {
            <span class="comment">/*</span>
<span class="comment">             Therefore, if I am looping through my Nymbox, iterating through transactions, and one of them</span>
<span class="comment">             is an *** instrumentNotice *** then I should expect this-&gt;GetReferenceString(strOutput) to:</span>
<span class="comment">             </span>
<span class="comment">             1. load up from string as an OTMessage of type &quot;sendUserInstrument&quot;,</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             2. and I should expect the PAYLOAD of that message to contain an encrypted OTEnvelope,</span>
<span class="comment">             3. which can be decrypted by Msg.m_strNymID2&#39;s private key,</span>
<span class="comment">             4. And the resulting plaintext can be loaded into memory as an OTPayment object,</span>
<span class="comment">             5. ...which contains an instrument of ambiguous type.</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             FYI:</span>
<span class="comment">             OTPayment provides a consistent interface, and consolidation of handling, for </span>
<span class="comment">             the several financial instruments that appear on the PAYMENTS page, in the PaymentsInbox.</span>
<span class="comment">             For example: </span>
<span class="comment">             [ Cheques, Invoices, Vouchers ], </span>
<span class="comment">             Payment Plans, Smart Contracts, ...and Purses.</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             (In this block we don&#39;t need to go any farther than step 1 above.)</span>
<span class="comment">             -------------------------------------------------------------------</span>
<span class="comment">             */</span>
<span class="comment">//          OTString strReference;              // (Already done above.)</span>
<span class="comment">//          GetReferenceString(strReference);   // (Already done above.)</span>
            
            <a class="code" href="class_o_t_message.html">OTMessage</a> theSentMsg;
            
            <span class="keywordflow">if</span> (strReference.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theSentMsg.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strReference))
            {
                <span class="comment">// All we need is this message itself. We aren&#39;t going to decrypt</span>
                <span class="comment">// the payload, we&#39;re just going to grab the sender/receiver data</span>
                <span class="comment">// from the msg.</span>
                <span class="comment">//</span>
                <span class="comment">// We can&#39;t decrypt the payload (the OTPayment object) but we still have sender / recipient.</span>
                <span class="comment">// todo security need to consider security implications of that and maybe improve it a bit.</span>
                <span class="comment">// (But I do NOT want to get into the messaging business.)</span>
                <span class="comment">//</span>
<span class="comment">//              theSentMsg.m_strCommand     = &quot;sendUserInstrument&quot;;</span>
<span class="comment">//              theSentMsg.m_strNymID       = strNymID;     //   ===&gt; sender &lt;===</span>
<span class="comment">//              theSentMsg.m_strNymID2      = strNymID2;    // ===&gt; recipient &lt;===</span>

                <span class="keywordflow">if</span> (theSentMsg.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                {
                    theReturnID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(theSentMsg.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>);
                    <span class="keywordflow">return</span> <span class="keyword">true</span>;
                }                
            }            
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }   
        <span class="comment">// --------------------------------------------------</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
        {
            pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
            <span class="keywordflow">if</span> (NULL != pOriginalItem)
                theItemAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pOriginalItem);
            
            <span class="keywordflow">break</span>;
        }   
        <span class="comment">// --------------------------------------------------</span>
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant here.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------   </span>
    <span class="keywordflow">if</span> (NULL == pOriginalItem)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::GetSenderUserIDForDisplay: original item not found. Should never happen.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Should never happen, since we always expect one based on the transaction type.</span>
    }
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAttachment;
        
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) 
    {   <span class="comment">// These are the types that have an amount (somehow)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:  <span class="comment">// amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// amount is stored on voucher (attached to depositCheque item, attached.)</span>
        {
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type attached to %s (expected depositCheque)\n&quot;</span>, __FUNCTION__,
                              (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) ? <span class="stringliteral">&quot;chequeReceipt&quot;</span> : <span class="stringliteral">&quot;voucherReceipt&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
            pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strAttachment);
            <span class="keywordtype">bool</span> bLoadContractFromString = theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strAttachment);
            
            <span class="keywordflow">if</span> (!bLoadContractFromString)
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strCheque(theCheque);
                
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR loading cheque or voucher from string in OTTransaction::%s:\n%s\n&quot;</span>,
                              __FUNCTION__, strCheque.Get());
            }
            <span class="keywordflow">else</span> 
            {
                <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
                    theReturnID = theCheque.<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>();
                <span class="keywordflow">else</span>
                    theReturnID = theCheque.<a class="code" href="class_o_t_cheque.html#ac58c338fc0a151ed12eaa9e86a9c1329">GetRemitterUserID</a>();
                
                bSuccess = <span class="keyword">true</span>;
            }
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// amount is stored on transfer item</span>
            
            <span class="keywordflow">if</span> (pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong item type attached to pending transfer\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                theReturnID = pOriginalItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>();   
                bSuccess = <span class="keyword">true</span>;
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types have no sender user ID -- return false.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac5ffc9f0e274bbc617185a5335c061a3"></a><!-- doxytag: member="OTTransaction::GetSuccess" ref="ac5ffc9f0e274bbc617185a5335c061a3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ac5ffc9f0e274bbc617185a5335c061a3">OTTransaction::GetSuccess</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03808">3808</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bFoundAnActionItem = <span class="keyword">false</span>, bFoundABalanceAgreement = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e">OTTransaction::atProcessInbox</a>  == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()) || 
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7">OTTransaction::atProcessNymbox</a> == <a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()))
    {        
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
            
            <span class="keywordflow">switch</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
            {

                    
                    <span class="comment">// BALANCE AGREEMENT  /  TRANSACTION STATEMENT</span>
                    
                    <span class="comment">// Even if one of these is a success, it is only the balance agreement for</span>
                    <span class="comment">// the transaction itself, which must also be a success. For example, if there</span>
                    <span class="comment">// is a transaction for a cash withdrawal, then it will contain 2 items: one item</span>
                    <span class="comment">// is the withdrawal itself, and the other item is the balance agreement for that</span>
                    <span class="comment">// withdrawal. Therefore, even if the balanace agreement item is successful, the</span>
                    <span class="comment">// withdrawal item itself must ALSO be successful, for the transaction AS A WHOLE</span>
                    <span class="comment">// to be &quot;successful.&quot;</span>
                    <span class="comment">// However, if this balance agreement failed, then the rest of the transaction has</span>
                    <span class="comment">// definitely failed as well.</span>
                    <span class="comment">// Therefore, here we either return false, or CONTINUE and let the decision be made</span>
                    <span class="comment">// from the other items in this transaction otherwise.</span>
                    <span class="comment">//</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>:     <span class="comment">// processInbox and notarizeTransactions. server&#39;s reply to a balance statement. One of these items appears inside any transaction reply.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>: <span class="comment">// processNymbox and also for starting/stopping any cron items. (notarizeTransactions: payment plan, market offer, smart contract, trigger clause, cancel cron item, etc.) The server&#39;s reply to a transaction statement. Like a balance statement, except no asset acct is involved.</span>
                    <span class="comment">//</span>
                <span class="comment">// ------------------------------------------------------------------------</span>
                                        
                    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                    {
                        bFoundABalanceAgreement = <span class="keyword">true</span>;
                    }
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                    {
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                    <span class="comment">// else continue...</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">continue</span>;
                    
                <span class="comment">// **************************************************************************</span>
                    
                    <span class="comment">// PROCESS NYMBOX</span>
                    
                    <span class="comment">// These are only a success if ALL of them (all of the items </span>
                    <span class="comment">// in this processNymbox transaction) are a success.</span>
                    
                    <span class="comment">// NOTE: these cases only matter if *this is an atProcessNymbox, and in THAT case, it requires ALL items</span>
                    <span class="comment">// to verify, not just the first one of a specific type.</span>
                    <span class="comment">//</span>
                    <span class="comment">// </span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a00f43bf21e890c4dd11059fc834f1ef1">OTItem::atAcceptTransaction</a>:   <span class="comment">// processNymbox. server&#39;s reply to the Nym&#39;s attempt to accept (sign for) transaction</span>
                    <span class="comment">// numbers that are sitting in his nymbox (since he requested more numbers....)</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a91caeadd2fc8999a11a392fb25b0b5c3">OTItem::atAcceptMessage</a>:       <span class="comment">// processNymbox. server&#39;s reply to nym&#39;s accepting a message (from another nym) that&#39;s in his nymbox.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3a3aa40758df2bff71b66962c0206a73">OTItem::atAcceptNotice</a>:        <span class="comment">// processNymbox. server&#39;s reply to nym&#39;s accepting a notice from the server, such as a successNotice (success signing out new transaction numbers) or a replyNotice, or an instrumentNotice.</span>
                    <span class="comment">// For example, some server replies are dropped into your Nymbox, to make sure you receive them. Then you accept them, to remove from your Nymbox.</span>
                <span class="comment">// ------------------------------------------------------------------------                </span>
                    
                    <span class="comment">// PROCESS NYMBOX *and* PROCESS INBOX</span>
                    
                    <span class="comment">// These are only a success if ALL of them (all of the items </span>
                    <span class="comment">// in this processInbox or processNymbox transaction) are a success.</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5034beca2e90df6b2b36022d365f1d38">OTItem::atAcceptFinalReceipt</a>:  <span class="comment">// Part of a processInbox or processNymbox transaction reply from the server.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9b353f70c54facca58998d250badcf27">OTItem::atDisputeFinalReceipt</a>:  <span class="comment">// Would be in processNymbox AND processInbox. Can these be disputed? Think through the process. Todo.</span>
                    
                <span class="comment">// ------------------------------------------------------------------------</span>
                    
                    <span class="comment">// PROCESS INBOX</span>
                    
                    <span class="comment">// These are only a success if ALL of them (all of the items </span>
                    <span class="comment">// in this processInbox transaction) are a success.</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5b0f7bfa18e29ce7d6ebcc861e541f4f">OTItem::atAcceptPending</a>:        <span class="comment">// processInbox. server&#39;s reply to nym&#39;s request to accept an incoming pending transfer that&#39;s sitting in his asset acct&#39;s inbox.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a84f21da0049c428f2e74c573dfaff067">OTItem::atRejectPending</a>:        <span class="comment">// processInbox. Same thing, except rejecting that pending transfer instead of accepting it.</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a3c0d4b5c591948114dbd2550cccb3b48">OTItem::atAcceptCronReceipt</a>:    <span class="comment">// processInbox. Accepting a payment receipt or market receipt. (Smart contracts also drop payment receipts, currently.)</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a15fb11d5243db9056a4c340bc49cea43">OTItem::atDisputeCronReceipt</a>:   <span class="comment">// processInbox. Dispute. (Todo.)</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a919386d460c64f76c562aa216523aa9f">OTItem::atAcceptItemReceipt</a>:    <span class="comment">// processInbox. Accepting a transferReceipt, or chequeReceipt, etc.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acd9426f6754691aebb202e9c14cdc681">OTItem::atDisputeItemReceipt</a>:   <span class="comment">// processInbox. Dispute. (Todo.)              </span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a5901a9fad67b6756c6c6abcb131adc22">OTItem::atAcceptBasketReceipt</a>:  <span class="comment">// processInbox. Basket Receipt, from a basket currency exchange (in or out.)</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9fc8674f161335439c48b2e9db277b9b">OTItem::atDisputeBasketReceipt</a>: <span class="comment">// processInbox. dispute basket receipt.</span>
                    
                <span class="comment">// ------------------------------------------------------------------------</span>
                    
                    <span class="comment">// If we found at least one of these, and nothing fails by the end of the loop,</span>
                    <span class="comment">// then for processNymbox and processInbox, it&#39;s a success. (If balance agreement also...)</span>
                    
                    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                    {
                        bFoundAnActionItem = <span class="keyword">true</span>;
                    }
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                    {
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                    <span class="comment">// else continue...</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">continue</span>;
                                        
                <span class="comment">// **************************************************************************</span>
                    
                <span class="keywordflow">default</span>:
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong transaction type passed to OTTransaction::GetSuccess() &quot;</span>
                                 <span class="stringliteral">&quot;for processNymbox or processInbox transaction.\n&quot;</span>);
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }<span class="comment">// switch</span>
        } <span class="comment">// FOR_EACH</span>
        
        <span class="keywordflow">return</span> (bFoundABalanceAgreement &amp;&amp; bFoundAnActionItem);
        
    } <span class="comment">// if processNymbox or processInbox.</span>
    
    
    
    <span class="comment">// ----------------------------------------------------------------------------</span>
    
    <span class="comment">// Okay, it&#39;s not a processNymbox or processInbox.</span>
    <span class="comment">//</span>
    <span class="comment">// Maybe it&#39;s one of these other transaction types...</span>
    
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
    {
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
        
        <span class="keywordflow">switch</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
        {                   
<span class="comment">//          case OTItem::atServerfee:            // Fees currently aren&#39;t coded. Todo.</span>
<span class="comment">//          case OTItem::atIssuerfee:            // Same as above. Todo.</span>
                
            <span class="comment">// **************************************************************************</span>
                
            <span class="comment">// BALANCE AGREEMENT  /  TRANSACTION STATEMENT</span>
                
                <span class="comment">// Even if one of these is a success, it is only the balance agreement for</span>
                <span class="comment">// the transaction itself, which must also be a success. For example, if there</span>
                <span class="comment">// is a transaction for a cash withdrawal, then it will contain 2 items: one item</span>
                <span class="comment">// is the withdrawal itself, and the other item is the balance agreement for that</span>
                <span class="comment">// withdrawal. Therefore, even if the balanace agreement item is successful, the</span>
                <span class="comment">// withdrawal item itself must ALSO be successful, for the transaction AS A WHOLE</span>
                <span class="comment">// to be &quot;successful.&quot;</span>
                <span class="comment">// However, if this balance agreement failed, then the rest of the transaction has</span>
                <span class="comment">// definitely failed as well.</span>
                <span class="comment">// Therefore, here we either return false, or CONTINUE and let the decision be made</span>
                <span class="comment">// from the other items in this transaction otherwise.</span>
                <span class="comment">//</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>:     <span class="comment">// processInbox and notarizeTransactions. server&#39;s reply to a balance statement. One of these items appears inside any transaction reply.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>: <span class="comment">// processNymbox and also for starting/stopping any cron items. (notarizeTransactions: payment plan, market offer, smart contract, trigger clause, cancel cron item, etc.) The server&#39;s reply to a transaction statement. Like a balance statement, except no asset acct is involved.</span>
                <span class="comment">//</span>
                                
                <span class="comment">// ------------------------------------------------------------------------</span>
                <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                {
                    bFoundABalanceAgreement = <span class="keyword">true</span>;
                }
                <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                {
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
                <span class="comment">// else continue...</span>
                <span class="comment">//</span>
                <span class="keywordflow">continue</span>;
                
            <span class="comment">// **************************************************************************</span>
                <span class="comment">/*</span>
<span class="comment">                 atProcessNymbox,   // process nymbox reply          // comes from server</span>
<span class="comment">                 atProcessInbox,    // process inbox reply           // comes from server</span>
<span class="comment">                 </span>
<span class="comment">                 // Note: the above two transaction types are handled in the switch block above this one.</span>
<span class="comment">                 // Whereas the below transaction types are handled right here in this switch block.</span>
<span class="comment">                 </span>
<span class="comment">                 atTransfer,        // reply from the server regarding a transfer request</span>
<span class="comment">                 atDeposit,         // reply from the server regarding a deposit request</span>
<span class="comment">                 atWithdrawal,      // reply from the server regarding a withdrawal request</span>
<span class="comment">                 atMarketOffer,     // reply from the server regarding a market offer</span>
<span class="comment">                 atPaymentPlan,     // reply from the server regarding a payment plan</span>
<span class="comment">                 atSmartContract,   // reply from the server regarding a smart contract</span>
<span class="comment">                 atCancelCronItem,  // reply from the server regarding said cancellation.</span>
<span class="comment">                 atExchangeBasket,  // reply from the server regarding said exchange.</span>
<span class="comment">                 */</span>

            <span class="comment">// NOTARIZE TRANSACTION</span>
                <span class="comment">// If any of these are a success, then the transaction as a whole is a success also.</span>
                
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac310111eca8eb295fb5dafddd884fc82">OTItem::atTransfer</a>:             <span class="comment">// notarizeTransactions. server&#39;s reply to nym&#39;s request to initiate a transfer</span>

            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a16a994b2323c05a6cd00ccbf57102be8">OTItem::atWithdrawal</a>:           <span class="comment">// notarizeTransaction. server&#39;s reply to withdrawal (cash) request.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a814d6a51c7059307c8fe8d073fb9de9e">OTItem::atDeposit</a>:              <span class="comment">// notarizeTransaction. server&#39;s reply to deposit (cash) request.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a36d4c6faf8ad5aae6ea36fe5a66012c8">OTItem::atWithdrawVoucher</a>:      <span class="comment">// notarizeTransaction. server&#39;s reply to &quot;withdraw voucher&quot; request.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae12946cd205221592c0fa44e4c7399b2">OTItem::atDepositCheque</a>:        <span class="comment">// notarizeTransaction. server&#39;s reply to &quot;deposit cheque&quot; request.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae8f15961c19cf2d7645061df47e59650">OTItem::atPayDividend</a>:          <span class="comment">// notarizeTransaction. server&#39;s reply to &quot;pay dividend&quot; request.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a229f0c7ace7a51840d7632910a0b92a6">OTItem::atMarketOffer</a>:          <span class="comment">// notarizeTransaction. server&#39;s reply to request to place a market offer.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afbc3c7556a790e7a7b6be464f8ea058b">OTItem::atPaymentPlan</a>:          <span class="comment">// notarizeTransaction. server&#39;s reply to request to activate a payment plan.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1fe91e4cadee24de6acb9de56a55e4eb">OTItem::atSmartContract</a>:        <span class="comment">// notarizeTransaction. server&#39;s reply to request to activate a smart contract.</span>
                
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ab3ded9d37de3a75d4b39735bb9aff341">OTItem::atCancelCronItem</a>:       <span class="comment">// notarizeTransaction. server&#39;s reply to request to cancel a [ market offer | payment plan | smart contract ]</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0b62f8efea6ed9bdefbc48ce2e97a8b6">OTItem::atExchangeBasket</a>:       <span class="comment">// notarizeTransaction. server&#39;s reply to request to exchange in or out of a basket currency.</span>

            <span class="comment">// ------------------------------------------------------------------------</span>
                
            <span class="comment">// RECEIPTS</span>
                
                <span class="comment">// 1. ACTUAL RECEIPTS (item attached to similar transaction), and also </span>
                <span class="comment">// 2. INBOX REPORT ITEMS (sub-item to ANOTHER item, which is used on Balance Agreements and Transaction Statements.)</span>
                <span class="comment">//</span>
                <span class="comment">// In case of (1), GetSuccess() is relevant. </span>
                <span class="comment">// But in case of (2) GetSuccess() is NOT relevant. FYI.</span>
                <span class="comment">//</span>
                <span class="comment">// Anyway, if a marketReceipt item is attached to a marketReceipt transaction, then we</span>
                <span class="comment">// can return success or failure right away, since such status is set on the item, not</span>
                <span class="comment">// the transaction, and since there are no other items that matter if this IS a success.</span>
                
<span class="comment">//          case OTItem::chequeReceipt:   // not needed in OTItem. Meaning, actual OTTransaction cheque receipts do NOT need a chequeReceipt Item attached....</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>:   <span class="comment">// ...but it&#39;s here anyway as a type, for dual use reasons (balance agreement sub-items. Like for an inbox report.)</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>:   <span class="comment">// Used for actual market receipts, as well as for balance agreement sub-items.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:  <span class="comment">// Used for actual payment receipts, as well as for balance agreement sub-items.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>: <span class="comment">// Used for actual transfer receipts, as well as for balance agreement sub-items. (Hmm does balance agreement need this?)</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>:    <span class="comment">// Used for actual final receipt (I think) as well as for balance agreement sub item (I think.)</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>:   <span class="comment">// Used for basket receipt (I think) as well as for balance agreement sub-item (I think.)</span>
                
            <span class="comment">// **************************************************************************</span>
                
                <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                {
                    bFoundAnActionItem = <span class="keyword">true</span>;
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a> == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
                {
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
                
                <span class="keywordflow">break</span>;
                
            <span class="comment">// **************************************************************************</span>
                
            <span class="keywordflow">default</span>:
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong transaction type passed to OTTransaction::GetSuccess()\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    
    <span class="keywordflow">return</span> (bFoundABalanceAgreement &amp;&amp; bFoundAnActionItem);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac964dfd1e704c02358a6641f030ead38"></a><!-- doxytag: member="OTTransaction::GetType" ref="ac964dfd1e704c02358a6641f030ead38" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> <a class="el" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">OTTransaction::GetType</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00669">669</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a806b1bd373a5777b5a41d5141e9e914d"></a><!-- doxytag: member="OTTransaction::GetTypeFromString" ref="a806b1bd373a5777b5a41d5141e9e914d" args="(const OTString &amp;strType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> <a class="el" href="class_o_t_transaction.html#a806b1bd373a5777b5a41d5141e9e914d">OTTransaction::GetTypeFromString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strType</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04068">4068</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>;
    
    <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;blank&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">OTTransaction::blank</a>;

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;message&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f">OTTransaction::message</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;notice&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;replyNotice&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;successNotice&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>;
    <span class="comment">// --------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;pending&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>;
    <span class="comment">// --------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transferReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;voucherReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;chequeReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;marketReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;finalReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;basketReceipt&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>;
    <span class="comment">// --------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;instrumentNotice&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;instrumentRejection&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>;
    <span class="comment">// --------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;processNymbox&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac0914e62639aebd987882e21bdff890d">OTTransaction::processNymbox</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atProcessNymbox&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afa0ed45f263e43a61f2315dc723b13f7">OTTransaction::atProcessNymbox</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;processInbox&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atProcessInbox&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab5e618f93b8a024db636a286a10c433e">OTTransaction::atProcessInbox</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transfer&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atTransfer&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad6f91d122a4d04bbcd5f5ff703b17585">OTTransaction::atTransfer</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;deposit&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atDeposit&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a759808a47e79ca6edde03d3dd03318f3">OTTransaction::atDeposit</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;withdrawal&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atWithdrawal&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949">OTTransaction::atWithdrawal</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;marketOffer&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atMarketOffer&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aefb8fac2c5b63cd7cc87e4e620be5a74">OTTransaction::atMarketOffer</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentPlan&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atPaymentPlan&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8afdc94f6f285b3e410ed6283cfc3184cc">OTTransaction::atPaymentPlan</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;smartContract&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atSmartContract&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97fbe1a7d3cbf4a1c2476fd0374b1363">OTTransaction::atSmartContract</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;cancelCronItem&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atCancelCronItem&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aeab27a75cf6eca60caae2cfc836af49d">OTTransaction::atCancelCronItem</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;exchangeBasket&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atExchangeBasket&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a32b11ab3a1c1c2bb2f72ea79df070e61">OTTransaction::atExchangeBasket</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;payDividend&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;atPayDividend&quot;</span>))
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8abd4fe0db87268c965e14719347c91594">OTTransaction::atPayDividend</a>;
    <span class="comment">// --------------------------------------------------------------   </span>
    <span class="keywordflow">else</span>
        theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>;
    <span class="comment">// --------------------------------------------------------------</span>
    
    <span class="keywordflow">return</span> theType;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5baeb1d30c71f3a37565cb2e91b05447"></a><!-- doxytag: member="OTTransaction::GetTypeString" ref="a5baeb1d30c71f3a37565cb2e91b05447" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">OTTransaction::GetTypeString</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00794">794</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#ab32a4098c75d0e48616e65caafa60fe0">OTTransaction::_GetTypeString</a>(<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>); }
</pre></div>
</div>
</div>
<a class="anchor" id="a024827b70ceaf1f9fbf10bd505de348a"></a><!-- doxytag: member="OTTransaction::HarvestClosingNumbers" ref="a024827b70ceaf1f9fbf10bd505de348a" args="(OTPseudonym &amp;theNym, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a024827b70ceaf1f9fbf10bd505de348a">OTTransaction::HarvestClosingNumbers</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bHarvestingForRetry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasFailure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasFailure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00780">780</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>)
    {   <span class="comment">// Note: the below remarks about &quot;success or fail&quot; are specific to TRANSACTION success, not message success.</span>
            
<span class="comment">//      case OTTransaction::processNymbox:  // Why is this even here? processNymbox uses NO trans#s--that&#39;s the purpose of processNymbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:   <span class="comment">// Has no closing numbers.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:        <span class="comment">// Has no closing numbers.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:     <span class="comment">// Has no closing numbers.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>: <span class="comment">// Has no closing numbers.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:    <span class="comment">// Has no closing numbers.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:       <span class="comment">// Has no closing numbers.</span>
            
            <span class="keywordflow">break</span>;
            
        <span class="comment">// --------------------------------------------------------------------------------------------------</span>
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:    <span class="comment">// Uses 3 transaction #s, the opening number and 2 closers.</span>
                                            <span class="comment">// If message fails, all closing numbers are harvestable.</span>
                                            <span class="comment">// If message succeeds but transaction fails, closers can also be harvested.</span>
                                            <span class="comment">// If message succeeds and transaction succeeds, closers are marked as &quot;used&quot; (like opener.)</span>
                                            <span class="comment">// In that last case, you can&#39;t claw them back since they are used.</span>
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae973afad2dc8a8349e8889304b20e73b">OTItem::marketOffer</a>);
            
            <span class="keywordflow">if</span> (NULL == pItem)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: Error: Unable to find &quot;</span>
                             <span class="stringliteral">&quot;marketOffer item in marketOffer transaction.\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// pItem is good. Let&#39;s load up the OTTrade object...</span>
            {
                <a class="code" href="class_o_t_trade.html">OTTrade</a>     theTrade;
                <a class="code" href="class_o_t_string.html">OTString</a>    strTrade;
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strTrade);
                
                <span class="comment">// First load the Trade up...</span>
                <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadContractFromString = (strTrade.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theTrade.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTrade));
                
                <span class="comment">// If failed to load the trade...</span>
                <span class="keywordflow">if</span> (!bLoadContractFromString)
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: ERROR: Failed loading trade from string:\n\n%s\n\n&quot;</span>,
                                  strTrade.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                }
                <span class="keywordflow">else</span> <span class="comment">// theTrade is ready to go....</span>
                {
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                    <span class="comment">// The message reply itself was a failure. This means the transaction itself never got a chance</span>
                    <span class="comment">// to run... which means ALL the closing numbers on that transaction are STILL GOOD.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bReplyWasFailure)<span class="comment">// &amp;&amp; !bHarvestingForRetry) // on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                    {                   <span class="comment">// NOTE: We do NOT exclude harvesting of closing numbers, for a marketoffer, based on bHarvestingForRetry. Why not?</span>
                                        <span class="comment">// Because with marketOffer, ALL transaction #s are re-set EACH re-try, not just the opening #. Therefore ALL must be clawed back.</span>
                        theTrade.<a class="code" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">HarvestClosingNumbers</a>(theNym); <span class="comment">// (Contrast this with payment plan, exchange basket, smart contract...)</span>
                        bSuccess = <span class="keyword">true</span>;
                        <span class="comment">// ------------------------------------</span>
<span class="comment">//                      theTrade.GetAssetAcctClosingNum();      // For reference.</span>
<span class="comment">//                      theTrade.GetCurrencyAcctClosingNum();   // (The above harvest call grabs THESE numbers.)</span>
                        <span class="comment">// ------------------------------------</span>
                    }
                    <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
                    <span class="comment">// Why? Because that means the transaction definitely ran--and the opener is marked as &quot;used&quot; on SUCCESS, or &quot;burned&quot; on</span>
                    <span class="comment">// FAILURE--either way, that&#39;s bad for harvesting (no point.)</span>
                    <span class="comment">//</span>
                    <span class="comment">// ===&gt; But the CLOSING numbers are harvestable on transaction *failure.*</span>
                    <span class="comment">// (They are not harvestable on transaction *success* though.)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                    {
                        <span class="keywordflow">if</span> (bTransactionWasSuccess)
                        {
                            <span class="comment">// (They are not harvestable on transaction success though.)</span>
                            <span class="comment">// This means the &quot;marketOffer&quot; closing trans#s (one for asset account, and one for currency account) are both</span>
                            <span class="comment">// MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                            <span class="comment">// EITHER WAY, you certainly can&#39;t claw those numbers back now! (They are still outstanding, though. They&#39;re not gone, yet...)</span>
                            <span class="comment">//</span>
<span class="comment">//                          theTrade.HarvestClosingNumbers(theNym);</span>
<span class="comment">//                          bSuccess = true;</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure)
                        {
                            <span class="comment">// But the CLOSING numbers ARE harvestable on transaction failure.</span>
                            <span class="comment">// (Closing numbers for marketOffers are only marked &quot;used&quot; if the</span>
                            <span class="comment">// marketOffer transaction was a success.)</span>
                            <span class="comment">//</span>
                            theTrade.<a class="code" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">HarvestClosingNumbers</a>(theNym);
                            bSuccess = <span class="keyword">true</span>;                            
                        }
                    } <span class="comment">// else if (bReplyWasSuccess)</span>
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                } <span class="comment">// else (the trade loaded successfully)</span>
            } <span class="comment">// pItem was found.</span>
        }
            <span class="comment">// ------------------------------------------------------------------------------------------</span>
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>: <span class="comment">// Uses X transaction #s: the opener, which is burned success-or-fail, and Y closers</span>
                                            <span class="comment">// (one for each account.) Closers are marked &quot;used&quot; if success transaction,</span>
                                            <span class="comment">// but if message succeeds while transaction fails, then closers can be harvested.</span>
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a1332f32813f158436fd58abdddec855c">OTItem::exchangeBasket</a>);
            
            <span class="keywordflow">if</span> (NULL == pItem)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: Error: Unable to find &quot;</span>
                             <span class="stringliteral">&quot;exchangeBasket item in exchangeBasket transaction.\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// pItem is good. Let&#39;s load up the OTBasket object...</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strBasket;
                <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strBasket);
                
                <span class="comment">// First load the Basket up...</span>
                <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadContractFromString = (strBasket.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strBasket));
                
                <span class="comment">// If failed to load the request basket...</span>
                <span class="keywordflow">if</span> (!bLoadContractFromString)
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: ERROR: Failed loading basket request from string:\n\n%s\n\n&quot;</span>,
                                  strBasket.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                }
                <span class="keywordflow">else</span> <span class="comment">// theBasket is ready to go....</span>
                {
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                    <span class="comment">// The message reply itself was a failure. This means the transaction itself never got a chance</span>
                    <span class="comment">// to run... which means ALL the closing numbers on that transaction are STILL GOOD.</span>
                    <span class="comment">//</span>
                    
                    <span class="comment">// NOTE: if reply was failure, then I DO want to re-try my basket exchange, without having to call</span>
                    <span class="comment">// all the API functions to build the exchange object again (instead just re-use the existing one.)</span>
                    <span class="comment">//</span>
                    <span class="comment">// So... the closing numbers ARE all harvestable, in the event, for example, that I was out of re-tries</span>
                    <span class="comment">// and I just wanted to claw ALL the numbers back.</span>
                    <span class="comment">// But what if I just want the opening one at first, and leave the others for my retries?</span>
                    <span class="comment">//</span>
                    <span class="comment">// ===&gt; DONE:  SOunds like I need an API call like OT_API_Msg_HarvestTransactionNumbers</span>
                    <span class="comment">// except called OT_API_Msg_HarvestOpeningNumber. Then it just only calls the opening version.</span>
                    <span class="comment">//</span>
                    <span class="comment">// Better: (done) Add a boolean to existing functions: &quot;bHarvestingForRetry&quot;. The code can just be smart enough,</span>
                    <span class="comment">// based on that!</span>
                    
                    <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry)   
                    {
                        <span class="comment">// if we WERE harvesting for a re-try, then we would LEAVE the closing numbers, so that the re-try would </span>
                        <span class="comment">// work, since otherwise a new basket object would need to be setup in order to make the call, with new</span>
                        <span class="comment">// closing numbers.</span>
                        <span class="comment">//</span>
                        theBasket.<a class="code" href="class_o_t_basket.html#a4fa7db8a28ae3adb021cd343b69fe2ff">HarvestClosingNumbers</a>(theNym, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <span class="keyword">true</span>); <span class="comment">//bSave=true</span>
                        bSuccess = <span class="keyword">true</span>;
                        <span class="comment">// ------------------------------------</span>
                    }
                    <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
                    <span class="comment">// Why? Because that means the transaction definitely ran--and the opener for exchangeBasket is always burned, success-or-fail.</span>
                    <span class="comment">// The CLOSING numbers also are not harvestable on transaction success, since this marks them as &quot;USED.&quot; </span>
                    <span class="comment">// ===&gt; But the CLOSING numbers ARE harvestable on transaction *failure.*</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                    {
                        <span class="keywordflow">if</span> (bTransactionWasSuccess)
                        {
                            <span class="comment">// (They are not harvestable on transaction success though.)</span>
                            <span class="comment">// This means the &quot;exchangeBasket&quot; closing trans#s (one for each asset account involved in the exchange)</span>
                            <span class="comment">// are all MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                            <span class="comment">// EITHER WAY, you certainly can&#39;t claw those numbers back now! (They are still outstanding, though. They&#39;re not gone, yet...)</span>
                            <span class="comment">//</span>
<span class="comment">//                          theBasket.HarvestClosingNumbers(theNym, GetPurportedServerID(), true); //bSave=true</span>
<span class="comment">//                          bSuccess = true;</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure &amp;&amp; !bHarvestingForRetry) <span class="comment">// on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                        {
                            <span class="comment">// But the CLOSING numbers ARE harvestable on transaction FAILURE.</span>
                            <span class="comment">// (Closing numbers for exchangeBasket are only marked &quot;used&quot; if the</span>
                            <span class="comment">// exchangeBasket transaction was a success. But in this case since</span>
                            <span class="comment">// the transaction was NOT a success, ergo they were never marked as</span>
                            <span class="comment">// &quot;used,&quot; either. So let&#39;s harvest them...)</span>
                            <span class="comment">//</span>
                            theBasket.<a class="code" href="class_o_t_basket.html#a4fa7db8a28ae3adb021cd343b69fe2ff">HarvestClosingNumbers</a>(theNym, <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <span class="keyword">true</span>); <span class="comment">//bSave=true</span>
                            bSuccess = <span class="keyword">true</span>;                            
                        }
                    } <span class="comment">// else if (bReplyWasSuccess)</span>
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                } <span class="comment">// else (the basket loaded successfully)</span>
            } <span class="comment">// pItem was found.</span>
        }
            <span class="keywordflow">break</span>;
            <span class="comment">// --------------------------------------------------------------------------------------------------</span>

            <span class="comment">// These aren&#39;t AS simple.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:    <span class="comment">// Uses 4 transaction #s: the opener (sender&#39;s #), which is burned on transaction failure, but kept alive on success,</span>
                                            <span class="comment">// ===&gt; the sender&#39;s closing #, which is only marked as &quot;used&quot; upon success (harvestable up until that point.)</span>
                                            <span class="comment">// ===&gt; and the recipient&#39;s opening/closing numbers, which are also both only marked as &quot;used&quot; upon success, and are harvestable up until that point.</span>
            
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">OTItem::paymentPlan</a>);
            
            <span class="keywordflow">if</span> (NULL == pItem)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: Error: Unable to find &quot;</span>
                             <span class="stringliteral">&quot;paymentPlan item in paymentPlan transaction.\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// pItem is good. Let&#39;s load up the OTPaymentPlan object...</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a>        strPaymentPlan;
                <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   thePlan;
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strPaymentPlan);
                
                <span class="comment">// First load the payment plan up...</span>
                <span class="keyword">const</span> <span class="keywordtype">bool</span> bLoadContractFromString = (strPaymentPlan.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePlan.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPaymentPlan));

                <span class="comment">// If failed to load the payment plan from string...</span>
                <span class="keywordflow">if</span> (!bLoadContractFromString)
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: ERROR: Failed loading payment plan from string:\n\n%s\n\n&quot;</span>,
                                  strPaymentPlan.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                }
                <span class="keywordflow">else</span> <span class="comment">// thePlan is ready to go....</span>
                {
                    <span class="comment">// If the server reply message was unambiguously a FAIL, that means the closing numbers are STILL GOOD.</span>
                    <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry) <span class="comment">// on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                    {
                        thePlan.<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(theNym); 
                        bSuccess = <span class="keyword">true</span>;
                    }
                    <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY</span>
                    <span class="comment">// NOT HARVESTABLE. (For the sender, anyway.) Why not? Because that means the transaction definitely ran--and</span>
                    <span class="comment">// the opener is marked as &quot;used&quot; on success, and &quot;burned&quot; on failure--either way, that&#39;s bad for harvesting (no point.)</span>
                    <span class="comment">// The recipient, by contrast, actually retains harvestability on his opening number up until the very point of </span>
                    <span class="comment">// transaction success.</span>
                    <span class="comment">//</span>
                    <span class="comment">// ====&gt; I know you are wondering: </span>
                    <span class="comment">// ====&gt;    HOW ABOUT THE CLOSING NUMBERS?  (When message is success)</span>
                    <span class="comment">//  1. Transaction success: Sender and Recipient CANNOT harvest closing numbers, which are now marked as &quot;used.&quot;</span>
                    <span class="comment">//  2. Transaction failed:  Sender and Recipient **CAN** both harvest their closing numbers.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                    {
                        <span class="keywordflow">if</span> (bTransactionWasSuccess)
                        {
                            <span class="comment">// This means the &quot;paymentPlan&quot; closing trans#s are MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                            <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
<span class="comment">//                          thePlan.HarvestClosingNumbers(theNym); </span>
<span class="comment">//                          bSuccess = true;</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure &amp;&amp; !bHarvestingForRetry) <span class="comment">// on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                        {
                            <span class="comment">// Whereas if the payment plan was a failure, that means the closing numbers are harvestable!</span>
                            thePlan.<a class="code" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">HarvestClosingNumbers</a>(theNym); 
                            bSuccess = <span class="keyword">true</span>;
                        }
                    }
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                } <span class="comment">// else (the payment plan loaded successfully)</span>
            } <span class="comment">// pItem was found.</span>
        }
            <span class="keywordflow">break</span>;
            
            <span class="comment">// --------------------------------------------------------------------------------------------------</span>
                        
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:  <span class="comment">// Uses X transaction #s, with an opener for each party and a closer for each asset account.</span>
                                            <span class="comment">// If the message is rejected by the server, then ALL openers can be harvested. But if the</span>
                                            <span class="comment">// message was successful (REGARDLESS of whether the transaction was successful) then all of</span>
                                            <span class="comment">// the openers for all of the parties have been burned. The closers, meanwhile, can be recovered</span>
                                            <span class="comment">// if the message is a failure, as well as in cases where message succeeds but transaction failed.</span>
                                            <span class="comment">// But if transaction succeeded, then the closers CANNOT be recovered. (Only removed, once you sign</span>
                                            <span class="comment">// off on the receipt.)</span>
        {
            <span class="comment">// ------------------------------------------------------------------------------------------</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">OTItem::smartContract</a>);
            
            <span class="keywordflow">if</span> (NULL == pItem)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: Error: Unable to find &quot;</span>
                             <span class="stringliteral">&quot;smartContract item in smartContract transaction.\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// Load up the smart contract...</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a>        strSmartContract;
                <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> theSmartContract(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strSmartContract);
                
                <span class="comment">// If we failed to load the smart contract...</span>
                <span class="keywordflow">if</span> (!strSmartContract.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || (<span class="keyword">false</span> == theSmartContract.LoadContractFromString(strSmartContract)))
                {
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestClosingNumbers: Error: Unable to load &quot;</span>
                                 <span class="stringliteral">&quot;smartContract object from smartContract transaction item.\n&quot;</span>);
                }
                <span class="keywordflow">else</span> <span class="comment">// theSmartContract is ready to go....</span>
                {
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                    <span class="comment">// The message reply itself was a failure. This means the transaction itself never got a chance</span>
                    <span class="comment">// to run... which means ALL the closing numbers on that transaction are STILL GOOD.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry) <span class="comment">// on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                    {
                        theSmartContract.HarvestClosingNumbers(theNym);
                        bSuccess = <span class="keyword">true</span>;
                    }
                    <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
                    <span class="comment">// Why? Because that means the transaction definitely ran--and the opener is marked as &quot;used&quot; on SUCCESS, or &quot;burned&quot; on</span>
                    <span class="comment">// FAILURE--either way, that&#39;s bad for harvesting (no point.)</span>
                    <span class="comment">//</span>
                    <span class="comment">// ===&gt; HOW ABOUT THE CLOSING NUMBERS?</span>
                    <span class="comment">// In cases where the message succeeds but the transaction failed, the closing numbers are recoverable. (TODO send notice to the parties when this happens...)</span>
                    <span class="comment">// But if transaction succeeded, then the closers CANNOT be recovered. They are now &quot;used&quot; on the server, so you might as well keep them in that format on the client side, since that&#39;s how the client has them already.</span>
                    
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                    {
                        <span class="keywordflow">if</span> (bTransactionWasSuccess)
                        {
                            <span class="comment">// This means the &quot;smartContract&quot; opening trans# is MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                            <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
                            <span class="comment">//</span>
<span class="comment">//                          theSmartContract.HarvestClosingNumbers(theNym);</span>
<span class="comment">//                          bSuccess = true;</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure &amp;&amp; !bHarvestingForRetry) <span class="comment">// on re-try, we need the closing #s to stay put, so the re-try has a chance to work.</span>
                        {
                            <span class="comment">// If the transaction was a failure, the opening trans number was burned, </span>
                            <span class="comment">// but the CLOSING numbers are still harvestable...</span>
                            <span class="comment">//</span>
                            theSmartContract.HarvestClosingNumbers(theNym);
                            bSuccess = <span class="keyword">true</span>;                            
                        }
                    } <span class="comment">// else if (bReplyWasSuccess)</span>
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                } <span class="comment">// else (smart contract loaded successfully)</span>
            } <span class="comment">// pItem was found.</span>
            <span class="comment">// ------------------------------------------------------------------------------------------</span>
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8a30dd62230f12131a77471796fd88a"></a><!-- doxytag: member="OTTransaction::HarvestOpeningNumber" ref="ac8a30dd62230f12131a77471796fd88a" args="(OTPseudonym &amp;theNym, const bool bHarvestingForRetry, const bool bReplyWasSuccess, const bool bReplyWasFailure, const bool bTransactionWasSuccess, const bool bTransactionWasFailure)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ac8a30dd62230f12131a77471796fd88a">OTTransaction::HarvestOpeningNumber</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bHarvestingForRetry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bReplyWasFailure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bTransactionWasFailure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00354">354</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>)
    {
            <span class="comment">// Note: the below remarks about &quot;success or fail&quot; are specific to TRANSACTION success, not message success.</span>
<span class="comment">//      case OTTransaction::processNymbox:  // NOTE: why was this here? You don&#39;t need trans#s to process a Nymbox--that&#39;s the whole point of a Nymbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>:   <span class="comment">// Uses 1 transaction #, the opening number, and burns it whether transaction is success-or-fail.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9c490e1b2edddb81720905a14479d0e7">OTTransaction::withdrawal</a>:     <span class="comment">// Uses 1 transaction #, the opening number, and burns it whether transaction is success-or-fail.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ac4cf1c0cdeac5cb3636c34b4682ad228">OTTransaction::deposit</a>:        <span class="comment">// Uses 1 transaction #, the opening number, and burns it whether transaction is success-or-fail.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a30587bf83cb273ffd6a72008d2545ca5">OTTransaction::cancelCronItem</a>: <span class="comment">// Uses 1 transaction #, the opening number, and burns it whether transaction is success-or-fail. </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a1db39a50ac27161d9be40db72bf2dcf4">OTTransaction::payDividend</a>:    <span class="comment">// Uses 1 transaction #, the opening number, and burns it whether transaction is success-or-fail. </span>
            
            <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
            <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
            <span class="comment">//</span>
            <span class="comment">// Note: what if, instead, I don&#39;t know whether the transaction itself failed, because I don&#39;t have a reply message?</span>
            <span class="comment">// In that case, I cannot claw back the numbers because I don&#39;t know for sure. But my future transactions WILL fail if</span>
            <span class="comment">// my nymbox hash goes out of sync, so if that transaction DID process, then I&#39;ll find out right away, and I&#39;ll be forced</span>
            <span class="comment">// to download the nymbox and box receipts in order to get back into sync again. And if the transaction did NOT process,</span>
            <span class="comment">// then I&#39;ll know it when I don&#39;t find it among the receipts. In which case I can pull the original message from the</span>
            <span class="comment">// outbuffer, using the request number from when it was sent, and then harvest it from there.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bReplyWasFailure)   <span class="comment">// NOTE: If I&#39;m harvesting for a re-try, </span>
            {
                bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), 
                                                            <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">//bSave=false, pSignerNym=NULL</span>
            }
            <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY BURNED.</span>
            <span class="comment">// (Why? Because that means the transaction definitely ran--and the opener is burned success-or-fail, if the transaction runs.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
            {
                <span class="comment">// The opener is DEFINITELY BAD, so therefore, we&#39;re definitely not going to claw it back!</span>
                <span class="comment">//</span>
<span class="comment">//              bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                          GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
            }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTTransaction::transfer</a>:       <span class="comment">// Uses 1 transaction #, the opening number, and burns it if failure. But if success, merely marks it as &quot;used.&quot;</span>
            
            <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
            <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bReplyWasFailure)
            {
                bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(),
                                                            <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">//bSave=false, pSignerNym=NULL</span>
            }
            <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
            <span class="comment">// Why? Because that means the transaction definitely ran--and the opener is marked as &quot;used&quot; on success, and &quot;burned&quot; on</span>
            <span class="comment">// failure--either way, that&#39;s bad for harvesting (no point.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
            {
                <span class="keywordflow">if</span> (bTransactionWasSuccess)
                {
                    <span class="comment">// This means the &quot;transfer&quot; transaction# is STILL MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                    <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
<span class="comment">//                  bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                              GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure)
                {
                    <span class="comment">// Whereas if the transaction was a failure, that means the transaction number was DEFINITELY burned.</span>
                    <span class="comment">// (No point clawing it back now--it&#39;s gone already.)</span>
<span class="comment">//                  bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                              GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                }
            }
            <span class="keywordflow">break</span>;            
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acdd69363d8b62cadbfc6a8369a669bc0">OTTransaction::marketOffer</a>:    <span class="comment">// Uses 3 transaction #s, the opening number and 2 closers. If failure, opener is burned.</span>
                                            <span class="comment">// But if success, merely marks it as &quot;used.&quot; Closers are also marked &quot;used&quot; if success,</span>
                                            <span class="comment">// but if message succeeds while transaction fails, then closers can be harvested.</span>
            <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
            <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bReplyWasFailure)
            {
                bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), 
                                                            <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">//bSave=false, pSignerNym=NULL</span>
            }
            <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
            <span class="comment">// Why? Because that means the transaction definitely ran--and the opener is marked as &quot;used&quot; on success, and &quot;burned&quot; on</span>
            <span class="comment">// failure--either way, that&#39;s bad for harvesting (no point.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
            {
                <span class="keywordflow">if</span> (bTransactionWasSuccess)
                {
                    <span class="comment">// This means the &quot;marketOffer&quot; transaction# is STILL MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                    <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
<span class="comment">//                  bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                              GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure)
                {
                    <span class="comment">// Whereas if the transaction was a failure, that means the transaction number was DEFINITELY burned.</span>
                    <span class="comment">// (No point clawing it back now--it&#39;s gone already.)</span>
<span class="comment">//                  bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                              GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                }
            }
            
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b518796457aa29ef96cccc2c861726a">OTTransaction::exchangeBasket</a>: <span class="comment">// Uses X transaction #s: the opener, which is burned success-or-fail, and Y closers (one for</span>
                                            <span class="comment">// each account.) Closers are marked &quot;used&quot; if success transaction, but if message succeeds while</span>
                                            <span class="comment">// transaction fails, then closers can be harvested.</span>
            <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
            <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (bReplyWasFailure)
            {
                bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), 
                                                            <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">//bSave=false, pSignerNym=NULL</span>
            }
            <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY BURNED.</span>
            <span class="comment">// (Why? Because that means the transaction definitely ran--and the opener is burned &quot;success-or-fail&quot;, if this transaction runs.)</span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
            {
                <span class="comment">// The opener is DEFINITELY BURNED, so therefore, we&#39;re definitely not going to claw it back!</span>
                <span class="comment">//</span>
<span class="comment">//              bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                          GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
            }
            <span class="keywordflow">break</span>;
            
            <span class="comment">// These aren&#39;t AS simple.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a7b7b233a1f4438ee26116ba1bda92cb0">OTTransaction::paymentPlan</a>:    <span class="comment">// Uses 4 transaction #s: the opener (sender&#39;s #), which burned on failure but kept alive on success,</span>
                                            <span class="comment">// the sender&#39;s closer, which is only marked as &quot;used&quot; upon success, and the recipient&#39;s opening and</span>
                                            <span class="comment">// closing numbers, which are both only marked as &quot;used&quot; upon success.</span>
        {
            <span class="comment">// The PAYER&#39;s (sender) opening number is burned just from TRYING a transaction. It&#39;s only left</span>
            <span class="comment">// open if the transaction succeeds (but in that case, it&#39;s still marked as &quot;used.&quot;) But the</span>
            <span class="comment">// PAYEE&#39;s (recipient) opening number isn&#39;t marked as &quot;used&quot; UNLESS the transaction succeeds.</span>
            <span class="comment">//</span>
            <span class="comment">// Basically a failed transaction means the sender&#39;s opening number is burned and gone, but the</span>
            <span class="comment">// recipient&#39;s must be clawed back!! Whereas if the message fails (before transaction even has a</span>
            <span class="comment">// chance to run) then BOTH sender and recipient can claw back their numbers. The only way to tell</span>
            <span class="comment">// the difference is to look at the message itself (the info isn&#39;t stored here in the transaction.)</span>
            <span class="comment">//</span>
            <span class="comment">// 1.</span>
            <span class="comment">// Therefore we must assume that the CALLER OF THIS FUNCTION knows. If the message failed, he knows</span>
            <span class="comment">// this, and he SPECIFICALLY called HarvestOpeningNumber() ANYWAY, to get the opening number back</span>
            <span class="comment">// (when normally he would only recoup the closed numbers--therefore he MUST know that the message</span>
            <span class="comment">// failed and that the number is thus still good!)</span>
            <span class="comment">//</span>
            <span class="comment">// 2.</span>
            <span class="comment">// WHEREAS if the message SUCCEEDED (followed by transaction FAIL), then the payer/sender already</span>
            <span class="comment">// used his opening number, whereas the recipient DID NOT! Again, the caller MUST KNOW THIS ALREADY.</span>
            <span class="comment">// The caller wouldn&#39;t call &quot;HarvestOpeningNumber&quot; for a burned number (of the sender.) Therefore</span>
            <span class="comment">// he must be calling it to recoup the (still issued) opening number of the RECIPIENT.</span>
            <span class="comment">// </span>
            <span class="comment">// Problems:</span>
            <span class="comment">// 1. What if caller is stupid, and message hasn&#39;t actually failed? What if caller is mistakenly</span>
            <span class="comment">//    trying to recoup numbers that are actually burned already? Well, the opening number is already </span>
            <span class="comment">//    marked as &quot;used but still issued&quot; so when I try to claw it back, that will work (because it</span>
            <span class="comment">//    only adds a number BACK after it can confirm that the number WAS issued to me in the first place,</span>
            <span class="comment">//    and in this case, that verification will succeed.) </span>
            <span class="comment">//    THEREFORE: need to explicitly pass the message&#39;s success/failure status into the current</span>
            <span class="comment">//    function. IF the msg was a failure, the transaction never had a chance to run and thus the</span>
            <span class="comment">//    opening number is still good, and we can claw it back. But if the message was a SUCCESS, then</span>
            <span class="comment">//    the transaction definitely TRIED to run, which means the opening number is now burned. (IF</span>
            <span class="comment">//    the transaction itself failed, that is. Otherwise if it succeeded, then it&#39;s possible, in the</span>
            <span class="comment">//    cases of transfer and marketOffer, that the opening number is STILL &quot;used but issued&quot;, until</span>
            <span class="comment">//    you finally close out your transferReceipt or the finalReceipt for your market offer.)</span>
            <span class="comment">//</span>
            <span class="comment">// 2. What if caller is stupid, and he called HarvestOpeningNumber for the sender, even though the</span>
            <span class="comment">//    number was already burned in the original attempt? (Which we know it was, since the message</span>
            <span class="comment">//    itself succeeded.) The sender, of course, has that number on his &quot;issued&quot; list, so his clawback</span>
            <span class="comment">//    will succeed, putting him out of sync.</span>
            <span class="comment">//</span>
            <span class="comment">// 3. What if the recipient is passed into this function? His &quot;opening number&quot; is not the primary</span>
            <span class="comment">//    one, but rather, there are three &quot;closing numbers&quot; on a payment plan. One for the sender, to</span>
            <span class="comment">//    match his normal opening number, and 2 more for the recipient (an opening and closing number).</span>
            <span class="comment">//    Therefore in the case of the recipient, need to grab HIS opening number, not the sender&#39;s.</span>
            <span class="comment">//    (Therefore need to know whether Nym is sender or recipient.) Is that actually true? Or won&#39;t</span>
            <span class="comment">//    the harvest process be smart enough to figure that out already? And will it know that the</span>
            <span class="comment">//    recipient still needs to harvest HIS opening number, even if the transaction was attempted,</span>
            <span class="comment">//    since the recipient&#39;s number wasn&#39;t marked as &quot;used&quot; unless the transaction itself succeeded.</span>
            <span class="comment">//    NOTE: CronItem/Agreement/PaymentPlan is definitely smart enough already to know if the Nym is</span>
            <span class="comment">//    the sender or recipient. It will only grab the appropriate number for the right Nym. But here</span>
            <span class="comment">//    in THIS function we still have to be smart enough not to call it for the SENDER if the transaction</span>
            <span class="comment">//    was attempted (because it must be burned already), but TO call it for the sender if the transaction</span>
            <span class="comment">//    was not even attempted (meaning it wasn&#39;t burned yet.) Similarly, this function has to be smart</span>
            <span class="comment">//    enough TO call it for the recipient if transaction was attempted but didn&#39;t succeed, since the</span>
            <span class="comment">//    recipient&#39;s opening number is still good in that case.</span>
            <span class="comment">//</span>
            <span class="comment">// --------------------------------------------------------------------</span>
            
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(theNym);
            
            <span class="comment">// Assumption: if theNymID matches this-&gt;GetUserID(), then theNym must be the SENDER / PAYER!</span>
            <span class="comment">// Else, he must be RECIPIENT / PAYEE, instead!</span>
            <span class="comment">// This assumption is not for proving, since the harvest functions will verify the Nym&#39;s identity</span>
            <span class="comment">// anyway. Instead, this assumption is merely for deciding which logic to use about which harvest</span>
            <span class="comment">// functions to call.</span>
            <span class="comment">//</span>
            <span class="keywordflow">if</span> (theNymID == this-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>())  <span class="comment">// theNym is SENDER / PAYER</span>
            {
                <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
                <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry)
                {                                            
                    bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), 
                                                                <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">//bSave=false, pSignerNym=NULL</span>
                }
                <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY</span>
                <span class="comment">// NOT HARVESTABLE. (For the sender, anyway.) Why not? Because that means the transaction definitely ran--and</span>
                <span class="comment">// the opener is marked as &quot;used&quot; on success, and &quot;burned&quot; on failure--either way, that&#39;s bad for harvesting (no point.)</span>
                <span class="comment">//</span>
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                {
                    <span class="keywordflow">if</span> (bTransactionWasSuccess)
                    {
                        <span class="comment">// This means the &quot;paymentPlan&quot; transaction# is MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                        <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
<span class="comment">//                      bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                                  GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                    }
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure)
                    {
                        <span class="comment">// Whereas if the transaction was a failure, that means the transaction number was DEFINITELY burned.</span>
                        <span class="comment">// (No point clawing it back now--it&#39;s gone already.)</span>
<span class="comment">//                      bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                                  GetTransactionNum()); //bSave=false, pSignerNym=NULL</span>
                    }
                }
            }
            <span class="comment">// --------------------------------------------</span>
            <span class="comment">// theNym is RECIPIENT / PAYEE</span>
            <span class="comment">//</span>
            <span class="comment">// This case is slightly different because above, a successful message with a failed transaction will burn the</span>
            <span class="comment">// opening number, whereas here, if the message is successful but the transaction is failed, the recipient&#39;s</span>
            <span class="comment">// opening transaction number is STILL GOOD and can be harvested!  TODO: Make sure payment plans drop a NOTICE</span>
            <span class="comment">// to the recipient, so he can harvest his numbers when this happens (similar to todos I have for smart contracts.)</span>
            <span class="comment">//</span>
            <span class="comment">// The other big difference with the recipient is that he has a different opening and closing number than the sender</span>
            <span class="comment">// does, so I need to see if I can get those from the transaction, or if I have to load up the attached cron item</span>
            <span class="comment">// to get that data.            </span>
            <span class="comment">//</span>
            <span class="keywordflow">else</span>  <span class="comment">// theNym is RECIPIENT / PAYEE</span>
            {
                <span class="comment">// What is this class doing here?</span>
                <span class="comment">// Answer: it&#39;s the C++ equivalent of local functions.</span>
                <span class="comment">//</span>
                <span class="keyword">class </span>_getRecipientOpeningNum
                {
                <span class="keyword">public</span>:
                    int64_t Run(<a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; theTransaction)
                    {
                        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = theTransaction.<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a38a11345dca4c5dad62a270f100ea16f">OTItem::paymentPlan</a>);
                        <span class="keywordflow">if</span> (NULL != pItem)
                        {
                            <span class="comment">// Also load up the Payment Plan from inside the transaction item.</span>
                            <span class="comment">//</span>
                            <a class="code" href="class_o_t_string.html">OTString</a>        strPaymentPlan;
                            <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>   thePlan;
                            pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strPaymentPlan);

                            <span class="keywordflow">if</span> (strPaymentPlan.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePlan.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPaymentPlan))
                                <span class="keywordflow">return</span> thePlan.<a class="code" href="class_o_t_agreement.html#a3602a1424347da4b23e06b65005148f9">GetRecipientOpeningNum</a>();
                            <span class="keywordflow">else</span>
                                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestOpeningNumber: Error: Unable to load &quot;</span>
                                             <span class="stringliteral">&quot;paymentPlan object from paymentPlan transaction item.\n&quot;</span>);
                        }
                        <span class="keywordflow">else</span>
                            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestOpeningNumber: Error: Unable to find &quot;</span>
                                         <span class="stringliteral">&quot;paymentPlan item in paymentPlan transaction.\n&quot;</span>);
                        <span class="keywordflow">return</span> 0;
                    }
                }; <span class="comment">// class _getRecipientOpeningNum</span>
                <span class="comment">// ----------------------------------</span>
                
                <span class="comment">// If the server reply message was unambiguously a FAIL, that means the opening number is STILL GOOD.</span>
                <span class="comment">// (Because the transaction therefore never even had a chance to run.)</span>
                <span class="comment">//</span>
                <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry)
                {
                    _getRecipientOpeningNum getRecipientOpeningNum;
                    <span class="keyword">const</span> int64_t lRecipientOpeningNum = getRecipientOpeningNum.Run(*<span class="keyword">this</span>);
                    
                    <span class="keywordflow">if</span> (lRecipientOpeningNum &gt; 0)
                        bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), lRecipientOpeningNum); <span class="comment">//bSave=false, pSignerNym=NULL</span>
                }
                <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, then the next question is whether the</span>
                <span class="comment">// TRANSACTION INSIDE IT was also a success, or if there&#39;s a &quot;success message / failed transaction&quot; situation</span>
                <span class="comment">// going on here. For the recipient, that&#39;s important: in the first case, his opener is definitely marked as &quot;used</span>
                <span class="comment">// but still outstanding&quot; and CANNOT be harvested. But in the second case, unlike with the sender, his opener IS harvestable!</span>
                <span class="comment">// This is because of a peculiarity with payment plans: the recipient&#39;s opening number is not marked as used until</span>
                <span class="comment">// the transaction itself is a success!                </span>
                <span class="comment">//</span>
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                {
                    <span class="keywordflow">if</span> (bTransactionWasSuccess) <span class="comment">// The opener is DEFINITELY marked as &quot;used but still outstanding&quot; and CANNOT be harvested.</span>
                    {
                        <span class="comment">// This means the &quot;paymentPlan&quot; transaction# is MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                        <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
<span class="comment">//                      bSuccess = theNym.ClawbackTransactionNumber(GetPurportedServerID(), </span>
<span class="comment">//                                                                  RECIPIENTS--OPENING--NUMBER--GOES--HERE); //bSave=false, pSignerNym=NULL</span>
                    }
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure &amp;&amp; !bHarvestingForRetry)
                    {
                        <span class="comment">// In this case, unlike with the sender, the recipient&#39;s opener IS still harvestable! This is because</span>
                        <span class="comment">// of a peculiarity with payment plans: the recipient&#39;s opening number is not marked as used until the</span>
                        <span class="comment">// transaction itself is a success! Therefore, if the transaction was a failure, that means the recipient&#39;s </span>
                        <span class="comment">// opening number is DEFINITELY STILL GOOD.</span>
                        <span class="comment">//</span>
                        _getRecipientOpeningNum getRecipientOpeningNum;
                        <span class="keyword">const</span> int64_t lRecipientOpeningNum = getRecipientOpeningNum.Run(*<span class="keyword">this</span>);
                        
                        <span class="keywordflow">if</span> (lRecipientOpeningNum &gt; 0)
                            bSuccess = theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), lRecipientOpeningNum); <span class="comment">//bSave=false, pSignerNym=NULL</span>
                    }
                }
            }
        }
            <span class="keywordflow">break</span>;
            
            <span class="comment">// --------------------------------------------------------------------------------------------------</span>
            
            <span class="comment">// TODO: Make sure that when a user receives a success notice that a smart contract has been started up,</span>
            <span class="comment">// that he marks his opener as &quot;burned&quot; instead of as &quot;used.&quot; It&#39;s gone!</span>
            <span class="comment">// Also: if the user receives a message failure notice (not done yet) then he can mark his opening #</span>
            <span class="comment">// as &quot;new&quot; again! But if he instead receives a &quot;message success but transaction failure&quot;, (todo: notice)</span>
            <span class="comment">// then he must burn his opening #, as that is what the server has already done.</span>
            <span class="comment">//</span>
            <span class="comment">// In the case where message and transaction were BOTH success, then the user&#39;s existing setup is already</span>
            <span class="comment">// correct. (The openers AND closers are already marked as &quot;used but still issued&quot; on the client side, and </span>
            <span class="comment">// the server-side sees things that way already as well.)</span>
            <span class="comment">// </span>
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a42b743fb9d9a40ac2a77499f9d87bde0">OTTransaction::smartContract</a>:  <span class="comment">// Uses X transaction #s, with an opener for each party and a closer for each asset account.</span>
                                            <span class="comment">// If the message is rejected by the server, then ALL openers can be harvested. But if the</span>
                                            <span class="comment">// message was successful (REGARDLESS of whether the transaction was successful) then all of</span>
                                            <span class="comment">// the openers for all of the parties have been burned. The closers, meanwhile, can be recovered</span>
                                            <span class="comment">// if the message is a failure, as well as in cases where message succeeds but transaction failed.</span>
                                            <span class="comment">// But if transaction succeeded, then the closers CANNOT be recovered. (Only removed, once you sign</span>
                                            <span class="comment">// off on the receipt.)</span>
        {
            <span class="comment">// ------------------------------------------------------------------------------------------</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1adb560811f0265d344fac45c9333bc25d">OTItem::smartContract</a>);
            
            <span class="keywordflow">if</span> (NULL == pItem)
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestOpeningNumber: Error: Unable to find &quot;</span>
                             <span class="stringliteral">&quot;smartContract item in smartContract transaction.\n&quot;</span>);
            }
            <span class="keywordflow">else</span> <span class="comment">// Load up the smart contract...</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a>        strSmartContract;
                <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a> theSmartContract(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
                pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strSmartContract);
                
                <span class="comment">// If we failed to load the smart contract...</span>
                <span class="keywordflow">if</span> (!strSmartContract.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || (<span class="keyword">false</span> == theSmartContract.LoadContractFromString(strSmartContract)))
                {
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::HarvestOpeningNumber: Error: Unable to load &quot;</span>
                                 <span class="stringliteral">&quot;smartContract object from smartContract transaction item.\n&quot;</span>);
                }
                <span class="keywordflow">else</span> <span class="comment">// theSmartContract is ready to go....</span>
                {
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                    <span class="comment">// The message reply itself was a failure. This means the transaction itself never got a chance</span>
                    <span class="comment">// to run... which means ALL the opening numbers on that transaction are STILL GOOD.</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (bReplyWasFailure &amp;&amp; !bHarvestingForRetry)
                    {                 
                        <span class="comment">// If I WAS harvesting for a re-try, I&#39;d want to leave the opening number</span>
                        <span class="comment">// on this smart contract</span>
                        theSmartContract.HarvestOpeningNumber(theNym);
                        bSuccess = <span class="keyword">true</span>;
                    }
                    <span class="comment">// Else if the server reply message was unambiguously a SUCCESS, that means the opening number is DEFINITELY NOT HARVESTABLE.</span>
                    <span class="comment">// Why? Because that means the transaction definitely ran--and the opener is marked as &quot;used&quot; on SUCCESS, or &quot;burned&quot; on</span>
                    <span class="comment">// FAILURE--either way, that&#39;s bad for harvesting (no point.)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bReplyWasSuccess)
                    {
                        <span class="keywordflow">if</span> (bTransactionWasSuccess)
                        {
                            <span class="comment">// This means the &quot;smartContract&quot; opening trans# is MARKED AS &quot;USED&quot;, and will someday be marked as CLOSED.</span>
                            <span class="comment">// EITHER WAY, you certainly can&#39;t claw that number back now! (It is still outstanding, though. It&#39;s not gone, yet...)</span>
                            <span class="comment">//</span>
<span class="comment">//                          theSmartContract.HarvestOpeningNumber(theNym);</span>
<span class="comment">//                          bSuccess = true;</span>
                        }
                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bTransactionWasFailure)
                        {
                            <span class="comment">// Whereas if the transaction was a failure, that means the opening trans number was DEFINITELY burned.</span>
                            <span class="comment">// (No point clawing it back now--it&#39;s gone already.)</span>
                            <span class="comment">//</span>
<span class="comment">//                          theSmartContract.HarvestOpeningNumber(theNym);</span>
<span class="comment">//                          bSuccess = true;                            </span>
                        }
                    } <span class="comment">// else if (bReplyWasSuccess)</span>
                    <span class="comment">// ------------------------------------------------------------------------------------------</span>
                } <span class="comment">// else (smart contract loaded successfully)</span>
            } <span class="comment">// pItem was found.</span>
            <span class="comment">// ------------------------------------------------------------------------------------------</span>
        }
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
    }
    
    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af41d3b8e4611e5a9e4d7f729a61a6478"></a><!-- doxytag: member="OTTransaction::InitTransaction" ref="af41d3b8e4611e5a9e4d7f729a61a6478" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#af41d3b8e4611e5a9e4d7f729a61a6478">OTTransaction::InitTransaction</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03473">3473</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>       = <span class="stringliteral">&quot;TRANSACTION&quot;</span>; <span class="comment">// CONTRACT, MESSAGE, TRANSACTION, LEDGER, TRANSACTION ITEM </span>
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>           = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>; <span class="comment">// Make sure to set this to the current time whenever contract is signed.</span>
    <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>                  = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>;
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a> = 0;
    <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>        = 0;
    <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>    = <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aacf7e02644aace6f245b9d493e721186"></a><!-- doxytag: member="OTTransaction::IsAbbreviated" ref="aacf7e02644aace6f245b9d493e721186" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">OTTransaction::IsAbbreviated</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00586">586</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="aeabba0a2b6a52c8f50a329f7d14a1ba1"></a><!-- doxytag: member="OTTransaction::IsCancelled" ref="aeabba0a2b6a52c8f50a329f7d14a1ba1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT bool <a class="el" href="class_o_t_transaction.html#aeabba0a2b6a52c8f50a329f7d14a1ba1">OTTransaction::IsCancelled</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00561">561</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="aa0726f273b313b03bad0390ed2b8bb19"></a><!-- doxytag: member="OTTransaction::LoadAbbreviatedRecord" ref="aa0726f273b313b03bad0390ed2b8bb19" args="(irr::io::IrrXMLReader *&amp;xml, int64_t &amp;lNumberOfOrigin, int64_t &amp;lTransactionNum, int64_t &amp;lInRefTo, int64_t &amp;lInRefDisplay, time64_t &amp;the_DATE_SIGNED, OTTransaction::transactionType &amp;theType, OTString &amp;strHash, int64_t &amp;lAdjustment, int64_t &amp;lDisplayValue, int64_t &amp;lClosingNum, int64_t &amp;lRequestNum, bool &amp;bReplyTransSuccess, OTNumList *pNumList=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_transaction.html#aa0726f273b313b03bad0390ed2b8bb19">OTTransaction::LoadAbbreviatedRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNumberOfOrigin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lInRefTo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lInRefDisplay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>the_DATE_SIGNED</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> &amp;&#160;</td>
          <td class="paramname"><em>theType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lAdjustment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lDisplayValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lClosingNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>lRequestNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bReplyTransSuccess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> *&#160;</td>
          <td class="paramname"><em>pNumList</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04162">4162</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOrigin        = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numberOfOrigin&quot;</span>);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNum      = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transactionNum&quot;</span>);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInRefTo       = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;inReferenceTo&quot;</span>);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInRefDisplay  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;inRefDisplay&quot;</span>);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strDateSigned    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;dateSigned&quot;</span>);
    <span class="comment">// -------------------------------------</span>
    <span class="keywordflow">if</span> (!strTransNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strInRefTo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strInRefDisplay.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strDateSigned.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failure: missing strTransNum (%s) or strInRefTo (%s) &quot;</span>
                       <span class="stringliteral">&quot;or strInRefDisplay (%s) or strDateSigned(%s) while loading abbreviated receipt. \n&quot;</span>,
                       strTransNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strInRefTo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strInRefDisplay.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strDateSigned.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> (-1);            
    }
    lTransactionNum     = atol(strTransNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    lInRefTo            = atol(strInRefTo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    lInRefDisplay       = atol(strInRefDisplay.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    
    <span class="keywordflow">if</span> (strOrigin.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        lNumberOfOrigin = atol(strOrigin.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    the_DATE_SIGNED = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(strDateSigned.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); <span class="comment">// (We already verified it Exists() just above.)</span>
    <span class="comment">// -------------------------------------</span>
    <span class="comment">// Transaction TYPE for the abbreviated record...</span>
    theType                 = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>; <span class="comment">// default</span>
    <span class="keyword">const</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strAbbrevType  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>); <span class="comment">// the type of inbox receipt, or outbox receipt, or nymbox receipt. (Transaction type.)</span>
    <span class="keywordflow">if</span> (strAbbrevType.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        theType = <a class="code" href="class_o_t_transaction.html#a806b1bd373a5777b5a41d5141e9e914d">OTTransaction::GetTypeFromString</a>(strAbbrevType);

        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a> == theType)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failure: OTTransaction::error_state was the found type (based on &quot;</span>
                          <span class="stringliteral">&quot;string %s), when loading abbreviated receipt for trans num: %lld (In Reference To: %lld) \n&quot;</span>,
                          strAbbrevType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), lTransactionNum, lInRefTo);
            <span class="keywordflow">return</span> (-1);
        }
    }
    <span class="keywordflow">else</span> 
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failure: unknown transaction type (%s) when &quot;</span>
                       <span class="stringliteral">&quot;loading abbreviated receipt for trans num: %lld (In Reference To: %lld) \n&quot;</span>,
                       strAbbrevType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), lTransactionNum, lInRefTo);
        <span class="keywordflow">return</span> (-1);
    }
    <span class="comment">// -------------------------------------</span>
    <span class="comment">// RECEIPT HASH</span>
    <span class="comment">//</span>
    strHash = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;receiptHash&quot;</span>);
    <span class="keywordflow">if</span> (!strHash.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failure: Expected receiptHash while loading &quot;</span>
                       <span class="stringliteral">&quot;abbreviated receipt for trans num: %lld (In Reference To: %lld)\n&quot;</span>, lTransactionNum,
                       lInRefTo);
        <span class="keywordflow">return</span> (-1);            
    }
    <span class="comment">// -------------------------------------</span>
    lAdjustment     = 0;
    lDisplayValue   = 0;
    lClosingNum     = 0;
    <span class="comment">// -------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAbbrevAdjustment      = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;adjustment&quot;</span>);
    <span class="keywordflow">if</span> (strAbbrevAdjustment.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        lAdjustment                         = atol(strAbbrevAdjustment.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -------------------------------------    </span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAbbrevDisplayValue    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;displayValue&quot;</span>);
    <span class="keywordflow">if</span> (strAbbrevDisplayValue.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        lDisplayValue                       = atol(strAbbrevDisplayValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -------------------------------------------------------------------------</span>
    
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a> == theType)
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strRequestNum = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;requestNumber&quot;</span>);
        
        <span class="keywordflow">if</span> (!strRequestNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failed loading abbreviated receipt: &quot;</span>
                           <span class="stringliteral">&quot;expected requestNumber on replyNotice trans num: %lld (In Reference To: %lld)\n&quot;</span>,
                           lTransactionNum, lInRefTo);
            <span class="keywordflow">return</span> (-1);
        }
        lRequestNum = atol(strRequestNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// ----------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransSuccess = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transSuccess&quot;</span>);

        bReplyTransSuccess  = strTransSuccess.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>);
    } <span class="comment">// if replyNotice (expecting request Number)</span>
    <span class="comment">// -------------------------------------</span>

    <span class="comment">// If the transaction is a certain type, then it will also have a CLOSING number. </span>
    <span class="comment">// (Grab that too.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>    == theType) || 
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>   == theType))
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAbbrevClosingNum = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;closingNum&quot;</span>);
        
        <span class="keywordflow">if</span> (!strAbbrevClosingNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::LoadAbbreviatedRecord: Failed loading abbreviated receipt: &quot;</span>
                           <span class="stringliteral">&quot;expected closingNum on trans num: %lld (In Reference To: %lld)\n&quot;</span>,
                           lTransactionNum, lInRefTo);
            <span class="keywordflow">return</span> (-1);
        }
        lClosingNum = atol(strAbbrevClosingNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    } <span class="comment">// if finalReceipt or basketReceipt (expecting closing num)</span>
    <span class="comment">// -------------------------------------</span>
    <span class="comment">// These types carry their own internal list of numbers.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((NULL != pNumList) &amp;&amp;
        ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">OTTransaction::blank</a>           == theType) || 
         (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>   == theType))
        )
    {
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNumbers = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;totalListOfNumbers&quot;</span>);
        pNumList-&gt;<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
        
        <span class="keywordflow">if</span> (strNumbers.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            pNumList-&gt;Add(strNumbers);
    } <span class="comment">// if blank or successNotice (expecting totalListOfNumbers.. no more multiple blanks in the same ledger! They all go in a single transaction.)</span>
    <span class="comment">// -------------------------------------</span>
    
    <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae97bc794fe820f4f2e864c29c42df8eb"></a><!-- doxytag: member="OTTransaction::LoadBoxReceipt" ref="ae97bc794fe820f4f2e864c29c42df8eb" args="(OTTransaction &amp;theAbbrev, OTLedger &amp;theLedger)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theAbbrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theLedger</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03065">3065</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{   
    <span class="keyword">const</span> int64_t lLedgerType = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>());
    
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theAbbrev, lLedgerType);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e8558a4ea21189062fcc224dd6fe6a9"></a><!-- doxytag: member="OTTransaction::LoadBoxReceipt" ref="a6e8558a4ea21189062fcc224dd6fe6a9" args="(OTTransaction &amp;theAbbrev, const int64_t lLedgerType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> * <a class="el" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theAbbrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lLedgerType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03075">3075</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// See if the appropriate file exists, and load it up from</span>
    <span class="comment">// local storage, into a string.</span>
    <span class="comment">// Then, try to load the transaction from that string and see if successful.</span>
    <span class="comment">// If it verifies, then return it. Otherwise return NULL.</span>
    <span class="comment">// --------------------------------------------------------</span>
    <span class="comment">// Can only load abbreviated transactions (so they&#39;ll become their full form.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theAbbrev.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load box receipt %lld: &quot;</span>
                       <span class="stringliteral">&quot;(Because argument &#39;theAbbrev&#39; wasn&#39;t abbreviated.)\n&quot;</span>, 
                       __FUNCTION__, theAbbrev.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ****************************************************************</span>
    <span class="comment">// Next, see if the appropriate file exists, and load it up from</span>
    <span class="comment">// local storage, into a string.</span>
    
    <a class="code" href="class_o_t_string.html">OTString</a> strFolder1name, strFolder2name, strFolder3name, strFilename;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(lLedgerType,
                                                        theAbbrev,
                                                        __FUNCTION__, <span class="comment">// &quot;OTTransaction::LoadBoxReceipt&quot;,</span>
                                                        strFolder1name,
                                                        strFolder2name, 
                                                        strFolder3name, 
                                                        strFilename))
        <span class="keywordflow">return</span> NULL; <span class="comment">// This already logs -- no need to log twice, here.</span>
    <span class="comment">// -------------------------------------------------------------------- </span>
    <span class="comment">// See if the box receipt exists before trying to load it...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Box receipt does not exist: %s%s%s%s%s%s%s\n&quot;</span>,
                       __FUNCTION__, 
                       strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                       strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                       strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// Try to load the box receipt from local storage.</span>
    <span class="comment">//</span>
    std::string strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>
                                                       strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                                       strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                                       strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>())); 
    <span class="keywordflow">if</span> (strFileContents.length() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading file: %s%s%s%s%s%s%s\n&quot;</span>, 
                      __FUNCTION__,
                      strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strRawFile(strFileContents.c_str());
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == strRawFile.Exists())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading file (resulting output &quot;</span>
                      <span class="stringliteral">&quot;string is empty): %s%s%s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__,
                      strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// Finally, try to load the transaction from that string and see if successful.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a> * pTransType = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strRawFile);
    
    <span class="keywordflow">if</span> (NULL == pTransType)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error instantiating transaction &quot;</span>
                      <span class="stringliteral">&quot;type based on strRawFile: %s%s%s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__,
                      strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pBoxReceipt = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_transaction.html">OTTransaction</a> *<span class="keyword">&gt;</span>(pTransType);
    
    <span class="keywordflow">if</span> (NULL == pBoxReceipt)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error dynamic_cast from transaction &quot;</span>
                      <span class="stringliteral">&quot;type to transaction, based on strRawFile: %s%s%s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__,
                      strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keyword">delete</span> pTransType; pTransType = NULL; <span class="comment">// cleanup!</span>
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// BELOW THIS POINT, pBoxReceipt exists, and is an OTTransaction pointer, and is loaded,</span>
    <span class="comment">// and basically is ready to be compared to theAbbrev, which is its abbreviated version.</span>
    <span class="comment">// It MUST either be returned or deleted.</span>
    <span class="comment">// ****************************************************************</span>
    
    <span class="keywordtype">bool</span> bSuccess = theAbbrev.<a class="code" href="class_o_t_transaction.html#a51fc66087f5a0acdfc4a1054298b23b7">VerifyBoxReceipt</a>(*pBoxReceipt);
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSuccess)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed verifying Box Receipt:\n%s%s%s%s%s%s%s\n&quot;</span>, 
                      __FUNCTION__,
                      strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// -----------------</span>
        <span class="keyword">delete</span> pBoxReceipt; pBoxReceipt = NULL;
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">else</span> 
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Successfully loaded Box Receipt in:\n%s%s%s%s%s%s%s\n&quot;</span>, 
                       __FUNCTION__,
                       strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                       strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                       strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                       strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// Todo: security analysis. By this point we&#39;ve verified the hash of the transaction against the stored</span>
    <span class="comment">// hash inside the abbreviated version. (VerifyBoxReceipt) We&#39;ve also verified a few other values like transaction</span>
    <span class="comment">// number, and the &quot;in ref to&quot; display number. We&#39;re then assuming based on those, that the adjustment and display</span>
    <span class="comment">// amount are correct. (The hash is actually a zero knowledge proof of this already.) This is good for speedier</span>
    <span class="comment">// optimization but may be worth revisiting in case any security holes.</span>
    <span class="comment">// UPDATE: We&#39;ll save this for optimization needs in the future.</span>
    <span class="comment">//  pBoxReceipt-&gt;SetAbbrevAdjustment(       theAbbrev.GetAbbrevAdjustment() );    </span>
    <span class="comment">//  pBoxReceipt-&gt;SetAbbrevDisplayAmount(    theAbbrev.GetAbbrevDisplayAmount() );</span>
    <span class="comment">// -------------------------------------------------</span>
    
    <span class="keywordflow">return</span> pBoxReceipt;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a18d4d5da09f16aac3ccb97984ec021b1"></a><!-- doxytag: member="OTTransaction::ProcessXMLNode" ref="a18d4d5da09f16aac3ccb97984ec021b1" args="(irr::io::IrrXMLReader *&amp;xml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_transaction.html#a18d4d5da09f16aac3ccb97984ec021b1">OTTransaction::ProcessXMLNode</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a48611c37c8e8e7d9125238bda2b77978">OTContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04317">4317</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{   
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNodeName = xml-&gt;getNodeName();
    
    <a class="code" href="class_o_t_num_list.html">OTNumList</a> * pNumList = NULL;
    <span class="keywordflow">if</span> (strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))
    {
        pNumList = &amp;<a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>;
    }
    <span class="comment">// -----------------------------------------</span>
    
    <span class="keywordflow">if</span> (strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>)         ||
        strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>)          ||
        strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>)         ||
        strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)   ||
        strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>)      ||
        strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))
    {
        int64_t lNumberOfOrigin = 0;
        int64_t lTransactionNum = 0;
        int64_t lInRefTo            = 0;
        int64_t lInRefDisplay       = 0;
        <span class="comment">// -------------------------------------</span>
        <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> the_DATE_SIGNED    = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
        <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">OTTransaction::transactionType</a> theType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTTransaction::error_state</a>; <span class="comment">// default</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strHash;
        <span class="comment">// -------------------------------------</span>
        int64_t lAdjustment     = 0;
        int64_t lDisplayValue       = 0;
        int64_t lClosingNum     = 0;
        int64_t lRequestNumber     = 0;
        <span class="keywordtype">bool</span> bReplyTransSuccess = <span class="keyword">false</span>;
        <span class="comment">// -------------------------------------</span>
        int32_t nAbbrevRetVal =
            <a class="code" href="class_o_t_transaction.html#aa0726f273b313b03bad0390ed2b8bb19">OTTransaction::LoadAbbreviatedRecord</a>(xml,
                                                 lNumberOfOrigin,
                                                 lTransactionNum,
                                                 lInRefTo,
                                                 lInRefDisplay,
                                                 the_DATE_SIGNED,
                                                 theType,
                                                 strHash,
                                                 lAdjustment,
                                                 lDisplayValue,
                                                 lClosingNum,
                                                 lRequestNumber,
                                                 bReplyTransSuccess,
                                                 pNumList); <span class="comment">// for &quot;OTTransaction::blank&quot; and &quot;OTTransaction::successNotice&quot; (Otherwise NULL.)</span>
        <span class="comment">// -------------------------------------</span>
        <span class="keywordflow">if</span> ((-1) == nAbbrevRetVal)
            <span class="keywordflow">return</span> (-1); <span class="comment">// The function already logs appropriately.</span>
        <span class="comment">// -------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a>    = <span class="keyword">true</span>; <span class="comment">// &lt;======================</span>

        <a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(lNumberOfOrigin);
        <a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(lTransactionNum);
        <a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lInRefTo);
        <a class="code" href="class_o_t_transaction.html#af3c025bbdeb70a053c6149a32d8b9940">SetClosingNum</a>(lClosingNum);
        <a class="code" href="class_o_t_transaction.html#a8db20f109eab5bf715673bfcf3b3bb4f">SetRequestNum</a>(lRequestNumber);
        
        <a class="code" href="class_o_t_transaction.html#a3099413a51aa3ec99b783a4e89144150">SetReplyTransSuccess</a>(bReplyTransSuccess);
        
        <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a>     = lInRefDisplay;
        <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a>     = lAdjustment;
        <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a>    = lDisplayValue;
        <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>       = the_DATE_SIGNED;
        <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>              = theType;
        
        <span class="keywordflow">if</span> (strHash.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(strHash);
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::ProcessXMLNode: Missing receiptHash on abbreviated record.\n&quot;</span>);
        
        <span class="keywordflow">return</span> 1;
    }
    
    <span class="comment">// ******************************************************</span>
    <span class="comment">// THIS PART is probably what you&#39;re looking for.</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strNodeName.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;transaction&quot;</span>)) <span class="comment">// Todo:  notice how this &quot;else if&quot; uses OTString::Compare, where most other ProcessXMLNode functions in OT use !strcmp()? (That&#39;s right: Buffer overflow. Need to fix elsewhere as it is fixed here.)</span>
    {   
        <span class="comment">// -------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strType = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;type&quot;</span>);
        
        <span class="keywordflow">if</span> (strType.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a> = <a class="code" href="class_o_t_transaction.html#a806b1bd373a5777b5a41d5141e9e914d">OTTransaction::GetTypeFromString</a>(strType);
        <span class="keywordflow">else</span> 
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::ProcessXMLNode: Failure: unknown transaction type: %s \n&quot;</span>,
                           strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> (-1);
        }
        <span class="comment">// -------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strCancelled   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;cancelled&quot;</span>);
        <span class="keywordflow">if</span> (strCancelled.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; strCancelled.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>))
            <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a> = <span class="keyword">true</span>;
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a> = <span class="keyword">false</span>;
        <span class="comment">// -------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strDateSigned  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;dateSigned&quot;</span>);
        <span class="keyword">const</span> int64_t lDateSigned   = strDateSigned.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? atol(strDateSigned.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()) : 0;
        <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>           = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lDateSigned); <span class="comment">// Todo casting ?</span>
        <span class="comment">// -------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAcctID    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;accountID&quot;</span>); 
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;serverID&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strUserID    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;userID&quot;</span>);
        <span class="comment">// -------------------------------------</span>
        <span class="keywordflow">if</span> (!strAcctID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strServerID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strUserID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::ProcessXMLNode: Failure: missing strAcctID (%s) or strServerID (%s) or strUserID (%s). \n&quot;</span>,
                           strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strServerID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> (-1);            
        }
        <span class="comment">// -------------------------------------        </span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOrigin    = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;numberOfOrigin&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransNum  = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transactionNum&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strInRefTo   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;inReferenceTo&quot;</span>);
        <span class="comment">// -------------------------------------</span>
        <span class="keywordflow">if</span> (!strTransNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !strInRefTo.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::ProcessXMLNode: Failure: missing strTransNum (%s) or strInRefTo (%s). \n&quot;</span>,
                           strTransNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strInRefTo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            <span class="keywordflow">return</span> (-1);            
        }
        <span class="comment">// -------------------------------------    </span>
        
        <span class="comment">// a replyNotice (a copy of the server&#39;s reply to one of my messages)</span>
        <span class="comment">// is often dropped into my Nymbox, to make sure I see it. Usually these</span>
        <span class="comment">// have a REQUEST NUMBER on them, so I can quickly tell WHICH MESSAGE</span>
        <span class="comment">// it is in reply to.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>)
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strRequestNum = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;requestNumber&quot;</span>);

            <span class="keywordflow">if</span> (strRequestNum.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a> = atol(strRequestNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTransSuccess = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transSuccess&quot;</span>);

            <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a>    = strTransSuccess.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;true&quot;</span>);
        }
        
        <span class="comment">// -------------------------------------    </span>

        <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">OTTransaction::blank</a>           == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || 
            (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>   == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>))
        {
            <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTotalList     = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;totalListOfNumbers&quot;</span>);
            <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
            
            <span class="keywordflow">if</span> (strTotalList.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
                <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.Add(strTotalList); <span class="comment">// (Comma-separated list of numbers now becomes std::set&lt;int64_t&gt;.)</span>
        }
   
        <span class="comment">// -------------------------------------    </span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> ACCOUNT_ID(strAcctID), SERVER_ID(strServerID), USER_ID(strUserID);
        <span class="comment">// -------------------------------------        </span>
        <a class="code" href="class_o_t_transaction_type.html#a80e0cd6a62cb0749526db848a3551bfe">SetPurportedAccountID</a>(ACCOUNT_ID);  <span class="comment">// GetPurportedAccountID() const { return m_AcctID; }</span>
        <a class="code" href="class_o_t_transaction_type.html#aae055609a4aa9b78567621209bc3fea1">SetPurportedServerID</a>(SERVER_ID);    <span class="comment">// GetPurportedServerID() const { return m_AcctServerID; }</span>
        <a class="code" href="class_o_t_transaction_type.html#a7bf07ca057376707a33b7a44447a4334">SetUserID</a>(USER_ID);
        <span class="comment">// -------------------------------------------</span>
        <span class="comment">//  m_bLoadSecurely defaults to true.</span>
        <span class="comment">// Normally the RealAccountID and RealServerID are set from above, before</span>
        <span class="comment">// loading. That way, I can compare them to whatever is actually loaded.</span>
        <span class="comment">// (So people don&#39;t swap files on us!!)</span>
        <span class="comment">// But if the coder SPECIALLY sets  m_bLoadSecurely to FALSE, that means he</span>
        <span class="comment">// honestly doesn&#39;t know those IDs, and he is loading the file, and he wants it</span>
        <span class="comment">// to load up properly AS IF THE IDs IN THE FILE WERE CORRECT. He only does this</span>
        <span class="comment">// because it&#39;s the only way to get the file loaded without knowing those IDs in</span>
        <span class="comment">// advance, and because he takes care, when doing this, to check them after the fact</span>
        <span class="comment">// and see if they are, indeed, the ones he was expecting.</span>
        <span class="comment">//</span>
        <span class="comment">// This mechanism was ONLY FINALLY ADDED to get the class factory working properly.</span>
        <span class="comment">// And even in this case, it is still INTERNALLY CONSISTENT. (The sub-items will still</span>
        <span class="comment">// be expected to be correct with their parent items.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> ==  <a class="code" href="class_o_t_transaction_type.html#a05be1cf5d51725a4b427d5ac9714234b">m_bLoadSecurely</a>)
        {
            <a class="code" href="class_o_t_transaction_type.html#ab9c7df06d15e6dbeb53b3b3d87c13c83">SetRealAccountID</a>(ACCOUNT_ID);
            <a class="code" href="class_o_t_transaction_type.html#a95c29dde80e19aa9b24c4e92f29a766e">SetRealServerID</a>(SERVER_ID);
        }
        <span class="comment">// -------------------------------------------</span>

        <span class="keywordflow">if</span> (strOrigin.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
            this-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(atol(strOrigin.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
            
        this-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(atol(strTransNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
        this-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(atol(strInRefTo.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));
        
        <span class="comment">// -------------------------------------        </span>
        <span class="comment">/*  From UpdateContents() (there is writing, above is reading):</span>
<span class="comment">         </span>
<span class="comment">            OTString    strAcctID(GetPurportedAccountID()), </span>
<span class="comment">                        strServerID(GetPurportedServerID()),</span>
<span class="comment">                        strUserID(GetUserID());</span>
<span class="comment"></span>
<span class="comment">            m_xmlUnsigned.Concatenate(&quot;&lt;transaction type=\&quot;%s\&quot;\n&quot;</span>
<span class="comment">                              &quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
<span class="comment">                              &quot; accountID=\&quot;%s\&quot;\n&quot;</span>
<span class="comment">                              &quot; userID=\&quot;%s\&quot;\n&quot;</span>
<span class="comment">                              &quot; serverID=\&quot;%s\&quot;\n&quot;</span>
<span class="comment">                              &quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
<span class="comment">                              &quot; inReferenceTo=\&quot;%lld\&quot; &gt;\n\n&quot;, </span>
<span class="comment">                              strType.Get(), lDateSigned, </span>
<span class="comment">                              strAcctID.Get(),      // GetPurportedAccountID() const { return m_AcctID; }</span>
<span class="comment">                              strUserID.Get(), </span>
<span class="comment">                              strServerID.Get(),    // GetPurportedServerID() const { return m_AcctServerID; }</span>
<span class="comment">                              GetTransactionNum(),</span>
<span class="comment">                              GetReferenceToNum());</span>
<span class="comment"></span>
<span class="comment">         From OTTransactionType.h:</span>
<span class="comment">            const OTIdentifier &amp; GetUserID() const { return m_AcctUserID; } </span>
<span class="comment">            const OTIdentifier &amp; GetRealAccountID() const { return m_ID; }</span>
<span class="comment">            const OTIdentifier &amp; GetRealServerID() const { return m_ServerID; }</span>
<span class="comment">            const OTIdentifier &amp; GetPurportedAccountID() const { return m_AcctID; }</span>
<span class="comment">            const OTIdentifier &amp; GetPurportedServerID() const { return m_AcctServerID; }</span>
<span class="comment"></span>
<span class="comment">         */</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;Loaded transaction %lld, in reference to: %lld type: %s\n&quot;</span>,
<span class="comment">//              &quot;accountID:\n%s\n serverID:\n%s\n----------\n&quot;, </span>
                <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()
<span class="comment">//              strAcctID.Get(), strServerID.Get()</span>
                );
        
        <span class="keywordflow">return</span> 1;
    }   
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;closingTransactionNumber&quot;</span>, xml-&gt;getNodeName())) 
    {       
        <a class="code" href="class_o_t_string.html">OTString</a> strClosingNumber = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;value&quot;</span>);
        
        <span class="keywordflow">if</span> (strClosingNumber.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; 
            ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>)))
        {
            <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a> = atol(strClosingNumber.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTTransaction::ProcessXMLNode: closingTransactionNumber field without value, or in wrong transaction type.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }
        
        <span class="keywordflow">return</span> 1;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;cancelRequest&quot;</span>, xml-&gt;getNodeName())) 
    {       
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, <a class="code" href="class_o_t_transaction.html#a115f7417f09e3e815212d770e7b60a1b">m_ascCancellationRequest</a>))
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTTransaction::ProcessXMLNode: cancelRequest field without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }
        
        <span class="keywordflow">return</span> 1;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;inReferenceTo&quot;</span>, xml-&gt;getNodeName())) 
    {       
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, <a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>))
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTTransaction::ProcessXMLNode: inReferenceTo field without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }
        
        <span class="keywordflow">return</span> 1;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;item&quot;</span>, xml-&gt;getNodeName())) 
    {       
        <a class="code" href="class_o_t_string.html">OTString</a> strData;

        <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, strData) || !strData.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTTransaction::ProcessXMLNode: transaction item field without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }
        <span class="keywordflow">else</span> 
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_item.html">OTItem</a>(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>(), *<span class="keyword">this</span>);
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);           
            <span class="comment">// -----------------------------------------------------</span>
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction_type.html#a05be1cf5d51725a4b427d5ac9714234b">m_bLoadSecurely</a>)
                pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0734d617542cad4697f7852a15ef7b3c">SetLoadInsecure</a>();
            <span class="comment">// -----------------------------------------------------</span>
            <span class="comment">// If we&#39;re able to successfully base64-decode the string and load it up as</span>
            <span class="comment">// a transaction, then add it to the ledger&#39;s list of transactions</span>
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == pItem-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strData))
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR: OTTransaction failed loading item from string: \n\n%s\n\n&quot;</span>,
                              strData.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? strData.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>() : <span class="stringliteral">&quot;&quot;</span>);
                <span class="keyword">delete</span> pItem; pItem = NULL;
                <span class="keywordflow">return</span> (-1);
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == pItem-&gt;VerifyContractID())
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;ERROR: Failed verifying transaction Item in OTTransaction::ProcessXMLNode: \n\n%s\n\n&quot;</span>,
                             strData.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="keyword">delete</span> pItem; pItem = NULL;
                <span class="keywordflow">return</span> (-1);
            }           
            <span class="keywordflow">else</span> 
            {
                <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.push_back(pItem);
<span class="comment">//              OTLog::Output(5, &quot;Loaded transaction Item and adding to m_listItems in OTTransaction\n&quot;);</span>
            }
        }

        <span class="keywordflow">return</span> 1;
    }
        
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4a89382fb0a9a3500c19fe9107df3122"></a><!-- doxytag: member="OTTransaction::ProduceInboxReportItem" ref="a4a89382fb0a9a3500c19fe9107df3122" args="(OTItem &amp;theBalanceItem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a4a89382fb0a9a3500c19fe9107df3122">OTTransaction::ProduceInboxReportItem</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_item.html">OTItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theBalanceItem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05705">5705</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{   
    <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTItem::error_state</a>;
    
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;Producing statement report item for inbox item type: %s.\n&quot;</span>,
                   <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>()); <span class="comment">// temp remove.</span>
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {   <span class="comment">// These are the types that have an amount (somehow)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:         <span class="comment">// the amount is stored on the transfer item in my list.</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:   <span class="comment">// the amount is stored on cheque (attached to depositCheque item, attached.)</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTItem::chequeReceipt</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:   <span class="comment">// the amount is stored on voucher (attached to depositCheque item, attached.)</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTItem::voucherReceipt</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:   <span class="comment">// the amount is stored on marketReceipt item</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTItem::marketReceipt</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:  <span class="comment">// amount is stored on paymentReceipt item</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTItem::paymentReceipt</a>;           
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: <span class="comment">// amount is 0 according to GetReceiptAmount()</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTItem::transferReceipt</a>;          
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:  <span class="comment">// amount is stored on basketReceipt item.</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTItem::basketReceipt</a>;            
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:   <span class="comment">// amount is 0 according to GetReceiptAmount()</span>
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTItem::finalReceipt</a>;         
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for inbox reports</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;OTTransaction::ProduceInboxReportItem: Ignoring %s transaction &quot;</span>
                           <span class="stringliteral">&quot;in inbox while making balance statement.\n&quot;</span>, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
        }
            <span class="keywordflow">return</span>;
    }   <span class="comment">// why not transfer receipt? Because the amount was already removed from your account when you transferred it,</span>
        <span class="comment">// and you already signed a balance agreement at that time. Thus, nothing in your inbox is necessary to prove</span>
        <span class="comment">// the change in balance -- you already signed off on it. UPDATE: that&#39;s okay since the below GetReceiptAmount()</span>
        <span class="comment">// will return 0 for a transfer receipt anyway.</span>
    
    <span class="comment">// ---------------------------------------------------</span>
    <span class="comment">// In the case of a cron receipt which is in the inbox, but is being accepted</span>
    <span class="comment">// by a notarizeProcessInbox, (if theOwner is a processInbox transaction) then </span>
    <span class="comment">// we don&#39;t want to report that item. Why not? Because if the processInbox is a</span>
    <span class="comment">// success, the item would be presumed removed. (That&#39;s what the process aims to do,</span>
    <span class="comment">// after all: accept and remove the market receipt.) Therefore, I don&#39;t want to add</span>
    <span class="comment">// it to the report, since the server will then think it&#39;s supposed to be there, when</span>
    <span class="comment">// in fact it&#39;s supposed to be gone. I&#39;m supposed to be showing a picture of what would</span>
    <span class="comment">// be left in the event of a success. And if I successfully processed the receipt out of my</span>
    <span class="comment">// inbox, then I would expect not to see it there anymore, so since that is what I would</span>
    <span class="comment">// expect in that case, that is the picture I need to construct now.</span>
    <span class="comment">//</span>
    <span class="comment">// Thus, here we loop through theOwner (IF he&#39;s a process inbox transaction) and we see</span>
    <span class="comment">// if he&#39;s actually trying to process a receipt off the inbox FOR ME (THIS transaction.) If he is, then</span>
    <span class="comment">// we don&#39;t need to add this transaction to the report.</span>
    <span class="comment">//</span>
    <span class="comment">/*</span>
<span class="comment">    if (OTTransaction::processInbox == theOwner.GetType()) // &lt;==== IF it&#39;s a process inbox !!!</span>
<span class="comment">    {</span>
<span class="comment">        FOR_EACH(listOfItems, theOwner.GetItemList())</span>
<span class="comment">        {</span>
<span class="comment">            OTItem * pItem = *it;</span>
<span class="comment">            OT_ASSERT_MSG(NULL != pItem, &quot;Pointer should not have been NULL.&quot;);</span>
<span class="comment">            </span>
<span class="comment">            // In this place, it means that someone is trying to PROCESS his INBOX. He is looping through that inbox,</span>
<span class="comment">            // creating an INBOX REPORT, so he can attach it to the balance agreement for his PROCESS INBOX TRANSACTION.</span>
<span class="comment">            //</span>
<span class="comment">            // Well... What if, as part of processing his inbox, he is trying to remove some receipts?</span>
<span class="comment">            // If he tries to remove a marketReceipt, then we&#39;d expect, in the event of success, that</span>
<span class="comment">            // said marketReceipt would disappear from his inbox. </span>
<span class="comment">            //</span>
<span class="comment">            // The purpose of the balance agreement is to have both sides SIGN and AGREE what the picture looks</span>
<span class="comment">            // like, after and assuming the transaction is a success. If I SUCCESSFULLY remove </span>
<span class="comment">            </span>
<span class="comment">            if ((pItem-&gt;GetType() == OTItem::acceptCronReceipt) &amp;&amp; // &lt;==== IF AND IF, cron receipt, transaction number matches</span>
<span class="comment">                (pItem-&gt;GetReferenceToNum() == GetTransactionNum()))   // that means I&#39;m DEFINITELY accepting it aka REMOVING it, right?</span>
<span class="comment">            {</span>
<span class="comment">                return; // We don&#39;t add THIS transaction to the balance agreement item then, since</span>
<span class="comment">                        // the balance agreement is actually part of a transaction that is REMOVING</span>
<span class="comment">                        // THIS TRANSACTION from my inbox, and therefore I don&#39;t WANT it showing in</span>
<span class="comment">                        // the balance agreement. (Wouldn&#39;t expect it to be there, in the event of success.</span>
<span class="comment">                        // The whole idea is to sign a picture of how things would look IN THE EVENT OF SUCCESS.)</span>
<span class="comment">            }</span>
<span class="comment">            </span>
<span class="comment">            // Why is there not a similar if statement here for acceptItemReceipt, the way there is</span>
<span class="comment">            // for acceptCronReceipt? If it turns out to be an issue, this might just be where I&#39;d put it.</span>
<span class="comment">            </span>
<span class="comment">            // AHHH:  I bet this is done in the code that CALLS this function... I BET the relevant items</span>
<span class="comment">            // are ALREADY removed from the Inbox, BEFORE THIS FUNCTION IS EVEN CALLED... And THAT&#39;s why I don&#39;t</span>
<span class="comment">            // see the other things here that I would expect to see.</span>
<span class="comment">            //</span>
<span class="comment">            // Therefore, the above fix really needs to be MOVED to THAT LOCATION.</span>
<span class="comment">            // </span>
<span class="comment">            // FINAL NOTE: THAT IS CORRECT. (Done.) This function is meant to be called with the inbox SET UP PRIOR,</span>
<span class="comment">            // and for that Inbox to be passed in resembling the way it would in the event of success. This </span>
<span class="comment">            // function is NOT responsible for knowing about which kinds of transactions might need which numbers</span>
<span class="comment">            // removed. This function is too &quot;Dumb&quot; for that, at its level. It must assume the CALLER sets that up</span>
<span class="comment">            // in advance. Different callers set the inbox up in different ways, depending on what they are trying</span>
<span class="comment">            // to verify. (An &quot;accept basket receipt&quot; message would assume THAT basket receipt would be removed from Inbox,</span>
<span class="comment">            // whereas an &quot;accept market receipt&quot; message would assume that THAT market receipt would be removed. Etc.)</span>
<span class="comment">        }</span>
<span class="comment">    }</span>
<span class="comment">    */</span>
    
    <span class="comment">// -----------------------------------------------------------</span>
    
    <span class="comment">// the item will represent THIS TRANSACTION, and will be added to theBalanceItem.</span>
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pReportItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*<span class="keyword">this</span>, theItemType);
    
    <span class="keywordflow">if</span> (NULL != pReportItem) <span class="comment">// above line will assert if mem allocation fails.</span>
    {       
        int64_t lAmount = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
        pReportItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount);
        
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">// Just making sure these both get set.</span>
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()); <span class="comment">// Especially this one.</span>
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
        
        <span class="comment">// The &quot;closing transaction number&quot; is only used on finalReceipts and basketReceipts.</span>
        <span class="comment">// FYI, Any cron receipts need to see if there is a corresponding final receipt before checking</span>
        <span class="comment">// their transaction number for validity (since it changes that number)... and also, if the final</span>
        <span class="comment">// receipt itself is present, then ALL of the cron receipts that it corresponds to must be closed!</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>))
            pReportItem-&gt;<a class="code" href="class_o_t_item.html#ac32063404467c6754fd61727293d6b63">SetClosingNum</a>(<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>());
            
        theBalanceItem.<a class="code" href="class_o_t_item.html#aeb2726026df1021187b12ba760a91c2f">AddItem</a>(*pReportItem); <span class="comment">// Now theBalanceItem will handle cleaning it up.</span>
        
        <span class="comment">// No need to sign/save pReportItem, since it is just used for in-memory storage, and is</span>
        <span class="comment">// otherwise saved as part of its owner&#39;s data, as part of its owner. (As long as theBalanceItem</span>
        <span class="comment">// is signed and saved, which the caller does, then we&#39;re fine.)</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1820ab7e64e5cd46baf19f21ce2f0bf0"></a><!-- doxytag: member="OTTransaction::ProduceOutboxReportItem" ref="a1820ab7e64e5cd46baf19f21ce2f0bf0" args="(OTItem &amp;theBalanceItem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a1820ab7e64e5cd46baf19f21ce2f0bf0">OTTransaction::ProduceOutboxReportItem</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_item.html">OTItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theBalanceItem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05853">5853</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{   
    <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a417077fa11eb89c00074c64eb4e13c91">OTItem::error_state</a>;
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:
            theItemType = <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for outbox reports.</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;ProduceOutboxReportItem: Error, wrong item type. Returning.\n&quot;</span>);
            <span class="keywordflow">return</span>;
    }
    
    <span class="comment">// the item will represent THIS TRANSACTION, and will be added to theBalanceItem.</span>
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pReportItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*<span class="keyword">this</span>, theItemType);
    
    <span class="keywordflow">if</span> (NULL != pReportItem) <span class="comment">// above line will assert if mem allocation fails.</span>
    {
        <span class="comment">// I get away with &quot;carte blanche&quot; multiplying it by -1 here, because I&#39;ve</span>
        <span class="comment">// already verified that this is ONLY an OTTransaction::transfer before even</span>
        <span class="comment">// getting this far. There is no other transaction type that I even have to </span>
        <span class="comment">// worry about.</span>
        <span class="keyword">const</span> int64_t lAmount = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>()*(-1); <span class="comment">// in outbox, a transfer is leaving my account. Balance gets smaller.</span>
        pReportItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount);
        
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ae040aebddfa217a4fe5e349804f241e3">SetTransactionNum</a>(<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()); <span class="comment">// Just making sure these both get set.</span>
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()); <span class="comment">// Especially this one.</span>
        pReportItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());

        theBalanceItem.<a class="code" href="class_o_t_item.html#aeb2726026df1021187b12ba760a91c2f">AddItem</a>(*pReportItem); <span class="comment">// Now theBalanceItem will handle cleaning it up.</span>
        
        
        <span class="comment">// debugging remove this</span>
<span class="comment">//      OTLog::vError(&quot;PRODUCING OUTBOX REPORT ITEM: lAmount: %lld  Trans# %lld  Ref# %lld \n&quot;, lAmount,</span>
<span class="comment">//                    pReportItem-&gt;GetTransactionNum(), pReportItem-&gt;GetReferenceToNum());</span>
        
        <span class="comment">// No need to sign/save pReportItem, since it is just used for in-memory storage, and is</span>
        <span class="comment">// otherwise saved as part of its owner&#39;s data, as part of its owner. (As long as theBalanceItem</span>
        <span class="comment">// is signed and saved, which the caller does, then we&#39;re fine.)</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4f9c8be70e01dfcd7bedbac7d6af887b"></a><!-- doxytag: member="OTTransaction::Release" ref="a4f9c8be70e01dfcd7bedbac7d6af887b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a4f9c8be70e01dfcd7bedbac7d6af887b">OTTransaction::Release</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#aeec55f5abb43646745a532bf10aece24">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03667">3667</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html#a6548cbe73252c7554db6f6ceddebc5ae">Release_Transaction</a>();
    <span class="comment">// --------------------</span>
    <a class="code" href="class_o_t_transaction_type.html#aeec55f5abb43646745a532bf10aece24">ot_super::Release</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6548cbe73252c7554db6f6ceddebc5ae"></a><!-- doxytag: member="OTTransaction::Release_Transaction" ref="a6548cbe73252c7554db6f6ceddebc5ae" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a6548cbe73252c7554db6f6ceddebc5ae">OTTransaction::Release_Transaction</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03675">3675</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// (Any other dynamically allocated memory is freed here.)</span>
    
    <a class="code" href="class_o_t_transaction.html#af729ee60ed39ff6f918873aedfc7a0af">ReleaseItems</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af729ee60ed39ff6f918873aedfc7a0af"></a><!-- doxytag: member="OTTransaction::ReleaseItems" ref="af729ee60ed39ff6f918873aedfc7a0af" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#af729ee60ed39ff6f918873aedfc7a0af">OTTransaction::ReleaseItems</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03653">3653</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = NULL;
    
    <span class="keywordflow">while</span> (!<a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.empty())
    {
        pItem = <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.front();
        <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>.pop_front();
        <span class="keyword">delete</span> pItem;
        pItem = NULL;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af73fe383da8254ef5cd2c8a27de79a29"></a><!-- doxytag: member="OTTransaction::SaveAbbrevExpiredBoxRecord" ref="af73fe383da8254ef5cd2c8a27de79a29" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#af73fe383da8254ef5cd2c8a27de79a29">OTTransaction::SaveAbbrevExpiredBoxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04915">4915</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lDisplayValue = 0;
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="comment">// ******************************************</span>
        <span class="comment">// PAYMENT INBOX / PAYMENT OUTBOX</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">else</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">else</span>
                lDisplayValue   = 0;
            <span class="keywordflow">break</span>;              
        <span class="comment">// ******************************************</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>:         <span class="comment">// A notice from the server. Used in Nymbox. Probably contains an updated smart contract.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())            <span class="comment">// not the actual value of 0.</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">else</span>
                lDisplayValue   = 0;
            <span class="keywordflow">break</span>;
        <span class="comment">// ******************************************</span>
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for inbox reports</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unexpected %s transaction &quot;</span>
                           <span class="stringliteral">&quot;in expired box while making abbreviated expired-box record.\n&quot;</span>,
                          __FUNCTION__, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTTransaction::SaveAbbrevExpiredBoxRecord: Unexpected transaction type.&quot;</span>);

        }
            <span class="keywordflow">return</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the expired box, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">/*</span>
<span class="comment">     NOTES...</span>
<span class="comment">     </span>
<span class="comment">     transactionType        m_Type;             // instrumentNotice</span>
<span class="comment">     time64_t                   m_DATE_SIGNED;      // The date, in seconds, when the instrument was last signed.</span>
<span class="comment">     OTIdentifier           m_Hash;             // Created while saving abbreviated record, loaded back with it, then verified against actual hash when loading actual box receipt.</span>
<span class="comment">     int64_t                    m_lAbbrevAmount;    // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lDisplayAmount;   // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lTransactionNum;  // The server issues this and it must be sent with transaction request.</span>
<span class="comment">     int64_t                    m_lInReferenceToTransaction; </span>
<span class="comment">     int64_t                    m_lInRefDisplay</span>
<span class="comment">     */</span>
    <span class="comment">/*  This is set upon loading in abbreviated form, and then cleared again </span>
<span class="comment">        when the actual box receipt is loaded:</span>
<span class="comment">     bool               m_bIsAbbreviated;   // this is set upon loading (Not stored at all.)</span>
<span class="comment">     */</span>
    
    strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;expiredBoxRecord type=\&quot;%s\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                          strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                          lDateSigned, 
                          strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                          lDisplayValue,
                          <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                          <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                          <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab15380c235814aeb89779fb5f42401d4"></a><!-- doxytag: member="OTTransaction::SaveAbbreviatedInboxRecord" ref="ab15380c235814aeb89779fb5f42401d4" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#ab15380c235814aeb89779fb5f42401d4">OTTransaction::SaveAbbreviatedInboxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05524">5524</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// This is the actual amount that your account is changed BY this receipt.</span>
    <span class="comment">// Versus the useful amount the user will want to see (lDisplayValue.) For example, if you perform</span>
    <span class="comment">// a transfer of 500 clams, then the money leaves your account at that time, and you receive a transaction receipt</span>
    <span class="comment">// to that effect. LATER ON, when the recipient ACCEPTS the transfer, a &quot;transferReceipt&quot; will pop into your inbox,</span>
    <span class="comment">// which you must accept in order to close out the transaction number. But this transferReceipt &quot;adjusts&quot; your account</span>
    <span class="comment">// by ZERO, since the amount has ALREADY left your account before the transferReceipt arrived. In that example, the</span>
    <span class="comment">// lAdjustment would be 0, while the lDisplayValue would be 500. The first value is the actual impact on your balance</span>
    <span class="comment">// from that specific receipt, whereas the second value is the one that the user probably wants to see.</span>
    
    <span class="comment">// NOTE: A similar logic envelops the GetReferenceNumForDisplay() field, which, instead of returning the ACTUAL</span>
    <span class="comment">// ref# that OT needs to use, it will return the one that the user probably wants to see.   </span>
    <span class="comment">//</span>
    int64_t lAdjustment = 0, lDisplayValue = 0;
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
            <span class="comment">// -- In inbox, pending hasn&#39;t been accepted yet. In outbox, it&#39;s already gone. Either</span>
            <span class="comment">// way, it will have a 0 adjustment amount, even though perhaps 500 clams display amount. Here I use the 500</span>
            <span class="comment">// for display, but in SaveAbbrevToOutbox, I multiply it by -1 so it appears as -500 (leaving my account.)</span>
            <span class="comment">// -- In my inbox, the transferReceipt is notice of money that is already gone. It thus has adjustment value of 0.</span>
            <span class="comment">// But the DISPLAY amount is the amount I originally sent. (Already multiplied by -1 by GetReceiptAmount())</span>
            <span class="comment">//</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:            <span class="comment">// (The pending amount is stored on the transfer item in my list of transaction items.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:    <span class="comment">// The transferReceipt and voucherReceipt amounts are the display value (according to</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:     <span class="comment">// GetReceiptAmount()), and not the actual value of 0.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;                
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
            }
            <span class="keywordflow">break</span>;
            <span class="comment">// If chequeReceipt for 100 clams hit my inbox, then my balance is -100 from where it was. (Same</span>
            <span class="comment">// value should be displayed.) Luckily, GetReceiptAmount() already multiplies by (-1) for chequeReceipt.</span>
            <span class="comment">// For these (marketReceipt, paymentReceipt, basketReceipt), the actual adjustment is positive OR negative</span>
            <span class="comment">// already, and the display value should match.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:      <span class="comment">// the amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:      <span class="comment">// amount is stored on marketReceipt item.  | </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:     <span class="comment">// amount is stored on paymentReceipt item. | and the display value should match.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:      <span class="comment">// amount is stored on basketReceipt item.  | </span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();   
                lDisplayValue   = lAdjustment;          
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:       <span class="comment">// amount is 0 according to GetReceiptAmount()</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = 0;
            }                
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for inbox reports</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unexpected %s transaction &quot;</span>
                           <span class="stringliteral">&quot;in inbox while making abbreviated inbox record.\n&quot;</span>,
                          __FUNCTION__, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTTransaction::SaveAbbreviatedInboxRecord: unexpected transaction type.&quot;</span>);
            
        }
            <span class="keywordflow">return</span>;
    }   <span class="comment">// why not transfer receipt? Because the amount was already removed from your account when you transferred it,</span>

    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the inbox, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">/* </span>
<span class="comment">     NOTES...</span>
<span class="comment">     </span>
<span class="comment">     transactionType        m_Type;             // blank, pending, processInbox, transfer, deposit, withdrawal, payDividend, trade, etc.</span>
<span class="comment">     time64_t                   m_DATE_SIGNED;      // The date, in seconds, when the instrument was last signed.</span>
<span class="comment">     OTIdentifier           m_Hash;             // Created while saving abbreviated record, loaded back with it, then verified against actual hash when loading actual box receipt.</span>
<span class="comment">     int64_t                    m_lAbbrevAmount;    // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lDisplayAmount;   // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lTransactionNum;  // The server issues this and it must be sent with transaction request.</span>
<span class="comment">     int64_t                    m_lClosingTransactionNo; // used by finalReceipt</span>
<span class="comment">     int64_t                    m_lInReferenceToTransaction; </span>
<span class="comment">     int64_t                    m_lInRefDisplay</span>
<span class="comment">     */</span>
    <span class="comment">/*  This is set upon loading in abbreviated form, and then cleared again </span>
<span class="comment">        when the actual box receipt is loaded:</span>
<span class="comment">     bool               m_bIsAbbreviated;   // this is set upon loading (Not stored at all.)</span>
<span class="comment">     */</span>
    
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || 
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>))
        <span class="comment">// ---------------------------</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;inboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; closingNum=\&quot;%lld\&quot;\n&quot;</span>  <span class="comment">// &lt;==========</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                              lAdjustment,
                              lDisplayValue,
                              <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>(),          <span class="comment">// &lt;==========</span>
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
    <span class="keywordflow">else</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;inboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                              lAdjustment,
                              lDisplayValue,
                              <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="add17ff12beaf8f0ba84b73b6b564f5b0"></a><!-- doxytag: member="OTTransaction::SaveAbbreviatedNymboxRecord" ref="add17ff12beaf8f0ba84b73b6b564f5b0" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#add17ff12beaf8f0ba84b73b6b564f5b0">OTTransaction::SaveAbbreviatedNymboxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05328">5328</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lDisplayValue = 0;
    <span class="comment">// ----------------------------------------------    </span>
    <a class="code" href="class_o_t_string.html">OTString</a> strDisplayValue;   <span class="comment">// IF this transaction is passing through on its way to the paymentInbox, it will have a displayValue.</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strListOfBlanks;   <span class="comment">// IF this transaction is &quot;blank&quot; or &quot;successNotice&quot; this will serialize the list of transaction numbers for it. (They now support multiple numbers.)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strRequestNum;     <span class="comment">// ONLY replyNotice transactions carry a request Num.</span>
    
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">OTTransaction::blank</a>:          <span class="comment">// freshly issued transaction number, not accepted by the user (yet).</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>:  <span class="comment">// A transaction # has successfully been signed out.</span>
        {
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0) <span class="comment">// This is always 0, except for blanks and successNotices.</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNumbers;
                <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strNumbers)) 
                    strListOfBlanks.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; totalListOfNumbers=\&quot;%s\&quot;\n&quot;</span>, strNumbers.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="keywordflow">else</span> <span class="comment">// (False just means it was empty.)</span>
                    strListOfBlanks.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;&quot;</span>);                    
            }
        }
            <span class="comment">/* ! CONTINUES FALLING THROUGH HERE!!... */</span>
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a>:    <span class="comment">// A copy of a server reply to a previous request you sent. (To make SURE you get the reply.)</span>
            strRequestNum.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; requestNumber=\&quot;%lld\&quot;\n transSuccess=\&quot;%s\&quot;\n&quot;</span>,
                                 <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>, <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9505edb62ffb5da2972221c2663af52f">OTTransaction::message</a>:        <span class="comment">// A message from one user to another, also in the nymbox.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>:         <span class="comment">// A notice from the server. Used in Nymbox. Probably contains an updated smart contract.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:   <span class="comment">// Any finalReceipt in an inbox will also drop a copy into the Nymbox.</span>
            <span class="keywordflow">break</span>;                          
            <span class="comment">// ------------</span>
            <span class="comment">// paymentInbox items are transported through the Nymbox.</span>
            <span class="comment">// Therefore, this switch statement from SaveAbbrevPaymentInbox</span>
            <span class="comment">// is also found here, to handle those receipts as they pass through.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:       <span class="comment">// A financial instrument sent from/to another nym.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">else</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();            
            strDisplayValue.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>, lDisplayValue);
            <span class="keywordflow">break</span>;                          <span class="comment">// (These last two are just passing through, on their way to the paymentInbox.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>:    <span class="comment">// A rejection notice from the intended recipient of an instrumentNotice.</span>
                lDisplayValue   = 0;                
            <span class="keywordflow">break</span>;                          
            <span class="comment">// ------------</span>
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for nymbox reports.</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unexpected %s transaction in nymbox while making abbreviated nymbox record.\n&quot;</span>,
                          __FUNCTION__, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTTransaction::SaveAbbreviatedNymboxRecord: Unexpected transaction in this Nymbox.&quot;</span>);
            
            <span class="keywordflow">return</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the inbox, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || 
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>)) <span class="comment">// I actually don&#39;t think you can put a basket receipt notice in a nymbox, the way you can with a final receipt notice. Probably can remove this line.</span>
        <span class="comment">// ---------------------------</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;nymboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; closingNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),              
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
    <span class="comment">// -----------------------------</span>
    <span class="keywordflow">else</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;nymboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n%s&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n%s&quot;</span>     <span class="comment">// SOMETIMES this is added here by the final %s: &quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n%s&quot;</span> <span class="comment">// SOMETIMES this is added here by the final %s: &quot; totalListOfNumbers=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned,          strRequestNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),        strDisplayValue.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),    
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),  strListOfBlanks.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0ea6c7483a961acfdef55cd992e4065d"></a><!-- doxytag: member="OTTransaction::SaveAbbreviatedOutboxRecord" ref="a0ea6c7483a961acfdef55cd992e4065d" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a0ea6c7483a961acfdef55cd992e4065d">OTTransaction::SaveAbbreviatedOutboxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05447">5447</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lAdjustment = 0, lDisplayValue = 0;

    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;            <span class="comment">// In the inbox, a pending hasn&#39;t been accepted yet. </span>
                lDisplayValue   =               <span class="comment">//  In the outbox, it&#39;s already gone.</span>
                    (<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>()*(-1));  <span class="comment">// Either way, it will have a 0 adjustment amount, even though perhaps 500 clams display amount.</span>
            }
            <span class="keywordflow">break</span>;                          <span class="comment">// In this case, since it&#39;s the outbox, then it&#39;s a MINUS (-500) Display amount (since I&#39;m sending, not receiving it.)</span>
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for outbox reports.</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::SaveAbbreviatedOutboxRecord: Unexpected %s transaction &quot;</span>
                          <span class="stringliteral">&quot;in outbox while making abbreviated outbox record.\n&quot;</span>, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTTransaction::SaveAbbreviatedOutboxRecord: unexpected transaction type.&quot;</span>);
            
            <span class="keywordflow">return</span>;
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the inbox, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;outboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                          <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                          strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                          lDateSigned, 
                          strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                          lAdjustment,
                          lDisplayValue,
                          <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                          <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                          <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                          <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac30eb05906f92766b5ce895854e682a3"></a><!-- doxytag: member="OTTransaction::SaveAbbrevPaymentInboxRecord" ref="ac30eb05906f92766b5ce895854e682a3" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#ac30eb05906f92766b5ce895854e682a3">OTTransaction::SaveAbbrevPaymentInboxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04825">4825</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lDisplayValue = 0;
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>()) 
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">else</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for payment inbox reports</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unexpected %s transaction &quot;</span>
                           <span class="stringliteral">&quot;in payment inbox while making abbreviated payment inbox record.\n&quot;</span>,
                          __FUNCTION__, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            
            <a class="code" href="_o_t_assert_8hpp.html#aa86aeed4e57eecded96d5955b5cc23c5">OT_FAIL_MSG</a>(<span class="stringliteral">&quot;ASSERT: OTTransaction::SaveAbbrevPaymentInboxRecord: Unexpected transaction type.&quot;</span>);
            
            <span class="keywordflow">return</span>;
    }

    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the payment inbox, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">/* </span>
<span class="comment">     NOTES...</span>
<span class="comment">     </span>
<span class="comment">     transactionType        m_Type;             // blank, pending, processInbox, transfer, deposit, withdrawal, payDividend, trade, etc.</span>
<span class="comment">     time64_t                   m_DATE_SIGNED;      // The date, in seconds, when the instrument was last signed.</span>
<span class="comment">     OTIdentifier           m_Hash;             // Created while saving abbreviated record, loaded back with it, then verified against actual hash when loading actual box receipt.</span>
<span class="comment">     int64_t                    m_lAbbrevAmount;    // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lDisplayAmount;   // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lTransactionNum;  // The server issues this and it must be sent with transaction request.</span>
<span class="comment">     int64_t                    m_lClosingTransactionNo; // used by finalReceipt</span>
<span class="comment">     int64_t                    m_lInReferenceToTransaction; </span>
<span class="comment">     int64_t                    m_lInRefDisplay</span>
<span class="comment">     */</span>
    <span class="comment">/*  This is set upon loading in abbreviated form, and then cleared again </span>
<span class="comment">        when the actual box receipt is loaded:</span>
<span class="comment">     bool               m_bIsAbbreviated;   // this is set upon loading (Not stored at all.)</span>
<span class="comment">     */</span>
    
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;paymentInboxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                              lDisplayValue,
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08424e75b8906896335609d7ca45c729"></a><!-- doxytag: member="OTTransaction::SaveAbbrevRecordBoxRecord" ref="a08424e75b8906896335609d7ca45c729" args="(OTString &amp;strOutput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a08424e75b8906896335609d7ca45c729">OTTransaction::SaveAbbrevRecordBoxRecord</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOutput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l05117">5117</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Have some kind of check in here, whether the AcctID and UserID match.</span>
    <span class="comment">// Some recordBoxes DO, and some DON&#39;T (the different kinds store different</span>
    <span class="comment">// kinds of receipts. See above comment.)</span>
    
    int64_t lAdjustment = 0, lDisplayValue = 0;
    <span class="comment">// ----------------------------------------------</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
            <span class="comment">// ******************************************</span>
            <span class="comment">// ASSET ACCOUNT INBOX</span>
            <span class="comment">// -- In inbox, pending hasn&#39;t been accepted yet. In outbox, it&#39;s already gone. Either</span>
            <span class="comment">// way, it will have a 0 adjustment amount, even though perhaps 500 clams display amount. Here I use the 500</span>
            <span class="comment">// for display, but in SaveAbbrevToOutbox, I multiply it by -1 so it appears as -500 (leaving my account.)</span>
            <span class="comment">// -- In my inbox, the transferReceipt is notice of money that is already gone. It thus has adjustment value of 0.</span>
            <span class="comment">// But the DISPLAY amount is the amount I originally sent. (Already multiplied by -1 by GetReceiptAmount())</span>
            <span class="comment">//</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:            <span class="comment">// (The pending amount is stored on the transfer item in my list of transaction items.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:    <span class="comment">// The transferReceipt and voucherReceipt amounts are the display value (according to</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:     <span class="comment">// GetReceiptAmount()), and not the actual value of 0.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(); 
            }
            <span class="keywordflow">break</span>;
            <span class="comment">// If chequeReceipt for 100 clams hit my inbox, then my balance is -100 from where it was. (Same</span>
            <span class="comment">// value should be displayed.) Luckily, GetReceiptAmount() already multiplies by (-1) for chequeReceipt.</span>
            <span class="comment">// For these (marketReceipt, paymentReceipt, basketReceipt), the actual adjustment is positive OR negative</span>
            <span class="comment">// already, and the display value should match.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:      <span class="comment">// the amount is stored on cheque (attached to depositCheque item, attached.)</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:      <span class="comment">// amount is stored on marketReceipt item.  | </span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:     <span class="comment">// amount is stored on paymentReceipt item. | and the display value should match.</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:      <span class="comment">// amount is stored on basketReceipt item.  | </span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();   
                lDisplayValue   = lAdjustment;          
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:       <span class="comment">// amount is 0 according to GetReceiptAmount()</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = 0;
            }
            <span class="keywordflow">break</span>;
        <span class="comment">// ******************************************</span>
        <span class="comment">// NYMBOX</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a34ed13120f604fbf41954473bfd896da">OTTransaction::notice</a>:         <span class="comment">// A notice from the server. Used in Nymbox. Probably contains an updated smart contract.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())            <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = 0;
            }
            <span class="keywordflow">break</span>;              
        <span class="comment">// ******************************************</span>
        <span class="comment">// PAYMENT INBOX / PAYMENT OUTBOX</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3bb6c95074edec038831f5282423163f">OTTransaction::instrumentNotice</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a47605348be0f35786bececebacd7170b">OTTransaction::instrumentRejection</a>:
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())                <span class="comment">// not the actual value of 0.</span>
            {
                lAdjustment     = <a class="code" href="class_o_t_transaction.html#a26f3f7cf81e9b5fdd2c66646713a4e95">GetAbbrevAdjustment</a>();
                lDisplayValue   = <a class="code" href="class_o_t_transaction.html#a9ef2e2e40960239f6cbd0d1c1ded42f4">GetAbbrevDisplayAmount</a>();
            }
            <span class="keywordflow">else</span>
            {
                lAdjustment     = 0;
                lDisplayValue   = 0; 
            }
            <span class="keywordflow">break</span>;              
        <span class="comment">// ******************************************</span>
        <span class="keywordflow">default</span>: <span class="comment">// All other types are irrelevant for inbox reports</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::SaveAbbrevRecordBoxRecord: Unexpected %s transaction &quot;</span>
                           <span class="stringliteral">&quot;in record box while making abbreviated record-box record.\n&quot;</span>, <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
        }
            <span class="keywordflow">return</span>;
    }   <span class="comment">// why not transfer receipt? Because the amount was already removed from your account when you transferred it,</span>

    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// By this point, we know only the right types of receipts are being saved, and </span>
    <span class="comment">// the adjustment and display value are both set correctly.</span>
    
    <span class="comment">// TYPE</span>
    <a class="code" href="class_o_t_string.html">OTString</a>        strType;    <span class="comment">// &lt;===========</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *    pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
    strType.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// DATE SIGNED</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">// HASH OF THE COMPLETE &quot;BOX RECEIPT&quot;</span>
    <span class="comment">// Save abbreviated is only used for receipts in boxes such as inbox, outbox, and nymbox.</span>
    <span class="comment">// (Thus the moniker &quot;Box Receipt&quot;, as contrasted with cron receipts or normal transaction receipts with balance agreements.)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strHash;
    
    <span class="comment">// If this is already an abbreviated record, then save the existing hash.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        <a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a>.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    <span class="comment">// Otherwise if it&#39;s a full record, then calculate the hash and save it.</span>
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    idReceiptHash;              <span class="comment">// a hash of the actual transaction is stored with its</span>
        this-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idReceiptHash);   <span class="comment">// abbreviated short-form record (in the record box, for example.)</span>
        idReceiptHash.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strHash);
    }
    <span class="comment">// ----------------------------------------------</span>
    <span class="comment">/* </span>
<span class="comment">     NOTES...</span>
<span class="comment">     </span>
<span class="comment">     transactionType        m_Type;             // pending, processInbox, transfer, deposit, withdrawal, payDividend, trade, etc.</span>
<span class="comment">     time64_t                   m_DATE_SIGNED;      // The date, in seconds, when the instrument was last signed.</span>
<span class="comment">     OTIdentifier           m_Hash;             // Created while saving abbreviated record, loaded back with it, then verified against actual hash when loading actual box receipt.</span>
<span class="comment">     int64_t                    m_lAbbrevAmount;    // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lDisplayAmount;   // Saved abbreviated from actual calculation, and set upon loading in abbrev mode.</span>
<span class="comment">     int64_t                    m_lTransactionNum;  // The server issues this and it must be sent with transaction request.</span>
<span class="comment">     int64_t                    m_lClosingTransactionNo; // used by finalReceipt</span>
<span class="comment">     int64_t                    m_lInReferenceToTransaction; </span>
<span class="comment">     int64_t                    m_lInRefDisplay</span>
<span class="comment">     */</span>
    <span class="comment">/*  This is set upon loading in abbreviated form, and then cleared again </span>
<span class="comment">        when the actual box receipt is loaded:</span>
<span class="comment">     bool               m_bIsAbbreviated;   // this is set upon loading (Not stored at all.)</span>
<span class="comment">     */</span>
    
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) || 
        (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>))
        <span class="comment">// ---------------------------</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;recordBoxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; closingNum=\&quot;%lld\&quot;\n&quot;</span>  <span class="comment">// &lt;==========</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                              lAdjustment,
                              lDisplayValue,
                              <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>(),          <span class="comment">// &lt;==========</span>
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
    <span class="keywordflow">else</span>
        strOutput.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;recordBoxRecord type=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; receiptHash=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; adjustment=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; displayValue=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inRefDisplay=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; /&gt;\n\n&quot;</span>, 
                              strType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                              lDateSigned, 
                              strHash.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),                          
                              lAdjustment,
                              lDisplayValue,
                              <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                              <a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f991feb7c6178ffabefc7fef312d26e"></a><!-- doxytag: member="OTTransaction::SaveBoxReceipt" ref="a2f991feb7c6178ffabefc7fef312d26e" args="(const int64_t lLedgerType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">OTTransaction::SaveBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lLedgerType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03003">3003</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// ---------------------------------</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to save box receipt %lld: &quot;</span>
                       <span class="stringliteral">&quot;This transaction is the abbreviated version (box receipt is supposed to &quot;</span>
                       <span class="stringliteral">&quot;consist of the full version, so we can&#39;t save THIS as the box receipt.)\n&quot;</span>,
                       __FUNCTION__, <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------------------------- </span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFolder1name, strFolder2name, strFolder3name, strFilename;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(lLedgerType, *<span class="keyword">this</span>, 
                                                        <span class="stringliteral">&quot;OTTransaction::SaveBoxReceipt&quot;</span>,
                                                        strFolder1name, strFolder2name, strFolder3name,
                                                        strFilename))
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// This already logs -- no need to log twice, here.</span>
    <span class="comment">// -------------------------------------------------------------------- </span>
    <span class="comment">// See if the box receipt exists before trying to save over it...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Warning -- Box receipt already exists! (Overwriting)&quot;</span>
                       <span class="stringliteral">&quot;At location: %s%s%s%s%s%s%s\n&quot;</span>, __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                       strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                       strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<span class="comment">//      return false;</span>
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// Try to save the box receipt to local storage.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>);
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error saving box receipt (failed writing armored string):\n%s%s%s%s%s%s%s\n&quot;</span>, 
                      __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    
    <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                         strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                         strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()); 
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSaved)
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error writing file: %s%s%s%s%s%s%s\nContents:\n\n%s\n\n&quot;</span>, 
                      __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), 
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> bSaved;  
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad755606f8f828547f3ddbd78fe370b30"></a><!-- doxytag: member="OTTransaction::SaveBoxReceipt" ref="ad755606f8f828547f3ddbd78fe370b30" args="(OTLedger &amp;theLedger)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">OTTransaction::SaveBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theLedger</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03224">3224</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lLedgerType = 0;
    
    <span class="keywordflow">switch</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>()) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          lLedgerType = 0;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           lLedgerType = 1;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          lLedgerType = 2;    <span class="keywordflow">break</span>;
<span class="comment">//      case OTLedger::message:         lLedgerType = 3;    break;</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    lLedgerType = 4;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       lLedgerType = 5;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      lLedgerType = 6;    <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::SaveBoxReceipt: Error: unknown box type. &quot;</span>
                         <span class="stringliteral">&quot;(This should never happen.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(lLedgerType);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23e270a9dfc3b85d48d64582814232e5"></a><!-- doxytag: member="OTTransaction::SaveContractWallet" ref="a23e270a9dfc3b85d48d64582814232e5" args="(std::ofstream &amp;ofs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a23e270a9dfc3b85d48d64582814232e5">OTTransaction::SaveContractWallet</a> </td>
          <td>(</td>
          <td class="paramtype">std::ofstream &amp;&#160;</td>
          <td class="paramname"><em>ofs</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#abd60f993ccc74387236943cd4209f72e">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03641">3641</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa068df53b397fd48fe4af07910eeb86d"></a><!-- doxytag: member="OTTransaction::SetAbbrevAdjustment" ref="aa068df53b397fd48fe4af07910eeb86d" args="(const int64_t lAmount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#aa068df53b397fd48fe4af07910eeb86d">OTTransaction::SetAbbrevAdjustment</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lAmount</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00589">589</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">m_lAbbrevAmount</a> = lAmount; }
</pre></div>
</div>
</div>
<a class="anchor" id="a93386652206ed5d439ed03abf9798d92"></a><!-- doxytag: member="OTTransaction::SetAbbrevDisplayAmount" ref="a93386652206ed5d439ed03abf9798d92" args="(const int64_t lAmount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a93386652206ed5d439ed03abf9798d92">OTTransaction::SetAbbrevDisplayAmount</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lAmount</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00592">592</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">m_lDisplayAmount</a> = lAmount; }
</pre></div>
</div>
</div>
<a class="anchor" id="a46dc320ee8a88d5a647c014a1cdbbd65"></a><!-- doxytag: member="OTTransaction::SetAbbrevInRefDisplay" ref="a46dc320ee8a88d5a647c014a1cdbbd65" args="(const int64_t lAmount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a46dc320ee8a88d5a647c014a1cdbbd65">OTTransaction::SetAbbrevInRefDisplay</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lAmount</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00595">595</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">m_lInRefDisplay</a> = lAmount; }
</pre></div>
</div>
</div>
<a class="anchor" id="a897714409d64aefd879ea08ec2e1731a"></a><!-- doxytag: member="OTTransaction::SetAsCancelled" ref="a897714409d64aefd879ea08ec2e1731a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT void <a class="el" href="class_o_t_transaction.html#a897714409d64aefd879ea08ec2e1731a">OTTransaction::SetAsCancelled</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00562">562</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a> = <span class="keyword">true</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="af3c025bbdeb70a053c6149a32d8b9940"></a><!-- doxytag: member="OTTransaction::SetClosingNum" ref="af3c025bbdeb70a053c6149a32d8b9940" args="(const int64_t lClosingNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#af3c025bbdeb70a053c6149a32d8b9940">OTTransaction::SetClosingNum</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lClosingNum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00224">224</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a> = lClosingNum;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aceb0b4c83da5f50512bf6045fef6583b"></a><!-- doxytag: member="OTTransaction::SetParent" ref="aceb0b4c83da5f50512bf6045fef6583b" args="(const OTLedger &amp;theParent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#aceb0b4c83da5f50512bf6045fef6583b">OTTransaction::SetParent</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theParent</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00564">564</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a> = &amp;theParent; } <span class="comment">// a pointer of convenience.</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a3099413a51aa3ec99b783a4e89144150"></a><!-- doxytag: member="OTTransaction::SetReplyTransSuccess" ref="a3099413a51aa3ec99b783a4e89144150" args="(const bool bVal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a3099413a51aa3ec99b783a4e89144150">OTTransaction::SetReplyTransSuccess</a> </td>
          <td>(</td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bVal</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00604">604</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{  <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a> = bVal;  }
</pre></div>
</div>
</div>
<a class="anchor" id="a8db20f109eab5bf715673bfcf3b3bb4f"></a><!-- doxytag: member="OTTransaction::SetRequestNum" ref="a8db20f109eab5bf715673bfcf3b3bb4f" args="(const int64_t &amp;lNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a8db20f109eab5bf715673bfcf3b3bb4f">OTTransaction::SetRequestNum</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNum</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00601">601</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a> = lNum; }
</pre></div>
</div>
</div>
<a class="anchor" id="a12494b5a0460ce08f67033e0523caf97"></a><!-- doxytag: member="OTTransaction::SetType" ref="a12494b5a0460ce08f67033e0523caf97" args="(const transactionType theType)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a12494b5a0460ce08f67033e0523caf97">OTTransaction::SetType</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a>&#160;</td>
          <td class="paramname"><em>theType</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00671">671</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a> = theType; }
</pre></div>
</div>
</div>
<a class="anchor" id="a186d091553baa52c0d1e252b05432e4d"></a><!-- doxytag: member="OTTransaction::SetupBoxReceiptFilename" ref="a186d091553baa52c0d1e252b05432e4d" args="(const int64_t lLedgerType, OTTransaction &amp;theTransaction, const char *szCaller, OTString &amp;strFolder1name, OTString &amp;strFolder2name, OTString &amp;strFolder3name, OTString &amp;strFilename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lLedgerType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theTransaction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szCaller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder1name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder2name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder3name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFilename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l02871">2871</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strUserOrAcctID;
    theTransaction.<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strUserOrAcctID);
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>());
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(lLedgerType, strUserOrAcctID, strServerID,
                                                  theTransaction.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), szCaller,
                                                  strFolder1name, strFolder2name, strFolder3name,
                                                  strFilename);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a26ed98e266bb7462e2d5fc8609f3d60d"></a><!-- doxytag: member="OTTransaction::SetupBoxReceiptFilename" ref="a26ed98e266bb7462e2d5fc8609f3d60d" args="(OTLedger &amp;theLedger, OTTransaction &amp;theTransaction, const char *szCaller, OTString &amp;strFolder1name, OTString &amp;strFolder2name, OTString &amp;strFolder3name, OTString &amp;strFilename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_ledger.html">OTLedger</a> &amp;&#160;</td>
          <td class="paramname"><em>theLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theTransaction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szCaller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder1name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder2name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder3name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFilename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l02894">2894</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int64_t lLedgerType = 0;
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keywordflow">switch</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>()) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          lLedgerType = 0;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           lLedgerType = 1;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          lLedgerType = 2;    <span class="keywordflow">break</span>;
<span class="comment">//      case OTLedger::message:         lLedgerType = 3;    break;</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    lLedgerType = 4;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       lLedgerType = 5;    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      lLedgerType = 6;    <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s %s: Error: unknown box type. &quot;</span>
                          <span class="stringliteral">&quot;(This should never happen.)\n&quot;</span>, __FUNCTION__, szCaller);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(lLedgerType, theTransaction, szCaller,
                                                  strFolder1name, strFolder2name, strFolder3name,
                                                  strFilename);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a73b0080083ff18496554155dcdd5c197"></a><!-- doxytag: member="OTTransaction::SetupBoxReceiptFilename" ref="a73b0080083ff18496554155dcdd5c197" args="(const int64_t lLedgerType, const OTString &amp;strUserOrAcctID, const OTString &amp;strServerID, const int64_t &amp;lTransactionNum, const char *szCaller, OTString &amp;strFolder1name, OTString &amp;strFolder2name, OTString &amp;strFolder3name, OTString &amp;strFilename)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>lLedgerType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strUserOrAcctID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strServerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>szCaller</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder1name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder2name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFolder3name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strFilename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l02827">2827</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != szCaller);
    <span class="comment">// --------------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszFolder = NULL;  <span class="comment">// &quot;nymbox&quot; (or &quot;inbox&quot; or &quot;outbox&quot;)</span>
    <span class="keywordflow">switch</span> (lLedgerType) 
    {
        <span class="keywordflow">case</span> 0: pszFolder = <a class="code" href="class_o_t_folders.html#ada1729c82d6ebbfa53b16d511d2aded4">OTFolders::Nymbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> 1: pszFolder = <a class="code" href="class_o_t_folders.html#a6f314709ced53a8c542eb5ef53126b39">OTFolders::Inbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();           <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> 2: pszFolder = <a class="code" href="class_o_t_folders.html#af4ad3cfbb3030044148f03fd8020c41a">OTFolders::Outbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();          <span class="keywordflow">break</span>;
<span class="comment">//      case 3: (message ledger.)</span>
        <span class="keywordflow">case</span> 4: pszFolder = <a class="code" href="class_o_t_folders.html#a92fc938529eac80e1a040a664d844847">OTFolders::PaymentInbox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();    <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> 5: pszFolder = <a class="code" href="class_o_t_folders.html#a33b17e178549458a5fa7596dcf38adc6">OTFolders::RecordBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();       <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> 6: pszFolder = <a class="code" href="class_o_t_folders.html#a1dfba6274248dcc7cb910770635720f6">OTFolders::ExpiredBox</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();      <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s %s: Error: unknown box type: %lld. &quot;</span>
                          <span class="stringliteral">&quot;(This should never happen.)\n&quot;</span>, __FUNCTION__, szCaller, lLedgerType);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    strFolder1name.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(pszFolder);                          <span class="comment">// &quot;nymbox&quot; (or &quot;inbox&quot; or &quot;outbox&quot;)</span>
    strFolder2name.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(strServerID);                        <span class="comment">// &quot;SERVER_ID&quot;</span>
    strFolder3name.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s.r&quot;</span>, strUserOrAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());   <span class="comment">// &quot;USER_ID.r&quot;</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.rct&quot;</span>, lTransactionNum);            <span class="comment">// &quot;TRANSACTION_ID.rct&quot;</span>
    <span class="comment">// todo hardcoding of file extension. Need to standardize extensions.</span>
    
    <span class="comment">// Finished product:            &quot;nymbox/SERVER_ID/USER_ID.r/TRANSACTION_ID.rct&quot;</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;    
}
</pre></div>
</div>
</div>
<a class="anchor" id="a903a5b5d56e7f2856a51e2cdee6d511d"></a><!-- doxytag: member="OTTransaction::UpdateContents" ref="a903a5b5d56e7f2856a51e2cdee6d511d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_transaction.html#a903a5b5d56e7f2856a51e2cdee6d511d">OTTransaction::UpdateContents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_contract.html#a78c28164555e2eb79d6b67698421638d">OTContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l04642">4642</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strCancelled;
    
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">m_bCancelled</a>)
    {
        strCancelled.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; cancelled=\&quot;%s\&quot;\n&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
    }
    <span class="comment">// ----------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strListOfBlanks;   <span class="comment">// IF this transaction is &quot;blank&quot; or &quot;successNotice&quot; this will serialize the list of transaction numbers for it. (They now support multiple numbers.)</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strRequestNum;     <span class="comment">// Used by replyNotice only.</span>
    <span class="comment">// ----------------------------------------</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) 
    {
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a>:
            strRequestNum.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; requestNumber=\&quot;%lld\&quot;\n transSuccess=\&quot;%s\&quot;\n&quot;</span>,
                                 <a class="code" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">m_lRequestNumber</a>, <a class="code" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">m_bReplyTransSuccess</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);
            <span class="keywordflow">break</span>;
            
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad74c4b196dafbd9b1eacc19d825c6a3e">OTTransaction::blank</a>:          <span class="comment">// freshly issued transaction number, not accepted by the user (yet).</span>
        <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a52282952428acc861ea6c25a3839fcc9">OTTransaction::successNotice</a>:  <span class="comment">// A transaction # has successfully been signed out.</span>
        {
            <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0) <span class="comment">// This is always 0, except for blanks and successNotices.</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNumbers;
                <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_transaction_type.html#a6113532c4f9a2f1d8ca274e3975b6043">m_Numlist</a>.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strNumbers)) 
                    strListOfBlanks.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot; totalListOfNumbers=\&quot;%s\&quot;\n&quot;</span>, strNumbers.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
                <span class="keywordflow">else</span> <span class="comment">// (False just means m_Numlist was empty.)</span>
                    strListOfBlanks.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;&quot;</span>);                    
            }
        }
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pTypeStr = <a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>(); <span class="comment">// TYPE</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strType((NULL != pTypeStr) ? pTypeStr : <span class="stringliteral">&quot;error_state&quot;</span>), 
                    strAcctID(<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()), 
                    strServerID(<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()),
                    strUserID(<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>()); 
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a> = <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>(); <span class="comment">// We store the timestamp of when this transaction was signed.</span>
    <span class="keyword">const</span> int64_t lDateSigned = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">m_DATE_SIGNED</a>);
    <span class="comment">// -----------------------------------------------------    </span>
    <span class="comment">// I release this because I&#39;m about to repopulate it.</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;transaction type=\&quot;%s\&quot;\n%s&quot;</span>
                              <span class="stringliteral">&quot; dateSigned=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; accountID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; userID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; serverID=\&quot;%s\&quot;\n%s&quot;</span>
                              <span class="stringliteral">&quot; numberOfOrigin=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n%s&quot;</span>
                              <span class="stringliteral">&quot; inReferenceTo=\&quot;%lld\&quot; &gt;\n\n&quot;</span>, 
                              strType.Get(), strCancelled.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              lDateSigned,
                              strAcctID.Get(), 
                              strUserID.Get(), 
                              strServerID.Get(), strRequestNum.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), strListOfBlanks.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              <a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
    <span class="comment">// -----------------------------------------------------    </span>
    <span class="comment">//  OTLog::vError(&quot;IN REFERENCE TO, LENGTH: %d\n&quot;, m_ascInReferenceTo.GetLength());</span>
    
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <span class="keywordflow">if</span> (NULL != <a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>) {
        <span class="comment">// ----------------------------------</span>
        <span class="keywordflow">switch</span> (<a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>-&gt;<a class="code" href="class_o_t_ledger.html#a28fd8abcda98128b8610c825d73e0f55">GetType</a>())
        {
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>:          this-&gt;<a class="code" href="class_o_t_transaction.html#add17ff12beaf8f0ba84b73b6b564f5b0">SaveAbbreviatedNymboxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);   <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>:           this-&gt;<a class="code" href="class_o_t_transaction.html#ab15380c235814aeb89779fb5f42401d4">SaveAbbreviatedInboxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);    <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>:          this-&gt;<a class="code" href="class_o_t_transaction.html#a0ea6c7483a961acfdef55cd992e4065d">SaveAbbreviatedOutboxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);   <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>:    this-&gt;<a class="code" href="class_o_t_transaction.html#ac30eb05906f92766b5ce895854e682a3">SaveAbbrevPaymentInboxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);  <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>:       this-&gt;<a class="code" href="class_o_t_transaction.html#a08424e75b8906896335609d7ca45c729">SaveAbbrevRecordBoxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);     <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>:      this-&gt;<a class="code" href="class_o_t_transaction.html#af73fe383da8254ef5cd2c8a27de79a29">SaveAbbrevExpiredBoxRecord</a>(<a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>);    <span class="keywordflow">break</span>;
                <span class="comment">/* --- BREAK --- */</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>:
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unexpected message ledger type in &#39;abbreviated&#39; block. (Error.) \n&quot;</span>,
                              __FUNCTION__);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Unexpected ledger type in &#39;abbreviated&#39; block. (Error.) \n&quot;</span>,
                              __FUNCTION__);
                <span class="keywordflow">break</span>;
        } <span class="comment">/*switch*/</span>            }   <span class="comment">// if (NULL != m_pParent)</span>
        <span class="keywordflow">else</span> <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Error: Unable to save abbreviated receipt here, since m_pParent is NULL.\n&quot;</span>,
                           __FUNCTION__);
        <span class="comment">// ----------------------------------</span>
    }   <span class="comment">// if (IsAbbreviated())</span>
    <span class="comment">// -------------------------------------</span>
    <span class="keywordflow">else</span> <span class="comment">// not abbreviated (full details.)</span>
    {
        <span class="comment">// -----------------------------------------------------    </span>
        <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>  == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>) ||
            (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a> == <a class="code" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">m_Type</a>))
        {
            <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;closingTransactionNumber value=\&quot;%lld\&quot;/&gt;\n\n&quot;</span>,
                                      <a class="code" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">m_lClosingTransactionNo</a>);        
        }
        <span class="comment">// -----------------------------------------------------    </span>

        <span class="comment">// a transaction contains a list of items, but it is also in reference to some item, from someone else</span>
        <span class="comment">// We include a full copy of that item here.</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())
            <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;inReferenceTo&gt;\n%s&lt;/inReferenceTo&gt;\n\n&quot;</span>, <a class="code" href="class_o_t_transaction_type.html#a314901e59fc89a31f3cea2d956dac8b8">m_ascInReferenceTo</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="comment">// -----------------------------------------------------    </span>
        
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#a115f7417f09e3e815212d770e7b60a1b">m_ascCancellationRequest</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())
            <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;cancelRequest&gt;\n%s&lt;/cancelRequest&gt;\n\n&quot;</span>, <a class="code" href="class_o_t_transaction.html#a115f7417f09e3e815212d770e7b60a1b">m_ascCancellationRequest</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        
        <span class="comment">// -----------------------------------------------------    </span>
        <span class="comment">// loop through the items that make up this transaction and print them out here, base64-encoded, of course.</span>
        <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">m_listItems</a>)
        {
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
            
            <a class="code" href="class_o_t_string.html">OTString</a> strItem;
            pItem-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strItem);
            
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascItem;
            ascItem.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ad898bd63a4c37a97f64acfa7514409cc">SetString</a>(strItem, <span class="keyword">true</span>); <span class="comment">// linebreaks = true</span>
            
            <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;item&gt;\n%s&lt;/item&gt;\n\n&quot;</span>, ascItem.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        }   
        <span class="comment">// -----------------------------------------------------    </span>
    } <span class="comment">// not abbreviated (full details.)</span>
    
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;/transaction&gt;\n&quot;</span>);                  
}
</pre></div>
</div>
</div>
<a class="anchor" id="afba0d981b40568e307178f908788fd7b"></a><!-- doxytag: member="OTTransaction::VerifyAccount" ref="afba0d981b40568e307178f908788fd7b" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#afba0d981b40568e307178f908788fd7b">OTTransaction::VerifyAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_transaction_type.html#a5df67ad1e0b4d60e205c0a8e1ae5e703">OTTransactionType</a>.</p>

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l00239">239</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pParent = <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_ledger.html">OTLedger</a> *<span class="keyword">&gt;</span>(<a class="code" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">m_pParent</a>);
    
    <span class="comment">// Make sure that the supposed AcctID matches the one read from the file.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction_type.html#a7799050eb71875ffd069024250854392">VerifyContractID</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying account ID.\n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// todo security audit:</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>() &amp;&amp; (pParent != NULL) &amp;&amp; !pParent-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(theNym))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying signature on parent ledger for abbreviated transaction receipt.\n&quot;</span>,
                      __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>() &amp;&amp; (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(theNym)))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying signature.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(4, <span class="stringliteral">&quot;\nWe now know that...\n&quot;</span>
                  <span class="stringliteral">&quot;1) The expected Account ID matches the ID that was found on the object.\n&quot;</span>
                  <span class="stringliteral">&quot;2) The SIGNATURE VERIFIED on the object.\n\n&quot;</span>);
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae4bcd8edaf9b3cb72b0a68d503af804c"></a><!-- doxytag: member="OTTransaction::VerifyBalanceReceipt" ref="ae4bcd8edaf9b3cb72b0a68d503af804c" args="(OTPseudonym &amp;SERVER_NYM, OTPseudonym &amp;THE_NYM, const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ae4bcd8edaf9b3cb72b0a68d503af804c">OTTransaction::VerifyBalanceReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l01369">1369</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> USER_ID(THE_NYM), SERVER_USER_ID(SERVER_NYM);
    <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strReceiptID(ACCT_ID);
    
    <span class="comment">// -----------------------------------</span>
    
    <span class="comment">// Load the last successful BALANCE STATEMENT...</span>
    
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> tranOut(SERVER_USER_ID, ACCT_ID, SERVER_ID);
    
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename; strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s.success&quot;</span>, strReceiptID.Get());
    
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_folders.html#ad5d313f4dc313c7b79780288c14e9c83">OTFolders::Receipt</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();   <span class="comment">// receipts</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();        <span class="comment">// receipts/SERVER_ID</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();        <span class="comment">// receipts/SERVER_ID/ACCT_ID.success</span>
            
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFolder1name, szFolder2name, szFilename))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(1, <span class="stringliteral">&quot;Receipt file doesn&#39;t exist in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    std::string strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFolder1name, szFolder2name, szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>
    
    <span class="keywordflow">if</span> (strFileContents.length() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Error reading file: %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    
    <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(strFileContents.c_str());
    
    <span class="keywordflow">if</span> (!tranOut.LoadContractFromString(strTransaction))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Unable to load balance statement:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------------</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
    
    <span class="keywordflow">if</span> (tranOut.IsAbbreviated()) <span class="comment">// should never happen</span>
    {
        int64_t lBoxType = 0;
        
             <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))          lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;inboxRecord&quot;</span>))           lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;outboxRecord&quot;</span>))          lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tranOut.Contains(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))      lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Error loading from abbreviated transaction: &quot;</span>
                          <span class="stringliteral">&quot;unknown ledger type. (probably message but who knows.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;           
        }
        <span class="comment">// --------------</span>
        pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(tranOut, lBoxType);
        <span class="keywordflow">if</span> (NULL == pTransaction)
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Error loading from abbreviated transaction: &quot;</span>
                          <span class="stringliteral">&quot;failed loading box receipt.&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;           
        }
        <span class="comment">// ----------------</span>
        theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
    }
    <span class="keywordflow">else</span>
        pTransaction = &amp;tranOut;
    <span class="comment">// -----------------------------------------------------    </span>
    <span class="keywordflow">if</span> (!pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(SERVER_NYM))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Unable to verify SERVER_NYM signature on balance statement:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }               
    
    <span class="comment">// At this point, pTransaction is successfully loaded and verified, containing the last balance receipt.</span>
    
    <span class="keywordflow">return</span> pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ae4bcd8edaf9b3cb72b0a68d503af804c">VerifyBalanceReceipt</a>(SERVER_NYM, THE_NYM);
}
</pre></div>
</div>
</div>
<a class="anchor" id="abb94fbee174343f38ca30eaa25487cb4"></a><!-- doxytag: member="OTTransaction::VerifyBalanceReceipt" ref="abb94fbee174343f38ca30eaa25487cb4" args="(OTPseudonym &amp;SERVER_NYM, OTPseudonym &amp;THE_NYM)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ae4bcd8edaf9b3cb72b0a68d503af804c">OTTransaction::VerifyBalanceReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NYM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l01484">1484</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{                                       <span class="comment">// These are now loaded within this function, so no need to pass them in.</span>
    <span class="comment">// Load the other receipt (see above) if necessary.</span>
    
    <span class="comment">// Compare the inbox I just downloaded with what my last signed receipt SAYS it should say.</span>
    <span class="comment">// Let&#39;s say the inbox has transaction 9 in it -- well, my last signed receipt better show</span>
    <span class="comment">// that 9 was in my inbox then, too. But what if 9 was on a cheque, and it only recently hit?</span>
    <span class="comment">// Well it won&#39;t be in my old inbox, but it WILL still be signed for as an open transaction.</span>
    
    <span class="comment">// Since this involves verifying the outbox, inbox, AND account, this function should only</span>
    <span class="comment">// be called after all three have been downloaded, not after each one.</span>
    <span class="comment">// Basically the outbox should RARELY change, the inbox is EXPECTED to change, and the account</span>
    <span class="comment">// is EXPECTED to change, BUT ONLY in cases where the inbox justifies it!</span>
    <span class="comment">//</span>
    <span class="comment">// -- Verify the transaction numbers on the nym match those exactly on the newest transaction or balance receipt. (this)</span>
    <span class="comment">// -- Make sure outbox is the same.</span>
    <span class="comment">// -- Loop through all items in the inbox, AND in the inbox according to the receipt, and total the</span>
    <span class="comment">//    values of both. I might have 9 and 10 issued in the last receipt, with #9 in the inbox,</span>
    <span class="comment">//    showing 50 clams and a balance of 93. But now I downloaded an inbox showing #9 AND #10,</span>
    <span class="comment">//    with values of 50 and 4, and a balance of 89.</span>
    <span class="comment">//    The new inbox is still valid, and the new account balance is still valid, because the</span>
    <span class="comment">//    new number that appeared was issued to me and signed out, and because the last receipt&#39;s</span>
    <span class="comment">//    balance of 93 with 50 clams worth of receipts, matches up to the new account/inbox</span>
    <span class="comment">//    balance of 89 with 54 clams worth of receipts.</span>
    <span class="comment">//    The two totals still match!  That&#39;s what we&#39;re checking for.</span>
    <span class="comment">//</span>
    <span class="comment">// Not JUST that actually, but that, if #10 is NOT found in the old one, THEN the amount (4)</span>
    <span class="comment">// must be the DIFFERENCE between the balances (counting all new transactions like #10.)</span>
    <span class="comment">// Meaning, the difference between the two balances MUST be made up EXACTLY by the transactions</span>
    <span class="comment">// that are found now, that were not previously found, minus the total of the transactions</span>
    <span class="comment">// from before that are no longer there, but are also no longer on my issued list and thus don&#39;t matter.</span>
    <span class="comment">// </span>
    <span class="comment">// Wow ! OTItem::VerifyBalanceStatement will have useful code but it doesn&#39;t encapsulate all this</span>
    <span class="comment">// new functionality, since this version must assume differences are there, and STILL verify things</span>
    <span class="comment">// by comparing details about those differences, whereas that version only serves to make sure</span>
    <span class="comment">// everything still matches.</span>
    <span class="comment">// ---------------------------------------------------</span>
    
    <span class="comment">// -- Verify nym transactions match. (issued.)</span>
    <span class="comment">// -- Verify outbox matches.</span>
    <span class="comment">// -- Loop through all items on receipt. If outbox item, should match exactly.</span>
    <span class="comment">// -- But for inbox items, total up: the amount of the total of the items from the receipt,</span>
    <span class="comment">//    for all those that would actually change the balance (chequeReceipt, marketReceipt, paymentReceipt, basketReceipt.)</span>
    <span class="comment">//    These should ALL be found in the current version of the inbox. (They can only be removed by balance agreement,</span>
    <span class="comment">//    which would update THIS RECEIPT to remove them...)</span>
    <span class="comment">// -- That was the receipt. Now loop through the above inbox items and do the reverse: for each item in the NEW inbox, </span>
    <span class="comment">//    add up the total of those that would change the balance, for receipts found on the new but not the old, and account for that exactly as a difference in balance.</span>
    <span class="comment">/*</span>
<span class="comment">     </span>
<span class="comment">     Example.</span>
<span class="comment">     </span>
<span class="comment">     -- Oldest signed receipt shows a balance of 115 clams.</span>
<span class="comment">        But then, cheque #78 hits my inbox and though I haven&#39;t yet accepted the receipt, I still need to do a transaction, like a 5 clam withdrawal, or whatever,</span>
<span class="comment">        and somehow I end up doing a balance agreement.  That results in the below signed receipt:</span>
<span class="comment">     </span>
<span class="comment">     --- Old receipt shows inbox/account/nym as:</span>
<span class="comment">     Currently signed out: 8, 9, 10, and 15</span>
<span class="comment">     Balance of 100 clams (Last signed balance before this was for 115 clams above)</span>
<span class="comment">     Inbox items:</span>
<span class="comment">     #78 cheque receipt (#8) for 15 clams. (The missing money is already reflected in the above balance. BUT!! #8 must still be signed out for this to verify. Here I must sign to acknowledge the receipt is in my inbox, but I still have option to accept or dispute the receipt. Until then, server keeps it around since it has my signature on it and proves the current balance.)</span>
<span class="comment">     #82 incoming transfer for 50 clams (A new balance agreement occurs during acceptance of this. And the number doesn&#39;t belong to me. So, irrelevant here.) </span>
<span class="comment">     #10 transfer receipt for some old transfer (does NOT change balance, which already happened in the past, BUT!! #10 must still be signed out for this to verify.)</span>
<span class="comment">     </span>
<span class="comment">     My nym ISSUED list should not change unless I have a new transaction agreement, therefore I expect the list to match every time.</span>
<span class="comment">     My outbox should also match. Thus, only my account balance and inbox might change. (On the server side, which I&#39;ll see when I dl </span>
<span class="comment">     new versions of them and compare against my last receipt i.e. this function.)</span>
<span class="comment">     How?  NOT via transfer receipt, since I would sign a new balance agreement whenever that would actually impact my balance.</span>
<span class="comment">     But it could happen with a *** chequeReceipt, a paymentReceipt, marketReceipt, or basketReceipt. *** </span>
<span class="comment">     Those mean, my balance has changed.</span>
<span class="comment">     In those cases, my account balance WOULD be different, but there had better be matching receipts in the inbox!</span>
<span class="comment">     </span>
<span class="comment">     --- New inbox/account/nym shows:</span>
<span class="comment">     Currently signed out: 8, 9, 10, and 15</span>
<span class="comment">     Balance of 89 clams</span>
<span class="comment">     Inbox items:</span>
<span class="comment">     #78 cheque receipt (#8) for 15 clams. </span>
<span class="comment">     #82 incoming transfer for 50 clams (A new balance agreement occurs during acceptance. So this type has no affect on balance here.) </span>
<span class="comment">     #10 transfer receipt for some old transfer (does NOT change balance, which already happened in the past)</span>
<span class="comment">     #96 cheque receipt for 7 clams (cheque #9)</span>
<span class="comment">     #97 marketReceipt for 4 clams (marketOffer #15)</span>
<span class="comment">     #99 incoming transfer for 2000 clams (Accepting it will require a new balance agreement.)</span>
<span class="comment">     </span>
<span class="comment">     ---------------------------------</span>
<span class="comment">     </span>
<span class="comment">     How do I interpret all this data?</span>
<span class="comment">     -- Transaction numbers signed out had better match. (If #s issued had changed, I would have signed for it already.)</span>
<span class="comment">     </span>
<span class="comment">     Next loop through the inbox from the old receipt:</span>
<span class="comment">     -- #78, cheque receipt, had better be there in the new inbox, since removing it requires a balance agreement, meaning it would already be off the receipt that I&#39;m verifying... Since it&#39;s here in inbox, should therefore also be in the last receipt.</span>
<span class="comment">     -- #82, incoming transfer from old receipt, had better be also on the new inbox, since I could only accept or reject it with a balance agreement, which I&#39;m comparing the inbox to now.</span>
<span class="comment">     -- #10 had also better be there in the new inbox for the same reason: if I had accepted this transfer receipt, then my last balance receipt would reflect that.</span>
<span class="comment">     -- THEREFORE: ALL items from old receipt must be found inside new inbox!</span>
<span class="comment">     </span>
<span class="comment">     Next, loop through the new version of the inbox:</span>
<span class="comment">     -- #78, though found in the new inbox, wouldn&#39;t necessarily be expected to be found in the last receipt, since someone may have cashed my cheque since the receipt was made.</span>
<span class="comment">     -- #82, though found in the new inbox, wouldn&#39;t necessarily be expected to be found in the last receipt, since someone may have sent me the transfer since receipt was made.</span>
<span class="comment">     -- #10 in new inbox, same thing: Someone may have recently accepted my transfer, and thus #10 only would have popped in since the last agreement. (It was there before, but I couldn&#39;t EXPECT that in every case.)</span>
<span class="comment">     -- #96 and #97 represent balance CHANGES totalling -11 clams. They must correspond to a change in balance.</span>
<span class="comment">     -- #96 is a cheque receipt.. it has changed the balance and I must account for that. But #78 is ALSO a cheque receipt, so why am I not accounting for ITs total (instead just assuming it&#39;s accounted for already in the prior balance, like 78?) Because it&#39;s NEW and wasn&#39;t on the old receipt like 78 is!</span>
<span class="comment">     -- Due to the reasoning explained on the above line, ANY chequeReceipt, paymentReceipt, marketReceipt, or basketReceipt </span>
<span class="comment">        found on the new version of the inbox but NOT on the old one from the receipt, must be accounted for against the balance.</span>
<span class="comment">     -- #99 is an incoming transfer, but it will not change the balance until that transfer is accepted with a new balance agreement sometime in the future.</span>
<span class="comment">     */</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Error: This is an abbreviated receipt. (Load the box receipt first.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------</span>
    
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> USER_ID(THE_NYM), SERVER_USER_ID(SERVER_NYM);

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>()), strReceiptID(USER_ID);

<span class="comment">//  if (USER_ID != GetUserID())</span>
<span class="comment">//  {</span>
<span class="comment">//      OTLog::Error(&quot;*** OTIdentifier USER_ID(OTPseudonym THE_NYM) doesn&#39;t match OTTransactionType::GetUserID() in OTTransaction::VerifyBalanceReceipt\n&quot;);</span>
<span class="comment">//      return false;</span>
<span class="comment">//  }</span>
    
    <span class="comment">// -----------------------------------</span>
    
    <span class="comment">// Load the last TRANSACTION STATEMENT as well...</span>
    
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename; strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s.success&quot;</span>, strReceiptID.Get());
    
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_folders.html#ad5d313f4dc313c7b79780288c14e9c83">OTFolders::Receipt</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();   <span class="comment">// receipts</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();        <span class="comment">// receipts/SERVER_ID</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();        <span class="comment">// receipts/SERVER_ID/USER_ID.success</span>
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFolder1name, szFolder2name, szFilename))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Receipt file doesn&#39;t exist in OTTransaction::VerifyBalanceReceipt:\n %s\n&quot;</span>, szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    std::string strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFolder1name, szFolder2name, szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>
    
    <span class="keywordflow">if</span> (strFileContents.length() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Error reading transaction statement:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>

    
    <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(strFileContents.c_str());
    
<span class="comment">//    OTTransaction tranOut(SERVER_USER_ID, USER_ID, GetRealServerID());</span>
    <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a> * pContents = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strTransaction);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransactionType&gt;</a> theAngel(pContents);
    
    <span class="keywordflow">if</span> (NULL == pContents)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Unable to load transaction statement:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }               
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pContents-&gt;VerifySignature(SERVER_NYM))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Unable to verify signature on transaction statement:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }               
    
    <span class="comment">// At this point, pContents is successfully loaded and verified, containing the last transaction receipt.</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTrans = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_transaction.html">OTTransaction</a> *<span class="keyword">&gt;</span>(pContents);
    
    <span class="keywordflow">if</span> (NULL == pTrans)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Was expecting an OTTransaction to be stored in the transaction statement at:\n %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;        
    }
        
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> &amp; tranOut = *pTrans;

    <span class="comment">// I ONLY need this transaction statement if it&#39;s newer than the balance statement.</span>
    <span class="comment">// Otherwise, I don&#39;t use it at all.  But if it&#39;s newer, then I use it instead of the current </span>
    <span class="comment">// balance statement (only for verifying the list of issued numbers, not for anything else.)</span>
    
    <span class="comment">// And in the case where that happens, I ONLY expect to see new numbers added, NOT removed.</span>
    <span class="comment">// But again, ONLY if the transaction statement is MORE RECENT. Otherwise it may have extra</span>
    <span class="comment">// numbers alright: ones that were already removed and I don&#39;t want to re-sign responsibility for!</span>
    
    
    <span class="comment">// CHECK IF IT&#39;S NEWER AND SET A POINTER BASED ON THIS.</span>
    
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a>   * pTranWithIssuedList = <span class="keyword">this</span>; <span class="comment">// the transaction that actually has the issued list we&#39;ll be using. (Might be balance receipt or transaction receipt, whichever is newer)</span>
    <a class="code" href="class_o_t_item.html">OTItem</a>          * pItemWithIssuedList = NULL; <span class="comment">// the item from that transaction that actually has the issued list we&#39;ll be using.</span>
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pResponseTransactionItem   = NULL; <span class="comment">// only if it&#39;s new than balance receipt does this get set, to: tranOut.GetItem(OTItem::atTransactionStatement);</span>
    <a class="code" href="class_o_t_item.html">OTItem</a> * pTransactionItem           = NULL;

    
    <span class="keywordflow">if</span> (tranOut.<a class="code" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a>() &gt; this-&gt;<a class="code" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a>()) <span class="comment">// it&#39;s newer.</span>
    {
        pTranWithIssuedList = &amp;tranOut;
        
        <span class="comment">// GET THE &quot;AT TRANSACTION STATEMENT&quot; ITEM</span>
        pResponseTransactionItem = tranOut.<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>);
        
        <span class="keywordflow">if</span> (NULL == pResponseTransactionItem)
        {
            <span class="comment">// error, return.</span>
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No atTransactionStatement item found on receipt (strange.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> != pResponseTransactionItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
        {
            <span class="comment">// error, return.</span>
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Error: atTransactionStatement found on receipt, but not a successful one.\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;       
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pResponseTransactionItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(SERVER_NYM))
        {       
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on atTransactionStatement item in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;               
        }
        
        <span class="comment">// ------------------------------------</span>
        
        <span class="comment">// LOAD &quot;TRANSACTION STATEMENT&quot; (ITEM) from within the above item we got.</span>
        
        <a class="code" href="class_o_t_string.html">OTString</a> strBalanceItem;
        pResponseTransactionItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strBalanceItem);
        
        <span class="keywordflow">if</span> (!strBalanceItem.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <span class="comment">// error, return.</span>
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No transactionStatement item found as &#39;in ref to&#39; string on a receipt containing atTransactionStatement item.\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;               
        }
        
        pTransactionItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strBalanceItem, <a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>(), pResponseTransactionItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
        
        <span class="keywordflow">if</span> (NULL == pTransactionItem)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load transactionStatement item from string (from a receipt containing an atTransactionStatement item.)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;               
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTransactionItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">OTItem::transactionStatement</a>)
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Wrong type on pTransactionItem (expected OTItem::transactionStatement)\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;               
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pTransactionItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(THE_NYM))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on transactionStatement item in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;               
        }
        
        pItemWithIssuedList = pTransactionItem;
    }
    
    <span class="comment">// Now use pTranWithIssuedList and pItemWithIssuedList for checking issued numbers.</span>
    <span class="comment">// (Even though I&#39;ll continue to use *this for all other data being verified.)</span>
        
    <span class="comment">// -------------------------------------------------------</span>
    
    <span class="comment">// LOAD THE ACCOUNT </span>
    
    
    <a class="code" href="class_o_t_account.html">OTAccount</a> THE_ACCOUNT(USER_ID, <a class="code" href="class_o_t_transaction_type.html#ac9b118b7db7ea538d6931dee6c2f34e2">GetRealAccountID</a>(), <a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>());

    <span class="keywordflow">if</span> (!THE_ACCOUNT.LoadContract() || !THE_ACCOUNT.VerifyAccount(THE_NYM))
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Failed loading or verifying account for THE_NYM in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;       
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (THE_ACCOUNT.GetPurportedServerID() != <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>()) <span class="comment">// the account, inbox, and outbox all have the same Server ID. But does it match *this receipt?</span>
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Account, inbox or outbox server ID fails to match receipt server ID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (THE_ACCOUNT.GetPurportedAccountID() != <a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>()) <span class="comment">// Same as above except for account ID instead of server ID.</span>
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Account ID fails to match receipt account ID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// -----------------------------------------------------</span>
    
    <span class="comment">// LOAD INBOX AND OUTBOX</span>
    
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = THE_ACCOUNT.<a class="code" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a>(THE_NYM); <span class="comment">// OTAccount::Load also calls VerifyAccount() already</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = THE_ACCOUNT.<a class="code" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a>(THE_NYM);  <span class="comment">// OTAccount::Load also calls VerifyAccount() already</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox);
    
    <span class="keywordflow">if</span> ((NULL == pInbox) || (NULL == pOutbox))
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Inbox or outbox was NULL after THE_ACCOUNT.Load in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// ------------------------------------</span>
    
    <span class="comment">// LOAD &quot;AT BALANCE STATEMENT&quot; (ITEM)</span>
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pResponseBalanceItem = this-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>);
    
    <span class="keywordflow">if</span> (NULL == pResponseBalanceItem)
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No atBalanceStatement item found on receipt (strange.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> != pResponseBalanceItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Error: atBalanceStatement found on receipt, but not a successful one.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;       
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pResponseBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(SERVER_NYM))
    {       
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on atBalanceStatement item in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// ------------------------------------</span>

    <span class="comment">// LOAD &quot;BALANCE STATEMENT&quot; (ITEM)</span>

    <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = NULL;
    
    <a class="code" href="class_o_t_string.html">OTString</a> strBalanceItem;
    pResponseBalanceItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strBalanceItem);
        
    <span class="keywordflow">if</span> (!strBalanceItem.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No balanceStatement item found as &#39;in ref to&#39; string on a receipt containing atBalanceStatement item.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }

    pBalanceItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strBalanceItem, <a class="code" href="class_o_t_transaction_type.html#a6a6c7517c09f0abacc72c1ec84d937ed">GetRealServerID</a>(), pResponseBalanceItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
            
    <span class="keywordflow">if</span> (NULL == pBalanceItem)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load balanceStatement item from string (from a receipt containing an atBalanceStatement item.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Wrong type on pBalanceItem (expected OTItem::balanceStatement)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(THE_NYM))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on balanceStatement item in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    

    <span class="comment">// ---------------------------------------------------------</span>

    <span class="comment">// LOAD MESSAGE NYM (THE LIST OF ISSUED NUMBERS ACCORDING TO THE RECEIPT.)</span>
    
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym;
    <a class="code" href="class_o_t_string.html">OTString</a>    strMessageNym; <span class="comment">// Okay now we have the transaction numbers in this MessageNym string.</span>
    
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((NULL != pTransactionItem) &amp;&amp; (tranOut.<a class="code" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a>() &gt; this-&gt;<a class="code" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a>())) <span class="comment">// transaction statement is newer than (this) balance statement.</span>
        pItemWithIssuedList = pTransactionItem; <span class="comment">// already set above, but I&#39;m re-stating here for clarity, since the else is now possible...</span>
    <span class="keywordflow">else</span> 
        pItemWithIssuedList = pBalanceItem; <span class="comment">// Hereafter we can use pItemWithIssuedList to verify issued transaction numbers (and NOTHING ELSE.)</span>

    <span class="comment">// ------------</span>
    
    pItemWithIssuedList-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strMessageNym);  <span class="comment">// Like right here, for example.</span>

    <span class="keywordflow">if</span> (!strMessageNym.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strMessageNym))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load message nym in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
            
    <span class="comment">// ------------------------------------</span>

    <span class="comment">// Finally everything is loaded and verified!</span>
    <span class="comment">// I have the Nym and Server Nym</span>
    <span class="comment">// I have the account, inbox, and outbox</span>
    <span class="comment">// I have the original balance statement, AND the server&#39;s reply to it (a successful one)</span>
    <span class="comment">// </span>
    <span class="comment">// Repeating a note from above:</span>
    <span class="comment">// -- Verify nym transactions match. (The issued / signed-for ones.)</span>
    <span class="comment">// -- Verify outbox matches.</span>
    <span class="comment">// -- Loop through all items on receipt. If outbox item, should match exactly.</span>
    <span class="comment">// -- But for inbox items, total up: the amount of the total of the items from the receipt,</span>
    <span class="comment">//    for all those that would actually change the balance (chequeReceipt, marketReceipt, paymentReceipt.)</span>
    <span class="comment">//    These should ALL be found in the current version of the inbox. (They can only be removed by balance agreement which would update THIS RECEIPT to remove them...)</span>
    <span class="comment">// -- That was the receipt. Now loop through the latest inbox items and do the reverse: for each item in the NEW inbox, </span>
    <span class="comment">//    add up the total of those that would change the balance, for receipts found on the new but not the old, and account for that exactly as a difference in balance.</span>
    <span class="comment">//    Also make sure each receipt in the inbox (new or old) is an issued transaction number, signed out to THE_NYM.</span>
    
        
    <span class="comment">// VERIFY THE LIST OF ISSUED (SIGNED FOR) TRANSACTION NUMBERS ON THE NYM AGAINST THE RECEIPT.</span>
    <span class="comment">// The Nym should match whatever is on the newest receipt (determined just above.)</span>
    <span class="comment">//</span>
    <span class="comment">// NOTE: I used to VerifyIssuedNumbersOnNym -- but that won&#39;t work. Why? Because let&#39;s say I signed a balance agreement with #s 9, 10, and 11.</span>
    <span class="comment">// That&#39;s my last receipt. Now let&#39;s say, using a DIFFERENT ASSET ACCOUNT, I do a withdrawal, burning #9. Now my balance agreement says 10, 11 for</span>
    <span class="comment">// that other account, which correctly matches the server.  Now when the FIRST ACCOUNT verifies his (formerly valid) receipt, 9 is missing from his nym,</span>
    <span class="comment">// which doesn&#39;t match the receipt!  Of course that&#39;s because there&#39;s a newer balance receipt -- BUT ON A DIFFERENT ASSET ACCOUNT.</span>
    <span class="comment">//</span>
    <span class="comment">// VerifyTransactionStatement (vs VerifyBalanceStatement, where we are now) gets around this whole problem with VerifyTransactionStatementNumbersOnNym,</span>
    <span class="comment">// which only verifies that every issued number found on THE_NYM (client-side) is definitely also found in the receipt (theMessageNym). It does NOT do the reverse.</span>
    <span class="comment">// In other words, it does NOT make sure that every Trans# on theMessageNym (last receipt) is also found on THE_NYM (current client-side nym.)  Numbers may </span>
    <span class="comment">// have been cleared since that receipt was signed, due to a balance agreement FROM A DIFFERENT ASSET ACCOUNT. This is okay since numbers have not been ADDED </span>
    <span class="comment">// to your list of responsibility (which is the danger.) In order to ADD a number to your list, a transaction statement would have to be signed, since new</span>
    <span class="comment">// transaction numbers can only be received through the Nymbox. Since this function (VerifyBalanceReceipt) uses the transactionStatement for verifying issued</span>
    <span class="comment">// numbers in cases where it is newer than the balanceStatement, then if a new number was added, it will be on the receipt already.</span>
    <span class="comment">//</span>
<span class="comment">//  if (!THE_NYM.VerifyIssuedNumbersOnNym(theMessageNym)) // Explained above. Balance Statements from other accts might be newer, and have burned #s already. Thus I</span>
    <span class="keywordflow">if</span> (!THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a52932b9c7bbb25ca21e1bf83d067e138">VerifyTransactionStatementNumbersOnNym</a>(theMessageNym)) <span class="comment">// Can&#39;t expect a # on the receipt to still be available, though I MUST verify that every number on current Nym IS on the receipt (just not the other way around.)</span>
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify issued numbers on last signed receipt with numbers on THE_NYM in OTTransaction::VerifyBalanceReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// -------------------------------------------------------</span>
    
    <span class="comment">// LOOP THROUGH THE BALANCE STATEMENT ITEMS (INBOX AND OUTBOX) TO GATHER SOME DATA...</span>
    
    int32_t nInboxItemCount = 0, nOutboxItemCount = 0;
    
    
<span class="comment">//  OTLog::vError(&quot;BEFORE LOOP nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>
    
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szInbox        = <span class="stringliteral">&quot;Inbox&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szOutbox       = <span class="stringliteral">&quot;Outbox&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> * pszLedgerType  = NULL;
    int64_t lReceiptBalanceChange  = 0; <span class="comment">// For measuring the amount of the total of items in the inbox that have changed the balance (like cheque receipts)</span>
    
    <span class="comment">// Notice here, I&#39;m back to using pBalanceItem instead of pItemWithIssuedList, since this is the inbox/outbox section...</span>
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;Number of inbox/outbox items on the balance statement: %d\n&quot;</span>, pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a67cec1836d8607311227b2526b0ec4f5">GetItemCount</a>());
    
    
    <span class="comment">// TODO:  Note: If the balance item shows a FINAL RECEIPT present, then ALL the co-related cron receipts in</span>
    <span class="comment">// the ACTUAL INBOX must ALSO be present on the balance item, just as the final receipt is present. IT cannot</span>
    <span class="comment">// be there unless THEY are also there!  (The WHOLE PURPOSE of the final receipt is to MAKE SURE that all its</span>
    <span class="comment">// related paymentReceipts/marketReceipts have been CLOSED OUT.)</span>
    <span class="comment">//</span>
    
    <span class="keywordflow">for</span> (int32_t i=0; i &lt; pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a67cec1836d8607311227b2526b0ec4f5">GetItemCount</a>(); i++)
    {
        <span class="comment">// for outbox calculations. (It&#39;s the only case where GetReceiptAmount() is wrong and needs -1 multiplication.)</span>
        int64_t lReceiptAmountMultiplier = 1; 

        <a class="code" href="class_o_t_item.html">OTItem</a> * pSubItem = pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a3db78fb28bf4d93b477a382b900a45ca">GetItem</a>(i);
        
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pSubItem);
        
        <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger  = NULL;
                
        <span class="keywordflow">switch</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
        {
            <span class="comment">// ------------------------------------------------------</span>
            <span class="comment">// These types of receipts can actually change your balance.</span>
            <span class="comment">//</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>: 
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>: 
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>:
                
                lReceiptBalanceChange += pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>();
                
<span class="comment">//              OTLog::vError(&quot;RECEIPT: lReceiptBalanceChange: %lld  pSubItem-&gt;GetAmount()  %lld\n&quot;, </span>
<span class="comment">//                    lReceiptBalanceChange, pSubItem-&gt;GetAmount());</span>

                <span class="comment">// DROPS THROUGH HERE...</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>:  <span class="comment">// These types of receipts do NOT change your balance.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>:
                
                nInboxItemCount++;
<span class="comment">//              OTLog::vError(&quot;RECEIPT: nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>
                pLedger = pInbox;
                pszLedgerType = szInbox;
                
                <span class="comment">// DROPS THROUGH HERE...</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>:
                
                <span class="keywordflow">break</span>; <span class="comment">// we&#39;ll handle this in the next switch.</span>
            <span class="comment">// ------------------------------------------------------</span>
                
            <span class="keywordflow">default</span>:
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strItemType;
                pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strItemType);
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: Ignoring %s item &quot;</span>
                               <span class="stringliteral">&quot;in balance statement while verifying it against inbox.\n&quot;</span>, strItemType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
            }               
                <span class="keywordflow">continue</span>;
        }
        
        <span class="comment">// -------------------------------------</span>
        
        <span class="keywordflow">switch</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) 
        {
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>:
                
                <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>() &lt; 0) <span class="comment">// it&#39;s an outbox item</span>
                {
                    lReceiptAmountMultiplier = -1; <span class="comment">// transfers out always reduce your balance.</span>
                    nOutboxItemCount++;

<span class="comment">//                  OTLog::vError(&quot;GetAmount() negative, OUTBOX ITEM: nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>

                    pLedger = pOutbox;
                    pszLedgerType = szOutbox;
                }
                <span class="keywordflow">else</span>
                {
                    lReceiptAmountMultiplier = 1; <span class="comment">// transfers in always increase your balance.</span>
                    nInboxItemCount++;
                    pLedger = pInbox;
                    pszLedgerType = szInbox;

<span class="comment">//                  OTLog::vError(&quot;GetAmount() POSITIVE, INBOX ITEM: nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>

                }
                <span class="keywordflow">break</span>;
                
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>:     <span class="comment">// will have a 0 receipt amount.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6ccb74fdd8d6de9bdd3d4b20db8850be">OTItem::transferReceipt</a>:  <span class="comment">// will have a 0 receipt amount.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a7d253a3cc42a3ac9f0c1a8e0e047610b">OTItem::voucherReceipt</a>:   <span class="comment">// will have a 0 receipt amount.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6924070960c3d7889da9beaaa8484010">OTItem::chequeReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac193ab9b606ec457cfba3410bc12bbfb">OTItem::marketReceipt</a>: <span class="comment">// will already be negative or positive based on whichever is appropriate.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>:<span class="comment">// will already be negative or positive based on whichever is appropriate.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aeffa6527cfbdeaa83144e89b4cc3779f">OTItem::basketReceipt</a>: <span class="comment">// will already be negative or positive based on whichever is appropriate.</span>
                lReceiptAmountMultiplier = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
                <span class="keywordflow">continue</span>; <span class="comment">// This will never happen, due to the first continue above in the first switch.</span>
        }
        
        <span class="comment">// ------------------------------------------------------------------</span>

        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
        
        int64_t lTempTransactionNum = 0; <span class="comment">// Used for the below block.</span>
        int64_t lTempReferenceToNum = 0; <span class="comment">// Used for the below block.</span>
        int64_t lTempNumberOfOrigin = 0; <span class="comment">// Used for the below block.</span>
        
        <span class="comment">// What&#39;s going on here? In the original balance statement, ONLY IN CASES OF OUTOING TRANSFER, </span>
        <span class="comment">// the user has put transaction # &quot;1&quot; in his outbox, in anticipation that</span>
        <span class="comment">// the server, upon success, will actually put a real pending transfer into his outbox, and</span>
        <span class="comment">// issue a number for it (like &quot;34&quot;).</span>
        <span class="keywordflow">if</span> ((pOutbox == pLedger) &amp;&amp;     <span class="comment">// Thus it&#39;s understood that whenever the balanceStatement </span>
                                        <span class="comment">// has a &quot;1&quot; in the outbox, I should find a corresponding &quot;34&quot; (or whatever # the</span>
            (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() == 1) &amp;&amp; <span class="comment">// server chose) as the GetNewOutboxTransNum member on the atBalanceStatement.</span>
                                                    <span class="comment">// Now here, when verifying the receipt, this allows me to verify the </span>
            (pResponseBalanceItem-&gt;<a class="code" href="class_o_t_item.html#abe21495ffbdbf2c7f6dc3d0185295d87">GetNewOutboxTransNum</a>() &gt; 0)) <span class="comment">// outbox request &#39;1&#39; against the actual &#39;34&#39; that resulted.</span>
        {
            lTempTransactionNum = pResponseBalanceItem-&gt;<a class="code" href="class_o_t_item.html#abe21495ffbdbf2c7f6dc3d0185295d87">GetNewOutboxTransNum</a>();
            pTransaction        = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTempTransactionNum);
            
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(3, <span class="stringliteral">&quot;OTTransaction::VerifyBalanceReceipt: (This iteration, I&#39;m handling an item listed as &#39;1&#39; in the outbox.)\n&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="comment">// ---------------------------------------------------------------</span>
        {   <span class="comment">// THE ABOVE IS THE *UNUSUAL* CASE, WHEREAS THIS IS THE NORMAL CASE:</span>
            <span class="comment">//</span>
            <span class="comment">// Make sure that the transaction number of each sub-item is found</span>
            <span class="comment">// on the appropriate ledger (inbox or outbox).</span>

            lTempTransactionNum = pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
            pTransaction        = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(lTempTransactionNum);
        }
        <span class="comment">// *******************************************************************</span>
        
        <span class="keywordflow">if</span> (NULL != pTransaction)
        {
            lTempReferenceToNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>();
            lTempNumberOfOrigin = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>();
        }
        
        <span class="comment">// ------------------------------------------------------------------</span>
        <span class="keywordtype">bool</span> bSwitchedBoxes = <span class="keyword">false</span>; <span class="comment">// In the event that an outbox pending transforms into an inbox transferReceipt, I set this true.</span>
        
        <span class="comment">// Let&#39;s say I sign a balance receipt showing a 100 clam pending transfer, sitting in my outbox.</span>
        <span class="comment">// That means someday when I VERIFY that receipt, the 100 clam pending better still be in that</span>
        <span class="comment">// outbox, or verification will fail. BUT WAIT -- if the receipient accepts the transfer, then it</span>
        <span class="comment">// will disappear out of my outbox, and show up in my inbox as a transferReceipt. So when I go to</span>
        <span class="comment">// verify my balance receipt, I have to expect that any outbox item might be missing, but if that is</span>
        <span class="comment">// the case, there had better be a matching transferReceipt in the inbox. (That wouldn&#39;t disappear</span>
        <span class="comment">// unless I processed my inbox, and signed a new balance agreement to get rid of it, so I know it</span>
        <span class="comment">// has to be there in the inbox if the pending wasn&#39;t in the outbox. (If the receipt is any good.)</span>
        <span class="comment">//</span>
        <span class="comment">// Therefore the code has to specifically allow for this case, for outbox items...</span>
        <span class="keywordflow">if</span> ((NULL == pTransaction) &amp;&amp; (pOutbox == pLedger))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;OTTransaction::%s: Outbox pending found as inbox transferReceipt. (Normal.)\n&quot;</span>,
                           __FUNCTION__);

            <span class="comment">// We didn&#39;t find the transaction that was expected to be in the outbox. (A pending.)</span>
            <span class="comment">// Therefore maybe it is now a transfer receipt in the Inbox. We allow for this case.</span>

            pTransaction = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a82181e9dd053f165008b02b5827f784d">GetTransferReceipt</a>(pSubItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>());
            
            <span class="keywordflow">if</span> (NULL != pTransaction)
            {
                lTempTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
                lTempNumberOfOrigin = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>();
                <span class="comment">// --------------------------------------------------------------</span>
                <span class="comment">// re: the code below: lTempReferenceToNum  = pSubItem-&gt;GetReferenceToNum();</span>
                <span class="comment">//</span>
                <span class="comment">// If it had been in the outbox, the pending receipt would be &quot;in reference to&quot; my original</span>
                <span class="comment">// transfer.</span>
                <span class="comment">// But if it&#39;s since been processed into a transferReceipt in my inbox, that transferReceipt</span>
                <span class="comment">// is now &quot;in reference to&quot; the recipient&#39;s acceptPending, and thus is NOT in reference to</span>
                <span class="comment">// my original transfer.</span>
                <span class="comment">// Thus, when the ref num is compared (a little farther below) to pSubItem-&gt;RefNum, it&#39;s</span>
                <span class="comment">// GUARANTEED to fail. That is why we are using pSubItem-&gt;GetReferenceToNum here instead of</span>
                <span class="comment">// pTransaction-&gt;GetReferenceToNum.</span>
                <span class="comment">//</span>
                <span class="comment">// Now you might ask, &quot;Then why, below, are we comparing lTempReferenceToNum (containing</span>
                <span class="comment">// pSubItem-&gt;GetReferenceToNum) to pSubItem-&gt;GetReferenceToNum ?? Aren&#39;t we just comparing</span>
                <span class="comment">// it to itself?&quot;</span>
                <span class="comment">//</span>
                <span class="comment">// The answer is yes, in this specific case, we are. But remember, in most cases, lTempReferenceToNum</span>
                <span class="comment">// contains pTransaction-&gt;GetReferenceToNum, and so in most cases we are NOT comparing it</span>
                <span class="comment">// to itself. ONLY in this specific case where the receipt has changed from an outbox-based</span>
                <span class="comment">// pending to an inbox-based transferReceipt. And so here, lTempReferenceToNum is set to pSubItem&#39;s</span>
                <span class="comment">// version, so that it will not fail the below comparison, which would otherwise succeed properly</span>
                <span class="comment">// in all other cases.</span>
                <span class="comment">//</span>
                <span class="comment">// Next you might ask, &quot;But if we are comparing it to itself in this specific case, sure it will</span>
                <span class="comment">// pass the comparison, but then what happens to the security, in this specific case?&quot;</span>
                <span class="comment">//</span>
                <span class="comment">// The answer is, the very next comparison after that is for the NumberOfOrigin, which is unique</span>
                <span class="comment">// and which still must match. (Therefore we are still protected.)</span>
                <span class="comment">//</span>
                lTempReferenceToNum = pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>();
                
                lReceiptAmountMultiplier = 1;

                nInboxItemCount++;
                nOutboxItemCount--;
                
<span class="comment">//              OTLog::vError(&quot;PENDING-&gt;TransferReceipt. nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>

                pLedger = pInbox;
                pszLedgerType = szInbox;
                
                bSwitchedBoxes = <span class="keyword">true</span>; <span class="comment">// We need to know this in one place below.</span>
            }
                        
            <span class="comment">/*</span>
<span class="comment">             Pending:</span>
<span class="comment">             Outbox: 1901, referencing 1884</span>
<span class="comment">             Inbox:  1901, referencing 1884</span>
<span class="comment">             </span>
<span class="comment">             </span>
<span class="comment">             transfer receipt:</span>
<span class="comment">             Trans 1902, referencing 1884 (That&#39;s just the display, however. Really 1902 refs 781, which refs 1884.)</span>
<span class="comment">        </span>
<span class="comment">             </span>
<span class="comment">             The pending in the outbox REFERENCES the right number.</span>
<span class="comment">             </span>
<span class="comment">             The transfer receipt includes (ref string) an acceptPending that references the right number.</span>
<span class="comment">             </span>
<span class="comment">             So for pending in outbox, when failure, get ReferenceNum(), and use that to find item in Inbox using GetTransferReceipt().</span>
<span class="comment">             */</span>
        }
            
        <span class="comment">// STILL not found?? </span>
        <span class="keywordflow">if</span> (NULL == pTransaction)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Expected %s transaction (%lld) not found. (Amount %lld.)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum, pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ----------------------------------------------------------------------------------</span>
        <span class="comment">// subItem is from the balance statement, and pTransaction is from the inbox/outbox</span>
        <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() != lTempReferenceToNum)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) mismatch Reference Num: %lld, expected %lld\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum,
                           pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), lTempReferenceToNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ----------------------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>() != lTempNumberOfOrigin)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) mismatch Number of Origin: %lld, expected %lld\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum,
                           pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a0ae107e35e5532f2bd0e2df6989ff0a9">GetRawNumberOfOrigin</a>(), lTempNumberOfOrigin);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ----------------------------------------------------------------------------------</span>
        int64_t lTransactionAmount   =  pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
        lTransactionAmount      *=  lReceiptAmountMultiplier;
        
        <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>() != lTransactionAmount)
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) &quot;</span>
                           <span class="stringliteral">&quot;amounts don&#39;t match: Report says %lld, but expected %lld. Trans recpt amt: %lld, (pBalanceItem-&gt;GetAmount() == %lld.)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum,
                           pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(), lTransactionAmount, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(),
                           pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="comment">// ----------------------------------------------------------------------------------</span>
        <span class="keywordflow">if</span> (
            (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>)   &amp;&amp; 
                (
                 ((bSwitchedBoxes == <span class="keyword">true</span>) &amp;&amp; (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>))
                 ||
                 ((pLedger == pOutbox)  &amp;&amp; (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>))
                 ||
                 ((pLedger == pInbox)   &amp;&amp; (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>() != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>) &amp;&amp; 
                  (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()  != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>))
                )
           )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (pending block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTItem::chequeReceipt</a>) &amp;&amp;
            (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (chequeReceipt block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTItem::voucherReceipt</a>) &amp;&amp;
            (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (voucherReceipt block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTItem::marketReceipt</a>) &amp;&amp;
            (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (marketReceipt block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTItem::paymentReceipt</a>) &amp;&amp; 
            (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (paymentReceipt block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTItem::transferReceipt</a>) &amp;&amp; 
            (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>))
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type. (transferReceipt block)\n&quot;</span>,
                           __FUNCTION__, pszLedgerType, lTempTransactionNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTItem::basketReceipt</a>) &amp;&amp; 
            <span class="comment">// -------------------------------------------------------</span>
            ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>) || 
             (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
            )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type or closing num (%lld). &quot;</span>
                           <span class="stringliteral">&quot;(basketReceipt block)\n&quot;</span>, __FUNCTION__, pszLedgerType, lTempTransactionNum,
                           pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTItem::finalReceipt</a>) &amp;&amp; 
            <span class="comment">// -------------------------------------------------------</span>
            ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>) || 
             (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
             )
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: %s transaction (%lld) wrong type or closing num (%lld). &quot;</span>
                           <span class="stringliteral">&quot;(finalReceipt block)\n&quot;</span>, __FUNCTION__, pszLedgerType, lTempTransactionNum,
                           pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>());
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }
    
    <span class="comment">// By this point, I have an accurate count of the inbox items, and outbox items, represented</span>
    <span class="comment">// by *this receipt.</span>
    <span class="comment">// I also know that I found each item from the receipt on the new inbox or outbox (as I should have)</span>
    <span class="comment">// But do I have to verify that the items are all signed for. I&#39;ll do that below since this list</span>
    <span class="comment">// is a subset of that one (supposedly.)</span>
    
    <span class="comment">//-----------------------------------------------------------------</span>
    
    
<span class="comment">//  OTLog::vError(&quot;BEFORE COUNT MATCH. nInboxItemCount: %d  nOutboxItemCount: %d\n&quot;, nInboxItemCount, nOutboxItemCount);</span>
    
    <span class="keywordflow">if</span> (nOutboxItemCount != pOutbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Outbox mismatch in expected transaction count.\n&quot;</span>
                       <span class="stringliteral">&quot; --- THE_INBOX count: %d --- THE_OUTBOX count: %d\n&quot;</span>
                       <span class="stringliteral">&quot;--- nInboxItemCount: %d --- nOutboxItemCount: %d\n\n&quot;</span>, 
                       __FUNCTION__, pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>(), pOutbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>(),
                       nInboxItemCount, nOutboxItemCount);
        
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// (Notice I don&#39;t check inbox item count here, since that actually CAN change.)</span>
    
    <span class="comment">//-----------------------------------------------------------------</span>

    <span class="comment">// LOOP THROUGH LATEST INBOX AND GATHER DATA / VALIDATE AGAINST LAST RECEIPT.</span>
    
    int64_t lInboxBalanceChange = 0; <span class="comment">// Change in the account balance we&#39;d expect, based on TOTAL receipts in the inbox.</span>
    int64_t lInboxSupposedDifference = 0; <span class="comment">// Change in the account balance we&#39;d expect, based on the NEW receipts in the inbox.</span>

    <span class="keywordflow">for</span> (int32_t i=0; i &lt; pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>(); i++)
    {
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(i);
        
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pTransaction);

        <span class="comment">// -----------------------------------------------</span>

        <span class="keywordflow">switch</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        {
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>: 
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>: 
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
                
                lInboxBalanceChange += pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(); <span class="comment">// Here I total ALL relevant receipts.</span>
                
<span class="comment">//              OTLog::vError(&quot;ON INBOX:  lInboxBalanceChange: %lld  pTransaction-&gt;GetReceiptAmount(): %lld\n&quot;, // temp remove debugging todo</span>
<span class="comment">//                            lInboxBalanceChange, pTransaction-&gt;GetReceiptAmount());</span>
                
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:       <span class="comment">// finalReceipt has no amount.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:            <span class="comment">// pending has an amount, but it already came out of the account and thus isn&#39;t figured here.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: <span class="comment">// transferReceipt has an amount, but it already came out of account and thus isn&#39;t figured in here.</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>: <span class="comment">// voucherReceipt has an amount, but it already came out of account and thus isn&#39;t figured in here.</span>
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;OTTransaction::%s: Ignoring %s item in inbox while verifying it against balance receipt.\n&quot;</span>,
                               __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
            }               
                <span class="keywordflow">continue</span>;
        }
        
        <span class="comment">// -----------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// This &quot;for&quot; loop is in the process of iterating the LATEST INBOX...</span>
        <span class="comment">// ...For each receipt in that inbox, we try and look up a record of the exact same receipt in</span>
        <span class="comment">// the INBOX REPORT (present in the balance agreement from the LAST SIGNED TRANSACTION RECEIPT.)</span>
        <span class="comment">//</span>
        <span class="comment">// It may or may not be found...</span>
        
        <a class="code" href="class_o_t_item.html">OTItem</a> * pSubItem = pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#ac4b56f3a97ca6b8fd44738c9beeba4d1">GetItemByTransactionNum</a>(pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        
        <a class="code" href="class_o_t_item.html">OTItem</a> * pFinalReceiptItem = NULL;

        <span class="comment">// ---------------------------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// The above loop already verified that all items in the receipt&#39;s inbox were found in the new inbox.</span>
        <span class="comment">//</span>
        <span class="comment">// But THIS item, though found in the new inbox, WAS NOT FOUND in the OLD inbox (on the receipt.)</span>
        <span class="comment">// That means it needs to be accounted for against the account balance!</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL == pSubItem)
        {
            <span class="keywordflow">switch</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
            {
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>: 
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
                    <span class="comment">//</span>
                    <span class="comment">// New thought: if this transaction is from cron (paymentReceipt or marketReceipt), AND THIS BEING A NEW ITEM</span>
                    <span class="comment">// that IS in the latest inbox (but was NOT there before, in the receipt), THEN the finalReceipt for THIS</span>
                    <span class="comment">// transaction had BETTER NOT BE in the old inbox from my last receipt!!</span>
                    <span class="comment">//</span>
                    <span class="comment">// Logic: Because the whole point of the finalReceipt is to prevent any NEW marketReceipts from popping in,</span>
                    <span class="comment">// once it is present! It&#39;s like a &quot;red flag&quot; or a &quot;filing date&quot; -- once it is triggered, IT IS THE FINAL RECEIPT.</span>
                    <span class="comment">// No other receipts can appear that reference the same transaction number!</span>
                    <span class="comment">//</span>
                    <span class="comment">// THEREFORE: If the FINAL RECEIPT is ALREADY in my last signed receipt, then WHY IN HELL are NEW marketReceipts or</span>
                    <span class="comment">// paymentReceipts going into the latest inbox ??</span>
                    <span class="comment">//</span>
                    <span class="comment">// That is why I  verify here that, IF THIS IS A CRON TRANSACTION (payment, market), then the finalReceipt</span>
                    <span class="comment">// should NOT be present in the inbox report from the last receipt!</span>
                    <span class="comment">//</span>
                    
                    pFinalReceiptItem = pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a08f07e59cd535830b158d45730908ad7">GetFinalReceiptItemByReferenceNum</a>(pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());

                    <span class="comment">// If it was FOUND... (bad)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (NULL != pFinalReceiptItem)
                    {
                        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Malicious server? A new cronReceipt has appeared, &quot;</span>
                                       <span class="stringliteral">&quot;even though its corresponding \nfinalReceipt was already present in the LAST SIGNED RECEIPT. &quot;</span>
                                       <span class="stringliteral">&quot;In reference to: %lld\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                    <span class="comment">// else drop-through, since marketReceipts and paymentReceipts DO affect the balance...</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:  <span class="comment">// Every one of these, we have to add up the total and reconcile against the latest balance.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
                    
                    lInboxSupposedDifference += pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(); <span class="comment">// Here I only total the NEW receipts (not found in old receipt inbox but found in current inbox.)</span>
                    
<span class="comment">//                  OTLog::vError(&quot;NOT ON RECEIPT:  lInboxSupposedDifference: %lld  pTransaction-&gt;GetReceiptAmount(): %lld\n&quot;, // temp remove debugging todo</span>
<span class="comment">//                                lInboxSupposedDifference, pTransaction-&gt;GetReceiptAmount());</span>
                    
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:   <span class="comment">// This has no value. 0 amount.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>: <span class="comment">// pending has value, why aren&#39;t we adding it? Because it hasn&#39;t changed the balance yet.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:  <span class="comment">// transferReceipt has an amount, but it already came out of the account and thus isn&#39;t figured in here.</span>
                <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:  <span class="comment">// voucherReceipt has an amount, but it already came out of the account and thus isn&#39;t figured in here.</span>
                    <span class="keywordflow">break</span>;
                    
                <span class="keywordflow">default</span>:
                    <span class="keywordflow">break</span>; <span class="comment">// this should never happen due to above switch.</span>
            }
        }
        <span class="comment">// ---------------------------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="keywordflow">else</span> <span class="comment">// If the transaction from the inbox WAS found as an item on the old receipt, let&#39;s verify the two against each other...</span>
        {
            <span class="comment">// subItem is from the balance statement, and pTransaction is from the inbox</span>
            <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>())
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) mismatch Reference Num: %lld, expected %lld\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(),
                               pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// ----------------------------------------------------------------------------------</span>
            <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>())
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) mismatch Reference Num: %lld, expected %lld\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                               pSubItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>(), pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// ----------------------------------------------------------------------------------</span>
            <span class="comment">// We&#39;re looping through the inbox here, so no multiplier is needed for the amount</span>
            <span class="comment">// (that was only for outbox items.)</span>
            <span class="keywordflow">if</span> (pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>()   != (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>() ))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) &quot;</span>
                               <span class="stringliteral">&quot;amounts don&#39;t match: %lld, expected %lld. (pBalanceItem-&gt;GetAmount() == %lld.)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(),
                               pSubItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>(), pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>(),
                               pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8af50841ed6e2bd9586ae8f6d79ee3b67d">OTItem::transfer</a>) &amp;&amp; 
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. (pending block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTItem::chequeReceipt</a>) &amp;&amp;
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. &quot;</span>
                               <span class="stringliteral">&quot;(chequeReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTItem::voucherReceipt</a>) &amp;&amp;
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. &quot;</span>
                               <span class="stringliteral">&quot;(voucherReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTItem::marketReceipt</a>) &amp;&amp;
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. &quot;</span>
                               <span class="stringliteral">&quot;(marketReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTItem::paymentReceipt</a>) &amp;&amp; 
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. &quot;</span>
                               <span class="stringliteral">&quot;(paymentReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTItem::transferReceipt</a>) &amp;&amp; 
                (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()    != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type. &quot;</span>
                               <span class="stringliteral">&quot;(transferReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            
            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTItem::basketReceipt</a>) &amp;&amp; 
                <span class="comment">// ---------------------------------------------------------</span>
                ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>) ||
                 (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
                )
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type, &quot;</span>
                               <span class="stringliteral">&quot;or mismatched closing num. (basketReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            <span class="keywordflow">if</span> ((pSubItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()        == <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTItem::finalReceipt</a>) &amp;&amp; 
                <span class="comment">// ---------------------------------------------------------</span>
                ((pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>()   != <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>) ||
                 (pSubItem-&gt;<a class="code" href="class_o_t_item.html#ad0c9e5a00545fd6088f2317f65340daa">GetClosingNum</a>() != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
                )
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTransaction::%s: Inbox transaction (%lld) wrong type, &quot;</span>
                               <span class="stringliteral">&quot;or mismatched closing num. (finalReceipt block)\n&quot;</span>,
                               __FUNCTION__, pSubItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

        } <span class="comment">// else pSubItem WAS found on the old receipt     </span>
        
        <span class="comment">// ---------------</span>
        <span class="comment">// Next I need to find out the transaction number that I ORIGINALLY used, that&#39;s somehow associated with the receipt</span>
        <span class="comment">// I found in my inbox, by looking up the number from within the receipt...</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strRespTo;
        int64_t lIssuedNum = 0; <span class="comment">// The number that must STILL be signed out to me, in order for this receipt not be warrant disputing.</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pFinalReceiptTransaction = NULL;
        
        <span class="keywordflow">switch</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
        {
            <span class="comment">// ----------------------------------------------------------------------</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: <span class="comment">// a transfer receipt is in reference to some guy&#39;s acceptPending</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
                
                lIssuedNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ad39211b22193f35493b07e2eea92d3f5">GetNumberOfOrigin</a>();
                <span class="keywordflow">break</span>;
            <span class="comment">// ----------------------------------------------------------------------</span>
            <span class="comment">// ANY cron-related receipts should go here...</span>
            <span class="comment">//</span>
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>: 
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:     <span class="comment">// a payment receipt #92 is IN REFERENCE TO my payment plan #13, </span>
                                                    <span class="comment">// which I am still signed out for... UNTIL the final receipt appears.</span>
                <span class="comment">// Once a final receipt appears that is &quot;in reference to&quot; the same number as a marketReceipt (or paymentReceipt)</span>
                <span class="comment">// then the paymentReceipt #92 is now IN REFERENCE TO my payment plan #13, WHICH IS CLOSED FOR NEW PAYMENTS, BUT</span>
                <span class="comment">// THE PAYMENT RECEIPT ITSELF IS STILL VALID UNTIL THE &quot;closing transaction num&quot; ON THAT FINAL RECEIPT IS CLOSED.</span>
                <span class="comment">//</span>
                <span class="comment">// Therefore I first need to see if the final receipt is PRESENT in the inbox, so I can then determine</span>
                <span class="comment">// which number should be expected to be found on my ISSUED list of transaction numbers.</span>
                <span class="comment">//</span>
                pFinalReceiptTransaction = pInbox-&gt;<a class="code" href="class_o_t_ledger.html#ab4a37c7036b68bf5e4496848bddb1953">GetFinalReceipt</a>(pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());

                <span class="keywordflow">if</span> (NULL != pFinalReceiptTransaction) <span class="comment">// FINAL RECEIPT WAS FOUND</span>
                    lIssuedNum = pFinalReceiptTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>(); <span class="comment">// &lt;===============</span>
                <span class="keywordflow">else</span>    <span class="comment">// NOT found...</span>
                    lIssuedNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(); <span class="comment">// &lt;===============</span>
                
                <span class="comment">// If marketReceipt #15 is IN REFERENCE TO original market offer #10,</span>
                <span class="comment">// then the &quot;ISSUED NUM&quot; that is still open on my &quot;signed out&quot; list is #10.</span>
                <span class="comment">//</span>
                <span class="comment">// UNLESS!! Unless a final receipt is present in reference to this same number, in which</span>
                <span class="comment">// case the CLOSING TRANSACTION NUMBER stored on that final receipt will become my ISSUED NUM</span>
                <span class="comment">// for the purposes of this code.  (Because the original number IS closed, but the marketReceipt is</span>
                <span class="comment">// also still valid until the FINAL RECEIPT is closed.)</span>
                <span class="comment">//               </span>
                <span class="keywordflow">break</span>;               
            <span class="comment">// ----------------------------------------------------------------------</span>
        
                <span class="comment">// basketReceipt always expects the issued num to be its &quot;closing num&quot;. The &quot;reference to&quot; is instead</span>
                <span class="comment">// expected to contain the basketExchange ID (Trans# of the original request to exchange, which is already closed.)</span>
                <span class="comment">//</span>
                <span class="comment">// Final Receipt expects that its &quot;in reference to&quot; is already closed (that&#39;s why the final receipt even exists...)</span>
                <span class="comment">// Its own GetClosingNum() now contains the only valid possible transaction number for this receipt (and for any related</span>
                <span class="comment">// to it in this same inbox, which share the same &quot;in reference to&quot; number...</span>
                
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:
            <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
                
                lIssuedNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>();
                <span class="keywordflow">break</span>;
                
            <span class="comment">// ----------------------------------------------------------------------</span>
            <span class="keywordflow">default</span>:
                <span class="keywordflow">continue</span>; <span class="comment">// Below this point (inside the loop) is ONLY for receipts that somehow represent a transaction number that&#39;s still issued / signed out to me.</span>
        }
        <span class="comment">// -----------------------------------------------</span>
        
        <span class="comment">// Whether pSubItem is NULL or not, pTransaction DEFINITELY exists either way, in the newest inbox.</span>
        <span class="comment">// Therefore, let&#39;s verify whether I&#39;m even responsible for that transaction number... (Just because I signed</span>
        <span class="comment">// the instrument at some point in the past does NOT mean that I&#39;m still responsible for the transaction number</span>
        <span class="comment">// that&#39;s listed on the instrument. Maybe I already used it up a long time ago...)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (!theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lIssuedNum))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Error verifying if transaction num in inbox (%lld) was actually signed out (%lld)\n&quot;</span>,
                          __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), lIssuedNum);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        
        <span class="comment">// NOTE: the above check to VerifyIssuedNum... in the case of basketReceipts and finalReceipts, lIssuedNum is the CLOSING num </span>
        <span class="comment">// (this is already done.)</span>
        <span class="comment">// With marketReceipts and paymentReceipts, they check for the existence of a FINAL receipt, and if it&#39;s there, they use its CLOSING</span>
        <span class="comment">// NUM.  Otherwise they use the &quot;in reference to&quot; num.  With final receipts it uses its CLOSING NUM, since the original is </span>
        <span class="comment">// presumed closed.</span>
        
    } <span class="comment">// for</span>
    
    <span class="comment">// BY THIS POINT, I have lReceiptBalanceChange with the total change in the receipt, and</span>
    <span class="comment">// lInboxBalanceChange with the total change in the new inbox. The difference between the two</span>
    <span class="comment">// is the difference I should expect also in the account balances! That amount should also</span>
    <span class="comment">// be equal to lInboxSupposedDifference, which is the total of JUST the inbox receipts that</span>
    <span class="comment">// I DIDN&#39;T find in the old receipt (they were ONLY in the new inbox.)</span>
    <span class="comment">//</span>
    <span class="comment">// I have looped through all inbox items, and I know they were either found in the receipt&#39;s inbox record </span>
    <span class="comment">// (and verified), or their amounts were added to lInboxSupposedDifference as appropriate.</span>
    <span class="comment">//</span>
    <span class="comment">// I also verified, for each inbox item, IF IT TAKES MONEY, THEN IT MUST HAVE A TRANSACTION NUMBER</span>
    <span class="comment">// SIGNED OUT TO ME... Otherwise I could dispute it. The last code above verifies this.</span>
    <span class="comment">//</span>
    <span class="comment">// All that&#39;s left is to make sure the balance is right...</span>
    <span class="comment">//</span>
    <span class="comment">// --------------------------------------------------</span>
    
    <span class="comment">// VERIFY ACCOUNT BALANCE (RECONCILING WITH NEW INBOX RECEIPTS)</span>

    <span class="comment">// lReceiptBalanceChange    -- The balance of all the inbox items on the receipt (at least, the items that change the balance.)</span>
    <span class="comment">// lInboxBalanceChange      -- The balance of all the inbox items in the inbox (at least, the items that change the balance.)</span>
    <span class="comment">// lInboxSupposedDifference -- The balance of all the inbox items in the inbox that were NOT found in the receipt (that change balance.)</span>
    <span class="comment">// lAbsoluteDifference      -- The absolute difference between the inbox balance and the receipt balance. (Always positive.)</span>
    <span class="comment">// lAbsoluteDifference      -- The balance of all the inbox items (including new items) minus the old ones that were on the receipt.</span>
    
    <span class="comment">// (Helping me to visualize lInboxBalanceChange and lReceiptBalanceChange)</span>
    <span class="comment">//              ACTUAL          SIMPLE ADD/SUBTRACT     ADD/ABS</span>
    <span class="comment">// -5 -100  difference == 95    (-5 + -100 == -105)     105</span>
    <span class="comment">// 5   100  difference == 95    ( 5 +  100 ==  105)     105</span>
    <span class="comment">// -5  100  difference == 105   (-5 +  100 ==   95)      95</span>
    <span class="comment">// 5  -100  difference == 105   ( 5 + -100 ==  -95)      95</span>
    
    <span class="comment">// -100 -5  difference == 95    (-100 + -5 == -105)     105</span>
    <span class="comment">// 100  -5  difference == 105   ( 100 + -5 ==   95)      95</span>
    <span class="comment">// -100  5  difference == 105   (-100 +  5 ==  -95)      95</span>
    <span class="comment">// 100   5  difference == 95    ( 100 +  5 ==  105)     105</span>
    
    <span class="comment">// Above == wrong, Below == right.</span>
    
    <span class="comment">//                                                  ***SUBTRACT/ABS***</span>
    <span class="comment">// -5 -100  difference == 95    (-5 - -100 ==   95)      95 *</span>
    <span class="comment">// 5   100  difference == 95    ( 5 -  100 ==  -95)      95 *</span>
    <span class="comment">// -5  100  difference == 105   (-5 -  100 == -105)     105 *</span>
    <span class="comment">// 5  -100  difference == 105   ( 5 - -100 ==  105)     105 *</span>
    
    <span class="comment">// -100 -5  difference == 95    (-100 - -5 ==  -95)      95 *</span>
    <span class="comment">// 100  -5  difference == 105   ( 100 - -5 ==  105)     105 *</span>
    <span class="comment">// -100  5  difference == 105   (-100 -  5 == -105)     105 *</span>
    <span class="comment">// 100   5  difference == 95    ( 100 -  5 ==   95)      95 *</span>
    
    <span class="comment">// Based on the above table, the solution is to subtract one value from the other,</span>
    <span class="comment">// and then take the absolute of that to get the actual difference. Then use an </span>
    <span class="comment">// &#39;if&#39; statement to see which was larger, and based on that, calculate whether the</span>
    <span class="comment">// balance is what would be expected.</span>
    <span class="comment">//</span>
                                    <span class="comment">// -1099                    // -99 (example of 1000 absolute difference)</span>
    <span class="keyword">const</span> int64_t lAbsoluteDifference   = abs(lInboxBalanceChange - lReceiptBalanceChange); <span class="comment">// How much money came out? (Or went in, if the chequeReceipt was for an invoice...)</span>
                                    <span class="comment">// 901                      // -99 (example of 1000 absolute difference)</span>
    <span class="keyword">const</span> int64_t lNegativeDifference   = (lAbsoluteDifference*(-1));
    
    <span class="comment">// The new (current) inbox has a larger overall value than the balance in the old (receipt) inbox. (As shown by subitem.)</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNewInboxWasBigger       = ((lInboxBalanceChange &gt; lReceiptBalanceChange) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bNewInboxWasSmaller      = ((lInboxBalanceChange &lt; lReceiptBalanceChange) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
    
    <span class="comment">// --------------------------------</span>
    
    int64_t lActualDifference;
    
    <span class="keywordflow">if</span> (bNewInboxWasBigger)
        lActualDifference = lAbsoluteDifference;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bNewInboxWasSmaller)
        lActualDifference = lNegativeDifference;
    <span class="keywordflow">else</span>
        lActualDifference = 0;

    <span class="comment">// --------------------------------</span>

    <span class="comment">/*</span>
<span class="comment">     Example for logic:</span>
<span class="comment">     </span>
<span class="comment">     Old Inbox on Receipt:</span>
<span class="comment">     10</span>
<span class="comment">     15</span>
<span class="comment">     40</span>
<span class="comment">     lReceiptBalanceChange: 65</span>
<span class="comment">     Old Balance (in addition to these inbox items): 1000 (total 1065)</span>
<span class="comment">     </span>
<span class="comment">     New Inbox scenario A:</span>
<span class="comment">     10</span>
<span class="comment">     15</span>
<span class="comment">     40</span>
<span class="comment">     20     (lInboxSupposedDifference==(20))      20</span>
<span class="comment">     lInboxBalanceChange: 85</span>
<span class="comment">     </span>
<span class="comment">     New Inbox scenario B:</span>
<span class="comment">     10</span>
<span class="comment">     15</span>
<span class="comment">     40</span>
<span class="comment">     -20    (lInboxSupposedDifference==(-20))    -20</span>
<span class="comment">     lInboxBalanceChange: 45</span>
<span class="comment">     </span>
<span class="comment">     </span>
<span class="comment">     Inbox A: lAbsoluteDifference=abs(85-65)==abs( 20)==20</span>
<span class="comment">     Inbox B: lAbsoluteDifference=abs(45-65)==abs(-20)==20</span>
<span class="comment">     </span>
<span class="comment">     Inbox A: lNegativeDifference == -20</span>
<span class="comment">     Inbox B: lNegativeDifference == -20</span>
<span class="comment">         </span>
<span class="comment">     Inbox A:   bNewInboxWasBigger == TRUE, </span>
<span class="comment">                bNewInboxWasSmaller == FALSE</span>
<span class="comment"></span>
<span class="comment">     Inbox B:   bNewInboxWasBigger == FALSE,    </span>
<span class="comment">                bNewInboxWasSmaller == TRUE</span>
<span class="comment">     </span>
<span class="comment">     // --------------------------</span>
<span class="comment">     </span>
<span class="comment">     if (</span>
<span class="comment">     (bNewInboxWasBigger    &amp;&amp; (lAbsoluteDifference != lInboxSupposedDifference))   ||  // lInboxSupposedDifference should be positive here.</span>
<span class="comment">     (bNewInboxWasSmaller   &amp;&amp; (lNegativeDifference != lInboxSupposedDifference))       // lInboxSupposedDifference should be negative here.</span>
<span class="comment">     )</span>
<span class="comment"></span>
<span class="comment">     Inbox A:</span>
<span class="comment">     if (</span>
<span class="comment">     (TRUE  &amp;&amp; (20  != 20)) ||  // lInboxSupposedDifference should be positive here. ***</span>
<span class="comment">     (FALSE &amp;&amp; (-20 != 20))     // lInboxSupposedDifference should be negative here.</span>
<span class="comment">     )</span>
<span class="comment"></span>
<span class="comment">     Inbox B:</span>
<span class="comment">     if (</span>
<span class="comment">     (FALSE &amp;&amp; (20  != -20))    ||  // lInboxSupposedDifference should be positive here.</span>
<span class="comment">     (TRUE  &amp;&amp; (-20 != -20))        // lInboxSupposedDifference should be negative here. ***</span>
<span class="comment">     )</span>
<span class="comment">     </span>
<span class="comment">     ---------------</span>
<span class="comment">     if (</span>
<span class="comment">     (lActualDifference != lInboxSupposedDifference)</span>
<span class="comment">     )</span>
<span class="comment">     </span>
<span class="comment">     Inbox A (bigger): (lActualDifference is lAbsoluteDifference)</span>
<span class="comment">     if ( 20    != 20)</span>
<span class="comment"></span>
<span class="comment">     Inbox B (smaller): (lActualDifference is lNegativeDifference)</span>
<span class="comment">     if (-20    != -20)</span>
<span class="comment"></span>
<span class="comment">     */</span>
    
    <span class="comment">// If the actual difference between the two totals is not equal to the supposed difference from adding up just the new receipts,</span>
    <span class="comment">// (Which is probably impossible anyway) then return false.</span>
    <span class="keywordflow">if</span> (lActualDifference   !=  lInboxSupposedDifference)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: lActualDifference (%lld) is not equal to lInboxSupposedDifference (%lld)\n&quot;</span>
                      <span class="stringliteral">&quot;FYI, Inbox balance on old receipt: %lld  Inbox balance on current inbox: %lld\n&quot;</span>,
                      __FUNCTION__, lActualDifference, lInboxSupposedDifference,
                      lReceiptBalanceChange, lInboxBalanceChange);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// ---------------------------------------------</span>
    <span class="comment">// if, according to the two inboxes, they are different (in terms of how they would impact balance),</span>
    <span class="comment">// then therefore, they must have impacted my balance. THEREFORE, my old balance MUST be equivalent to</span>
    <span class="comment">// the current (apparently new) balance, PLUS OR MINUS THE DIFFERENCE, ACCORDING TO THE DIFFERENCE BETWEEN THE INBOXES.</span>
    <span class="comment">// If the actual difference (according to inbox receipts) + actual account balance (according to newest copy of account)</span>
    <span class="comment">// is not equal to the last signed balance agreement, then return false.</span>
    <span class="comment">//</span>
    <span class="comment">/*</span>
<span class="comment">     if (</span>
<span class="comment">     (bNewInboxWasBigger    &amp;&amp; (pBalanceItem-&gt;GetAmount()   != (THE_ACCOUNT.GetBalance() + lNegativeDifference)))   ||</span>
<span class="comment">     (bNewInboxWasSmaller   &amp;&amp; (pBalanceItem-&gt;GetAmount()   != (THE_ACCOUNT.GetBalance() + lAbsoluteDifference)))</span>
<span class="comment">     )</span>
<span class="comment"></span>
<span class="comment">     Inbox A (bigger):</span>
<span class="comment">     if (</span>
<span class="comment">     (TRUE  &amp;&amp; (1000    != (1020 + -20)))   ||</span>
<span class="comment">     (FALSE &amp;&amp; (1000    != (1020 +  20)))</span>
<span class="comment">     )</span>
<span class="comment">     ---</span>
<span class="comment">     Inbox B (smaller):</span>
<span class="comment">     if (</span>
<span class="comment">     (FALSE &amp;&amp; (1000    != (980 + -20)))    ||</span>
<span class="comment">     (TRUE  &amp;&amp; (1000    != (980 +  20)))</span>
<span class="comment">     )</span>
<span class="comment">     ---------------------------------------------------------------------</span>
<span class="comment">     </span>
<span class="comment">     if (pBalanceItem-&gt;GetAmount() != (THE_ACCOUNT.GetBalance() + (lActualDifference*(-1))))</span>
<span class="comment">     </span>
<span class="comment">     Inbox A (bigger):</span>
<span class="comment">     if (1000 != (1020 + -20))</span>
<span class="comment"></span>
<span class="comment">     Inbox B (smaller):</span>
<span class="comment">     if (1000 != (980 + 20))</span>
<span class="comment">     */</span>
    
    <span class="keywordflow">if</span> (pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>() != (THE_ACCOUNT.GetBalance() + (lActualDifference*(-1))))
    {
        <span class="comment">// Let&#39;s say ActualDifference == 10-3 (prev balance minus current balance) == 7.</span>
        <span class="comment">// If that&#39;s the case, then 7 + THE_ACCT.Balance should equal 10 again from the last balance statement!</span>

        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: lActualDifference in receipts (%lld) &quot;</span>
                      <span class="stringliteral">&quot;plus current acct balance (%lld) is NOT equal to last signed balance (%lld)\n&quot;</span>,
                      __FUNCTION__, lActualDifference, THE_ACCOUNT.GetBalance(), pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a8b3464bd470097e2a668e576106064f6">GetAmount</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;       
    }   
    
    <span class="comment">// At this point: all good!</span>
    <span class="comment">// </span>
    
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a51fc66087f5a0acdfc4a1054298b23b7"></a><!-- doxytag: member="OTTransaction::VerifyBoxReceipt" ref="a51fc66087f5a0acdfc4a1054298b23b7" args="(OTTransaction &amp;theFullVersion)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a51fc66087f5a0acdfc4a1054298b23b7">OTTransaction::VerifyBoxReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_transaction.html">OTTransaction</a> &amp;&#160;</td>
          <td class="paramname"><em>theFullVersion</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03285">3285</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a> || theFullVersion.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failure: This transaction &quot;</span>
                      <span class="stringliteral">&quot;isn&#39;t abbreviated (val: %s), or the purported full version erroneously is (val: %s). &quot;</span>
                      <span class="stringliteral">&quot;Either way, you can&#39;t use it in this way, for trans num: %lld\n&quot;</span>,
                      __FUNCTION__, <a class="code" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">m_bIsAbbreviated</a> ? <span class="stringliteral">&quot;IS&quot;</span> : <span class="stringliteral">&quot;IS NOT&quot;</span>,
                      theFullVersion.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>() ? <span class="stringliteral">&quot;IS&quot;</span> : <span class="stringliteral">&quot;IS NOT&quot;</span>,
                      <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------</span>
    <span class="comment">// VERIFY THE HASH</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>   idFullVersion;   <span class="comment">// Generate a message digest of that string.</span>
    theFullVersion.<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idFullVersion);
    
    <span class="comment">// Abbreviated version (*this) stores a hash of the original full version.</span>
    <span class="comment">// Sooo... let&#39;s hash the purported &quot;full version&quot; that was passed in, and</span>
    <span class="comment">// compare it to the stored one.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">m_Hash</a> != idFullVersion) 
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failure: The purported &#39;full version&#39; of the transaction, &quot;</span>
                      <span class="stringliteral">&quot;passed in for verification fails to match the stored hash value for trans num: %lld\n&quot;</span>,
                      __FUNCTION__, <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------</span>
    <span class="comment">// BY THIS POINT, we already know it&#39;s a definite match.</span>
    <span class="comment">// But we check a few more things, just to be safe.</span>
    <span class="comment">// Such as the TRANSACTION NUMBER...</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() != theFullVersion.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()) 
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failure: The purported &#39;full version&#39; of the transaction &quot;</span>
                      <span class="stringliteral">&quot;passed in (number %lld) fails to match the actual transaction number: %lld\n&quot;</span>,
                      __FUNCTION__, theFullVersion.<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>(), <a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------</span>
    <span class="comment">// THE &quot;IN REFERENCE TO&quot; NUMBER (DISPLAY VERSION)</span>
    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_transaction.html#a5d52aa9eeff78830b9ba53585e36a2ad">GetAbbrevInRefDisplay</a>() != theFullVersion.<a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::%s: Failure: The purported &#39;full version&#39; of the transaction &quot;</span>
                      <span class="stringliteral">&quot;passed, GetReferenceNumForDisplay() (%lld) fails to match the GetAbbrevInRefDisplay (%lld) on this.\n&quot;</span>,
                      __FUNCTION__, theFullVersion.<a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>(), this-&gt;<a class="code" href="class_o_t_transaction.html#a5d52aa9eeff78830b9ba53585e36a2ad">GetAbbrevInRefDisplay</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ---------------------</span>
    
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acf756f8e3b1d1b9f1e9d2bcb48cbe927"></a><!-- doxytag: member="OTTransaction::VerifyBoxReceiptExists" ref="acf756f8e3b1d1b9f1e9d2bcb48cbe927" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID, const int32_t nBoxType, const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#acf756f8e3b1d1b9f1e9d2bcb48cbe927">OTTransaction::VerifyBoxReceiptExists</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>nBoxType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03247">3247</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> int64_t lLedgerType = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span> (nBoxType);
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strUserOrAcctID(0 == lLedgerType ? USER_ID : ACCOUNT_ID); <span class="comment">// (For Nymbox aka type 0, the UserID will be here.)</span>
    <span class="comment">// -------------------------------------------------------------------- </span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFolder1name, strFolder2name, strFolder3name, strFilename;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_transaction.html#a186d091553baa52c0d1e252b05432e4d">OTTransaction::SetupBoxReceiptFilename</a>(lLedgerType, <span class="comment">// nBoxType is lLedgerType</span>
                                                        strUserOrAcctID,
                                                        strServerID,
                                                        lTransactionNum,
                                                        <span class="stringliteral">&quot;OTTransaction::VerifyBoxReceiptExists&quot;</span>,
                                                        strFolder1name, strFolder2name, strFolder3name,
                                                        strFilename))
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// This already logs -- no need to log twice, here.</span>
    <span class="comment">// -------------------------------------------------------------------- </span>
    <span class="comment">// See if the box receipt exists before trying to save over it...</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bExists = <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                      strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                      strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                                      strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    
    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;OTTransaction::%s: %s: %s%s%s%s%s%s%s\n&quot;</span>, bExists ? <span class="stringliteral">&quot;(Already have this one)&quot;</span> : <span class="stringliteral">&quot;(Need to download this one)&quot;</span>,
                   __FUNCTION__, strFolder1name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                   strFolder2name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                   strFolder3name.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                   strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
    
    <span class="keywordflow">return</span> bExists;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a196bf845f57deaf4e04493e462fd6d97"></a><!-- doxytag: member="OTTransaction::VerifyItems" ref="a196bf845f57deaf4e04493e462fd6d97" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a196bf845f57deaf4e04493e462fd6d97">OTTransaction::VerifyItems</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l03346">3346</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// loop through the ALL items that make up this transaction and check to see if a response to deposit.</span>
    <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = NULL;
    
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYM_ID(theNym);
    
    <span class="keywordflow">if</span> (NYM_ID != <a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Wrong owner passed to OTTransaction::VerifyItems\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// I&#39;m not checking signature on transaction itself since that is already</span>
    <span class="comment">// checked before this function is called. But I AM calling Verify Owner,</span>
    <span class="comment">// so that when Verify Owner is called in the loop below, it proves the items</span>
    <span class="comment">// and the transaction both have the same owner: Nym.</span>
    
    <span class="comment">// if pointer not null, and it&#39;s a withdrawal, and it&#39;s an acknowledgement (not a rejection or error)</span>
    <span class="comment">//</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, <a class="code" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">GetItemList</a>())
    {
        pItem = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem);
        
        <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>() != pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>())
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        
        <span class="keywordflow">if</span> (NYM_ID != pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>())
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == pItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(theNym)) <span class="comment">// NO need to call VerifyAccount since VerifyContractID is ALREADY called and now here&#39;s VerifySignature().</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>; 
    }   
    
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3ce6cac1f366f808f0296473138363eb"></a><!-- doxytag: member="OTTransaction::VerifyTransactionReceipt" ref="a3ce6cac1f366f808f0296473138363eb" args="(OTPseudonym &amp;SERVER_NYM, OTPseudonym &amp;THE_NYM, OTIdentifier &amp;SERVER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a3ce6cac1f366f808f0296473138363eb">OTTransaction::VerifyTransactionReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l01271">1271</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> USER_ID(THE_NYM), SERVER_USER_ID(SERVER_NYM);
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(SERVER_ID), strReceiptID(USER_ID);

    <a class="code" href="class_o_t_string.html">OTString</a> strFilename; strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s.success&quot;</span>, strReceiptID.Get());
    
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder1name  = <a class="code" href="class_o_t_folders.html#ad5d313f4dc313c7b79780288c14e9c83">OTFolders::Receipt</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();   <span class="comment">// receipts</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFolder2name  = strServerID.Get();        <span class="comment">// receipts/SERVER_ID</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();        <span class="comment">// receipts/SERVER_ID/USER_ID.success</span>
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFolder1name, szFolder2name, szFilename))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(1, <span class="stringliteral">&quot;Receipt file doesn&#39;t exist in OTTransaction::VerifyTransactionReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    std::string strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFolder1name, szFolder2name, szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>
    
    <span class="keywordflow">if</span> (strFileContents.length() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Error reading file: %s%s%s%s%s\n&quot;</span>, 
                      szFolder1name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFolder2name, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
        
    <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(strFileContents.c_str());

    <a class="code" href="class_o_t_transaction_type.html">OTTransactionType</a> * pContents = <a class="code" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a>(strTransaction);
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransactionType&gt;</a> theAngel(pContents);
    
    <span class="keywordflow">if</span> ((NULL == pContents) || (<span class="keyword">false</span> == pContents-&gt;VerifySignature(SERVER_NYM)))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Unable to load or verify transaction statement:&quot;</span>
                      <span class="stringliteral">&quot; %s%s%s%s%s\n&quot;</span>,
                      szFolder1name,            <span class="comment">// receipts</span>
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      szFolder2name,            <span class="comment">// receipts/SERVER_ID</span>
                      <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), 
                      szFilename);              <span class="comment">// receipts/SERVER_ID/USER_ID.success</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }               
    
    <span class="comment">// At this point, pContents is successfully loaded and verified, containing the last transaction receipt.</span>
    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTrans = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_transaction.html">OTTransaction</a> *<span class="keyword">&gt;</span>(pContents);
    
    <span class="keywordflow">if</span> (NULL != pTrans)
    {
        <span class="comment">// -----------------------------------------------------</span>
        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
        
        <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
        {
            int64_t lBoxType = 0;
            
                 <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))         lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>))  lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))     lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTrans-&gt;<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Error loading from abbreviated transaction: &quot;</span>
                             <span class="stringliteral">&quot;couldn&#39;t find nymboxRecord or inboxRecord or outboxRecord in raw contents of abbreviated &quot;</span>
                             <span class="stringliteral">&quot;transaction. Can&#39;t tell the ledger type from this.\n&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;           
            }
            <span class="comment">// --------------</span>
            pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(*pTrans, lBoxType);
            <span class="keywordflow">if</span> (NULL == pTransaction)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Error loading from abbreviated transaction: &quot;</span>
                              <span class="stringliteral">&quot;failed loading box receipt.&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;           
            }
            <span class="comment">// ----------------</span>
            theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
        }
        <span class="keywordflow">else</span>
            pTransaction = pTrans;
        <span class="comment">// -----------------------------------------------------        </span>
        <span class="keywordflow">return</span> pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a3ce6cac1f366f808f0296473138363eb">VerifyTransactionReceipt</a>(SERVER_NYM, THE_NYM);
    }
    <span class="keywordflow">else</span>   
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Error... dynamic_cast failed.\n&quot;</span>);
        
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3133d3def40d31a08f169b406f847b5f"></a><!-- doxytag: member="OTTransaction::VerifyTransactionReceipt" ref="a3133d3def40d31a08f169b406f847b5f" args="(OTPseudonym &amp;SERVER_NYM, OTPseudonym &amp;THE_NYM)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a3ce6cac1f366f808f0296473138363eb">OTTransaction::VerifyTransactionReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_NYM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_NYM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8cpp_source.html#l01164">1164</a> of file <a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTransaction::VerifyTransactionReceipt: Error: This is an abbreviated receipt. (Load the box receipt first.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------</span>
    <span class="comment">// LOAD &quot;AT TRANSACTION STATEMENT&quot; (ITEM)</span>
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = NULL;
    
    <a class="code" href="class_o_t_item.html">OTItem</a> * pResponseBalanceItem = <a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>);
    
    <span class="keywordflow">if</span> (NULL == pResponseBalanceItem)
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No atTransactionStatement item found on receipt (strange.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a> != pResponseBalanceItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Error: atTransactionStatement found on receipt, but not a successful one.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;       
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pResponseBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(SERVER_NYM))
    {       
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on atTransactionStatement item in OTTransaction::VerifyTransactionReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// ------------------------------------</span>
    
    <span class="comment">// LOAD &quot;TRANSACTION STATEMENT&quot; (ITEM)</span>
    
    <a class="code" href="class_o_t_string.html">OTString</a> strBalanceItem;
    pResponseBalanceItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strBalanceItem);
    
    <span class="keywordflow">if</span> (!strBalanceItem.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <span class="comment">// error, return.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;No transactionStatement item found as &#39;in ref to&#39; string on a receipt containing atTransactionStatement item.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    pBalanceItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strBalanceItem, 
                                                <a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), 
                                                pResponseBalanceItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
    
    <span class="keywordflow">if</span> (NULL == pBalanceItem)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load transactionStatement item from string (from a receipt containing an atTransactionStatement item.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() != <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a670c28ed39e72f752c91165aa937c51b">OTItem::transactionStatement</a>)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Wrong type on pBalanceItem (expected OTItem::transactionStatement)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pBalanceItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(THE_NYM))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify signature on transactionStatement item in OTTransaction::VerifyTransactionReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// ---------------------------------------------------------</span>
    
    <span class="comment">// LOAD MESSAGE NYM (THE LIST OF ISSUED NUMBERS ACCORDING TO THE RECEIPT.)</span>
    
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym;
    <a class="code" href="class_o_t_string.html">OTString</a>    strMessageNym; <span class="comment">// Okay now we have the transaction numbers in this MessageNym string.</span>
    
    pBalanceItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strMessageNym); 
    
    <span class="keywordflow">if</span> (!strMessageNym.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strMessageNym))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to load message nym in OTTransaction::VerifyTransactionReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// ------------------------------------</span>
    
    <span class="comment">// VERIFY THE LIST OF ISSUED (SIGNED FOR) TRANSACTION NUMBERS ON THE NYM AGAINST THE RECEIPT.</span>
    
    <span class="comment">// It&#39;s okay if some transaction #s in theMessageNym (the receipt) aren&#39;t found on THE_NYM, (client-side)</span>
    <span class="comment">// since the last balance agreement may have cleaned them out after they were recorded in</span>
    <span class="comment">// theMessageNym (from the transaction statement receipt).</span>
    <span class="comment">//</span>
    <span class="comment">// But I should never see transaction #s APPEAR in THE_NYM that aren&#39;t in theMessageNym,</span>
    <span class="comment">// since a balance agreement (or a finalReceipt) can ONLY remove numbers, not add them.</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!THE_NYM.<a class="code" href="class_o_t_pseudonym.html#a52932b9c7bbb25ca21e1bf83d067e138">VerifyTransactionStatementNumbersOnNym</a>(theMessageNym))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;Unable to verify issued numbers on last signed receipt with numbers on THE_NYM in OTTransaction::VerifyTransactionReceipt.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;               
    }
    
    <span class="comment">// -------------------------------------------------------  </span>
    
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a50cdde745e8606b4c07fd2ca1a18251f"></a><!-- doxytag: member="OTTransaction::OTTransactionType::TransactionFactory" ref="a50cdde745e8606b4c07fd2ca1a18251f" args="(OTString strInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction_type.html">OTTransactionType</a>* <a class="el" href="class_o_t_transaction_type.html#a3322a8680cb317a52691b17aa23da79d">OTTransactionType::TransactionFactory</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a>&#160;</td>
          <td class="paramname"><em>strInput</em></td><td>)</td>
          <td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a115f7417f09e3e815212d770e7b60a1b"></a><!-- doxytag: member="OTTransaction::m_ascCancellationRequest" ref="a115f7417f09e3e815212d770e7b60a1b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> <a class="el" href="class_o_t_transaction.html#a115f7417f09e3e815212d770e7b60a1b">OTTransaction::m_ascCancellationRequest</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00503">503</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae02e3420135cba3514b4131d6427641d"></a><!-- doxytag: member="OTTransaction::m_bCancelled" ref="ae02e3420135cba3514b4131d6427641d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#ae02e3420135cba3514b4131d6427641d">OTTransaction::m_bCancelled</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00546">546</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1298e2f51b0a9471bc6b1aa8905b70f9"></a><!-- doxytag: member="OTTransaction::m_bIsAbbreviated" ref="a1298e2f51b0a9471bc6b1aa8905b70f9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a1298e2f51b0a9471bc6b1aa8905b70f9">OTTransaction::m_bIsAbbreviated</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00456">456</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1631d08ab9b9759c5743fa0bfe9f7bdf"></a><!-- doxytag: member="OTTransaction::m_bReplyTransSuccess" ref="a1631d08ab9b9759c5743fa0bfe9f7bdf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_transaction.html#a1631d08ab9b9759c5743fa0bfe9f7bdf">OTTransaction::m_bReplyTransSuccess</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00517">517</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a88cd59fd4658e157f04e6b5b9a1868e0"></a><!-- doxytag: member="OTTransaction::m_DATE_SIGNED" ref="a88cd59fd4658e157f04e6b5b9a1868e0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="el" href="class_o_t_transaction.html#a88cd59fd4658e157f04e6b5b9a1868e0">OTTransaction::m_DATE_SIGNED</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00498">498</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aecaea3ab1909c7102800ac991771b84d"></a><!-- doxytag: member="OTTransaction::m_Hash" ref="aecaea3ab1909c7102800ac991771b84d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> <a class="el" href="class_o_t_transaction.html#aecaea3ab1909c7102800ac991771b84d">OTTransaction::m_Hash</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00495">495</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae1f24fb2a4460c4b695e7628fc78890e"></a><!-- doxytag: member="OTTransaction::m_lAbbrevAmount" ref="ae1f24fb2a4460c4b695e7628fc78890e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#ae1f24fb2a4460c4b695e7628fc78890e">OTTransaction::m_lAbbrevAmount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00465">465</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3a2b17e72ec599dece6eb13208bde37c"></a><!-- doxytag: member="OTTransaction::m_lClosingTransactionNo" ref="a3a2b17e72ec599dece6eb13208bde37c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a3a2b17e72ec599dece6eb13208bde37c">OTTransaction::m_lClosingTransactionNo</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00502">502</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0fd4b204101be3362541aa18ecdfbcfe"></a><!-- doxytag: member="OTTransaction::m_lDisplayAmount" ref="a0fd4b204101be3362541aa18ecdfbcfe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a0fd4b204101be3362541aa18ecdfbcfe">OTTransaction::m_lDisplayAmount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00477">477</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a73e1013374088a3a36fb83007a80c4bf"></a><!-- doxytag: member="OTTransaction::m_lInRefDisplay" ref="a73e1013374088a3a36fb83007a80c4bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a73e1013374088a3a36fb83007a80c4bf">OTTransaction::m_lInRefDisplay</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00482">482</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0a69941e6ccf8c6f399e06fbe2901c86"></a><!-- doxytag: member="OTTransaction::m_listItems" ref="a0a69941e6ccf8c6f399e06fbe2901c86" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a> <a class="el" href="class_o_t_transaction.html#a0a69941e6ccf8c6f399e06fbe2901c86">OTTransaction::m_listItems</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00500">500</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6fc95646e555b9c2ffb1404c6475ef56"></a><!-- doxytag: member="OTTransaction::m_lRequestNumber" ref="a6fc95646e555b9c2ffb1404c6475ef56" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_transaction.html#a6fc95646e555b9c2ffb1404c6475ef56">OTTransaction::m_lRequestNumber</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00516">516</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="abb869752baf350d380c0afa81d84d1de"></a><!-- doxytag: member="OTTransaction::m_pParent" ref="abb869752baf350d380c0afa81d84d1de" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="class_o_t_ledger.html">OTLedger</a>* <a class="el" href="class_o_t_transaction.html#abb869752baf350d380c0afa81d84d1de">OTTransaction::m_pParent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00447">447</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a11a0ffdda3eec332af5637526560ee6d"></a><!-- doxytag: member="OTTransaction::m_Type" ref="a11a0ffdda3eec332af5637526560ee6d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8">transactionType</a> <a class="el" href="class_o_t_transaction.html#a11a0ffdda3eec332af5637526560ee6d">OTTransaction::m_Type</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_transaction_8hpp_source.html#l00499">499</a> of file <a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_transaction_8hpp_source.html">OTTransaction.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_transaction_8cpp_source.html">OTTransaction.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_transaction.html">OTTransaction</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:17 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
