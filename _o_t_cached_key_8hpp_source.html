<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: include/otlib/OTCachedKey.hpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_o_t_cached_key_8hpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">include/otlib/OTCachedKey.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_o_t_cached_key_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *  OTCachedKey.hpp</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00009"></a>00009 <span class="comment"> Hash: SHA1</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00014"></a>00014 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00017"></a>00017 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> *  EMAIL:</span>
<a name="l00027"></a>00027 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00032"></a>00032 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00035"></a>00035 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00036"></a>00036 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> *  WEBSITE:</span>
<a name="l00039"></a>00039 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *  Components and licensing:</span>
<a name="l00042"></a>00042 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00043"></a>00043 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00048"></a>00048 <span class="comment"> *</span>
<a name="l00049"></a>00049 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00050"></a>00050 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00051"></a>00051 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00052"></a>00052 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *   LICENSE:</span>
<a name="l00057"></a>00057 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00058"></a>00058 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00059"></a>00059 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00060"></a>00060 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00061"></a>00061 <span class="comment"> *   option) any later version.</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00064"></a>00064 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00065"></a>00065 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00066"></a>00066 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00067"></a>00067 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00068"></a>00068 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00069"></a>00069 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00070"></a>00070 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00071"></a>00071 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00072"></a>00072 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00073"></a>00073 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00074"></a>00074 <span class="comment"> *</span>
<a name="l00075"></a>00075 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00076"></a>00076 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00077"></a>00077 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00078"></a>00078 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00079"></a>00079 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00080"></a>00080 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00081"></a>00081 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00082"></a>00082 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00083"></a>00083 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00084"></a>00084 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *   Lucre License:</span>
<a name="l00087"></a>00087 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00088"></a>00088 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00089"></a>00089 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00090"></a>00090 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00091"></a>00091 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00092"></a>00092 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00093"></a>00093 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00094"></a>00094 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00095"></a>00095 <span class="comment"> *   will continue to operate.</span>
<a name="l00096"></a>00096 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00097"></a>00097 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00098"></a>00098 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00099"></a>00099 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00100"></a>00100 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00101"></a>00101 <span class="comment"> *</span>
<a name="l00102"></a>00102 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00103"></a>00103 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00104"></a>00104 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00105"></a>00105 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00106"></a>00106 <span class="comment"> *</span>
<a name="l00107"></a>00107 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00108"></a>00108 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00109"></a>00109 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00110"></a>00110 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00111"></a>00111 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00112"></a>00112 <span class="comment"> *   more details.</span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00115"></a>00115 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00116"></a>00116 <span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00118"></a>00118 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00119"></a>00119 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00120"></a>00120 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00121"></a>00121 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00122"></a>00122 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00123"></a>00123 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00124"></a>00124 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00125"></a>00125 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00126"></a>00126 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00127"></a>00127 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00128"></a>00128 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00129"></a>00129 <span class="comment"> =uSzz</span>
<a name="l00130"></a>00130 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00131"></a>00131 <span class="comment"> **************************************************************/</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#ifndef __OT_CACHED_KEY_HPP__</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span><span class="preprocessor">#define __OT_CACHED_KEY_HPP__</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_common_8hpp.html">OTCommon.hpp</a>&quot;</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="preprocessor">#include &quot;tinythread.hpp&quot;</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="keyword">class </span><a class="code" href="class_o_t_string.html">OTString</a>;
<a name="l00144"></a>00144 <span class="keyword">class </span><a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a>;
<a name="l00145"></a>00145 <span class="keyword">class </span><a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a>;
<a name="l00146"></a>00146 <span class="keyword">class </span><a class="code" href="class_o_t_cached_key.html">OTCachedKey</a>;
<a name="l00147"></a>00147 <span class="keyword">class </span><a class="code" href="class_o_t_password.html">OTPassword</a>;
<a name="l00148"></a>00148 <span class="keyword">class </span><a class="code" href="class_o_t_identifier.html">OTIdentifier</a>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00156"></a>00156 
<a name="l00245"></a>00245 <span class="comment">// This is only the hard-coded default; it&#39;s also configurable in the opt file.</span>
<a name="l00246"></a>00246 <span class="comment">//</span>
<a name="l00247"></a><a class="code" href="_o_t_cached_key_8hpp.html#a359f8993fefe08ca989f8715ec6f0a43">00247</a> <span class="preprocessor">#define OT_MASTER_KEY_TIMEOUT  300</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>
<a name="l00249"></a><a class="code" href="_o_t_cached_key_8hpp.html#a32c9259e56d708a983d9fb79fee41403">00249</a> <span class="keyword">typedef</span> std::map&lt;std::string, _SharedPtr&lt;OTCachedKey&gt; &gt; <a class="code" href="_o_t_cached_key_8hpp.html#a32c9259e56d708a983d9fb79fee41403">mapOfCachedKeys</a>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="class_o_t_cached_key.html">00252</a> <span class="keyword">class </span><a class="code" href="class_o_t_cached_key.html">OTCachedKey</a>
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254 <span class="keyword">private</span>:
<a name="l00255"></a>00255     tthread::thread       *  m_pThread;         <span class="comment">// The thread used for destroying the password after the timeout period.</span>
<a name="l00256"></a>00256     int32_t                      m_nTimeoutSeconds; <span class="comment">// The master password will be stored internally for X seconds, and then destroyed.</span>
<a name="l00257"></a>00257     <a class="code" href="class_o_t_password.html">OTPassword</a>            *  m_pMasterPassword; <span class="comment">// Created when password is passed in; destroyed by Timer after X seconds.</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="keywordtype">bool</span>                     m_bUse_System_Keyring; <span class="comment">// if set to true, then additionally use the local OS&#39;s standard API for storing/retrieving secrets. (Store the master key here whenever it&#39;s decrypted, and try to retrieve from here whenever it&#39;s needed, before resorting to asking the user to type his passphrase.) This is configurable in the config file.</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <a class="code" href="class_o_t_symmetric_key.html">OTSymmetricKey</a>        *  m_pSymmetricKey;   <span class="comment">// Encrypted form of the master key. Serialized by OTWallet or OTServer.</span>
<a name="l00262"></a>00262     tthread::mutex           m_Mutex;           <span class="comment">// Mutex used for serializing access to this instance.</span>
<a name="l00263"></a>00263     <span class="keywordtype">bool</span>                     m_bPaused;         <span class="comment">// If you want to force the old system, PAUSE the master key (REMEMBER to Unpause when done!)</span>
<a name="l00264"></a>00264     <span class="comment">// -----------------------------------------------------------</span>
<a name="l00265"></a>00265     <a class="code" href="class_o_t_cached_key.html">OTCachedKey</a>(int32_t nTimeoutSeconds=<a class="code" href="_o_t_cached_key_8hpp.html#a359f8993fefe08ca989f8715ec6f0a43">OT_MASTER_KEY_TIMEOUT</a>);
<a name="l00266"></a>00266     <span class="comment">// -----------------------------------------------------------</span>
<a name="l00267"></a>00267     <span class="keyword">static</span> tthread::mutex   s_mutexThreadTimeout;
<a name="l00268"></a>00268     <span class="comment">// -----------------------------------------------------------</span>
<a name="l00269"></a>00269     <span class="keyword">static</span> tthread::mutex   s_mutexCachedKeys;
<a name="l00270"></a>00270     <span class="keyword">static</span> <a class="code" href="_o_t_cached_key_8hpp.html#a32c9259e56d708a983d9fb79fee41403">mapOfCachedKeys</a>  s_mapCachedKeys;  <span class="comment">// Now we have many &quot;master keys,&quot; mapped by their symmetric key ID. These are actually temps, just so we can safely cache the passphrases for various symmetric keys, between uses of that symmetric key. Such as Pop&#39;ing tokens off of a purse, over and over again. Normally in the API, this would have to load the key each time. By caching here, we can exploit all the cool master key code, with its security, and threads, and timeouts, etc for every symmetric key we use. Just pass an ID into It() and if it&#39;s on the map, a pointer will be returned. Pass NULL into It() (no arguments) to get a pointer to the global Master Key (for Nyms.)</span>
<a name="l00271"></a>00271 <span class="keyword">public</span>:
<a name="l00272"></a><a class="code" href="class_o_t_cached_key.html#a0b51adc5e45ea1e377febeaad27dbb60">00272</a>     tthread::mutex       * <a class="code" href="class_o_t_cached_key.html#a0b51adc5e45ea1e377febeaad27dbb60">GetMutex</a>() { <span class="keywordflow">return</span> &amp;m_Mutex; } <span class="comment">// So static functions using this CachedKey can also lock its mutex.</span>
<a name="l00273"></a>00273     <span class="comment">// -----------------------------------------------------------</span>
<a name="l00274"></a>00274     EXPORT    <a class="code" href="class_o_t_cached_key.html">OTCachedKey</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascCachedKey);
<a name="l00275"></a>00275     EXPORT    <a class="code" href="class_o_t_cached_key.html#aad66d1eeb1f84fbcd82fe796bdb393bd">~OTCachedKey</a>();
<a name="l00276"></a>00276     <span class="comment">// -----------------------------------------------------------</span>
<a name="l00277"></a>00277     EXPORT    <span class="keyword">static</span> _SharedPtr&lt;OTCachedKey&gt; <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">It</a>(<a class="code" href="class_o_t_identifier.html">OTIdentifier</a> * pIdentifier=NULL); <span class="comment">// if you pass in a master key ID, it will look it up on an existing cached map of master keys. Otherwise it will use &quot;the&quot; global Master Key (the one used for the Nyms.)</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     EXPORT    <span class="keyword">static</span> _SharedPtr&lt;OTCachedKey&gt; <a class="code" href="class_o_t_cached_key.html#a8780b8a3f392b0bc4c11253a797d8b5a">It</a>(<a class="code" href="class_o_t_cached_key.html">OTCachedKey</a> &amp; theSourceKey); <span class="comment">// if you pass in a master key, it will look it up on an existing cached map of master keys, based on the ID of the master key passed in. If not there, it copies the one passed in, and returns a pointer to the copy. (Do NOT delete it.)</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     EXPORT    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_o_t_cached_key.html#a60f1041be525c88bde575ac183e64435">Cleanup</a>(); <span class="comment">// Call on application shutdown. Called in CleanupOTAPI and also in OTServer wherever it cleans up.</span>
<a name="l00282"></a>00282     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00283"></a>00283     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#acec139cffbbad3a4bc3e45e69748f43a">GetIdentifier</a>(<a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theIdentifier) <span class="keyword">const</span>;
<a name="l00284"></a>00284     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#acec139cffbbad3a4bc3e45e69748f43a">GetIdentifier</a>(<a class="code" href="class_o_t_string.html">OTString</a>     &amp; strIdentifier) <span class="keyword">const</span>;
<a name="l00285"></a>00285     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00286"></a>00286     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a841c81a6323383f9762f21cc820bbdab">IsGenerated</a>();
<a name="l00287"></a>00287     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a1b868584e683faa9cd4cc63bcd5bc3f4">HasHashCheck</a>();
<a name="l00288"></a>00288     <span class="comment">// --------------------------------</span>
<a name="l00289"></a><a class="code" href="class_o_t_cached_key.html#a95adb6583e128ed03719dc365e14005e">00289</a>     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a95adb6583e128ed03719dc365e14005e">IsUsingSystemKeyring</a>() { <span class="keywordflow">return</span> m_bUse_System_Keyring; }
<a name="l00290"></a><a class="code" href="class_o_t_cached_key.html#a6dd72d33332ed12525d15f0861960c5f">00290</a>     EXPORT    <span class="keywordtype">void</span>   <a class="code" href="class_o_t_cached_key.html#a6dd72d33332ed12525d15f0861960c5f">UseSystemKeyring</a>(<span class="keywordtype">bool</span> bUsing=<span class="keyword">true</span>) { m_bUse_System_Keyring = bUsing; } <span class="comment">// Start using system keyring.</span>
<a name="l00291"></a>00291     <span class="comment">// --------------------------------</span>
<a name="l00292"></a>00292     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#af778e40cf52dedde7c1896b3fbb2e02b">Pause</a>();
<a name="l00293"></a>00293     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a0fa693b734082f41578b9984d242dd79">Unpause</a>();
<a name="l00294"></a>00294     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#aef5e98808a18741cb9c8c240f702e996">isPaused</a>();
<a name="l00295"></a>00295     <span class="comment">// --------------------------------</span>
<a name="l00296"></a>00296     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a5f7a335ec7dc9ac8fd2b1ebf2ef26dd8">SerializeTo</a>   (      <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascOutput);
<a name="l00297"></a>00297     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#a4544aaabde49afd185df0fa05b775679">SerializeFrom</a> (<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascInput );
<a name="l00298"></a>00298     <span class="comment">// --------------------------------</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// These two functions are used by the OTServer or OTWallet that actually keeps</span>
<a name="l00301"></a>00301     <span class="comment">// the master key. The owner sets the master key pointer on initialization, and then</span>
<a name="l00302"></a>00302     <span class="comment">// later when the password callback code in OTAsymmetricKey needs to access the master</span>
<a name="l00303"></a>00303     <span class="comment">// key, it can use GetMasterPassword to access it.</span>
<a name="l00304"></a>00304     <span class="comment">//</span>
<a name="l00305"></a>00305     EXPORT    <span class="keywordtype">void</span>   <a class="code" href="class_o_t_cached_key.html#aa23079dbadddf2d7f2a2f205e3c05738">SetCachedKey</a>(<span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascCachedKey); <span class="comment">// OTServer/OTWallet calls this, I instantiate.</span>
<a name="l00306"></a>00306     <span class="comment">// --------------------------------</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     EXPORT    int32_t    <a class="code" href="class_o_t_cached_key.html#ac0de8ead34b8bff4913844507987e61a">GetTimeoutSeconds</a>();
<a name="l00309"></a>00309     EXPORT    <span class="keywordtype">void</span>   <a class="code" href="class_o_t_cached_key.html#a7b0822845b243c8f739f021d0f96bcd7">SetTimeoutSeconds</a>(int32_t nTimeoutSeconds); <span class="comment">// So we can load from the config file.</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="comment">// For Nyms, which have a global master key serving as their &quot;passphrase&quot; (for that wallet),</span>
<a name="l00312"></a>00312     <span class="comment">// The password callback uses OTCachedKey::It() to get the instance, and then GetMasterPassword</span>
<a name="l00313"></a>00313     <span class="comment">// to get the passphrase for any individual Nym. Otherwise, OTCachedKey::It(OTSymmetricKey *) looks</span>
<a name="l00314"></a>00314     <span class="comment">// up a cached master key based on the ID of the key passed in. For example, OTPurse has a symmetric</span>
<a name="l00315"></a>00315     <span class="comment">// key and master key (optionally, vs using a Nym.) The symmetric key contains the actual key for the</span>
<a name="l00316"></a>00316     <span class="comment">// tokens, and the master key is used for the passphrase, which may be cached, or may have timed out,</span>
<a name="l00317"></a>00317     <span class="comment">// and then re-retrieved from the user (either way). The purse, rather than using the global</span>
<a name="l00318"></a>00318     <span class="comment">// master key to get the passphrase, (which _would_ happen if the purse is encrypted to a nym) will</span>
<a name="l00319"></a>00319     <span class="comment">// instead use its own internal master key to get its passphrase (also retrieving from the user if</span>
<a name="l00320"></a>00320     <span class="comment">// necessary.)</span>
<a name="l00321"></a>00321     EXPORT    <span class="keywordtype">bool</span>   <a class="code" href="class_o_t_cached_key.html#ab5afd7677fed682812ac40de76f5f5db">GetMasterPassword</a>(_SharedPtr&lt;OTCachedKey&gt; &amp; mySharedPtr,
<a name="l00322"></a>00322                                              <a class="code" href="class_o_t_password.html">OTPassword</a>      &amp; theOutput,
<a name="l00323"></a>00323                                        <span class="keyword">const</span> <span class="keywordtype">char</span>            * szDisplay=NULL,
<a name="l00324"></a>00324                                              <span class="keywordtype">bool</span>              bVerifyTwice=<span class="keyword">false</span>);
<a name="l00325"></a>00325     <span class="comment">// Caller must delete!</span>
<a name="l00326"></a>00326     EXPORT  <span class="keyword">static</span> _SharedPtr&lt;OTCachedKey&gt; <a class="code" href="class_o_t_cached_key.html#a97bb15bbe2b2a100a5379b835c4b539d">CreateMasterPassword</a>(<a class="code" href="class_o_t_password.html">OTPassword</a> &amp; theOutput,
<a name="l00327"></a>00327                                                               <span class="keyword">const</span> <span class="keywordtype">char</span> * szDisplay=NULL,
<a name="l00328"></a>00328                                                               int32_t nTimeoutSeconds=<a class="code" href="_o_t_cached_key_8hpp.html#a359f8993fefe08ca989f8715ec6f0a43">OT_MASTER_KEY_TIMEOUT</a>);
<a name="l00329"></a>00329     <span class="comment">// --------------------------------</span>
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     EXPORT   <span class="keywordtype">void</span> <a class="code" href="class_o_t_cached_key.html#a6bf2bbe368339460eb08cf9dc42eeced">DestroyMasterPassword</a>(); <span class="comment">// The thread, when the time comes, calls this method using the instance pointer that was passed into the thread originally. The actual encrypted version is kept -- only the temporary cleartext version is destroyed.</span>
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     EXPORT  <span class="keywordtype">void</span> <a class="code" href="class_o_t_cached_key.html#a3ed776977711a2d217fff380dd6cd3c5">ResetMasterPassword</a>(); <span class="comment">// If you actually want to create a new key, and a new passphrase, then use this to destroy every last vestige of the old one. (Which will cause a new one to be automatically generated the next time OT requests the master key.) NOTE: Make SURE you have all your Nyms loaded up and unlocked before you call this. Then Save them all again so they will be properly stored with the new master key.</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     EXPORT   <span class="keywordtype">void</span> <a class="code" href="class_o_t_cached_key.html#a6933e0f88aae70fe30b925f150e8cc20">LowLevelReleaseThread</a>();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">// The cleartext version (m_pMasterPassword) is deleted and set NULL after a Timer of X seconds. (Timer thread calls this.)</span>
<a name="l00338"></a>00338     <span class="comment">// The INSTANCE that owns the thread also passes a pointer to ITSELF.</span>
<a name="l00339"></a>00339     <span class="comment">// (So we can access password, mutex, timeout value, etc.) This function calls DestroyMasterPassword.</span>
<a name="l00340"></a>00340     <span class="comment">//</span>
<a name="l00341"></a>00341     EXPORT   <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_o_t_cached_key.html#a7ac7c4130bd8d8cb9a443be54ae5e004">ThreadTimeout</a>(<span class="keywordtype">void</span> * pArg);
<a name="l00342"></a>00342 };
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="preprocessor">#endif // __OT_CACHED_KEY_HPP__</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_o_t_cached_key_8hpp.html">OTCachedKey.hpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:00 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
