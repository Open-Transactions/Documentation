<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otapi/ot_commands_ot.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ot__commands__ot_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otapi/ot_commands_ot.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ot__commands__ot_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// NEW RETURN CODE CONVENTION!</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">// OT API already returns: -1 for error, 0 for &quot;didn&#39;t need to do anything&quot; and 1 for success (or larger.)</span>
<a name="l00004"></a>00004 <span class="comment">// All of the below functions follow that convention (they just return the same values.)</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// But for the OT command line tool, we need to return 0 for success, and non-zero codes for errors.</span>
<a name="l00007"></a>00007 <span class="comment">// This is because it&#39;s a UNIX convention and will be expected by anyone writing bash scripts.</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// However, I don&#39;t want to physically change all the below functions, so I&#39;m going to change the</span>
<a name="l00010"></a>00010 <span class="comment">// opentxs script itself, so that it translates the return value. That way I only have to change it</span>
<a name="l00011"></a>00011 <span class="comment">// in one spot, and we have access to use these scripts both ways.</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">// THE POINT? If you notice these scripts returning 1, which is then interpreted as 0 by bash scripts,</span>
<a name="l00014"></a>00014 <span class="comment">// it&#39;s because the script that CALLS these scripts, is doing that translation (for the above described</span>
<a name="l00015"></a>00015 <span class="comment">// reasons.)</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="ot__commands__ot_8hpp.html">ot_commands_ot.hpp</a>&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="ot__utility__ot_8hpp.html">ot_utility_ot.hpp</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="ot__otapi__ot_8hpp.html">ot_otapi_ot.hpp</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="ot__made__easy__ot_8hpp.html">ot_made_easy_ot.hpp</a>&quot;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="_o_t_a_p_i_8hpp.html">OTAPI.hpp</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="_o_t___m_e_8hpp.html">OT_ME.hpp</a>&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">extern</span> <span class="keywordtype">string</span> <a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="keyword">extern</span> <span class="keywordtype">string</span> <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<span class="keywordtype">string</span>, <span class="keywordtype">string</span>);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="class_o_t___command.html#a8c09431be547d39d6adb3d4c3a3e8c13">00037</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8c09431be547d39d6adb3d4c3a3e8c13">OT_Command::main_revoke_credential</a>()
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nThis command not coded yet. We need to use the OT_API_RevokeSubcredential API call here.\n\n&quot;</span>);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     <span class="keywordflow">return</span> -1;
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="class_o_t___command.html#a5a28729938ad706ad387d537a4f13783">00045</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5a28729938ad706ad387d537a4f13783">OT_Command::main_new_credential</a>()
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nThis command not coded yet. A Nym is created with credentials already,\nbut to add MORE credentials to an existing Nym, I need to use the OT_API_AddSubcredential API call.\n\n&quot;</span>);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     <span class="keywordflow">return</span> -1;
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">// Also TODO:</span>
<a name="l00054"></a>00054 <span class="comment">// Update the &quot;cancel&quot; command, for outgoing cash, to give you a choice to deposit the cash instead</span>
<a name="l00055"></a>00055 <span class="comment">// of discarding it.</span>
<a name="l00056"></a>00056 <span class="comment">// details_deposit_purse(strServerID, strMyAcctID, strToNymID, strInstrument, &quot;&quot;) // strIndices is left blank in this case</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">// BASKETS</span>
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="class_o_t___command.html#a30adb291c08cb0a4878464842c1575db">00061</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a30adb291c08cb0a4878464842c1575db">OT_Command::main_show_basket</a>()
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:    opentxs showbasket\nOPTIONAL:   --args \&quot;index BASKET_INDEX\&quot;\n\nNOTE: If you leave off the index, then it lists all the basket currencies.\nBut if an index is provided, this command will zoom in and show the details\nfor that specific basket currency.\n\n&quot;</span>;
<a name="l00064"></a>00064     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#aa44495aad7e093d31dd4e8c7903c6389">OT_Command::details_show_basket</a>();
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="class_o_t___command.html#aa44495aad7e093d31dd4e8c7903c6389">00069</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa44495aad7e093d31dd4e8c7903c6389">OT_Command::details_show_basket</a>()
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="keywordtype">bool</span> bOnFirstIteration = <span class="keyword">true</span>;
<a name="l00072"></a>00072     int32_t nAssetCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a198d0167a16f21047de145d8a19ee4fa">OTAPI_Wrap::GetAssetTypeCount</a>();
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAssetCount) &amp;&amp; (nAssetCount &gt; 0))
<a name="l00075"></a>00075     {
<a name="l00076"></a>00076         <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l00081"></a>00081             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l00082"></a>00082             <span class="comment">//</span>
<a name="l00083"></a>00083             <span class="keywordtype">string</span> strTempIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempIndex))
<a name="l00086"></a>00086             {
<a name="l00087"></a>00087                 strIndex = strTempIndex;
<a name="l00088"></a>00088             }
<a name="l00089"></a>00089         } <span class="comment">// args</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="comment">// Zoom in on a specific basket currency.</span>
<a name="l00092"></a>00092         <span class="comment">//</span>
<a name="l00093"></a>00093         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l00094"></a>00094         {
<a name="l00095"></a>00095             int32_t nIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nIndex))
<a name="l00098"></a>00098             {
<a name="l00099"></a>00099                 <span class="keywordflow">return</span> -1;
<a name="l00100"></a>00100             }
<a name="l00101"></a>00101             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nIndex &lt; 0) || (nIndex &gt;= nAssetCount))
<a name="l00102"></a>00102             {
<a name="l00103"></a>00103                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: index out of bounds.\n&quot;</span>);
<a name="l00104"></a>00104                 <span class="keywordflow">return</span> -1;
<a name="l00105"></a>00105             }
<a name="l00106"></a>00106             <span class="keywordflow">else</span>
<a name="l00107"></a>00107             {
<a name="l00108"></a>00108                 <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#aefee6b3a901c826436038921f17d1bcf">OTAPI_Wrap::GetAssetType_ID</a>(nIndex);
<a name="l00109"></a>00109                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetID))
<a name="l00110"></a>00110                 {
<a name="l00111"></a>00111                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ERROR: Failed getting asset type ID at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00112"></a>00112                 }
<a name="l00113"></a>00113                 <span class="keywordflow">else</span>
<a name="l00114"></a>00114                 {
<a name="l00115"></a>00115                     <span class="keywordtype">string</span> strAssetName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAssetID);
<a name="l00116"></a>00116                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetName))
<a name="l00117"></a>00117                     {
<a name="l00118"></a>00118                         strAssetName = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00119"></a>00119                     }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121                     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a25970eda7bbbb93e2340499f77a15fd4">OTAPI_Wrap::IsBasketCurrency</a>(strAssetID))
<a name="l00122"></a>00122                     {
<a name="l00123"></a>00123                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: not a basket currency: &quot;</span> + strAssetID + <span class="stringliteral">&quot; : &quot;</span> + strAssetName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00124"></a>00124                     }
<a name="l00125"></a>00125                     <span class="keywordflow">else</span>
<a name="l00126"></a>00126                     {
<a name="l00127"></a>00127                         <span class="comment">// DISPLAY ALL THE DETAILS ABOUT THIS BASKET CURRENCY:</span>
<a name="l00128"></a>00128                         <span class="comment">//</span>
<a name="l00129"></a>00129                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Name: &quot;</span> + strAssetName);
<a name="l00130"></a>00130                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;ID:   &quot;</span> + strAssetID);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132                         int32_t nMemberCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a146bb3bffd9449a4e03239715f6e6558">OTAPI_Wrap::Basket_GetMemberCount</a>(strAssetID);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMemberCount))
<a name="l00135"></a>00135                         {
<a name="l00136"></a>00136                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ERROR: expected int32_t return value from OT_API_Basket_GetMemberCount(strAssetID)\n&quot;</span>);
<a name="l00137"></a>00137                         }
<a name="l00138"></a>00138                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nMemberCount &lt;= 0)
<a name="l00139"></a>00139                         {
<a name="l00140"></a>00140                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange: this basket has &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMemberCount) + <span class="stringliteral">&quot; sub-currencies. (Expected 1 or more.)\n&quot;</span>);
<a name="l00141"></a>00141                         }
<a name="l00142"></a>00142                         <span class="keywordflow">else</span>
<a name="l00143"></a>00143                         {
<a name="l00144"></a>00144                             int64_t nBasketMinTransAmt = <a class="code" href="class_o_t_a_p_i___wrap.html#a3ed85a7e75671b0020d0e2767ffc7548">OTAPI_Wrap::Basket_GetMinimumTransferAmount</a>(strAssetID);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nBasketMinTransAmt))
<a name="l00147"></a>00147                             {
<a name="l00148"></a>00148                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange: expected minimum transfer amount for basket, but got bad value instead.\n&quot;</span>);
<a name="l00149"></a>00149                             }
<a name="l00150"></a>00150                             <span class="keywordflow">else</span>
<a name="l00151"></a>00151                             {
<a name="l00152"></a>00152                                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Minimum transfer amount for basket:     &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nBasketMinTransAmt));
<a name="l00153"></a>00153                                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Number of sub-currencies in the basket: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMemberCount));
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                                 <span class="keywordtype">bool</span> bFirstMember = <span class="keyword">true</span>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157                                 <span class="keywordflow">for</span> (int32_t nMemberIndex = 0; nMemberIndex &lt; nMemberCount; ++nMemberIndex)
<a name="l00158"></a>00158                                 {
<a name="l00159"></a>00159                                     <span class="keywordtype">string</span> strMemberType = <a class="code" href="class_o_t_a_p_i___wrap.html#ae40b0158d972e233b8f2120243016638">OTAPI_Wrap::Basket_GetMemberType</a>(strAssetID, nMemberIndex);
<a name="l00160"></a>00160                                     <span class="keywordtype">string</span> strMemberName = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemberType) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strMemberType) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162                                     int64_t nMinTransAmt = <a class="code" href="class_o_t_a_p_i___wrap.html#a87c722f41b487e10c2deb33045634f01">OTAPI_Wrap::Basket_GetMemberMinimumTransferAmount</a>(strAssetID, nMemberIndex);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164                                     <span class="keywordflow">if</span> (bFirstMember)
<a name="l00165"></a>00165                                     {
<a name="l00166"></a>00166                                         bFirstMember = <span class="keyword">false</span>;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;    Index  :  Min Transfer Amount  :  Member currency  \n---------------------------------------\n&quot;</span>);
<a name="l00169"></a>00169                                     }
<a name="l00170"></a>00170                                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;    &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMemberIndex) + <span class="stringliteral">&quot;      : &quot;</span> + (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMinTransAmt) ? <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMinTransAmt) : <span class="stringliteral">&quot;ERROR_AMT&quot;</span>) + <span class="stringliteral">&quot; : &quot;</span> + strMemberType + <span class="stringliteral">&quot; : &quot;</span> + (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemberName) ? strMemberName : <span class="stringliteral">&quot;ERROR_NAME&quot;</span>));
<a name="l00171"></a>00171                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------------\n&quot;</span>);
<a name="l00172"></a>00172                                 }
<a name="l00173"></a>00173                             }
<a name="l00174"></a>00174                         }
<a name="l00175"></a>00175                     }
<a name="l00176"></a>00176                 }
<a name="l00177"></a>00177             }
<a name="l00178"></a>00178             <span class="keywordflow">return</span> 1;
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         <span class="comment">// List ALL the basket currencies.</span>
<a name="l00182"></a>00182         <span class="comment">//</span>
<a name="l00183"></a>00183         <span class="keywordflow">for</span> (int32_t nAssetIndex = 0; nAssetIndex &lt; nAssetCount; ++nAssetIndex)
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185             <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#aefee6b3a901c826436038921f17d1bcf">OTAPI_Wrap::GetAssetType_ID</a>(nAssetIndex);
<a name="l00186"></a>00186             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetID) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a25970eda7bbbb93e2340499f77a15fd4">OTAPI_Wrap::IsBasketCurrency</a>(strAssetID))
<a name="l00187"></a>00187             {
<a name="l00188"></a>00188                 <span class="keywordflow">if</span> (bOnFirstIteration)
<a name="l00189"></a>00189                 {
<a name="l00190"></a>00190                     bOnFirstIteration = <span class="keyword">false</span>;
<a name="l00191"></a>00191                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Index |  Basket currencies:\n------------------------------------\n&quot;</span>);
<a name="l00192"></a>00192                 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194                 <span class="keywordtype">string</span> strAssetName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAssetID);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetName))
<a name="l00197"></a>00197                 {
<a name="l00198"></a>00198                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nAssetIndex) + <span class="stringliteral">&quot;: &quot;</span> + strAssetID + <span class="stringliteral">&quot; : &quot;</span> + strAssetName);
<a name="l00199"></a>00199                 }
<a name="l00200"></a>00200                 <span class="keywordflow">else</span>
<a name="l00201"></a>00201                 {
<a name="l00202"></a>00202                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nAssetIndex) + <span class="stringliteral">&quot;: &quot;</span> + strAssetID);
<a name="l00203"></a>00203                 }
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205         } <span class="comment">// for</span>
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (nAssetCount &gt; 0) { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); }
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="keywordflow">return</span> -1;
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="class_o_t___command.html#a5f5c7a4ae603c66599b1fcc339f0e0c1">00213</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5f5c7a4ae603c66599b1fcc339f0e0c1">OT_Command::main_new_basket</a>()
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a76888da448fa8b28024c95e38190d0ae">OT_Command::details_new_basket</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">return</span> -1;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="class_o_t___command.html#a76888da448fa8b28024c95e38190d0ae">00223</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a76888da448fa8b28024c95e38190d0ae">OT_Command::details_new_basket</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServer, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNym)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     int32_t nBasketCount = 2;
<a name="l00226"></a>00226     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;How many different asset types will compose this new basket currency? [2]: &quot;</span>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordtype">string</span> strBasketCount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasketCount))
<a name="l00231"></a>00231     {
<a name="l00232"></a>00232         nBasketCount = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strBasketCount);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (nBasketCount &lt; 2)
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but a basket currency must be composed of at least 2 sub-currencies.\n&quot;</span>);
<a name="l00237"></a>00237             <span class="keywordflow">return</span> -1;
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     int64_t lMinimumTransAmount = int64_t(100);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nIf your basket has a minimum transfer amount of 100, you might have 2 or 3 sub-currencies,\nwith the first being a minimum of 2 gold, the second being a minimum of 50 dollars, and the\nthird being a minimum of 30 silver.\nIn this example, 100 units of the basket currency is transferrable in or out of the\nbasket currency, in return for 2 gold, 50 dollars, and 30 silver.\n\n&quot;</span>);
<a name="l00244"></a>00244     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;What is the minimum transfer amount for the basket currency itself? [100]: &quot;</span>);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordtype">string</span> strMinAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMinAmount))
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250         lMinimumTransAmount = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strMinAmount);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <span class="keywordflow">if</span> (lMinimumTransAmount &lt; 1)
<a name="l00253"></a>00253         {
<a name="l00254"></a>00254             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but this needs to be a non-zero value. Minimum is 1.\n&quot;</span>);
<a name="l00255"></a>00255             <span class="keywordflow">return</span> -1;
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="keywordtype">string</span> strBasket = <a class="code" href="class_o_t_a_p_i___wrap.html#adcaa9544d286360ec60ce5f57d4a8549">OTAPI_Wrap::GenerateBasketCreation</a>(strNym, lMinimumTransAmount);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasket))
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while generating initial basket object.\n&quot;</span>);
<a name="l00264"></a>00264         <span class="keywordflow">return</span> -1;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="keywordflow">for</span> (int32_t ibasket = 0; ibasket &lt; nBasketCount; ++ibasket)
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269         <a class="code" href="class_o_t___command.html#ab0ee12477862b43af1141cf2f3f1157b">OT_Command::main_stat_assets</a>();
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nThis basket currency has &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nBasketCount) + <span class="stringliteral">&quot; subcurrencies.\n&quot;</span>);
<a name="l00272"></a>00272         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;So far you have defined &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(ibasket) + <span class="stringliteral">&quot; of them.\n&quot;</span>);
<a name="l00273"></a>00273         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please PASTE the asset type ID for a subcurrency of this basket: &quot;</span>);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordtype">string</span> strSubcurrencyID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSubcurrencyID))
<a name="l00278"></a>00278         {
<a name="l00279"></a>00279             <span class="keywordflow">return</span> -1;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="keywordtype">string</span> strSubcurrencyContract = <a class="code" href="class_o_t_a_p_i___wrap.html#af9ff83a6990cb1e5fca1fe55062c4c78">OTAPI_Wrap::GetAssetType_Contract</a>(strSubcurrencyID);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSubcurrencyContract))
<a name="l00285"></a>00285         {
<a name="l00286"></a>00286             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but &quot;</span> + strSubcurrencyID + <span class="stringliteral">&quot; is apparently not a currency contract in your wallet.\n&quot;</span>);
<a name="l00287"></a>00287             ibasket -= 1;
<a name="l00288"></a>00288             <span class="keywordflow">continue</span>;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter minimum transfer amount for that asset type [100]: &quot;</span>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         lMinimumTransAmount = 100;
<a name="l00294"></a>00294         strMinAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00295"></a>00295 
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMinAmount))
<a name="l00297"></a>00297         {
<a name="l00298"></a>00298             lMinimumTransAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strSubcurrencyID, strMinAmount);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300             <span class="keywordflow">if</span> (lMinimumTransAmount &lt; 1)
<a name="l00301"></a>00301             {
<a name="l00302"></a>00302                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but this needs to be a non-zero value. Minimum is 1.\n&quot;</span>);
<a name="l00303"></a>00303                 ibasket -= 1;
<a name="l00304"></a>00304                 <span class="keywordflow">continue</span>;
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordtype">string</span> strTempBasket = <a class="code" href="class_o_t_a_p_i___wrap.html#a9d4dc3a78f0eee3753b643b7aab7eb22">OTAPI_Wrap::AddBasketCreationItem</a>(strNym, strBasket, strSubcurrencyID, lMinimumTransAmount);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempBasket))
<a name="l00311"></a>00311         {
<a name="l00312"></a>00312             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: OT_API_AddBasketCreationItem returned NULL. (Failure.)\n&quot;</span>);
<a name="l00313"></a>00313             <span class="keywordflow">return</span> -1;
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315         <span class="keywordflow">else</span>
<a name="l00316"></a>00316         {
<a name="l00317"></a>00317             strBasket = strTempBasket;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Here&#39;s the basket we&#39;re issuing:\n\n&quot;</span> + strBasket + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a027f244740ac52415d63ae63807a759d">MadeEasy::issue_basket_currency</a>(strServer, strNym, strBasket);
<a name="l00326"></a>00326     int32_t nStatus = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l00329"></a>00329     <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l00330"></a>00330     <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l00331"></a>00331     <span class="comment">//</span>
<a name="l00332"></a>00332     <span class="comment">// -1 is error,</span>
<a name="l00333"></a>00333     <span class="comment">//  0 is reply received: failure</span>
<a name="l00334"></a>00334     <span class="comment">//  1 is reply received: success</span>
<a name="l00335"></a>00335     <span class="comment">//</span>
<a name="l00336"></a>00336     <span class="keywordflow">switch</span> (nStatus)
<a name="l00337"></a>00337     {
<a name="l00338"></a>00338     <span class="keywordflow">case</span> 1:
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340               <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS in issue_basket_currency! Server response:\n\n&quot;</span>);
<a name="l00341"></a>00341               <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l00342"></a>00342 
<a name="l00343"></a>00343               <span class="keywordtype">string</span> strNewID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7bf64aa4f61918d7fce5eba83331fd42">OTAPI_Wrap::Message_GetNewAssetTypeID</a>(strResponse);
<a name="l00344"></a>00344               <span class="keywordtype">bool</span> bGotNewID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewID);
<a name="l00345"></a>00345               <span class="keywordtype">bool</span> bRetrieved = <span class="keyword">false</span>;
<a name="l00346"></a>00346               <span class="keywordtype">string</span> strEnding = <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348               <span class="keywordflow">if</span> (bGotNewID)
<a name="l00349"></a>00349               {
<a name="l00350"></a>00350                   <span class="keywordtype">string</span> strRetrieved = <a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">MadeEasy::retrieve_contract</a>(strServer, strNym, strNewID);
<a name="l00351"></a>00351                   strEnding = <span class="stringliteral">&quot;: &quot;</span> + strNewID;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                   <span class="keywordflow">if</span> (1 == <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strRetrieved))
<a name="l00354"></a>00354                   {
<a name="l00355"></a>00355                       bRetrieved = <span class="keyword">true</span>;
<a name="l00356"></a>00356                   }
<a name="l00357"></a>00357               }
<a name="l00358"></a>00358               <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response: SUCCESS in issue_basket_currency!\n&quot;</span>);
<a name="l00359"></a>00359               <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving new basket contract&quot;</span> + strEnding + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00360"></a>00360               <span class="keywordflow">break</span>;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">case</span> 0:
<a name="l00363"></a>00363         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILURE in issue_basket_currency! Server response:\n\n&quot;</span>);
<a name="l00364"></a>00364         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l00365"></a>00365         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot; FAILURE in issue_basket_currency!\n&quot;</span>);
<a name="l00366"></a>00366         <span class="keywordflow">break</span>;
<a name="l00367"></a>00367     <span class="keywordflow">default</span>:
<a name="l00368"></a>00368         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nError in issue_basket_currency! nStatus is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nStatus) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l00371"></a>00371         {
<a name="l00372"></a>00372             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response:\n\n&quot;</span>);
<a name="l00373"></a>00373             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l00374"></a>00374             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nError in issue_basket_currency! nStatus is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nStatus) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         <span class="keywordflow">break</span>;
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordflow">return</span> (0 == nStatus) ? -1 : nStatus;
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a><a class="code" href="class_o_t___command.html#a5abeb26c481a2189470259e285c4e5b7">00384</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5abeb26c481a2189470259e285c4e5b7">OT_Command::details_exchange_basket</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServer, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNym, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAcct, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strBasketType)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386     <span class="comment">// NOTE: details_exchange_basket ASSUMES that strAcct has a server of strServer and</span>
<a name="l00387"></a>00387     <span class="comment">// a NymID of strNym and an asset type of strBasketType. (These are already verified</span>
<a name="l00388"></a>00388     <span class="comment">// in OT_Command::main_exchange_basket.)</span>
<a name="l00389"></a>00389     <span class="comment">//</span>
<a name="l00390"></a>00390     int32_t nMemberCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a146bb3bffd9449a4e03239715f6e6558">OTAPI_Wrap::Basket_GetMemberCount</a>(strBasketType);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMemberCount) || (nMemberCount &lt; 2))
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange, the chosen basket asset type apparently has no sub-currencies. (Failure.)\n&quot;</span>);
<a name="l00395"></a>00395         <span class="keywordflow">return</span> -1;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     int64_t lMinimumTransAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a3ed85a7e75671b0020d0e2767ffc7548">OTAPI_Wrap::Basket_GetMinimumTransferAmount</a>(strBasketType);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lMinimumTransAmount))
<a name="l00401"></a>00401     {
<a name="l00402"></a>00402         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange, the chosen basket asset type apparently has no minimum transfer amount. (Failure.)\n&quot;</span>);
<a name="l00403"></a>00403         <span class="keywordflow">return</span> -1;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordtype">bool</span> bExchangingIn = <span class="keyword">true</span>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Are you exchanging IN or OUT of the basket? [IN]: &quot;</span>);
<a name="l00409"></a>00409     <span class="keywordtype">string</span> strInOrOut = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInOrOut))
<a name="l00412"></a>00412     {
<a name="l00413"></a>00413         strInOrOut = <span class="stringliteral">&quot;in&quot;</span>;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     int64_t lBalance = <a class="code" href="class_o_t_a_p_i___wrap.html#a8f2d5f06ab2a0527f589a5af757989c3">OTAPI_Wrap::GetAccountWallet_Balance</a>(strAcct);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lBalance))
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange: unable to retrieve balance for basket account: &quot;</span> + strAcct + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00421"></a>00421         <span class="keywordflow">return</span> -1;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">if</span> ((strInOrOut == <span class="stringliteral">&quot;out&quot;</span>) || (strInOrOut == <span class="stringliteral">&quot;OUT&quot;</span>))
<a name="l00425"></a>00425     {
<a name="l00426"></a>00426         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Exchanging OUT of the basket currency...\n\n&quot;</span>);
<a name="l00427"></a>00427         bExchangingIn = <span class="keyword">false</span>;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (lBalance &lt; lMinimumTransAmount)
<a name="l00430"></a>00430         {
<a name="l00431"></a>00431             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but the minimum transfer amount for this basket currency is &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lMinimumTransAmount) + <span class="stringliteral">&quot;\nand the chosen account&#39;s balance is only &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lBalance) + <span class="stringliteral">&quot;. (Failure.)\n&quot;</span>);
<a name="l00432"></a>00432             <span class="keywordflow">return</span> -1;
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435     <span class="keywordflow">else</span>
<a name="l00436"></a>00436     {
<a name="l00437"></a>00437         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Exchanging IN to the basket currency...\n\n&quot;</span>);
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     int32_t nTransferMultiple = 1;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;This basket currency has a minimum transfer amount of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lMinimumTransAmount) + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l00443"></a>00443     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Now you must choose the Transfer Multiple for the exchange. For example:\n&quot;</span>);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="keywordflow">for</span> (int32_t i = 1; i &lt; 5; ++i)
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447         int64_t lUnits = i * lMinimumTransAmount;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;A transfer multiple of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i) + <span class="stringliteral">&quot; will exchange &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lUnits) + <span class="stringliteral">&quot; units of the basket currency.\n&quot;</span>);
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Etc.\n&quot;</span>);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (!bExchangingIn) { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Keep in mind, the balance in the basket account is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lBalance) + <span class="stringliteral">&quot;\n\n&quot;</span>); }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please choose a transfer multiple [1]: &quot;</span>);
<a name="l00456"></a>00456     <span class="keywordtype">string</span> strTransferMultiple = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransferMultiple))
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460         int32_t nTempMultiple = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strTransferMultiple);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTempMultiple) &amp;&amp; (nTempMultiple &gt; 1)) { nTransferMultiple = nTempMultiple; }
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     int64_t lAttemptedTransfer = (nTransferMultiple * lMinimumTransAmount);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (!bExchangingIn &amp;&amp; (lAttemptedTransfer &gt; lBalance))
<a name="l00468"></a>00468     {
<a name="l00469"></a>00469         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;A transfer multiple of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nTransferMultiple) + <span class="stringliteral">&quot; will exchange &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAttemptedTransfer) + <span class="stringliteral">&quot; units out of the basket currency.\nUnfortunately, you only have a &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lBalance) + <span class="stringliteral">&quot; balance in your basket account. (Failed.)\n&quot;</span>);
<a name="l00470"></a>00470         <span class="keywordflow">return</span> -1;
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(20, strServer, strNym))
<a name="l00474"></a>00474     {
<a name="l00475"></a>00475         <span class="keywordflow">return</span> -1;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordtype">string</span> strBasket = <a class="code" href="class_o_t_a_p_i___wrap.html#a5520db599ddf53cd5fd3c4ebe85f5c45">OTAPI_Wrap::GenerateBasketExchange</a>(strServer, strNym, strBasketType, strAcct, nTransferMultiple);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasket))
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed generating basket exchange request.\n&quot;</span>);
<a name="l00483"></a>00483         <span class="keywordflow">return</span> -1;
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">// Below this point, after any failure, call this before returning:</span>
<a name="l00487"></a>00487     <span class="comment">//</span>
<a name="l00488"></a>00488     <span class="comment">// OTAPI_Wrap::Msg_HarvestTransactionNumbers(strBasket, strNym, false, false, false, false, false)</span>
<a name="l00489"></a>00489     <span class="comment">//</span>
<a name="l00490"></a>00490     <span class="comment">// NOTE: Only do this up until the message is sent. Once it&#39;s sent, the harvesting is already</span>
<a name="l00491"></a>00491     <span class="comment">// handled internally. (Only need to harvest in the event that some failure occurs in the middle of</span>
<a name="l00492"></a>00492     <span class="comment">// constructing the basket exchange request, for any time BEFORE actually trying to send it.)</span>
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="comment">// SUB-CURRENCIES!</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keywordflow">for</span> (int32_t nMember = 0; nMember &lt; nMemberCount; ++nMember)
<a name="l00498"></a>00498     {
<a name="l00499"></a>00499         <span class="keywordtype">string</span> strMemberType = <a class="code" href="class_o_t_a_p_i___wrap.html#ae40b0158d972e233b8f2120243016638">OTAPI_Wrap::Basket_GetMemberType</a>(strBasketType, nMember);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemberType))
<a name="l00502"></a>00502         {
<a name="l00503"></a>00503             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving member type from index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMember) + <span class="stringliteral">&quot; of basket currency: &quot;</span> + strBasketType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00504"></a>00504             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00505"></a>00505             <span class="keywordflow">return</span> -1;
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="keywordtype">string</span> strMemberTypeName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strMemberType);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemberTypeName))
<a name="l00511"></a>00511         {
<a name="l00512"></a>00512             strMemberTypeName = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         int64_t lMemberAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a87c722f41b487e10c2deb33045634f01">OTAPI_Wrap::Basket_GetMemberMinimumTransferAmount</a>(strBasketType, nMember);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lMemberAmount))
<a name="l00518"></a>00518         {
<a name="l00519"></a>00519             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving minimum transfer amount from index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMember) + <span class="stringliteral">&quot; (&quot;</span> + strMemberType + <span class="stringliteral">&quot;) on basket currency: &quot;</span> + strBasketType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00520"></a>00520             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00521"></a>00521             <span class="keywordflow">return</span> -1;
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         lAttemptedTransfer = (nTransferMultiple * lMemberAmount);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="comment">// This will only display accounts registered on strServer of asset type strMemberType.</span>
<a name="l00527"></a>00527         <span class="comment">//</span>
<a name="l00528"></a>00528         <a class="code" href="class_o_t___command.html#aec66ba39d54d7188dd8cc76413f17c4d">OT_Command::stat_basket_accounts</a>(strServer, strNym, <span class="keyword">true</span>, strMemberType);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;There are &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nMemberCount - nMember) + <span class="stringliteral">&quot; accounts remaining to be selected.\n\n&quot;</span>);
<a name="l00531"></a>00531         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Currently we need to select an account with the asset type:\n&quot;</span> + strMemberType + <span class="stringliteral">&quot; (&quot;</span> + strMemberTypeName + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l00532"></a>00532         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Above are all the accounts in the wallet, for the relevant server and nym, of that asset type.\n&quot;</span>);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (bExchangingIn) { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nKeep in mind, with a transfer multiple of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nTransferMultiple) + <span class="stringliteral">&quot; and a minimum transfer amount of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lMemberAmount) + <span class="stringliteral">&quot;\n(for this sub-currency), you must therefore select an account with a minimum\nbalance of: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAttemptedTransfer) + <span class="stringliteral">&quot;\n&quot;</span>); }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nPlease PASTE an account ID from the above list: &quot;</span>);
<a name="l00537"></a>00537         <span class="keywordtype">string</span> strSubAccount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00538"></a>00538 
<a name="l00539"></a>00539         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSubAccount))
<a name="l00540"></a>00540         {
<a name="l00541"></a>00541             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00542"></a>00542             <span class="keywordflow">return</span> -1;
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545         <span class="keywordtype">string</span> strSubAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strSubAccount);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSubAssetID))
<a name="l00548"></a>00548         {
<a name="l00549"></a>00549             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving asset type ID from pasted account: &quot;</span> + strSubAccount + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00550"></a>00550             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00551"></a>00551             <span class="keywordflow">return</span> -1;
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="keywordflow">if</span> (strMemberType != strSubAssetID)
<a name="l00555"></a>00555         {
<a name="l00556"></a>00556             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: The selected account has the wrong asset type: &quot;</span> + strSubAssetID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00557"></a>00557             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00558"></a>00558             <span class="keywordflow">return</span> -1;
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         lBalance = <a class="code" href="class_o_t_a_p_i___wrap.html#a8f2d5f06ab2a0527f589a5af757989c3">OTAPI_Wrap::GetAccountWallet_Balance</a>(strSubAccount);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lBalance))
<a name="l00564"></a>00564         {
<a name="l00565"></a>00565             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange, error while retrieving balance for sub-account: &quot;</span> + strSubAccount + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00566"></a>00566             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00567"></a>00567             <span class="keywordflow">return</span> -1;
<a name="l00568"></a>00568         }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         <span class="keywordflow">if</span> (bExchangingIn &amp;&amp; (lAttemptedTransfer &gt; lBalance))
<a name="l00571"></a>00571         {
<a name="l00572"></a>00572             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nWith a minimum transfer amount of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lMemberAmount) + <span class="stringliteral">&quot; for this sub-currency, a transfer multiple of &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nTransferMultiple) + <span class="stringliteral">&quot; will exchange &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAttemptedTransfer) + <span class="stringliteral">&quot; units out of the basket currency.\n\nUnfortunately, you only have a &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lBalance) + <span class="stringliteral">&quot; balance in your selected account. (Failure.)\n&quot;</span>);
<a name="l00573"></a>00573             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00574"></a>00574             <span class="keywordflow">return</span> -1;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="keywordtype">string</span> strTempBasket = <a class="code" href="class_o_t_a_p_i___wrap.html#ad2da198f8880e979997d20be2c019ab6">OTAPI_Wrap::AddBasketExchangeItem</a>(strServer, strNym, strBasket, strSubAssetID, strSubAccount);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempBasket))
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed while adding this sub-account to the exchange request!\n&quot;</span>);
<a name="l00582"></a>00582             <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strBasket, strNym, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00583"></a>00583             <span class="keywordflow">return</span> -1;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         strBasket = strTempBasket;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00589"></a>00589     } <span class="comment">// for</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="comment">// Send the exchange transaction...</span>
<a name="l00592"></a>00592     <span class="comment">//</span>
<a name="l00593"></a>00593     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#ac0108669d340f7078a766e999d4509fc">MadeEasy::exchange_basket_currency</a>(strServer, strNym, strBasketType, strBasket, strAcct, bExchangingIn);
<a name="l00594"></a>00594     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;exchange_basket&quot;</span>;
<a name="l00595"></a>00595     <span class="comment">// ***************************************************************</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">// Interpret the server reply...</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServer, strNym, strAcct, strAttempt, strResponse);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l00602"></a>00602     {
<a name="l00603"></a>00603         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l00604"></a>00604         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l00605"></a>00605         <span class="comment">//</span>
<a name="l00606"></a>00606         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServer, strNym, strAcct, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS exchanging basket!\n&quot;</span>);
<a name="l00609"></a>00609         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="comment">// ***************************************************************</span>
<a name="l00613"></a>00613     <span class="comment">//</span>
<a name="l00614"></a>00614     <span class="comment">// Return status to caller.</span>
<a name="l00615"></a>00615     <span class="comment">//</span>
<a name="l00616"></a>00616     <span class="keywordflow">return</span> nInterpretReply;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="class_o_t___command.html#ae14f2b6ceb67f38ac9b33f8f80ee3274">00619</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ae14f2b6ceb67f38ac9b33f8f80ee3274">OT_Command::main_exchange_basket</a>()
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs exchange --myacct BASKET_ACCT_ID\n\nThis command exchanges in or out of a basket currency.\nYou must already have an asset account which has a basket currency as its asset type.\nYou must also have accounts for all the subcurrencies in that basket.\n\n&quot;</span>;
<a name="l00622"></a>00622     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626         <span class="keywordtype">string</span> strAcctType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l00627"></a>00627         <span class="keywordtype">string</span> strServer = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l00628"></a>00628         <span class="keywordtype">string</span> strNym = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctType))
<a name="l00631"></a>00631         {
<a name="l00632"></a>00632             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while trying to retrieve asset type for account: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00633"></a>00633         }
<a name="l00634"></a>00634         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServer))
<a name="l00635"></a>00635         {
<a name="l00636"></a>00636             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while trying to retrieve server ID for account: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00637"></a>00637         }
<a name="l00638"></a>00638         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNym))
<a name="l00639"></a>00639         {
<a name="l00640"></a>00640             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while trying to retrieve Nym ID for account: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a> != strAcctType))
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyAcct has a different asset type than the one specified at the command line.\nPlease re-try, and add: --mypurse &quot;</span> + strAcctType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> != strServer))
<a name="l00648"></a>00648         {
<a name="l00649"></a>00649             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyAcct has a different server ID than the one specified at the command line.\nPlease re-try, and add: --server &quot;</span> + strServer + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00650"></a>00650         }
<a name="l00651"></a>00651         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> != strNym))
<a name="l00652"></a>00652         {
<a name="l00653"></a>00653             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyAcct has a different owner Nym ID than the one specified at the command line.\nPlease re-try, and add: --mynym &quot;</span> + strNym + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a25970eda7bbbb93e2340499f77a15fd4">OTAPI_Wrap::IsBasketCurrency</a>(strAcctType))
<a name="l00657"></a>00657         {
<a name="l00658"></a>00658             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nMyAcct is NOT a basket currency! Its asset type is: &quot;</span> + strAcctType + <span class="stringliteral">&quot;\nHere is a list of the basket currencies in your wallet:\n&quot;</span>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660             <a class="code" href="class_o_t___command.html#aa44495aad7e093d31dd4e8c7903c6389">details_show_basket</a>();
<a name="l00661"></a>00661 
<a name="l00662"></a>00662             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nHere is a list of the accounts whose asset type IS a basket currency:\n&quot;</span>);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664             <a class="code" href="class_o_t___command.html#aec66ba39d54d7188dd8cc76413f17c4d">stat_basket_accounts</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nMyAcct is not a basket currency!\nPlease use --myacct to specify an account whose asset type IS a basket currency.\n&quot;</span>);
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="keywordflow">else</span>
<a name="l00670"></a>00670         {
<a name="l00671"></a>00671             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a5abeb26c481a2189470259e285c4e5b7">details_exchange_basket</a>(strServer, strNym, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strAcctType);
<a name="l00672"></a>00672         }
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674     <span class="keywordflow">else</span>
<a name="l00675"></a>00675     {
<a name="l00676"></a>00676         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You must provide an account ID, and that account must have a basket\ncurrency for its asset type. Use --myacct and choose from these basket accounts:\n&quot;</span>);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <a class="code" href="class_o_t___command.html#aec66ba39d54d7188dd8cc76413f17c4d">stat_basket_accounts</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="keywordflow">return</span> -1;
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 <span class="comment">// Used by exchange_basket for displaying certain types of accounts.</span>
<a name="l00686"></a>00686 <span class="comment">//</span>
<a name="l00687"></a>00687 <span class="comment">// if strBasketType doesn&#39;t exist, it will ONLY show accounts that are basket currencies.</span>
<a name="l00688"></a>00688 <span class="comment">// if strBasketType exists, and bFilter is TRUE, it will ONLY show accounts of that type.</span>
<a name="l00689"></a>00689 <span class="comment">// if strBasketType exists, and bFilter is FALSE, it will only show accounts that are NOT of that type.</span>
<a name="l00690"></a>00690 <span class="comment">//</span>
<a name="l00691"></a>00691 <span class="comment">// Also: if strServer exists, the accounts are filtered by that server.</span>
<a name="l00692"></a>00692 <span class="comment">// Also: if strNym exists, the accounts are filtered by that Nym.</span>
<a name="l00693"></a>00693 <span class="comment">//</span>
<a name="l00694"></a><a class="code" href="class_o_t___command.html#aec66ba39d54d7188dd8cc76413f17c4d">00694</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aec66ba39d54d7188dd8cc76413f17c4d">OT_Command::stat_basket_accounts</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServer, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNym, <span class="keyword">const</span> <span class="keywordtype">bool</span> bFilter, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strBasketType)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l00697"></a>00697     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** ACCOUNTS :\n&quot;</span>);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     int32_t nAccountCount = <a class="code" href="class_o_t_a_p_i___wrap.html#afbe43c28c4617b76122db11a8134564f">OTAPI_Wrap::GetAccountCount</a>();
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nAccountCount; ++i)
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703         <span class="keywordtype">string</span> strID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae265c713020535f996c26367f8eb6044">OTAPI_Wrap::GetAccountWallet_ID</a>(i);
<a name="l00704"></a>00704         <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strID);
<a name="l00705"></a>00705         <span class="keywordtype">string</span> strAcctServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strID);
<a name="l00706"></a>00706         <span class="keywordtype">string</span> strAcctNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strID);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServer) || (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServer) &amp;&amp; (strServer == strAcctServerID)))
<a name="l00709"></a>00709         {
<a name="l00710"></a>00710             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNym) || (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNym) &amp;&amp; (strNym == strAcctNymID)))
<a name="l00711"></a>00711             {
<a name="l00712"></a>00712                 <span class="keywordflow">if</span> ((!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasketType) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a25970eda7bbbb93e2340499f77a15fd4">OTAPI_Wrap::IsBasketCurrency</a>(strAssetID)) || <span class="comment">// Only show basket accounts.</span>
<a name="l00713"></a>00713                     (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasketType) &amp;&amp; bFilter &amp;&amp; (strBasketType == strAssetID)) || <span class="comment">// Only show accounts of type strBasketType</span>
<a name="l00714"></a>00714                     (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strBasketType) &amp;&amp; !bFilter &amp;&amp; (strBasketType != strAssetID)))   <span class="comment">// Only show accounts NOT of type strBasketType</span>
<a name="l00715"></a>00715                 {
<a name="l00716"></a>00716                     <span class="keywordflow">if</span> ((i &gt; 0) &amp;&amp; (i != (nAccountCount))) { <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;-------------------------------------&quot;</span>); }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718                     <span class="keywordtype">string</span> strStatAcct = <a class="code" href="class_made_easy.html#a3ad1fb67e91e244734b63f24d93c686b">MadeEasy::stat_asset_account</a>(strID);
<a name="l00719"></a>00719                     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strStatAcct);
<a name="l00720"></a>00720                     <span class="keywordflow">if</span> (bSuccess)
<a name="l00721"></a>00721                     {
<a name="l00722"></a>00722                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strStatAcct);
<a name="l00723"></a>00723                     }
<a name="l00724"></a>00724                     <span class="keywordflow">else</span>
<a name="l00725"></a>00725                     {
<a name="l00726"></a>00726                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Error trying to stat an account: &quot;</span> + strID);
<a name="l00727"></a>00727                     }
<a name="l00728"></a>00728                     <span class="comment">// stderr</span>
<a name="l00729"></a>00729                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00730"></a>00730                 }
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="keywordflow">return</span> 1;
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 <span class="comment">// ALSO TODO:  Modified cancelCronItem so you can pass an instrument.</span>
<a name="l00741"></a>00741 <span class="comment">// So even for non-cron items, you should still be able to cancel them.</span>
<a name="l00742"></a>00742 <span class="comment">// (aka cancel the transaction numbers on it.) This is for when you change</span>
<a name="l00743"></a>00743 <span class="comment">// your mind on an outgoing instrument, and you want it cancelled before the</span>
<a name="l00744"></a>00744 <span class="comment">// recipient can process it.</span>
<a name="l00745"></a>00745 <span class="comment">// Outgoing cheque, outgoing payment plan, outgoing smart contract, etc.</span>
<a name="l00746"></a>00746 <span class="comment">//</span>
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="comment">// AND WHAT ABOUT incoming cheques? I can already discard it, but that leaves</span>
<a name="l00749"></a>00749 <span class="comment">// the sender with it still sitting in his outpayment box, until it expires.</span>
<a name="l00750"></a>00750 <span class="comment">// I&#39;d rather notify him. He should get a failure/rejection notice so that his</span>
<a name="l00751"></a>00751 <span class="comment">// client can also harvest whatever numbers it needs to harvest.</span>
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="comment">// TODO:  details_cancel_outgoing and details_discard_incoming both need to be updated</span>
<a name="l00755"></a>00755 <span class="comment">// so that they involve a server message. This way the other parties can be notified of</span>
<a name="l00756"></a>00756 <span class="comment">// the cancellation / discarding.</span>
<a name="l00757"></a>00757 <span class="comment">//</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="class_o_t___command.html#aa8a3210d11bb27635b901b7ba5788d32">00760</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa8a3210d11bb27635b901b7ba5788d32">OT_Command::details_discard_incoming</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServer, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNym, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l00761"></a>00761 {
<a name="l00762"></a>00762     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices)) { <span class="keywordflow">return</span> -1; }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     int32_t nSuccess = 1;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766     <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a7e785f8c3a9ad9257c9e251b438a6087">OTAPI_Wrap::LoadPaymentInbox</a>(strServer, strMyNym); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l00769"></a>00769     {
<a name="l00770"></a>00770         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_discard_incoming:  OT_API_LoadPaymentInbox Failed.\n\n&quot;</span>);
<a name="l00771"></a>00771         <span class="keywordflow">return</span> -1;
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     int32_t nInboxCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServer, strMyNym, strMyNym, strInbox);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nInboxCount))
<a name="l00777"></a>00777     {
<a name="l00778"></a>00778         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_discard_incoming: Unable to retrieve size of payments inbox ledger. (Failure.)\n&quot;</span>);
<a name="l00779"></a>00779         <span class="keywordflow">return</span> -1;
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (nInboxCount &gt; 0)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         int32_t nIndicesCount = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices) : 0;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         <span class="comment">// Either we loop through all the instruments and accept them all, or</span>
<a name="l00788"></a>00788         <span class="comment">// we loop through all the instruments and accept the specified indices.</span>
<a name="l00789"></a>00789         <span class="comment">//</span>
<a name="l00790"></a>00790         <span class="comment">// (But either way, we loop through all the instruments.)</span>
<a name="l00791"></a>00791         <span class="comment">//</span>
<a name="l00792"></a>00792         <span class="keywordflow">for</span> (int32_t nInboxIndex = (nInboxCount - 1); nInboxIndex &gt;= 0; --nInboxIndex) <span class="comment">// Loop from back to front, so if any are removed, the indices remain accurate subsequently.</span>
<a name="l00793"></a>00793         {
<a name="l00794"></a>00794             <span class="keywordtype">bool</span> bContinue = <span class="keyword">false</span>;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             <span class="comment">// - If &quot;all&quot; was passed, we process the item.</span>
<a name="l00797"></a>00797             <span class="comment">// - If indices are specified, but the current index is not on</span>
<a name="l00798"></a>00798             <span class="comment">//   that list, then continue...</span>
<a name="l00799"></a>00799             <span class="comment">//</span>
<a name="l00800"></a>00800             <span class="keywordflow">if</span> (!(<span class="stringliteral">&quot;all&quot;</span> == strIndices) &amp;&amp; ((nIndicesCount &gt; 0) &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nInboxIndex))))
<a name="l00801"></a>00801             {
<a name="l00802"></a>00802 <span class="comment">//              continue  // apparently not supported by the language.</span>
<a name="l00803"></a>00803                 bContinue = <span class="keyword">true</span>;
<a name="l00804"></a>00804             }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806             <span class="comment">// If it IS &quot;all&quot; OR, if there are indices and the current index was found in them.</span>
<a name="l00807"></a>00807             <span class="comment">//</span>
<a name="l00808"></a>00808             <span class="keywordflow">if</span> (!bContinue)
<a name="l00809"></a>00809             {
<a name="l00810"></a>00810                 <span class="comment">// removes payment instrument (from payments in or out box)</span>
<a name="l00811"></a>00811                 <span class="keywordtype">bool</span> bRecorded = <a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(strServer, strMyNym,
<a name="l00812"></a>00812                     <span class="keyword">true</span>, <span class="comment">// true == payments inbox. false == payments outbox.</span>
<a name="l00813"></a>00813                     nInboxIndex, <span class="keyword">false</span>);  <span class="comment">//bSaveCopy = false, since we&#39;re discarding it.</span>
<a name="l00814"></a>00814                 <span class="keywordtype">string</span> strRecorded = bRecorded ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failure&quot;</span>;
<a name="l00815"></a>00815                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span> + strRecorded + <span class="stringliteral">&quot; discarding instrument from payments inbox at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nInboxIndex) + <span class="stringliteral">&quot;.\n\n NOTE: Now the sender has to leave it in his outbox until it expires or he cancels it on his end.\n&quot;</span>);
<a name="l00816"></a>00816                 <span class="keywordflow">if</span> (!bRecorded) { nSuccess = -1; }
<a name="l00817"></a>00817             } <span class="comment">//if (!bContinue)</span>
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         } <span class="comment">// for</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     } <span class="comment">// if (nCount &gt; 0)</span>
<a name="l00822"></a>00822     <span class="keywordflow">else</span> { <span class="keywordflow">return</span> 0; } <span class="comment">// 1 means we successfully did something. 0 means the payments inbox was empty.</span>
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <span class="keywordflow">return</span> nSuccess;
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a><a class="code" href="class_o_t___command.html#a0d7c5994b1ed09bb84f01a5436eb25ed">00827</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a0d7c5994b1ed09bb84f01a5436eb25ed">OT_Command::main_discard_incoming</a>()
<a name="l00828"></a>00828 {
<a name="l00829"></a>00829     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs discard --mynym NYM_ID --server SERVER_ID --args \&quot;index|indices INDICES_GO_HERE\&quot;\n\nThis command discards an incoming instrument from the payments inbox.\n(Usually used for discarding an invoice, for when you don&#39;t want to pay it.)\nYou can also use &#39;all&#39; for the index, for it to process ALL instruments.\n\n&quot;</span>;
<a name="l00830"></a>00830     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l00833"></a>00833     {
<a name="l00834"></a>00834         <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00835"></a>00835         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00836"></a>00836         <span class="keywordtype">string</span> strFinalIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00837"></a>00837         <span class="keywordtype">bool</span> bUseStdin = <span class="keyword">false</span>;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l00840"></a>00840         {
<a name="l00841"></a>00841             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l00842"></a>00842             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l00843"></a>00843             <span class="comment">//</span>
<a name="l00844"></a>00844             strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l00845"></a>00845             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l00848"></a>00848             {
<a name="l00849"></a>00849                 strFinalIndex = strIndex;
<a name="l00850"></a>00850             }
<a name="l00851"></a>00851             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices))
<a name="l00852"></a>00852             {
<a name="l00853"></a>00853                 strFinalIndex = strIndices;
<a name="l00854"></a>00854             }
<a name="l00855"></a>00855             <span class="keywordflow">else</span>
<a name="l00856"></a>00856             {
<a name="l00857"></a>00857                 bUseStdin = <span class="keyword">true</span>;
<a name="l00858"></a>00858             }
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860         <span class="keywordflow">else</span> { bUseStdin = <span class="keyword">true</span>; }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         <span class="keywordflow">if</span> (bUseStdin)
<a name="l00863"></a>00863         {
<a name="l00864"></a>00864             <a class="code" href="class_o_t___command.html#afa3a8da44e9bbc956f4cc313aa88f83a">OT_Command::main_show_payments_inbox</a>();
<a name="l00865"></a>00865 
<a name="l00866"></a>00866             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nPlease enter the index (in your payments inbox)\nof the instrument you are discarding: &quot;</span>);
<a name="l00867"></a>00867             strIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l00868"></a>00868 
<a name="l00869"></a>00869             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l00870"></a>00870             {
<a name="l00871"></a>00871                 strFinalIndex = strIndex;
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873             <span class="keywordflow">else</span> { <span class="keywordflow">return</span> -1; }
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#aa8a3210d11bb27635b901b7ba5788d32">details_discard_incoming</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strFinalIndex);
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="keywordflow">return</span> -1;
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 <span class="comment">/*</span>
<a name="l00883"></a>00883 <span class="comment">std::string GetNym_OutpaymentsContentsByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex); // returns the message itself</span>
<a name="l00884"></a>00884 <span class="comment">std::string GetNym_OutpaymentsRecipientIDByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex); // returns the NymID of the recipient.</span>
<a name="l00885"></a>00885 <span class="comment">std::string GetNym_OutpaymentsServerIDByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex); // returns the ServerID where the message came from.</span>
<a name="l00886"></a>00886 <span class="comment">bool Nym_RemoveOutpaymentsByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex); // (1 or 0.)</span>
<a name="l00887"></a>00887 <span class="comment">bool Nym_VerifyOutpaymentsByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex); // true if signature verifies. (Sender Nym MUST be in my wallet for this to work.)</span>
<a name="l00888"></a>00888 <span class="comment"></span>
<a name="l00889"></a>00889 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetAmount(const char * THE_INSTRUMENT);</span>
<a name="l00890"></a>00890 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetTransNum(const char * THE_INSTRUMENT);</span>
<a name="l00891"></a>00891 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetValidFrom(const char * THE_INSTRUMENT);</span>
<a name="l00892"></a>00892 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetValidTo(const char * THE_INSTRUMENT);</span>
<a name="l00893"></a>00893 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetMemo(const char * THE_INSTRUMENT);</span>
<a name="l00894"></a>00894 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetType(const char * THE_INSTRUMENT);</span>
<a name="l00895"></a>00895 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetServerID(const char * THE_INSTRUMENT);</span>
<a name="l00896"></a>00896 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetAssetID(const char * THE_INSTRUMENT);</span>
<a name="l00897"></a>00897 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetSenderUserID(const char * THE_INSTRUMENT);</span>
<a name="l00898"></a>00898 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetSenderAcctID(const char * THE_INSTRUMENT);</span>
<a name="l00899"></a>00899 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetRecipientUserID(const char * THE_INSTRUMENT);</span>
<a name="l00900"></a>00900 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetRecipientAcctID(const char * THE_INSTRUMENT);</span>
<a name="l00901"></a>00901 <span class="comment">*/</span>
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="class_o_t___command.html#a3eb82fa01247f3e43fdae2b4deaa3cb8">00903</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3eb82fa01247f3e43fdae2b4deaa3cb8">OT_Command::details_cancel_outgoing</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNym, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcct, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905     int32_t nIndicesCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices);
<a name="l00906"></a>00906     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2867a2de7baa62a90e24487bc1b7f8d4">OTAPI_Wrap::GetNym_OutpaymentsCount</a>(strMyNym);
<a name="l00907"></a>00907     int32_t nSuccess = 1;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     <span class="comment">//    OTAPI_Wrap::Output(0, &quot;\n\nNOTE: You can&#39;t just discard a sent cheque from your outpayment box. Why not?\nJust because you remove your record of the outgoing cheque, doesn&#39;t mean you didn&#39;t already send it. (The recipient still received it, and still has it, whether you remove it from your outbox or not.) If you really want to cancel the cheque, then you need to do it in such a way that it will fail-as-cancelled when the recipient tries to deposit it. Otherwise, he would get that money whether you kept your own outgoing record or not. Therefore TODO: SOME server message must be performed here, which actually cancels the transaction number itself that appears on the cheque. This is the only way to insure that the cheque can&#39;t be used by the recipient (and even this will only work if you beat him to the punch -- otherwise if he deposits it before you cancel it, then it&#39;s already too late and he has the money.) THIS is why RecordPayment, regarding outpayments, only works on expired instruments -- because if it&#39;s not expired, you don&#39;t just want to remove your record of it. You want to cancel the transaction number itself -- and that requires server communication.\n\n&quot;);</span>
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l00913"></a>00913     {
<a name="l00914"></a>00914         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving outpayments count for Nym: &quot;</span> + strMyNym + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00915"></a>00915         <span class="keywordflow">return</span> -1;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (nCount == 0)
<a name="l00919"></a>00919     {
<a name="l00920"></a>00920         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(Outpayment box is empty.)\n&quot;</span>);
<a name="l00921"></a>00921         nSuccess = 0;
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923     <span class="keywordflow">else</span>
<a name="l00924"></a>00924     {
<a name="l00925"></a>00925         <span class="keywordflow">for</span> (int32_t nIndex = (nCount - 1); nIndex &gt;= 0; --nIndex)
<a name="l00926"></a>00926         {
<a name="l00927"></a>00927 <span class="comment">//          bool bRemoved = OTAPI_Wrap::Nym_RemoveOutpaymentsByIndex(strMyNym, nIndex); // (1 or 0.)</span>
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 <span class="comment">//          string strRecorded = bRecorded ? &quot;Success&quot; : &quot;Failure&quot;</span>
<a name="l00930"></a>00930 <span class="comment">//          OTAPI_Wrap::Output(0,  strRecorded + &quot; discarding instrument from outpayment box at index: &quot; + to_string(nIndex) + &quot;.\n&quot;);</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 <span class="comment">//          if (!bRemoved)</span>
<a name="l00933"></a>00933 <span class="comment">//          { nSuccess = -1; }</span>
<a name="l00934"></a>00934 
<a name="l00935"></a>00935             <span class="keywordtype">bool</span> bContinue = <span class="keyword">false</span>;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937             <span class="comment">// - If &quot;all&quot; was passed, we process the item.</span>
<a name="l00938"></a>00938             <span class="comment">// - If indices are specified, but the current index is not on</span>
<a name="l00939"></a>00939             <span class="comment">//   that list, then continue...</span>
<a name="l00940"></a>00940             <span class="comment">//</span>
<a name="l00941"></a>00941             <span class="keywordflow">if</span> (!(<span class="stringliteral">&quot;all&quot;</span> == strIndices) &amp;&amp; (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nIndicesCount) &amp;&amp; (nIndicesCount &gt; 0) &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex))))
<a name="l00942"></a>00942             {
<a name="l00943"></a>00943                 <span class="comment">//              continue  // apparently not supported by the language.</span>
<a name="l00944"></a>00944                 bContinue = <span class="keyword">true</span>;
<a name="l00945"></a>00945             }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947             <span class="keywordtype">string</span> strServer = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00948"></a>00948             <span class="comment">// If it IS &quot;all,&quot; OR, if there are indices and the current index was found in them.</span>
<a name="l00949"></a>00949             <span class="comment">//</span>
<a name="l00950"></a>00950             <span class="keywordflow">if</span> (!bContinue)
<a name="l00951"></a>00951             {
<a name="l00952"></a>00952                 strServer = <a class="code" href="class_o_t_a_p_i___wrap.html#a38c7e7d4b3fc44afeabbd5d2b366355a">OTAPI_Wrap::GetNym_OutpaymentsServerIDByIndex</a>(strMyNym, nIndex);
<a name="l00953"></a>00953                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServer))
<a name="l00954"></a>00954                 {
<a name="l00955"></a>00955                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ERROR: Failed retrieving server ID from outpayment at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958                 <span class="keywordflow">else</span>
<a name="l00959"></a>00959                 {
<a name="l00960"></a>00960                     <span class="keywordtype">string</span> strPaymentContents = <a class="code" href="class_o_t_a_p_i___wrap.html#a75db1f5164e65a9ddabef0fc551a4e3d">OTAPI_Wrap::GetNym_OutpaymentsContentsByIndex</a>(strMyNym, nIndex);
<a name="l00961"></a>00961 
<a name="l00962"></a>00962                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPaymentContents))
<a name="l00963"></a>00963                     {
<a name="l00964"></a>00964                         <span class="comment">//                        string strPaymentAssetID   = OTAPI_Wrap::Instrmnt_GetAssetID (strPaymentContents)</span>
<a name="l00965"></a>00965                         <span class="keywordtype">string</span> strPaymentType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strPaymentContents);
<a name="l00966"></a>00966 
<a name="l00967"></a>00967                         <span class="comment">// Done: Put the code here where we message the server to cancel all relevant transaction</span>
<a name="l00968"></a>00968                         <span class="comment">// numbers for the instrument. If it&#39;s a cheque, there&#39;s only one number. But if it&#39;s a smart</span>
<a name="l00969"></a>00969                         <span class="comment">// contract, there could be many numbers. Seems like best thing is to just activate it, but</span>
<a name="l00970"></a>00970                         <span class="comment">// have a &quot;rejected&quot; flag which causes the activation to fail. (That way, all the other parties</span>
<a name="l00971"></a>00971                         <span class="comment">// will be properly notified, which the server already does.) We don&#39;t even need to remove it</span>
<a name="l00972"></a>00972                         <span class="comment">// from the outpayment box, because the failure notification from the server will already cause</span>
<a name="l00973"></a>00973                         <span class="comment">// the OTClient to remove it from the outpayment box.</span>
<a name="l00974"></a>00974                         <span class="comment">//</span>
<a name="l00975"></a>00975                         <span class="comment">// Ah-ha! ANY outgoing payment plan or smart contract is necessarily incomplete: it&#39;s outgoing</span>
<a name="l00976"></a>00976                         <span class="comment">// because it was sent to the next party so he could sign it, too, and probably activate it.</span>
<a name="l00977"></a>00977                         <span class="comment">// Presumably he has not done so yet (if I am &#39;beating him to the punch&#39; by cancelling it before</span>
<a name="l00978"></a>00978                         <span class="comment">// he can activate it) and therefore the plan or smart contract still is missing at least one</span>
<a name="l00979"></a>00979                         <span class="comment">// signer, so it is GUARANTEED to fail verification if I try to activate it myself. (Good.)</span>
<a name="l00980"></a>00980                         <span class="comment">//</span>
<a name="l00981"></a>00981                         <span class="comment">// This means I can just take whatever instrument appears outgoing, and try to activate it myself.</span>
<a name="l00982"></a>00982                         <span class="comment">// It will definitely fail activation, and then the failure notice will already be sent from that,</span>
<a name="l00983"></a>00983                         <span class="comment">// to all the parties, and they can harvest back their numbers automatically as necessary.</span>
<a name="l00984"></a>00984                         <span class="comment">//</span>
<a name="l00985"></a>00985                         <span class="comment">// The one problem is, though this works for payment plans and smart contracts, it will not work</span>
<a name="l00986"></a>00986                         <span class="comment">// for cheques. The cheque is made out to someone else, and he is the one normally who needs to</span>
<a name="l00987"></a>00987                         <span class="comment">// deposit it. Plus, I can&#39;t deposit a cheque into the same account it&#39;s drawn on.</span>
<a name="l00988"></a>00988                         <span class="comment">//</span>
<a name="l00989"></a>00989                         <span class="comment">// UPDATE: Now when a cheque is deposited into the same account it was drawn on, that will be</span>
<a name="l00990"></a>00990                         <span class="comment">// interpreted by the server as a request to CANCEL the cheque.</span>
<a name="l00991"></a>00991                         <span class="comment">//</span>
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 
<a name="l00994"></a>00994                         <span class="keywordflow">if</span> (<span class="stringliteral">&quot;SMARTCONTRACT&quot;</span> == strPaymentType)
<a name="l00995"></a>00995                         {
<a name="l00996"></a>00996                             <span class="comment">// Just take the smart contract from the outpayment box, and try to</span>
<a name="l00997"></a>00997                             <span class="comment">// activate it. It WILL fail, and then the failure message will be</span>
<a name="l00998"></a>00998                             <span class="comment">// propagated to all the other parties to the contract. (Which will</span>
<a name="l00999"></a>00999                             <span class="comment">// result in its automatic removal from the outpayment box.)</span>
<a name="l01000"></a>01000                             <span class="comment">//</span>
<a name="l01001"></a>01001                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcct))
<a name="l01002"></a>01002                             {
<a name="l01003"></a>01003                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You must provide an account owned by this Nym, which will be used for the cancellation. Try adding --myacct ACCT_ID\nNOTE: in the future we should just look up one of the accounts from the smart contract itself, since the current Nym has already confirmed the contract. But for now I&#39;m just collecting the acct ID at the command line, since it&#39;s faster.\n&quot;</span>);
<a name="l01004"></a>01004                             }
<a name="l01005"></a>01005                             <span class="keywordflow">else</span>
<a name="l01006"></a>01006                             {
<a name="l01007"></a>01007                                 <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a19baeebf93ddebc5d846ef8ce41b6111">MadeEasy::activate_smart_contract</a>(strServer, strMyNym, strMyAcct, <span class="stringliteral">&quot;acct_agent_name&quot;</span>, strPaymentContents);
<a name="l01008"></a>01008 
<a name="l01009"></a>01009                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Okay I just tried to activate the smart contract. (As a way of cancelling it.)\nSo while we expect this &#39;activation&#39; to fail, it should have the desired effect of cancelling the smart contract and sending failure notices to all the parties.\n&quot;</span>);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011                                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l01012"></a>01012                                 {
<a name="l01013"></a>01013                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Here&#39;s the server reply: \n&quot;</span> + strResponse + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015                                     int32_t nTransCancelled = <a class="code" href="class_o_t_a_p_i___wrap.html#a45ed86fe6aada3749d9c8ebecce6e15c">OTAPI_Wrap::Message_IsTransactionCanceled</a>(strServer, strMyNym, strMyAcct, strResponse);
<a name="l01016"></a>01016 
<a name="l01017"></a>01017                                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTransCancelled) &amp;&amp; (1 == nTransCancelled))
<a name="l01018"></a>01018                                     {
<a name="l01019"></a>01019                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Success canceling!\n&quot;</span>);
<a name="l01020"></a>01020                                     }
<a name="l01021"></a>01021                                     <span class="keywordflow">else</span>
<a name="l01022"></a>01022                                     {
<a name="l01023"></a>01023                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Error canceling!\n&quot;</span>);
<a name="l01024"></a>01024                                         nSuccess = -1;
<a name="l01025"></a>01025                                     }
<a name="l01026"></a>01026                                 }
<a name="l01027"></a>01027                                 <span class="keywordflow">else</span>
<a name="l01028"></a>01028                                 {
<a name="l01029"></a>01029                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange, tried to cancel, but received a NULL server reply.\n&quot;</span>);
<a name="l01030"></a>01030                                 }
<a name="l01031"></a>01031                             }
<a name="l01032"></a>01032                         }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 
<a name="l01035"></a>01035                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PAYMENT PLAN&quot;</span> == strPaymentType)
<a name="l01036"></a>01036                         {
<a name="l01037"></a>01037                             <span class="comment">// Just take the payment plan from the outpayment box, and try to</span>
<a name="l01038"></a>01038                             <span class="comment">// activate it. It WILL fail, and then the failure message will be</span>
<a name="l01039"></a>01039                             <span class="comment">// propagated to the other party to the contract. (Which will</span>
<a name="l01040"></a>01040                             <span class="comment">// result in its automatic removal from the outpayment box.)</span>
<a name="l01041"></a>01041 
<a name="l01042"></a>01042                             <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a2b79e8b9956b92dce9894820ffb17ce3">MadeEasy::cancel_payment_plan</a>(strServer, strMyNym, strPaymentContents);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Okay I just tried to activate the payment plan. (As a way of cancelling it.)\nSo while we expect this &#39;activation&#39; to fail, it should have the desired effect of cancelling the payment plan and sending failure notices to all the parties.\n&quot;</span>);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046                             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l01047"></a>01047                             {
<a name="l01048"></a>01048                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Here&#39;s the server reply: \n&quot;</span> + strResponse + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                                 int32_t nTransCancelled = <a class="code" href="class_o_t_a_p_i___wrap.html#a45ed86fe6aada3749d9c8ebecce6e15c">OTAPI_Wrap::Message_IsTransactionCanceled</a>(strServer, strMyNym, strMyAcct, strResponse);
<a name="l01051"></a>01051 
<a name="l01052"></a>01052                                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTransCancelled) &amp;&amp; (1 == nTransCancelled))
<a name="l01053"></a>01053                                 {
<a name="l01054"></a>01054                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Success canceling!\n&quot;</span>);
<a name="l01055"></a>01055                                 }
<a name="l01056"></a>01056                                 <span class="keywordflow">else</span>
<a name="l01057"></a>01057                                 {
<a name="l01058"></a>01058                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Error canceling!\n&quot;</span>);
<a name="l01059"></a>01059                                     nSuccess = -1;
<a name="l01060"></a>01060                                 }
<a name="l01061"></a>01061                             }
<a name="l01062"></a>01062                             <span class="keywordflow">else</span>
<a name="l01063"></a>01063                             {
<a name="l01064"></a>01064                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange, tried to cancel, but received a NULL server reply.\n&quot;</span>);
<a name="l01065"></a>01065                             }
<a name="l01066"></a>01066                         }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a>01069                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PURSE&quot;</span> == strPaymentType)
<a name="l01070"></a>01070                         {
<a name="l01071"></a>01071                             <span class="comment">// This is a tricky one -- why would anyone EVER want to discard outgoing cash?</span>
<a name="l01072"></a>01072                             <span class="comment">// Normally your incentive would be to do the opposite: Keep a copy of all outgoing</span>
<a name="l01073"></a>01073                             <span class="comment">// cash until the copy itself expires (when the cash expires.) This way it&#39;s always</span>
<a name="l01074"></a>01074                             <span class="comment">// recoverable in the event of a &quot;worst case&quot; situation.</span>
<a name="l01075"></a>01075                             <span class="comment">//</span>
<a name="l01076"></a>01076                             <span class="comment">// So what do we do in this case? Nevertheless, the user has explicitly just instructed</span>
<a name="l01077"></a>01077                             <span class="comment">// the client to DISCARD OUTGOING CASH.</span>
<a name="l01078"></a>01078                             <span class="comment">//</span>
<a name="l01079"></a>01079                             <span class="comment">// Perhaps we should just ask the user to CONFIRM that he wants to erase the cash,</span>
<a name="l01080"></a>01080                             <span class="comment">// and make SURE that he understands the consequences of that choice.</span>
<a name="l01081"></a>01081 
<a name="l01082"></a>01082 <span class="comment">//                          OTAPI_Wrap::Output(0, &quot;Any outgoing cash will already be automatically moved to the record box once it expires. No need to move it by hand.\nAre you SURE you want to move it now? [y/N] &quot;);</span>
<a name="l01083"></a>01083 <span class="comment">//                          string strYes = OT_CLI_ReadLine()</span>
<a name="l01084"></a>01084 <span class="comment">//</span>
<a name="l01085"></a>01085 <span class="comment">//                          if (VerifyStringVal(strYes) &amp;&amp; ((&quot;y&quot; == strYes) || (&quot;Y&quot; == strYes)))</span>
<a name="l01086"></a>01086                             {
<a name="l01087"></a>01087                                 <span class="comment">// removes payment instrument (from payments in or out box)</span>
<a name="l01088"></a>01088                                 <span class="keywordtype">bool</span> bRecorded = <a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(strServer, strMyNym,
<a name="l01089"></a>01089                                 <span class="keyword">false</span>, <span class="comment">// true == payments inbox. false == payments outbox.</span>
<a name="l01090"></a>01090                                 nIndex,
<a name="l01091"></a>01091                                 <span class="keyword">false</span>); <span class="comment">// bSaveCopy = false.</span>
<a name="l01092"></a>01092                                 <span class="keywordflow">if</span> (!bRecorded) { nSuccess = -1; }
<a name="l01093"></a>01093                                 <span class="keywordflow">else</span> { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Discarded cash purse:\n\n&quot;</span> + strPaymentContents + <span class="stringliteral">&quot;\n&quot;</span>); }
<a name="l01094"></a>01094                                 <span class="keywordtype">string</span> strRecorded = bRecorded ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failure&quot;</span>;
<a name="l01095"></a>01095                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strRecorded + <span class="stringliteral">&quot; discarding cash purse from outpayment box at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;.\n\n&quot;</span>);
<a name="l01096"></a>01096                             }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098                         }
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 
<a name="l01101"></a>01101                         <span class="keywordflow">else</span>  <span class="comment">// CHEQUE VOUCHER INVOICE</span>
<a name="l01102"></a>01102                         {
<a name="l01103"></a>01103                             int32_t nDepositCheque = -1;
<a name="l01104"></a>01104                             <span class="keywordtype">bool</span> bIsVoucher = (<span class="stringliteral">&quot;VOUCHER&quot;</span> == strPaymentType);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106                             <span class="comment">// Get the nym and account IDs from the cheque itself.</span>
<a name="l01107"></a>01107                             <span class="comment">//</span>
<a name="l01108"></a>01108                             <span class="keywordtype">string</span> strSenderAcctID = (bIsVoucher ? <a class="code" href="class_o_t_a_p_i___wrap.html#a55a51b033a66ea943e52aa1185e690c6">OTAPI_Wrap::Instrmnt_GetRemitterAcctID</a>(strPaymentContents) : <a class="code" href="class_o_t_a_p_i___wrap.html#ae7c2873a9439b938209438311652007e">OTAPI_Wrap::Instrmnt_GetSenderAcctID</a>(strPaymentContents));
<a name="l01109"></a>01109                             <span class="keywordtype">string</span> strSenderUserID = (bIsVoucher ? <a class="code" href="class_o_t_a_p_i___wrap.html#ab58799407be4d434d10ecd8def911685">OTAPI_Wrap::Instrmnt_GetRemitterUserID</a>(strPaymentContents) : <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strPaymentContents));
<a name="l01110"></a>01110 
<a name="l01111"></a>01111                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID))
<a name="l01112"></a>01112                             {
<a name="l01113"></a>01113                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure trying to retrieve asset account ID from instrument.\n&quot;</span>);
<a name="l01114"></a>01114                             }
<a name="l01115"></a>01115                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID))
<a name="l01116"></a>01116                             {
<a name="l01117"></a>01117                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure trying to retrieve Sender Nym ID from instrument.\n&quot;</span>);
<a name="l01118"></a>01118                             }
<a name="l01119"></a>01119                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(strSenderUserID == strMyNym))
<a name="l01120"></a>01120                             {
<a name="l01121"></a>01121                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure, very strange: Sender Nym ID on the instrument doesn&#39;t match the Nym ID.\n&quot;</span>);
<a name="l01122"></a>01122                             }
<a name="l01123"></a>01123                             <span class="keywordflow">else</span>
<a name="l01124"></a>01124                             {
<a name="l01125"></a>01125                                 nDepositCheque = <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">OT_Command::details_deposit_cheque</a>(strServer, strSenderAcctID, strSenderUserID, strPaymentContents, strPaymentType);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span> + <span class="keywordtype">string</span>((1 == nDepositCheque) ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failure&quot;</span>) + <span class="stringliteral">&quot; canceling cheque of type: &quot;</span> + strPaymentType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01128"></a>01128                             }
<a name="l01129"></a>01129                         }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 
<a name="l01132"></a>01132                     }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134                 }
<a name="l01135"></a>01135             } <span class="comment">//if (!bContinue)</span>
<a name="l01136"></a>01136 
<a name="l01137"></a>01137         } <span class="comment">// for (backwards through outpayments box.)</span>
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139     <span class="keywordflow">return</span> nSuccess;
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 
<a name="l01143"></a><a class="code" href="class_o_t___command.html#a33f6718e0d65caca64ae2b9310ba1e25">01143</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a33f6718e0d65caca64ae2b9310ba1e25">OT_Command::main_cancel_outgoing</a>()
<a name="l01144"></a>01144 {
<a name="l01145"></a>01145     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs cancel --mynym NYM_ID --args \&quot;index INDEX_GOES_HERE\&quot;\n\nThis command cancels an outgoing instrument from the outpayment box.\n(Usually used for cancelling a cheque, payment plan, or smart contract.)\nThis, of course, will fail on the server side, if the recipient has already deposited the cheque.\n\n&quot;</span>;
<a name="l01146"></a>01146     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l01149"></a>01149     {
<a name="l01150"></a>01150         <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01151"></a>01151         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01152"></a>01152         <span class="keywordtype">string</span> strFinalIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01153"></a>01153         <span class="keywordtype">bool</span> bUseStdin = <span class="keyword">false</span>;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l01156"></a>01156         {
<a name="l01157"></a>01157             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l01158"></a>01158             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l01159"></a>01159             <span class="comment">//</span>
<a name="l01160"></a>01160             strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l01161"></a>01161             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l01162"></a>01162 
<a name="l01163"></a>01163             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l01164"></a>01164             {
<a name="l01165"></a>01165                 strFinalIndex = strIndex;
<a name="l01166"></a>01166             }
<a name="l01167"></a>01167             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices))
<a name="l01168"></a>01168             {
<a name="l01169"></a>01169                 strFinalIndex = strIndices;
<a name="l01170"></a>01170             }
<a name="l01171"></a>01171             <span class="keywordflow">else</span>
<a name="l01172"></a>01172             {
<a name="l01173"></a>01173                 bUseStdin = <span class="keyword">true</span>;
<a name="l01174"></a>01174             }
<a name="l01175"></a>01175         }
<a name="l01176"></a>01176         <span class="keywordflow">else</span> { bUseStdin = <span class="keyword">true</span>; }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178         <span class="keywordflow">if</span> (bUseStdin)
<a name="l01179"></a>01179         {
<a name="l01180"></a>01180             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2867a2de7baa62a90e24487bc1b7f8d4">OTAPI_Wrap::GetNym_OutpaymentsCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l01181"></a>01181 
<a name="l01182"></a>01182             <span class="keywordflow">for</span> (int32_t nPayments = 0; nPayments &lt; nCount; ++nPayments)
<a name="l01183"></a>01183             {
<a name="l01184"></a>01184                 <a class="code" href="class_o_t___command.html#acbfdfdeee2de0cbd0a1146901993666b">show_outpayment</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nPayments, <span class="keyword">false</span>); <span class="comment">// bShowInFull=false</span>
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nPlease enter the index (in your outpayment box)\nof the instrument you are cancelling: &quot;</span>);
<a name="l01188"></a>01188             strIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01189"></a>01189 
<a name="l01190"></a>01190             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l01191"></a>01191             {
<a name="l01192"></a>01192                 strFinalIndex = strIndex;
<a name="l01193"></a>01193             }
<a name="l01194"></a>01194             <span class="keywordflow">else</span> { <span class="keywordflow">return</span> -1; }
<a name="l01195"></a>01195         }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="keywordtype">string</span> strMyAcct = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01198"></a>01198         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>)) <span class="comment">// Used in the case of smart contracts.</span>
<a name="l01199"></a>01199         {
<a name="l01200"></a>01200             strMyAcct = <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>;
<a name="l01201"></a>01201         }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a3eb82fa01247f3e43fdae2b4deaa3cb8">details_cancel_outgoing</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strMyAcct, strFinalIndex);
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="keywordflow">return</span> -1;
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 <span class="comment">/*</span>
<a name="l01211"></a>01211 <span class="comment">We might also need something like: OT_Command::main_show_cron_items</span>
<a name="l01212"></a>01212 <span class="comment">(Because we can&#39;t trigger a clause on a running smart contract,</span>
<a name="l01213"></a>01213 <span class="comment">unless we are able to list the running smart contracts and thus</span>
<a name="l01214"></a>01214 <span class="comment">ascertain the transaction number of the one whose clause we wish</span>
<a name="l01215"></a>01215 <span class="comment">to trigger.)</span>
<a name="l01216"></a>01216 <span class="comment">*/</span>
<a name="l01217"></a>01217 
<a name="l01218"></a><a class="code" href="class_o_t___command.html#ab530c9feb9d0a2bfe16835f4eaa27654">01218</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab530c9feb9d0a2bfe16835f4eaa27654">OT_Command::details_trigger_clause</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strTransNum, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strClause, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strParam)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#aa52e195e4bdc3c741c9397e31949c10b">MadeEasy::trigger_clause</a>(strServerID, strMyNymID, strTransNum, strClause, strParam);
<a name="l01221"></a>01221     int32_t nMessageSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMessageSuccess) || (1 != nMessageSuccess))
<a name="l01224"></a>01224     {
<a name="l01225"></a>01225         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;For whatever reason, our attempt to trigger the clause has failed.\n&quot;</span>);
<a name="l01226"></a>01226     }
<a name="l01227"></a>01227     <span class="keywordflow">else</span>
<a name="l01228"></a>01228     {
<a name="l01229"></a>01229         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success!\n&quot;</span>);
<a name="l01230"></a>01230     }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     <span class="keywordflow">return</span> nMessageSuccess;
<a name="l01233"></a>01233 }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235 
<a name="l01236"></a>01236 <span class="comment">//def OT_Command::main_trigger_clause()</span>
<a name="l01237"></a>01237 <span class="comment">//{; }</span>
<a name="l01238"></a>01238 
<a name="l01239"></a>01239 
<a name="l01240"></a><a class="code" href="class_o_t___command.html#a4770bd860e0eb8b0e81928dfd096c3dd">01240</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a4770bd860e0eb8b0e81928dfd096c3dd">OT_Command::main_trigger_clause</a>()
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE STRING GOES HERE&quot;</span>;
<a name="l01243"></a>01243     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 
<a name="l01246"></a>01246     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l01247"></a>01247     {
<a name="l01248"></a>01248         <span class="comment">// At this point we need to collect some other data:</span>
<a name="l01249"></a>01249         <span class="comment">// First, we need the transaction number for the smart contract.</span>
<a name="l01250"></a>01250         <span class="comment">// Second, we need the name of the clause we will be triggering.</span>
<a name="l01251"></a>01251         <span class="comment">// Third we need (optionally) any string parameter that the user</span>
<a name="l01252"></a>01252         <span class="comment">// may wish to pass into the clause when it gets triggered.</span>
<a name="l01253"></a>01253         <span class="comment">//</span>
<a name="l01254"></a>01254 
<a name="l01255"></a>01255         <span class="keywordtype">string</span> strTransNum = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01256"></a>01256         <span class="keywordtype">string</span> strClause = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01257"></a>01257         <span class="keywordtype">string</span> strParam = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01258"></a>01258 
<a name="l01259"></a>01259         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l01260"></a>01260         {
<a name="l01261"></a>01261             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l01262"></a>01262             <span class="comment">//                                  const std::string str_key)</span>
<a name="l01263"></a>01263             <span class="comment">//</span>
<a name="l01264"></a>01264             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l01265"></a>01265             <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l01266"></a>01266             <span class="comment">//</span>
<a name="l01267"></a>01267             <span class="keywordtype">string</span> strTempTransNum = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;id&quot;</span>);
<a name="l01268"></a>01268             <span class="keywordtype">string</span> strTempClause = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;clause&quot;</span>);
<a name="l01269"></a>01269             <span class="keywordtype">string</span> strTempParam = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;param&quot;</span>);
<a name="l01270"></a>01270 
<a name="l01271"></a>01271             <span class="comment">// TRANSACTION ID</span>
<a name="l01272"></a>01272             <span class="comment">//</span>
<a name="l01273"></a>01273             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempTransNum))
<a name="l01274"></a>01274             {
<a name="l01275"></a>01275                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the transaction ID for the running smart contract: &quot;</span>);
<a name="l01276"></a>01276                 <span class="keywordtype">string</span> strInputTransNum = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01277"></a>01277 
<a name="l01278"></a>01278                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInputTransNum))
<a name="l01279"></a>01279                 {
<a name="l01280"></a>01280                     strTransNum = strInputTransNum;
<a name="l01281"></a>01281                 }
<a name="l01282"></a>01282             }
<a name="l01283"></a>01283             <span class="keywordflow">else</span>
<a name="l01284"></a>01284             {
<a name="l01285"></a>01285                 strTransNum = strTempTransNum;
<a name="l01286"></a>01286             }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288             <span class="comment">// CLAUSE NAME</span>
<a name="l01289"></a>01289             <span class="comment">//</span>
<a name="l01290"></a>01290             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempClause))
<a name="l01291"></a>01291             {
<a name="l01292"></a>01292                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the name of the clause you wish to trigger: &quot;</span>);
<a name="l01293"></a>01293                 <span class="keywordtype">string</span> strInputClause = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01294"></a>01294 
<a name="l01295"></a>01295                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInputClause))
<a name="l01296"></a>01296                 {
<a name="l01297"></a>01297                     strClause = strInputClause;
<a name="l01298"></a>01298                 }
<a name="l01299"></a>01299             }
<a name="l01300"></a>01300             <span class="keywordflow">else</span>
<a name="l01301"></a>01301             {
<a name="l01302"></a>01302                 strClause = strTempClause;
<a name="l01303"></a>01303             }
<a name="l01304"></a>01304 
<a name="l01305"></a>01305             <span class="comment">// OPTIONAL PARAMETER</span>
<a name="l01306"></a>01306             <span class="comment">//</span>
<a name="l01307"></a>01307             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempParam))
<a name="l01308"></a>01308             {
<a name="l01309"></a>01309                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You can pass an optional parameter string (to pass to the clause itself)\nfollowed by a ~ by itself on a blank line. (Just use ~ to leave it blank.)\n\n&quot;</span>);
<a name="l01310"></a>01310                 <span class="keywordtype">string</span> strInputParam = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l01311"></a>01311 
<a name="l01312"></a>01312                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInputParam))
<a name="l01313"></a>01313                 {
<a name="l01314"></a>01314                     strParam = strInputParam;
<a name="l01315"></a>01315                 }
<a name="l01316"></a>01316             }
<a name="l01317"></a>01317             <span class="keywordflow">else</span>
<a name="l01318"></a>01318             {
<a name="l01319"></a>01319                 strParam = strTempParam;
<a name="l01320"></a>01320             }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322         } <span class="comment">// VerifyExists(&quot;Args&quot;)</span>
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransNum) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strClause))
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab530c9feb9d0a2bfe16835f4eaa27654">details_trigger_clause</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strTransNum, strClause, strParam);
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329     }
<a name="l01330"></a>01330     <span class="keywordflow">return</span> -1;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a>01333 
<a name="l01334"></a><a class="code" href="class_o_t___command.html#a5aca73ffcc9091c2b7c9047c9631daec">01334</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#a5aca73ffcc9091c2b7c9047c9631daec">OT_Command::find_revokedID_for_subcred</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInputID)
<a name="l01335"></a>01335 {
<a name="l01336"></a>01336     int32_t nCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#afa5c49562be0a84164912b69f661a7d9">OTAPI_Wrap::GetNym_RevokedCredCount</a>(strMyNymID);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCredCount))
<a name="l01339"></a>01339     {
<a name="l01340"></a>01340         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01341"></a>01341     }
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCredCount &gt;= 1)
<a name="l01344"></a>01344     {
<a name="l01345"></a>01345         <span class="keywordflow">for</span> (int32_t nCurrent = 0; nCurrent &lt; nCredCount; ++nCurrent)
<a name="l01346"></a>01346         {
<a name="l01347"></a>01347             <span class="keywordtype">string</span> strCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9c17b3c830d09b10e407c016267d40a2">OTAPI_Wrap::GetNym_RevokedCredID</a>(strMyNymID, nCurrent);
<a name="l01348"></a>01348 
<a name="l01349"></a>01349             int32_t nSubCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a14bec9a33bf94cf29b759635ba2793e6">OTAPI_Wrap::GetNym_SubcredentialCount</a>(strMyNymID, strCredID);
<a name="l01350"></a>01350 
<a name="l01351"></a>01351             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSubCredCount) &amp;&amp; (nSubCredCount &gt;= 1))
<a name="l01352"></a>01352             {
<a name="l01353"></a>01353                 <span class="keywordflow">for</span> (int32_t nCurrentSubCred = 0; nCurrentSubCred &lt; nSubCredCount; ++nCurrentSubCred)
<a name="l01354"></a>01354                 {
<a name="l01355"></a>01355                     <span class="keywordtype">string</span> strSubCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9dabe597d1a078c1a2c57adc6296d121">OTAPI_Wrap::GetNym_SubCredentialID</a>(strMyNymID, strCredID, nCurrentSubCred);
<a name="l01356"></a>01356 
<a name="l01357"></a>01357                     <span class="keywordflow">if</span> (strInputID == strSubCredID)
<a name="l01358"></a>01358                     {
<a name="l01359"></a>01359                         <span class="keywordflow">return</span> strCredID; <span class="comment">// Returns the revoked master credential ID associated with the subcred passed in.</span>
<a name="l01360"></a>01360                     }
<a name="l01361"></a>01361                 } <span class="comment">// loop sub-credentials.</span>
<a name="l01362"></a>01362             }
<a name="l01363"></a>01363         } <span class="comment">// loop credentials</span>
<a name="l01364"></a>01364 
<a name="l01365"></a>01365     }
<a name="l01366"></a>01366     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01367"></a>01367 }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 
<a name="l01370"></a><a class="code" href="class_o_t___command.html#a9cc9d3d1d6415ca7d5ffdca2fbd112a8">01370</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#a9cc9d3d1d6415ca7d5ffdca2fbd112a8">OT_Command::find_masterID_for_subcred</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInputID)
<a name="l01371"></a>01371 {
<a name="l01372"></a>01372     int32_t nCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a6d32e64e2e3665666abc352ef58623ef">OTAPI_Wrap::GetNym_CredentialCount</a>(strMyNymID);
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCredCount))
<a name="l01375"></a>01375     {
<a name="l01376"></a>01376         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01377"></a>01377     }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nCredCount &gt;= 1)
<a name="l01380"></a>01380     {
<a name="l01381"></a>01381         <span class="keywordflow">for</span> (int32_t nCurrent = 0; nCurrent &lt; nCredCount; ++nCurrent)
<a name="l01382"></a>01382         {
<a name="l01383"></a>01383             <span class="keywordtype">string</span> strCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a0f17b7d0c20197d158325a8147cfdbcc">OTAPI_Wrap::GetNym_CredentialID</a>(strMyNymID, nCurrent);
<a name="l01384"></a>01384 
<a name="l01385"></a>01385             int32_t nSubCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a14bec9a33bf94cf29b759635ba2793e6">OTAPI_Wrap::GetNym_SubcredentialCount</a>(strMyNymID, strCredID);
<a name="l01386"></a>01386 
<a name="l01387"></a>01387             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSubCredCount) &amp;&amp; (nSubCredCount &gt;= 1))
<a name="l01388"></a>01388             {
<a name="l01389"></a>01389                 <span class="keywordflow">for</span> (int32_t nCurrentSubCred = 0; nCurrentSubCred &lt; nSubCredCount; ++nCurrentSubCred)
<a name="l01390"></a>01390                 {
<a name="l01391"></a>01391                     <span class="keywordtype">string</span> strSubCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9dabe597d1a078c1a2c57adc6296d121">OTAPI_Wrap::GetNym_SubCredentialID</a>(strMyNymID, strCredID, nCurrentSubCred);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393                     <span class="keywordflow">if</span> (strInputID == strSubCredID)
<a name="l01394"></a>01394                     {
<a name="l01395"></a>01395                         <span class="keywordflow">return</span> strCredID; <span class="comment">// Returns the master credential ID associated with the subcred passed in.</span>
<a name="l01396"></a>01396                     }
<a name="l01397"></a>01397                 } <span class="comment">// loop sub-credentials.</span>
<a name="l01398"></a>01398             }
<a name="l01399"></a>01399         } <span class="comment">// loop credentials</span>
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01403"></a>01403 }
<a name="l01404"></a>01404 
<a name="l01405"></a>01405 
<a name="l01406"></a>01406 <span class="comment">// Takes a Nym ID and a credential ID and displays the contents</span>
<a name="l01407"></a>01407 <span class="comment">// for the credential.</span>
<a name="l01408"></a>01408 <span class="comment">// The credential might be a master credential, or a subcredential.</span>
<a name="l01409"></a>01409 <span class="comment">// It also might be a revoked credential.</span>
<a name="l01410"></a>01410 <span class="comment">// Handle all cases.</span>
<a name="l01411"></a>01411 <span class="comment">//</span>
<a name="l01412"></a><a class="code" href="class_o_t___command.html#a8ff2eeabf33d1e3e06ed3ed7a61cfc8d">01412</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a8ff2eeabf33d1e3e06ed3ed7a61cfc8d">OT_Command::details_show_credential</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strCredID)
<a name="l01413"></a>01413 {
<a name="l01414"></a>01414     <span class="keywordtype">string</span> strCredContents = <a class="code" href="class_o_t_a_p_i___wrap.html#a07d0faf9fe3446b8e06b71bca1129eec">OTAPI_Wrap::GetNym_CredentialContents</a>(strMyNymID, strCredID);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCredContents))
<a name="l01417"></a>01417     {
<a name="l01418"></a>01418         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Master Credential contents:\n&quot;</span>);
<a name="l01419"></a>01419         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCredContents);
<a name="l01420"></a>01420         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     strCredContents = <a class="code" href="class_o_t_a_p_i___wrap.html#ae4b7b18aad164298bc907dcf38f5475b">OTAPI_Wrap::GetNym_RevokedCredContents</a>(strMyNymID, strCredID);
<a name="l01424"></a>01424 
<a name="l01425"></a>01425     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCredContents))
<a name="l01426"></a>01426     {
<a name="l01427"></a>01427         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Revoked Credential contents:\n&quot;</span>);
<a name="l01428"></a>01428         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCredContents);
<a name="l01429"></a>01429         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432     <span class="comment">// It MUST be a subcredential by this point, either for a master</span>
<a name="l01433"></a>01433     <span class="comment">// or revoked master credential.</span>
<a name="l01434"></a>01434     <span class="comment">//</span>
<a name="l01435"></a>01435     <span class="keywordtype">bool</span> bIsRevoked = <span class="keyword">false</span>;
<a name="l01436"></a>01436     <span class="keywordtype">string</span> strMasterID = <a class="code" href="class_o_t___command.html#a9cc9d3d1d6415ca7d5ffdca2fbd112a8">find_masterID_for_subcred</a>(strMyNymID, strCredID);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMasterID))
<a name="l01439"></a>01439     {
<a name="l01440"></a>01440         strMasterID = <a class="code" href="class_o_t___command.html#a5aca73ffcc9091c2b7c9047c9631daec">find_revokedID_for_subcred</a>(strMyNymID, strCredID);
<a name="l01441"></a>01441         bIsRevoked = <span class="keyword">true</span>;
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMasterID))
<a name="l01445"></a>01445     {
<a name="l01446"></a>01446         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, unable to find any credentials associated with that ID.\n&quot;</span>);
<a name="l01447"></a>01447     }
<a name="l01448"></a>01448     <span class="keywordflow">else</span>
<a name="l01449"></a>01449     {
<a name="l01450"></a>01450         strCredContents = <a class="code" href="class_o_t_a_p_i___wrap.html#a0be1a273796c7bfdd09123cb77af62f7">OTAPI_Wrap::GetNym_SubCredentialContents</a>(strMyNymID, strMasterID, strCredID);
<a name="l01451"></a>01451 
<a name="l01452"></a>01452         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCredContents))
<a name="l01453"></a>01453         {
<a name="l01454"></a>01454             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving sub-credential contents.\n&quot;</span>);
<a name="l01455"></a>01455             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01456"></a>01456         }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458         <span class="keywordflow">if</span> (bIsRevoked)
<a name="l01459"></a>01459         {
<a name="l01460"></a>01460             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Revoked Subcredential contents:\n&quot;</span>);
<a name="l01461"></a>01461         }
<a name="l01462"></a>01462         <span class="keywordflow">else</span>
<a name="l01463"></a>01463         {
<a name="l01464"></a>01464             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Subcredential contents:\n&quot;</span>);
<a name="l01465"></a>01465         }
<a name="l01466"></a>01466         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCredContents); <span class="comment">// Great success!</span>
<a name="l01467"></a>01467         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01468"></a>01468         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01469"></a>01469     }
<a name="l01470"></a>01470     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01471"></a>01471 }
<a name="l01472"></a>01472 
<a name="l01473"></a>01473 
<a name="l01474"></a><a class="code" href="class_o_t___command.html#a241b882c1deb8c751760b29302ddc367">01474</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a241b882c1deb8c751760b29302ddc367">OT_Command::main_show_credential</a>()
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs showcred --mynym NYM_ID --args \&quot;id CREDENTIAL_ID\&quot;\n\nThis command displays the contents of a given credential (for a given Nym.)\n\n&quot;</span>;
<a name="l01477"></a>01477     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l01480"></a>01480     {
<a name="l01481"></a>01481         <span class="keywordtype">string</span> strCredID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l01484"></a>01484         {
<a name="l01485"></a>01485             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l01486"></a>01486             <span class="comment">//                                  const std::string str_key)</span>
<a name="l01487"></a>01487             <span class="comment">//</span>
<a name="l01488"></a>01488             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l01489"></a>01489             <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l01490"></a>01490             <span class="comment">//</span>
<a name="l01491"></a>01491             <span class="keywordtype">string</span> strTempCredID = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;id&quot;</span>);
<a name="l01492"></a>01492 
<a name="l01493"></a>01493             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempCredID))
<a name="l01494"></a>01494             {
<a name="l01495"></a>01495                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the ID for the credential: &quot;</span>);
<a name="l01496"></a>01496                 <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l01497"></a>01497 
<a name="l01498"></a>01498                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInput))
<a name="l01499"></a>01499                 {
<a name="l01500"></a>01500                     strCredID = strInput;
<a name="l01501"></a>01501                 }
<a name="l01502"></a>01502             }
<a name="l01503"></a>01503             <span class="keywordflow">else</span>
<a name="l01504"></a>01504             {
<a name="l01505"></a>01505                 strCredID = strTempCredID;
<a name="l01506"></a>01506             }
<a name="l01507"></a>01507         } <span class="comment">// VerifyExists(&quot;Args&quot;)</span>
<a name="l01508"></a>01508 
<a name="l01509"></a>01509         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCredID) &amp;&amp; <a class="code" href="class_o_t___command.html#a8ff2eeabf33d1e3e06ed3ed7a61cfc8d">details_show_credential</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strCredID))
<a name="l01510"></a>01510         {
<a name="l01511"></a>01511             <span class="keywordflow">return</span> 1;
<a name="l01512"></a>01512         }
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515     <span class="keywordflow">return</span> -1;
<a name="l01516"></a>01516 }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518 
<a name="l01519"></a><a class="code" href="class_o_t___command.html#acab83b6bad9b96800cffc0cbecd3e3a0">01519</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acab83b6bad9b96800cffc0cbecd3e3a0">OT_Command::details_show_credentials</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID)
<a name="l01520"></a>01520 {
<a name="l01521"></a>01521     int32_t nReturnVal = -1;
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     int32_t nCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a6d32e64e2e3665666abc352ef58623ef">OTAPI_Wrap::GetNym_CredentialCount</a>(strMyNymID);
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCredCount))
<a name="l01526"></a>01526     {
<a name="l01527"></a>01527         <span class="keywordflow">return</span> -1;
<a name="l01528"></a>01528     }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">if</span> (nCredCount &gt;= 1)
<a name="l01531"></a>01531     {
<a name="l01532"></a>01532         nReturnVal = 1;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx     Credential ID\n---------------------------\n&quot;</span>);
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <span class="keywordflow">for</span> (int32_t nCurrent = 0; nCurrent &lt; nCredCount; ++nCurrent)
<a name="l01537"></a>01537         {
<a name="l01538"></a>01538             <span class="keywordtype">string</span> strCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a0f17b7d0c20197d158325a8147cfdbcc">OTAPI_Wrap::GetNym_CredentialID</a>(strMyNymID, nCurrent);
<a name="l01539"></a>01539             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrent) + <span class="stringliteral">&quot;:      &quot;</span> + strCredID);
<a name="l01540"></a>01540 
<a name="l01541"></a>01541             int32_t nSubCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a14bec9a33bf94cf29b759635ba2793e6">OTAPI_Wrap::GetNym_SubcredentialCount</a>(strMyNymID, strCredID);
<a name="l01542"></a>01542 
<a name="l01543"></a>01543             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSubCredCount) &amp;&amp; (nSubCredCount &gt;= 1))
<a name="l01544"></a>01544             {
<a name="l01545"></a>01545 
<a name="l01546"></a>01546                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;        ---------------------------\n        Idx     Subcredential ID\n        ---------------------------\n&quot;</span>);
<a name="l01547"></a>01547 
<a name="l01548"></a>01548                 <span class="keywordflow">for</span> (int32_t nCurrentSubCred = 0; nCurrentSubCred &lt; nSubCredCount; ++nCurrentSubCred)
<a name="l01549"></a>01549                 {
<a name="l01550"></a>01550                     <span class="keywordtype">string</span> strSubCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9dabe597d1a078c1a2c57adc6296d121">OTAPI_Wrap::GetNym_SubCredentialID</a>(strMyNymID, strCredID, nCurrentSubCred);
<a name="l01551"></a>01551                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;        &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentSubCred) + <span class="stringliteral">&quot;:      &quot;</span> + strSubCredID);
<a name="l01552"></a>01552                 }
<a name="l01553"></a>01553             }
<a name="l01554"></a>01554         } <span class="comment">// credentials</span>
<a name="l01555"></a>01555 
<a name="l01556"></a>01556         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01557"></a>01557     }
<a name="l01558"></a>01558 
<a name="l01559"></a>01559     <span class="keywordflow">else</span> { nReturnVal = 0; }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561     <span class="comment">// Next: REVOKED credentials.</span>
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     nCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#afa5c49562be0a84164912b69f661a7d9">OTAPI_Wrap::GetNym_RevokedCredCount</a>(strMyNymID);
<a name="l01564"></a>01564 
<a name="l01565"></a>01565     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCredCount))
<a name="l01566"></a>01566     {
<a name="l01567"></a>01567         <span class="keywordflow">return</span> -1;
<a name="l01568"></a>01568     }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570     <span class="keywordflow">if</span> (nCredCount &gt;= 1)
<a name="l01571"></a>01571     {
<a name="l01572"></a>01572         nReturnVal = 1;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx     Revoked Credential ID\n---------------------------\n&quot;</span>);
<a name="l01575"></a>01575 
<a name="l01576"></a>01576         <span class="keywordflow">for</span> (int32_t nCurrent = 0; nCurrent &lt; nCredCount; ++nCurrent)
<a name="l01577"></a>01577         {
<a name="l01578"></a>01578             <span class="keywordtype">string</span> strCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9c17b3c830d09b10e407c016267d40a2">OTAPI_Wrap::GetNym_RevokedCredID</a>(strMyNymID, nCurrent);
<a name="l01579"></a>01579             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrent) + <span class="stringliteral">&quot;:      &quot;</span> + strCredID);
<a name="l01580"></a>01580 
<a name="l01581"></a>01581             int32_t nSubCredCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a14bec9a33bf94cf29b759635ba2793e6">OTAPI_Wrap::GetNym_SubcredentialCount</a>(strMyNymID, strCredID);
<a name="l01582"></a>01582 
<a name="l01583"></a>01583             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSubCredCount) &amp;&amp; (nSubCredCount &gt;= 1))
<a name="l01584"></a>01584             {
<a name="l01585"></a>01585 
<a name="l01586"></a>01586                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;        ---------------------------\n        Idx     Revoked Subcredential ID\n        ---------------------------\n&quot;</span>);
<a name="l01587"></a>01587 
<a name="l01588"></a>01588                 <span class="keywordflow">for</span> (int32_t nCurrentSubCred = 0; nCurrentSubCred &lt; nSubCredCount; ++nCurrentSubCred)
<a name="l01589"></a>01589                 {
<a name="l01590"></a>01590                     <span class="keywordtype">string</span> strSubCredID = <a class="code" href="class_o_t_a_p_i___wrap.html#a9dabe597d1a078c1a2c57adc6296d121">OTAPI_Wrap::GetNym_SubCredentialID</a>(strMyNymID, strCredID, nCurrentSubCred);
<a name="l01591"></a>01591                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;        &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentSubCred) + <span class="stringliteral">&quot;:      &quot;</span> + strSubCredID);
<a name="l01592"></a>01592                 }
<a name="l01593"></a>01593             }
<a name="l01594"></a>01594         } <span class="comment">// credentials</span>
<a name="l01595"></a>01595 
<a name="l01596"></a>01596         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599     <span class="keywordflow">return</span> nReturnVal;
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 
<a name="l01603"></a><a class="code" href="class_o_t___command.html#a034e2bc4092e1d58da9438b15083d6be">01603</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a034e2bc4092e1d58da9438b15083d6be">OT_Command::main_show_credentials</a>()
<a name="l01604"></a>01604 {
<a name="l01605"></a>01605     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs credentials --mynym NYM_ID\n\nThis command displays the list of credentials for a given Nym.\n\n&quot;</span>;
<a name="l01606"></a>01606     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l01607"></a>01607 
<a name="l01608"></a>01608     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l01609"></a>01609     {
<a name="l01610"></a>01610         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#acab83b6bad9b96800cffc0cbecd3e3a0">details_show_credentials</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l01611"></a>01611     }
<a name="l01612"></a>01612 
<a name="l01613"></a>01613     <span class="keywordflow">return</span> -1;
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 
<a name="l01617"></a><a class="code" href="class_o_t___command.html#a60c269db4d1e59e3c20ae9672283d8ec">01617</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a60c269db4d1e59e3c20ae9672283d8ec">OT_Command::stat_partyagent</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAgentName, <span class="keyword">const</span> int32_t nIndex)
<a name="l01618"></a>01618 {
<a name="l01619"></a>01619     <span class="keywordtype">string</span> strDisplayIndex = <span class="stringliteral">&quot;*&quot;</span>;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nIndex))
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         strDisplayIndex = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex);
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <span class="keywordtype">string</span> strAgentID = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ebb6bfe35c38694c754c1a7d7219b31">OTAPI_Wrap::Party_GetAgentID</a>(strSmartContract, strPartyName, strAgentName);
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAgentID))
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;--------------------\n &quot;</span> + strDisplayIndex + <span class="stringliteral">&quot; : Agent &#39;&quot;</span> + strAgentName + <span class="stringliteral">&quot;&#39; (party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39;) has NymID: &quot;</span> + strAgentID + <span class="stringliteral">&quot; (&#39;&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strAgentID) + <span class="stringliteral">&quot;&#39;)&quot;</span>);
<a name="l01631"></a>01631     }
<a name="l01632"></a>01632     <span class="keywordflow">else</span>
<a name="l01633"></a>01633     {
<a name="l01634"></a>01634         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; &quot;</span> + strDisplayIndex + <span class="stringliteral">&quot; : Agent &#39;&quot;</span> + strAgentName + <span class="stringliteral">&quot;&#39; (party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39;) has no NymID assigned (yet.)&quot;</span>);
<a name="l01635"></a>01635     }
<a name="l01636"></a>01636 
<a name="l01637"></a>01637     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01638"></a>01638 }
<a name="l01639"></a>01639 
<a name="l01640"></a><a class="code" href="class_o_t___command.html#a186c8189b925587396f31f38e01c11e4">01640</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a186c8189b925587396f31f38e01c11e4">OT_Command::stat_partyagent_index</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> int32_t nCurrentAgent)
<a name="l01641"></a>01641 {
<a name="l01642"></a>01642     <span class="keywordtype">string</span> strAgentName = <a class="code" href="class_o_t_a_p_i___wrap.html#ad7be18e7c9dc07f22039ac3058e9f0d8">OTAPI_Wrap::Party_GetAgentNameByIndex</a>(strSmartContract, strPartyName, nCurrentAgent);
<a name="l01643"></a>01643 
<a name="l01644"></a>01644     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAgentName))
<a name="l01645"></a>01645     {
<a name="l01646"></a>01646         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Failed retrieving Agent Name from party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; at agent index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentAgent) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01647"></a>01647         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01648"></a>01648     }
<a name="l01649"></a>01649     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a60c269db4d1e59e3c20ae9672283d8ec">stat_partyagent</a>(strSmartContract, strPartyName, strAgentName, nCurrentAgent);
<a name="l01650"></a>01650 }
<a name="l01651"></a>01651 
<a name="l01652"></a><a class="code" href="class_o_t___command.html#a96f8849e97991f7796d10aa82bbd5b93">01652</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a96f8849e97991f7796d10aa82bbd5b93">OT_Command::stat_partyagents</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> int32_t nDepth)
<a name="l01653"></a>01653 {
<a name="l01654"></a>01654     int32_t nAgentCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a050046450f8b9f369ef195f515c5cb76">OTAPI_Wrap::Party_GetAgentCount</a>(strSmartContract, strPartyName);
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAgentCount) || (nAgentCount &lt; 0))
<a name="l01657"></a>01657     {
<a name="l01658"></a>01658         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; has bad value for number of authorized agents.\n&quot;</span>);
<a name="l01659"></a>01659         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01660"></a>01660     }
<a name="l01661"></a>01661 
<a name="l01662"></a>01662     <span class="keywordflow">if</span> (nDepth &gt; 0)
<a name="l01663"></a>01663     {
<a name="l01664"></a>01664         <span class="comment">// Iterate the agents for this party.</span>
<a name="l01665"></a>01665         <span class="comment">//</span>
<a name="l01666"></a>01666         <span class="keywordflow">for</span> (int32_t nCurrentAgent = 0; nCurrentAgent &lt; nAgentCount; ++nCurrentAgent)
<a name="l01667"></a>01667         {
<a name="l01668"></a>01668             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#a186c8189b925587396f31f38e01c11e4">stat_partyagent_index</a>(strSmartContract, strPartyName, nCurrentAgent)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l01669"></a>01669         }
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671     <span class="keywordflow">else</span>
<a name="l01672"></a>01672     {
<a name="l01673"></a>01673         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; has &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nAgentCount) + ((1 == nAgentCount) ? <span class="stringliteral">&quot; agent.&quot;</span> : <span class="stringliteral">&quot; agents.&quot;</span>));
<a name="l01674"></a>01674     }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01677"></a>01677 }
<a name="l01678"></a>01678 
<a name="l01679"></a>01679 
<a name="l01680"></a><a class="code" href="class_o_t___command.html#a9317f74b6571a4cbe704598d1009a82d">01680</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a9317f74b6571a4cbe704598d1009a82d">OT_Command::stat_partyaccount</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAcctName, <span class="keyword">const</span> int32_t nCurrentAccount)
<a name="l01681"></a>01681 {
<a name="l01682"></a>01682     <span class="keywordtype">string</span> strAcctAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#a202917b1d6ea264cd9f8f843067ac8ea">OTAPI_Wrap::Party_GetAcctAssetID</a>(strSmartContract, strPartyName, strAcctName);
<a name="l01683"></a>01683     <span class="keywordtype">string</span> strAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a99879b03606b33521bfad26d0f45b6de">OTAPI_Wrap::Party_GetAcctID</a>(strSmartContract, strPartyName, strAcctName);
<a name="l01684"></a>01684     <span class="keywordtype">string</span> strAcctAgentName = <a class="code" href="class_o_t_a_p_i___wrap.html#a303f5294e495f770f01d1e1befc1d416">OTAPI_Wrap::Party_GetAcctAgentName</a>(strSmartContract, strPartyName, strAcctName);
<a name="l01685"></a>01685 
<a name="l01686"></a>01686     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctAssetID))
<a name="l01687"></a>01687     {
<a name="l01688"></a>01688         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;-------------------\nAccount &#39;&quot;</span> + strAcctName + <span class="stringliteral">&quot;&#39; (index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentAccount) + <span class="stringliteral">&quot; on Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39;) has asset type: &quot;</span> + strAcctAssetID + <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAcctAssetID) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01689"></a>01689     }
<a name="l01690"></a>01690     <span class="comment">//  else</span>
<a name="l01691"></a>01691     <span class="comment">//  {</span>
<a name="l01692"></a>01692     <span class="comment">//      print(&quot;Account &#39;&quot;+strAcctName+&quot;&#39; (party &#39;&quot;+strPartyName+&quot;&#39;) has no asset type (yet.)&quot;)</span>
<a name="l01693"></a>01693     <span class="comment">//; }</span>
<a name="l01694"></a>01694 
<a name="l01695"></a>01695     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID))
<a name="l01696"></a>01696     {
<a name="l01697"></a>01697         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Account &#39;&quot;</span> + strAcctName + <span class="stringliteral">&quot;&#39; (party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39;) is confirmed as Account ID: &quot;</span> + strAcctID + <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a18999957d285b958c3f683d3460a0b3f">OTAPI_Wrap::GetAccountWallet_Name</a>(strAcctID) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01698"></a>01698     }
<a name="l01699"></a>01699     <span class="comment">//  else</span>
<a name="l01700"></a>01700     <span class="comment">//  {</span>
<a name="l01701"></a>01701     <span class="comment">//      print(&quot;Account &#39;&quot;+strAcctName+&quot;&#39; (party &#39;&quot;+strPartyName+&quot;&#39;) has no Account ID (yet.)&quot;)</span>
<a name="l01702"></a>01702     <span class="comment">//; }</span>
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctAgentName))
<a name="l01705"></a>01705     {
<a name="l01706"></a>01706         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Account &#39;&quot;</span> + strAcctName + <span class="stringliteral">&quot;&#39; (party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39;) is managed by agent: &quot;</span> + strAcctAgentName);
<a name="l01707"></a>01707     }
<a name="l01708"></a>01708     <span class="comment">//  else</span>
<a name="l01709"></a>01709     <span class="comment">//  {</span>
<a name="l01710"></a>01710     <span class="comment">//      print(&quot;Account &#39;&quot;+strAcctName+&quot;&#39; (party &#39;&quot;+strPartyName+&quot;&#39;) has no managing agent (yet.)&quot;)</span>
<a name="l01711"></a>01711     <span class="comment">//; }</span>
<a name="l01712"></a>01712     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01713"></a>01713 }
<a name="l01714"></a>01714 
<a name="l01715"></a><a class="code" href="class_o_t___command.html#a1b9ebac557a852ff433e8e9432672502">01715</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a1b9ebac557a852ff433e8e9432672502">OT_Command::stat_partyaccount_index</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> int32_t nCurrentAccount)
<a name="l01716"></a>01716 {
<a name="l01717"></a>01717     <span class="keywordtype">string</span> strAcctName = <a class="code" href="class_o_t_a_p_i___wrap.html#ad5fd7f35d5835ab95c7b57cf3bde8fec">OTAPI_Wrap::Party_GetAcctNameByIndex</a>(strSmartContract, strPartyName, nCurrentAccount);
<a name="l01718"></a>01718 
<a name="l01719"></a>01719     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctName))
<a name="l01720"></a>01720     {
<a name="l01721"></a>01721         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Failed retrieving Asset Account Name from party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; at account index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentAccount) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01722"></a>01722         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01723"></a>01723     }
<a name="l01724"></a>01724     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a9317f74b6571a4cbe704598d1009a82d">stat_partyaccount</a>(strSmartContract, strPartyName, strAcctName, nCurrentAccount);
<a name="l01725"></a>01725 }
<a name="l01726"></a>01726 
<a name="l01727"></a>01727 
<a name="l01728"></a><a class="code" href="class_o_t___command.html#a8b0e30bf85feef0ea824798b3272ed7d">01728</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a8b0e30bf85feef0ea824798b3272ed7d">OT_Command::stat_partyaccounts</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPartyName, <span class="keyword">const</span> int32_t nDepth)
<a name="l01729"></a>01729 {
<a name="l01730"></a>01730     int32_t nAccountCount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac096c54c24e4ed5945e30e69925baa48">OTAPI_Wrap::Party_GetAcctCount</a>(strSmartContract, strPartyName);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAccountCount) || (nAccountCount &lt; 0))
<a name="l01733"></a>01733     {
<a name="l01734"></a>01734         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; has bad value for number of asset accounts.\n&quot;</span>);
<a name="l01735"></a>01735         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01736"></a>01736     }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738     <span class="keywordflow">if</span> (nDepth &gt; 0)
<a name="l01739"></a>01739     {
<a name="l01740"></a>01740         <span class="comment">// Iterate the asset accounts for this party.</span>
<a name="l01741"></a>01741         <span class="comment">//</span>
<a name="l01742"></a>01742         <span class="keywordflow">for</span> (int32_t nCurrentAccount = 0; nCurrentAccount &lt; nAccountCount; ++nCurrentAccount)
<a name="l01743"></a>01743         {
<a name="l01744"></a>01744             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#a1b9ebac557a852ff433e8e9432672502">stat_partyaccount_index</a>(strSmartContract, strPartyName, nCurrentAccount)) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l01745"></a>01745         }
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747     <span class="keywordflow">else</span>
<a name="l01748"></a>01748     {
<a name="l01749"></a>01749         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; has &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nAccountCount) + ((1 == nAccountCount) ? <span class="stringliteral">&quot; asset account.&quot;</span> : <span class="stringliteral">&quot; asset accounts.&quot;</span>));
<a name="l01750"></a>01750     }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01753"></a>01753 }
<a name="l01754"></a>01754 
<a name="l01755"></a>01755 
<a name="l01756"></a><a class="code" href="class_o_t___command.html#a8b09fc4ebb3bdb0611455ace9b8367fb">01756</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a8b09fc4ebb3bdb0611455ace9b8367fb">OT_Command::show_unconfirmed_parties</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSmartContract, int32_t &amp; nPartyCount)
<a name="l01757"></a>01757 {
<a name="l01758"></a>01758     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nPartyCount) || (0 == nPartyCount))
<a name="l01759"></a>01759     {
<a name="l01760"></a>01760         nPartyCount = <a class="code" href="class_o_t_a_p_i___wrap.html#aa62f8e7fb497d9f084941d4ed243575a">OTAPI_Wrap::Smart_GetPartyCount</a>(strSmartContract);
<a name="l01761"></a>01761         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nPartyCount) || (nPartyCount &lt; 0))
<a name="l01762"></a>01762         {
<a name="l01763"></a>01763             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: There are apparently no PARTIES to this smart contract.\n&quot;</span>);
<a name="l01764"></a>01764             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01765"></a>01765         }
<a name="l01766"></a>01766     }
<a name="l01767"></a>01767 
<a name="l01768"></a>01768     <span class="comment">// See if the smart contract is already confirmed by all parties.</span>
<a name="l01769"></a>01769     <span class="comment">//</span>
<a name="l01770"></a>01770     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#aef6e165ada81ef09f673906744827ae8">OTAPI_Wrap::Smart_AreAllPartiesConfirmed</a>(strSmartContract))
<a name="l01771"></a>01771     {
<a name="l01772"></a>01772         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Looks like all the parties on this contract are already confirmed.\n(Perhaps you want to &#39;activate&#39; it instead.)\n&quot;</span>);
<a name="l01773"></a>01773         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776     int32_t nUnconfirmedPartyCount = 0;
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     <span class="keywordflow">for</span> (int32_t nCurrentParty = 0; nCurrentParty &lt; nPartyCount; ++nCurrentParty)
<a name="l01779"></a>01779     {
<a name="l01780"></a>01780         <span class="keywordtype">string</span> strPartyName = <a class="code" href="class_o_t_a_p_i___wrap.html#a09b5fb544967ba509a16aef8f53813b4">OTAPI_Wrap::Smart_GetPartyByIndex</a>(strSmartContract, nCurrentParty);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPartyName))
<a name="l01783"></a>01783         {
<a name="l01784"></a>01784             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Unable to retrieve smart contract party&#39;s name at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentParty) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01785"></a>01785             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01786"></a>01786         }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788         <span class="keywordtype">bool</span> bIsPartyConfirmed = <a class="code" href="class_o_t_a_p_i___wrap.html#ac2a8f07c16358cbf65af81350ca50780">OTAPI_Wrap::Smart_IsPartyConfirmed</a>(strSmartContract, strPartyName);
<a name="l01789"></a>01789         <span class="keywordflow">if</span> (!bIsPartyConfirmed)
<a name="l01790"></a>01790         {
<a name="l01791"></a>01791             <span class="keywordtype">string</span> strIndex = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentParty);
<a name="l01792"></a>01792             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strIndex + <span class="stringliteral">&quot; : Unconfirmed party: &quot;</span> + strPartyName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01793"></a>01793             ++nUnconfirmedPartyCount;
<a name="l01794"></a>01794         }
<a name="l01795"></a>01795     } <span class="comment">// for</span>
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="keywordflow">if</span> (nUnconfirmedPartyCount &lt;= 0)
<a name="l01798"></a>01798     {
<a name="l01799"></a>01799         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;SHOULD NEVER HAPPEN: OT_API_Smart_AreAllPartiesConfirmed was already verified as false, above.\nSo then why am I at the bottom of this loop and I haven&#39;t found any unconfirmed parties?\n&quot;</span>);
<a name="l01800"></a>01800         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01804"></a>01804 }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 
<a name="l01807"></a>01807 <span class="comment">// The merchant (sender of proposal / payee of proposal) proposes the payment plan</span>
<a name="l01808"></a>01808 <span class="comment">// to the customer (recipient of proposal / payer of proposal.) So this function is</span>
<a name="l01809"></a>01809 <span class="comment">// called by the merchant.</span>
<a name="l01810"></a>01810 <span class="comment">//</span>
<a name="l01811"></a><a class="code" href="class_o_t___command.html#ae0f38c4ed3d2d81ef724c34a2fc1b688">01811</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ae0f38c4ed3d2d81ef724c34a2fc1b688">OT_Command::details_propose_plan</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strHisNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strHisAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strDates, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strConsideration, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInitialPayment, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPaymentPlan, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strExpiry)
<a name="l01812"></a>01812 {
<a name="l01813"></a>01813     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strConsideration))
<a name="l01814"></a>01814     {
<a name="l01815"></a>01815         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, but you must describe the consideration to create a recurring payment plan.\n&quot;</span>);
<a name="l01816"></a>01816         <span class="keywordflow">return</span> -1;
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819     <span class="comment">// Make sure strMyNymID aka recipient of money (aka sender of payment plan instrument)</span>
<a name="l01820"></a>01820     <span class="comment">// has enough transaction numbers to propose the plan in the first place.</span>
<a name="l01821"></a>01821     <span class="comment">//</span>
<a name="l01822"></a>01822     <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(2, strServerID, strMyNymID)) <span class="comment">// strMyNymID is Merchant.</span>
<a name="l01823"></a>01823     {
<a name="l01824"></a>01824         <span class="keywordflow">return</span> -1;
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     <span class="comment">// OTAPI_Wrap::EasyProposePlan is a version of ProposePaymentPlan that compresses it into a</span>
<a name="l01828"></a>01828     <span class="comment">// fewer number of arguments. (Then it expands them and calls ProposePaymentPlan.)</span>
<a name="l01829"></a>01829     <span class="comment">// Basically this version has ALL the same parameters, but it stuffs two or three at a time into</span>
<a name="l01830"></a>01830     <span class="comment">// a single parameter, as a comma-separated list in string form.</span>
<a name="l01831"></a>01831     <span class="comment">// See details for each parameter, in the comment below.</span>
<a name="l01832"></a>01832     <span class="comment">//</span>
<a name="l01833"></a>01833     <span class="keywordtype">string</span> strPlan = <a class="code" href="class_o_t_a_p_i___wrap.html#a9ae198f2c506f2a01782cc5a6f8b6c52">OTAPI_Wrap::EasyProposePlan</a>(strServerID, strDates, strHisAcctID, strHisNymID, strConsideration, strMyAcctID, strMyNymID, strInitialPayment, strPaymentPlan, strExpiry);
<a name="l01834"></a>01834 
<a name="l01835"></a>01835     <span class="comment">// std::string EasyProposePlan(</span>
<a name="l01836"></a>01836     <span class="comment">//    const std::string &amp; SERVER_ID,</span>
<a name="l01837"></a>01837     <span class="comment">//    // ----------------------------------------</span>
<a name="l01838"></a>01838     <span class="comment">//    const std::string &amp; DATE_RANGE,           // &quot;from,to&quot;  Default &#39;from&#39; (0 or &quot;&quot;) == NOW,</span>
<a name="l01839"></a>01839     <span class="comment">//    // ---------------------------------------- // and default &#39;to&#39; (0 or &quot;&quot;) == no expiry / cancel anytime</span>
<a name="l01840"></a>01840     <span class="comment">//    const std::string &amp; SENDER_ACCT_ID,     // strHisAcctID. Mandatory parameters.</span>
<a name="l01841"></a>01841     <span class="comment">//    const std::string &amp; SENDER_USER_ID,     // strHisNymID. Both sender and recipient must sign before submitting.</span>
<a name="l01842"></a>01842     <span class="comment">//    // ----------------------------------------</span>
<a name="l01843"></a>01843     <span class="comment">//    const std::string &amp; PLAN_CONSIDERATION, // Like a memo.</span>
<a name="l01844"></a>01844     <span class="comment">//    // ----------------------------------------</span>
<a name="l01845"></a>01845     <span class="comment">//    const std::string &amp; RECIPIENT_ACCT_ID, // strMyAcctID. NOT optional.</span>
<a name="l01846"></a>01846     <span class="comment">//    const std::string &amp; RECIPIENT_USER_ID, // strMyNymID. Both sender and recipient must sign before submitting.</span>
<a name="l01847"></a>01847     <span class="comment">//    // -------------------------------</span>
<a name="l01848"></a>01848     <span class="comment">//    const std::string &amp; INITIAL_PAYMENT, // &quot;amount,delay&quot;  Default &#39;amount&#39; (0 or &quot;&quot;) == no initial payment.</span>
<a name="l01849"></a>01849     <span class="comment">//    // ------------------------------- // Default &#39;delay&#39; (0 or NULL) is seconds from creation date.</span>
<a name="l01850"></a>01850     <span class="comment">//    const std::string &amp; PAYMENT_PLAN,   // &quot;amount,delay,period&quot; &#39;amount&#39; is a recurring payment.</span>
<a name="l01851"></a>01851     <span class="comment">//    // -------------------------------  // &#39;delay&#39; and &#39;period&#39; cause 30 days if you pass 0 or &quot;&quot;.</span>
<a name="l01852"></a>01852     <span class="comment">//    const std::string &amp; PLAN_EXPIRY // &quot;length,number&quot; &#39;length&#39; is maximum lifetime in seconds.</span>
<a name="l01853"></a>01853     <span class="comment">//    );                              // &#39;number&#39; is maximum number of payments in seconds. 0 or &quot;&quot; is unlimited (for both.)</span>
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 
<a name="l01856"></a>01856     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPlan))
<a name="l01857"></a>01857     {
<a name="l01858"></a>01858         <span class="comment">// The &quot;propose&quot; step (performed by the merchant) includes the merchant&#39;s confirmation / signing.</span>
<a name="l01859"></a>01859         <span class="comment">// (So there&#39;s no need for the merchant to additionally &quot;confirm&quot; the plan before sending it -- he</span>
<a name="l01860"></a>01860         <span class="comment">// already has done that by this point, just as part of the proposal itself.)</span>
<a name="l01861"></a>01861 
<a name="l01862"></a>01862         <span class="comment">// Send the payment plan to the payer (the customer). If it fails, harvest the transaction numbers</span>
<a name="l01863"></a>01863         <span class="comment">// back from the payment plan. Return 1 if success.</span>
<a name="l01864"></a>01864 
<a name="l01865"></a>01865         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strMyNymID, strHisNymID, strPlan);
<a name="l01866"></a>01866         int32_t nMessageSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l01867"></a>01867 
<a name="l01868"></a>01868         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMessageSuccess) || (1 != nMessageSuccess))
<a name="l01869"></a>01869         {
<a name="l01870"></a>01870             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;For whatever reason, our attempt to send the payment plan on to the next user has failed.\n&quot;</span>);
<a name="l01871"></a>01871             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strPlan, strMyNymID,
<a name="l01872"></a>01872                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a payment plan, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and thus we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l01873"></a>01873             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_propose: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01874"></a>01874             <span class="keywordflow">return</span> -1;
<a name="l01875"></a>01875         }
<a name="l01876"></a>01876         <span class="comment">// else success</span>
<a name="l01877"></a>01877         <span class="keywordflow">return</span> nMessageSuccess;
<a name="l01878"></a>01878     }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880     <span class="keywordflow">return</span> -1;
<a name="l01881"></a>01881 }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883 
<a name="l01884"></a><a class="code" href="class_o_t___command.html#a8bc1b73e1aca695f7a21b621b26648fd">01884</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8bc1b73e1aca695f7a21b621b26648fd">OT_Command::main_propose_plan</a>() <span class="comment">// payment plan -- called by recipient. (Who generates the proposal.)</span>
<a name="l01885"></a>01885 {
<a name="l01886"></a>01886     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage: opentxs propose   (For a merchant to propose a payment plan to a customer.)\nMandatory: --server SERVER_ID --mynym PAYEE_NYM_ID --hisnym PAYER_NYM_ID\nMandatory: --myacct PAYEE_ACCT_ID --hisacct PAYER_NYM_ID\nAdditional arguments:\n Date Range: --args \&quot; date_range \\\&quot;from,to\\\&quot; \&quot;\nFROM should be in seconds from Jan 1970, and TO is added to that number.\nDefault FROM is the current time, and default TO is &#39;no expiry.&#39;\n&quot;</span>;
<a name="l01887"></a>01887     <span class="keywordtype">string</span> strUsage2 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Also: --args \&quot; consideration \\\&quot;like a memo\\\&quot; \&quot; \n&quot;</span>);
<a name="l01888"></a>01888     <span class="keywordtype">string</span> strUsage3 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage2, <span class="stringliteral">&quot;Also: --args \&quot; initial_payment \\\&quot;amount,delay\\\&quot; \&quot; \nDefault &#39;amount&#39; (0 or \&quot;\&quot;) == no initial payment. Default &#39;delay&#39; (0 or \&quot;\&quot;) is seconds from creation date.\n&quot;</span>);
<a name="l01889"></a>01889     <span class="keywordtype">string</span> strUsage4 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage3, <span class="stringliteral">&quot;Also: --args \&quot; payment_plan \\\&quot;amount,delay,period\\\&quot; \&quot; \n&#39;amount&#39; is a recurring payment. &#39;delay&#39; and &#39;period&#39; cause 30 days if you pass 0 or \&quot;\&quot;.\n&#39;delay&#39; and &#39;period&#39; are both measured in seconds. Period is time between\neach payment. Delay is time until first payment.\n&quot;</span>);
<a name="l01890"></a>01890     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage4, <span class="stringliteral">&quot;Also: --args \&quot; plan_expiry \\\&quot;length,number\\\&quot; \&quot; \n&#39;length&#39; is maximum lifetime in seconds. &#39;number&#39; is maximum number of payments. 0 or \&quot;\&quot; is unlimited (for both.)\n\n&quot;</span>);
<a name="l01891"></a>01891 
<a name="l01892"></a>01892     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l01893"></a>01893     <span class="comment">// **************************************************************</span>
<a name="l01894"></a>01894     <span class="comment">// recipient nym        // recipient acct        // sender nym             // sender acct</span>
<a name="l01895"></a>01895     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisAcct&quot;</span>))
<a name="l01896"></a>01896     {
<a name="l01897"></a>01897         <span class="keywordtype">string</span> strDates = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01898"></a>01898         <span class="keywordtype">string</span> strConsideration = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01899"></a>01899         <span class="keywordtype">string</span> strInitialPayment = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01900"></a>01900         <span class="keywordtype">string</span> strPaymentPlan = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01901"></a>01901         <span class="keywordtype">string</span> strExpiry = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l01904"></a>01904         {
<a name="l01905"></a>01905             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l01906"></a>01906             <span class="comment">//                                  const std::string str_key)</span>
<a name="l01907"></a>01907             <span class="comment">//</span>
<a name="l01908"></a>01908             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l01909"></a>01909             <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l01910"></a>01910             <span class="comment">//</span>
<a name="l01911"></a>01911             <span class="keywordtype">string</span> strTempDates = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;date_range&quot;</span>); <span class="comment">// &quot;from,to&quot;  Default &#39;from&#39; (0 or &quot;&quot;) == NOW (otherwise pass the time in seconds), and default &#39;to&#39; (0 or &quot;&quot;) == no expiry / cancel anytime (otherwise pass this time in seconds as well.)</span>
<a name="l01912"></a>01912             <span class="keywordtype">string</span> strTempConsideration = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;consideration&quot;</span>); <span class="comment">// Like a memo.</span>
<a name="l01913"></a>01913             <span class="keywordtype">string</span> strTempInitialPayment = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;initial_payment&quot;</span>); <span class="comment">// &quot;amount,delay&quot;  Default &#39;amount&#39; (0 or &quot;&quot;) == no initial payment. Default &#39;delay&#39; (0 or NULL) is seconds from creation date.</span>
<a name="l01914"></a>01914             <span class="keywordtype">string</span> strTempPaymentPlan = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;payment_plan&quot;</span>); <span class="comment">// &quot;amount,delay,period&quot; &#39;amount&#39; is a recurring payment. &#39;delay&#39; and &#39;period&#39; cause 30 days if you pass 0 or &quot;&quot;.</span>
<a name="l01915"></a>01915             <span class="keywordtype">string</span> strTempExpiry = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;plan_expiry&quot;</span>); <span class="comment">// &quot;length,number&quot; &#39;length&#39; is maximum lifetime in seconds. &#39;number&#39; is maximum number of payments. 0 or &quot;&quot; is unlimited (for both.)</span>
<a name="l01916"></a>01916 
<a name="l01917"></a>01917             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempDates)) { strDates = strTempDates; }
<a name="l01918"></a>01918             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempConsideration)) { strConsideration = strTempConsideration; }
<a name="l01919"></a>01919             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempInitialPayment)) { strInitialPayment = strTempInitialPayment; }
<a name="l01920"></a>01920             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempPaymentPlan)) { strPaymentPlan = strTempPaymentPlan; }
<a name="l01921"></a>01921             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempExpiry)) { strExpiry = strTempExpiry; }
<a name="l01922"></a>01922         }
<a name="l01923"></a>01923         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01924"></a>01924         <span class="comment">// ***************************************************************</span>
<a name="l01925"></a>01925 
<a name="l01926"></a>01926         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strConsideration))
<a name="l01927"></a>01927         {
<a name="l01928"></a>01928             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nDescribe the product or service being received in return for the\nrecurring payments, followed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l01929"></a>01929 
<a name="l01930"></a>01930             strConsideration = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l01931"></a>01931 
<a name="l01932"></a>01932             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strConsideration))
<a name="l01933"></a>01933             {
<a name="l01934"></a>01934                 <span class="keywordflow">return</span> -1;
<a name="l01935"></a>01935             }
<a name="l01936"></a>01936         }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938         <span class="comment">// ***************************************************************</span>
<a name="l01939"></a>01939         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;date_range (from,to): &quot;</span> + strDates + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01940"></a>01940         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;consideration: &quot;</span> + strConsideration + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01941"></a>01941         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;initial_payment (amount,delay): &quot;</span> + strInitialPayment + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01942"></a>01942         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;payment_plan (amount,delay,period): &quot;</span> + strPaymentPlan + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01943"></a>01943         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;plan_expiry (length,number): &quot;</span> + strExpiry + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l01944"></a>01944 
<a name="l01945"></a>01945         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ae0f38c4ed3d2d81ef724c34a2fc1b688">details_propose_plan</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>, strDates, strConsideration, strInitialPayment, strPaymentPlan, strExpiry);
<a name="l01946"></a>01946     }
<a name="l01947"></a>01947 
<a name="l01948"></a>01948     <span class="keywordflow">return</span> -1;
<a name="l01949"></a>01949 }
<a name="l01950"></a>01950 
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 <span class="comment">// NOTE: if nIndex is NOT -1, then it&#39;s in the payments inbox for Server and MyNym, and we</span>
<a name="l01953"></a>01953 <span class="comment">// need to go ahead and</span>
<a name="l01954"></a>01954 <span class="comment">// the serverID must be found on the instrument, or must be provided as Server, or we must ask</span>
<a name="l01955"></a>01955 <span class="comment">// the user to enter it.</span>
<a name="l01956"></a>01956 <span class="comment">//</span>
<a name="l01957"></a><a class="code" href="class_o_t___command.html#acae742af25d3c0010d922a43391f9ca9">01957</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acae742af25d3c0010d922a43391f9ca9">OT_Command::details_confirm_plan</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPlan, <span class="keyword">const</span> int32_t nIndex)
<a name="l01958"></a>01958 {
<a name="l01959"></a>01959     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;details_confirm_plan&quot;</span>;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961     <span class="comment">//    std::string ConfirmPaymentPlan(</span>
<a name="l01962"></a>01962     <span class="comment">//       const std::string &amp; SERVER_ID,</span>
<a name="l01963"></a>01963     <span class="comment">//       const std::string &amp; SENDER_USER_ID,</span>
<a name="l01964"></a>01964     <span class="comment">//       const std::string &amp; SENDER_ACCT_ID,</span>
<a name="l01965"></a>01965     <span class="comment">//       const std::string &amp; RECIPIENT_USER_ID,</span>
<a name="l01966"></a>01966     <span class="comment">//       const std::string &amp; PAYMENT_PLAN);</span>
<a name="l01967"></a>01967 
<a name="l01968"></a>01968     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strPlan);
<a name="l01969"></a>01969     <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strPlan);
<a name="l01970"></a>01970     <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae7c2873a9439b938209438311652007e">OTAPI_Wrap::Instrmnt_GetSenderAcctID</a>(strPlan);
<a name="l01971"></a>01971     <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strPlan);
<a name="l01972"></a>01972 
<a name="l01973"></a>01973     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientUserID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPlan))
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975         <span class="comment">//      OTAPI_Wrap::Output(0, &quot;Here&#39;s the payment plan, FYI:\n\n&quot; + strPlan + &quot;\n&quot;);</span>
<a name="l01976"></a>01976 
<a name="l01977"></a>01977         <span class="comment">// Make sure strSenderUserID aka sender of money (aka recipient of payment plan</span>
<a name="l01978"></a>01978         <span class="comment">// instrument in his inbox, which if confirmed will have him sending money...)</span>
<a name="l01979"></a>01979         <span class="comment">// has enough transaction numbers to confirm the plan.</span>
<a name="l01980"></a>01980         <span class="comment">//</span>
<a name="l01981"></a>01981         <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(2, strServerID, strSenderUserID)) <span class="comment">// strSenderUserID is Customer.</span>
<a name="l01982"></a>01982         {
<a name="l01983"></a>01983             <span class="keywordflow">return</span> -1;
<a name="l01984"></a>01984         }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986         <span class="keywordtype">string</span> strConfirmed = <a class="code" href="class_o_t_a_p_i___wrap.html#a82231566353d9aea063f6319631e0e65">OTAPI_Wrap::ConfirmPaymentPlan</a>(strServerID, strSenderUserID, strSenderAcctID, strRecipientUserID, strPlan);
<a name="l01987"></a>01987 
<a name="l01988"></a>01988         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strConfirmed))
<a name="l01989"></a>01989         {
<a name="l01990"></a>01990             <span class="comment">//          OTAPI_Wrap::Output(0, &quot;Here&#39;s the CONFIRMED payment plan, FYI:\n\n&quot; + strConfirmed + &quot;\n&quot;);</span>
<a name="l01991"></a>01991 
<a name="l01992"></a>01992             <span class="comment">// Below this point, inside this block, if we fail, then we need to harvest the transaction</span>
<a name="l01993"></a>01993             <span class="comment">// numbers back from the payment plan that we confirmed (strConfirmed.)</span>
<a name="l01994"></a>01994             <span class="comment">//</span>
<a name="l01995"></a>01995             <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a5ad9721334cad1756df51f351d204f94">MadeEasy::deposit_payment_plan</a>(strServerID, strSenderUserID, strConfirmed);
<a name="l01996"></a>01996             <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;deposit_payment_plan&quot;</span>;
<a name="l01997"></a>01997             <span class="comment">// ***************************************************************</span>
<a name="l01998"></a>01998             int32_t nMessageSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l01999"></a>01999 
<a name="l02000"></a>02000             <span class="comment">// These are cases where the transaction never even got to TRY to run, since the message itself</span>
<a name="l02001"></a>02001             <span class="comment">// failed inside the server before it even got that far.</span>
<a name="l02002"></a>02002             <span class="comment">//</span>
<a name="l02003"></a>02003             <span class="keywordflow">if</span> (-1 == nMessageSuccess)
<a name="l02004"></a>02004             {
<a name="l02005"></a>02005                 <span class="comment">// In this case, the server never even SAW the transaction, because its enveloping message already</span>
<a name="l02006"></a>02006                 <span class="comment">// failed before we even got that far. So we can harvest, as though it was never attempted...</span>
<a name="l02007"></a>02007                 <span class="comment">//</span>
<a name="l02008"></a>02008                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Message error: &quot;</span> + strAttempt + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l02009"></a>02009                 int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strConfirmed, strSenderUserID,
<a name="l02010"></a>02010                     <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02011"></a>02011                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02012"></a>02012                 <span class="keywordflow">return</span> -1;
<a name="l02013"></a>02013             }
<a name="l02014"></a>02014             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nMessageSuccess)
<a name="l02015"></a>02015             {
<a name="l02016"></a>02016                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server reply (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): Message failure.\n&quot;</span>);
<a name="l02017"></a>02017                 int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strConfirmed, strSenderUserID,
<a name="l02018"></a>02018                     <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02019"></a>02019                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02020"></a>02020                 <span class="keywordflow">return</span> 0;
<a name="l02021"></a>02021             }
<a name="l02022"></a>02022             <span class="comment">// (else 1: message was processed successfully -- though not necessarily the transaction inside it.)</span>
<a name="l02023"></a>02023 
<a name="l02024"></a>02024             <span class="comment">// BELOW THIS POINT, the transaction has definitely processed. It may have succeeded or failed,</span>
<a name="l02025"></a>02025             <span class="comment">// but either way, we don&#39;t need to harvest any numbers, since OT will internally handle those</span>
<a name="l02026"></a>02026             <span class="comment">// when it processes the server&#39;s reply to the transaction attempt.</span>
<a name="l02027"></a>02027             <span class="comment">//</span>
<a name="l02028"></a>02028             int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strSenderUserID, strSenderAcctID, strAttempt, strResponse);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030             <span class="keywordflow">if</span> (1 == nInterpretReply) <span class="comment">// Success.</span>
<a name="l02031"></a>02031             {
<a name="l02032"></a>02032                 <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l02033"></a>02033                 <span class="comment">// since they have probably changed from this operation.</span>
<a name="l02034"></a>02034                 <span class="comment">//</span>
<a name="l02035"></a>02035                 <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strSenderUserID, strSenderAcctID, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l02036"></a>02036 
<a name="l02037"></a>02037                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS activating payment plan!\n&quot;</span>);
<a name="l02038"></a>02038                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l02039"></a>02039             }
<a name="l02040"></a>02040             <span class="comment">//</span>
<a name="l02041"></a>02041             <span class="comment">// Return status to caller.</span>
<a name="l02042"></a>02042             <span class="comment">//</span>
<a name="l02043"></a>02043             <span class="keywordflow">return</span> nInterpretReply;
<a name="l02044"></a>02044         }
<a name="l02045"></a>02045     }
<a name="l02046"></a>02046     <span class="keywordflow">return</span> -1;
<a name="l02047"></a>02047 }
<a name="l02048"></a>02048 
<a name="l02049"></a>02049 
<a name="l02050"></a>02050 <span class="comment">// NOTE: if nIndex is -1, then it&#39;s assumed the instrument was PASTED in, and therefore</span>
<a name="l02051"></a>02051 <span class="comment">// the serverID must be found on the instrument, or must be provided as Server, or we must ask</span>
<a name="l02052"></a>02052 <span class="comment">// the user to enter it. Then the Nym [and potentially AcctID] must be ascertained by walking</span>
<a name="l02053"></a>02053 <span class="comment">// the user through the instrument, and by making him choose a Nym and Acct(s) for the party</span>
<a name="l02054"></a>02054 <span class="comment">// he&#39;s confirming as.</span>
<a name="l02055"></a>02055 <span class="comment">//</span>
<a name="l02056"></a>02056 <span class="comment">// But if an index is provided, then it&#39;s ASSUMED the index goes to the payments inbox, and</span>
<a name="l02057"></a>02057 <span class="comment">// that therefore Server and MyNym must have been provided at the command line already, or</span>
<a name="l02058"></a>02058 <span class="comment">// otherwise that index could not logically have been matched up to the proper box.</span>
<a name="l02059"></a>02059 <span class="comment">//</span>
<a name="l02060"></a>02060 <span class="comment">// If SOME parties have already confirmed the contract before you, then it SHOULD already have</span>
<a name="l02061"></a>02061 <span class="comment">// a serverID attached to it. If a Server is also provided at the command line, then the two must</span>
<a name="l02062"></a>02062 <span class="comment">// match, since the ID cannot be changed after that point.</span>
<a name="l02063"></a>02063 <span class="comment">//</span>
<a name="l02064"></a>02064 
<a name="l02065"></a>02065 
<a name="l02066"></a><a class="code" href="class_o_t___command.html#ac0785bc8264d1e134a8943bb2357f38d">02066</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac0785bc8264d1e134a8943bb2357f38d">OT_Command::details_confirm_smart_contract</a>(<span class="keywordtype">string</span> &amp; strSmartContract, <span class="keyword">const</span> int32_t nIndex)
<a name="l02067"></a>02067 {
<a name="l02068"></a>02068     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;details_confirm_smart_contract&quot;</span>;
<a name="l02069"></a>02069 
<a name="l02070"></a>02070     int32_t nPartyCount = <a class="code" href="class_o_t_a_p_i___wrap.html#aa62f8e7fb497d9f084941d4ed243575a">OTAPI_Wrap::Smart_GetPartyCount</a>(strSmartContract);
<a name="l02071"></a>02071 
<a name="l02072"></a>02072     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nPartyCount) || (nPartyCount &lt;= 0))
<a name="l02073"></a>02073     {
<a name="l02074"></a>02074         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed trying to confirm a smart contract: there are apparently no PARTIES to this contract!\n&quot;</span>);
<a name="l02075"></a>02075         <span class="keywordflow">return</span> -1;
<a name="l02076"></a>02076     }
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     <span class="comment">// We don&#39;t need MyAcct except when actually ACTIVATING the smart contract on the server.</span>
<a name="l02079"></a>02079     <span class="comment">// This variable might get set later to MyAcct, if it matches one of the accounts being</span>
<a name="l02080"></a>02080     <span class="comment">// confirmed. (Meaning if this variable is set by the time we reach the bottom, then we</span>
<a name="l02081"></a>02081     <span class="comment">// can use it for activation, if/when needed.)</span>
<a name="l02082"></a>02082     <span class="comment">//</span>
<a name="l02083"></a>02083     <span class="keywordtype">string</span> strMyAcctID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02084"></a>02084     <span class="keywordtype">string</span> strMyAcctAgentName = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02085"></a>02085 
<a name="l02086"></a>02086     <span class="keywordtype">string</span> strServerID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02087"></a>02087     <span class="keywordtype">string</span> strNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     map&lt;string, string&gt; map_ID; <span class="comment">// We&#39;ll store the account IDs here, for each PartyAcct</span>
<a name="l02090"></a>02090     map&lt;string, string&gt; map_agent; <span class="comment">// We&#39;ll store the agent names here, for each PartyAcct</span>
<a name="l02091"></a>02091 
<a name="l02092"></a>02092     <span class="comment">// By this point we know it&#39;s a smart contract, and there is at least</span>
<a name="l02093"></a>02093     <span class="comment">// one party that is still unconfirmed on this contract.</span>
<a name="l02094"></a>02094     <span class="comment">// Therefore let&#39;s loop through the parties and display the</span>
<a name="l02095"></a>02095     <span class="comment">// unconfirmed ones.</span>
<a name="l02096"></a>02096     <span class="comment">//</span>
<a name="l02097"></a>02097     <span class="keywordflow">if</span> (<a class="code" href="class_o_t___command.html#a8b09fc4ebb3bdb0611455ace9b8367fb">show_unconfirmed_parties</a>(strSmartContract, nPartyCount))
<a name="l02098"></a>02098     {
<a name="l02099"></a>02099 
<a name="l02100"></a>02100         <span class="comment">// By this point I know that nUnconfirmedPartyCount is larger than 0.</span>
<a name="l02101"></a>02101         <span class="comment">// Therefore we displayed the unconfirmed ones...</span>
<a name="l02102"></a>02102         <span class="comment">// Let&#39;s ask the user to choose one to confirm as....</span>
<a name="l02103"></a>02103         <span class="comment">//</span>
<a name="l02104"></a>02104         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nWhich party are you? Enter the number, from the list above: &quot;</span>);
<a name="l02105"></a>02105 
<a name="l02106"></a>02106         <span class="keywordtype">string</span> strPartyIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02107"></a>02107 
<a name="l02108"></a>02108         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPartyIndex))
<a name="l02109"></a>02109         {
<a name="l02110"></a>02110             int32_t nCurrentParty = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strPartyIndex);
<a name="l02111"></a>02111 
<a name="l02112"></a>02112             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCurrentParty) &amp;&amp; (nCurrentParty &gt;= 0) &amp;&amp; (nCurrentParty &lt; nPartyCount))
<a name="l02113"></a>02113             {
<a name="l02114"></a>02114                 <span class="keywordtype">string</span> strPartyName = <a class="code" href="class_o_t_a_p_i___wrap.html#a09b5fb544967ba509a16aef8f53813b4">OTAPI_Wrap::Smart_GetPartyByIndex</a>(strSmartContract, nCurrentParty);
<a name="l02115"></a>02115 
<a name="l02116"></a>02116                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPartyName))
<a name="l02117"></a>02117                 {
<a name="l02118"></a>02118                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Unable to retrieve smart contract party&#39;s name at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentParty) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02119"></a>02119                     <span class="keywordflow">return</span> -1;
<a name="l02120"></a>02120                 }
<a name="l02121"></a>02121 
<a name="l02122"></a>02122                 <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#ac2a8f07c16358cbf65af81350ca50780">OTAPI_Wrap::Smart_IsPartyConfirmed</a>(strSmartContract, strPartyName))
<a name="l02123"></a>02123                 {
<a name="l02124"></a>02124                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: the party at that index is _already_ confirmed.\n&quot;</span>);
<a name="l02125"></a>02125                     <span class="keywordflow">return</span> -1;
<a name="l02126"></a>02126                 }
<a name="l02127"></a>02127 
<a name="l02128"></a>02128                 <span class="comment">// At this point we know it&#39;s a valid index for an unconfirmed party.</span>
<a name="l02129"></a>02129                 <span class="comment">// And we know that strPartyName is the party&#39;s name.</span>
<a name="l02130"></a>02130                 <span class="comment">//</span>
<a name="l02131"></a>02131                 <span class="comment">// So how many accounts does strPartyName have? We must confirm those, too.</span>
<a name="l02132"></a>02132                 <span class="comment">//</span>
<a name="l02133"></a>02133                 int32_t nAccountCount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac096c54c24e4ed5945e30e69925baa48">OTAPI_Wrap::Party_GetAcctCount</a>(strSmartContract, strPartyName);
<a name="l02134"></a>02134 
<a name="l02135"></a>02135                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAccountCount) || (nAccountCount &lt; 0))
<a name="l02136"></a>02136                 {
<a name="l02137"></a>02137                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Party &#39;&quot;</span> + strPartyName + <span class="stringliteral">&quot;&#39; has a bad value for number of asset accounts.\n&quot;</span>);
<a name="l02138"></a>02138                     <span class="keywordflow">return</span> -1;
<a name="l02139"></a>02139                 }
<a name="l02140"></a>02140 
<a name="l02141"></a>02141                 <span class="comment">// Confirm the accounts.</span>
<a name="l02142"></a>02142                 <span class="comment">//</span>
<a name="l02143"></a>02143                 <span class="keywordflow">if</span> (nAccountCount &gt; 0)
<a name="l02144"></a>02144                 {
<a name="l02145"></a>02145                     <span class="comment">// In the loop, if we have to devise the serverID, we store it in this var so we don&#39;t devise twice.</span>
<a name="l02146"></a>02146                     <span class="keywordtype">string</span> strFoundServerID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02147"></a>02147                     <span class="keywordtype">string</span> strFoundMyNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02148"></a>02148                     int32_t nCurrentAcctCount = nAccountCount;
<a name="l02149"></a>02149 
<a name="l02150"></a>02150                     <span class="keywordflow">while</span> (nCurrentAcctCount &gt; 0)
<a name="l02151"></a>02151                     {
<a name="l02152"></a>02152                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02153"></a>02153                         <a class="code" href="class_o_t___command.html#a8b0e30bf85feef0ea824798b3272ed7d">stat_partyaccounts</a>(strSmartContract, strPartyName, 2); <span class="comment">//nDepth=2</span>
<a name="l02154"></a>02154 
<a name="l02155"></a>02155                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n There are &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCurrentAcctCount) + <span class="stringliteral">&quot; asset accounts remaining to be confirmed.\nEnter the index for an UNconfirmed account: &quot;</span>);
<a name="l02156"></a>02156 
<a name="l02157"></a>02157                         <span class="keywordtype">string</span> strAcctIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02158"></a>02158 
<a name="l02159"></a>02159                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctIndex))
<a name="l02160"></a>02160                         {
<a name="l02161"></a>02161                             <span class="keywordflow">return</span> -1;
<a name="l02162"></a>02162                         }
<a name="l02163"></a>02163 
<a name="l02164"></a>02164                         int32_t nAcctIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strAcctIndex);
<a name="l02165"></a>02165 
<a name="l02166"></a>02166                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAcctIndex) || (nAcctIndex &lt; 0))
<a name="l02167"></a>02167                         {
<a name="l02168"></a>02168                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Bad Index: &quot;</span> + strAcctIndex + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02169"></a>02169                             <span class="keywordflow">return</span> -1;
<a name="l02170"></a>02170                         }
<a name="l02171"></a>02171 
<a name="l02172"></a>02172                         <span class="keywordtype">string</span> strAcctName = <a class="code" href="class_o_t_a_p_i___wrap.html#ad5fd7f35d5835ab95c7b57cf3bde8fec">OTAPI_Wrap::Party_GetAcctNameByIndex</a>(strSmartContract, strPartyName, nAcctIndex);
<a name="l02173"></a>02173 
<a name="l02174"></a>02174                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctName))
<a name="l02175"></a>02175                         {
<a name="l02176"></a>02176                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Unable to retrieve account name at index &quot;</span> + strAcctIndex + <span class="stringliteral">&quot; for Party: &quot;</span> + strPartyName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02177"></a>02177                             <span class="keywordflow">return</span> -1;
<a name="l02178"></a>02178                         }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180                         <span class="keywordtype">bool</span> bAlreadyThere = <span class="keyword">false</span>;
<a name="l02181"></a>02181 
<a name="l02182"></a>02182                         <span class="keywordflow">for</span> (map&lt;string, string&gt;::iterator x = map_ID.begin(); x != map_ID.end(); x++)
<a name="l02183"></a>02183                         {
<a name="l02184"></a>02184                             <span class="keywordflow">if</span> (x-&gt;first == strAcctName) { bAlreadyThere = <span class="keyword">true</span>; }
<a name="l02185"></a>02185                         }
<a name="l02186"></a>02186 
<a name="l02187"></a>02187                         <span class="keywordtype">string</span> strAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a99879b03606b33521bfad26d0f45b6de">OTAPI_Wrap::Party_GetAcctID</a>(strSmartContract, strPartyName, strAcctName);
<a name="l02188"></a>02188 
<a name="l02189"></a>02189                         <span class="keywordflow">if</span> (bAlreadyThere || <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID))  <span class="comment">// This account is ALREADY confirmed! It has an account ID already.</span>
<a name="l02190"></a>02190                         {
<a name="l02191"></a>02191                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSorry, but the account at index &quot;</span> + strAcctIndex + <span class="stringliteral">&quot; is already confirmed with account ID: &quot;</span> + strAcctID + <span class="stringliteral">&quot; \nYou are just going to have to pick a different account.\n&quot;</span>);
<a name="l02192"></a>02192                         }
<a name="l02193"></a>02193                         <span class="keywordflow">else</span> <span class="comment">// The account is NOT already confirmed (so we can confirm it, once we select the Acct ID to use.)</span>
<a name="l02194"></a>02194                         {
<a name="l02195"></a>02195 
<a name="l02196"></a>02196                             <span class="keywordtype">string</span> strServerOnContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strSmartContract);
<a name="l02197"></a>02197                             <span class="keywordtype">bool</span> bServerOnContract = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerOnContract);
<a name="l02198"></a>02198 
<a name="l02199"></a>02199                             <span class="comment">// Now we need to ascertain the server and Nym ID...</span>
<a name="l02200"></a>02200 
<a name="l02201"></a>02201                             <span class="keywordflow">if</span> (-1 != nIndex) <span class="comment">// The instrument was selected from the payments inbox at a given index.</span>
<a name="l02202"></a>02202                             {
<a name="l02203"></a>02203                                 strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;  <span class="comment">// These match up to the payments inbox that was used.</span>
<a name="l02204"></a>02204                                 strNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l02205"></a>02205 
<a name="l02206"></a>02206                                 <span class="comment">// If there&#39;s a server listed on the contract (there may not be, if this is the FIRST</span>
<a name="l02207"></a>02207                                 <span class="comment">// confirmation) AND if that Server ID doesn&#39;t match the one passed in on the command line...</span>
<a name="l02208"></a>02208                                 <span class="comment">//</span>
<a name="l02209"></a>02209                                 <span class="keywordflow">if</span> (bServerOnContract &amp;&amp; (strServerID != strServerOnContract))
<a name="l02210"></a>02210                                 {
<a name="l02211"></a>02211                                     <span class="keywordtype">string</span> strServerName = <a class="code" href="class_o_t_a_p_i___wrap.html#a856f371dd21dba6d6777b6bd087b9518">OTAPI_Wrap::GetServer_Name</a>(strServerOnContract);
<a name="l02212"></a>02212                                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerName)) { strServerName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l02213"></a>02213                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The server ID on the smart contract, &quot;</span> + strServerOnContract + <span class="stringliteral">&quot; (&quot;</span> + strServerName + <span class="stringliteral">&quot;) doesn&#39;t match the server selected at the command line with the --server option.\n&quot;</span>);
<a name="l02214"></a>02214                                     <span class="keywordflow">return</span> -1;
<a name="l02215"></a>02215                                 }
<a name="l02216"></a>02216                             }
<a name="l02217"></a>02217                             <span class="keywordflow">else</span> <span class="comment">// the instrument was pasted in.</span>
<a name="l02218"></a>02218                             {
<a name="l02219"></a>02219                                 <span class="keywordflow">if</span> (bServerOnContract)
<a name="l02220"></a>02220                                 {
<a name="l02221"></a>02221                                     strServerID = strServerOnContract;
<a name="l02222"></a>02222                                 }
<a name="l02223"></a>02223                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>))
<a name="l02224"></a>02224                                 {
<a name="l02225"></a>02225                                     strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l02226"></a>02226                                 }
<a name="l02227"></a>02227                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strFoundServerID)) <span class="comment">// We might have already figured it out. (The block after this one should only happen once, if at all.)</span>
<a name="l02228"></a>02228                                 {
<a name="l02229"></a>02229                                     strServerID = strFoundServerID;
<a name="l02230"></a>02230                                 }
<a name="l02231"></a>02231                                 <span class="keywordflow">else</span> <span class="comment">// There&#39;s no server on the contract, AND there&#39;s no server chosen at the command line.</span>
<a name="l02232"></a>02232                                 {
<a name="l02233"></a>02233                                     int32_t nServerCount = <a class="code" href="class_o_t_a_p_i___wrap.html#ad3278dc766104d4acfc4c8fc3f3256e4">OTAPI_Wrap::GetServerCount</a>();
<a name="l02234"></a>02234 
<a name="l02235"></a>02235                                     <span class="keywordflow">if</span> (nServerCount &lt; 1)
<a name="l02236"></a>02236                                     {
<a name="l02237"></a>02237                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, there aren&#39;t any server contracts in this wallet. Try &#39;opentxs addserver&#39;\n&quot;</span>);
<a name="l02238"></a>02238                                         <span class="keywordflow">return</span> -1;
<a name="l02239"></a>02239                                     }
<a name="l02240"></a>02240 
<a name="l02241"></a>02241                                     <a class="code" href="class_o_t___command.html#a94032463c92b681159a5e539b615ac4d">OT_Command::main_stat_servers</a>();
<a name="l02242"></a>02242 
<a name="l02243"></a>02243                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Paste a server ID: &quot;</span>);
<a name="l02244"></a>02244 
<a name="l02245"></a>02245                                     <span class="keywordtype">string</span> strServerIDInput = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02246"></a>02246 
<a name="l02247"></a>02247                                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerIDInput))
<a name="l02248"></a>02248                                     {
<a name="l02249"></a>02249                                         <span class="keywordflow">return</span> -1;
<a name="l02250"></a>02250                                     }
<a name="l02251"></a>02251 
<a name="l02252"></a>02252                                     strServerID = strServerIDInput;
<a name="l02253"></a>02253                                     strFoundServerID = strServerIDInput; <span class="comment">// So we&#39;re not forced to select the server EVERY iteration...</span>
<a name="l02254"></a>02254                                 }
<a name="l02255"></a>02255 
<a name="l02256"></a>02256                                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>))
<a name="l02257"></a>02257                                 {
<a name="l02258"></a>02258                                     strNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l02259"></a>02259                                 }
<a name="l02260"></a>02260                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strFoundMyNymID))
<a name="l02261"></a>02261                                 {
<a name="l02262"></a>02262                                     strNymID = strFoundMyNymID;
<a name="l02263"></a>02263                                 }
<a name="l02264"></a>02264                                 <span class="keywordflow">else</span>
<a name="l02265"></a>02265                                 {
<a name="l02266"></a>02266                                     int32_t nNymCount = <a class="code" href="class_o_t_a_p_i___wrap.html#af604578f0d61acfade8c939f18a21dea">OTAPI_Wrap::GetNymCount</a>();
<a name="l02267"></a>02267 
<a name="l02268"></a>02268                                     <span class="keywordflow">if</span> (nNymCount &lt; 1)
<a name="l02269"></a>02269                                     {
<a name="l02270"></a>02270                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;There are apparently no Nyms in this wallet. Try &#39;opentxs newnym&#39;\n&quot;</span>);
<a name="l02271"></a>02271                                         <span class="keywordflow">return</span> -1;
<a name="l02272"></a>02272                                     }
<a name="l02273"></a>02273                                     <span class="keywordflow">while</span> (<span class="keyword">true</span>) <span class="comment">// Choose a Nym.</span>
<a name="l02274"></a>02274                                     {
<a name="l02275"></a>02275                                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l02276"></a>02276                                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** PSEUDONYMS (filtered by serverID: &quot;</span> + strServerID + <span class="stringliteral">&quot;): &quot;</span> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02277"></a>02277 
<a name="l02278"></a>02278                                         <span class="keywordtype">bool</span> bFoundANym = <span class="keyword">false</span>;
<a name="l02279"></a>02279 
<a name="l02280"></a>02280                                         <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nNymCount; ++i)
<a name="l02281"></a>02281                                         {
<a name="l02282"></a>02282                                             <span class="keywordtype">string</span> strIndex = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i);
<a name="l02283"></a>02283                                             <span class="keywordtype">string</span> strLoopNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#aeff3051da795051afa430c634514bf56">OTAPI_Wrap::GetNym_ID</a>(i);
<a name="l02284"></a>02284 
<a name="l02285"></a>02285                                             <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a73f78ec70cc379360856080be6093126">OTAPI_Wrap::IsNym_RegisteredAtServer</a>(strLoopNymID, strServerID))
<a name="l02286"></a>02286                                             {
<a name="l02287"></a>02287                                                 bFoundANym = <span class="keyword">true</span>;
<a name="l02288"></a>02288                                                 <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strLoopNymID);
<a name="l02289"></a>02289                                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strIndex + <span class="stringliteral">&quot;: &quot;</span> + strLoopNymID + <span class="stringliteral">&quot; ---  &quot;</span> + strName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02290"></a>02290                                             }
<a name="l02291"></a>02291                                         }
<a name="l02292"></a>02292 
<a name="l02293"></a>02293                                         <span class="keywordflow">if</span> (!bFoundANym)
<a name="l02294"></a>02294                                         {
<a name="l02295"></a>02295                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unfortunately, didn&#39;t find ANY Nyms registered at server: &quot;</span> + strServerID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02296"></a>02296                                             <span class="keywordflow">return</span> -1;
<a name="l02297"></a>02297                                         }
<a name="l02298"></a>02298 
<a name="l02299"></a>02299                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Select a Nym by index: &quot;</span>);
<a name="l02300"></a>02300 
<a name="l02301"></a>02301                                         <span class="keywordtype">string</span> strNymIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02302"></a>02302 
<a name="l02303"></a>02303                                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymIndex))
<a name="l02304"></a>02304                                         {
<a name="l02305"></a>02305                                             <span class="keywordflow">return</span> -1;
<a name="l02306"></a>02306                                         }
<a name="l02307"></a>02307 
<a name="l02308"></a>02308                                         int32_t nNymIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strNymIndex);
<a name="l02309"></a>02309                                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nNymIndex) || (nNymIndex &lt; 0))
<a name="l02310"></a>02310                                         {
<a name="l02311"></a>02311                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Bad index: &quot;</span> + strNymIndex + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02312"></a>02312                                             <span class="keywordflow">return</span> -1;
<a name="l02313"></a>02313                                         }
<a name="l02314"></a>02314 
<a name="l02315"></a>02315                                         <span class="keywordtype">string</span> strTempNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#aeff3051da795051afa430c634514bf56">OTAPI_Wrap::GetNym_ID</a>(nNymIndex);
<a name="l02316"></a>02316 
<a name="l02317"></a>02317                                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempNymID))
<a name="l02318"></a>02318                                         {
<a name="l02319"></a>02319                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error retrieving NymID from wallet at index: &quot;</span> + strNymIndex + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02320"></a>02320                                             <span class="keywordflow">return</span> -1;
<a name="l02321"></a>02321                                         }
<a name="l02322"></a>02322 
<a name="l02323"></a>02323                                         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a73f78ec70cc379360856080be6093126">OTAPI_Wrap::IsNym_RegisteredAtServer</a>(strTempNymID, strServerID))
<a name="l02324"></a>02324                                         {
<a name="l02325"></a>02325                                             strNymID = strTempNymID;
<a name="l02326"></a>02326                                             strFoundMyNymID = strTempNymID;
<a name="l02327"></a>02327                                             <span class="keywordflow">break</span>;
<a name="l02328"></a>02328                                         }
<a name="l02329"></a>02329                                         <span class="keywordflow">else</span>
<a name="l02330"></a>02330                                         {
<a name="l02331"></a>02331                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, that Nym isn&#39;t registered at server: &quot;</span> + strServerID + <span class="stringliteral">&quot;\nPlease choose another Nym\n&quot;</span>);
<a name="l02332"></a>02332                                         }
<a name="l02333"></a>02333                                     } <span class="comment">// while (selecting a Nym)</span>
<a name="l02334"></a>02334                                 } <span class="comment">// Determining NymID</span>
<a name="l02335"></a>02335                             } <span class="comment">// else instrument was pasted in.</span>
<a name="l02336"></a>02336 
<a name="l02337"></a>02337 
<a name="l02338"></a>02338                             <span class="comment">// By this point, we definitely have strServerID and strNymID</span>
<a name="l02339"></a>02339 
<a name="l02340"></a>02340                             <span class="comment">// Loop through all the accounts for that Server/Nym, display them, allow the user to</span>
<a name="l02341"></a>02341                             <span class="comment">// choose one and then store it in a list somewhere for the actual confirmation.</span>
<a name="l02342"></a>02342                             <span class="comment">// (Which we will do only after ALL accounts have been selected.) We will also make sure</span>
<a name="l02343"></a>02343                             <span class="comment">// to prevent from selecting an account that already appears on that list.</span>
<a name="l02344"></a>02344                             <span class="comment">//</span>
<a name="l02345"></a>02345                             <span class="comment">// Also, when we actually add an Acct ID to the list, we need to decrement nCurrentAcctCount,</span>
<a name="l02346"></a>02346                             <span class="comment">// so that we are finished once all the accounts from the smart contract template have had</span>
<a name="l02347"></a>02347                             <span class="comment">// actual acct IDs selected for each.</span>
<a name="l02348"></a>02348                             <span class="comment">//</span>
<a name="l02349"></a>02349                             <span class="keywordtype">string</span> strTemplateAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#a202917b1d6ea264cd9f8f843067ac8ea">OTAPI_Wrap::Party_GetAcctAssetID</a>(strSmartContract, strPartyName, strAcctName);
<a name="l02350"></a>02350                             <span class="keywordtype">bool</span> bFoundTemplateAssetID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTemplateAssetID);
<a name="l02351"></a>02351 
<a name="l02352"></a>02352                             <span class="keywordtype">bool</span> bFoundAccounts = <span class="keyword">false</span>;
<a name="l02353"></a>02353                             int32_t nCountAcctsWallet = <a class="code" href="class_o_t_a_p_i___wrap.html#afbe43c28c4617b76122db11a8134564f">OTAPI_Wrap::GetAccountCount</a>();
<a name="l02354"></a>02354 
<a name="l02355"></a>02355                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nAccounts by index (filtered by serverID and nymID):\n\n&quot;</span>);
<a name="l02356"></a>02356 
<a name="l02357"></a>02357                             <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCountAcctsWallet; ++i)
<a name="l02358"></a>02358                             {
<a name="l02359"></a>02359                                 <span class="keywordtype">string</span> strWalletAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae265c713020535f996c26367f8eb6044">OTAPI_Wrap::GetAccountWallet_ID</a>(i);
<a name="l02360"></a>02360 
<a name="l02361"></a>02361                                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strWalletAcctID))
<a name="l02362"></a>02362                                 {
<a name="l02363"></a>02363                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error reading account ID based on index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02364"></a>02364                                     <span class="keywordflow">return</span> -1;
<a name="l02365"></a>02365                                 }
<a name="l02366"></a>02366 
<a name="l02367"></a>02367                                 <span class="keywordtype">string</span> strAcctServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strWalletAcctID);
<a name="l02368"></a>02368                                 <span class="keywordtype">string</span> strAcctNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strWalletAcctID);
<a name="l02369"></a>02369                                 <span class="keywordtype">string</span> strAcctAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strWalletAcctID);
<a name="l02370"></a>02370 
<a name="l02371"></a>02371                                 <span class="keywordtype">bool</span> bAlreadyOnTheMap = <span class="keyword">false</span>;
<a name="l02372"></a>02372 
<a name="l02373"></a>02373 
<a name="l02374"></a>02374                                 <span class="keywordflow">for</span> (map&lt;string, string&gt;::iterator x = map_ID.begin(); x != map_ID.end(); x++)
<a name="l02375"></a>02375                                 {
<a name="l02376"></a>02376                                     <span class="keywordflow">if</span> (x-&gt;second == strWalletAcctID) { bAlreadyOnTheMap = <span class="keyword">true</span>; }
<a name="l02377"></a>02377                                 }
<a name="l02378"></a>02378 
<a name="l02379"></a>02379                                 <span class="keywordflow">if</span> ((strServerID == strAcctServerID) &amp;&amp; (strNymID == strAcctNymID))
<a name="l02380"></a>02380                                 {
<a name="l02381"></a>02381                                     <span class="comment">// If the smart contract doesn&#39;t specify the asset type ID of the account, or if</span>
<a name="l02382"></a>02382                                     <span class="comment">// it DOES specify, AND they match, then it&#39;s a viable choice. Display it.</span>
<a name="l02383"></a>02383                                     <span class="comment">//</span>
<a name="l02384"></a>02384                                     <span class="keywordflow">if</span> (!bFoundTemplateAssetID || (bFoundTemplateAssetID &amp;&amp; (strTemplateAssetID == strAcctAssetID)))
<a name="l02385"></a>02385                                     {
<a name="l02386"></a>02386 
<a name="l02387"></a>02387                                         <span class="keywordflow">if</span> (!bAlreadyOnTheMap)  <span class="comment">// DO NOT display any accounts that have already been selected! (Search the temp map where we&#39;ve been stashing them.)</span>
<a name="l02388"></a>02388                                         {
<a name="l02389"></a>02389                                             bFoundAccounts = <span class="keyword">true</span>;
<a name="l02390"></a>02390                                             <span class="keywordtype">string</span> strAccountName = <a class="code" href="class_o_t_a_p_i___wrap.html#a18999957d285b958c3f683d3460a0b3f">OTAPI_Wrap::GetAccountWallet_Name</a>(strWalletAcctID);
<a name="l02391"></a>02391                                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAccountName)) { strAccountName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l02392"></a>02392                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i) + <span class="stringliteral">&quot; : &quot;</span> + strWalletAcctID + <span class="stringliteral">&quot; (&quot;</span> + strAccountName + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l02393"></a>02393                                         }
<a name="l02394"></a>02394                                     }
<a name="l02395"></a>02395                                 }
<a name="l02396"></a>02396                             } <span class="comment">// for</span>
<a name="l02397"></a>02397 
<a name="l02398"></a>02398                             <span class="keywordflow">if</span> (!bFoundAccounts)
<a name="l02399"></a>02399                             {
<a name="l02400"></a>02400                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unfortunately, looks like there are no accounts matching the specified Nym (&quot;</span> + strNymID + <span class="stringliteral">&quot;) and Server (&quot;</span> + strServerID + <span class="stringliteral">&quot;)\nTry:  opentxs newacct --mynym &quot;</span> + strNymID + <span class="stringliteral">&quot; --server &quot;</span> + strServerID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l02401"></a>02401                                 <span class="keywordflow">return</span> -1;
<a name="l02402"></a>02402                             }
<a name="l02403"></a>02403 
<a name="l02404"></a>02404                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nChoose an account by index (for &#39;&quot;</span> + strAcctName + <span class="stringliteral">&quot;&#39;): &quot;</span>);
<a name="l02405"></a>02405 
<a name="l02406"></a>02406                             <span class="keywordtype">string</span> strSelectedAcctIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02407"></a>02407 
<a name="l02408"></a>02408                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSelectedAcctIndex))
<a name="l02409"></a>02409                             {
<a name="l02410"></a>02410                                 <span class="keywordflow">return</span> -1;
<a name="l02411"></a>02411                             }
<a name="l02412"></a>02412 
<a name="l02413"></a>02413                             int32_t nSelectedAcctIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strSelectedAcctIndex);
<a name="l02414"></a>02414 
<a name="l02415"></a>02415                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSelectedAcctIndex) || (nSelectedAcctIndex &lt; 0) || (nSelectedAcctIndex &gt;= nCountAcctsWallet))
<a name="l02416"></a>02416                             {
<a name="l02417"></a>02417                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Bad index: &quot;</span> + strSelectedAcctIndex + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02418"></a>02418                                 <span class="keywordflow">return</span> -1;
<a name="l02419"></a>02419                             }
<a name="l02420"></a>02420 
<a name="l02421"></a>02421                             <span class="keywordtype">string</span> strWalletAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae265c713020535f996c26367f8eb6044">OTAPI_Wrap::GetAccountWallet_ID</a>(nSelectedAcctIndex);
<a name="l02422"></a>02422 
<a name="l02423"></a>02423                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strWalletAcctID))
<a name="l02424"></a>02424                             {
<a name="l02425"></a>02425                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error reading account ID based on index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nSelectedAcctIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02426"></a>02426                                 <span class="keywordflow">return</span> -1;
<a name="l02427"></a>02427                             }
<a name="l02428"></a>02428 
<a name="l02429"></a>02429                             <span class="keywordtype">string</span> strAcctServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strWalletAcctID);
<a name="l02430"></a>02430                             <span class="keywordtype">string</span> strAcctNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strWalletAcctID);
<a name="l02431"></a>02431                             <span class="keywordtype">string</span> strAcctAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strWalletAcctID);
<a name="l02432"></a>02432 
<a name="l02433"></a>02433                             <span class="keywordflow">if</span> ((strServerID == strAcctServerID) &amp;&amp; (strNymID == strAcctNymID))
<a name="l02434"></a>02434                             {
<a name="l02435"></a>02435                                 <span class="comment">// If the smart contract doesn&#39;t specify the asset type ID of the account, or if</span>
<a name="l02436"></a>02436                                 <span class="comment">// it DOES specify, AND they match, then it&#39;s a viable choice. Allow it.</span>
<a name="l02437"></a>02437                                 <span class="comment">//</span>
<a name="l02438"></a>02438                                 <span class="keywordflow">if</span> (!bFoundTemplateAssetID || (bFoundTemplateAssetID &amp;&amp; (strTemplateAssetID == strAcctAssetID)))
<a name="l02439"></a>02439                                 {
<a name="l02440"></a>02440 
<a name="l02441"></a>02441                                     <span class="keywordtype">bool</span> bAlreadyOnIt = <span class="keyword">false</span>;
<a name="l02442"></a>02442 
<a name="l02443"></a>02443                                     <span class="keywordflow">for</span> (map&lt;string, string&gt;::iterator x = map_ID.begin(); x != map_ID.end(); x++)
<a name="l02444"></a>02444                                     {
<a name="l02445"></a>02445                                         <span class="keywordflow">if</span> (x-&gt;second == strWalletAcctID) { bAlreadyOnIt = <span class="keyword">true</span>; }
<a name="l02446"></a>02446                                     }
<a name="l02447"></a>02447 
<a name="l02448"></a>02448                                     <span class="keywordflow">if</span> (bAlreadyOnIt)  <span class="comment">// make sure it&#39;s not already on the map of selected accounts.</span>
<a name="l02449"></a>02449                                     {
<a name="l02450"></a>02450                                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Sorry, you already selected this account. Choose another.\n&quot;</span>);
<a name="l02451"></a>02451                                     }
<a name="l02452"></a>02452                                     <span class="keywordflow">else</span>
<a name="l02453"></a>02453                                     {
<a name="l02454"></a>02454                                         <span class="comment">// strWalletAcctID has been selected for strPartyName&#39;s account, strAcctName.</span>
<a name="l02455"></a>02455                                         <span class="comment">// Add these to a map or whatever, to save them until this loop is complete.</span>
<a name="l02456"></a>02456                                         <span class="comment">//</span>
<a name="l02457"></a>02457 
<a name="l02458"></a>02458                                         <span class="keywordtype">string</span> strAgentName = <a class="code" href="class_o_t_a_p_i___wrap.html#a303f5294e495f770f01d1e1befc1d416">OTAPI_Wrap::Party_GetAcctAgentName</a>(strSmartContract, strPartyName, strAcctName);
<a name="l02459"></a>02459 
<a name="l02460"></a>02460                                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAgentName))
<a name="l02461"></a>02461                                         {
<a name="l02462"></a>02462                                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02463"></a>02463 
<a name="l02464"></a>02464                                             <span class="keywordflow">if</span> (<a class="code" href="class_o_t___command.html#a96f8849e97991f7796d10aa82bbd5b93">stat_partyagents</a>(strSmartContract, strPartyName, 3))
<a name="l02465"></a>02465                                             {
<a name="l02466"></a>02466                                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n (This choice is arbitrary, but you must pick one.)\nEnter the index for an agent, to have authority over that account: &quot;</span>);
<a name="l02467"></a>02467 
<a name="l02468"></a>02468                                                 <span class="keywordtype">string</span> strAgentIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02469"></a>02469 
<a name="l02470"></a>02470                                                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAgentIndex))
<a name="l02471"></a>02471                                                 {
<a name="l02472"></a>02472                                                     <span class="keywordflow">return</span> -1;
<a name="l02473"></a>02473                                                 }
<a name="l02474"></a>02474 
<a name="l02475"></a>02475                                                 int32_t nAgentIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strAgentIndex);
<a name="l02476"></a>02476 
<a name="l02477"></a>02477                                                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAgentIndex) || (nAgentIndex &lt; 0))
<a name="l02478"></a>02478                                                 {
<a name="l02479"></a>02479                                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Bad Index: &quot;</span> + strAgentIndex + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02480"></a>02480                                                     <span class="keywordflow">return</span> -1;
<a name="l02481"></a>02481                                                 }
<a name="l02482"></a>02482 
<a name="l02483"></a>02483                                                 strAgentName = <a class="code" href="class_o_t_a_p_i___wrap.html#ad7be18e7c9dc07f22039ac3058e9f0d8">OTAPI_Wrap::Party_GetAgentNameByIndex</a>(strSmartContract, strPartyName, nAgentIndex);
<a name="l02484"></a>02484 
<a name="l02485"></a>02485                                                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAgentName))
<a name="l02486"></a>02486                                                 {
<a name="l02487"></a>02487                                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Unable to retrieve agent name at index &quot;</span> + strAgentIndex + <span class="stringliteral">&quot; for Party: &quot;</span> + strPartyName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02488"></a>02488                                                     <span class="keywordflow">return</span> -1;
<a name="l02489"></a>02489                                                 }
<a name="l02490"></a>02490 
<a name="l02491"></a>02491                                             }
<a name="l02492"></a>02492                                             <span class="keywordflow">else</span>
<a name="l02493"></a>02493                                             {
<a name="l02494"></a>02494                                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed finding the agent&#39;s name for party: &quot;</span> + strPartyName + <span class="stringliteral">&quot; Account: &quot;</span> + strAcctName + <span class="stringliteral">&quot; \n And then failed finding any agents on this smart contract at ALL.\n&quot;</span>);
<a name="l02495"></a>02495                                                 <span class="keywordflow">return</span> -1;
<a name="l02496"></a>02496                                             }
<a name="l02497"></a>02497                                         }
<a name="l02498"></a>02498 
<a name="l02499"></a>02499                                         map_ID[strAcctName] = strWalletAcctID;
<a name="l02500"></a>02500                                         map_agent[strAcctName] = strAgentName;
<a name="l02501"></a>02501 
<a name="l02502"></a>02502                                         nCurrentAcctCount -= 1;
<a name="l02503"></a>02503 
<a name="l02504"></a>02504                                     }
<a name="l02505"></a>02505                                 }
<a name="l02506"></a>02506                             }
<a name="l02507"></a>02507                         } <span class="comment">// else the account is NOT already confirmed (so we can confirm it.)</span>
<a name="l02508"></a>02508                     } <span class="comment">// while (nCurrentAcctCount &gt; 0)</span>
<a name="l02509"></a>02509 
<a name="l02510"></a>02510 
<a name="l02511"></a>02511                     <span class="keywordflow">for</span> (map&lt;string, string&gt;::iterator x = map_ID.begin(); x != map_ID.end(); x++)
<a name="l02512"></a>02512                     {
<a name="l02513"></a>02513                         int32_t numCountNeeded = <a class="code" href="class_o_t_a_p_i___wrap.html#ad2c24c4ea678cc6c08c690a422fdda2e">OTAPI_Wrap::SmartContract_CountNumsNeeded</a>(strSmartContract, map_agent[x-&gt;first]) + 1;
<a name="l02514"></a>02514 
<a name="l02515"></a>02515                         <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(numCountNeeded, strServerID, strNymID)) <span class="comment">// Someday there might be a different NymID based on which agent it is...</span>
<a name="l02516"></a>02516                         {
<a name="l02517"></a>02517                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n** Sorry -- Nym (&quot;</span> + strNymID + <span class="stringliteral">&quot;) doesn&#39;t have enough transaction numbers to confirm this smart contract. Come back when you have more.\n&quot;</span>);
<a name="l02518"></a>02518                             <span class="keywordflow">return</span> -1;
<a name="l02519"></a>02519                         }
<a name="l02520"></a>02520                     }
<a name="l02521"></a>02521 
<a name="l02522"></a>02522                     <span class="comment">// CONFIRM THE ACCOUNTS HERE</span>
<a name="l02523"></a>02523                     <span class="comment">//</span>
<a name="l02524"></a>02524                     <span class="comment">// By this point we KNOW we have enough transaction numbers</span>
<a name="l02525"></a>02525                     <span class="comment">//</span>
<a name="l02526"></a>02526                     <span class="comment">// Note: Any failure below this point needs to harvest back ALL transaction numbers.</span>
<a name="l02527"></a>02527                     <span class="comment">// Because we haven&#39;t even TRIED to activate it, therefore ALL numbers on the contract</span>
<a name="l02528"></a>02528                     <span class="comment">// are still good (even the opening number.)</span>
<a name="l02529"></a>02529                     <span class="comment">//</span>
<a name="l02530"></a>02530                     <span class="comment">// Whereas after a failed activation, we&#39;d need to harvest only the closing numbers, and</span>
<a name="l02531"></a>02531                     <span class="comment">// not the opening numbers. But in here, this is confirmation, not activation.</span>
<a name="l02532"></a>02532                     <span class="comment">//</span>
<a name="l02533"></a>02533                     <span class="keywordflow">for</span> (map&lt;string, string&gt;::iterator x = map_ID.begin(); x != map_ID.end(); x++)
<a name="l02534"></a>02534                     {
<a name="l02535"></a>02535                         <span class="comment">// Here we check to see if MyAcct exists -- if so we compare it to the current acctID</span>
<a name="l02536"></a>02536                         <span class="comment">// and if they match, we set strMyAcctID. Later on, if/when activating, we can just use</span>
<a name="l02537"></a>02537                         <span class="comment">// strMyAcctID to activate. (Otherwise we will have to pick one from the confirmed accounts.)</span>
<a name="l02538"></a>02538                         <span class="comment">//</span>
<a name="l02539"></a>02539                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> == x-&gt;second))
<a name="l02540"></a>02540                         {
<a name="l02541"></a>02541                             strMyAcctID = <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>; <span class="comment">// Now we can use it later, for activation.</span>
<a name="l02542"></a>02542                             strMyAcctAgentName = map_agent[x-&gt;first];
<a name="l02543"></a>02543                         }
<a name="l02544"></a>02544 
<a name="l02545"></a>02545                         <span class="comment">// CONFIRM A THEORETICAL ACCT BY GIVING IT A REAL ACCT ID.</span>
<a name="l02546"></a>02546                         <span class="keywordtype">string</span> strTempSmart = <a class="code" href="class_o_t_a_p_i___wrap.html#af088b715571f1eeb08a3738056c508b5">OTAPI_Wrap::SmartContract_ConfirmAccount</a>(strSmartContract, strNymID, strPartyName,
<a name="l02547"></a>02547 
<a name="l02548"></a>02548                             x-&gt;first,             <span class="comment">// Acct name.</span>
<a name="l02549"></a>02549                             map_agent[x-&gt;first], <span class="comment">// The agent name for this asset account.</span>
<a name="l02550"></a>02550                             x-&gt;second);           <span class="comment">// AcctID for the asset account. (For acct_name).</span>
<a name="l02551"></a>02551                         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempSmart))
<a name="l02552"></a>02552                         {
<a name="l02553"></a>02553                             strSmartContract = strTempSmart;
<a name="l02554"></a>02554                         }
<a name="l02555"></a>02555                         <span class="keywordflow">else</span>
<a name="l02556"></a>02556                         {
<a name="l02557"></a>02557                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure while calling OT_API_SmartContract_ConfirmAccount. Acct Name: &quot;</span> + x-&gt;first + <span class="stringliteral">&quot;  Agent Name: &quot;</span> + map_agent[x-&gt;first] + <span class="stringliteral">&quot;  Acct ID: &quot;</span> + x-&gt;second + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l02558"></a>02558                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02559"></a>02559                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02560"></a>02560                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02561"></a>02561                             <span class="keywordflow">return</span> -1;
<a name="l02562"></a>02562                         }
<a name="l02563"></a>02563                     }
<a name="l02564"></a>02564 
<a name="l02565"></a>02565                 } <span class="comment">// if (nCurrentAcctCount &gt; 0)</span>
<a name="l02566"></a>02566 
<a name="l02567"></a>02567                 <span class="comment">// CONFIRM THE NYM HERE.</span>
<a name="l02568"></a>02568                 <span class="comment">//</span>
<a name="l02569"></a>02569                 <span class="comment">// NOTE: confirming the Party will drop a copy into the outpayments box.</span>
<a name="l02570"></a>02570                 <span class="comment">// After that, if you are not the last party, you will send it on to</span>
<a name="l02571"></a>02571                 <span class="comment">// the next party. This will also drop it into the outpayments box, but</span>
<a name="l02572"></a>02572                 <span class="comment">// when that happens, it will automatically first remove the prior</span>
<a name="l02573"></a>02573                 <span class="comment">// one that had been dropped. This way there is only one copy in</span>
<a name="l02574"></a>02574                 <span class="comment">// the outbox, not two.</span>
<a name="l02575"></a>02575                 <span class="comment">//</span>
<a name="l02576"></a>02576                 <span class="comment">// If you ARE the last party, then we will activate it here, and</span>
<a name="l02577"></a>02577                 <span class="comment">// when the server reply is received, it will be removed from the</span>
<a name="l02578"></a>02578                 <span class="comment">// outbox and moved to the record box.</span>
<a name="l02579"></a>02579                 <span class="comment">//</span>
<a name="l02580"></a>02580                 <span class="comment">// Also, whether it succeeds or fails activation, either way, a notice</span>
<a name="l02581"></a>02581                 <span class="comment">// will be dropped to all the parties, informing them of this fact.</span>
<a name="l02582"></a>02582                 <span class="comment">// The activating party will ignore this, since he already processes</span>
<a name="l02583"></a>02583                 <span class="comment">// the server reply directly when he receives it. (And there&#39;s a copy of</span>
<a name="l02584"></a>02584                 <span class="comment">// that in his nymbox to make SURE he receives it, so he DEFINITELY</span>
<a name="l02585"></a>02585                 <span class="comment">// received it already.)</span>
<a name="l02586"></a>02586                 <span class="comment">// But each of the other parties will then move the notice from their</span>
<a name="l02587"></a>02587                 <span class="comment">// outbox to their record box. (And harvest the transaction numbers</span>
<a name="l02588"></a>02588                 <span class="comment">// accordingly.)</span>
<a name="l02589"></a>02589                 <span class="comment">// A party can &quot;reject&quot; a smart contract by activating it without signing</span>
<a name="l02590"></a>02590                 <span class="comment">// it. That way it will fail activation, and all the other parties will get</span>
<a name="l02591"></a>02591                 <span class="comment">// the failure notice, and harvest their numbers back as appropriate. But if</span>
<a name="l02592"></a>02592                 <span class="comment">// he is &quot;rude&quot; and simply discards the contract WITHOUT rejecting it, then</span>
<a name="l02593"></a>02593                 <span class="comment">// they will never get the failure notice. However, they will also never</span>
<a name="l02594"></a>02594                 <span class="comment">// get the activation notice, since it was never activated in that case, and</span>
<a name="l02595"></a>02595                 <span class="comment">// thus they will be safe to harvest their numbers back when it expires.</span>
<a name="l02596"></a>02596                 <span class="comment">// (A well-designed wallet will do this automatically.)</span>
<a name="l02597"></a>02597                 <span class="comment">//</span>
<a name="l02598"></a>02598 
<a name="l02599"></a>02599                 <span class="keywordtype">string</span> strTempSmart = <a class="code" href="class_o_t_a_p_i___wrap.html#a63217269ff8c1d85265126b995de81ca">OTAPI_Wrap::SmartContract_ConfirmParty</a>(strSmartContract, strPartyName, strNymID);
<a name="l02600"></a>02600 
<a name="l02601"></a>02601                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempSmart))
<a name="l02602"></a>02602                 {
<a name="l02603"></a>02603                     strSmartContract = strTempSmart;
<a name="l02604"></a>02604                 }
<a name="l02605"></a>02605                 <span class="keywordflow">else</span>
<a name="l02606"></a>02606                 {
<a name="l02607"></a>02607                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure while calling OT_API_SmartContract_ConfirmParty. Party Name: &quot;</span> + strPartyName + <span class="stringliteral">&quot;  NymID: &quot;</span> + strNymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02608"></a>02608                     int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02609"></a>02609                         <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02610"></a>02610                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02611"></a>02611                     <span class="keywordflow">return</span> -1;
<a name="l02612"></a>02612                 }
<a name="l02613"></a>02613 
<a name="l02614"></a>02614                 <span class="comment">// If you are the last party to sign, then ACTIVATE THE SMART CONTRACT.</span>
<a name="l02615"></a>02615 
<a name="l02616"></a>02616                 <span class="comment">// NOTE: No matter which party you are (perhaps you are the middle one), when you confirm</span>
<a name="l02617"></a>02617                 <span class="comment">// the contract, you will send it on to the NEXT UNCONFIRMED ONE. This means you don&#39;t know</span>
<a name="l02618"></a>02618                 <span class="comment">// which party it will be, since all the unconfirmed parties have no NymID (yet.) Rather,</span>
<a name="l02619"></a>02619                 <span class="comment">// it&#39;s YOUR problem to provide the NymID you&#39;re sending the contract on to. And then it&#39;s HIS</span>
<a name="l02620"></a>02620                 <span class="comment">// problem to decide which party he will sign on as. (Unless you are the LAST PARTY to confirm,</span>
<a name="l02621"></a>02621                 <span class="comment">// in which case YOU are the activator.)</span>
<a name="l02622"></a>02622                 <span class="comment">//</span>
<a name="l02623"></a>02623                 <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#aef6e165ada81ef09f673906744827ae8">OTAPI_Wrap::Smart_AreAllPartiesConfirmed</a>(strSmartContract))
<a name="l02624"></a>02624                 {
<a name="l02625"></a>02625                     <span class="comment">// The logic: If all the parties are confirmed, then just activate the thing. I must be the activator.</span>
<a name="l02626"></a>02626                     <span class="comment">// We need the ACCT_ID that we&#39;re using to activate it with, and we need the AGENT NAME for that account.</span>
<a name="l02627"></a>02627                     <span class="comment">// strMyAcctID and strMyAcctAgentName might ALREADY be set -- otherwise we need to set those.</span>
<a name="l02628"></a>02628                     <span class="comment">//</span>
<a name="l02629"></a>02629                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctAgentName)) <span class="comment">// Both will be valid or invalid, if one is. (But we check anyway.)</span>
<a name="l02630"></a>02630                     {
<a name="l02631"></a>02631                         <span class="comment">// We can&#39;t just use ANY account ID, but we must use one that is listed as one of the accounts for</span>
<a name="l02632"></a>02632                         <span class="comment">// the party activating the contract. So we have to display those accounts, and the user must choose</span>
<a name="l02633"></a>02633                         <span class="comment">// which one it&#39;s going to be. From there we can get the account ID and the agent name and call</span>
<a name="l02634"></a>02634                         <span class="comment">// activate_smart_contract.</span>
<a name="l02635"></a>02635                         <span class="comment">//</span>
<a name="l02636"></a>02636                         <a class="code" href="class_o_t___command.html#a8b0e30bf85feef0ea824798b3272ed7d">stat_partyaccounts</a>(strSmartContract, strPartyName, 2); <span class="comment">//nDepth=2</span>
<a name="l02637"></a>02637 
<a name="l02638"></a>02638                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Enter the index for the account you&#39;ll use to ACTIVATE the smart contract: &quot;</span>);
<a name="l02639"></a>02639 
<a name="l02640"></a>02640                         <span class="keywordtype">string</span> strAcctIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02641"></a>02641 
<a name="l02642"></a>02642                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctIndex))
<a name="l02643"></a>02643                         {
<a name="l02644"></a>02644                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02645"></a>02645                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02646"></a>02646                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02647"></a>02647                             <span class="keywordflow">return</span> -1;
<a name="l02648"></a>02648                         }
<a name="l02649"></a>02649 
<a name="l02650"></a>02650                         int32_t nAcctIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strAcctIndex);
<a name="l02651"></a>02651 
<a name="l02652"></a>02652                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAcctIndex) || (nAcctIndex &lt; 0) || (nAcctIndex &gt;= nAccountCount))
<a name="l02653"></a>02653                         {
<a name="l02654"></a>02654                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Bad Index: &quot;</span> + strAcctIndex + <span class="stringliteral">&quot; (Acceptable values are 0 through &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nAccountCount - 1) + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l02655"></a>02655                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02656"></a>02656                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02657"></a>02657                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02658"></a>02658                             <span class="keywordflow">return</span> -1;
<a name="l02659"></a>02659                         }
<a name="l02660"></a>02660 
<a name="l02661"></a>02661                         <span class="keywordtype">string</span> strAcctName = <a class="code" href="class_o_t_a_p_i___wrap.html#ad5fd7f35d5835ab95c7b57cf3bde8fec">OTAPI_Wrap::Party_GetAcctNameByIndex</a>(strSmartContract, strPartyName, nAcctIndex);
<a name="l02662"></a>02662 
<a name="l02663"></a>02663                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctName))
<a name="l02664"></a>02664                         {
<a name="l02665"></a>02665                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: Unable to retrieve account name at index &quot;</span> + strAcctIndex + <span class="stringliteral">&quot; for Party: &quot;</span> + strPartyName + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02666"></a>02666                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02667"></a>02667                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02668"></a>02668                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02669"></a>02669                             <span class="keywordflow">return</span> -1;
<a name="l02670"></a>02670                         }
<a name="l02671"></a>02671 
<a name="l02672"></a>02672                         <span class="keywordtype">string</span> strAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a99879b03606b33521bfad26d0f45b6de">OTAPI_Wrap::Party_GetAcctID</a>(strSmartContract, strPartyName, strAcctName);
<a name="l02673"></a>02673 
<a name="l02674"></a>02674                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID))
<a name="l02675"></a>02675                         {
<a name="l02676"></a>02676                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange: the account at index &quot;</span> + strAcctIndex + <span class="stringliteral">&quot; is not yet confirmed with any account ID. (Failure.)\n&quot;</span>);
<a name="l02677"></a>02677                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02678"></a>02678                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02679"></a>02679                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02680"></a>02680                             <span class="keywordflow">return</span> -1;
<a name="l02681"></a>02681                         }
<a name="l02682"></a>02682                         strMyAcctID = strAcctID; <span class="comment">// &lt;============</span>
<a name="l02683"></a>02683 
<a name="l02684"></a>02684                         <span class="keywordtype">string</span> strAcctAgentName = <a class="code" href="class_o_t_a_p_i___wrap.html#a303f5294e495f770f01d1e1befc1d416">OTAPI_Wrap::Party_GetAcctAgentName</a>(strSmartContract, strPartyName, strAcctName);
<a name="l02685"></a>02685 
<a name="l02686"></a>02686                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctAgentName))
<a name="l02687"></a>02687                         {
<a name="l02688"></a>02688                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Strange: the account named: &#39;&quot;</span> + strAcctName + <span class="stringliteral">&quot;&#39; doesn&#39;t seem to have any agent confirmed to it. (Failure.)\n&quot;</span>);
<a name="l02689"></a>02689                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02690"></a>02690                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02691"></a>02691                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02692"></a>02692                             <span class="keywordflow">return</span> -1;
<a name="l02693"></a>02693                         }
<a name="l02694"></a>02694                         strMyAcctAgentName = strAcctAgentName;  <span class="comment">// &lt;============</span>
<a name="l02695"></a>02695 
<a name="l02696"></a>02696                     } <span class="comment">// strMyAcctID wasn&#39;t set already, so the above block sets it.</span>
<a name="l02697"></a>02697 
<a name="l02698"></a>02698                     <span class="comment">// NOTE: Above, you see us harvesting the transaction numbers if any error occurs, since we haven&#39;t even tried</span>
<a name="l02699"></a>02699                     <span class="comment">// to send the instrument yet.</span>
<a name="l02700"></a>02700                     <span class="comment">//</span>
<a name="l02701"></a>02701                     <span class="comment">// But in this next section, we only want to do that if the transaction was definitely not processed by the server.</span>
<a name="l02702"></a>02702                     <span class="comment">// (Whether that processing succeeded or failed being a separate question.)</span>
<a name="l02703"></a>02703                     <span class="comment">//</span>
<a name="l02704"></a>02704                     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a19baeebf93ddebc5d846ef8ce41b6111">MadeEasy::activate_smart_contract</a>(strServerID, strNymID, strMyAcctID, strMyAcctAgentName, strSmartContract);
<a name="l02705"></a>02705                     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;activate_smart_contract&quot;</span>;
<a name="l02706"></a>02706                     <span class="comment">// ***************************************************************</span>
<a name="l02707"></a>02707                     int32_t nMessageSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l02708"></a>02708 
<a name="l02709"></a>02709                     <span class="keywordflow">if</span> (-1 == nMessageSuccess)
<a name="l02710"></a>02710                     {
<a name="l02711"></a>02711                         <span class="comment">// In this case, the server never even SAW the transaction, because its enveloping message already</span>
<a name="l02712"></a>02712                         <span class="comment">// failed before we even got that far. So we can harvest, as though it was never attempted...</span>
<a name="l02713"></a>02713                         <span class="comment">//</span>
<a name="l02714"></a>02714                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Message error: &quot;</span> + strAttempt + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l02715"></a>02715                         int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02716"></a>02716                             <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02717"></a>02717                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02718"></a>02718                         <span class="keywordflow">return</span> -1;
<a name="l02719"></a>02719                     }
<a name="l02720"></a>02720                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nMessageSuccess)
<a name="l02721"></a>02721                     {
<a name="l02722"></a>02722                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server reply (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): Message failure.\n&quot;</span>);
<a name="l02723"></a>02723                         int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02724"></a>02724                             <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02725"></a>02725                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02726"></a>02726                         <span class="keywordflow">return</span> 0;
<a name="l02727"></a>02727                     }
<a name="l02728"></a>02728                     <span class="comment">// (else 1: message was processed successfully -- though not necessarily the transaction inside it.)</span>
<a name="l02729"></a>02729 
<a name="l02730"></a>02730                     <span class="comment">// BELOW THIS POINT, the transaction has definitely processed. It may have succeeded or failed,</span>
<a name="l02731"></a>02731                     <span class="comment">// but either way, we don&#39;t need to harvest any numbers, since OT will internally handle those</span>
<a name="l02732"></a>02732                     <span class="comment">// when it processes the server&#39;s reply to the transaction attempt.</span>
<a name="l02733"></a>02733                     <span class="comment">//</span>
<a name="l02734"></a>02734                     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strNymID, strMyAcctID, strAttempt, strResponse);
<a name="l02735"></a>02735 
<a name="l02736"></a>02736                     <span class="keywordflow">if</span> (1 == nInterpretReply) <span class="comment">// Success.</span>
<a name="l02737"></a>02737                     {
<a name="l02738"></a>02738                         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l02739"></a>02739                         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l02740"></a>02740                         <span class="comment">//</span>
<a name="l02741"></a>02741                         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strNymID, strMyAcctID, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l02742"></a>02742 
<a name="l02743"></a>02743                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS activating smart contract!\n&quot;</span>);
<a name="l02744"></a>02744                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l02745"></a>02745                     }
<a name="l02746"></a>02746                     <span class="comment">//</span>
<a name="l02747"></a>02747                     <span class="comment">// Return status to caller.</span>
<a name="l02748"></a>02748                     <span class="comment">//</span>
<a name="l02749"></a>02749                     <span class="keywordflow">return</span> nInterpretReply;
<a name="l02750"></a>02750                 } <span class="comment">// if (all parties are confirmed)</span>
<a name="l02751"></a>02751                 <span class="comment">// ***************************************************************</span>
<a name="l02752"></a>02752                 <span class="keywordflow">else</span> <span class="comment">// SEND INSTRUMENT TO NEXT PARTY.</span>
<a name="l02753"></a>02753                 {
<a name="l02754"></a>02754                     <span class="comment">// But if all the parties are NOT confirmed, then we need to send it to the next guy. In that case:</span>
<a name="l02755"></a>02755                     <span class="comment">// If HisNym is provided, and it&#39;s different than strNymID, then use it. He&#39;s the next receipient.</span>
<a name="l02756"></a>02756                     <span class="comment">// If HisNym is NOT provided, then display the list of NymIDs, and allow the user to paste one. We can</span>
<a name="l02757"></a>02757                     <span class="comment">// probably select him based on abbreviated ID or Name as well (I think there&#39;s an API call for that...)</span>
<a name="l02758"></a>02758                     <span class="comment">//</span>
<a name="l02759"></a>02759                     <span class="keywordtype">string</span> strHisNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02760"></a>02760 
<a name="l02761"></a>02761                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>, <span class="keyword">false</span>))
<a name="l02762"></a>02762                     {
<a name="l02763"></a>02763                         strHisNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>;
<a name="l02764"></a>02764                     }
<a name="l02765"></a>02765 
<a name="l02766"></a>02766                     <span class="comment">// If strHisNymID doesn&#39;t exist, or it&#39;s the same as strNymID, then ask the user to select</span>
<a name="l02767"></a>02767                     <span class="comment">// a NymID for the recipient.</span>
<a name="l02768"></a>02768                     <span class="comment">//</span>
<a name="l02769"></a>02769                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymID) || (strHisNymID == strNymID))
<a name="l02770"></a>02770                     {
<a name="l02771"></a>02771                         <a class="code" href="class_o_t___command.html#a7372359847eb412a1e659ef68539a822">OT_Command::main_stat_nyms</a>(); <span class="comment">// Display the NymIDs</span>
<a name="l02772"></a>02772 
<a name="l02773"></a>02773                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nOnce you confirm this contract, then we need to send it on to the\nnext party so he can confirm it, too.\n\nPlease PASTE a recipient Nym ID (the next party): &quot;</span>);
<a name="l02774"></a>02774                         <span class="keywordtype">string</span> strRecipientNymID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02775"></a>02775                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientNymID))
<a name="l02776"></a>02776                         {
<a name="l02777"></a>02777                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02778"></a>02778                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02779"></a>02779                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02780"></a>02780                             <span class="keywordflow">return</span> -1;
<a name="l02781"></a>02781                         }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783                         <span class="keywordtype">string</span> strHisNymParam = strRecipientNymID;
<a name="l02784"></a>02784 
<a name="l02785"></a>02785                         <span class="comment">// IF we are able to resolve the HisNymId from a partial, then we</span>
<a name="l02786"></a>02786                         <span class="comment">// replace the partial with the full version.</span>
<a name="l02787"></a>02787                         <span class="comment">// (Otherwise we assume it&#39;s already a full ID and we don&#39;t mess with it.)</span>
<a name="l02788"></a>02788                         <span class="comment">//</span>
<a name="l02789"></a>02789                         <span class="keywordtype">string</span> strHisNymFromPartial = <a class="code" href="class_o_t_a_p_i___wrap.html#a7c526c067a62f1b534fb7bfdb02b869d">OTAPI_Wrap::Wallet_GetNymIDFromPartial</a>(strRecipientNymID);
<a name="l02790"></a>02790 
<a name="l02791"></a>02791                         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymFromPartial))
<a name="l02792"></a>02792                         {
<a name="l02793"></a>02793                             strHisNymParam = strHisNymFromPartial;
<a name="l02794"></a>02794                         }
<a name="l02795"></a>02795 
<a name="l02796"></a>02796                         strHisNymID = strHisNymParam;
<a name="l02797"></a>02797 
<a name="l02798"></a>02798                         <span class="keywordflow">if</span> (strHisNymID == strNymID)
<a name="l02799"></a>02799                         {
<a name="l02800"></a>02800                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSorry, but YOU cannot simultaneously be the SENDER _and_ the RECIPIENT. Choose another nym for one or the other.\n&quot;</span>);
<a name="l02801"></a>02801                             int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02802"></a>02802                                 <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02803"></a>02803                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02804"></a>02804                             <span class="keywordflow">return</span> -1;
<a name="l02805"></a>02805                         }
<a name="l02806"></a>02806                     }
<a name="l02807"></a>02807 
<a name="l02808"></a>02808                     <span class="comment">// Send it to the next user!</span>
<a name="l02809"></a>02809                     <span class="comment">//</span>
<a name="l02810"></a>02810                     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strNymID, strHisNymID, strSmartContract);
<a name="l02811"></a>02811 
<a name="l02812"></a>02812                     int32_t nMessageSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l02813"></a>02813 
<a name="l02814"></a>02814                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nMessageSuccess) || (1 != nMessageSuccess))
<a name="l02815"></a>02815                     {
<a name="l02816"></a>02816                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nFor whatever reason, our attempt to send the instrument on to the next user has failed.\n&quot;</span>);
<a name="l02817"></a>02817                         int32_t nHarvested = <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strSmartContract, strNymID,
<a name="l02818"></a>02818                             <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// NOTE: all the &#39;false&#39;s here are unused in this case. (Since we&#39;re passing a smart contract, instead of a message, it means we are harvesting before the message even had a CHANCE to get sent. Meaning we didn&#39;t even TRY to send it, and we&#39;re harvesting ALL numbers. Period.)</span>
<a name="l02819"></a>02819                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: OT_API_Msg_HarvestTransactionNumbers: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nHarvested) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02820"></a>02820                     }
<a name="l02821"></a>02821                     <span class="keywordflow">else</span> <span class="comment">// Success. (Remove the payment instrument we just successfully sent, from our payments inbox.)</span>
<a name="l02822"></a>02822                     {
<a name="l02823"></a>02823                         <span class="comment">// In the case of smart contracts, it might be sent on to a chain of 2 or 3 users,</span>
<a name="l02824"></a>02824                         <span class="comment">// before finally being activated by the last one in the chain. All of the users in</span>
<a name="l02825"></a>02825                         <span class="comment">// the chain (except the first one) will thus have a copy of the smart contract in</span>
<a name="l02826"></a>02826                         <span class="comment">// their payments inbox AND outbox.</span>
<a name="l02827"></a>02827                         <span class="comment">//</span>
<a name="l02828"></a>02828                         <span class="comment">// But once the smart contract has successfully been sent on to the next user, and</span>
<a name="l02829"></a>02829                         <span class="comment">// thus a copy of it is in my outbox already, then there is definitely no reason for</span>
<a name="l02830"></a>02830                         <span class="comment">// a copy of it to stay in my inbox as well. Might as well remove that copy.</span>
<a name="l02831"></a>02831                         <span class="comment">//</span>
<a name="l02832"></a>02832                         <span class="comment">// We can&#39;t really expect to remove the payments inbox copy inside OT itself, when we</span>
<a name="l02833"></a>02833                         <span class="comment">// receive the server&#39;s atSendUserInstrument reply message, without opening up the</span>
<a name="l02834"></a>02834                         <span class="comment">// (encrypted) contents. (Although that would actually be ideal, since it would cover</span>
<a name="l02835"></a>02835                         <span class="comment">// all cases included dropped messages...) But we CAN easily remove it RIGHT HERE.</span>
<a name="l02836"></a>02836                         <span class="comment">// Perhaps in the future I WILL move this code to the atSendUserInstrument reply processing,</span>
<a name="l02837"></a>02837                         <span class="comment">// but that will require it to be encrypted to my own key as well as the recipient&#39;s,</span>
<a name="l02838"></a>02838                         <span class="comment">// which we already do for sending cash, but which we up until now have not done for</span>
<a name="l02839"></a>02839                         <span class="comment">// the other instruments. So perhaps we&#39;ll start doing that sometime in the future, and</span>
<a name="l02840"></a>02840                         <span class="comment">// then move this code.</span>
<a name="l02841"></a>02841                         <span class="comment">//</span>
<a name="l02842"></a>02842                         <span class="comment">// In the meantime, this is good enough.</span>
<a name="l02843"></a>02843                         <span class="comment">//</span>
<a name="l02844"></a>02844 
<a name="l02845"></a>02845                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success sending the agreement on to the next party.\n&quot;</span>);
<a name="l02846"></a>02846 
<a name="l02847"></a>02847                         <span class="keywordflow">if</span> (-1 != nIndex) <span class="comment">// If the instrument was in the payments inbox (versus just being pasted in.)</span>
<a name="l02848"></a>02848                         {
<a name="l02849"></a>02849                             <a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(strServerID, strNymID, <span class="keyword">true</span>, <span class="comment">// true == payments inbox. false == outpayments box.</span>
<a name="l02850"></a>02850                                 nIndex, <span class="keyword">false</span>); <span class="comment">//bSaveCopy = false (it&#39;s already in my payments outbox, no need to save inbox copy too)</span>
<a name="l02851"></a>02851                         }
<a name="l02852"></a>02852                     }
<a name="l02853"></a>02853                     <span class="keywordflow">return</span> nMessageSuccess;
<a name="l02854"></a>02854 
<a name="l02855"></a>02855                 }
<a name="l02856"></a>02856             }
<a name="l02857"></a>02857         }
<a name="l02858"></a>02858     } <span class="comment">// ---------------------------------------</span>
<a name="l02859"></a>02859     <span class="comment">// else there aren&#39;t any unconfirmed parties, and it already displayed an error message related to that.</span>
<a name="l02860"></a>02860 
<a name="l02861"></a>02861     <span class="keywordflow">return</span> -1;
<a name="l02862"></a>02862 }
<a name="l02863"></a>02863 
<a name="l02864"></a>02864 
<a name="l02865"></a><a class="code" href="class_o_t___command.html#ab4b3d00292d3e17ce7f8e82e523e14c8">02865</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab4b3d00292d3e17ce7f8e82e523e14c8">OT_Command::main_confirm</a>() <span class="comment">// smart contract and payment plan</span>
<a name="l02866"></a>02866 {
<a name="l02867"></a>02867     int32_t nIndex = -1;
<a name="l02868"></a>02868 
<a name="l02869"></a>02869     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l02870"></a>02870     {
<a name="l02871"></a>02871         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l02872"></a>02872         <span class="comment">//                                  const std::string str_key)</span>
<a name="l02873"></a>02873         <span class="comment">//</span>
<a name="l02874"></a>02874         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l02875"></a>02875         <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l02876"></a>02876         <span class="comment">//</span>
<a name="l02877"></a>02877         <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>); <span class="comment">// any integer value</span>
<a name="l02878"></a>02878 
<a name="l02879"></a>02879         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l02880"></a>02880         {
<a name="l02881"></a>02881             int32_t nTempIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l02882"></a>02882 
<a name="l02883"></a>02883             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTempIndex) &amp;&amp; (nTempIndex &gt;= 0))
<a name="l02884"></a>02884             {
<a name="l02885"></a>02885                 nIndex = nTempIndex;
<a name="l02886"></a>02886             }
<a name="l02887"></a>02887         }
<a name="l02888"></a>02888     }
<a name="l02889"></a>02889     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l02890"></a>02890     <span class="comment">// ***************************************************************</span>
<a name="l02891"></a>02891     <span class="keywordtype">string</span> strInstrument = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02892"></a>02892 
<a name="l02893"></a>02893     <span class="keywordflow">if</span> (-1 == nIndex) <span class="comment">// No index provided, so they need to paste the smart contract...</span>
<a name="l02894"></a>02894     {
<a name="l02895"></a>02895         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>))
<a name="l02896"></a>02896         {
<a name="l02897"></a>02897             <a class="code" href="class_o_t___command.html#afa3a8da44e9bbc956f4cc313aa88f83a">OT_Command::main_show_payments_inbox</a>();
<a name="l02898"></a>02898 
<a name="l02899"></a>02899             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;If this is in reference to a smart contract or payment plan in your payments\ninbox, please enter the index to confirm it (or just hit enter, to paste a contract): &quot;</span>);
<a name="l02900"></a>02900             <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l02901"></a>02901 
<a name="l02902"></a>02902             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l02903"></a>02903             {
<a name="l02904"></a>02904                 int32_t nTempIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l02905"></a>02905 
<a name="l02906"></a>02906                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTempIndex) &amp;&amp; (nTempIndex &gt;= 0))
<a name="l02907"></a>02907                 {
<a name="l02908"></a>02908                     nIndex = nTempIndex;
<a name="l02909"></a>02909 
<a name="l02910"></a>02910                     strInstrument = <a class="code" href="class_made_easy.html#a36be6514828e74506c8ef217b059d6cd">MadeEasy::get_payment_instrument</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02911"></a>02911 
<a name="l02912"></a>02912                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l02913"></a>02913                     {
<a name="l02914"></a>02914                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Unable to get instrument from payments inbox, based on index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l02915"></a>02915                         <span class="keywordflow">return</span> -1;
<a name="l02916"></a>02916                     }
<a name="l02917"></a>02917                 }
<a name="l02918"></a>02918                 <span class="keywordflow">else</span>
<a name="l02919"></a>02919                 {
<a name="l02920"></a>02920                     <span class="keywordflow">return</span> -1;
<a name="l02921"></a>02921                 }
<a name="l02922"></a>02922             }
<a name="l02923"></a>02923             <span class="keywordflow">else</span>
<a name="l02924"></a>02924             {
<a name="l02925"></a>02925                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nPlease paste the smart contract or payment plan,\nfollowed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l02926"></a>02926 
<a name="l02927"></a>02927                 strInstrument = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l02928"></a>02928 
<a name="l02929"></a>02929                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l02930"></a>02930                 {
<a name="l02931"></a>02931                     <span class="keywordflow">return</span> -1;
<a name="l02932"></a>02932                 }
<a name="l02933"></a>02933             }
<a name="l02934"></a>02934         }
<a name="l02935"></a>02935         <span class="keywordflow">else</span>
<a name="l02936"></a>02936         {
<a name="l02937"></a>02937             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nPlease paste the smart contract or payment plan,\nfollowed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l02938"></a>02938 
<a name="l02939"></a>02939             strInstrument = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l02940"></a>02940 
<a name="l02941"></a>02941             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l02942"></a>02942             {
<a name="l02943"></a>02943                 <span class="keywordflow">return</span> -1;
<a name="l02944"></a>02944             }
<a name="l02945"></a>02945         }
<a name="l02946"></a>02946     }
<a name="l02947"></a>02947 
<a name="l02948"></a>02948     <span class="keywordflow">else</span> <span class="comment">// nIndex is NOT -1 (an index was specified.)</span>
<a name="l02949"></a>02949     {
<a name="l02950"></a>02950         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l02951"></a>02951         {
<a name="l02952"></a>02952             strInstrument = <a class="code" href="class_made_easy.html#a36be6514828e74506c8ef217b059d6cd">MadeEasy::get_payment_instrument</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02953"></a>02953 
<a name="l02954"></a>02954             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l02955"></a>02955             {
<a name="l02956"></a>02956                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Unable to get instrument from payments inbox, based on index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l02957"></a>02957                 <span class="keywordflow">return</span> -1;
<a name="l02958"></a>02958             }
<a name="l02959"></a>02959         }
<a name="l02960"></a>02960         <span class="keywordflow">else</span>
<a name="l02961"></a>02961         {
<a name="l02962"></a>02962             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Since you specified an index, make sure to also specify --server and --mynym,\nso you use that index on the right payments inbox.\n&quot;</span>);
<a name="l02963"></a>02963             <span class="keywordflow">return</span> -1; <span class="comment">// VerifyExists logs already.</span>
<a name="l02964"></a>02964         }
<a name="l02965"></a>02965     }
<a name="l02966"></a>02966 
<a name="l02967"></a>02967     <span class="keywordtype">string</span> strInstrumentType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l02968"></a>02968 
<a name="l02969"></a>02969     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrumentType))
<a name="l02970"></a>02970     {
<a name="l02971"></a>02971         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine instrument type. Expected SMART CONTRACT or PAYMENT PLAN.\n&quot;</span>);
<a name="l02972"></a>02972         <span class="keywordflow">return</span> -1;
<a name="l02973"></a>02973     }
<a name="l02974"></a>02974 
<a name="l02975"></a>02975     <span class="comment">// Is the instrument yet valid, or is it expired?</span>
<a name="l02976"></a>02976     <span class="comment">// Handle both those cases here...</span>
<a name="l02977"></a>02977     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tFrom = <a class="code" href="class_o_t_a_p_i___wrap.html#ab5001f7251cfad8bbf7dd81e42892c8d">OTAPI_Wrap::Instrmnt_GetValidFrom</a>(strInstrument);
<a name="l02978"></a>02978     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tTo = <a class="code" href="class_o_t_a_p_i___wrap.html#ae45fee7bad36b1d653c13cc58c94bbe7">OTAPI_Wrap::Instrmnt_GetValidTo</a>(strInstrument);
<a name="l02979"></a>02979     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tTime = <a class="code" href="class_o_t_a_p_i___wrap.html#abf13a18a258717c8e92bb7b28f368a1c">OTAPI_Wrap::GetTime</a>();
<a name="l02980"></a>02980 
<a name="l02981"></a>02981     <span class="keywordflow">if</span> (tTime &lt; tFrom)
<a name="l02982"></a>02982     {
<a name="l02983"></a>02983         <span class="keywordflow">if</span> (-1 == nIndex) { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument is not yet within its valid date range. (Skipping.)\n&quot;</span>); }
<a name="l02984"></a>02984         <span class="keywordflow">else</span> { <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; is not yet within its valid date range. (Skipping.)\n&quot;</span>); }
<a name="l02985"></a>02985         <span class="keywordflow">return</span> 0;
<a name="l02986"></a>02986     }
<a name="l02987"></a>02987     <span class="keywordflow">if</span> ((tTo &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>) &amp;&amp; (tTime &gt; tTo))
<a name="l02988"></a>02988     {
<a name="l02989"></a>02989         <span class="keywordflow">if</span> (-1 == nIndex)
<a name="l02990"></a>02990         {
<a name="l02991"></a>02991             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument is expired. (Harvesting the transaction numbers.)\n&quot;</span>);
<a name="l02992"></a>02992             <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strInstrument, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>))
<a name="l02993"></a>02993             {
<a name="l02994"></a>02994                 <span class="keywordflow">return</span> 0;
<a name="l02995"></a>02995             }
<a name="l02996"></a>02996         }
<a name="l02997"></a>02997         <span class="keywordflow">else</span> <span class="comment">// there&#39;s an index.</span>
<a name="l02998"></a>02998         {
<a name="l02999"></a>02999             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; is expired. (Moving it to the record box.)\n&quot;</span>);
<a name="l03000"></a>03000 
<a name="l03001"></a>03001             <span class="comment">// Since this instrument is expired, remove it from the payments inbox, and move to record box.</span>
<a name="l03002"></a>03002 
<a name="l03003"></a>03003 
<a name="l03004"></a>03004             <span class="comment">// Note: this harvests.</span>
<a name="l03005"></a>03005             <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <span class="keyword">true</span>, <span class="comment">// bIsInbox=true</span>
<a name="l03006"></a>03006                 nIndex, <span class="keyword">true</span>)) <span class="comment">// bSaveCopy=true. (Will be saved in expired box, since it&#39;s expired.)</span>
<a name="l03007"></a>03007             {
<a name="l03008"></a>03008                 <span class="keywordflow">return</span> 0;
<a name="l03009"></a>03009             }
<a name="l03010"></a>03010         } <span class="comment">// there&#39;s an index.</span>
<a name="l03011"></a>03011         <span class="keywordflow">return</span> -1;
<a name="l03012"></a>03012     }
<a name="l03013"></a>03013 
<a name="l03014"></a>03014     <span class="keywordflow">if</span> (<span class="stringliteral">&quot;SMARTCONTRACT&quot;</span> == strInstrumentType)
<a name="l03015"></a>03015     {
<a name="l03016"></a>03016         <span class="comment">// Success! (It&#39;s a smart contract for sure.)</span>
<a name="l03017"></a>03017         <span class="comment">//</span>
<a name="l03018"></a>03018         <span class="comment">// BY this point, we know that strInstrument contains a string.</span>
<a name="l03019"></a>03019         <span class="comment">// We also know that it came from the payments inbox at nIndex, or</span>
<a name="l03020"></a>03020         <span class="comment">// that it was pasted in and nIndex is -1. We also know that if nIndex</span>
<a name="l03021"></a>03021         <span class="comment">// is NOT -1, that means Server and MyNym are set, because that&#39;s the</span>
<a name="l03022"></a>03022         <span class="comment">// box we must have gotten the smart contract out of (because someone</span>
<a name="l03023"></a>03023         <span class="comment">// else sent it to us for confirmation...)</span>
<a name="l03024"></a>03024         <span class="comment">//</span>
<a name="l03025"></a>03025         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ac0785bc8264d1e134a8943bb2357f38d">details_confirm_smart_contract</a>(strInstrument, nIndex);
<a name="l03026"></a>03026 
<a name="l03027"></a>03027     }
<a name="l03028"></a>03028     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PAYMENT PLAN&quot;</span> == strInstrumentType)
<a name="l03029"></a>03029     {
<a name="l03030"></a>03030         <span class="comment">// Success! (It&#39;s a payment plan for sure.)</span>
<a name="l03031"></a>03031         <span class="comment">//</span>
<a name="l03032"></a>03032         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#acae742af25d3c0010d922a43391f9ca9">details_confirm_plan</a>(strInstrument, nIndex);
<a name="l03033"></a>03033     }
<a name="l03034"></a>03034     <span class="keywordflow">else</span>  <span class="comment">// CHEQUE VOUCHER INVOICE PURSE</span>
<a name="l03035"></a>03035     {
<a name="l03036"></a>03036         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nFailure: Instrument is not a smart contract or payment plan, but rather a: &quot;</span> + strInstrumentType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03037"></a>03037         <span class="keywordflow">return</span> -1;
<a name="l03038"></a>03038     }
<a name="l03039"></a>03039 
<a name="l03040"></a>03040     <span class="keywordflow">return</span> -1;
<a name="l03041"></a>03041 }
<a name="l03042"></a>03042 
<a name="l03043"></a>03043 
<a name="l03044"></a><a class="code" href="class_o_t___command.html#a8362b865df28c853e328011992c59f1c">03044</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8362b865df28c853e328011992c59f1c">OT_Command::main_encode</a>()
<a name="l03045"></a>03045 {
<a name="l03046"></a>03046     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter multiple lines of input to be encoded, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03047"></a>03047 
<a name="l03048"></a>03048     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03049"></a>03049     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03050"></a>03050     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03051"></a>03051     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03052"></a>03052 
<a name="l03053"></a>03053     <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03054"></a>03054 
<a name="l03055"></a>03055     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n--------------------------------------\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03056"></a>03056 
<a name="l03057"></a>03057     <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#a91adcad0c22c8ffde9004933927247cb">OTAPI_Wrap::Encode</a>(strInput, <span class="keyword">true</span>);  <span class="comment">// bLineBreaks=true</span>
<a name="l03058"></a>03058 
<a name="l03059"></a>03059     <span class="comment">// stderr</span>
<a name="l03060"></a>03060     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------- \n Encoded:\n\n&quot;</span>);
<a name="l03061"></a>03061 
<a name="l03062"></a>03062     <span class="comment">// stdout</span>
<a name="l03063"></a>03063     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l03064"></a>03064     {
<a name="l03065"></a>03065         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l03066"></a>03066         <span class="comment">// stderr</span>
<a name="l03067"></a>03067         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03068"></a>03068         <span class="keywordflow">return</span> 1;
<a name="l03069"></a>03069     }
<a name="l03070"></a>03070 
<a name="l03071"></a>03071     <span class="comment">// stderr</span>
<a name="l03072"></a>03072     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03073"></a>03073 
<a name="l03074"></a>03074     <span class="keywordflow">return</span> -1;
<a name="l03075"></a>03075 }
<a name="l03076"></a>03076 
<a name="l03077"></a>03077 
<a name="l03078"></a><a class="code" href="class_o_t___command.html#af3d78b758ca0df19e7e9bf83cd24819b">03078</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af3d78b758ca0df19e7e9bf83cd24819b">OT_Command::main_decode</a>()
<a name="l03079"></a>03079 {
<a name="l03080"></a>03080     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter multiple lines of OT-armored text to be decoded, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03081"></a>03081 
<a name="l03082"></a>03082     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03083"></a>03083     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03084"></a>03084     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03085"></a>03085     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03086"></a>03086 
<a name="l03087"></a>03087     <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03088"></a>03088 
<a name="l03089"></a>03089     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n--------------------------------------\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03090"></a>03090 
<a name="l03091"></a>03091     <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#a4dc79d2dd37269f4333e1450101d9489">OTAPI_Wrap::Decode</a>(strInput, <span class="keyword">true</span>);  <span class="comment">// bLineBreaks=true</span>
<a name="l03092"></a>03092 
<a name="l03093"></a>03093     <span class="comment">// stderr</span>
<a name="l03094"></a>03094     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;--------------------------------------\n Decoded:\n\n&quot;</span>);
<a name="l03095"></a>03095 
<a name="l03096"></a>03096     <span class="comment">// stdout</span>
<a name="l03097"></a>03097     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l03098"></a>03098     {
<a name="l03099"></a>03099         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l03100"></a>03100         <span class="comment">// stderr</span>
<a name="l03101"></a>03101         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03102"></a>03102         <span class="keywordflow">return</span> 1;
<a name="l03103"></a>03103     }
<a name="l03104"></a>03104 
<a name="l03105"></a>03105     <span class="comment">// stderr</span>
<a name="l03106"></a>03106     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03107"></a>03107 
<a name="l03108"></a>03108     <span class="keywordflow">return</span> -1;
<a name="l03109"></a>03109 }
<a name="l03110"></a>03110 
<a name="l03111"></a>03111 
<a name="l03112"></a><a class="code" href="class_o_t___command.html#a3d32d379f79747bfe8d9e4a008f5b302">03112</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3d32d379f79747bfe8d9e4a008f5b302">OT_Command::main_encrypt</a>()
<a name="l03113"></a>03113 {
<a name="l03114"></a>03114     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>))
<a name="l03115"></a>03115     {
<a name="l03116"></a>03116 
<a name="l03117"></a>03117         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter multiple lines of input to be encrypted,\nfollowed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03118"></a>03118 
<a name="l03119"></a>03119         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03120"></a>03120         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03121"></a>03121         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03122"></a>03122         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03123"></a>03123 
<a name="l03124"></a>03124         <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03125"></a>03125 
<a name="l03126"></a>03126         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n--------------------------------------\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03127"></a>03127 
<a name="l03128"></a>03128         <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#adf4adb77fc678317bd8bcd6bdde8d4b8">OTAPI_Wrap::Encrypt</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, strInput);  <span class="comment">// bLineBreaks=true</span>
<a name="l03129"></a>03129 
<a name="l03130"></a>03130         <span class="comment">// stdout</span>
<a name="l03131"></a>03131         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l03132"></a>03132         {
<a name="l03133"></a>03133             <span class="comment">// stderr</span>
<a name="l03134"></a>03134             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------- \n Encrypted:\n\n&quot;</span>);
<a name="l03135"></a>03135 
<a name="l03136"></a>03136             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l03137"></a>03137             <span class="comment">// stderr</span>
<a name="l03138"></a>03138             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03139"></a>03139             <span class="keywordflow">return</span> 1;
<a name="l03140"></a>03140         }
<a name="l03141"></a>03141     }
<a name="l03142"></a>03142 
<a name="l03143"></a>03143     <span class="comment">// &quot;return value&quot;</span>
<a name="l03144"></a>03144     <span class="keywordflow">return</span> -1;
<a name="l03145"></a>03145 }
<a name="l03146"></a>03146 
<a name="l03147"></a>03147 
<a name="l03148"></a><a class="code" href="class_o_t___command.html#aa48b243dd739c28ef912a291157cc615">03148</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa48b243dd739c28ef912a291157cc615">OT_Command::main_decrypt</a>()
<a name="l03149"></a>03149 {
<a name="l03150"></a>03150     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l03151"></a>03151     {
<a name="l03152"></a>03152 
<a name="l03153"></a>03153         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter multiple lines of input to be decrypted, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03154"></a>03154 
<a name="l03155"></a>03155         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03156"></a>03156         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03157"></a>03157         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03158"></a>03158         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03159"></a>03159 
<a name="l03160"></a>03160         <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03161"></a>03161 
<a name="l03162"></a>03162         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n--------------------------------------\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03163"></a>03163 
<a name="l03164"></a>03164         <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ac74ef241df577a7a7caf049df5fe60">OTAPI_Wrap::Decrypt</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInput);  <span class="comment">// bLineBreaks=true</span>
<a name="l03165"></a>03165 
<a name="l03166"></a>03166         <span class="comment">// stdout</span>
<a name="l03167"></a>03167         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l03168"></a>03168         {
<a name="l03169"></a>03169             <span class="comment">// stderr</span>
<a name="l03170"></a>03170             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------- \n Decrypted:\n\n&quot;</span>);
<a name="l03171"></a>03171 
<a name="l03172"></a>03172             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l03173"></a>03173             <span class="comment">// stderr</span>
<a name="l03174"></a>03174             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03175"></a>03175             <span class="keywordflow">return</span> 1;
<a name="l03176"></a>03176         }
<a name="l03177"></a>03177     }
<a name="l03178"></a>03178 
<a name="l03179"></a>03179     <span class="comment">// &quot;return value&quot;</span>
<a name="l03180"></a>03180     <span class="keywordflow">return</span> -1;
<a name="l03181"></a>03181 }
<a name="l03182"></a>03182 
<a name="l03183"></a>03183 
<a name="l03184"></a><a class="code" href="class_o_t___command.html#a6ca830a35f1c7beaa6dc62e7c3ac6ef3">03184</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a6ca830a35f1c7beaa6dc62e7c3ac6ef3">OT_Command::main_password_encrypt</a>()
<a name="l03185"></a>03185 {
<a name="l03186"></a>03186     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter a symmetric key, followed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03187"></a>03187 
<a name="l03188"></a>03188     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03189"></a>03189     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03190"></a>03190     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03191"></a>03191     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03192"></a>03192 
<a name="l03193"></a>03193     <span class="keywordtype">string</span> strKey = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03194"></a>03194 
<a name="l03195"></a>03195     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the plaintext, followed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03196"></a>03196 
<a name="l03197"></a>03197     <span class="keywordtype">string</span> strPlaintext = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03198"></a>03198 
<a name="l03199"></a>03199     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strKey) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPlaintext))
<a name="l03200"></a>03200     {
<a name="l03201"></a>03201         <span class="keywordtype">string</span> strCiphertext = <a class="code" href="class_o_t_a_p_i___wrap.html#a41aa5258d06f2254e5f4c512db6dcb8c">OTAPI_Wrap::SymmetricEncrypt</a>(strKey, strPlaintext);
<a name="l03202"></a>03202 
<a name="l03203"></a>03203         <span class="comment">// stdout</span>
<a name="l03204"></a>03204         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCiphertext))
<a name="l03205"></a>03205         {
<a name="l03206"></a>03206             <span class="comment">// stderr</span>
<a name="l03207"></a>03207             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------- \n strCiphertext:\n\n&quot;</span>);
<a name="l03208"></a>03208 
<a name="l03209"></a>03209             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCiphertext);
<a name="l03210"></a>03210             <span class="comment">// stderr</span>
<a name="l03211"></a>03211             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03212"></a>03212             <span class="keywordflow">return</span> 1;
<a name="l03213"></a>03213         }
<a name="l03214"></a>03214     }
<a name="l03215"></a>03215 
<a name="l03216"></a>03216     <span class="comment">// &quot;return value&quot;</span>
<a name="l03217"></a>03217     <span class="keywordflow">return</span> -1;
<a name="l03218"></a>03218 }
<a name="l03219"></a>03219 
<a name="l03220"></a>03220 
<a name="l03221"></a><a class="code" href="class_o_t___command.html#a90b5374224729d18a1755d890ce874b5">03221</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a90b5374224729d18a1755d890ce874b5">OT_Command::main_password_decrypt</a>()
<a name="l03222"></a>03222 {
<a name="l03223"></a>03223     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter a symmetric key, followed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03224"></a>03224 
<a name="l03225"></a>03225     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l03226"></a>03226     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l03227"></a>03227     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l03228"></a>03228     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l03229"></a>03229 
<a name="l03230"></a>03230     <span class="keywordtype">string</span> strKey = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03231"></a>03231 
<a name="l03232"></a>03232     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the symmetrically-encrypted ciphertext, followed by a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03233"></a>03233 
<a name="l03234"></a>03234     <span class="keywordtype">string</span> strCiphertext = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03235"></a>03235 
<a name="l03236"></a>03236     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strKey) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCiphertext))
<a name="l03237"></a>03237     {
<a name="l03238"></a>03238         <span class="keywordtype">string</span> strPlaintext = <a class="code" href="class_o_t_a_p_i___wrap.html#ad095261bbc71b29e59bad9dad177e1d0">OTAPI_Wrap::SymmetricDecrypt</a>(strKey, strCiphertext);
<a name="l03239"></a>03239 
<a name="l03240"></a>03240         <span class="comment">// stdout</span>
<a name="l03241"></a>03241         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPlaintext))
<a name="l03242"></a>03242         {
<a name="l03243"></a>03243             <span class="comment">// stderr</span>
<a name="l03244"></a>03244             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------- \n Plaintext:\n\n&quot;</span>);
<a name="l03245"></a>03245 
<a name="l03246"></a>03246             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strPlaintext);
<a name="l03247"></a>03247             <span class="comment">// stderr</span>
<a name="l03248"></a>03248             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03249"></a>03249             <span class="keywordflow">return</span> 1;
<a name="l03250"></a>03250         }
<a name="l03251"></a>03251     }
<a name="l03252"></a>03252 
<a name="l03253"></a>03253     <span class="comment">// &quot;return value&quot;</span>
<a name="l03254"></a>03254     <span class="keywordflow">return</span> -1;
<a name="l03255"></a>03255 }
<a name="l03256"></a>03256 
<a name="l03257"></a>03257 
<a name="l03258"></a><a class="code" href="class_o_t___command.html#ac505b4024af6ef0ef48e21fd4696165b">03258</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#ac505b4024af6ef0ef48e21fd4696165b">OT_Command::details_import_nym</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymImportFile, <span class="keywordtype">string</span> &amp; strOutNymID)
<a name="l03259"></a>03259 {
<a name="l03260"></a>03260     strOutNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a745f6330466d1d4fc8068893842d6491" title="returns NymID if success, else NULL.">OTAPI_Wrap::Wallet_ImportNym</a>(strNymImportFile);
<a name="l03261"></a>03261 
<a name="l03262"></a>03262     <span class="keywordtype">bool</span> bVerified = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutNymID);
<a name="l03263"></a>03263 
<a name="l03264"></a>03264     <span class="keywordflow">return</span> bVerified;
<a name="l03265"></a>03265 }
<a name="l03266"></a>03266 
<a name="l03267"></a>03267 
<a name="l03268"></a><a class="code" href="class_o_t___command.html#a1a86d68986a8588b69f05e0a38c8fbf5">03268</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a1a86d68986a8588b69f05e0a38c8fbf5">OT_Command::main_import_nym</a>()
<a name="l03269"></a>03269 {
<a name="l03270"></a>03270     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n USAGE: importnym\n&quot;</span>;
<a name="l03271"></a>03271 
<a name="l03272"></a>03272     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03273"></a>03273 
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Paste your exported Nym here (for import), followed by a ~ by itself on a blank line: \n&quot;</span>);
<a name="l03276"></a>03276 
<a name="l03277"></a>03277     <span class="keywordtype">string</span> strNymFile = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03278"></a>03278 
<a name="l03279"></a>03279     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymFile))
<a name="l03280"></a>03280     {
<a name="l03281"></a>03281         <span class="keywordflow">return</span> -1;
<a name="l03282"></a>03282     }
<a name="l03283"></a>03283 
<a name="l03284"></a>03284     <span class="keywordtype">string</span> strOutNymID;
<a name="l03285"></a>03285     <span class="keywordtype">bool</span> bDone = <a class="code" href="class_o_t___command.html#ac505b4024af6ef0ef48e21fd4696165b">details_import_nym</a>(strNymFile, strOutNymID);
<a name="l03286"></a>03286 
<a name="l03287"></a>03287     <span class="keywordflow">if</span> (!bDone)
<a name="l03288"></a>03288     {
<a name="l03289"></a>03289         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to import Nym.\n&quot;</span>);
<a name="l03290"></a>03290         <span class="keywordflow">return</span> -1;
<a name="l03291"></a>03291     }
<a name="l03292"></a>03292     <span class="keywordflow">else</span>
<a name="l03293"></a>03293     {
<a name="l03294"></a>03294         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS importing Nym: &quot;</span> + strOutNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03295"></a>03295         <span class="keywordflow">return</span> 1;
<a name="l03296"></a>03296     }
<a name="l03297"></a>03297 
<a name="l03298"></a>03298     <span class="keywordflow">return</span> -1;
<a name="l03299"></a>03299 }
<a name="l03300"></a>03300 
<a name="l03301"></a>03301 
<a name="l03302"></a><a class="code" href="class_o_t___command.html#afbd9c2bb302e81b170b50329d49eff17">03302</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#afbd9c2bb302e81b170b50329d49eff17">OT_Command::details_export_nym</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymID)
<a name="l03303"></a>03303 {
<a name="l03304"></a>03304     <span class="keywordtype">string</span> strExportedNym = <a class="code" href="class_o_t_a_p_i___wrap.html#ab1d3b1221c9cca145183943ea74a9d6c" title="Returns the exported Nym, if success. (Else NULL.)">OTAPI_Wrap::Wallet_ExportNym</a>(strNymID);
<a name="l03305"></a>03305 
<a name="l03306"></a>03306     <span class="keywordflow">return</span> strExportedNym;
<a name="l03307"></a>03307 }
<a name="l03308"></a>03308 
<a name="l03309"></a><a class="code" href="class_o_t___command.html#a56643df8fd7a941ecc025595c823068d">03309</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a56643df8fd7a941ecc025595c823068d">OT_Command::main_export_nym</a>()
<a name="l03310"></a>03310 {
<a name="l03311"></a>03311     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n USAGE: exportnym --mynym NYM_ID\n&quot;</span>;
<a name="l03312"></a>03312 
<a name="l03313"></a>03313     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03314"></a>03314 
<a name="l03315"></a>03315     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l03316"></a>03316     {
<a name="l03317"></a>03317         <span class="keywordtype">string</span> strExportedNym = <a class="code" href="class_o_t___command.html#afbd9c2bb302e81b170b50329d49eff17">details_export_nym</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l03318"></a>03318 
<a name="l03319"></a>03319         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strExportedNym))
<a name="l03320"></a>03320         {
<a name="l03321"></a>03321             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to export Nym: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03322"></a>03322             <span class="keywordflow">return</span> -1;
<a name="l03323"></a>03323         }
<a name="l03324"></a>03324         <span class="keywordflow">else</span>
<a name="l03325"></a>03325         {
<a name="l03326"></a>03326             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS exporting Nym: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l03327"></a>03327             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strExportedNym); <span class="comment">// stdout</span>
<a name="l03328"></a>03328             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l03329"></a>03329             <span class="keywordflow">return</span> 1;
<a name="l03330"></a>03330         }
<a name="l03331"></a>03331     }
<a name="l03332"></a>03332 
<a name="l03333"></a>03333     <span class="keywordflow">return</span> -1;
<a name="l03334"></a>03334 }
<a name="l03335"></a>03335 
<a name="l03336"></a>03336 
<a name="l03337"></a><a class="code" href="class_o_t___command.html#aedf4c2319fa62f58a220d84c439cff2f">03337</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aedf4c2319fa62f58a220d84c439cff2f">OT_Command::main_change_passphrase</a>()
<a name="l03338"></a>03338 {
<a name="l03339"></a>03339     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#aaad7304d22d1a970b63f4131275b7617">OTAPI_Wrap::Wallet_ChangePassphrase</a>())
<a name="l03340"></a>03340     {
<a name="l03341"></a>03341         <span class="keywordflow">return</span> 1;
<a name="l03342"></a>03342     }
<a name="l03343"></a>03343 
<a name="l03344"></a>03344     <span class="keywordflow">return</span> -1;
<a name="l03345"></a>03345 }
<a name="l03346"></a>03346 
<a name="l03347"></a>03347 
<a name="l03348"></a>03348 <span class="comment">//</span>
<a name="l03349"></a>03349 <span class="comment">// SEND TRANSFER (From one asset account to another.)</span>
<a name="l03350"></a>03350 <span class="comment">//</span>
<a name="l03351"></a>03351 
<a name="l03352"></a>03352 
<a name="l03353"></a><a class="code" href="class_o_t___command.html#a689b158944ffa41d75989c3754a2829a">03353</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a689b158944ffa41d75989c3754a2829a">OT_Command::details_send_transfer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strHisAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAmount, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNote)
<a name="l03354"></a>03354 {
<a name="l03355"></a>03355     <span class="comment">// Look up the NymID based on strMyAcctID</span>
<a name="l03356"></a>03356     <span class="comment">//</span>
<a name="l03357"></a>03357     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l03358"></a>03358 
<a name="l03359"></a>03359     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l03360"></a>03360     {
<a name="l03361"></a>03361         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID (for sender) based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l03362"></a>03362         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l03363"></a>03363         <span class="keywordflow">return</span> -1;
<a name="l03364"></a>03364     }
<a name="l03365"></a>03365     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> == strMyNymID))
<a name="l03366"></a>03366     {
<a name="l03367"></a>03367         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: MyNym was provided (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;), but didn&#39;t match the Nym who owns MyAcct. To override, use: --mynym &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03368"></a>03368         <span class="keywordflow">return</span> -1;
<a name="l03369"></a>03369     }
<a name="l03370"></a>03370 
<a name="l03371"></a>03371     <span class="comment">// Look up the ServerID based on strMyAcctID</span>
<a name="l03372"></a>03372     <span class="comment">//</span>
<a name="l03373"></a>03373     <span class="keywordtype">string</span> strMyServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l03374"></a>03374 
<a name="l03375"></a>03375     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyServerID))
<a name="l03376"></a>03376     {
<a name="l03377"></a>03377         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find ServerID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l03378"></a>03378         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l03379"></a>03379         <span class="keywordflow">return</span> -1;
<a name="l03380"></a>03380     }
<a name="l03381"></a>03381     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> == strMyServerID))
<a name="l03382"></a>03382     {
<a name="l03383"></a>03383         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Server was provided (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot;), but didn&#39;t match the Server where MyAcct is based. To override, use: --server &quot;</span> + strMyServerID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03384"></a>03384         <span class="keywordflow">return</span> -1;
<a name="l03385"></a>03385     }
<a name="l03386"></a>03386 
<a name="l03387"></a>03387     <span class="comment">// NEXT, we get the Server based on HIS account.</span>
<a name="l03388"></a>03388     <span class="comment">//</span>
<a name="l03389"></a>03389     <span class="comment">// That way, we can make sure both accounts are on the same server, before</span>
<a name="l03390"></a>03390     <span class="comment">// we go riding off into the sunset sending transfer requests to the server.</span>
<a name="l03391"></a>03391     <span class="comment">//</span>
<a name="l03392"></a>03392     <span class="keywordtype">string</span> strHisServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strHisAcctID);
<a name="l03393"></a>03393 
<a name="l03394"></a>03394     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisServerID))
<a name="l03395"></a>03395     {
<a name="l03396"></a>03396         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;HisAcct is not in the wallet, so I&#39;m assuming it&#39;s on the same server as MyAcct. (Proceeding.)\n&quot;</span>);
<a name="l03397"></a>03397 
<a name="l03398"></a>03398         strHisServerID = strMyServerID;
<a name="l03399"></a>03399     }
<a name="l03400"></a>03400 
<a name="l03401"></a>03401     <span class="keywordflow">if</span> (!(strMyServerID == strHisServerID))
<a name="l03402"></a>03402     {
<a name="l03403"></a>03403         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: HisAcct is not on the same server as MyAcct (he&#39;s on &quot;</span> + strHisServerID + <span class="stringliteral">&quot; but MyAcct is on &quot;</span> + strMyServerID + <span class="stringliteral">&quot;). You must choose either a different sender account (using --myacct ACCT_ID) or a different recipient account (using --hisacct ACCT_ID)\n\n&quot;</span>);
<a name="l03404"></a>03404         <span class="keywordflow">return</span> -1;
<a name="l03405"></a>03405     }
<a name="l03406"></a>03406     <span class="comment">// ***************************************************************</span>
<a name="l03407"></a>03407 
<a name="l03408"></a>03408     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcctID);
<a name="l03409"></a>03409 
<a name="l03410"></a>03410     <span class="comment">// HERE, WE SEND THE TRANSFER REQUEST TO THE SERVER</span>
<a name="l03411"></a>03411     <span class="comment">//</span>
<a name="l03412"></a>03412     int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount);
<a name="l03413"></a>03413     <span class="comment">//  int64_t lAmount = to_long(strAmount)</span>
<a name="l03414"></a>03414     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a1b7b8f9b17b7d193dd34255b6d9e64ae">MadeEasy::send_transfer</a>(strMyServerID, strMyNymID, strMyAcctID, strHisAcctID, lAmount, strNote);
<a name="l03415"></a>03415     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;send_transfer&quot;</span>;
<a name="l03416"></a>03416     <span class="comment">/*</span>
<a name="l03417"></a>03417 <span class="comment">    int32_t notarizeTransfer(   const std::string SERVER_ID,</span>
<a name="l03418"></a>03418 <span class="comment">    const std::string USER_ID,</span>
<a name="l03419"></a>03419 <span class="comment">    const std::string ACCT_FROM,</span>
<a name="l03420"></a>03420 <span class="comment">    const std::string ACCT_TO,</span>
<a name="l03421"></a>03421 <span class="comment">    const std::string AMOUNT,</span>
<a name="l03422"></a>03422 <span class="comment">    const std::string NOTE);</span>
<a name="l03423"></a>03423 <span class="comment">    */</span>
<a name="l03424"></a>03424     <span class="comment">// ***************************************************************</span>
<a name="l03425"></a>03425 
<a name="l03426"></a>03426     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l03427"></a>03427 
<a name="l03428"></a>03428     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strMyServerID, strMyNymID, strMyAcctID, strAttempt, strResponse);
<a name="l03429"></a>03429 
<a name="l03430"></a>03430     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l03431"></a>03431     {
<a name="l03432"></a>03432         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l03433"></a>03433         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l03434"></a>03434         <span class="comment">//</span>
<a name="l03435"></a>03435         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strMyServerID, strMyNymID, strMyAcctID, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l03436"></a>03436 
<a name="l03437"></a>03437         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS sending transfer!\n&quot;</span>);
<a name="l03438"></a>03438         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l03439"></a>03439     }
<a name="l03440"></a>03440 
<a name="l03441"></a>03441     <span class="comment">// ***************************************************************</span>
<a name="l03442"></a>03442     <span class="comment">//</span>
<a name="l03443"></a>03443     <span class="comment">// Return status to caller.</span>
<a name="l03444"></a>03444     <span class="comment">//</span>
<a name="l03445"></a>03445     <span class="keywordflow">return</span> nInterpretReply;
<a name="l03446"></a>03446 }
<a name="l03447"></a>03447 
<a name="l03448"></a>03448 
<a name="l03449"></a>03449 <span class="comment">// HERE, WE GET ALL THE ARGUMENTS TOGETHER,</span>
<a name="l03450"></a>03450 <span class="comment">// and then call the above function.</span>
<a name="l03451"></a>03451 <span class="comment">//</span>
<a name="l03452"></a><a class="code" href="class_o_t___command.html#aabf427fee615419d053a84d2ccb273df">03452</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aabf427fee615419d053a84d2ccb273df">OT_Command::main_transfer</a>()
<a name="l03453"></a>03453 {
<a name="l03454"></a>03454     <span class="keywordtype">string</span> strUsage1 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n  USAGE: transfer --myacct YOUR_ASSET_ACCT --hisacct RECIPIENT_ASSET_ACCT\n\n&quot;</span>,
<a name="l03455"></a>03455         <span class="stringliteral">&quot;Also NECESSARY: --args \&quot;amount PUT_AMOUNT_HERE\&quot;\n&quot;</span>);
<a name="l03456"></a>03456     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1,
<a name="l03457"></a>03457         <span class="stringliteral">&quot;And OPTIONALLY: --args \&quot;memo \\\&quot;Just a memo for the transfer.\\\&quot;\&quot;\n\n&quot;</span>);
<a name="l03458"></a>03458 
<a name="l03459"></a>03459     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03460"></a>03460 
<a name="l03461"></a>03461 
<a name="l03462"></a>03462     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisAcct&quot;</span>))
<a name="l03463"></a>03463     {
<a name="l03464"></a>03464         <span class="comment">// strAmount and strNote...</span>
<a name="l03465"></a>03465         <span class="comment">//</span>
<a name="l03466"></a>03466         <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l03467"></a>03467         <span class="keywordtype">string</span> strNote = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03468"></a>03468 
<a name="l03469"></a>03469         <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;10&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l03470"></a>03470         <span class="keywordtype">string</span> strDefaultNote = <span class="stringliteral">&quot;(blank memo field)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03471"></a>03471 
<a name="l03472"></a>03472         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l03473"></a>03473         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l03474"></a>03474         <span class="comment">// at the command line.</span>
<a name="l03475"></a>03475         <span class="comment">//</span>
<a name="l03476"></a>03476         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l03477"></a>03477         {
<a name="l03478"></a>03478             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03479"></a>03479             <span class="comment">//                                  const std::string str_key)</span>
<a name="l03480"></a>03480             <span class="comment">//</span>
<a name="l03481"></a>03481             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l03482"></a>03482             <span class="comment">// EXAMPLE:  --args &quot;amount 1&quot;</span>
<a name="l03483"></a>03483             <span class="comment">// EXAMPLE:  --args &quot;amount 15 note \&quot;Just a memo for the transfer.\&quot;&quot;</span>
<a name="l03484"></a>03484             <span class="comment">//</span>
<a name="l03485"></a>03485             <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>); <span class="comment">// any integer value</span>
<a name="l03486"></a>03486             <span class="keywordtype">string</span> strNewNote = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;memo&quot;</span>);     <span class="comment">// optional memo field</span>
<a name="l03487"></a>03487 
<a name="l03488"></a>03488 
<a name="l03489"></a>03489             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l03490"></a>03490             <span class="comment">//</span>
<a name="l03491"></a>03491             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount))
<a name="l03492"></a>03492             {
<a name="l03493"></a>03493                 strAmount = strNewAmount;
<a name="l03494"></a>03494             }
<a name="l03495"></a>03495             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewNote))
<a name="l03496"></a>03496             {
<a name="l03497"></a>03497                 strNote = strNewNote;
<a name="l03498"></a>03498             }
<a name="l03499"></a>03499         }
<a name="l03500"></a>03500 
<a name="l03501"></a>03501 
<a name="l03502"></a>03502         <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l03503"></a>03503 
<a name="l03504"></a>03504         <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l03505"></a>03505         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l03506"></a>03506         <span class="comment">//</span>
<a name="l03507"></a>03507         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l03508"></a>03508             <span class="comment">//      if (!VerifyStringVal(strAmount) || (to_int(strAmount) &lt; 1))</span>
<a name="l03509"></a>03509         {
<a name="l03510"></a>03510             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the amount[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03511"></a>03511             strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03512"></a>03512         }
<a name="l03513"></a>03513         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNote))
<a name="l03514"></a>03514         {
<a name="l03515"></a>03515             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a memo on a single line[&quot;</span> + strDefaultNote + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03516"></a>03516             strNote = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03517"></a>03517         }
<a name="l03518"></a>03518 
<a name="l03519"></a>03519         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l03520"></a>03520             <span class="comment">//      if (!VerifyStringVal(strAmount) || (to_int(strAmount) &lt; 1))</span>
<a name="l03521"></a>03521         {
<a name="l03522"></a>03522             strAmount = strDefaultAmount;
<a name="l03523"></a>03523         }
<a name="l03524"></a>03524         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNote))
<a name="l03525"></a>03525         {
<a name="l03526"></a>03526             strNote = strDefaultNote;
<a name="l03527"></a>03527         }
<a name="l03528"></a>03528 
<a name="l03529"></a>03529 
<a name="l03530"></a>03530         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a689b158944ffa41d75989c3754a2829a">details_send_transfer</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>, strAmount, strNote);
<a name="l03531"></a>03531     }
<a name="l03532"></a>03532 
<a name="l03533"></a>03533     <span class="keywordflow">return</span> -1;
<a name="l03534"></a>03534 }
<a name="l03535"></a>03535 
<a name="l03536"></a>03536 
<a name="l03537"></a>03537 <span class="comment">// SET NAME!!</span>
<a name="l03538"></a>03538 
<a name="l03539"></a>03539 
<a name="l03540"></a><a class="code" href="class_o_t___command.html#aa7fe5b171eaf259479144ad43573238b">03540</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa7fe5b171eaf259479144ad43573238b">OT_Command::main_edit_nym</a>()
<a name="l03541"></a>03541 {
<a name="l03542"></a>03542     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n USAGE: editnym --mynym YOUR_NYM_ID\n&quot;</span>,
<a name="l03543"></a>03543         <span class="stringliteral">&quot;Also optionally:         --args \&quot;label \\\&quot;PUT LABEL HERE\\\&quot;\&quot;\n&quot;</span>);
<a name="l03544"></a>03544 
<a name="l03545"></a>03545     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03546"></a>03546 
<a name="l03547"></a>03547 
<a name="l03548"></a>03548     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l03549"></a>03549     {
<a name="l03550"></a>03550         <span class="keywordtype">string</span> strLabel = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03551"></a>03551 
<a name="l03552"></a>03552         <span class="keywordtype">string</span> strDefaultLabel = <span class="stringliteral">&quot;(blank label)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03553"></a>03553 
<a name="l03554"></a>03554         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l03555"></a>03555         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l03556"></a>03556         <span class="comment">// at the command line.</span>
<a name="l03557"></a>03557         <span class="comment">//</span>
<a name="l03558"></a>03558         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l03559"></a>03559         {
<a name="l03560"></a>03560             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03561"></a>03561             <span class="comment">//                                  const std::string str_key)</span>
<a name="l03562"></a>03562             <span class="comment">//</span>
<a name="l03563"></a>03563             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l03564"></a>03564             <span class="comment">// EXAMPLE:  --args &quot;label \&quot;FT&#39;s test Nym\&quot;&quot;</span>
<a name="l03565"></a>03565             <span class="comment">//</span>
<a name="l03566"></a>03566             <span class="keywordtype">string</span> strNewLabel = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;label&quot;</span>);  <span class="comment">// optional label field</span>
<a name="l03567"></a>03567 
<a name="l03568"></a>03568             <span class="comment">// Set the value based on the custom argument.</span>
<a name="l03569"></a>03569             <span class="comment">//</span>
<a name="l03570"></a>03570             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLabel))
<a name="l03571"></a>03571             {
<a name="l03572"></a>03572                 strLabel = strNewLabel;
<a name="l03573"></a>03573             }
<a name="l03574"></a>03574         }
<a name="l03575"></a>03575 
<a name="l03576"></a>03576         <span class="comment">// If the label isn&#39;t provided, then we ask the</span>
<a name="l03577"></a>03577         <span class="comment">// user to supply it at the command line.</span>
<a name="l03578"></a>03578         <span class="comment">//</span>
<a name="l03579"></a>03579         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03580"></a>03580         {
<a name="l03581"></a>03581             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter MyNym&#39;s new label [&quot;</span> + strDefaultLabel + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03582"></a>03582             strLabel = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03583"></a>03583         }
<a name="l03584"></a>03584 
<a name="l03585"></a>03585         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03586"></a>03586         {
<a name="l03587"></a>03587             strLabel = strDefaultLabel;
<a name="l03588"></a>03588         }
<a name="l03589"></a>03589 
<a name="l03590"></a>03590 
<a name="l03591"></a>03591         <span class="keywordtype">bool</span> bSet = <a class="code" href="class_o_t_a_p_i___wrap.html#a0bc26e4cc6158477c32eaf0aabcc83a1">OTAPI_Wrap::SetNym_Name</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strLabel);
<a name="l03592"></a>03592 
<a name="l03593"></a>03593         <span class="keywordflow">if</span> (!bSet)
<a name="l03594"></a>03594         {
<a name="l03595"></a>03595             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to set MyNym&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03596"></a>03596             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyNym ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03597"></a>03597             <span class="keywordflow">return</span> -1;
<a name="l03598"></a>03598         }
<a name="l03599"></a>03599         <span class="keywordflow">else</span>
<a name="l03600"></a>03600         {
<a name="l03601"></a>03601             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS setting MyNym&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03602"></a>03602             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyNym ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03603"></a>03603             <span class="keywordflow">return</span> 1;
<a name="l03604"></a>03604         }
<a name="l03605"></a>03605     }
<a name="l03606"></a>03606 
<a name="l03607"></a>03607     <span class="keywordflow">return</span> -1;
<a name="l03608"></a>03608 }
<a name="l03609"></a>03609 
<a name="l03610"></a>03610 
<a name="l03611"></a><a class="code" href="class_o_t___command.html#a16f78c92d600a8626b5728949e334b90">03611</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a16f78c92d600a8626b5728949e334b90">OT_Command::main_edit_account</a>()
<a name="l03612"></a>03612 {
<a name="l03613"></a>03613     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n USAGE: editacct --myacct YOUR_ACCT_ID\n&quot;</span>,
<a name="l03614"></a>03614         <span class="stringliteral">&quot;Also optionally:          --args \&quot;label \\\&quot;PUT LABEL HERE\\\&quot;\&quot;\n&quot;</span>);
<a name="l03615"></a>03615 
<a name="l03616"></a>03616     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03617"></a>03617 
<a name="l03618"></a>03618 
<a name="l03619"></a>03619     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l03620"></a>03620     {
<a name="l03621"></a>03621 
<a name="l03622"></a>03622         <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l03623"></a>03623         <span class="comment">//</span>
<a name="l03624"></a>03624         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l03625"></a>03625 
<a name="l03626"></a>03626         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l03627"></a>03627         {
<a name="l03628"></a>03628             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l03629"></a>03629             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l03630"></a>03630             <span class="keywordflow">return</span> -1;
<a name="l03631"></a>03631         }
<a name="l03632"></a>03632         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> == strMyNymID))
<a name="l03633"></a>03633         {
<a name="l03634"></a>03634             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: MyNym was provided, but didn&#39;t match the Nym who owns MyAcct. To override, use: --mynym &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03635"></a>03635             <span class="keywordflow">return</span> -1;
<a name="l03636"></a>03636         }
<a name="l03637"></a>03637         <span class="comment">// ***************************************************************</span>
<a name="l03638"></a>03638         <span class="comment">//</span>
<a name="l03639"></a>03639         <span class="keywordtype">string</span> strLabel = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03640"></a>03640 
<a name="l03641"></a>03641         <span class="keywordtype">string</span> strDefaultLabel = <span class="stringliteral">&quot;(blank label)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03642"></a>03642 
<a name="l03643"></a>03643         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l03644"></a>03644         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l03645"></a>03645         <span class="comment">// at the command line.</span>
<a name="l03646"></a>03646         <span class="comment">//</span>
<a name="l03647"></a>03647         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l03648"></a>03648         {
<a name="l03649"></a>03649             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03650"></a>03650             <span class="comment">//                                  const std::string str_key)</span>
<a name="l03651"></a>03651             <span class="comment">//</span>
<a name="l03652"></a>03652             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l03653"></a>03653             <span class="comment">// EXAMPLE:  --args &quot;label \&quot;FT&#39;s issuer account\&quot;&quot;</span>
<a name="l03654"></a>03654             <span class="comment">//</span>
<a name="l03655"></a>03655             <span class="keywordtype">string</span> strNewLabel = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;label&quot;</span>);  <span class="comment">// optional label field</span>
<a name="l03656"></a>03656 
<a name="l03657"></a>03657             <span class="comment">// Set the value based on the custom argument.</span>
<a name="l03658"></a>03658             <span class="comment">//</span>
<a name="l03659"></a>03659             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLabel))
<a name="l03660"></a>03660             {
<a name="l03661"></a>03661                 strLabel = strNewLabel;
<a name="l03662"></a>03662             }
<a name="l03663"></a>03663         }
<a name="l03664"></a>03664 
<a name="l03665"></a>03665         <span class="comment">// If the label isn&#39;t provided, then we ask the</span>
<a name="l03666"></a>03666         <span class="comment">// user to supply it at the command line.</span>
<a name="l03667"></a>03667         <span class="comment">//</span>
<a name="l03668"></a>03668         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03669"></a>03669         {
<a name="l03670"></a>03670             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter MyAcct&#39;s new label [&quot;</span> + strDefaultLabel + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03671"></a>03671             strLabel = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03672"></a>03672         }
<a name="l03673"></a>03673 
<a name="l03674"></a>03674         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03675"></a>03675         {
<a name="l03676"></a>03676             strLabel = strDefaultLabel;
<a name="l03677"></a>03677         }
<a name="l03678"></a>03678 
<a name="l03679"></a>03679 
<a name="l03680"></a>03680         <span class="keywordtype">bool</span> bSet = <a class="code" href="class_o_t_a_p_i___wrap.html#a46b40c08d572c004a11f191227747405">OTAPI_Wrap::SetAccountWallet_Name</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strMyNymID, strLabel);
<a name="l03681"></a>03681 
<a name="l03682"></a>03682         <span class="keywordflow">if</span> (!bSet)
<a name="l03683"></a>03683         {
<a name="l03684"></a>03684             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to set MyAcct&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03685"></a>03685             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyAcct ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03686"></a>03686             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot; MyNym ID: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03687"></a>03687             <span class="keywordflow">return</span> -1;
<a name="l03688"></a>03688         }
<a name="l03689"></a>03689         <span class="keywordflow">else</span>
<a name="l03690"></a>03690         {
<a name="l03691"></a>03691             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS setting MyAcct&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03692"></a>03692             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyAcct ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03693"></a>03693             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot; MyNym ID: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03694"></a>03694             <span class="keywordflow">return</span> 1;
<a name="l03695"></a>03695         }
<a name="l03696"></a>03696     }
<a name="l03697"></a>03697 
<a name="l03698"></a>03698     <span class="keywordflow">return</span> -1;
<a name="l03699"></a>03699 }
<a name="l03700"></a>03700 
<a name="l03701"></a>03701 
<a name="l03702"></a><a class="code" href="class_o_t___command.html#ab362c667a717fa913f0d47fa5e5558f2">03702</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab362c667a717fa913f0d47fa5e5558f2">OT_Command::main_edit_asset</a>()
<a name="l03703"></a>03703 {
<a name="l03704"></a>03704     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n USAGE: editasset --mypurse ASSET_TYPE_ID\n&quot;</span>,
<a name="l03705"></a>03705         <span class="stringliteral">&quot;Also optionally:           --args \&quot;label \\\&quot;PUT LABEL HERE\\\&quot;\&quot;\n&quot;</span>);
<a name="l03706"></a>03706 
<a name="l03707"></a>03707     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03708"></a>03708 
<a name="l03709"></a>03709 
<a name="l03710"></a>03710     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>))
<a name="l03711"></a>03711     {
<a name="l03712"></a>03712         <span class="keywordtype">string</span> strLabel = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03713"></a>03713 
<a name="l03714"></a>03714         <span class="keywordtype">string</span> strDefaultLabel = <span class="stringliteral">&quot;(blank label)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03715"></a>03715 
<a name="l03716"></a>03716         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l03717"></a>03717         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l03718"></a>03718         <span class="comment">// at the command line.</span>
<a name="l03719"></a>03719         <span class="comment">//</span>
<a name="l03720"></a>03720         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l03721"></a>03721         {
<a name="l03722"></a>03722             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03723"></a>03723             <span class="comment">//                                  const std::string str_key)</span>
<a name="l03724"></a>03724             <span class="comment">//</span>
<a name="l03725"></a>03725             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l03726"></a>03726             <span class="comment">// EXAMPLE:  --args &quot;label \&quot;Silver Grams\&quot;&quot;</span>
<a name="l03727"></a>03727             <span class="comment">//</span>
<a name="l03728"></a>03728             <span class="keywordtype">string</span> strNewLabel = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;label&quot;</span>);  <span class="comment">// optional label field</span>
<a name="l03729"></a>03729 
<a name="l03730"></a>03730             <span class="comment">// Set the value based on the custom argument.</span>
<a name="l03731"></a>03731             <span class="comment">//</span>
<a name="l03732"></a>03732             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLabel))
<a name="l03733"></a>03733             {
<a name="l03734"></a>03734                 strLabel = strNewLabel;
<a name="l03735"></a>03735             }
<a name="l03736"></a>03736         }
<a name="l03737"></a>03737 
<a name="l03738"></a>03738         <span class="comment">// If the label isn&#39;t provided, then we ask the</span>
<a name="l03739"></a>03739         <span class="comment">// user to supply it at the command line.</span>
<a name="l03740"></a>03740         <span class="comment">//</span>
<a name="l03741"></a>03741         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03742"></a>03742         {
<a name="l03743"></a>03743             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter MyPurse&#39;s new label [&quot;</span> + strDefaultLabel + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03744"></a>03744             strLabel = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03745"></a>03745         }
<a name="l03746"></a>03746 
<a name="l03747"></a>03747         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03748"></a>03748         {
<a name="l03749"></a>03749             strLabel = strDefaultLabel;
<a name="l03750"></a>03750         }
<a name="l03751"></a>03751 
<a name="l03752"></a>03752 
<a name="l03753"></a>03753         <span class="keywordtype">bool</span> bSet = <a class="code" href="class_o_t_a_p_i___wrap.html#a6f4535f05b4c9ea0b41e7564b5e3b1d2">OTAPI_Wrap::SetAssetType_Name</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strLabel);
<a name="l03754"></a>03754 
<a name="l03755"></a>03755         <span class="keywordflow">if</span> (!bSet)
<a name="l03756"></a>03756         {
<a name="l03757"></a>03757             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to set MyPurse&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03758"></a>03758             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyPurse (AssetTypeID): &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03759"></a>03759             <span class="keywordflow">return</span> -1;
<a name="l03760"></a>03760         }
<a name="l03761"></a>03761         <span class="keywordflow">else</span>
<a name="l03762"></a>03762         {
<a name="l03763"></a>03763             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS setting MyPurse&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03764"></a>03764             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;MyPurse (AssetTypeID): &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03765"></a>03765             <span class="keywordflow">return</span> 1;
<a name="l03766"></a>03766         }
<a name="l03767"></a>03767     }
<a name="l03768"></a>03768 
<a name="l03769"></a>03769     <span class="keywordflow">return</span> -1;
<a name="l03770"></a>03770 }
<a name="l03771"></a>03771 
<a name="l03772"></a>03772 
<a name="l03773"></a><a class="code" href="class_o_t___command.html#af5537ff1edcdd81b0089af8992cdf842">03773</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af5537ff1edcdd81b0089af8992cdf842">OT_Command::main_edit_server</a>()
<a name="l03774"></a>03774 {
<a name="l03775"></a>03775     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n USAGE: editserver --server SERVER_ID\n&quot;</span>,
<a name="l03776"></a>03776         <span class="stringliteral">&quot;Also optionally:            --args \&quot;label \\\&quot;PUT LABEL HERE\\\&quot;\&quot;\n&quot;</span>);
<a name="l03777"></a>03777 
<a name="l03778"></a>03778     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03779"></a>03779 
<a name="l03780"></a>03780 
<a name="l03781"></a>03781     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l03782"></a>03782     {
<a name="l03783"></a>03783         <span class="keywordtype">string</span> strLabel = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03784"></a>03784 
<a name="l03785"></a>03785         <span class="keywordtype">string</span> strDefaultLabel = <span class="stringliteral">&quot;(blank label)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l03786"></a>03786 
<a name="l03787"></a>03787         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l03788"></a>03788         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l03789"></a>03789         <span class="comment">// at the command line.</span>
<a name="l03790"></a>03790         <span class="comment">//</span>
<a name="l03791"></a>03791         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l03792"></a>03792         {
<a name="l03793"></a>03793             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03794"></a>03794             <span class="comment">//                                  const std::string str_key)</span>
<a name="l03795"></a>03795             <span class="comment">//</span>
<a name="l03796"></a>03796             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l03797"></a>03797             <span class="comment">// EXAMPLE:  --args &quot;label \&quot;localhost server\&quot;&quot;</span>
<a name="l03798"></a>03798             <span class="comment">//</span>
<a name="l03799"></a>03799             <span class="keywordtype">string</span> strNewLabel = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;label&quot;</span>);  <span class="comment">// optional label field</span>
<a name="l03800"></a>03800 
<a name="l03801"></a>03801             <span class="comment">// Set the value based on the custom argument.</span>
<a name="l03802"></a>03802             <span class="comment">//</span>
<a name="l03803"></a>03803             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLabel))
<a name="l03804"></a>03804             {
<a name="l03805"></a>03805                 strLabel = strNewLabel;
<a name="l03806"></a>03806             }
<a name="l03807"></a>03807         }
<a name="l03808"></a>03808 
<a name="l03809"></a>03809         <span class="comment">// If the label isn&#39;t provided, then we ask the</span>
<a name="l03810"></a>03810         <span class="comment">// user to supply it at the command line.</span>
<a name="l03811"></a>03811         <span class="comment">//</span>
<a name="l03812"></a>03812         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03813"></a>03813         {
<a name="l03814"></a>03814             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter Server&#39;s new label [&quot;</span> + strDefaultLabel + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l03815"></a>03815             strLabel = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l03816"></a>03816         }
<a name="l03817"></a>03817 
<a name="l03818"></a>03818         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLabel))
<a name="l03819"></a>03819         {
<a name="l03820"></a>03820             strLabel = strDefaultLabel;
<a name="l03821"></a>03821         }
<a name="l03822"></a>03822 
<a name="l03823"></a>03823 
<a name="l03824"></a>03824         <span class="keywordtype">bool</span> bSet = <a class="code" href="class_o_t_a_p_i___wrap.html#a67973605270af89fcb437f6144f68aaf">OTAPI_Wrap::SetServer_Name</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strLabel);
<a name="l03825"></a>03825 
<a name="l03826"></a>03826         <span class="keywordflow">if</span> (!bSet)
<a name="l03827"></a>03827         {
<a name="l03828"></a>03828             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILED trying to set Server&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03829"></a>03829             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03830"></a>03830             <span class="keywordflow">return</span> -1;
<a name="l03831"></a>03831         }
<a name="l03832"></a>03832         <span class="keywordflow">else</span>
<a name="l03833"></a>03833         {
<a name="l03834"></a>03834             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS setting Server&#39;s label to: &quot;</span> + strLabel + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03835"></a>03835             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03836"></a>03836             <span class="keywordflow">return</span> 1;
<a name="l03837"></a>03837         }
<a name="l03838"></a>03838     }
<a name="l03839"></a>03839 
<a name="l03840"></a>03840     <span class="keywordflow">return</span> -1;
<a name="l03841"></a>03841 }
<a name="l03842"></a>03842 
<a name="l03843"></a>03843 
<a name="l03844"></a><a class="code" href="class_o_t___command.html#a10f5c0327b539952ed0ca66fe1146ff4">03844</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a10f5c0327b539952ed0ca66fe1146ff4">OT_Command::main_sendmsg</a>()
<a name="l03845"></a>03845 {
<a name="l03846"></a>03846     <span class="comment">// Just to show how easy it is, let&#39;s try a &quot;send_user_message&quot; message.</span>
<a name="l03847"></a>03847     <span class="comment">//</span>
<a name="l03848"></a>03848     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n FYI, USAGE: sendmsg --mynym &lt;YOUR_NYM_ID&gt; --hisnym &lt;RECIPIENT_NYM_ID&gt;\n\n&quot;</span>;
<a name="l03849"></a>03849 
<a name="l03850"></a>03850     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l03851"></a>03851 
<a name="l03852"></a>03852     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>))
<a name="l03853"></a>03853     {
<a name="l03854"></a>03854         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter your message on multiple lines, optionally beginning with a \&quot;Subject: \&quot; line.\n&quot;</span>);
<a name="l03855"></a>03855         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Use Ctrl-C to cancel, otherwise finish your message with an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l03856"></a>03856 
<a name="l03857"></a>03857         <span class="keywordtype">string</span> strMessage = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l03858"></a>03858 
<a name="l03859"></a>03859         <span class="comment">// Send the request.</span>
<a name="l03860"></a>03860         <span class="comment">//</span>
<a name="l03861"></a>03861         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a0ac863c8d07739cd08d16eaec082250b">MadeEasy::send_user_msg</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, strMessage);
<a name="l03862"></a>03862 
<a name="l03863"></a>03863         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l03864"></a>03864         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l03865"></a>03865         <span class="comment">// handled at a lower level!</span>
<a name="l03866"></a>03866         <span class="comment">//</span>
<a name="l03867"></a>03867         <span class="comment">// Instead, simply check for success or failure:</span>
<a name="l03868"></a>03868         <span class="comment">//</span>
<a name="l03869"></a>03869         <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l03870"></a>03870         {
<a name="l03871"></a>03871             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;send_user_msg: Failed.\n&quot;</span>);
<a name="l03872"></a>03872         }
<a name="l03873"></a>03873         <span class="keywordflow">else</span>
<a name="l03874"></a>03874         {
<a name="l03875"></a>03875             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in send_user_msg! Server response:\n\n&quot;</span>);
<a name="l03876"></a>03876             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l03877"></a>03877             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSuccess in send_user_msg.\n\n&quot;</span>);
<a name="l03878"></a>03878             <span class="keywordflow">return</span> 1;
<a name="l03879"></a>03879         }
<a name="l03880"></a>03880     }
<a name="l03881"></a>03881 
<a name="l03882"></a>03882     <span class="keywordflow">return</span> -1;
<a name="l03883"></a>03883 }
<a name="l03884"></a>03884 
<a name="l03885"></a>03885 
<a name="l03886"></a><a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">03886</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">OT_Command::details_write_cheque</a>(<span class="keywordtype">string</span> &amp; strCheque, <span class="keyword">const</span> <span class="keywordtype">bool</span> bIsInvoice) <span class="comment">// strCheque is output.</span>
<a name="l03887"></a>03887 {
<a name="l03888"></a>03888     <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l03889"></a>03889 
<a name="l03890"></a>03890     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l03891"></a>03891     {
<a name="l03892"></a>03892 
<a name="l03893"></a>03893         <span class="comment">// Look up the NymID based on MyAcct</span>
<a name="l03894"></a>03894         <span class="comment">//</span>
<a name="l03895"></a>03895         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l03896"></a>03896 
<a name="l03897"></a>03897         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l03898"></a>03898         {
<a name="l03899"></a>03899             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID (for sender) based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l03900"></a>03900             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l03901"></a>03901             <span class="keywordflow">return</span> -1;
<a name="l03902"></a>03902         }
<a name="l03903"></a>03903         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> == strMyNymID))
<a name="l03904"></a>03904         {
<a name="l03905"></a>03905             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: MyNym was provided (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;), but didn&#39;t match the Nym who owns MyAcct. To override, use: --mynym &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03906"></a>03906             <span class="keywordflow">return</span> -1;
<a name="l03907"></a>03907         }
<a name="l03908"></a>03908 
<a name="l03909"></a>03909         <span class="comment">// Look up the ServerID based on MyAcct</span>
<a name="l03910"></a>03910         <span class="comment">//</span>
<a name="l03911"></a>03911         <span class="keywordtype">string</span> strMyServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l03912"></a>03912 
<a name="l03913"></a>03913         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyServerID))
<a name="l03914"></a>03914         {
<a name="l03915"></a>03915             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find ServerID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l03916"></a>03916             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l03917"></a>03917             <span class="keywordflow">return</span> -1;
<a name="l03918"></a>03918         }
<a name="l03919"></a>03919         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> == strMyServerID))
<a name="l03920"></a>03920         {
<a name="l03921"></a>03921             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Server was provided (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot;), but didn&#39;t match the Server where MyAcct is based. To override, use: --server &quot;</span> + strMyServerID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l03922"></a>03922             <span class="keywordflow">return</span> -1;
<a name="l03923"></a>03923         }
<a name="l03924"></a>03924         <span class="comment">// ***************************************************************</span>
<a name="l03925"></a>03925         <span class="comment">//</span>
<a name="l03926"></a>03926         <span class="comment">// When we pass in HisNym at the command line, using this option:  --hisnym HIS_NYM_ID</span>
<a name="l03927"></a>03927         <span class="comment">// then OT internally TRIES to look it up on the wallet (and someday on the address</span>
<a name="l03928"></a>03928         <span class="comment">// book as well) in abbreviated or name form, in order to substitute it with the ACTUAL</span>
<a name="l03929"></a>03929         <span class="comment">// full NymID, before passing it into the script where we are now. If nothing is found,</span>
<a name="l03930"></a>03930         <span class="comment">// then it just passes through the ID so we have a chance to download the pubkey and</span>
<a name="l03931"></a>03931         <span class="comment">// verify that it actually exists.</span>
<a name="l03932"></a>03932         <span class="comment">//</span>
<a name="l03933"></a>03933         <span class="comment">// Therefore, if the full &quot;HisNym&quot; ID hasn&#39;t ALREADY been found by now, that means we</span>
<a name="l03934"></a>03934         <span class="comment">// already couldn&#39;t find it via abbreviation or name, and therefore we will HAVE to download</span>
<a name="l03935"></a>03935         <span class="comment">// it from the server since we don&#39;t have it already. (And therefore we will NEED to know the</span>
<a name="l03936"></a>03936         <span class="comment">// FULL ID, since we cannot download a pubkey from a server based on a partial ID.)</span>
<a name="l03937"></a>03937         <span class="comment">//</span>
<a name="l03938"></a>03938         <span class="comment">// The point is that when we get here, there&#39;s no need to worry about searching for a partial</span>
<a name="l03939"></a>03939         <span class="comment">// or abbreviated version, and no need to ask load_or_retrieve_pubkey to somehow translate HisNym</span>
<a name="l03940"></a>03940         <span class="comment">// to a full ID. That would have already happened by now, if one were available. So at this point</span>
<a name="l03941"></a>03941         <span class="comment">// we basically have to assume the user passed the full and correct ID, and if it&#39;s not in the</span>
<a name="l03942"></a>03942         <span class="comment">// wallet already, then load_or_retrieve_pubkey can go ahead and try to download it as if it is</span>
<a name="l03943"></a>03943         <span class="comment">// the full and correct ID. If it fails, it fails.</span>
<a name="l03944"></a>03944         <span class="comment">//</span>
<a name="l03945"></a>03945         <span class="keywordtype">string</span> strRecipientPubkey = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03946"></a>03946         <span class="keywordtype">string</span> strHisNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03947"></a>03947 
<a name="l03948"></a>03948         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>, <span class="keyword">false</span>))
<a name="l03949"></a>03949         {
<a name="l03950"></a>03950             strRecipientPubkey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">MadeEasy::load_or_retrieve_encrypt_key</a>(strMyServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>);
<a name="l03951"></a>03951             <span class="comment">// Note: even thogh send_user_payment already calls load_or_retrieve_pubkey, we do it</span>
<a name="l03952"></a>03952             <span class="comment">// here anyway, BEFORE trying to write the cheque. (No point writing a cheque to HisNym until</span>
<a name="l03953"></a>03953             <span class="comment">// we&#39;re sure it&#39;s real...)</span>
<a name="l03954"></a>03954             <span class="comment">//</span>
<a name="l03955"></a>03955             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientPubkey))
<a name="l03956"></a>03956             {
<a name="l03957"></a>03957                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to load or download pubkey for HisNym based on given value (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a> + <span class="stringliteral">&quot;). To override, use: --hisnym HIS_NYM_ID\n\n&quot;</span>);
<a name="l03958"></a>03958                 <span class="keywordflow">return</span> -1;
<a name="l03959"></a>03959             }
<a name="l03960"></a>03960 
<a name="l03961"></a>03961             strHisNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>;
<a name="l03962"></a>03962         }
<a name="l03963"></a>03963 
<a name="l03964"></a>03964         <span class="comment">// Make sure we have at least one transaction number (to write the cheque...)</span>
<a name="l03965"></a>03965         <span class="comment">//</span>
<a name="l03966"></a>03966         <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(10, strMyServerID, strMyNymID))
<a name="l03967"></a>03967         {
<a name="l03968"></a>03968             <span class="keywordflow">return</span> -1;
<a name="l03969"></a>03969         }
<a name="l03970"></a>03970 
<a name="l03971"></a>03971         <span class="comment">// - At this point we have MyAcct writing a cheque to HisNym.</span>
<a name="l03972"></a>03972         <span class="comment">// - We have strMyServerID and strMyNymID and we know they match MyAcct.</span>
<a name="l03973"></a>03973         <span class="comment">// (And we know they match --server and --mynym as well, otherwise the</span>
<a name="l03974"></a>03974         <span class="comment">// user would have been be forced to override at the command line before</span>
<a name="l03975"></a>03975         <span class="comment">// allowing him to continue.)</span>
<a name="l03976"></a>03976         <span class="comment">// - We know that HisNym is a valid enough ID that we were able to load</span>
<a name="l03977"></a>03977         <span class="comment">// his public key, or download it and THEN load it up. By this point it was</span>
<a name="l03978"></a>03978         <span class="comment">// successful either way.</span>
<a name="l03979"></a>03979         <span class="comment">// - We know that the Nym has at least 1 valid transaction number, with</span>
<a name="l03980"></a>03980         <span class="comment">// which to write the cheque. (If he didn&#39;t, we would have downloaded it in</span>
<a name="l03981"></a>03981         <span class="comment">// the above block.)</span>
<a name="l03982"></a>03982         <span class="comment">// - Therefore let&#39;s collect all the other cheque-related data, and write</span>
<a name="l03983"></a>03983         <span class="comment">// the actual cheque, and return it to the caller.</span>
<a name="l03984"></a>03984 
<a name="l03985"></a>03985         <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// smallest possible amount.</span>
<a name="l03986"></a>03986         <span class="keywordtype">string</span> strDefaultMemo = <span class="stringliteral">&quot;(memo field)&quot;</span>;
<a name="l03987"></a>03987         int64_t nDefaultLength = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="_o_t_common_8hpp.html#af04aead93a0e4b740d061e043c26c601">OT_TIME_MONTH_IN_SECONDS</a>);   <span class="comment">// 30 days</span>
<a name="l03988"></a>03988 
<a name="l03989"></a>03989         <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>;
<a name="l03990"></a>03990         <span class="keywordtype">string</span> strMemo = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// empty</span>
<a name="l03991"></a>03991         int64_t nLength = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>);
<a name="l03992"></a>03992 
<a name="l03993"></a>03993 
<a name="l03994"></a>03994         <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l03995"></a>03995 
<a name="l03996"></a>03996         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l03997"></a>03997         {
<a name="l03998"></a>03998             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l03999"></a>03999             <span class="comment">//                                  const std::string str_key)</span>
<a name="l04000"></a>04000             <span class="comment">//</span>
<a name="l04001"></a>04001             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l04002"></a>04002             <span class="comment">// EXAMPLE:  --args &quot;amount 100 memo \&quot;my share for the BBQ\&quot;&quot;</span>
<a name="l04003"></a>04003             <span class="comment">//</span>
<a name="l04004"></a>04004             <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>);
<a name="l04005"></a>04005             <span class="keywordtype">string</span> strNewMemo = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;memo&quot;</span>);
<a name="l04006"></a>04006             <span class="keywordtype">string</span> strNewLength = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;validfor&quot;</span>);
<a name="l04007"></a>04007 
<a name="l04008"></a>04008             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMemo))
<a name="l04009"></a>04009             {
<a name="l04010"></a>04010                 strMemo = strNewMemo;
<a name="l04011"></a>04011             }
<a name="l04012"></a>04012 
<a name="l04013"></a>04013             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount) &amp;&amp; (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strNewAmount) &gt; 0))
<a name="l04014"></a>04014                 <span class="comment">//          if (VerifyStringVal(strNewAmount) &amp;&amp; (to_int(strNewAmount) &gt; 0))</span>
<a name="l04015"></a>04015             {
<a name="l04016"></a>04016                 strAmount = strNewAmount;
<a name="l04017"></a>04017             }
<a name="l04018"></a>04018 
<a name="l04019"></a>04019             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLength) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strNewLength) &gt; 0))
<a name="l04020"></a>04020             {
<a name="l04021"></a>04021                 nLength = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strNewLength);
<a name="l04022"></a>04022             }
<a name="l04023"></a>04023         }
<a name="l04024"></a>04024 
<a name="l04025"></a>04025 
<a name="l04026"></a>04026         <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l04027"></a>04027         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l04028"></a>04028         <span class="comment">//</span>
<a name="l04029"></a>04029         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l04030"></a>04030         {
<a name="l04031"></a>04031             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the amount[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04032"></a>04032             strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04033"></a>04033         }
<a name="l04034"></a>04034         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l04035"></a>04035         {
<a name="l04036"></a>04036             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a note on a single line[&quot;</span> + strDefaultMemo + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04037"></a>04037             strMemo = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04038"></a>04038         }
<a name="l04039"></a>04039         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nLength) || (nLength &lt; 1))
<a name="l04040"></a>04040         {
<a name="l04041"></a>04041             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the &#39;valid for&#39; time period, in seconds (default is 30 days.) [&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nDefaultLength) + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04042"></a>04042             <span class="keywordtype">string</span> strTemp = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04043"></a>04043 
<a name="l04044"></a>04044             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTemp) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strTemp) &gt; 0))
<a name="l04045"></a>04045             {
<a name="l04046"></a>04046                 nLength = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strTemp);
<a name="l04047"></a>04047             }
<a name="l04048"></a>04048         }
<a name="l04049"></a>04049 
<a name="l04050"></a>04050         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l04051"></a>04051         {
<a name="l04052"></a>04052             strAmount = strDefaultAmount;
<a name="l04053"></a>04053         }
<a name="l04054"></a>04054 
<a name="l04055"></a>04055         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l04056"></a>04056         {
<a name="l04057"></a>04057             strMemo = strDefaultMemo;
<a name="l04058"></a>04058         }
<a name="l04059"></a>04059 
<a name="l04060"></a>04060         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nLength) || (nLength &lt; 1))
<a name="l04061"></a>04061         {
<a name="l04062"></a>04062             nLength = nDefaultLength;
<a name="l04063"></a>04063         }
<a name="l04064"></a>04064 
<a name="l04065"></a>04065 
<a name="l04066"></a>04066         <span class="comment">// Todo: use Args feature here to allow an option to override nLength.</span>
<a name="l04067"></a>04067         <span class="comment">// If it&#39;s not used, go with the default of 30 days (above.)</span>
<a name="l04068"></a>04068 
<a name="l04069"></a>04069         <span class="keywordtype">string</span> strLength = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nLength);
<a name="l04070"></a>04070 
<a name="l04071"></a>04071         <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tFrom = <a class="code" href="class_o_t_a_p_i___wrap.html#abf13a18a258717c8e92bb7b28f368a1c">OTAPI_Wrap::GetTime</a>();
<a name="l04072"></a>04072         int64_t tLength = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strLength);
<a name="l04073"></a>04073         <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tTo = <a class="code" href="_o_t_common_8hpp.html#a38e4e4253c3dd158ea40e6312586e6c9">OTTimeAddTimeInterval</a>(tFrom, tLength);
<a name="l04074"></a>04074 
<a name="l04075"></a>04075         <span class="keywordflow">if</span> (bIsInvoice)
<a name="l04076"></a>04076         {
<a name="l04077"></a>04077             int64_t lTempAmount = (int64_t(-1) * <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount));
<a name="l04078"></a>04078             strAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lTempAmount);
<a name="l04079"></a>04079         }
<a name="l04080"></a>04080 
<a name="l04081"></a>04081         int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount);
<a name="l04082"></a>04082 
<a name="l04083"></a>04083         strCheque = <a class="code" href="class_o_t_a_p_i___wrap.html#a4b345121754811335bf43f49be21bb7c">OTAPI_Wrap::WriteCheque</a>(strMyServerID,
<a name="l04084"></a>04084             lAmount,
<a name="l04085"></a>04085             tFrom,
<a name="l04086"></a>04086             tTo,
<a name="l04087"></a>04087             <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>,
<a name="l04088"></a>04088             strMyNymID,
<a name="l04089"></a>04089             strMemo,
<a name="l04090"></a>04090             strHisNymID);
<a name="l04091"></a>04091 
<a name="l04092"></a>04092         <span class="comment">// Record it in the records?</span>
<a name="l04093"></a>04093         <span class="comment">// Update: We wouldn&#39;t record that here. Instead, OTAPI_Wrap::WriteCheque should drop a notice</span>
<a name="l04094"></a>04094         <span class="comment">// into the payments outbox, the same as it does when you &quot;sendcheque&quot; (after all, the same</span>
<a name="l04095"></a>04095         <span class="comment">// resolution would be expected once it is cashed.)</span>
<a name="l04096"></a>04096 
<a name="l04097"></a>04097         <span class="keywordflow">return</span> 1;
<a name="l04098"></a>04098     }
<a name="l04099"></a>04099 
<a name="l04100"></a>04100     <span class="comment">// &quot;return value&quot;</span>
<a name="l04101"></a>04101     <span class="keywordflow">return</span> -1;
<a name="l04102"></a>04102 }
<a name="l04103"></a>04103 
<a name="l04104"></a>04104 
<a name="l04105"></a><a class="code" href="class_o_t___command.html#a04e4cfd1b64d65799d5a4022dd583d7d">04105</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a04e4cfd1b64d65799d5a4022dd583d7d">OT_Command::main_write_cheque</a>()
<a name="l04106"></a>04106 {
<a name="l04107"></a>04107     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  writecheque  --myacct &lt;MY_ACCT_ID&gt; --hisnym &lt;HIS_NYM_ID&gt;\n&quot;</span>;
<a name="l04108"></a>04108     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;This command WRITES but DOES NOT SEND the cheque. (Use sendcheque for that.)\n\n&quot;</span>;
<a name="l04109"></a>04109     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>,
<a name="l04110"></a>04110         <span class="stringliteral">&quot;Additionally: --args \&quot;validfor IN_SECONDS\&quot; \n&quot;</span> + strUsage2);
<a name="l04111"></a>04111 
<a name="l04112"></a>04112     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04113"></a>04113 
<a name="l04114"></a>04114     <span class="keywordtype">string</span> strCheque = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04115"></a>04115     int32_t nReturnVal = <a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">details_write_cheque</a>(strCheque, <span class="keyword">false</span>); <span class="comment">//bIsInvoice=false</span>
<a name="l04116"></a>04116 
<a name="l04117"></a>04117     <span class="keywordflow">if</span> ((1 == nReturnVal) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCheque))
<a name="l04118"></a>04118     {
<a name="l04119"></a>04119         <span class="comment">// stderr</span>
<a name="l04120"></a>04120         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n-------------------------------------------\n the cheque:\n\n&quot;</span>);
<a name="l04121"></a>04121         <span class="comment">// stdout</span>
<a name="l04122"></a>04122         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCheque);
<a name="l04123"></a>04123         <span class="comment">// stderr</span>
<a name="l04124"></a>04124         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04125"></a>04125     }
<a name="l04126"></a>04126 
<a name="l04127"></a>04127     <span class="keywordflow">return</span> nReturnVal;
<a name="l04128"></a>04128 }
<a name="l04129"></a>04129 
<a name="l04130"></a>04130 
<a name="l04131"></a><a class="code" href="class_o_t___command.html#a3c73fa3b426c25b25ed4dc3fa95af745">04131</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3c73fa3b426c25b25ed4dc3fa95af745">OT_Command::main_write_invoice</a>()
<a name="l04132"></a>04132 {
<a name="l04133"></a>04133     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  writeinvoice  --myacct &lt;MY_ACCT_ID&gt; --hisnym &lt;HIS_NYM_ID&gt;\n&quot;</span>;
<a name="l04134"></a>04134     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;This command WRITES but DOES NOT SEND the invoice. (Use sendinvoice for that.)\n&quot;</span>;
<a name="l04135"></a>04135     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>,
<a name="l04136"></a>04136         <span class="stringliteral">&quot;Additionally: --args \&quot;validfor IN_SECONDS\&quot; \n&quot;</span> + strUsage2);
<a name="l04137"></a>04137     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04138"></a>04138 
<a name="l04139"></a>04139     <span class="keywordtype">string</span> strCheque = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04140"></a>04140     int32_t nReturnVal = <a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">details_write_cheque</a>(strCheque, <span class="keyword">true</span>); <span class="comment">//bIsInvoice=true</span>
<a name="l04141"></a>04141 
<a name="l04142"></a>04142     <span class="keywordflow">if</span> ((1 == nReturnVal) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCheque))
<a name="l04143"></a>04143     {
<a name="l04144"></a>04144         <span class="comment">// stderr</span>
<a name="l04145"></a>04145         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n-------------------------------------------\n the invoice:\n\n&quot;</span>);
<a name="l04146"></a>04146         <span class="comment">// stdout</span>
<a name="l04147"></a>04147         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCheque);
<a name="l04148"></a>04148         <span class="comment">// stderr</span>
<a name="l04149"></a>04149         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04150"></a>04150     }
<a name="l04151"></a>04151 
<a name="l04152"></a>04152     <span class="keywordflow">return</span> nReturnVal;
<a name="l04153"></a>04153 }
<a name="l04154"></a>04154 
<a name="l04155"></a>04155 
<a name="l04156"></a><a class="code" href="class_o_t___command.html#a9f79d4628c4a6d10b4ef37edbe3a6296">04156</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a9f79d4628c4a6d10b4ef37edbe3a6296">OT_Command::main_sendcash</a>()
<a name="l04157"></a>04157 {
<a name="l04158"></a>04158 
<a name="l04159"></a>04159     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  sendcash  --[myacct|mypurse] &lt;ID&gt; --hisnym &lt;RECIPIENT_NYM_ID&gt;\nFor mypurse, the server and nym are also required: --server &lt;SERVER_ID&gt; --mynym &lt;NYM_ID&gt; \n&quot;</span>;
<a name="l04160"></a>04160     <span class="keywordtype">string</span> strUsage2 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Optionally: --args \&quot;passwd true\&quot;  (To send a password-protected purse.)\n&quot;</span>);
<a name="l04161"></a>04161     <span class="keywordtype">string</span> strUsage3 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage2, <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>);
<a name="l04162"></a>04162     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage3, <span class="stringliteral">&quot;This command sends cash to the recipient, from your purse if specified, and withdrawing first from your account, if necessary.\n\n&quot;</span>);
<a name="l04163"></a>04163 
<a name="l04164"></a>04164     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04165"></a>04165 
<a name="l04166"></a>04166     <span class="keywordtype">string</span> strServerID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04167"></a>04167     <span class="keywordtype">string</span> strMyAcctID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04168"></a>04168     <span class="keywordtype">string</span> strMyNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04169"></a>04169     <span class="keywordtype">string</span> strAssetTypeID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04170"></a>04170 
<a name="l04171"></a>04171     <span class="keywordtype">bool</span> bServerExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>);
<a name="l04172"></a>04172     <span class="keywordtype">bool</span> bMyPurseExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>, <span class="keyword">false</span>);
<a name="l04173"></a>04173     <span class="keywordtype">bool</span> bMyAcctExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>);
<a name="l04174"></a>04174     <span class="keywordtype">bool</span> bMyNymExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>);
<a name="l04175"></a>04175 
<a name="l04176"></a>04176     <span class="keywordflow">if</span> (!bMyPurseExists &amp;&amp; !bMyAcctExists)
<a name="l04177"></a>04177     {
<a name="l04178"></a>04178         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n You must provide EITHER --myacct &lt;ACCT_ID&gt; OR --mypurse &lt;ASSET_TYPE_ID&gt;\nFor mypurse, the server and nym are also required: --server &lt;SERVER_ID&gt; --mynym &lt;NYM_ID&gt; \n&quot;</span>);
<a name="l04179"></a>04179         <span class="keywordflow">return</span> -1;
<a name="l04180"></a>04180     }
<a name="l04181"></a>04181 
<a name="l04182"></a>04182     <span class="keywordflow">if</span> (bMyPurseExists)
<a name="l04183"></a>04183     {
<a name="l04184"></a>04184         strAssetTypeID = <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>;
<a name="l04185"></a>04185 
<a name="l04186"></a>04186         <span class="keywordflow">if</span> (bServerExists &amp;&amp; bMyNymExists)
<a name="l04187"></a>04187         {
<a name="l04188"></a>04188             strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l04189"></a>04189             strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l04190"></a>04190         }
<a name="l04191"></a>04191         <span class="keywordflow">else</span>
<a name="l04192"></a>04192         {
<a name="l04193"></a>04193             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n MyPurse was specified, but you must also specify a server and nym:  --server &lt;SERVER_ID&gt; --mynym &lt;NYM_ID&gt;\nMaybe we can find them using MyAcct...\n&quot;</span>);
<a name="l04194"></a>04194         }
<a name="l04195"></a>04195     }
<a name="l04196"></a>04196     <span class="comment">// NOTE: If MyNym and Server are not provided here, but MyAcct IS, the nym and server can still be derived from MyAcct.</span>
<a name="l04197"></a>04197     <span class="comment">// The purse will still be used, but only if it has the same asset type ID as MyAcct does. (Meaning there was no point,</span>
<a name="l04198"></a>04198     <span class="comment">// then, in specifying the purse at all, since all the info was derived from the account in that case.)</span>
<a name="l04199"></a>04199 
<a name="l04200"></a>04200     <span class="keywordflow">if</span> (bMyAcctExists)
<a name="l04201"></a>04201     {
<a name="l04202"></a>04202         <span class="keywordtype">string</span> strAcctServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l04203"></a>04203         <span class="keywordtype">string</span> strAcctAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l04204"></a>04204         <span class="keywordtype">string</span> strAcctNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l04205"></a>04205 
<a name="l04206"></a>04206         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctServerID))
<a name="l04207"></a>04207         {
<a name="l04208"></a>04208             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed trying to retrieve ServerID based on MyAcct: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04209"></a>04209             <span class="keywordflow">return</span> -1;
<a name="l04210"></a>04210         }
<a name="l04211"></a>04211 
<a name="l04212"></a>04212         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctAssetID))
<a name="l04213"></a>04213         {
<a name="l04214"></a>04214             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed trying to retrieve AssetTypeID based on MyAcct: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04215"></a>04215             <span class="keywordflow">return</span> -1;
<a name="l04216"></a>04216         }
<a name="l04217"></a>04217 
<a name="l04218"></a>04218         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctNymID))
<a name="l04219"></a>04219         {
<a name="l04220"></a>04220             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed trying to retrieve NymID based on MyAcct: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04221"></a>04221             <span class="keywordflow">return</span> -1;
<a name="l04222"></a>04222         }
<a name="l04223"></a>04223 
<a name="l04224"></a>04224         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID) &amp;&amp; (strAcctServerID != strServerID))
<a name="l04225"></a>04225         {
<a name="l04226"></a>04226             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Server ID provided on the command line doesn&#39;t match the Server ID for MyAcct. Expected: &quot;</span> + strAcctServerID + <span class="stringliteral">&quot;\n Try adding: --server &quot;</span> + strAcctServerID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04227"></a>04227             <span class="keywordflow">return</span> -1;
<a name="l04228"></a>04228         }
<a name="l04229"></a>04229 
<a name="l04230"></a>04230         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID) &amp;&amp; (strAcctAssetID != strAssetTypeID))
<a name="l04231"></a>04231         {
<a name="l04232"></a>04232             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Asset Type ID provided on the command line doesn&#39;t match the Asset Type ID of MyAcct. Expected: &quot;</span> + strAcctAssetID + <span class="stringliteral">&quot;\n Try adding: --mypurse &quot;</span> + strAcctAssetID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04233"></a>04233             <span class="keywordflow">return</span> -1;
<a name="l04234"></a>04234         }
<a name="l04235"></a>04235 
<a name="l04236"></a>04236         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID) &amp;&amp; (strAcctNymID != strMyNymID))
<a name="l04237"></a>04237         {
<a name="l04238"></a>04238             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Nym ID provided on the command line doesn&#39;t match the Nym ID for MyAcct. Expected: &quot;</span> + strAcctNymID + <span class="stringliteral">&quot;\n Try adding: --mynym &quot;</span> + strAcctNymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04239"></a>04239             <span class="keywordflow">return</span> -1;
<a name="l04240"></a>04240         }
<a name="l04241"></a>04241 
<a name="l04242"></a>04242         strServerID = strAcctServerID;
<a name="l04243"></a>04243         strAssetTypeID = strAcctAssetID;
<a name="l04244"></a>04244         strMyNymID = strAcctNymID;
<a name="l04245"></a>04245         strMyAcctID = <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>;
<a name="l04246"></a>04246 
<a name="l04247"></a>04247     }
<a name="l04248"></a>04248 
<a name="l04249"></a>04249     <span class="comment">// Since MyPurse might have been specified with NO server or Nym, and with MyAcct NOT specified,</span>
<a name="l04250"></a>04250     <span class="comment">// we could potentially end up down here without a server or Nym still. This is only possible because</span>
<a name="l04251"></a>04251     <span class="comment">// we allow the purse to fall through, in case those values are picked up from the account instead.</span>
<a name="l04252"></a>04252     <span class="comment">// But by this point, we have to MAKE SURE we have a server and Nym. So let&#39;s do that now:</span>
<a name="l04253"></a>04253     <span class="comment">//</span>
<a name="l04254"></a>04254 
<a name="l04255"></a>04255     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l04256"></a>04256     {
<a name="l04257"></a>04257         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed: Missing Server ID. Try adding: --server &lt;SERVER_ID&gt;\n&quot;</span>);
<a name="l04258"></a>04258         <span class="keywordflow">return</span> -1;
<a name="l04259"></a>04259     }
<a name="l04260"></a>04260 
<a name="l04261"></a>04261     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l04262"></a>04262     {
<a name="l04263"></a>04263         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Failed: Missing MyNym ID. Try adding: --mynym &lt;NYM_ID&gt;\n&quot;</span>);
<a name="l04264"></a>04264         <span class="keywordflow">return</span> -1;
<a name="l04265"></a>04265     }
<a name="l04266"></a>04266 
<a name="l04267"></a>04267     <span class="comment">// Below this point, we KNOW there&#39;s EITHER a purse OR account (or both.)</span>
<a name="l04268"></a>04268     <span class="comment">// We know if there is only a purse specified, that it properly also has</span>
<a name="l04269"></a>04269     <span class="comment">// a serverID and nymID. (MyPurse itself being the asset type ID.)</span>
<a name="l04270"></a>04270     <span class="comment">//</span>
<a name="l04271"></a>04271     <span class="comment">// We know that if a purse AND account are both specified, that they have</span>
<a name="l04272"></a>04272     <span class="comment">// matching asset types, AND matching server and nym IDs. You might think</span>
<a name="l04273"></a>04273     <span class="comment">// there&#39;d be no point in doing that, since you could just not specify the</span>
<a name="l04274"></a>04274     <span class="comment">// purse at all, and only specify the account. And you&#39;d be right! Either way,</span>
<a name="l04275"></a>04275     <span class="comment">// we&#39;ll try to pay it first out of the cash purse, and only withdraw from</span>
<a name="l04276"></a>04276     <span class="comment">// the account if we&#39;re unable to pay it solely through the purse first.</span>
<a name="l04277"></a>04277     <span class="comment">//</span>
<a name="l04278"></a>04278     <span class="comment">// We know that strServerID is correct, strAssetTypeID is correct, and strMyNymID</span>
<a name="l04279"></a>04279     <span class="comment">// is correct, whether we&#39;re using an account or a purse. And we know that if</span>
<a name="l04280"></a>04280     <span class="comment">// we&#39;re using an account, we know that strMyAcctID is correct as well.</span>
<a name="l04281"></a>04281     <span class="comment">//</span>
<a name="l04282"></a>04282     <span class="comment">// Below this point we can just try to pay it from the purse, and if unable to,</span>
<a name="l04283"></a>04283     <span class="comment">// try to get the remaining funds from the account, IF that&#39;s available.</span>
<a name="l04284"></a>04284     <span class="comment">//</span>
<a name="l04285"></a>04285     int32_t nReturnVal = -1;
<a name="l04286"></a>04286 
<a name="l04287"></a>04287     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>))
<a name="l04288"></a>04288     {
<a name="l04289"></a>04289 
<a name="l04290"></a>04290         <span class="comment">// strAmount</span>
<a name="l04291"></a>04291         <span class="comment">//</span>
<a name="l04292"></a>04292         <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l04293"></a>04293         <span class="keywordtype">string</span> strMemo = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// can be blank</span>
<a name="l04294"></a>04294 
<a name="l04295"></a>04295         <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l04296"></a>04296         <span class="keywordtype">string</span> strDefaultMemo = <span class="stringliteral">&quot;(blank memo field)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l04297"></a>04297 
<a name="l04298"></a>04298         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// If indices are not specified, we derive them from the amount. Otherwise we go with the selected indices.</span>
<a name="l04299"></a>04299         <span class="keywordtype">bool</span> bPasswordProtected = <span class="keyword">false</span>;
<a name="l04300"></a>04300 
<a name="l04301"></a>04301         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l04302"></a>04302         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l04303"></a>04303         <span class="comment">// at the command line.</span>
<a name="l04304"></a>04304         <span class="comment">//</span>
<a name="l04305"></a>04305         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>)) <span class="comment">// displayErrorMsg=false</span>
<a name="l04306"></a>04306         {
<a name="l04307"></a>04307             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l04308"></a>04308             <span class="comment">//                                  const std::string str_key)</span>
<a name="l04309"></a>04309             <span class="comment">//</span>
<a name="l04310"></a>04310             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l04311"></a>04311             <span class="comment">// EXAMPLE:  --args &quot;amount 1&quot;</span>
<a name="l04312"></a>04312             <span class="comment">//</span>
<a name="l04313"></a>04313             <span class="comment">// EXAMPLE:  --args &quot;indices \&quot;all\&quot; &quot;</span>
<a name="l04314"></a>04314             <span class="comment">//</span>
<a name="l04315"></a>04315             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l04316"></a>04316 
<a name="l04317"></a>04317             <span class="keywordtype">string</span> strPasswordProtected = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;passwd&quot;</span>);
<a name="l04318"></a>04318 
<a name="l04319"></a>04319             <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>); <span class="comment">// any integer value</span>
<a name="l04320"></a>04320             <span class="keywordtype">string</span> strNewMemo = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;memo&quot;</span>); <span class="comment">// optional memo field</span>
<a name="l04321"></a>04321 
<a name="l04322"></a>04322             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l04323"></a>04323             <span class="comment">//</span>
<a name="l04324"></a>04324             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount))
<a name="l04325"></a>04325             {
<a name="l04326"></a>04326                 strAmount = strNewAmount;
<a name="l04327"></a>04327             }
<a name="l04328"></a>04328             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMemo))
<a name="l04329"></a>04329             {
<a name="l04330"></a>04330                 strMemo = strNewMemo;
<a name="l04331"></a>04331             }
<a name="l04332"></a>04332             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPasswordProtected) &amp;&amp; (<span class="stringliteral">&quot;true&quot;</span> == strPasswordProtected))
<a name="l04333"></a>04333             {
<a name="l04334"></a>04334                 bPasswordProtected = <span class="keyword">true</span>;
<a name="l04335"></a>04335             }
<a name="l04336"></a>04336         }
<a name="l04337"></a>04337 
<a name="l04338"></a>04338         <span class="comment">// If the withdrawal parameters aren&#39;t provided, then we</span>
<a name="l04339"></a>04339         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l04340"></a>04340         <span class="comment">//</span>
<a name="l04341"></a>04341         <span class="keywordflow">if</span> ((!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1)) &amp;&amp; !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices)) <span class="comment">// If no indices are selected, then we NEED to know the amount...</span>
<a name="l04342"></a>04342         {
<a name="l04343"></a>04343             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the amount[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04344"></a>04344             strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04345"></a>04345         }
<a name="l04346"></a>04346 
<a name="l04347"></a>04347         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l04348"></a>04348         {
<a name="l04349"></a>04349             strAmount = strDefaultAmount;
<a name="l04350"></a>04350         }
<a name="l04351"></a>04351 
<a name="l04352"></a>04352         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l04353"></a>04353         {
<a name="l04354"></a>04354             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a memo on a single line[&quot;</span> + strDefaultMemo + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04355"></a>04355             strMemo = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04356"></a>04356         }
<a name="l04357"></a>04357 
<a name="l04358"></a>04358         <span class="keywordtype">string</span> strResponse = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04359"></a>04359 
<a name="l04360"></a>04360         nReturnVal = <a class="code" href="class_o_t___command.html#ad3592551d59a4de80537f546cd5bddb5">details_send_cash</a>(strResponse, strServerID, strAssetTypeID, strMyNymID, strMyAcctID, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, strMemo, strAmount, strIndices, bPasswordProtected); <span class="comment">// &lt;=======</span>
<a name="l04361"></a>04361 
<a name="l04362"></a>04362         <span class="keywordflow">if</span> (1 != nReturnVal)
<a name="l04363"></a>04363         {
<a name="l04364"></a>04364             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;main_sendcash: Failed in details_send_cash.\n&quot;</span>);
<a name="l04365"></a>04365         }
<a name="l04366"></a>04366         <span class="keywordflow">else</span>
<a name="l04367"></a>04367         {
<a name="l04368"></a>04368             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in sendcash! Server response:\n\n&quot;</span>);
<a name="l04369"></a>04369             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l04370"></a>04370             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(Success in sendcash)\n&quot;</span>);
<a name="l04371"></a>04371         }
<a name="l04372"></a>04372     }
<a name="l04373"></a>04373 
<a name="l04374"></a>04374     <span class="keywordflow">return</span> nReturnVal;
<a name="l04375"></a>04375 }
<a name="l04376"></a>04376 
<a name="l04377"></a>04377 
<a name="l04378"></a><a class="code" href="class_o_t___command.html#a95cc208fd7fd06254e31d7623f1a7b8f">04378</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a95cc208fd7fd06254e31d7623f1a7b8f">OT_Command::main_sendcheque</a>()
<a name="l04379"></a>04379 {
<a name="l04380"></a>04380     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  sendcheque  --myacct &lt;MY_ACCT_ID&gt; --hisnym &lt;RECIPIENT_NYM_ID&gt;\n&quot;</span>;
<a name="l04381"></a>04381     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;This command WRITES AND SENDS the cheque.\n(Use &#39;writecheque&#39;, not &#39;sendcheque&#39;, if you don&#39;t want it to be immediately SENT.)\n&quot;</span>;
<a name="l04382"></a>04382     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>,
<a name="l04383"></a>04383         <span class="stringliteral">&quot;Additionally: --args \&quot;validfor IN_SECONDS\&quot; \n&quot;</span> + strUsage2);
<a name="l04384"></a>04384 
<a name="l04385"></a>04385     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04386"></a>04386 
<a name="l04387"></a>04387     <span class="keywordtype">string</span> strCheque = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04388"></a>04388     int32_t nReturnVal = <a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">details_write_cheque</a>(strCheque, <span class="keyword">false</span>); <span class="comment">//bIsInvoice=false</span>
<a name="l04389"></a>04389 
<a name="l04390"></a>04390     <span class="keywordflow">if</span> ((1 == nReturnVal) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCheque))
<a name="l04391"></a>04391     {
<a name="l04392"></a>04392         <span class="comment">// stderr</span>
<a name="l04393"></a>04393         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n-------------------------------------------\n the cheque:\n\n&quot;</span>);
<a name="l04394"></a>04394         <span class="comment">// stdout</span>
<a name="l04395"></a>04395         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCheque);
<a name="l04396"></a>04396         <span class="comment">// stderr</span>
<a name="l04397"></a>04397         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04398"></a>04398 
<a name="l04399"></a>04399         <span class="comment">// TODO: Store a copy in outpayments box (OR VERIFY THAT IT&#39;S ALREADY BEING DONE, WHICH I BELIEVE THAT IT IS.)</span>
<a name="l04400"></a>04400 
<a name="l04401"></a>04401         <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strCheque);
<a name="l04402"></a>04402         <span class="keywordtype">string</span> strSenderNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strCheque);
<a name="l04403"></a>04403         <span class="keywordtype">string</span> strRecipientNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strCheque);
<a name="l04404"></a>04404 
<a name="l04405"></a>04405         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l04406"></a>04406         {
<a name="l04407"></a>04407             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Server ID from this cheque! Very strange. (Failure.)\n&quot;</span>);
<a name="l04408"></a>04408             <span class="keywordflow">return</span> -1;
<a name="l04409"></a>04409         }
<a name="l04410"></a>04410         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderNymID))
<a name="l04411"></a>04411         {
<a name="l04412"></a>04412             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Sender Nym ID from this cheque! Very strange. (Failure.)\n&quot;</span>);
<a name="l04413"></a>04413             <span class="keywordflow">return</span> -1;
<a name="l04414"></a>04414         }
<a name="l04415"></a>04415         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientNymID))
<a name="l04416"></a>04416         {
<a name="l04417"></a>04417             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Unable to retrieve a Recipient Nym ID from this cheque! Very strange. (Failure.)\n&quot;</span>,
<a name="l04418"></a>04418                 <span class="stringliteral">&quot;(Although it&#39;s fine to WRITE a cheque with no recipient, still need the ID to SEND one.)\n&quot;</span>));
<a name="l04419"></a>04419             <span class="keywordflow">return</span> -1;
<a name="l04420"></a>04420         }
<a name="l04421"></a>04421 
<a name="l04422"></a>04422 
<a name="l04423"></a>04423         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strSenderNymID, strRecipientNymID, strCheque);
<a name="l04424"></a>04424 
<a name="l04425"></a>04425         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l04426"></a>04426         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l04427"></a>04427         <span class="comment">// handled at a lower level!</span>
<a name="l04428"></a>04428         <span class="comment">//</span>
<a name="l04429"></a>04429         <span class="comment">// Instead, simply check for success or failure:</span>
<a name="l04430"></a>04430         <span class="comment">//</span>
<a name="l04431"></a>04431         nReturnVal = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l04432"></a>04432 
<a name="l04433"></a>04433         <span class="keywordflow">if</span> (1 != nReturnVal)
<a name="l04434"></a>04434         {
<a name="l04435"></a>04435             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;sendcheque: Failed.\n&quot;</span>);
<a name="l04436"></a>04436 
<a name="l04437"></a>04437             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l04438"></a>04438             {
<a name="l04439"></a>04439                 <a class="code" href="class_o_t_a_p_i___wrap.html#a55b1919e2e09e188f3366f16cc9ca0ed">OTAPI_Wrap::Msg_HarvestTransactionNumbers</a>(strResponse, strSenderNymID, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l04440"></a>04440             }
<a name="l04441"></a>04441         }
<a name="l04442"></a>04442         <span class="keywordflow">else</span>
<a name="l04443"></a>04443         {
<a name="l04444"></a>04444             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in sendcheque! Server response:\n\n&quot;</span>);
<a name="l04445"></a>04445             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l04446"></a>04446             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(Success in sendcheque)\n&quot;</span>);
<a name="l04447"></a>04447             <span class="keywordflow">return</span> 1;
<a name="l04448"></a>04448         }
<a name="l04449"></a>04449     }
<a name="l04450"></a>04450 
<a name="l04451"></a>04451     <span class="keywordflow">return</span> nReturnVal;
<a name="l04452"></a>04452 }
<a name="l04453"></a>04453 
<a name="l04454"></a>04454 
<a name="l04455"></a><a class="code" href="class_o_t___command.html#aa05b89351ef407eaf4910d0dcd76826e">04455</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa05b89351ef407eaf4910d0dcd76826e">OT_Command::main_sendinvoice</a>()
<a name="l04456"></a>04456 {
<a name="l04457"></a>04457     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  sendinvoice  --myacct &lt;MY_ACCT_ID&gt; --hisnym &lt;RECIPIENT_NYM_ID&gt;\n&quot;</span>;
<a name="l04458"></a>04458     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;This command WRITES AND SENDS the invoice. (Use &#39;writeinvoice&#39;, not &#39;sendinvoice&#39;,\nif you don&#39;t want it to be immediately SENT.)\n&quot;</span>;
<a name="l04459"></a>04459     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>,
<a name="l04460"></a>04460         <span class="stringliteral">&quot;Additionally: --args \&quot;validfor IN_SECONDS\&quot; \n&quot;</span> + strUsage2);
<a name="l04461"></a>04461 
<a name="l04462"></a>04462     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04463"></a>04463 
<a name="l04464"></a>04464     <span class="keywordtype">string</span> strCheque = <span class="stringliteral">&quot;&quot;</span>;
<a name="l04465"></a>04465     int32_t nReturnVal = <a class="code" href="class_o_t___command.html#a589a088c6a7287cac02eacbf7f763dd4">details_write_cheque</a>(strCheque, <span class="keyword">true</span>); <span class="comment">//bIsInvoice=true</span>
<a name="l04466"></a>04466 
<a name="l04467"></a>04467     <span class="keywordflow">if</span> ((1 == nReturnVal) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCheque))
<a name="l04468"></a>04468     {
<a name="l04469"></a>04469         <span class="comment">// stderr</span>
<a name="l04470"></a>04470         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n-------------------------------------------\n the invoice:\n\n&quot;</span>);
<a name="l04471"></a>04471         <span class="comment">// stdout</span>
<a name="l04472"></a>04472         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCheque);
<a name="l04473"></a>04473         <span class="comment">// stderr</span>
<a name="l04474"></a>04474         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04475"></a>04475 
<a name="l04476"></a>04476         <span class="comment">// TODO: Store a copy in outpayments box (OR VERIFY THAT IT&#39;S ALREADY BEING DONE, WHICH I BELIEVE THAT IT IS.)</span>
<a name="l04477"></a>04477 
<a name="l04478"></a>04478         <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strCheque);
<a name="l04479"></a>04479         <span class="keywordtype">string</span> strSenderNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strCheque);
<a name="l04480"></a>04480         <span class="keywordtype">string</span> strRecipientNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strCheque);
<a name="l04481"></a>04481 
<a name="l04482"></a>04482         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l04483"></a>04483         {
<a name="l04484"></a>04484             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Server ID from this invoice! Very strange. (Failure.)\n&quot;</span>);
<a name="l04485"></a>04485             <span class="keywordflow">return</span> -1;
<a name="l04486"></a>04486         }
<a name="l04487"></a>04487         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderNymID))
<a name="l04488"></a>04488         {
<a name="l04489"></a>04489             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Sender Nym ID from this invoice! Very strange. (Failure.)\n&quot;</span>);
<a name="l04490"></a>04490             <span class="keywordflow">return</span> -1;
<a name="l04491"></a>04491         }
<a name="l04492"></a>04492         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientNymID))
<a name="l04493"></a>04493         {
<a name="l04494"></a>04494             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Unable to retrieve a Recipient Nym ID (Endorsee) from this invoice! Very strange. (Failure.)\n&quot;</span>,
<a name="l04495"></a>04495                 <span class="stringliteral">&quot;(Although it&#39;s fine to WRITE a invoice with no endorsee, still need the ID to SEND it.)\n&quot;</span>));
<a name="l04496"></a>04496             <span class="keywordflow">return</span> -1;
<a name="l04497"></a>04497         }
<a name="l04498"></a>04498 
<a name="l04499"></a>04499         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strSenderNymID, strRecipientNymID, strCheque);
<a name="l04500"></a>04500 
<a name="l04501"></a>04501         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l04502"></a>04502         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l04503"></a>04503         <span class="comment">// handled at a lower level!</span>
<a name="l04504"></a>04504         <span class="comment">//</span>
<a name="l04505"></a>04505         <span class="comment">// Instead, simply check for success or failure:</span>
<a name="l04506"></a>04506         <span class="comment">//</span>
<a name="l04507"></a>04507         nReturnVal = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l04508"></a>04508 
<a name="l04509"></a>04509         <span class="keywordflow">if</span> (1 != nReturnVal)
<a name="l04510"></a>04510         {
<a name="l04511"></a>04511             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;sendinvoice: Failed.\n&quot;</span>);
<a name="l04512"></a>04512         }
<a name="l04513"></a>04513         <span class="keywordflow">else</span>
<a name="l04514"></a>04514         {
<a name="l04515"></a>04515             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in sendinvoice! Server response:\n\n&quot;</span>);
<a name="l04516"></a>04516             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l04517"></a>04517             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(Success in sendinvoice)\n&quot;</span>);
<a name="l04518"></a>04518             <span class="keywordflow">return</span> 1;
<a name="l04519"></a>04519         }
<a name="l04520"></a>04520     }
<a name="l04521"></a>04521 
<a name="l04522"></a>04522     <span class="keywordflow">return</span> nReturnVal;
<a name="l04523"></a>04523 }
<a name="l04524"></a>04524 
<a name="l04525"></a>04525 
<a name="l04526"></a><a class="code" href="class_o_t___command.html#aba7c10f399336067f1ba600abdc53e2e">04526</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aba7c10f399336067f1ba600abdc53e2e">OT_Command::details_create_offer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strScale, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMinIncrement, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strQuantity, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPrice, <span class="keyword">const</span> <span class="keywordtype">bool</span> bSelling, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strLifespan)
<a name="l04527"></a>04527 {
<a name="l04528"></a>04528     <span class="comment">// NOTE: The top half of this function has nothing to do with placing a new offer.</span>
<a name="l04529"></a>04529     <span class="comment">// Instead, as a convenience for knotwork, it first checks to see if there are any</span>
<a name="l04530"></a>04530     <span class="comment">// existing offers within certain parameters based on this new one, and removes them</span>
<a name="l04531"></a>04531     <span class="comment">// if so. Only then, after that is done, does it actually place the new offer.</span>
<a name="l04532"></a>04532     <span class="comment">// (Meaning: most of the code you see here at first is not actually necessary for</span>
<a name="l04533"></a>04533     <span class="comment">// placing offers, but was done at the request of a server operator.)</span>
<a name="l04534"></a>04534     <span class="comment">//</span>
<a name="l04535"></a>04535     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;details_create_offer&quot;</span>;
<a name="l04536"></a>04536 
<a name="l04537"></a>04537     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l04538"></a>04538     <span class="keywordtype">string</span> strMyNymID2 = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>);
<a name="l04539"></a>04539 
<a name="l04540"></a>04540     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID2) || (strMyNymID != strMyNymID2))
<a name="l04541"></a>04541     {
<a name="l04542"></a>04542         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You must supply myacct as your asset account, and hisacct as your currency account.\n&quot;</span>);
<a name="l04543"></a>04543         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Also, both accounts must be owned by the same Nym (you.)\n\n&quot;</span>);
<a name="l04544"></a>04544         <span class="keywordflow">return</span> -1;
<a name="l04545"></a>04545     }
<a name="l04546"></a>04546 
<a name="l04547"></a>04547     <span class="keywordtype">string</span> strMyServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l04548"></a>04548     <span class="keywordtype">string</span> strMyServerID2 = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>);
<a name="l04549"></a>04549 
<a name="l04550"></a>04550     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyServerID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyServerID2) || (strMyServerID != strMyServerID2))
<a name="l04551"></a>04551     {
<a name="l04552"></a>04552         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Both accounts must be on the same server.\n&quot;</span>);
<a name="l04553"></a>04553         <span class="keywordflow">return</span> -1;
<a name="l04554"></a>04554     }
<a name="l04555"></a>04555     <span class="comment">// Below this point we&#39;re safe to use Server.</span>
<a name="l04556"></a>04556 
<a name="l04557"></a>04557 
<a name="l04558"></a>04558     <span class="comment">// We&#39;re about to load up the Nym&#39;s market offers so we can see if there are</span>
<a name="l04559"></a>04559     <span class="comment">// any we should cancel before placing this new offer.</span>
<a name="l04560"></a>04560     <span class="comment">//</span>
<a name="l04561"></a>04561     <span class="comment">// Therefore, I&#39;m going to download the Nym&#39;s market offers before loading them</span>
<a name="l04562"></a>04562     <span class="comment">// up, in case we don&#39;t even have the current list of them.</span>
<a name="l04563"></a>04563 
<a name="l04564"></a>04564     <a class="code" href="class_o_t___command.html#afc0ed9044e576cde886cad1f52cffb4f">OT_Command::details_get_nym_market_offers</a>(strMyServerID, strMyNymID);
<a name="l04565"></a>04565 
<a name="l04566"></a>04566     <span class="comment">/*</span>
<a name="l04567"></a>04567 <span class="comment">    me: How about this  when you do &quot;opentxs newoffer&quot; I can alter that</span>
<a name="l04568"></a>04568 <span class="comment">    script to automatically cancel any sell offers for a lower amount</span>
<a name="l04569"></a>04569 <span class="comment">    than my new buy offer, if they&#39;re on the same market at the same scale.</span>
<a name="l04570"></a>04570 <span class="comment">    and vice versa. Vice versa meaning, cancel any bid offers for a higher</span>
<a name="l04571"></a>04571 <span class="comment">    amount than my new sell offer.</span>
<a name="l04572"></a>04572 <span class="comment"></span>
<a name="l04573"></a>04573 <span class="comment">    knotwork: yeah that would work.</span>
<a name="l04574"></a>04574 <span class="comment"></span>
<a name="l04575"></a>04575 <span class="comment">    So when placing a buy offer, check all the other offers I already have at the same scale,</span>
<a name="l04576"></a>04576 <span class="comment">    same asset and currency ID. (That is, the same &quot;market&quot; as denoted by strMapKey in &quot;opentxs showmyoffers&quot;)</span>
<a name="l04577"></a>04577 <span class="comment">    For each, see if it&#39;s a sell offer and if so, if the amount is lower than the amount on</span>
<a name="l04578"></a>04578 <span class="comment">    the new buy offer, then cancel that sell offer from the market. (Because I don&#39;t want to buy-high, sell low.)</span>
<a name="l04579"></a>04579 <span class="comment"></span>
<a name="l04580"></a>04580 <span class="comment">    Similarly, if placing a sell offer, then check all the other offers I already have at the</span>
<a name="l04581"></a>04581 <span class="comment">    same scale, same asset and currency ID, (the same &quot;market&quot; as denoted by strMapKey....) For</span>
<a name="l04582"></a>04582 <span class="comment">    each, see if it&#39;s a buy offer and if so, if the amount is higher than the amount of my new</span>
<a name="l04583"></a>04583 <span class="comment">    sell offer, then cancel that buy offer from the market. (Because I don&#39;t want some old buy offer</span>
<a name="l04584"></a>04584 <span class="comment">    for $10 laying around for the same stock that I&#39;m SELLING for $8! If I dump 100 shares, I&#39;ll receive</span>
<a name="l04585"></a>04585 <span class="comment">    $800--I don&#39;t want my software to automatically turn around and BUY those same shares again for $1000!</span>
<a name="l04586"></a>04586 <span class="comment">    That would be a $200 loss.)</span>
<a name="l04587"></a>04587 <span class="comment"></span>
<a name="l04588"></a>04588 <span class="comment">    This is done here:</span>
<a name="l04589"></a>04589 <span class="comment">    */</span>
<a name="l04590"></a>04590 
<a name="l04591"></a>04591     <a class="code" href="class_o_t_d_b_1_1_offer_list_nym.html">OTDB::OfferListNym</a> &amp; offerList = *<a class="code" href="ot__otapi__ot_8hpp.html#aa3d79addb47bbba18eb44c575b04421d">loadNymOffers</a>(strMyServerID, strMyNymID);
<a name="l04592"></a>04592 
<a name="l04593"></a>04593     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;offerList, <span class="stringliteral">&quot;OTDB::OfferListNym&quot;</span>))
<a name="l04594"></a>04594     {
<a name="l04595"></a>04595         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load up a (nym) offerList from local storage. Probably doesn&#39;t exist.\n&quot;</span>);
<a name="l04596"></a>04596     }
<a name="l04597"></a>04597 
<a name="l04598"></a>04598     <span class="keywordflow">else</span>
<a name="l04599"></a>04599     {
<a name="l04600"></a>04600         <span class="comment">// LOOP THROUGH THE OFFERS and sort them into a map_of_maps, key is: scale-assetID-currencyID</span>
<a name="l04601"></a>04601         <span class="comment">// the value for each key is a sub-map, with the key: transaction ID and value: the offer data itself.</span>
<a name="l04602"></a>04602         <span class="comment">//</span>
<a name="l04603"></a>04603         int32_t nCount = offerList.GetOfferDataNymCount(); <span class="comment">// size_t</span>
<a name="l04604"></a>04604         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) &amp;&amp; (nCount &gt; 0))
<a name="l04605"></a>04605         {
<a name="l04606"></a>04606             <a class="code" href="ot__otapi__ot_8hpp.html#a5982d50c950b8a93cea04d380c3e23e3">MapOfMaps</a> * map_of_maps = <a class="code" href="ot__otapi__ot_8hpp.html#a9eb26e90faa56436cb65a5ad493eb275">convert_offerlist_to_maps</a>(offerList);
<a name="l04607"></a>04607 
<a name="l04608"></a>04608             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a210a7c90f7abda3fbe2cfb5dcf48ac61">VerifyType</a>(map_of_maps, <span class="stringliteral">&quot;Map&quot;</span>))
<a name="l04609"></a>04609             {
<a name="l04610"></a>04610                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to convert offer list to map of offers. Perhaps it&#39;s empty?\n&quot;</span>);
<a name="l04611"></a>04611             }
<a name="l04612"></a>04612             <span class="keywordflow">else</span>
<a name="l04613"></a>04613             {
<a name="l04614"></a>04614                 <span class="comment">// find_strange_offers is called for each offer, for this nym,</span>
<a name="l04615"></a>04615                 <span class="comment">// as it iterates through the maps. When it&#39;s done, extra_vals.the_vector</span>
<a name="l04616"></a>04616                 <span class="comment">// will contain a vector of all the transaction numbers for offers that we</span>
<a name="l04617"></a>04617                 <span class="comment">// should cancel, before placing the new offer. (Such as an offer to sell for</span>
<a name="l04618"></a>04618                 <span class="comment">// 30 clams when our new offer buys for 40...)</span>
<a name="l04619"></a>04619                 <span class="comment">//</span>
<a name="l04620"></a>04620                 <a class="code" href="classthe__lambda__struct.html">the_lambda_struct</a> extra_vals;
<a name="l04621"></a>04621 
<a name="l04622"></a>04622                 extra_vals.<a class="code" href="classthe__lambda__struct.html#aca42ea02548716098efa5976e98acbef">the_asset_acct</a> = <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>;
<a name="l04623"></a>04623                 extra_vals.<a class="code" href="classthe__lambda__struct.html#aeb08a22f01b3a91f9092f1d7fd7677cc">the_currency_acct</a> = <a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>;
<a name="l04624"></a>04624                 extra_vals.<a class="code" href="classthe__lambda__struct.html#a3f9ce360a86fe3c0abb29951b918ddb8">the_scale</a> = strScale;
<a name="l04625"></a>04625                 extra_vals.<a class="code" href="classthe__lambda__struct.html#a087622299268dce236e9d7e31735ab5c">the_price</a> = strPrice;
<a name="l04626"></a>04626                 extra_vals.<a class="code" href="classthe__lambda__struct.html#af10ddb2f52cdef2e54bc221ff243f817">bSelling</a> = bSelling;
<a name="l04627"></a>04627 
<a name="l04628"></a>04628                 int32_t nIterated = <a class="code" href="ot__otapi__ot_8hpp.html#afda7d1f665c2df05a675b8d491c3d9ef">iterate_nymoffers_maps</a>(*map_of_maps, <a class="code" href="ot__otapi__ot_8hpp.html#a8bc4f0936bab7030eb7e9c0889a0f488">find_strange_offers</a>, extra_vals);
<a name="l04629"></a>04629 
<a name="l04630"></a>04630                 <span class="keywordflow">if</span> (-1 == nIterated)
<a name="l04631"></a>04631                 {
<a name="l04632"></a>04632                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error trying to iterate nym&#39;s offers.\n&quot;</span>);
<a name="l04633"></a>04633                     <span class="keywordflow">return</span> -1;
<a name="l04634"></a>04634                 }
<a name="l04635"></a>04635 
<a name="l04636"></a>04636                 <span class="comment">// Okay -- if there are any offers we need to cancel, extra_vals.the_vector now contains</span>
<a name="l04637"></a>04637                 <span class="comment">// the transaction number for each one. Let&#39;s remove them from the market before</span>
<a name="l04638"></a>04638                 <span class="comment">// starting up the new offer...</span>
<a name="l04639"></a>04639                 <span class="comment">//</span>
<a name="l04640"></a>04640 
<a name="l04641"></a>04641                 <span class="keywordflow">if</span> (extra_vals.<a class="code" href="classthe__lambda__struct.html#a5e6b79a66d1c1a2bcb90c85a3e13447f">the_vector</a>.size() &gt; 0)
<a name="l04642"></a>04642                 {
<a name="l04643"></a>04643                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI, about to cancel at least one market offer, before placing the new one, due to price inconsistencies between the two...\n&quot;</span>);
<a name="l04644"></a>04644                 }
<a name="l04645"></a>04645 
<a name="l04646"></a>04646                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; extra_vals.<a class="code" href="classthe__lambda__struct.html#a5e6b79a66d1c1a2bcb90c85a3e13447f">the_vector</a>.size(); i++)
<a name="l04647"></a>04647                 {
<a name="l04648"></a>04648                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Canceling market offer with transaction number: &quot;</span> + extra_vals.<a class="code" href="classthe__lambda__struct.html#a5e6b79a66d1c1a2bcb90c85a3e13447f">the_vector</a>[i] + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04649"></a>04649 
<a name="l04650"></a>04650                     <a class="code" href="class_o_t___command.html#adbdd807ddf16bcbcee8d54fa5043f409">OT_Command::details_kill_offer</a>(strMyServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, extra_vals.<a class="code" href="classthe__lambda__struct.html#a5e6b79a66d1c1a2bcb90c85a3e13447f">the_vector</a>[i]);
<a name="l04651"></a>04651                 }
<a name="l04652"></a>04652                 extra_vals.<a class="code" href="classthe__lambda__struct.html#a5e6b79a66d1c1a2bcb90c85a3e13447f">the_vector</a>.clear();
<a name="l04653"></a>04653             }
<a name="l04654"></a>04654         }
<a name="l04655"></a>04655         <span class="keywordflow">else</span>
<a name="l04656"></a>04656         {
<a name="l04657"></a>04657             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: FYI, there don&#39;t seem to be any existing offers for this nym, so I won&#39;t be erasing any older ones.\n&quot;</span>);
<a name="l04658"></a>04658         }
<a name="l04659"></a>04659     }
<a name="l04660"></a>04660     <span class="comment">// ********************************************************************</span>
<a name="l04661"></a>04661 
<a name="l04662"></a>04662     <span class="comment">// OKAY! Now that we&#39;ve cleaned out any undesirable offers, let&#39;s place the</span>
<a name="l04663"></a>04663     <span class="comment">// the offer itself!</span>
<a name="l04664"></a>04664 
<a name="l04665"></a>04665 
<a name="l04666"></a>04666     <span class="comment">//</span>
<a name="l04667"></a>04667     <span class="comment">// Send the &quot;create offer&quot; transaction.</span>
<a name="l04668"></a>04668     <span class="comment">//</span>
<a name="l04669"></a>04669     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a40049fc8b5ab0ff2f7de843bef970d45">MadeEasy::create_market_offer</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a14c05117086a8a7a1ea04055b8f48944">HisAcct</a>, strScale, strMinIncrement, strQuantity, strPrice, bSelling, strLifespan, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>); <span class="comment">// lifespan of &quot;0&quot; results in &quot;86400&quot; == 1 day. Last two params are stop sign and stop price.</span>
<a name="l04670"></a>04670     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;create_market_offer&quot;</span>;
<a name="l04671"></a>04671 
<a name="l04672"></a>04672     <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l04673"></a>04673     <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l04674"></a>04674     <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l04675"></a>04675 
<a name="l04676"></a>04676     <span class="comment">// ***************************************************************</span>
<a name="l04677"></a>04677 
<a name="l04678"></a>04678     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strMyServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strAttempt, strResponse);
<a name="l04679"></a>04679 
<a name="l04680"></a>04680     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l04681"></a>04681     {
<a name="l04682"></a>04682         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS placing market offer!\n\n&quot;</span>);
<a name="l04683"></a>04683     }
<a name="l04684"></a>04684 
<a name="l04685"></a>04685     <span class="keywordflow">return</span> nInterpretReply;
<a name="l04686"></a>04686 }
<a name="l04687"></a>04687 
<a name="l04688"></a>04688 
<a name="l04689"></a><a class="code" href="class_o_t___command.html#aef057371e0005c90a255ffd2bbc10fcc">04689</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aef057371e0005c90a255ffd2bbc10fcc">OT_Command::main_create_offer</a>()
<a name="l04690"></a>04690 {
<a name="l04691"></a>04691     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n USAGE: newoffer --myacct &lt;YOUR_ASSET_ACCT&gt; --hisacct &lt;YOUR_CURRENCY_ACCT&gt;\n\n&quot;</span>,
<a name="l04692"></a>04692         <span class="stringliteral">&quot; Optional: --args \&quot;type &lt;bid|ask&gt; scale 1 quantity 100 price 101\&quot;\n Optional: --args \&quot;lifespan 86400\&quot;   (in seconds: 86400 is 1 day--the default.)\n\nWARNING: a price of 0 is a market order, which means &#39;purchase/sell at ANY price&#39;\n\n&quot;</span>);
<a name="l04693"></a>04693 
<a name="l04694"></a>04694     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l04695"></a>04695 
<a name="l04696"></a>04696 
<a name="l04697"></a>04697     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisAcct&quot;</span>))
<a name="l04698"></a>04698     {
<a name="l04699"></a>04699         <span class="keywordtype">string</span> strScale = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be 1, 10, 100, etc</span>
<a name="l04700"></a>04700         <span class="keywordtype">string</span> strMinIncrement = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be 1, 2, 3, etc</span>
<a name="l04701"></a>04701         <span class="keywordtype">string</span> strQuantity = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l04702"></a>04702         <span class="keywordtype">string</span> strPrice = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be &gt;= 0</span>
<a name="l04703"></a>04703         <span class="keywordtype">string</span> strType = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// must be bid or ask</span>
<a name="l04704"></a>04704         <span class="keywordtype">string</span> strLifespan = <span class="stringliteral">&quot;0&quot;</span>;
<a name="l04705"></a>04705 
<a name="l04706"></a>04706         <span class="keywordtype">string</span> strDefaultScale = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be 1, 10, 100, etc</span>
<a name="l04707"></a>04707         <span class="keywordtype">string</span> strDefaultMinIncrement = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be 1, 2, 3, etc</span>
<a name="l04708"></a>04708         <span class="keywordtype">string</span> strDefaultQuantity = <span class="stringliteral">&quot;100&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l04709"></a>04709         <span class="keywordtype">string</span> strDefaultPrice = <span class="stringliteral">&quot;101&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l04710"></a>04710         <span class="keywordtype">string</span> strDefaultType = <span class="stringliteral">&quot;bid&quot;</span>; <span class="comment">// must be bid or ask</span>
<a name="l04711"></a>04711         <span class="keywordtype">string</span> strDefaultLifespan = <span class="stringliteral">&quot;86400&quot;</span>; <span class="comment">// even if we put &quot;0&quot; here, OT would internally default this to 86400.</span>
<a name="l04712"></a>04712 
<a name="l04713"></a>04713         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l04714"></a>04714         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l04715"></a>04715         <span class="comment">// at the command line.</span>
<a name="l04716"></a>04716         <span class="comment">//</span>
<a name="l04717"></a>04717         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l04718"></a>04718         {
<a name="l04719"></a>04719             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l04720"></a>04720             <span class="comment">//                                  const std::string str_key)</span>
<a name="l04721"></a>04721             <span class="comment">//</span>
<a name="l04722"></a>04722             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l04723"></a>04723             <span class="comment">// EXAMPLE:  --args &quot;type bid scale 1 quantity 100 price 101&quot;</span>
<a name="l04724"></a>04724             <span class="comment">// EXAMPLE:  --args &quot;type ask scale 1 quantity 100 price 101&quot;</span>
<a name="l04725"></a>04725             <span class="comment">//</span>
<a name="l04726"></a>04726             <span class="keywordtype">string</span> strNewScale = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;scale&quot;</span>); <span class="comment">// 1, 10, 100, 1000, etc</span>
<a name="l04727"></a>04727             <span class="keywordtype">string</span> strNewMinInc = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;min_inc&quot;</span>); <span class="comment">// 1, 2, 3, 4, etc. Usually 1.</span>
<a name="l04728"></a>04728             <span class="keywordtype">string</span> strNewQuantity = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;quantity&quot;</span>); <span class="comment">// quantity for sale/purchase.</span>
<a name="l04729"></a>04729             <span class="keywordtype">string</span> strNewPrice = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;price&quot;</span>); <span class="comment">// per scale</span>
<a name="l04730"></a>04730             <span class="keywordtype">string</span> strNewType = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;type&quot;</span>); <span class="comment">// bid / ask</span>
<a name="l04731"></a>04731             <span class="keywordtype">string</span> strNewLifespan = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;lifespan&quot;</span>); <span class="comment">// &quot;0&quot; defaults to &quot;86400&quot; which is 1 day.</span>
<a name="l04732"></a>04732 
<a name="l04733"></a>04733 
<a name="l04734"></a>04734             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l04735"></a>04735             <span class="comment">//</span>
<a name="l04736"></a>04736             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewScale))
<a name="l04737"></a>04737             {
<a name="l04738"></a>04738                 strScale = strNewScale;
<a name="l04739"></a>04739             }
<a name="l04740"></a>04740             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMinInc))
<a name="l04741"></a>04741             {
<a name="l04742"></a>04742                 strMinIncrement = strNewMinInc;
<a name="l04743"></a>04743             }
<a name="l04744"></a>04744             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewQuantity))
<a name="l04745"></a>04745             {
<a name="l04746"></a>04746                 strQuantity = strNewQuantity;
<a name="l04747"></a>04747             }
<a name="l04748"></a>04748             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewPrice))
<a name="l04749"></a>04749             {
<a name="l04750"></a>04750                 strPrice = strNewPrice;
<a name="l04751"></a>04751             }
<a name="l04752"></a>04752             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewType))
<a name="l04753"></a>04753             {
<a name="l04754"></a>04754                 strType = strNewType;
<a name="l04755"></a>04755             }
<a name="l04756"></a>04756             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLifespan))
<a name="l04757"></a>04757             {
<a name="l04758"></a>04758                 strLifespan = strNewLifespan;
<a name="l04759"></a>04759             }
<a name="l04760"></a>04760         }
<a name="l04761"></a>04761 
<a name="l04762"></a>04762         <span class="comment">// If the offer parameters aren&#39;t satisfied yet, then</span>
<a name="l04763"></a>04763         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l04764"></a>04764         <span class="comment">//</span>
<a name="l04765"></a>04765         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strScale) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strScale) &lt; 1))
<a name="l04766"></a>04766         {
<a name="l04767"></a>04767             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the market scale (1, 10, 100, etc)[&quot;</span> + strDefaultScale + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04768"></a>04768             strScale = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04769"></a>04769         }
<a name="l04770"></a>04770         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMinIncrement) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strMinIncrement) &lt; 1))
<a name="l04771"></a>04771         {
<a name="l04772"></a>04772             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the minimum increment[&quot;</span> + strDefaultMinIncrement + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04773"></a>04773             strMinIncrement = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04774"></a>04774         }
<a name="l04775"></a>04775         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strQuantity) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strQuantity) &lt; 1))
<a name="l04776"></a>04776         {
<a name="l04777"></a>04777             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the quantity being purchased/sold[&quot;</span> + strDefaultQuantity + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04778"></a>04778             strQuantity = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04779"></a>04779         }
<a name="l04780"></a>04780         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPrice) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strPrice) &lt; 0))
<a name="l04781"></a>04781         {
<a name="l04782"></a>04782             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the price per scale[&quot;</span> + strDefaultPrice + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04783"></a>04783             strPrice = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04784"></a>04784         }
<a name="l04785"></a>04785         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType) || ((strType != <span class="stringliteral">&quot;bid&quot;</span>) &amp;&amp; (strType != <span class="stringliteral">&quot;ask&quot;</span>)))
<a name="l04786"></a>04786         {
<a name="l04787"></a>04787             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the order type (bid/ask) [&quot;</span> + strDefaultType + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04788"></a>04788             strType = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04789"></a>04789         }
<a name="l04790"></a>04790         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLifespan) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strLifespan) &lt; 1))
<a name="l04791"></a>04791         {
<a name="l04792"></a>04792             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(1 hour == 3600, 1 day == 86400)\n Enter the lifespan of the offer, in seconds[&quot;</span> + strDefaultLifespan + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l04793"></a>04793             strLifespan = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l04794"></a>04794         }
<a name="l04795"></a>04795 
<a name="l04796"></a>04796         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strScale) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strScale) &lt; 1))
<a name="l04797"></a>04797         {
<a name="l04798"></a>04798             strScale = strDefaultScale;
<a name="l04799"></a>04799         }
<a name="l04800"></a>04800         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMinIncrement) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strMinIncrement) &lt; 1))
<a name="l04801"></a>04801         {
<a name="l04802"></a>04802             strMinIncrement = strDefaultMinIncrement;
<a name="l04803"></a>04803         }
<a name="l04804"></a>04804         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strQuantity) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strQuantity) &lt; 1))
<a name="l04805"></a>04805         {
<a name="l04806"></a>04806             strQuantity = strDefaultQuantity;
<a name="l04807"></a>04807         }
<a name="l04808"></a>04808         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPrice) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strPrice) &lt; 1))
<a name="l04809"></a>04809         {
<a name="l04810"></a>04810             strPrice = strDefaultPrice;
<a name="l04811"></a>04811         }
<a name="l04812"></a>04812         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType) || ((strType != <span class="stringliteral">&quot;bid&quot;</span>) &amp;&amp; (strType != <span class="stringliteral">&quot;ask&quot;</span>)))
<a name="l04813"></a>04813         {
<a name="l04814"></a>04814             strType = strDefaultType;
<a name="l04815"></a>04815         }
<a name="l04816"></a>04816         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLifespan) || (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strLifespan) &lt; 1))
<a name="l04817"></a>04817         {
<a name="l04818"></a>04818             strLifespan = strDefaultLifespan;
<a name="l04819"></a>04819         }
<a name="l04820"></a>04820 
<a name="l04821"></a>04821         <span class="comment">//</span>
<a name="l04822"></a>04822         <span class="comment">// false == buying    bid</span>
<a name="l04823"></a>04823         <span class="comment">// true  == selling   ask</span>
<a name="l04824"></a>04824         <span class="comment">//</span>
<a name="l04825"></a>04825         <span class="keywordtype">bool</span> bType = ((strType == <span class="stringliteral">&quot;bid&quot;</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>);
<a name="l04826"></a>04826 
<a name="l04827"></a>04827         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#aba7c10f399336067f1ba600abdc53e2e">details_create_offer</a>(strScale, strMinIncrement, strQuantity, strPrice, bType, strLifespan);
<a name="l04828"></a>04828     }
<a name="l04829"></a>04829 
<a name="l04830"></a>04830     <span class="keywordflow">return</span> -1;
<a name="l04831"></a>04831 }
<a name="l04832"></a>04832 
<a name="l04833"></a>04833 
<a name="l04834"></a><a class="code" href="class_o_t___command.html#aad2b6b044c486fa2efccf0f57747c2f1">04834</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aad2b6b044c486fa2efccf0f57747c2f1">OT_Command::main_create_server_contract</a>()
<a name="l04835"></a>04835 {
<a name="l04836"></a>04836     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l04837"></a>04837     {
<a name="l04838"></a>04838         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the XML contents for the contract, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l04839"></a>04839 
<a name="l04840"></a>04840         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l04841"></a>04841         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l04842"></a>04842         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l04843"></a>04843         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l04844"></a>04844 
<a name="l04845"></a>04845         <span class="keywordtype">string</span> strXML = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l04846"></a>04846 
<a name="l04847"></a>04847         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strXML))
<a name="l04848"></a>04848         {
<a name="l04849"></a>04849             <span class="keywordtype">string</span> strContractID = <a class="code" href="class_o_t_a_p_i___wrap.html#a673cc23cfc06e2cf20f25d9b690538eb">OTAPI_Wrap::CreateServerContract</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strXML);
<a name="l04850"></a>04850 
<a name="l04851"></a>04851             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContractID))
<a name="l04852"></a>04852             {
<a name="l04853"></a>04853                 <span class="comment">// stderr</span>
<a name="l04854"></a>04854                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nNew server ID: &quot;</span> + strContractID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04855"></a>04855 
<a name="l04856"></a>04856                 <span class="keywordtype">string</span> strContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a7d6d81a861d60c73ec5b407fc1448d6b">OTAPI_Wrap::GetServer_Contract</a>(strContractID);
<a name="l04857"></a>04857 
<a name="l04858"></a>04858                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l04859"></a>04859                 {
<a name="l04860"></a>04860                     <span class="comment">// stderr</span>
<a name="l04861"></a>04861                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nNew server contract:\n\n&quot;</span>);
<a name="l04862"></a>04862 
<a name="l04863"></a>04863                     <span class="comment">// stdout</span>
<a name="l04864"></a>04864                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strContract);
<a name="l04865"></a>04865 
<a name="l04866"></a>04866                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04867"></a>04867 
<a name="l04868"></a>04868                     <span class="keywordflow">return</span> 1;
<a name="l04869"></a>04869                 }
<a name="l04870"></a>04870             }
<a name="l04871"></a>04871         }
<a name="l04872"></a>04872     }
<a name="l04873"></a>04873 
<a name="l04874"></a>04874     <span class="comment">// &quot;return value&quot;</span>
<a name="l04875"></a>04875     <span class="keywordflow">return</span> -1;
<a name="l04876"></a>04876 }
<a name="l04877"></a>04877 
<a name="l04878"></a>04878 
<a name="l04879"></a><a class="code" href="class_o_t___command.html#ad76bf886854eef17786a522efbf04f32">04879</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad76bf886854eef17786a522efbf04f32">OT_Command::main_create_asset_contract</a>()
<a name="l04880"></a>04880 {
<a name="l04881"></a>04881     <span class="comment">// bool OTContract::CreateContract(OTString &amp; strContract, OTPseudonym &amp; theSigner)</span>
<a name="l04882"></a>04882 
<a name="l04883"></a>04883     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l04884"></a>04884     {
<a name="l04885"></a>04885         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter the XML contents for the contract, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l04886"></a>04886 
<a name="l04887"></a>04887         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l04888"></a>04888         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l04889"></a>04889         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l04890"></a>04890         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l04891"></a>04891 
<a name="l04892"></a>04892         <span class="keywordtype">string</span> strXML = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l04893"></a>04893 
<a name="l04894"></a>04894         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strXML))
<a name="l04895"></a>04895         {
<a name="l04896"></a>04896             <span class="keywordtype">string</span> strContractID = <a class="code" href="class_o_t_a_p_i___wrap.html#a414040ae9d4d3d073e064f3ba83cf2d1">OTAPI_Wrap::CreateAssetContract</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strXML);
<a name="l04897"></a>04897 
<a name="l04898"></a>04898             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContractID))
<a name="l04899"></a>04899             {
<a name="l04900"></a>04900                 <span class="comment">// stderr</span>
<a name="l04901"></a>04901                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nNew asset ID: &quot;</span> + strContractID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04902"></a>04902 
<a name="l04903"></a>04903                 <span class="keywordtype">string</span> strContract = <a class="code" href="class_o_t_a_p_i___wrap.html#af9ff83a6990cb1e5fca1fe55062c4c78">OTAPI_Wrap::GetAssetType_Contract</a>(strContractID);
<a name="l04904"></a>04904 
<a name="l04905"></a>04905                 <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l04906"></a>04906                 {
<a name="l04907"></a>04907                     <span class="comment">// stderr</span>
<a name="l04908"></a>04908                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nNew asset contract:\n\n&quot;</span>);
<a name="l04909"></a>04909 
<a name="l04910"></a>04910                     <span class="comment">// stdout</span>
<a name="l04911"></a>04911                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strContract);
<a name="l04912"></a>04912 
<a name="l04913"></a>04913                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04914"></a>04914 
<a name="l04915"></a>04915                     <span class="keywordflow">return</span> 1;
<a name="l04916"></a>04916                 }
<a name="l04917"></a>04917             }
<a name="l04918"></a>04918         }
<a name="l04919"></a>04919     }
<a name="l04920"></a>04920 
<a name="l04921"></a>04921     <span class="comment">// &quot;return value&quot;</span>
<a name="l04922"></a>04922     <span class="keywordflow">return</span> -1;
<a name="l04923"></a>04923 }
<a name="l04924"></a>04924 
<a name="l04925"></a>04925 
<a name="l04926"></a><a class="code" href="class_o_t___command.html#a00b029d6075bc06e4a41d4dd3cc10b5a">04926</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a00b029d6075bc06e4a41d4dd3cc10b5a">OT_Command::main_create_acct</a>()
<a name="l04927"></a>04927 {
<a name="l04928"></a>04928     <span class="comment">// Just to show how easy it is now, let&#39;s try a &quot;create_asset_acct&quot; message.</span>
<a name="l04929"></a>04929     <span class="comment">// (It sends a NymID to the server, and downloads that Nym&#39;s public key.)</span>
<a name="l04930"></a>04930 
<a name="l04931"></a>04931     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>))
<a name="l04932"></a>04932     {
<a name="l04933"></a>04933         <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a73f78ec70cc379360856080be6093126">OTAPI_Wrap::IsNym_RegisteredAtServer</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>))
<a name="l04934"></a>04934         {
<a name="l04935"></a>04935             <span class="comment">// If the Nym&#39;s not registered at the server, then register him first.</span>
<a name="l04936"></a>04936             <a class="code" href="class_o_t___command.html#a5a9518d65d67da6ab845839e4a24c848">OT_Command::main_register_nym</a>();
<a name="l04937"></a>04937         }
<a name="l04938"></a>04938 
<a name="l04939"></a>04939         <span class="comment">// Send the request.</span>
<a name="l04940"></a>04940         <span class="comment">//</span>
<a name="l04941"></a>04941         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a31e2b75076aaf7a244b463b2d7edc54b">MadeEasy::create_asset_acct</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>); <span class="comment">// Send the &#39;create_asset_acct&#39; message to the server.</span>
<a name="l04942"></a>04942 
<a name="l04943"></a>04943         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l04944"></a>04944         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l04945"></a>04945         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l04946"></a>04946 
<a name="l04947"></a>04947         <span class="comment">// -1 error, 0 failure, 1 success.</span>
<a name="l04948"></a>04948         <span class="comment">//</span>
<a name="l04949"></a>04949         <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l04950"></a>04950         {
<a name="l04951"></a>04951             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\ncreate_asset_acct: Failed.\n\n&quot;</span>);
<a name="l04952"></a>04952             <span class="keywordflow">return</span> -1;
<a name="l04953"></a>04953         }
<a name="l04954"></a>04954         <span class="keywordflow">else</span>
<a name="l04955"></a>04955         {
<a name="l04956"></a>04956             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in create_asset_acct! Server response:\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l04957"></a>04957             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l04958"></a>04958             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n (Success in create_asset_acct)\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l04959"></a>04959             <span class="keywordflow">return</span> 1;
<a name="l04960"></a>04960         }
<a name="l04961"></a>04961     }
<a name="l04962"></a>04962 
<a name="l04963"></a>04963     <span class="comment">// Done!</span>
<a name="l04964"></a>04964     <span class="keywordflow">return</span> -1;
<a name="l04965"></a>04965 }
<a name="l04966"></a>04966 
<a name="l04967"></a>04967 
<a name="l04968"></a><a class="code" href="class_o_t___command.html#a65d5d6d861a9050375dd884e56beac71">04968</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a65d5d6d861a9050375dd884e56beac71">OT_Command::main_add_signature</a>()
<a name="l04969"></a>04969 {
<a name="l04970"></a>04970     <span class="comment">// SignContract erases all signatures and affixes a new one alone.</span>
<a name="l04971"></a>04971     <span class="comment">// But AddSignature, on the other hand, leaves all signatures in place, and simply adds yours to the list.</span>
<a name="l04972"></a>04972 
<a name="l04973"></a>04973     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l04974"></a>04974     {
<a name="l04975"></a>04975 
<a name="l04976"></a>04976         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter an already-signed contract you wish to add your signature to, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l04977"></a>04977 
<a name="l04978"></a>04978         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l04979"></a>04979         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l04980"></a>04980         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l04981"></a>04981         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l04982"></a>04982 
<a name="l04983"></a>04983         <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l04984"></a>04984 
<a name="l04985"></a>04985         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04986"></a>04986 
<a name="l04987"></a>04987         <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#a279b1c00cea513d23d150b2ed40f49a2">OTAPI_Wrap::AddSignature</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInput);
<a name="l04988"></a>04988 
<a name="l04989"></a>04989         <span class="comment">// stderr</span>
<a name="l04990"></a>04990         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nSigned:\n\n&quot;</span>);
<a name="l04991"></a>04991 
<a name="l04992"></a>04992         <span class="comment">// stdout</span>
<a name="l04993"></a>04993         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l04994"></a>04994 
<a name="l04995"></a>04995         <span class="comment">// stderr</span>
<a name="l04996"></a>04996         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l04997"></a>04997 
<a name="l04998"></a>04998         <span class="keywordflow">return</span> 1;
<a name="l04999"></a>04999     }
<a name="l05000"></a>05000 
<a name="l05001"></a>05001     <span class="comment">// &quot;return value&quot;</span>
<a name="l05002"></a>05002     <span class="keywordflow">return</span> -1;
<a name="l05003"></a>05003 }
<a name="l05004"></a>05004 
<a name="l05005"></a>05005 
<a name="l05006"></a><a class="code" href="class_o_t___command.html#ad22f1cdc6c196870ff72e48c77b11233">05006</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad22f1cdc6c196870ff72e48c77b11233">OT_Command::main_sign_contract</a>()
<a name="l05007"></a>05007 {
<a name="l05008"></a>05008     <span class="comment">// SignContract erases all signatures and affixes a new one alone.</span>
<a name="l05009"></a>05009     <span class="comment">// But AddSignature, on the other hand, leaves all signatures in place, and simply adds yours to the list.</span>
<a name="l05010"></a>05010 
<a name="l05011"></a>05011     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n FYI, USAGE: sign \n&quot;</span>,
<a name="l05012"></a>05012         <span class="stringliteral">&quot; Optionally, you may specify a contract type:  sign --args \&quot;type LEDGER\&quot;\nIn that example, the output would start with the bookend: -----BEGIN OT SIGNED LEDGER-----\n(You don&#39;t need to specify the type if the bookend is already present on the input string.)\n\n&quot;</span>);
<a name="l05013"></a>05013 
<a name="l05014"></a>05014     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05015"></a>05015 
<a name="l05016"></a>05016     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l05017"></a>05017     {
<a name="l05018"></a>05018         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter a contract to be signed, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l05019"></a>05019 
<a name="l05020"></a>05020         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l05021"></a>05021         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l05022"></a>05022         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l05023"></a>05023         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l05024"></a>05024 
<a name="l05025"></a>05025         <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l05026"></a>05026 
<a name="l05027"></a>05027         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l05028"></a>05028 
<a name="l05029"></a>05029         <span class="keywordtype">string</span> strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#adbd9aa954bfb00ec356390bc01c09a1e">OTAPI_Wrap::SignContract</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInput);
<a name="l05030"></a>05030 
<a name="l05031"></a>05031         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l05032"></a>05032         {
<a name="l05033"></a>05033             <span class="comment">// Maybe we need to flat sign (maybe it wasn&#39;t already a signed contract...)</span>
<a name="l05034"></a>05034             <span class="comment">//</span>
<a name="l05035"></a>05035             <span class="keywordtype">string</span> strContractType;
<a name="l05036"></a>05036 
<a name="l05037"></a>05037             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l05038"></a>05038             {
<a name="l05039"></a>05039                 strContractType = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l05040"></a>05040             }
<a name="l05041"></a>05041 
<a name="l05042"></a>05042             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContractType))
<a name="l05043"></a>05043             {
<a name="l05044"></a>05044                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;A properly-formed-and-signed contract was not provided, but a &#39;type&#39; was... so we&#39;ll try flatsigning the input text...\n\n&quot;</span>);
<a name="l05045"></a>05045                 strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#afdb600e562057d7bee59cee52a1b298b">OTAPI_Wrap::FlatSign</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInput, strContractType);
<a name="l05046"></a>05046             }
<a name="l05047"></a>05047             <span class="keywordflow">else</span>
<a name="l05048"></a>05048             {
<a name="l05049"></a>05049                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;A properly-formed-and-signed contract was not provided, and neither was a &#39;type&#39; in order to form one. (Failure.)\n&quot;</span>);
<a name="l05050"></a>05050                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05051"></a>05051                 <span class="keywordflow">return</span> -1;
<a name="l05052"></a>05052             }
<a name="l05053"></a>05053         }
<a name="l05054"></a>05054 
<a name="l05055"></a>05055 
<a name="l05056"></a>05056         int32_t nReturnVal = -1;
<a name="l05057"></a>05057 
<a name="l05058"></a>05058         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l05059"></a>05059         {
<a name="l05060"></a>05060             <span class="comment">// stderr</span>
<a name="l05061"></a>05061             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;-------------------------------------------\nSigned:\n\n&quot;</span>);
<a name="l05062"></a>05062 
<a name="l05063"></a>05063             <span class="comment">// stdout</span>
<a name="l05064"></a>05064             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput);
<a name="l05065"></a>05065 
<a name="l05066"></a>05066             nReturnVal = 1;
<a name="l05067"></a>05067         }
<a name="l05068"></a>05068         <span class="keywordflow">else</span>
<a name="l05069"></a>05069         {
<a name="l05070"></a>05070             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSorry, but OT was unable to sign. Oh well.&quot;</span>);
<a name="l05071"></a>05071         }
<a name="l05072"></a>05072 
<a name="l05073"></a>05073         <span class="comment">// stderr</span>
<a name="l05074"></a>05074         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l05075"></a>05075 
<a name="l05076"></a>05076         <span class="keywordflow">return</span> nReturnVal;
<a name="l05077"></a>05077     }
<a name="l05078"></a>05078 
<a name="l05079"></a>05079     <span class="comment">// &quot;return value&quot;</span>
<a name="l05080"></a>05080     <span class="keywordflow">return</span> -1;
<a name="l05081"></a>05081 }
<a name="l05082"></a>05082 
<a name="l05083"></a>05083 
<a name="l05084"></a><a class="code" href="class_o_t___command.html#adbdd807ddf16bcbcee8d54fa5043f409">05084</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#adbdd807ddf16bcbcee8d54fa5043f409">OT_Command::details_kill_offer</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strTransNum)
<a name="l05085"></a>05085 {
<a name="l05086"></a>05086     <span class="comment">// Just to show how easy it is now, let&#39;s try a &quot;kill_market_offer&quot; message.</span>
<a name="l05087"></a>05087     <span class="comment">// (It kills a market offer.)</span>
<a name="l05088"></a>05088 
<a name="l05089"></a>05089     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransNum))
<a name="l05090"></a>05090     {
<a name="l05091"></a>05091         <span class="comment">// Send the transaction.</span>
<a name="l05092"></a>05092         <span class="comment">//</span>
<a name="l05093"></a>05093         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#adc73e14717ab84b80a450cffa3957c88">MadeEasy::kill_market_offer</a>(strServerID, strNymID, strAcctID, strTransNum);
<a name="l05094"></a>05094 
<a name="l05095"></a>05095         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l05096"></a>05096         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l05097"></a>05097         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l05098"></a>05098 
<a name="l05099"></a>05099         <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l05100"></a>05100         {
<a name="l05101"></a>05101             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n killoffer: Failed.\n&quot;</span>);
<a name="l05102"></a>05102         }
<a name="l05103"></a>05103         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#af9277b00455b6e760011dd7b597761aa">VerifyMsgBalanceAgrmntSuccess</a>(strServerID, strNymID, strAcctID, strResponse))
<a name="l05104"></a>05104         {
<a name="l05105"></a>05105             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n killoffer: Balance agreement failed.\n&quot;</span>);
<a name="l05106"></a>05106         }
<a name="l05107"></a>05107         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#a711f019ab74c4afbe71dc745957bd98f">VerifyMsgTrnxSuccess</a>(strServerID, strNymID, strAcctID, strResponse))
<a name="l05108"></a>05108         {
<a name="l05109"></a>05109             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n killoffer: Balance agreement succeeded, but transaction failed.\n&quot;</span>);
<a name="l05110"></a>05110         }
<a name="l05111"></a>05111         <span class="keywordflow">else</span>
<a name="l05112"></a>05112         {
<a name="l05113"></a>05113             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nSuccess in killoffer! Server response:\n\n&quot;</span>);
<a name="l05114"></a>05114             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l05115"></a>05115             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05116"></a>05116             <span class="keywordflow">return</span> 1;
<a name="l05117"></a>05117         }
<a name="l05118"></a>05118     }
<a name="l05119"></a>05119 
<a name="l05120"></a>05120     <span class="comment">// Done!</span>
<a name="l05121"></a>05121     <span class="keywordflow">return</span> -1;
<a name="l05122"></a>05122 }
<a name="l05123"></a>05123 
<a name="l05124"></a>05124 
<a name="l05125"></a><a class="code" href="class_o_t___command.html#a5f641fcdcadbfc0370647607d8ce6883">05125</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5f641fcdcadbfc0370647607d8ce6883">OT_Command::main_kill_offer</a>()
<a name="l05126"></a>05126 {
<a name="l05127"></a>05127 
<a name="l05128"></a>05128 
<a name="l05129"></a>05129     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n FYI, used for killing an active market offer.\nUSAGE: killoffer --args \&quot;transnum &lt;transaction_number&gt;\&quot;\n\n&quot;</span>;
<a name="l05130"></a>05130 
<a name="l05131"></a>05131     <span class="comment">// Just to show how easy it is now, let&#39;s try a &quot;kill_market_offer&quot; message.</span>
<a name="l05132"></a>05132     <span class="comment">// (It kills a market offer.)</span>
<a name="l05133"></a>05133 
<a name="l05134"></a>05134     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l05135"></a>05135     {
<a name="l05136"></a>05136         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05137"></a>05137     }
<a name="l05138"></a>05138     <span class="keywordflow">else</span>
<a name="l05139"></a>05139     {
<a name="l05140"></a>05140         <span class="keywordtype">string</span> strTransactionNum = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;transnum&quot;</span>);
<a name="l05141"></a>05141 
<a name="l05142"></a>05142         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransactionNum))
<a name="l05143"></a>05143         {
<a name="l05144"></a>05144             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n\nYou need to provide a transaction number...\n\n&quot;</span>);
<a name="l05145"></a>05145             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05146"></a>05146         }
<a name="l05147"></a>05147         <span class="keywordflow">else</span>
<a name="l05148"></a>05148         {
<a name="l05149"></a>05149             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#adbdd807ddf16bcbcee8d54fa5043f409">details_kill_offer</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTransactionNum);
<a name="l05150"></a>05150         }
<a name="l05151"></a>05151     }
<a name="l05152"></a>05152 
<a name="l05153"></a>05153     <span class="comment">// Done!</span>
<a name="l05154"></a>05154     <span class="keywordflow">return</span> -1;
<a name="l05155"></a>05155 }
<a name="l05156"></a>05156 
<a name="l05157"></a>05157 
<a name="l05158"></a><a class="code" href="class_o_t___command.html#a8111a9ddba4a9d2bbc6fcdd979a58c23">05158</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8111a9ddba4a9d2bbc6fcdd979a58c23">OT_Command::main_kill_plan</a>()
<a name="l05159"></a>05159 {
<a name="l05160"></a>05160     <span class="comment">// string OT_CLI_GetValueByKey(Args, str_key)</span>
<a name="l05161"></a>05161 
<a name="l05162"></a>05162     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n FYI, used for stopping an active payment plan.\nUSAGE: killplan --args \&quot;transnum &lt;transaction_number&gt;\&quot;\n\n&quot;</span>;
<a name="l05163"></a>05163 
<a name="l05164"></a>05164     <span class="comment">// Just to show how easy it is now, let&#39;s try a &quot;kill_payment_plan&quot; message.</span>
<a name="l05165"></a>05165     <span class="comment">// It kills an active (already running) payment plan.</span>
<a name="l05166"></a>05166 
<a name="l05167"></a>05167     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>) || !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l05168"></a>05168     {
<a name="l05169"></a>05169         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05170"></a>05170     }
<a name="l05171"></a>05171     <span class="keywordflow">else</span>
<a name="l05172"></a>05172     {
<a name="l05173"></a>05173         <span class="keywordtype">string</span> strTransactionNum = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;transnum&quot;</span>);
<a name="l05174"></a>05174 
<a name="l05175"></a>05175         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransactionNum))
<a name="l05176"></a>05176         {
<a name="l05177"></a>05177             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n\nYou need to provide a transaction number...\n\n&quot;</span>);
<a name="l05178"></a>05178             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05179"></a>05179         }
<a name="l05180"></a>05180         <span class="keywordflow">else</span>
<a name="l05181"></a>05181         {
<a name="l05182"></a>05182             <span class="comment">// Send the transaction.</span>
<a name="l05183"></a>05183             <span class="comment">//</span>
<a name="l05184"></a>05184             <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a200f85c37d77902dcb0dc91ab407ecd9">MadeEasy::kill_payment_plan</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTransactionNum);
<a name="l05185"></a>05185 
<a name="l05186"></a>05186             <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l05187"></a>05187             <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l05188"></a>05188             <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l05189"></a>05189 
<a name="l05190"></a>05190             <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l05191"></a>05191             {
<a name="l05192"></a>05192                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nkill_payment_plan: Failed.\n&quot;</span>);
<a name="l05193"></a>05193             }
<a name="l05194"></a>05194             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#af9277b00455b6e760011dd7b597761aa">VerifyMsgBalanceAgrmntSuccess</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strResponse))
<a name="l05195"></a>05195             {
<a name="l05196"></a>05196                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nkill_payment_plan: Balance agreement failed.\n&quot;</span>);
<a name="l05197"></a>05197             }
<a name="l05198"></a>05198             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#a711f019ab74c4afbe71dc745957bd98f">VerifyMsgTrnxSuccess</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strResponse))
<a name="l05199"></a>05199             {
<a name="l05200"></a>05200                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nkill_payment_plan: Balance agreement succeeded, but transaction failed.\n&quot;</span>);
<a name="l05201"></a>05201             }
<a name="l05202"></a>05202             <span class="keywordflow">else</span>
<a name="l05203"></a>05203             {
<a name="l05204"></a>05204                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nSuccess in kill_payment_plan! Server response:\n\n&quot;</span>);
<a name="l05205"></a>05205                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l05206"></a>05206                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05207"></a>05207                 <span class="keywordflow">return</span> 1;
<a name="l05208"></a>05208             }
<a name="l05209"></a>05209         }
<a name="l05210"></a>05210     }
<a name="l05211"></a>05211 
<a name="l05212"></a>05212     <span class="comment">// Done!</span>
<a name="l05213"></a>05213     <span class="keywordflow">return</span> -1;
<a name="l05214"></a>05214 }
<a name="l05215"></a>05215 
<a name="l05216"></a>05216 
<a name="l05217"></a><a class="code" href="class_o_t___command.html#a79a0677aabf64639c5a537ff3aff62db">05217</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a79a0677aabf64639c5a537ff3aff62db">OT_Command::main_verify_signature</a>()
<a name="l05218"></a>05218 {
<a name="l05219"></a>05219     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>))
<a name="l05220"></a>05220     {
<a name="l05221"></a>05221         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please enter a contract you wish to verify with HisNym, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l05222"></a>05222 
<a name="l05223"></a>05223         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l05224"></a>05224         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l05225"></a>05225         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l05226"></a>05226         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l05227"></a>05227 
<a name="l05228"></a>05228         <span class="keywordtype">string</span> strInput = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l05229"></a>05229 
<a name="l05230"></a>05230         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n--------------------------------------\n You entered:\n&quot;</span> + strInput + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l05231"></a>05231 
<a name="l05232"></a>05232         <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
<a name="l05233"></a>05233 
<a name="l05234"></a>05234         bSuccess = <a class="code" href="class_o_t_a_p_i___wrap.html#a519859fade0f73fd4c041794be42b37f">OTAPI_Wrap::VerifySignature</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, strInput);
<a name="l05235"></a>05235 
<a name="l05236"></a>05236         <span class="keywordflow">if</span> (bSuccess)
<a name="l05237"></a>05237         {
<a name="l05238"></a>05238             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;\n\n *** Verified! ***\n\n&quot;</span>);
<a name="l05239"></a>05239             <span class="keywordflow">return</span> 1;
<a name="l05240"></a>05240         }
<a name="l05241"></a>05241         <span class="keywordflow">else</span>
<a name="l05242"></a>05242         {
<a name="l05243"></a>05243             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Failed!\n\n&quot;</span>);
<a name="l05244"></a>05244         }
<a name="l05245"></a>05245     }
<a name="l05246"></a>05246 
<a name="l05247"></a>05247     <span class="comment">// return value;</span>
<a name="l05248"></a>05248     <span class="keywordflow">return</span> -1;
<a name="l05249"></a>05249 }
<a name="l05250"></a>05250 
<a name="l05251"></a>05251 
<a name="l05252"></a><a class="code" href="class_o_t___command.html#a7372359847eb412a1e659ef68539a822">05252</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7372359847eb412a1e659ef68539a822">OT_Command::main_stat_nyms</a>()
<a name="l05253"></a>05253 {
<a name="l05254"></a>05254     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l05255"></a>05255     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** PSEUDONYMS: \n&quot;</span>);
<a name="l05256"></a>05256 
<a name="l05257"></a>05257     int32_t nNymCount = <a class="code" href="class_o_t_a_p_i___wrap.html#af604578f0d61acfade8c939f18a21dea">OTAPI_Wrap::GetNymCount</a>();
<a name="l05258"></a>05258 
<a name="l05259"></a>05259     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nNymCount; ++i)
<a name="l05260"></a>05260     {
<a name="l05261"></a>05261         <span class="keywordtype">string</span> strIndex = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i);
<a name="l05262"></a>05262         <span class="keywordtype">string</span> strID = <a class="code" href="class_o_t_a_p_i___wrap.html#aeff3051da795051afa430c634514bf56">OTAPI_Wrap::GetNym_ID</a>(i);
<a name="l05263"></a>05263         <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strID);
<a name="l05264"></a>05264 
<a name="l05265"></a>05265         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strIndex + <span class="stringliteral">&quot;: &quot;</span> + strID + <span class="stringliteral">&quot; ---  &quot;</span> + strName);
<a name="l05266"></a>05266     }
<a name="l05267"></a>05267 
<a name="l05268"></a>05268     <span class="keywordflow">return</span> 1;
<a name="l05269"></a>05269 }
<a name="l05270"></a>05270 
<a name="l05271"></a><a class="code" href="class_o_t___command.html#a94032463c92b681159a5e539b615ac4d">05271</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a94032463c92b681159a5e539b615ac4d">OT_Command::main_stat_servers</a>()
<a name="l05272"></a>05272 {
<a name="l05273"></a>05273     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l05274"></a>05274     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** SERVERS: \n&quot;</span>);
<a name="l05275"></a>05275     int32_t nServerCount = <a class="code" href="class_o_t_a_p_i___wrap.html#ad3278dc766104d4acfc4c8fc3f3256e4">OTAPI_Wrap::GetServerCount</a>();
<a name="l05276"></a>05276 
<a name="l05277"></a>05277     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nServerCount; ++i)
<a name="l05278"></a>05278     {
<a name="l05279"></a>05279         <span class="keywordtype">string</span> strIndex = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(i);
<a name="l05280"></a>05280         <span class="keywordtype">string</span> strID = <a class="code" href="class_o_t_a_p_i___wrap.html#a31c0c2f097fa8357ef3703489e5d3810">OTAPI_Wrap::GetServer_ID</a>(i);
<a name="l05281"></a>05281         <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a856f371dd21dba6d6777b6bd087b9518">OTAPI_Wrap::GetServer_Name</a>(strID);
<a name="l05282"></a>05282 
<a name="l05283"></a>05283         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strIndex + <span class="stringliteral">&quot;: &quot;</span> + strID + <span class="stringliteral">&quot; ---  &quot;</span> + strName);
<a name="l05284"></a>05284     }
<a name="l05285"></a>05285 
<a name="l05286"></a>05286     <span class="keywordflow">return</span> 1;
<a name="l05287"></a>05287 }
<a name="l05288"></a>05288 
<a name="l05289"></a>05289 
<a name="l05290"></a><a class="code" href="class_o_t___command.html#ab0ee12477862b43af1141cf2f3f1157b">05290</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab0ee12477862b43af1141cf2f3f1157b">OT_Command::main_stat_assets</a>()
<a name="l05291"></a>05291 {
<a name="l05292"></a>05292     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l05293"></a>05293     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** ASSET TYPES: \n&quot;</span>);
<a name="l05294"></a>05294     int32_t nAssetTypeCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a198d0167a16f21047de145d8a19ee4fa">OTAPI_Wrap::GetAssetTypeCount</a>();
<a name="l05295"></a>05295 
<a name="l05296"></a>05296     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nAssetTypeCount; ++i)
<a name="l05297"></a>05297     {
<a name="l05298"></a>05298         <span class="keywordtype">string</span> strID = <a class="code" href="class_o_t_a_p_i___wrap.html#aefee6b3a901c826436038921f17d1bcf">OTAPI_Wrap::GetAssetType_ID</a>(i);
<a name="l05299"></a>05299         <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strID);
<a name="l05300"></a>05300 
<a name="l05301"></a>05301         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strID + <span class="stringliteral">&quot; ---  &quot;</span> + strName);
<a name="l05302"></a>05302     }
<a name="l05303"></a>05303 
<a name="l05304"></a>05304     <span class="keywordflow">return</span> 1;
<a name="l05305"></a>05305 }
<a name="l05306"></a>05306 
<a name="l05307"></a>05307 
<a name="l05308"></a><a class="code" href="class_o_t___command.html#a049f2af8464bd3a109fde1c1a079701d">05308</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a049f2af8464bd3a109fde1c1a079701d">OT_Command::main_stat_accounts</a>()
<a name="l05309"></a>05309 {
<a name="l05310"></a>05310     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l05311"></a>05311     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot; ** ACCOUNTS: \n&quot;</span>);
<a name="l05312"></a>05312 
<a name="l05313"></a>05313     int32_t nAccountCount = <a class="code" href="class_o_t_a_p_i___wrap.html#afbe43c28c4617b76122db11a8134564f">OTAPI_Wrap::GetAccountCount</a>();
<a name="l05314"></a>05314 
<a name="l05315"></a>05315     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nAccountCount; ++i)
<a name="l05316"></a>05316     {
<a name="l05317"></a>05317         <span class="keywordflow">if</span> ((i &gt; 0) &amp;&amp; (i != (nAccountCount))) { <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;-------------------------------------&quot;</span>); }
<a name="l05318"></a>05318         <span class="keywordtype">string</span> strID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae265c713020535f996c26367f8eb6044">OTAPI_Wrap::GetAccountWallet_ID</a>(i);
<a name="l05319"></a>05319         <span class="keywordtype">string</span> strStatAcct = <a class="code" href="class_made_easy.html#a3ad1fb67e91e244734b63f24d93c686b">MadeEasy::stat_asset_account</a>(strID);
<a name="l05320"></a>05320         <span class="keywordtype">bool</span> bSuccess = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strStatAcct);
<a name="l05321"></a>05321         <span class="keywordflow">if</span> (bSuccess)
<a name="l05322"></a>05322         {
<a name="l05323"></a>05323             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strStatAcct);
<a name="l05324"></a>05324         }
<a name="l05325"></a>05325         <span class="keywordflow">else</span>
<a name="l05326"></a>05326         {
<a name="l05327"></a>05327             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Error trying to stat an asset account: &quot;</span> + strID);
<a name="l05328"></a>05328         }
<a name="l05329"></a>05329         <span class="comment">// stderr</span>
<a name="l05330"></a>05330         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l05331"></a>05331     }
<a name="l05332"></a>05332     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------------------------------------------&quot;</span>);
<a name="l05333"></a>05333 
<a name="l05334"></a>05334     <span class="keywordflow">return</span> 1;
<a name="l05335"></a>05335 }
<a name="l05336"></a>05336 
<a name="l05337"></a><a class="code" href="class_o_t___command.html#a21a3411c7827df7a7e0f2c64510f4cf1">05337</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a21a3411c7827df7a7e0f2c64510f4cf1">OT_Command::main_stat</a>()
<a name="l05338"></a>05338 {
<a name="l05339"></a>05339     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l05340"></a>05340 
<a name="l05341"></a>05341     <a class="code" href="class_o_t___command.html#a7372359847eb412a1e659ef68539a822">OT_Command::main_stat_nyms</a>();
<a name="l05342"></a>05342     <a class="code" href="class_o_t___command.html#a94032463c92b681159a5e539b615ac4d">OT_Command::main_stat_servers</a>();
<a name="l05343"></a>05343     <a class="code" href="class_o_t___command.html#ab0ee12477862b43af1141cf2f3f1157b">OT_Command::main_stat_assets</a>();
<a name="l05344"></a>05344     <a class="code" href="class_o_t___command.html#a049f2af8464bd3a109fde1c1a079701d">OT_Command::main_stat_accounts</a>();
<a name="l05345"></a>05345 
<a name="l05346"></a>05346     <span class="keywordflow">return</span> 1;
<a name="l05347"></a>05347 }
<a name="l05348"></a>05348 
<a name="l05349"></a>05349 
<a name="l05350"></a><a class="code" href="class_o_t___command.html#a0c20431b9a52152cbf59dd167432ffa8">05350</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a0c20431b9a52152cbf59dd167432ffa8">OT_Command::details_stat_account</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strID)
<a name="l05351"></a>05351 {
<a name="l05352"></a>05352     <span class="comment">// stderr</span>
<a name="l05353"></a>05353     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n------------------------------------------------------------------\n&quot;</span>);
<a name="l05354"></a>05354 
<a name="l05355"></a>05355     <span class="keywordtype">string</span> strStatAcct = <a class="code" href="class_made_easy.html#a3ad1fb67e91e244734b63f24d93c686b">MadeEasy::stat_asset_account</a>(strID);
<a name="l05356"></a>05356 
<a name="l05357"></a>05357     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strStatAcct);
<a name="l05358"></a>05358     int32_t nSuccess = (bSuccess ? 1 : -1);
<a name="l05359"></a>05359 
<a name="l05360"></a>05360     <span class="keywordflow">if</span> (bSuccess)
<a name="l05361"></a>05361     {
<a name="l05362"></a>05362         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strStatAcct);
<a name="l05363"></a>05363     }
<a name="l05364"></a>05364     <span class="keywordflow">else</span>
<a name="l05365"></a>05365     {
<a name="l05366"></a>05366         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Error trying to stat an asset account: &quot;</span> + strID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l05367"></a>05367     }
<a name="l05368"></a>05368     <span class="comment">// stderr</span>
<a name="l05369"></a>05369     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l05370"></a>05370 
<a name="l05371"></a>05371     <span class="keywordflow">return</span> nSuccess;
<a name="l05372"></a>05372 }
<a name="l05373"></a>05373 
<a name="l05374"></a>05374 
<a name="l05375"></a><a class="code" href="class_o_t___command.html#a5d4e85c245088d585622563e6e1e7156">05375</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5d4e85c245088d585622563e6e1e7156">OT_Command::main_stat_acct</a>()
<a name="l05376"></a>05376 {
<a name="l05377"></a>05377     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05378"></a>05378     {
<a name="l05379"></a>05379         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a0c20431b9a52152cbf59dd167432ffa8">details_stat_account</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l05380"></a>05380     }
<a name="l05381"></a>05381     <span class="keywordflow">return</span> -1;
<a name="l05382"></a>05382 }
<a name="l05383"></a>05383 
<a name="l05384"></a>05384 
<a name="l05385"></a><a class="code" href="class_o_t___command.html#ad048c980a6302cf691ffd00b0f33a369">05385</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad048c980a6302cf691ffd00b0f33a369">OT_Command::details_account_balance</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strID)
<a name="l05386"></a>05386 {
<a name="l05387"></a>05387     <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a18999957d285b958c3f683d3460a0b3f">OTAPI_Wrap::GetAccountWallet_Name</a>(strID);
<a name="l05388"></a>05388     <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strID);
<a name="l05389"></a>05389     int64_t lBalance = <a class="code" href="class_o_t_a_p_i___wrap.html#a8f2d5f06ab2a0527f589a5af757989c3">OTAPI_Wrap::GetAccountWallet_Balance</a>(strID);
<a name="l05390"></a>05390 
<a name="l05391"></a>05391     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n    Balance: &quot;</span>); <span class="comment">//stderr</span>
<a name="l05392"></a>05392     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetID, lBalance)); <span class="comment">// stdout</span>
<a name="l05393"></a>05393     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strID + <span class="stringliteral">&quot;   (&quot;</span> + strName + <span class="stringliteral">&quot;)\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l05394"></a>05394 
<a name="l05395"></a>05395     <span class="keywordflow">return</span> 1;
<a name="l05396"></a>05396 }
<a name="l05397"></a>05397 
<a name="l05398"></a><a class="code" href="class_o_t___command.html#ac814ed3923659663346a5da9e0a7074f">05398</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac814ed3923659663346a5da9e0a7074f">OT_Command::main_balance</a>()
<a name="l05399"></a>05399 {
<a name="l05400"></a>05400     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05401"></a>05401     {
<a name="l05402"></a>05402         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ad048c980a6302cf691ffd00b0f33a369">details_account_balance</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l05403"></a>05403     }
<a name="l05404"></a>05404     <span class="keywordflow">return</span> -1;
<a name="l05405"></a>05405 }
<a name="l05406"></a>05406 
<a name="l05407"></a>05407 
<a name="l05408"></a><a class="code" href="class_o_t___command.html#ae5d801b63fc9411bf91160392582a121">05408</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ae5d801b63fc9411bf91160392582a121">OT_Command::details_nym_stat</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strID)
<a name="l05409"></a>05409 {
<a name="l05410"></a>05410     <span class="comment">//  string strName    = OTAPI_Wrap::GetNym_Name(strID)</span>
<a name="l05411"></a>05411     <span class="keywordtype">string</span> strStats = <a class="code" href="class_o_t_a_p_i___wrap.html#abe9340292ad6baffff487e178c44b01b">OTAPI_Wrap::GetNym_Stats</a>(strID);
<a name="l05412"></a>05412 
<a name="l05413"></a>05413     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strStats); <span class="comment">// stdout</span>
<a name="l05414"></a>05414 
<a name="l05415"></a>05415     <span class="keywordflow">return</span> 1;
<a name="l05416"></a>05416 }
<a name="l05417"></a>05417 
<a name="l05418"></a>05418 
<a name="l05419"></a><a class="code" href="class_o_t___command.html#a4ac755eb8dc27c06ac310f502d87af58">05419</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a4ac755eb8dc27c06ac310f502d87af58">OT_Command::main_nym_stat</a>()
<a name="l05420"></a>05420 {
<a name="l05421"></a>05421     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l05422"></a>05422     {
<a name="l05423"></a>05423         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ae5d801b63fc9411bf91160392582a121">details_nym_stat</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l05424"></a>05424     }
<a name="l05425"></a>05425     <span class="keywordflow">return</span> -1;
<a name="l05426"></a>05426 }
<a name="l05427"></a>05427 
<a name="l05428"></a>05428 
<a name="l05429"></a><a class="code" href="class_o_t___command.html#ad278e540f106090026a07cb7ec9b8f47">05429</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad278e540f106090026a07cb7ec9b8f47">OT_Command::main_show_mint</a>()
<a name="l05430"></a>05430 {
<a name="l05431"></a>05431     <span class="comment">// SHOW MINT</span>
<a name="l05432"></a>05432     <span class="comment">//</span>
<a name="l05433"></a>05433     <span class="comment">// (Load a public mint from local storage and display it on the screen.</span>
<a name="l05434"></a>05434     <span class="comment">// If necessary, download it from the server.)</span>
<a name="l05435"></a>05435     <span class="comment">//</span>
<a name="l05436"></a>05436 
<a name="l05437"></a>05437     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>))
<a name="l05438"></a>05438     {
<a name="l05439"></a>05439         <span class="comment">// Just to show how easy it is now, let&#39;s load up a mint and display it.</span>
<a name="l05440"></a>05440         <span class="comment">// If this function is unable to load it, it will download the mint from</span>
<a name="l05441"></a>05441         <span class="comment">// the server.</span>
<a name="l05442"></a>05442         <span class="comment">//</span>
<a name="l05443"></a>05443         <span class="keywordtype">string</span> strMint = <a class="code" href="class_made_easy.html#afe2b07045aea23451aa7144badf9faf8">MadeEasy::load_or_retrieve_mint</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>); <span class="comment">// &lt;=====</span>
<a name="l05444"></a>05444 
<a name="l05445"></a>05445         <span class="comment">// NOTICE -- there&#39;s no need here to deal with retries, timeouts, request number, synching</span>
<a name="l05446"></a>05446         <span class="comment">// transaction number, download / process nymbox, etc! It&#39;s all handled interally.</span>
<a name="l05447"></a>05447         <span class="comment">//</span>
<a name="l05448"></a>05448         <span class="comment">// Simply &quot;verify&quot; the return value:</span>
<a name="l05449"></a>05449         <span class="comment">//</span>
<a name="l05450"></a>05450         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMint))
<a name="l05451"></a>05451         {
<a name="l05452"></a>05452             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n load_or_retrieve_mint: Failed.\n\n&quot;</span>);
<a name="l05453"></a>05453             <span class="keywordflow">return</span> -1;
<a name="l05454"></a>05454         }
<a name="l05455"></a>05455         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l05456"></a>05456         {
<a name="l05457"></a>05457             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05458"></a>05458             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strMint); <span class="comment">// stdout</span>
<a name="l05459"></a>05459             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05460"></a>05460             <span class="keywordflow">return</span> 1;
<a name="l05461"></a>05461         }
<a name="l05462"></a>05462     }
<a name="l05463"></a>05463 
<a name="l05464"></a>05464     <span class="comment">// Done!</span>
<a name="l05465"></a>05465     <span class="keywordflow">return</span> -1;
<a name="l05466"></a>05466 }
<a name="l05467"></a>05467 
<a name="l05468"></a>05468 
<a name="l05469"></a>05469 <span class="comment">// Creates a new Pseudonym and adds it to the wallet.</span>
<a name="l05470"></a>05470 <span class="comment">// (And sets the display name for the new Nym, in the wallet.)</span>
<a name="l05471"></a>05471 <span class="comment">// Prints the new NymID to stdout.</span>
<a name="l05472"></a>05472 <span class="comment">//</span>
<a name="l05473"></a>05473 <span class="comment">// Returns 1 for success, 0 for failure.</span>
<a name="l05474"></a>05474 <span class="comment">//</span>
<a name="l05475"></a><a class="code" href="class_o_t___command.html#a899f3ad50c746b5deb38fa33b82dfec9">05475</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a899f3ad50c746b5deb38fa33b82dfec9">OT_Command::details_create_nym</a>(<span class="keyword">const</span> int32_t nKeybits, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strName, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strSourceForNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAltLocation)
<a name="l05476"></a>05476 {
<a name="l05477"></a>05477     <span class="keywordtype">string</span> strNymID = <a class="code" href="class_made_easy.html#acb35d04a0d75d93209922fe7e51e26ee">MadeEasy::create_pseudonym</a>(nKeybits, strSourceForNymID, strAltLocation); <span class="comment">// returns new Nym ID</span>
<a name="l05478"></a>05478 
<a name="l05479"></a>05479     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymID))
<a name="l05480"></a>05480     {
<a name="l05481"></a>05481         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_create_nym: Failed in OT_ME::create_pseudonym(keybits == &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nKeybits) + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l05482"></a>05482         <span class="keywordflow">return</span> -1;
<a name="l05483"></a>05483     }
<a name="l05484"></a>05484     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success creating! &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nKeybits) + <span class="stringliteral">&quot; keybits, new ID: &quot;</span>); <span class="comment">// stderr</span>
<a name="l05485"></a>05485     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strNymID); <span class="comment">// stdout</span>
<a name="l05486"></a>05486     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l05487"></a>05487 
<a name="l05488"></a>05488     <span class="keywordtype">bool</span> bSetName = <a class="code" href="class_o_t_a_p_i___wrap.html#a0bc26e4cc6158477c32eaf0aabcc83a1">OTAPI_Wrap::SetNym_Name</a>(strNymID, <span class="comment">// subject</span>
<a name="l05489"></a>05489         strNymID, <span class="comment">// signer</span>
<a name="l05490"></a>05490         strName);
<a name="l05491"></a>05491     <span class="keywordflow">if</span> (!bSetName)
<a name="l05492"></a>05492     {
<a name="l05493"></a>05493         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed in OT_API_SetNym_Name(name == &quot;</span> + strName + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l05494"></a>05494         <span class="keywordflow">return</span> -1;
<a name="l05495"></a>05495     }
<a name="l05496"></a>05496 
<a name="l05497"></a>05497     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success setting name to: &quot;</span> + strName + <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05498"></a>05498     <span class="keywordflow">return</span> 1;
<a name="l05499"></a>05499 }
<a name="l05500"></a>05500 
<a name="l05501"></a>05501 
<a name="l05502"></a><a class="code" href="class_o_t___command.html#a8ea70cc94298f56d9f22b43e5a5d07ad">05502</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8ea70cc94298f56d9f22b43e5a5d07ad">OT_Command::main_create_nym</a>()
<a name="l05503"></a>05503 {
<a name="l05504"></a>05504     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:    newnym --args \&quot;keybits 1024 name \\\&quot;Bob&#39;s New Nym\\\&quot;\&quot;  \n&quot;</span>;
<a name="l05505"></a>05505     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;Optional: newnym --args \&quot;source \\\&quot;http://test.com/credential_IDs\\\&quot; \&quot;  \n&quot;</span>;
<a name="l05506"></a>05506     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;FYI, a source can be a URL, a Bitcoin address, a Namecoin address, a public key,\nor the unique DN info from a traditionally-issued cert. Hashing the source should\n produce the NymID. Also, the source should always (somehow) validate the\ncredential IDs, if they are to be trusted for their purported Nym.\nAnother optional parameter is &#39;altlocation&#39; which, in the case of DN info as a source, would be the \ndownload location where a Cert should be found with that DN info, or a PKI where the Cert can be found.\n\nNOTE: If you leave the source BLANK, then OT will just generate a public key to serve as the source. The\npublic key will be hashed to form the NymID, and all credentials for that Nym will need to be signed by\nthe corresponding private key. That&#39;s the only way they can be &#39;verified by their source.&#39;\n\n&quot;</span>;
<a name="l05507"></a>05507 
<a name="l05508"></a>05508     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05509"></a>05509 
<a name="l05510"></a>05510     int32_t nKeybits = 1024;
<a name="l05511"></a>05511     <span class="keywordtype">string</span> strName = <span class="stringliteral">&quot;New Nym&quot;</span>;
<a name="l05512"></a>05512     <span class="keywordtype">string</span> strSourceForNymID = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Leave this blank to use a key-based Nym. Otherwise provide a source to hash (to form the NymID. All credentials must somehow verify through this source.)</span>
<a name="l05513"></a>05513     <span class="keywordtype">string</span> strAltLocation = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05514"></a>05514 
<a name="l05515"></a>05515     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l05516"></a>05516     {
<a name="l05517"></a>05517         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l05518"></a>05518         <span class="comment">//                                  const std::string str_key)</span>
<a name="l05519"></a>05519         <span class="comment">//</span>
<a name="l05520"></a>05520         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l05521"></a>05521         <span class="comment">//</span>
<a name="l05522"></a>05522         <span class="comment">// EXAMPLE:  --args &quot;keybits 1024&quot;</span>
<a name="l05523"></a>05523         <span class="comment">//</span>
<a name="l05524"></a>05524         <span class="keywordtype">string</span> strKeybits = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;keybits&quot;</span>);
<a name="l05525"></a>05525         <span class="keywordtype">string</span> strNewName = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;name&quot;</span>);
<a name="l05526"></a>05526         <span class="keywordtype">string</span> strNewSource = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;source&quot;</span>);
<a name="l05527"></a>05527         <span class="keywordtype">string</span> strNewLocation = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;location&quot;</span>);
<a name="l05528"></a>05528 
<a name="l05529"></a>05529         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strKeybits) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strKeybits) &gt; 0))
<a name="l05530"></a>05530         {
<a name="l05531"></a>05531             nKeybits = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strKeybits);
<a name="l05532"></a>05532         }
<a name="l05533"></a>05533 
<a name="l05534"></a>05534         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewName))
<a name="l05535"></a>05535         {
<a name="l05536"></a>05536             strName = strNewName;
<a name="l05537"></a>05537         }
<a name="l05538"></a>05538 
<a name="l05539"></a>05539         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewSource))
<a name="l05540"></a>05540         {
<a name="l05541"></a>05541             strSourceForNymID = strNewSource;
<a name="l05542"></a>05542         }
<a name="l05543"></a>05543 
<a name="l05544"></a>05544         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewLocation))
<a name="l05545"></a>05545         {
<a name="l05546"></a>05546             strAltLocation = strNewLocation;
<a name="l05547"></a>05547         }
<a name="l05548"></a>05548     }
<a name="l05549"></a>05549 
<a name="l05550"></a>05550 
<a name="l05551"></a>05551     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a899f3ad50c746b5deb38fa33b82dfec9">details_create_nym</a>(nKeybits, strName, strSourceForNymID, strAltLocation);
<a name="l05552"></a>05552 }
<a name="l05553"></a>05553 
<a name="l05554"></a>05554 
<a name="l05555"></a>05555 <span class="comment">/*</span>
<a name="l05556"></a>05556 <span class="comment">call OTAPI_Wrap::LoadInbox() to load the inbox ledger from local storage.</span>
<a name="l05557"></a>05557 <span class="comment"></span>
<a name="l05558"></a>05558 <span class="comment">During this time, your user has the opportunity to peruse the inbox, and to decide which transactions therein he wishes to accept or reject. Usually the inbox is display on the screen, then the user selects various items to accept or reject, and then the user clicks Process Inbox and then you do this:</span>
<a name="l05559"></a>05559 <span class="comment">Then call OTAPI_Wrap::Ledger_CreateResponse() in order to create a response ledger for that inbox, which will be sent to the server to signal your responses to the various inbox transactions.</span>
<a name="l05560"></a>05560 <span class="comment">Then call OTAPI_Wrap::Ledger_GetCount() (pass it the inbox) to find out how many transactions are inside of it. Use that count to LOOP through them</span>
<a name="l05561"></a>05561 <span class="comment">Use OTAPI_Wrap::Ledger_GetTransactionByIndex() to grab each transaction as you iterate through the inbox. (There are various introspection functions you can use in the API here if you wish to display the inbox items on the screen for the user)</span>
<a name="l05562"></a>05562 <span class="comment">Next call OTAPI_Wrap::Transaction_CreateResponse() for each transaction in the inbox, to create a response to it, accepting or rejecting it. This function creates the response and adds it to the response ledger.</span>
<a name="l05563"></a>05563 <span class="comment">Next, call OTAPI_Wrap::Ledger_FinalizeResponse() which will create a Balance Agreement for the ledger.</span>
<a name="l05564"></a>05564 <span class="comment">Finally, call OTAPI_Wrap::processInbox() to send your message to the server and process the various items.</span>
<a name="l05565"></a>05565 <span class="comment"></span>
<a name="l05566"></a>05566 <span class="comment">If the message was successful, then use OTAPI_Wrap::Message_GetBalanceAgreementSuccess() and OTAPI_Wrap::Message_GetTransactionSuccess() as described above in the deposit cash instructions.</span>
<a name="l05567"></a>05567 <span class="comment">*/</span>
<a name="l05568"></a>05568 
<a name="l05569"></a>05569 
<a name="l05570"></a>05570 <span class="comment">// Done:  add options here for accept transfers, accept receipts, and accept all.</span>
<a name="l05571"></a>05571 <span class="comment">// Done:  Then basically make a version for the payments inbox for accept payments, accept invoices, and accept all.</span>
<a name="l05572"></a>05572 <span class="comment">//</span>
<a name="l05573"></a>05573 <span class="comment">// (Accepting payments can basically be automated, but accepting invoices requires user permission.)</span>
<a name="l05574"></a>05574 <span class="comment">//</span>
<a name="l05575"></a>05575 <span class="comment">// Therefore add:</span>
<a name="l05576"></a>05576 <span class="comment">//   acceptmoney    -- This accepts all incoming transfers and incoming payments</span>
<a name="l05577"></a>05577 <span class="comment">//                     (Not receipts or invoices) for any designated accounts and nyms.</span>
<a name="l05578"></a>05578 <span class="comment">//   acceptreceipts -- Accepts all inbox receipts (not transfers.)</span>
<a name="l05579"></a>05579 <span class="comment">//   acceptinvoices -- Accepts all invoices (not payments.)</span>
<a name="l05580"></a>05580 <span class="comment">//   acceptall      -- All of the above.</span>
<a name="l05581"></a>05581 <span class="comment">//</span>
<a name="l05582"></a>05582 <span class="comment">// Todo: Make the above functions also work with specific indices (vs &quot;all&quot;)</span>
<a name="l05583"></a>05583 <span class="comment">//</span>
<a name="l05584"></a>05584 
<a name="l05585"></a>05585 
<a name="l05586"></a>05586 <span class="comment">//</span>
<a name="l05587"></a>05587 <span class="comment">// PROCESS INBOX, ACCEPTING ALL ITEMS WITHIN...</span>
<a name="l05588"></a>05588 <span class="comment">//</span>
<a name="l05589"></a>05589 <span class="comment">// Load an asset account&#39;s inbox from local storage and iterate through</span>
<a name="l05590"></a>05590 <span class="comment">// the items inside, and fire off a server message accepting them all.</span>
<a name="l05591"></a>05591 <span class="comment">//</span>
<a name="l05592"></a>05592 <span class="comment">// nItemType  == 0 for all, 1 for transfers only, 2 for receipts only.</span>
<a name="l05593"></a>05593 <span class="comment">// strIndices == &quot;&quot; for &quot;all indices&quot;</span>
<a name="l05594"></a>05594 <span class="comment">//</span>
<a name="l05595"></a><a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">05595</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">OT_Command::accept_inbox_items</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> int32_t nItemType, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l05596"></a>05596 {
<a name="l05597"></a>05597     <a class="code" href="class_utility.html">Utility</a> MsgUtil;
<a name="l05598"></a>05598 
<a name="l05599"></a>05599     <span class="comment">// Look up the Nym ID based on the Account ID.</span>
<a name="l05600"></a>05600     <span class="comment">//</span>
<a name="l05601"></a>05601     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l05602"></a>05602 
<a name="l05603"></a>05603     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l05604"></a>05604     {
<a name="l05605"></a>05605         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on the specified account ( &quot;</span> + strMyAcctID + <span class="stringliteral">&quot; ).\n&quot;</span>);
<a name="l05606"></a>05606         <span class="keywordflow">return</span> -1;
<a name="l05607"></a>05607     }
<a name="l05608"></a>05608 
<a name="l05609"></a>05609     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> != strMyNymID))
<a name="l05610"></a>05610     {
<a name="l05611"></a>05611         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try again: MyNym is specified, but it&#39;s not the owner of the specified account ( &quot;</span> + strMyAcctID + <span class="stringliteral">&quot; ).\n&quot;</span>);
<a name="l05612"></a>05612         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;To override with the nym for this account, add: --mynym &quot;</span> + strMyNymID + <span class="stringliteral">&quot; \n\n&quot;</span>);
<a name="l05613"></a>05613         <span class="keywordflow">return</span> -1;
<a name="l05614"></a>05614     }
<a name="l05615"></a>05615 
<a name="l05616"></a>05616     <span class="comment">// Look up the Server ID based on the Account ID.</span>
<a name="l05617"></a>05617     <span class="comment">//</span>
<a name="l05618"></a>05618     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l05619"></a>05619 
<a name="l05620"></a>05620     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l05621"></a>05621     {
<a name="l05622"></a>05622         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on the specified account ( &quot;</span> + strMyAcctID + <span class="stringliteral">&quot; ).\n&quot;</span>);
<a name="l05623"></a>05623         <span class="keywordflow">return</span> -1;
<a name="l05624"></a>05624     }
<a name="l05625"></a>05625 
<a name="l05626"></a>05626     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> != strServerID))
<a name="l05627"></a>05627     {
<a name="l05628"></a>05628         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try again: Server is specified, but it&#39;s not the server for the specified account ( &quot;</span> + strMyAcctID + <span class="stringliteral">&quot; ).\n&quot;</span>);
<a name="l05629"></a>05629         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;To override with the server for this account, add: --server &quot;</span> + strServerID + <span class="stringliteral">&quot; \n\n&quot;</span>);
<a name="l05630"></a>05630         <span class="keywordflow">return</span> -1;
<a name="l05631"></a>05631     }
<a name="l05632"></a>05632 
<a name="l05633"></a>05633     <span class="comment">// returns bool.</span>
<a name="l05634"></a>05634     <span class="comment">//</span>
<a name="l05635"></a>05635     <span class="comment">// User may have already chosen indices (passed in) so we don&#39;t want to</span>
<a name="l05636"></a>05636     <span class="comment">// re-download the inbox unless we HAVE to. But if the hash has changed, that&#39;s</span>
<a name="l05637"></a>05637     <span class="comment">// one clear-cut case where we _do_ have to. Otherwise our balance agreement</span>
<a name="l05638"></a>05638     <span class="comment">// will fail anyway. So hopefully we can let OT &quot;be smart about it&quot; here instead</span>
<a name="l05639"></a>05639     <span class="comment">// of just forcing it to download every time even when unnecessary.</span>
<a name="l05640"></a>05640     <span class="comment">//</span>
<a name="l05641"></a>05641     <span class="keywordflow">if</span> (!MsgUtil.<a class="code" href="class_utility.html#afcf37cb45c40719b2d6d81f0202f96ab">getIntermediaryFiles</a>(strServerID, strMyNymID, strMyAcctID)) <span class="comment">// boolean bForceDownload=false</span>
<a name="l05642"></a>05642     {
<a name="l05643"></a>05643         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to download necessary intermediary files for this inbox/account. (Failure.)\n&quot;</span>);
<a name="l05644"></a>05644         <span class="keywordflow">return</span> -1;
<a name="l05645"></a>05645     }
<a name="l05646"></a>05646 
<a name="l05647"></a>05647 
<a name="l05648"></a>05648     <span class="comment">// Make sure we have at least one transaction number (to process the inbox with.)</span>
<a name="l05649"></a>05649     <span class="comment">//</span>
<a name="l05650"></a>05650     <span class="comment">// NOTE: Normally we don&#39;t have to do this, because the high-level API is smart</span>
<a name="l05651"></a>05651     <span class="comment">// enough, when sending server transaction requests, to grab new transaction numbers</span>
<a name="l05652"></a>05652     <span class="comment">// if it is running low.</span>
<a name="l05653"></a>05653     <span class="comment">// But in this case, we need the numbers available BEFORE sending the transaction</span>
<a name="l05654"></a>05654     <span class="comment">// request, because the call to OTAPI_Wrap::Ledger_CreateResponse is where the number</span>
<a name="l05655"></a>05655     <span class="comment">// is first needed, and that call is made int64_t before the server transaction request</span>
<a name="l05656"></a>05656     <span class="comment">// is actually sent.</span>
<a name="l05657"></a>05657     <span class="comment">//</span>
<a name="l05658"></a>05658     <span class="keywordflow">if</span> (!<a class="code" href="class_made_easy.html#a00985d1a80490194f9964e1927353f29">MadeEasy::insure_enough_nums</a>(10, strServerID, strMyNymID))
<a name="l05659"></a>05659     {
<a name="l05660"></a>05660         <span class="keywordflow">return</span> -1;
<a name="l05661"></a>05661     }
<a name="l05662"></a>05662 
<a name="l05663"></a>05663     <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#abaca9dcb58932efa4daaaee430901c8e">OTAPI_Wrap::LoadInbox</a>(strServerID, strMyNymID, strMyAcctID); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l05664"></a>05664 
<a name="l05665"></a>05665     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l05666"></a>05666     {
<a name="l05667"></a>05667         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n OT_API_LoadInbox: Failed.\n\n&quot;</span>);
<a name="l05668"></a>05668         <span class="keywordflow">return</span> -1;
<a name="l05669"></a>05669     }
<a name="l05670"></a>05670     <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l05671"></a>05671     {
<a name="l05672"></a>05672         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l05673"></a>05673         <span class="comment">//  print(strInbox)          // stdout</span>
<a name="l05674"></a>05674 
<a name="l05675"></a>05675         int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, strMyAcctID, strInbox);
<a name="l05676"></a>05676         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) &amp;&amp; (nCount &gt; 0))
<a name="l05677"></a>05677         {
<a name="l05678"></a>05678             <span class="comment">// NOTE!!! DO **NOT** create the response ledger until the FIRST iteration of the below loop that actually</span>
<a name="l05679"></a>05679             <span class="comment">// creates a transaction response! If that &quot;first iteration&quot; never comes (due to receipts being skipped, etc)</span>
<a name="l05680"></a>05680             <span class="comment">// then OTAPI_Wrap::Transaction_CreateResponse will never get called, and therefore Ledger_CreateResponse should</span>
<a name="l05681"></a>05681             <span class="comment">// also not be called, either. (Nor should OTAPI_Wrap::Ledger_FinalizeResponse, etc.)</span>
<a name="l05682"></a>05682             <span class="comment">//</span>
<a name="l05683"></a>05683             <span class="keywordtype">string</span> strResponseLEDGER = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05684"></a>05684 
<a name="l05685"></a>05685             int32_t nIndicesCount = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices) : 0;
<a name="l05686"></a>05686 
<a name="l05687"></a>05687             <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l05688"></a>05688             {
<a name="l05689"></a>05689                 <span class="keywordtype">bool</span> bContinue = <span class="keyword">false</span>;  <span class="comment">// I&#39;m hacking my own &quot;continue&quot; since the language doesn&#39;t support it....</span>
<a name="l05690"></a>05690 
<a name="l05691"></a>05691                 <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, strMyAcctID, strInbox, nIndex);
<a name="l05692"></a>05692 
<a name="l05693"></a>05693                 <span class="comment">// nItemType  == 0 for all, 1 for transfers only, 2 for receipts only.</span>
<a name="l05694"></a>05694                 <span class="comment">// strIndices == &quot;&quot; for &quot;all indices&quot;</span>
<a name="l05695"></a>05695                 <span class="comment">//</span>
<a name="l05696"></a>05696                 <span class="keywordflow">if</span> (nItemType &gt; 0) <span class="comment">// 0 means &quot;all&quot;, so we don&#39;t have to skip anything based on type, if it&#39;s 0.</span>
<a name="l05697"></a>05697                 {
<a name="l05698"></a>05698                     <span class="keywordtype">string</span> strTransType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l05699"></a>05699 
<a name="l05700"></a>05700                     <span class="comment">// incoming transfer</span>
<a name="l05701"></a>05701                     <span class="keywordflow">if</span> ((<span class="stringliteral">&quot;pending&quot;</span> == strTransType) &amp;&amp; (1 != nItemType))
<a name="l05702"></a>05702                     {
<a name="l05703"></a>05703                         <span class="comment">// if it IS an incoming transfer, but we&#39;re doing receipts, then skip it.</span>
<a name="l05704"></a>05704                         <span class="comment">//                      continue // language doesn&#39;t support this</span>
<a name="l05705"></a>05705                         bContinue = <span class="keyword">true</span>;
<a name="l05706"></a>05706                     }
<a name="l05707"></a>05707                     <span class="comment">// receipt</span>
<a name="l05708"></a>05708                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bContinue &amp;&amp; (<span class="stringliteral">&quot;pending&quot;</span> != strTransType) &amp;&amp; (2 != nItemType))
<a name="l05709"></a>05709                     {
<a name="l05710"></a>05710                         <span class="comment">// if it is NOT an incoming transfer, then it&#39;s a receipt. If we&#39;re not doing receipts, then skip it.</span>
<a name="l05711"></a>05711                         <span class="comment">//                      continue // language doesn&#39;t support this</span>
<a name="l05712"></a>05712                         bContinue = <span class="keyword">true</span>;
<a name="l05713"></a>05713                     }
<a name="l05714"></a>05714                 }
<a name="l05715"></a>05715 
<a name="l05716"></a>05716                 <span class="keywordflow">if</span> (!bContinue)
<a name="l05717"></a>05717                 {
<a name="l05718"></a>05718 
<a name="l05719"></a>05719                     <span class="comment">// - If NO indices are specified, process them ALL.</span>
<a name="l05720"></a>05720                     <span class="comment">//</span>
<a name="l05721"></a>05721                     <span class="comment">// - If indices are specified, but the current index is not on</span>
<a name="l05722"></a>05722                     <span class="comment">//   that list, then continue...</span>
<a name="l05723"></a>05723                     <span class="comment">//</span>
<a name="l05724"></a>05724                     <span class="keywordflow">if</span> ((nIndicesCount &gt; 0) &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex)))
<a name="l05725"></a>05725                     {
<a name="l05726"></a>05726                         <span class="comment">//                      continue  // language doesn&#39;t support continue.</span>
<a name="l05727"></a>05727                         bContinue = <span class="keyword">true</span>;
<a name="l05728"></a>05728                     }
<a name="l05729"></a>05729 
<a name="l05730"></a>05730                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bContinue)
<a name="l05731"></a>05731                     {
<a name="l05732"></a>05732                         <span class="comment">// By this point we know we actually have to call OTAPI_Wrap::Transaction_CreateResponse</span>
<a name="l05733"></a>05733                         <span class="comment">// Therefore, if OTAPI_Wrap::Ledger_CreateResponse has not yet been called (which it won&#39;t</span>
<a name="l05734"></a>05734                         <span class="comment">// have been, the first time we hit this in this loop), then we call it here this one</span>
<a name="l05735"></a>05735                         <span class="comment">// time, to get things started...</span>
<a name="l05736"></a>05736                         <span class="comment">//</span>
<a name="l05737"></a>05737                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponseLEDGER))
<a name="l05738"></a>05738                         {
<a name="l05739"></a>05739                             strResponseLEDGER = <a class="code" href="class_o_t_a_p_i___wrap.html#aaa2b6cf3ece21af1a7ecdca443653db6">OTAPI_Wrap::Ledger_CreateResponse</a>(strServerID, strMyNymID, strMyAcctID, strInbox);
<a name="l05740"></a>05740 
<a name="l05741"></a>05741                             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponseLEDGER))
<a name="l05742"></a>05742                             {
<a name="l05743"></a>05743                                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: OT_API_Ledger_CreateResponse returned NULL.\n&quot;</span>);
<a name="l05744"></a>05744                                 <span class="keywordflow">return</span> -1;
<a name="l05745"></a>05745                             }
<a name="l05746"></a>05746                         }
<a name="l05747"></a>05747 
<a name="l05748"></a>05748                         <span class="comment">// By this point, we know the ledger response exists, and we know we have to create</span>
<a name="l05749"></a>05749                         <span class="comment">// a transaction response to go inside of it, so let&#39;s do that next...</span>
<a name="l05750"></a>05750                         <span class="comment">//</span>
<a name="l05751"></a>05751                         <span class="keywordtype">string</span> strNEW_ResponseLEDGER = <a class="code" href="class_o_t_a_p_i___wrap.html#a81d819bc29f3943f77104efdd9392827">OTAPI_Wrap::Transaction_CreateResponse</a>(strServerID, strMyNymID, strMyAcctID, strResponseLEDGER, strTrans, <span class="keyword">true</span>); <span class="comment">// accept = true (versus rejecting a pending transfer, for example.)</span>
<a name="l05752"></a>05752 
<a name="l05753"></a>05753                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNEW_ResponseLEDGER))
<a name="l05754"></a>05754                         {
<a name="l05755"></a>05755                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: OT_API_Transaction_CreateResponse returned NULL.\n&quot;</span>);
<a name="l05756"></a>05756                             <span class="keywordflow">return</span> -1;
<a name="l05757"></a>05757                         }
<a name="l05758"></a>05758                         strResponseLEDGER = strNEW_ResponseLEDGER;
<a name="l05759"></a>05759                     }
<a name="l05760"></a>05760                 }
<a name="l05761"></a>05761             } <span class="comment">// for</span>
<a name="l05762"></a>05762 
<a name="l05763"></a>05763             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponseLEDGER))
<a name="l05764"></a>05764             {
<a name="l05765"></a>05765                 <span class="comment">// This means there were receipts in the box, but they were skipped.</span>
<a name="l05766"></a>05766                 <span class="comment">// And after the skipping was done, there were no receipts left.</span>
<a name="l05767"></a>05767                 <span class="comment">// So we can&#39;t just say &quot;the box is empty&quot; because it&#39;s not. But nevertheless,</span>
<a name="l05768"></a>05768                 <span class="comment">// we aren&#39;t actually processing any of them, so we return 0 AS IF the box</span>
<a name="l05769"></a>05769                 <span class="comment">// had been empty. (Because this is not an error condition. Just a &quot;no op&quot;.)</span>
<a name="l05770"></a>05770                 <span class="comment">//</span>
<a name="l05771"></a>05771                 <span class="keywordflow">return</span> 0;
<a name="l05772"></a>05772             }
<a name="l05773"></a>05773 
<a name="l05774"></a>05774             <span class="comment">// Below this point, we know strResponseLEDGER needs to be sent,</span>
<a name="l05775"></a>05775             <span class="comment">// so let&#39;s finalize it.</span>
<a name="l05776"></a>05776             <span class="comment">//</span>
<a name="l05777"></a>05777             <span class="keywordtype">string</span> strFinalizedResponse = <a class="code" href="class_o_t_a_p_i___wrap.html#a6b0753569225b9a9f7505d29dddae490">OTAPI_Wrap::Ledger_FinalizeResponse</a>(strServerID, strMyNymID, strMyAcctID, strResponseLEDGER);
<a name="l05778"></a>05778 
<a name="l05779"></a>05779             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strFinalizedResponse))
<a name="l05780"></a>05780             {
<a name="l05781"></a>05781                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: OT_API_Ledger_FinalizeResponse returned NULL.\n&quot;</span>);
<a name="l05782"></a>05782                 <span class="keywordflow">return</span> -1;
<a name="l05783"></a>05783             }
<a name="l05784"></a>05784             <span class="comment">// ***************************************************************</span>
<a name="l05785"></a>05785 
<a name="l05786"></a>05786             <span class="comment">// Server communications are handled here...</span>
<a name="l05787"></a>05787             <span class="comment">//</span>
<a name="l05788"></a>05788             <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a4882d47a967272a7314e875a70dd82a9">MadeEasy::process_inbox</a>(strServerID, strMyNymID, strMyAcctID, strFinalizedResponse);
<a name="l05789"></a>05789             <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;process_inbox&quot;</span>;
<a name="l05790"></a>05790 
<a name="l05791"></a>05791             <span class="comment">// ***************************************************************</span>
<a name="l05792"></a>05792 
<a name="l05793"></a>05793             int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strMyNymID, strMyAcctID, strAttempt, strResponse);
<a name="l05794"></a>05794 
<a name="l05795"></a>05795             <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l05796"></a>05796             {
<a name="l05797"></a>05797                 <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l05798"></a>05798                 <span class="comment">// since they have probably changed from this operation.</span>
<a name="l05799"></a>05799                 <span class="comment">//</span>
<a name="l05800"></a>05800                 <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strMyNymID, strMyAcctID, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l05801"></a>05801 
<a name="l05802"></a>05802                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS processing/accepting inbox.\n&quot;</span>);
<a name="l05803"></a>05803                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l05804"></a>05804             }
<a name="l05805"></a>05805 
<a name="l05806"></a>05806             <span class="comment">// ***************************************************************</span>
<a name="l05807"></a>05807             <span class="comment">//</span>
<a name="l05808"></a>05808             <span class="comment">// Success!</span>
<a name="l05809"></a>05809             <span class="comment">//</span>
<a name="l05810"></a>05810             <span class="keywordflow">return</span> nInterpretReply;
<a name="l05811"></a>05811 
<a name="l05812"></a>05812         } <span class="comment">// VerifyIntVal (nCount) &amp;&amp; nCount &gt; 0</span>
<a name="l05813"></a>05813 
<a name="l05814"></a>05814         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The asset account inbox is empty.\n\n&quot;</span>);
<a name="l05815"></a>05815     }
<a name="l05816"></a>05816 
<a name="l05817"></a>05817     <span class="keywordflow">return</span> 0;
<a name="l05818"></a>05818 }
<a name="l05819"></a>05819 
<a name="l05820"></a>05820 
<a name="l05821"></a><a class="code" href="class_o_t___command.html#a93742066b2e1767149bff0f16f345082">05821</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a93742066b2e1767149bff0f16f345082">OT_Command::main_accept_receipts</a>()
<a name="l05822"></a>05822 {
<a name="l05823"></a>05823     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  acceptreceipts --myacct FOR_ACCT --args \&quot;indices 3,6,8\&quot;  \n (Sample indices are shown.)\n&quot;</span>;
<a name="l05824"></a>05824     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;If indices are not specified for myacct&#39;s inbox, then OT will\n&quot;</span>;
<a name="l05825"></a>05825     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;accept ALL receipts (but no pending transfers) in that box.\n\n&quot;</span>;
<a name="l05826"></a>05826 
<a name="l05827"></a>05827     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05828"></a>05828 
<a name="l05829"></a>05829     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05830"></a>05830     {
<a name="l05831"></a>05831         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05832"></a>05832 
<a name="l05833"></a>05833         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l05834"></a>05834         {
<a name="l05835"></a>05835             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l05836"></a>05836             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l05837"></a>05837             <span class="comment">//</span>
<a name="l05838"></a>05838             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l05839"></a>05839         }
<a name="l05840"></a>05840 
<a name="l05841"></a>05841         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">accept_inbox_items</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, 2, strIndices);
<a name="l05842"></a>05842     }
<a name="l05843"></a>05843 
<a name="l05844"></a>05844     <span class="keywordflow">return</span> -1;
<a name="l05845"></a>05845 }
<a name="l05846"></a>05846 
<a name="l05847"></a>05847 
<a name="l05848"></a><a class="code" href="class_o_t___command.html#ab4519cc95fcaf5389ef00378e3e819d6">05848</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab4519cc95fcaf5389ef00378e3e819d6">OT_Command::main_accept_inbox</a>()
<a name="l05849"></a>05849 {
<a name="l05850"></a>05850     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  acceptinbox --myacct FOR_ACCT --args \&quot;indices 3,6,8\&quot;  \n (Sample indices are shown.)\n&quot;</span>;
<a name="l05851"></a>05851     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;If indices are not specified for myacct&#39;s inbox, then OT will\n&quot;</span>;
<a name="l05852"></a>05852     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;accept ALL transfers and receipts in that box.\n\n&quot;</span>;
<a name="l05853"></a>05853 
<a name="l05854"></a>05854     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05855"></a>05855 
<a name="l05856"></a>05856     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05857"></a>05857     {
<a name="l05858"></a>05858         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05859"></a>05859 
<a name="l05860"></a>05860         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l05861"></a>05861         {
<a name="l05862"></a>05862             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l05863"></a>05863             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l05864"></a>05864             <span class="comment">//</span>
<a name="l05865"></a>05865             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l05866"></a>05866         }
<a name="l05867"></a>05867 
<a name="l05868"></a>05868         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">accept_inbox_items</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, 0, strIndices);
<a name="l05869"></a>05869     }
<a name="l05870"></a>05870 
<a name="l05871"></a>05871     <span class="keywordflow">return</span> -1;
<a name="l05872"></a>05872 }
<a name="l05873"></a>05873 
<a name="l05874"></a>05874 
<a name="l05875"></a><a class="code" href="class_o_t___command.html#a1eea9d8f610c9296532354bb8956afdc">05875</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a1eea9d8f610c9296532354bb8956afdc">OT_Command::main_accept_transfers</a>()
<a name="l05876"></a>05876 {
<a name="l05877"></a>05877     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  accepttransfers --myacct FOR_ACCT --args \&quot;indices 3,6,8\&quot;  \n (Sample indices are shown.)\n&quot;</span>;
<a name="l05878"></a>05878     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;If indices are not specified for myacct&#39;s inbox, then OT will\n&quot;</span>;
<a name="l05879"></a>05879     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;accept ALL transfers (but no receipts) in that box.\n\n&quot;</span>;
<a name="l05880"></a>05880 
<a name="l05881"></a>05881     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05882"></a>05882 
<a name="l05883"></a>05883     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05884"></a>05884     {
<a name="l05885"></a>05885         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05886"></a>05886 
<a name="l05887"></a>05887         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l05888"></a>05888         {
<a name="l05889"></a>05889             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l05890"></a>05890             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l05891"></a>05891             <span class="comment">//</span>
<a name="l05892"></a>05892             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l05893"></a>05893         }
<a name="l05894"></a>05894 
<a name="l05895"></a>05895         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">accept_inbox_items</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, 1, strIndices);
<a name="l05896"></a>05896     }
<a name="l05897"></a>05897 
<a name="l05898"></a>05898     <span class="keywordflow">return</span> -1;
<a name="l05899"></a>05899 }
<a name="l05900"></a>05900 
<a name="l05901"></a>05901 
<a name="l05902"></a>05902 <span class="comment">// Accept incoming payments and transfers. (NOT receipts or invoices.)</span>
<a name="l05903"></a>05903 <span class="comment">//</span>
<a name="l05904"></a><a class="code" href="class_o_t___command.html#aea948420f29205115f2c8ed1637fa5d3">05904</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aea948420f29205115f2c8ed1637fa5d3">OT_Command::main_accept_money</a>()
<a name="l05905"></a>05905 {
<a name="l05906"></a>05906     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\nUsage:  acceptmoney --myacct INTO_ACCT\n&quot;</span>;
<a name="l05907"></a>05907 
<a name="l05908"></a>05908     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05909"></a>05909 
<a name="l05910"></a>05910     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05911"></a>05911     {
<a name="l05912"></a>05912         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05913"></a>05913 
<a name="l05914"></a>05914         int32_t nAcceptedTransfers = <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">accept_inbox_items</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, 1, strIndices); <span class="comment">// accepts transfers only, leaves receipts.</span>
<a name="l05915"></a>05915 
<a name="l05916"></a>05916         int32_t nAcceptedPurses = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices, <span class="stringliteral">&quot;PURSE&quot;</span>);
<a name="l05917"></a>05917         <span class="comment">// Voucher is already interpreted as a form of cheque, so this is redundant.</span>
<a name="l05918"></a>05918         <span class="comment">//      int32_t nAcceptedVouchers = accept_from_paymentbox(MyAcct, strIndices, &quot;VOUCHER&quot;)</span>
<a name="l05919"></a>05919         int32_t nAcceptedCheques = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices, <span class="stringliteral">&quot;CHEQUE&quot;</span>);
<a name="l05920"></a>05920 
<a name="l05921"></a>05921         <span class="comment">// If all five calls succeed, then the total here is 5.</span>
<a name="l05922"></a>05922         <span class="comment">// So we return success as well (1).</span>
<a name="l05923"></a>05923         <span class="comment">//</span>
<a name="l05924"></a>05924         <span class="keywordflow">if</span> ((nAcceptedTransfers &gt; -1) || (nAcceptedPurses &gt; -1) || (nAcceptedCheques &gt; -1))
<a name="l05925"></a>05925         {
<a name="l05926"></a>05926             <span class="keywordflow">return</span> 1;
<a name="l05927"></a>05927         }
<a name="l05928"></a>05928     }
<a name="l05929"></a>05929 
<a name="l05930"></a>05930     <span class="keywordflow">return</span> -1;
<a name="l05931"></a>05931 }
<a name="l05932"></a>05932 
<a name="l05933"></a>05933 
<a name="l05934"></a>05934 <span class="comment">// Accept all incoming transfers, receipts, payments, and invoices.</span>
<a name="l05935"></a>05935 <span class="comment">//</span>
<a name="l05936"></a><a class="code" href="class_o_t___command.html#af4e5429b2a785a4ee764508205e19568">05936</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af4e5429b2a785a4ee764508205e19568">OT_Command::main_accept_all</a>()
<a name="l05937"></a>05937 {
<a name="l05938"></a>05938     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\nUsage:  acceptall --myacct INTO_ACCT\n&quot;</span>;
<a name="l05939"></a>05939 
<a name="l05940"></a>05940     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l05941"></a>05941 
<a name="l05942"></a>05942     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l05943"></a>05943     {
<a name="l05944"></a>05944         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05945"></a>05945 
<a name="l05946"></a>05946         <span class="comment">//  Incoming transfers and receipts (asset account inbox.)</span>
<a name="l05947"></a>05947         <span class="comment">//</span>
<a name="l05948"></a>05948         int32_t nAcceptedInbox = <a class="code" href="class_o_t___command.html#a7efd3402a81a82c8b34e4e26840f7320">accept_inbox_items</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, 0, strIndices); <span class="comment">// accepts transfers AND receipts.</span>
<a name="l05949"></a>05949 
<a name="l05950"></a>05950         <span class="comment">// Incoming payments -- cheques, purses, vouchers (payments inbox for nym)</span>
<a name="l05951"></a>05951         <span class="comment">//</span>
<a name="l05952"></a>05952         int32_t nAcceptedPurses = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices, <span class="stringliteral">&quot;PURSE&quot;</span>);
<a name="l05953"></a>05953         <span class="comment">// Voucher is already interpreted as a form of cheque, so this is redundant.</span>
<a name="l05954"></a>05954         <span class="comment">//      int32_t nAcceptedVouchers = accept_from_paymentbox(MyAcct, strIndices, &quot;VOUCHER&quot;)</span>
<a name="l05955"></a>05955         int32_t nAcceptedCheques = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices, <span class="stringliteral">&quot;CHEQUE&quot;</span>);
<a name="l05956"></a>05956 
<a name="l05957"></a>05957         <span class="comment">// Invoices LAST (so the MOST money is in the account before it starts paying out.)</span>
<a name="l05958"></a>05958         <span class="comment">//</span>
<a name="l05959"></a>05959         int32_t nAcceptedInvoices = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices, <span class="stringliteral">&quot;INVOICE&quot;</span>);
<a name="l05960"></a>05960 
<a name="l05961"></a>05961         <span class="comment">// If all four calls succeed, then the total here is 4.</span>
<a name="l05962"></a>05962         <span class="comment">// So we return success as well (1).</span>
<a name="l05963"></a>05963         <span class="comment">//</span>
<a name="l05964"></a>05964         <span class="keywordflow">if</span> (4 == (nAcceptedInbox + nAcceptedPurses + nAcceptedCheques + nAcceptedInvoices))
<a name="l05965"></a>05965         {
<a name="l05966"></a>05966             <span class="keywordflow">return</span> 1;
<a name="l05967"></a>05967         }
<a name="l05968"></a>05968     }
<a name="l05969"></a>05969 
<a name="l05970"></a>05970     <span class="keywordflow">return</span> -1;
<a name="l05971"></a>05971 }
<a name="l05972"></a>05972 
<a name="l05973"></a>05973 
<a name="l05974"></a>05974 <span class="comment">// returns the server response string (or null.)</span>
<a name="l05975"></a>05975 <span class="comment">// Use VerifyStringVal and/or VerifyMessageSuccess on it, for more info.</span>
<a name="l05976"></a>05976 <span class="comment">//</span>
<a name="l05977"></a><a class="code" href="class_o_t___command.html#ab873a42684ff299127e1bd46f4bbe198">05977</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#ab873a42684ff299127e1bd46f4bbe198">OT_Command::details_check_user</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strHisNymID)
<a name="l05978"></a>05978 {
<a name="l05979"></a>05979     <span class="comment">// Just to show how easy it is now, let&#39;s try a &quot;check_user&quot; message.</span>
<a name="l05980"></a>05980     <span class="comment">// (It sends a NymID to the server, and downloads that Nym&#39;s public key.)</span>
<a name="l05981"></a>05981 
<a name="l05982"></a>05982     <span class="keywordtype">string</span> strServerParam = strServerID;
<a name="l05983"></a>05983     <span class="keywordtype">string</span> strMyNymParam = strMyNymID;
<a name="l05984"></a>05984     <span class="keywordtype">string</span> strHisNymParam = strHisNymID;
<a name="l05985"></a>05985 
<a name="l05986"></a>05986     <span class="keywordtype">string</span> strResponse;
<a name="l05987"></a>05987 
<a name="l05988"></a>05988     <span class="comment">// NOTE: If this were Server, MyNym, and HisNym, then we&#39;d have already</span>
<a name="l05989"></a>05989     <span class="comment">// translated the partials to read IDs (in OT itself) but we don&#39;t have that</span>
<a name="l05990"></a>05990     <span class="comment">// guarantee in this function. Maybe strServerID was passed in from user input</span>
<a name="l05991"></a>05991     <span class="comment">// directly, while inside another script. Partial IDs should still work, right?</span>
<a name="l05992"></a>05992     <span class="comment">// So here, we translate them just in case.</span>
<a name="l05993"></a>05993     <span class="comment">//</span>
<a name="l05994"></a>05994     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymID))
<a name="l05995"></a>05995     {
<a name="l05996"></a>05996         <span class="comment">// IF we are able to resolve the HisNymId from a partial, then we</span>
<a name="l05997"></a>05997         <span class="comment">// replace the partial with the full version.</span>
<a name="l05998"></a>05998         <span class="comment">// (Otherwise we assume it&#39;s already a full ID and we don&#39;t mess with it.)</span>
<a name="l05999"></a>05999         <span class="comment">//</span>
<a name="l06000"></a>06000         <span class="keywordtype">string</span> strServerFromPartial = <a class="code" href="class_o_t_a_p_i___wrap.html#a318067244f3cd0b675298c9dcca1683e">OTAPI_Wrap::Wallet_GetServerIDFromPartial</a>(strServerID);
<a name="l06001"></a>06001 
<a name="l06002"></a>06002         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerFromPartial))
<a name="l06003"></a>06003         {
<a name="l06004"></a>06004             strServerParam = strServerFromPartial;
<a name="l06005"></a>06005         }
<a name="l06006"></a>06006 
<a name="l06007"></a>06007         <span class="keywordtype">string</span> strHisNymFromPartial = <a class="code" href="class_o_t_a_p_i___wrap.html#a7c526c067a62f1b534fb7bfdb02b869d">OTAPI_Wrap::Wallet_GetNymIDFromPartial</a>(strHisNymID);
<a name="l06008"></a>06008 
<a name="l06009"></a>06009         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymFromPartial))
<a name="l06010"></a>06010         {
<a name="l06011"></a>06011             strHisNymParam = strHisNymFromPartial;
<a name="l06012"></a>06012         }
<a name="l06013"></a>06013 
<a name="l06014"></a>06014         <span class="keywordtype">string</span> strMyNymFromPartial = <a class="code" href="class_o_t_a_p_i___wrap.html#a7c526c067a62f1b534fb7bfdb02b869d">OTAPI_Wrap::Wallet_GetNymIDFromPartial</a>(strMyNymID);
<a name="l06015"></a>06015 
<a name="l06016"></a>06016         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymFromPartial))
<a name="l06017"></a>06017         {
<a name="l06018"></a>06018             strMyNymParam = strMyNymFromPartial;
<a name="l06019"></a>06019         }
<a name="l06020"></a>06020 
<a name="l06021"></a>06021         <span class="comment">// Send the request.</span>
<a name="l06022"></a>06022         <span class="comment">//</span>
<a name="l06023"></a>06023         strResponse = <a class="code" href="class_made_easy.html#acc13cef8eb96edf236d63387a4c8a53d">MadeEasy::check_user</a>(strServerParam, strMyNymParam, strHisNymParam); <span class="comment">// Send the &#39;check_user&#39; message to the server.</span>
<a name="l06024"></a>06024     }
<a name="l06025"></a>06025     <span class="keywordflow">else</span>
<a name="l06026"></a>06026     {
<a name="l06027"></a>06027         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n details_check_user: Bad input... strServerID, strMyNymID, or strHisNymID \n&quot;</span>);
<a name="l06028"></a>06028     }
<a name="l06029"></a>06029 
<a name="l06030"></a>06030     <span class="comment">// Done</span>
<a name="l06031"></a>06031     <span class="keywordflow">return</span> strResponse;
<a name="l06032"></a>06032 }
<a name="l06033"></a>06033 
<a name="l06034"></a>06034 
<a name="l06035"></a><a class="code" href="class_o_t___command.html#af703bf5a904650fa430a094276d6848b">06035</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af703bf5a904650fa430a094276d6848b">OT_Command::main_check_user</a>()
<a name="l06036"></a>06036 {
<a name="l06037"></a>06037     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:   opentxs checknym --mynym MY_NYM_ID --hisnym HIS_NYM_ID \n Downloads the public key for HisNym.\n\n&quot;</span>;
<a name="l06038"></a>06038 
<a name="l06039"></a>06039     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06040"></a>06040 
<a name="l06041"></a>06041     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l06042"></a>06042     {
<a name="l06043"></a>06043         <span class="comment">//        string strHisNym = OT_CLI_GetValueByKey( Args, &quot;hisnym&quot; )</span>
<a name="l06044"></a>06044         <span class="comment">//</span>
<a name="l06045"></a>06045         <span class="comment">//        if (!VerifyStringVal(strHisNym))</span>
<a name="l06046"></a>06046         <span class="comment">//        {</span>
<a name="l06047"></a>06047         <span class="comment">//            OTAPI_Wrap::Output(0, &quot;\n\n Missing:  --args \&quot;hisnym HIS_NYM_ID_GOES_HERE\&quot;\n\n&quot;);</span>
<a name="l06048"></a>06048         <span class="comment">//            return -1;</span>
<a name="l06049"></a>06049         <span class="comment">//; }</span>
<a name="l06050"></a>06050 
<a name="l06051"></a>06051         <span class="comment">// Send the request.</span>
<a name="l06052"></a>06052         <span class="comment">//</span>
<a name="l06053"></a>06053         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_o_t___command.html#ab873a42684ff299127e1bd46f4bbe198">details_check_user</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>);
<a name="l06054"></a>06054 
<a name="l06055"></a>06055 
<a name="l06056"></a>06056         <span class="comment">// -1 is error,</span>
<a name="l06057"></a>06057         <span class="comment">//  0 is reply received: failure</span>
<a name="l06058"></a>06058         <span class="comment">//  1 is reply received: success</span>
<a name="l06059"></a>06059         <span class="comment">//</span>
<a name="l06060"></a>06060         <span class="keywordflow">if</span> (1 == <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l06061"></a>06061         {
<a name="l06062"></a>06062             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nSuccess in checknym! Server response:\n\n&quot;</span>);
<a name="l06063"></a>06063             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l06064"></a>06064             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l06065"></a>06065             <span class="keywordflow">return</span> 1;
<a name="l06066"></a>06066         }
<a name="l06067"></a>06067         <span class="keywordflow">else</span>
<a name="l06068"></a>06068         {
<a name="l06069"></a>06069             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n checknym: Failed.\n\n&quot;</span>);
<a name="l06070"></a>06070         }
<a name="l06071"></a>06071     }
<a name="l06072"></a>06072 
<a name="l06073"></a>06073     <span class="comment">// Done</span>
<a name="l06074"></a>06074     <span class="keywordflow">return</span> -1;
<a name="l06075"></a>06075 }
<a name="l06076"></a>06076 
<a name="l06077"></a>06077 
<a name="l06078"></a><a class="code" href="class_o_t___command.html#ac0483ffdc7bbcbf1cddd9bc0de729fa7">06078</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac0483ffdc7bbcbf1cddd9bc0de729fa7">OT_Command::download_acct_files</a>()
<a name="l06079"></a>06079 {
<a name="l06080"></a>06080     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06081"></a>06081 
<a name="l06082"></a>06082     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l06083"></a>06083     {
<a name="l06084"></a>06084         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06085"></a>06085         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06086"></a>06086         <span class="keywordflow">return</span> -1;
<a name="l06087"></a>06087     }
<a name="l06088"></a>06088 
<a name="l06089"></a>06089 
<a name="l06090"></a>06090     <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l06091"></a>06091     <span class="comment">// since they have probably changed from this operation.</span>
<a name="l06092"></a>06092     <span class="comment">//</span>
<a name="l06093"></a>06093     <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l06094"></a>06094 
<a name="l06095"></a>06095     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span> + <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;SUCCESS&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l06096"></a>06096 
<a name="l06097"></a>06097     <span class="keywordflow">return</span> bRetrieved ? 1 : -1;
<a name="l06098"></a>06098 }
<a name="l06099"></a>06099 
<a name="l06100"></a>06100 
<a name="l06101"></a><a class="code" href="class_o_t___command.html#a47f8812ed43cc2a79962395803f3286e">06101</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a47f8812ed43cc2a79962395803f3286e">OT_Command::main_dl_acct_files</a>()
<a name="l06102"></a>06102 {
<a name="l06103"></a>06103     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n Usage:  refreshacct --server SERVER_ID --myacct YOUR_ACCT_ID\n\n&quot;</span>;
<a name="l06104"></a>06104 
<a name="l06105"></a>06105     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06106"></a>06106 
<a name="l06107"></a>06107     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06108"></a>06108     {
<a name="l06109"></a>06109         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ac0483ffdc7bbcbf1cddd9bc0de729fa7">download_acct_files</a>();
<a name="l06110"></a>06110     }
<a name="l06111"></a>06111 
<a name="l06112"></a>06112     <span class="keywordflow">return</span> -1;
<a name="l06113"></a>06113 }
<a name="l06114"></a>06114 
<a name="l06115"></a>06115 
<a name="l06116"></a><a class="code" href="class_o_t___command.html#a50eb595ffd0875eb64c0c26889d491ba">06116</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a50eb595ffd0875eb64c0c26889d491ba">OT_Command::main_refresh_all</a>()
<a name="l06117"></a>06117 {
<a name="l06118"></a>06118     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;Usage:  refresh --server SERVER_ID --mynym YOUR_NYM_ID --myacct YOUR_ACCT_ID\n\n&quot;</span>;
<a name="l06119"></a>06119 
<a name="l06120"></a>06120     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06121"></a>06121 
<a name="l06122"></a>06122     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06123"></a>06123     {
<a name="l06124"></a>06124         int32_t nSuccess = <a class="code" href="class_o_t___command.html#a99dda8fa146ced3e1f4015e7c0f2d0e0">OT_Command::main_refresh_nym</a>();   <span class="comment">// &lt;=======</span>
<a name="l06125"></a>06125 
<a name="l06126"></a>06126         <span class="keywordflow">if</span> (-1 == nSuccess)
<a name="l06127"></a>06127         {
<a name="l06128"></a>06128             <span class="keywordflow">return</span> -1;
<a name="l06129"></a>06129         }
<a name="l06130"></a>06130 
<a name="l06131"></a>06131         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a47f8812ed43cc2a79962395803f3286e">OT_Command::main_dl_acct_files</a>();  <span class="comment">// &lt;=======</span>
<a name="l06132"></a>06132     }
<a name="l06133"></a>06133 
<a name="l06134"></a>06134     <span class="keywordflow">return</span> -1;
<a name="l06135"></a>06135 }
<a name="l06136"></a>06136 
<a name="l06137"></a>06137 
<a name="l06138"></a><a class="code" href="class_o_t___command.html#ac013c52c2eb33ced5fbb8b895e0883af">06138</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac013c52c2eb33ced5fbb8b895e0883af">OT_Command::details_download_contract</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strContractID)
<a name="l06139"></a>06139 {
<a name="l06140"></a>06140     <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l06141"></a>06141     <span class="comment">// since they have probably changed from this operation.</span>
<a name="l06142"></a>06142     <span class="comment">//</span>
<a name="l06143"></a>06143     <span class="keywordtype">string</span> strRetrieved = <a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">MadeEasy::retrieve_contract</a>(strServerID, strNymID, strContractID);
<a name="l06144"></a>06144     int32_t nRetrieved = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strRetrieved);
<a name="l06145"></a>06145 
<a name="l06146"></a>06146     <span class="keywordtype">string</span> strSuccess = <span class="stringliteral">&quot;ERROR&quot;</span>;
<a name="l06147"></a>06147 
<a name="l06148"></a>06148     <span class="keywordflow">if</span> (1 == nRetrieved)
<a name="l06149"></a>06149     {
<a name="l06150"></a>06150         strSuccess = <span class="stringliteral">&quot;SUCCESS&quot;</span>;
<a name="l06151"></a>06151     }
<a name="l06152"></a>06152     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == nRetrieved)
<a name="l06153"></a>06153     {
<a name="l06154"></a>06154         strSuccess = <span class="stringliteral">&quot;FAILED&quot;</span>;
<a name="l06155"></a>06155     }
<a name="l06156"></a>06156 
<a name="l06157"></a>06157     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n &quot;</span> + strSuccess + <span class="stringliteral">&quot; retrieving contract: &quot;</span> + strContractID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l06158"></a>06158 
<a name="l06159"></a>06159     <span class="keywordflow">return</span> (1 == nRetrieved) ? 1 : -1;
<a name="l06160"></a>06160 }
<a name="l06161"></a>06161 
<a name="l06162"></a>06162 
<a name="l06163"></a><a class="code" href="class_o_t___command.html#ad74eb346156c48b51e4b5aff6dc1b1b0">06163</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad74eb346156c48b51e4b5aff6dc1b1b0">OT_Command::main_download_contract</a>()
<a name="l06164"></a>06164 {
<a name="l06165"></a>06165     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\nUsage:  getcontract --server SERVER_ID --mynym YOUR_NYM_ID \n&quot;</span>,
<a name="l06166"></a>06166         <span class="stringliteral">&quot;                    --args \&quot;contract_id CONTRACT_ID_HERE\&quot;\n\n&quot;</span>);
<a name="l06167"></a>06167     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06168"></a>06168 
<a name="l06169"></a>06169     <span class="keywordtype">string</span> strContractID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l06170"></a>06170 
<a name="l06171"></a>06171     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l06172"></a>06172     {
<a name="l06173"></a>06173 
<a name="l06174"></a>06174         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l06175"></a>06175         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l06176"></a>06176         <span class="comment">// at the command line.</span>
<a name="l06177"></a>06177         <span class="comment">//</span>
<a name="l06178"></a>06178         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l06179"></a>06179         {
<a name="l06180"></a>06180             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l06181"></a>06181             <span class="comment">//                                  const std::string str_key)</span>
<a name="l06182"></a>06182             <span class="comment">//</span>
<a name="l06183"></a>06183             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l06184"></a>06184             <span class="comment">// EXAMPLE:  --args &quot;contract_id CvHGtfOOKzQKL5hFL7J4iF5yAodVKhS1rxPzME5R9XA&quot;</span>
<a name="l06185"></a>06185             <span class="comment">//</span>
<a name="l06186"></a>06186             <span class="keywordtype">string</span> strNewContractID = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;contract_id&quot;</span>);
<a name="l06187"></a>06187 
<a name="l06188"></a>06188 
<a name="l06189"></a>06189             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l06190"></a>06190             <span class="comment">//</span>
<a name="l06191"></a>06191             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewContractID))
<a name="l06192"></a>06192             {
<a name="l06193"></a>06193                 strContractID = strNewContractID;
<a name="l06194"></a>06194             }
<a name="l06195"></a>06195             <span class="keywordflow">else</span>
<a name="l06196"></a>06196             {
<a name="l06197"></a>06197                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nMissing --args \&quot;contract_id CONTRACT_ID_HERE\&quot;\n\n&quot;</span>);
<a name="l06198"></a>06198                 <span class="keywordflow">return</span> -1;
<a name="l06199"></a>06199             }
<a name="l06200"></a>06200 
<a name="l06201"></a>06201             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ac013c52c2eb33ced5fbb8b895e0883af">details_download_contract</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strContractID);
<a name="l06202"></a>06202         }
<a name="l06203"></a>06203 
<a name="l06204"></a>06204     }
<a name="l06205"></a>06205 
<a name="l06206"></a>06206     <span class="keywordflow">return</span> -1;
<a name="l06207"></a>06207 }
<a name="l06208"></a>06208 
<a name="l06209"></a>06209 
<a name="l06210"></a><a class="code" href="class_o_t___command.html#ab5971b84259a6d6a2b9cff629cb47ec8">06210</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab5971b84259a6d6a2b9cff629cb47ec8">OT_Command::main_verify_last_receipt</a>()
<a name="l06211"></a>06211 {
<a name="l06212"></a>06212     <span class="comment">// SHOW INBOX</span>
<a name="l06213"></a>06213     <span class="comment">//</span>
<a name="l06214"></a>06214     <span class="comment">// Load an asset account&#39;s inbox from local storage and display it on the screen.</span>
<a name="l06215"></a>06215     <span class="comment">//</span>
<a name="l06216"></a>06216 
<a name="l06217"></a>06217     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06218"></a>06218     {
<a name="l06219"></a>06219 
<a name="l06220"></a>06220         <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l06221"></a>06221         <span class="comment">//</span>
<a name="l06222"></a>06222         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06223"></a>06223 
<a name="l06224"></a>06224         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l06225"></a>06225         {
<a name="l06226"></a>06226             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06227"></a>06227             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06228"></a>06228             <span class="keywordflow">return</span> -1;
<a name="l06229"></a>06229         }
<a name="l06230"></a>06230         <span class="comment">// ***************************************************************</span>
<a name="l06231"></a>06231 
<a name="l06232"></a>06232         <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___wrap.html#a5a777f5b0c246a42406ac60cbc05d857">OTAPI_Wrap::VerifyAccountReceipt</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06233"></a>06233 
<a name="l06234"></a>06234         <span class="keywordflow">if</span> (!bSuccess)
<a name="l06235"></a>06235         {
<a name="l06236"></a>06236             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n OT_API_VerifyAccountReceipt: Failed. Try using refreshacct and then try verifying again.\n\n&quot;</span>);
<a name="l06237"></a>06237             <span class="keywordflow">return</span> -1;
<a name="l06238"></a>06238         }
<a name="l06239"></a>06239         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l06240"></a>06240         {
<a name="l06241"></a>06241             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nVerify receipt:  success!\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l06242"></a>06242             <span class="keywordflow">return</span> 1;
<a name="l06243"></a>06243         }
<a name="l06244"></a>06244     }
<a name="l06245"></a>06245 
<a name="l06246"></a>06246     <span class="comment">// Done!</span>
<a name="l06247"></a>06247     <span class="keywordflow">return</span> -1;
<a name="l06248"></a>06248 }
<a name="l06249"></a>06249 
<a name="l06250"></a>06250 
<a name="l06251"></a><a class="code" href="class_o_t___command.html#a5a9518d65d67da6ab845839e4a24c848">06251</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5a9518d65d67da6ab845839e4a24c848">OT_Command::main_register_nym</a>()
<a name="l06252"></a>06252 {
<a name="l06253"></a>06253     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\nUsage: register_nym.ot --server SERVER_ID --mynym NYM_ID\n\n&quot;</span>,
<a name="l06254"></a>06254         <span class="stringliteral">&quot;(If you don&#39;t have a NymID, then use create_nym.ot first.)\n\n&quot;</span>);
<a name="l06255"></a>06255 
<a name="l06256"></a>06256     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06257"></a>06257 
<a name="l06258"></a>06258     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l06259"></a>06259     {
<a name="l06260"></a>06260         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a07143f0e507862b06e83a539cd2ac25e">MadeEasy::register_nym</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>); <span class="comment">// This also does getRequest internally, if success.</span>
<a name="l06261"></a>06261         int32_t nSuccess = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l06262"></a>06262 
<a name="l06263"></a>06263         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l06264"></a>06264         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l06265"></a>06265         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l06266"></a>06266         <span class="comment">//</span>
<a name="l06267"></a>06267         <span class="comment">// -1 is error,</span>
<a name="l06268"></a>06268         <span class="comment">//  0 is reply received: failure</span>
<a name="l06269"></a>06269         <span class="comment">//  1 is reply received: success</span>
<a name="l06270"></a>06270         <span class="comment">//</span>
<a name="l06271"></a>06271         <span class="keywordflow">switch</span> (nSuccess)
<a name="l06272"></a>06272         {
<a name="l06273"></a>06273         <span class="keywordflow">case</span> 1:
<a name="l06274"></a>06274             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Server response:\n\n&quot;</span>);
<a name="l06275"></a>06275             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l06276"></a>06276             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS in register_nym!\n(Also, success syncronizing the request number.)\n\n&quot;</span>);
<a name="l06277"></a>06277             <span class="keywordflow">break</span>;
<a name="l06278"></a>06278         <span class="keywordflow">case</span> 0:
<a name="l06279"></a>06279             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILURE in register_nym! Server response:\n\n&quot;</span>);
<a name="l06280"></a>06280             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l06281"></a>06281             <span class="keywordflow">break</span>;
<a name="l06282"></a>06282         <span class="keywordflow">default</span>:
<a name="l06283"></a>06283             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nError in register_nym!\n&quot;</span>);
<a name="l06284"></a>06284 
<a name="l06285"></a>06285             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l06286"></a>06286             {
<a name="l06287"></a>06287                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response:\n\n&quot;</span>);
<a name="l06288"></a>06288                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l06289"></a>06289             }
<a name="l06290"></a>06290             <span class="keywordflow">break</span>;
<a name="l06291"></a>06291         }
<a name="l06292"></a>06292         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l06293"></a>06293 
<a name="l06294"></a>06294         <span class="keywordflow">return</span> nSuccess;
<a name="l06295"></a>06295     }
<a name="l06296"></a>06296 
<a name="l06297"></a>06297     <span class="keywordflow">return</span> -1;
<a name="l06298"></a>06298 }
<a name="l06299"></a>06299 
<a name="l06300"></a>06300 
<a name="l06301"></a><a class="code" href="class_o_t___command.html#aeea974132386efc333d2346bd50a7286">06301</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#aeea974132386efc333d2346bd50a7286">OT_Command::details_refresh_nym</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keywordtype">bool</span> &amp; bWasMsgSent, <span class="keyword">const</span> <span class="keywordtype">bool</span> bForceDownload)
<a name="l06302"></a>06302 {
<a name="l06303"></a>06303     int32_t nGetAndProcessNymbox = <a class="code" href="class_made_easy.html#a396a002b857819de530037a6ed584761">MadeEasy::retrieve_nym</a>(strServerID, strMyNymID, bWasMsgSent, bForceDownload);
<a name="l06304"></a>06304 
<a name="l06305"></a>06305     <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l06306"></a>06306     <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l06307"></a>06307     <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l06308"></a>06308     <span class="comment">//</span>
<a name="l06309"></a>06309     <span class="comment">// -1 is error,</span>
<a name="l06310"></a>06310     <span class="comment">//  0 is reply received: failure</span>
<a name="l06311"></a>06311     <span class="comment">//  1 is reply received: success</span>
<a name="l06312"></a>06312     <span class="comment">//</span>
<a name="l06313"></a>06313     <span class="keywordtype">bool</span> bReturnVal = <span class="keyword">false</span>;
<a name="l06314"></a>06314 
<a name="l06315"></a>06315     <span class="keywordflow">switch</span> (nGetAndProcessNymbox)
<a name="l06316"></a>06316     {
<a name="l06317"></a>06317     <span class="keywordflow">case</span> 1:
<a name="l06318"></a>06318         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS in refresh nym!\n&quot;</span>);
<a name="l06319"></a>06319         bReturnVal = <span class="keyword">true</span>;
<a name="l06320"></a>06320         <span class="keywordflow">break</span>;
<a name="l06321"></a>06321     <span class="keywordflow">case</span> 0:
<a name="l06322"></a>06322         <span class="keywordflow">if</span> (bWasMsgSent) <span class="comment">// the message was sent, and the server replied &quot;failure&quot;.</span>
<a name="l06323"></a>06323         {
<a name="l06324"></a>06324             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILURE in refresh nym!\n&quot;</span>);
<a name="l06325"></a>06325         }
<a name="l06326"></a>06326         <span class="keywordflow">else</span> <span class="comment">// the message wasn&#39;t sent; the 0 in this case means &quot;nymbox was empty.&quot;</span>
<a name="l06327"></a>06327         {
<a name="l06328"></a>06328             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Success in refresh nym! (Skipped processing Nymbox, since it&#39;s empty.)\n&quot;</span>);
<a name="l06329"></a>06329             bReturnVal = <span class="keyword">true</span>;
<a name="l06330"></a>06330         }
<a name="l06331"></a>06331         <span class="keywordflow">break</span>;
<a name="l06332"></a>06332     <span class="keywordflow">default</span>:
<a name="l06333"></a>06333         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nError in refresh nym! nGetAndProcessNymbox: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nGetAndProcessNymbox) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l06334"></a>06334         <span class="keywordflow">break</span>;
<a name="l06335"></a>06335     }
<a name="l06336"></a>06336 
<a name="l06337"></a>06337     <span class="keywordflow">return</span> bReturnVal;
<a name="l06338"></a>06338 }
<a name="l06339"></a>06339 
<a name="l06340"></a>06340 
<a name="l06341"></a><a class="code" href="class_o_t___command.html#a99dda8fa146ced3e1f4015e7c0f2d0e0">06341</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a99dda8fa146ced3e1f4015e7c0f2d0e0">OT_Command::main_refresh_nym</a>()
<a name="l06342"></a>06342 {
<a name="l06343"></a>06343     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\nUsage: refreshnym --server SERVER_ID --mynym NYM_ID\n\n&quot;</span>,
<a name="l06344"></a>06344         <span class="stringliteral">&quot;(If you don&#39;t have a NymID, then use the newnym command first.)\n\n&quot;</span>);
<a name="l06345"></a>06345     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06346"></a>06346 
<a name="l06347"></a>06347     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l06348"></a>06348     {
<a name="l06349"></a>06349         <span class="keywordtype">bool</span> bWasMsgSent = <span class="keyword">false</span>;
<a name="l06350"></a>06350         <span class="keywordtype">bool</span> bReturnVal = <a class="code" href="class_o_t___command.html#aeea974132386efc333d2346bd50a7286">details_refresh_nym</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, bWasMsgSent, <span class="keyword">true</span>);
<a name="l06351"></a>06351 
<a name="l06352"></a>06352         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l06353"></a>06353 
<a name="l06354"></a>06354         <span class="keywordflow">if</span> (bReturnVal)
<a name="l06355"></a>06355         {
<a name="l06356"></a>06356             <span class="keywordflow">return</span> 1;
<a name="l06357"></a>06357         }
<a name="l06358"></a>06358     }
<a name="l06359"></a>06359 
<a name="l06360"></a>06360     <span class="keywordflow">return</span> -1;
<a name="l06361"></a>06361 }
<a name="l06362"></a>06362 
<a name="l06363"></a>06363 
<a name="l06364"></a>06364 <span class="comment">// GET BOX RECEIPT          Note: from ot_made_easy.ot</span>
<a name="l06365"></a>06365 <span class="comment">// Note: nBoxType is 0 for Nymbox, 1 for Inbox, and 2 for Outbox.</span>
<a name="l06366"></a>06366 <span class="comment">// Also, if nBoxType is 0 (nymbox) then you have to pass the NymID in the ACCT_ID</span>
<a name="l06367"></a>06367 <span class="comment">// argument, as well as the NYM_ID argument (you have to pass it twice...)</span>
<a name="l06368"></a>06368 <span class="comment">// Otherwise for inbox/outbox, pass the actual ACCT_ID there as normal.</span>
<a name="l06369"></a>06369 <span class="comment">//</span>
<a name="l06370"></a>06370 <span class="comment">//def OT_ME::get_box_receipt(SERVER_ID, NYM_ID, ACCT_ID, nBoxType, STR_TRANS_NUM)</span>
<a name="l06371"></a>06371 <span class="comment">//{</span>
<a name="l06372"></a>06372 <span class="comment">//    var ot_Msg := OTAPI_Func()</span>
<a name="l06373"></a>06373 <span class="comment">//    // -------------------------</span>
<a name="l06374"></a>06374 <span class="comment">//    var theRequest := OTAPI_Func(ot_Msg.GET_BOX_RECEIPT, SERVER_ID, NYM_ID, ACCT_ID, nBoxType, STR_TRANS_NUM)</span>
<a name="l06375"></a>06375 <span class="comment">//    string strResponse = theRequest.SendRequest(theRequest, &quot;GET_BOX_RECEIPT&quot;)</span>
<a name="l06376"></a>06376 <span class="comment">//</span>
<a name="l06377"></a>06377 <span class="comment">//    return strResponse;</span>
<a name="l06378"></a>06378 <span class="comment">//; }</span>
<a name="l06379"></a>06379 
<a name="l06380"></a>06380 
<a name="l06381"></a><a class="code" href="class_o_t___command.html#a7dd85c0e5c064de65f359e0abadb5089">06381</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7dd85c0e5c064de65f359e0abadb5089">OT_Command::details_download_box_receipt</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strID, <span class="keyword">const</span> int32_t nBoxType)
<a name="l06382"></a>06382 {
<a name="l06383"></a>06383     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l06384"></a>06384     <span class="keywordtype">string</span> strAcctID;
<a name="l06385"></a>06385 
<a name="l06386"></a>06386     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l06387"></a>06387     <span class="comment">//</span>
<a name="l06388"></a>06388     <span class="keywordflow">if</span> (0 == nBoxType)  <span class="comment">// It&#39;s a Nymbox he&#39;s after. (Use NymID for the AcctID, in this case.)</span>
<a name="l06389"></a>06389     {
<a name="l06390"></a>06390         strAcctID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l06391"></a>06391     }
<a name="l06392"></a>06392     <span class="keywordflow">else</span> <span class="comment">// it&#39;s an inbox or outbox (needs an acct ID.)</span>
<a name="l06393"></a>06393     {
<a name="l06394"></a>06394         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>))
<a name="l06395"></a>06395         {
<a name="l06396"></a>06396             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find MyAcct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06397"></a>06397             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06398"></a>06398             <span class="keywordflow">return</span> -1;
<a name="l06399"></a>06399         }
<a name="l06400"></a>06400         <span class="keywordflow">else</span>
<a name="l06401"></a>06401         {
<a name="l06402"></a>06402             strAcctID = <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>;
<a name="l06403"></a>06403 
<a name="l06404"></a>06404             <span class="comment">// (After this point, MyNym contains the NymID, and strMyNymID contains</span>
<a name="l06405"></a>06405             <span class="comment">// the NymID that corresponds to MyAcct -- they may not necessarily be</span>
<a name="l06406"></a>06406             <span class="comment">// the same Nym...)</span>
<a name="l06407"></a>06407             <span class="comment">//</span>
<a name="l06408"></a>06408             strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strAcctID);
<a name="l06409"></a>06409 
<a name="l06410"></a>06410             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l06411"></a>06411             {
<a name="l06412"></a>06412                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06413"></a>06413                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06414"></a>06414                 <span class="keywordflow">return</span> -1;
<a name="l06415"></a>06415             }
<a name="l06416"></a>06416 
<a name="l06417"></a>06417             <span class="keywordflow">if</span> (strMyNymID != <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>)
<a name="l06418"></a>06418             {
<a name="l06419"></a>06419                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Found a NymID based on myacct, but MyNym is not the same ID.\n&quot;</span>);
<a name="l06420"></a>06420                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;To avoid any confusion, please be explicit with Nym ID:   --mynym NYM_ID \n\n&quot;</span>);
<a name="l06421"></a>06421                 <span class="keywordflow">return</span> -1;
<a name="l06422"></a>06422             }
<a name="l06423"></a>06423         }
<a name="l06424"></a>06424     }
<a name="l06425"></a>06425     <span class="comment">// ***************************************************************</span>
<a name="l06426"></a>06426 
<a name="l06427"></a>06427     <span class="comment">// HERE, WE SEND THE &#39;GET BOX RECEIPT&#39; REQUEST TO THE SERVER</span>
<a name="l06428"></a>06428     <span class="comment">//</span>
<a name="l06429"></a>06429     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a94240ee78337fad202644e2a568a3a54">MadeEasy::get_box_receipt</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, strAcctID, nBoxType, strID);
<a name="l06430"></a>06430     <span class="comment">//  string strAttempt = &quot;get_box_receipt&quot;; // unused here.</span>
<a name="l06431"></a>06431 
<a name="l06432"></a>06432     <span class="comment">// ***************************************************************</span>
<a name="l06433"></a>06433     <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l06434"></a>06434     <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l06435"></a>06435     <span class="comment">// handled at a lower level!</span>
<a name="l06436"></a>06436     <span class="comment">//</span>
<a name="l06437"></a>06437     <span class="comment">// Instead, simply check for success or failure:</span>
<a name="l06438"></a>06438     <span class="comment">//</span>
<a name="l06439"></a>06439     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l06440"></a>06440 
<a name="l06441"></a>06441     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nInterpretReply) || (1 != nInterpretReply))
<a name="l06442"></a>06442     {
<a name="l06443"></a>06443         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;get_box_receipt: Failed. nInterpretReply is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nInterpretReply) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l06444"></a>06444         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;get_box_receipt: Perhaps that receipt is no longer in the box?\n&quot;</span>);
<a name="l06445"></a>06445     }
<a name="l06446"></a>06446     <span class="keywordflow">else</span>
<a name="l06447"></a>06447     {
<a name="l06448"></a>06448         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in get_box_receipt! Server response:\n\n&quot;</span>);
<a name="l06449"></a>06449         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l06450"></a>06450         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l06451"></a>06451         <span class="keywordflow">return</span> 1;
<a name="l06452"></a>06452     }
<a name="l06453"></a>06453     <span class="comment">// ***************************************************************</span>
<a name="l06454"></a>06454     <span class="comment">//</span>
<a name="l06455"></a>06455     <span class="comment">// Return status to caller.</span>
<a name="l06456"></a>06456     <span class="comment">//</span>
<a name="l06457"></a>06457     <span class="keywordflow">return</span> nInterpretReply;
<a name="l06458"></a>06458 }
<a name="l06459"></a>06459 
<a name="l06460"></a>06460 
<a name="l06461"></a><a class="code" href="class_o_t___command.html#a7e1a9b154ccbf613a9b17f7b61f879a8">06461</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7e1a9b154ccbf613a9b17f7b61f879a8">OT_Command::main_get_box_receipt</a>()
<a name="l06462"></a>06462 {
<a name="l06463"></a>06463     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\nUsage: getboxreceipt --server SERVER_ID --mynym NYM_ID\n\n&quot;</span>,
<a name="l06464"></a>06464         <span class="stringliteral">&quot;Also:    --args \&quot;box_type BOX_TYPE_ID_HERE id TRANSACTION_ID_HERE\&quot;\nBox types are 0 (Nymbox), 1 (Inbox), 2 (Outbox)\n\n&quot;</span>);
<a name="l06465"></a>06465 
<a name="l06466"></a>06466     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06467"></a>06467 
<a name="l06468"></a>06468     <span class="keywordtype">string</span> strID;
<a name="l06469"></a>06469     int32_t nBoxType = 1;  <span class="comment">// Inbox by default.</span>
<a name="l06470"></a>06470 
<a name="l06471"></a>06471     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l06472"></a>06472     {
<a name="l06473"></a>06473 
<a name="l06474"></a>06474         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l06475"></a>06475         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l06476"></a>06476         <span class="comment">// at the command line.</span>
<a name="l06477"></a>06477         <span class="comment">//</span>
<a name="l06478"></a>06478         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l06479"></a>06479         {
<a name="l06480"></a>06480             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l06481"></a>06481             <span class="comment">//                                  const std::string str_key)</span>
<a name="l06482"></a>06482             <span class="comment">//</span>
<a name="l06483"></a>06483             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l06484"></a>06484             <span class="comment">// EXAMPLE:  --args &quot;box_type 0 id 98&quot;</span>
<a name="l06485"></a>06485             <span class="comment">//</span>
<a name="l06486"></a>06486             <span class="keywordtype">string</span> strNewID = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;id&quot;</span>);
<a name="l06487"></a>06487             <span class="keywordtype">string</span> strNewType = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;box_type&quot;</span>);
<a name="l06488"></a>06488 
<a name="l06489"></a>06489 
<a name="l06490"></a>06490             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l06491"></a>06491             <span class="comment">//</span>
<a name="l06492"></a>06492             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewID))
<a name="l06493"></a>06493             {
<a name="l06494"></a>06494                 strID = strNewID;
<a name="l06495"></a>06495             }
<a name="l06496"></a>06496             <span class="keywordflow">else</span>
<a name="l06497"></a>06497             {
<a name="l06498"></a>06498                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nMissing --args \&quot;id TRANSACTION_ID_HERE\&quot;\n\n&quot;</span>);
<a name="l06499"></a>06499                 <span class="keywordflow">return</span> -1;
<a name="l06500"></a>06500             }
<a name="l06501"></a>06501             <span class="comment">// **************************************************************</span>
<a name="l06502"></a>06502             <span class="comment">//</span>
<a name="l06503"></a>06503             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewType))
<a name="l06504"></a>06504             {
<a name="l06505"></a>06505                 nBoxType = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strNewType);
<a name="l06506"></a>06506             }
<a name="l06507"></a>06507 
<a name="l06508"></a>06508             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nBoxType) || (nBoxType &lt; 0) || (nBoxType &gt; 2))
<a name="l06509"></a>06509             {
<a name="l06510"></a>06510                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n box_type cannot be &lt;0 or &gt;2. Try:  --args \&quot;box_type 1\&quot;\nBox types are 0 (Nymbox), 1 (Inbox), 2 (Outbox)\n\n&quot;</span>);
<a name="l06511"></a>06511                 <span class="keywordflow">return</span> -1;
<a name="l06512"></a>06512             }
<a name="l06513"></a>06513 
<a name="l06514"></a>06514             <span class="comment">// If Inbox or Outbox, make sure we have an acct...</span>
<a name="l06515"></a>06515             <span class="comment">//</span>
<a name="l06516"></a>06516             <span class="keywordflow">if</span> ((nBoxType != 0) &amp;&amp; !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>))
<a name="l06517"></a>06517             {
<a name="l06518"></a>06518                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n For inbox (1) or outbox (2) box types, need an account ID.\nMissing: --myacct ACCT_ID_HERE \n\n&quot;</span>);
<a name="l06519"></a>06519                 <span class="keywordflow">return</span> -1;
<a name="l06520"></a>06520             }
<a name="l06521"></a>06521 
<a name="l06522"></a>06522 
<a name="l06523"></a>06523             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a7dd85c0e5c064de65f359e0abadb5089">details_download_box_receipt</a>(strID, nBoxType);
<a name="l06524"></a>06524         }
<a name="l06525"></a>06525 
<a name="l06526"></a>06526     }
<a name="l06527"></a>06527 
<a name="l06528"></a>06528     <span class="keywordflow">return</span> -1;
<a name="l06529"></a>06529 }
<a name="l06530"></a>06530 
<a name="l06531"></a>06531 
<a name="l06532"></a>06532 <span class="comment">//</span>
<a name="l06533"></a>06533 <span class="comment">// WITHDRAW CASH</span>
<a name="l06534"></a>06534 <span class="comment">//</span>
<a name="l06535"></a>06535 <span class="comment">// (from asset account on server to cash purse on client.)</span>
<a name="l06536"></a>06536 <span class="comment">//</span>
<a name="l06537"></a><a class="code" href="class_o_t___command.html#acc3f606cbc8020175e6750b0fc919907">06537</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acc3f606cbc8020175e6750b0fc919907">OT_Command::details_withdraw_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> int64_t lAmount)
<a name="l06538"></a>06538 {
<a name="l06539"></a>06539     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l06540"></a>06540     <span class="comment">//</span>
<a name="l06541"></a>06541     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l06542"></a>06542 
<a name="l06543"></a>06543     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l06544"></a>06544     {
<a name="l06545"></a>06545         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06546"></a>06546         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06547"></a>06547         <span class="keywordflow">return</span> -1;
<a name="l06548"></a>06548     }
<a name="l06549"></a>06549 
<a name="l06550"></a>06550     <span class="comment">// MAKE SURE WE HAVE THE RIGHT ASSET CONTRACT</span>
<a name="l06551"></a>06551     <span class="comment">//</span>
<a name="l06552"></a>06552     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcctID);
<a name="l06553"></a>06553 
<a name="l06554"></a>06554     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID))
<a name="l06555"></a>06555     {
<a name="l06556"></a>06556         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Asset Type ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06557"></a>06557         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the asset type based on the account.\n\n&quot;</span>);
<a name="l06558"></a>06558         <span class="keywordflow">return</span> -1;
<a name="l06559"></a>06559     }
<a name="l06560"></a>06560 
<a name="l06561"></a>06561     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l06562"></a>06562 
<a name="l06563"></a>06563     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l06564"></a>06564     {
<a name="l06565"></a>06565         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to find the server ID based on the account. Strange! Perhaps specify a different account? Use:  --myacct ACCT_ID \n&quot;</span>);
<a name="l06566"></a>06566         <span class="keywordflow">return</span> -1;
<a name="l06567"></a>06567     }
<a name="l06568"></a>06568 
<a name="l06569"></a>06569     <span class="keywordflow">if</span> ((<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(strServerID == <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>)))
<a name="l06570"></a>06570     {
<a name="l06571"></a>06571         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;This account is on server ( &quot;</span> + strServerID + <span class="stringliteral">&quot; -- the server is deduced based on the account), but the default server is ( &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot; ). To override it, use:  --server &quot;</span> + strServerID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l06572"></a>06572         <span class="keywordflow">return</span> -1;
<a name="l06573"></a>06573     }
<a name="l06574"></a>06574 
<a name="l06575"></a>06575     <span class="keywordtype">string</span> assetContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a2f31b0655824666123eb389bb06b92d4">OTAPI_Wrap::LoadAssetContract</a>(strAssetTypeID);
<a name="l06576"></a>06576 
<a name="l06577"></a>06577     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(assetContract))
<a name="l06578"></a>06578     {
<a name="l06579"></a>06579         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a97766d73bf84555d7d04e41674b6b425">MadeEasy::retrieve_contract</a>(strServerID, strMyNymID, strAssetTypeID);
<a name="l06580"></a>06580 
<a name="l06581"></a>06581         <span class="keywordflow">if</span> (1 != <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse))
<a name="l06582"></a>06582         {
<a name="l06583"></a>06583             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_withdraw_cash: Unable to retrieve contract for IDs: \n&quot;</span>);
<a name="l06584"></a>06584             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;  Server ID: &quot;</span> + strServerID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l06585"></a>06585             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;   Asset ID: &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l06586"></a>06586             <span class="keywordflow">return</span> -1;
<a name="l06587"></a>06587         }
<a name="l06588"></a>06588 
<a name="l06589"></a>06589         assetContract = <a class="code" href="class_o_t_a_p_i___wrap.html#a2f31b0655824666123eb389bb06b92d4">OTAPI_Wrap::LoadAssetContract</a>(strAssetTypeID);
<a name="l06590"></a>06590 
<a name="l06591"></a>06591         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(assetContract))
<a name="l06592"></a>06592         {
<a name="l06593"></a>06593             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to load Asset contract even after retrieving it.\n&quot;</span>);
<a name="l06594"></a>06594             <span class="keywordflow">return</span> -1;
<a name="l06595"></a>06595         }
<a name="l06596"></a>06596     }
<a name="l06597"></a>06597     <span class="comment">// By this point, we KNOW the appropriate asset contract is available.</span>
<a name="l06598"></a>06598 
<a name="l06599"></a>06599     <span class="comment">//</span>
<a name="l06600"></a>06600     <span class="comment">// HERE, WE MAKE SURE WE HAVE THE PROPER MINT...</span>
<a name="l06601"></a>06601     <span class="comment">//</span>
<a name="l06602"></a>06602     <span class="keywordtype">string</span> strMint = <a class="code" href="class_made_easy.html#afe2b07045aea23451aa7144badf9faf8">MadeEasy::load_or_retrieve_mint</a>(strServerID, strMyNymID, strAssetTypeID);
<a name="l06603"></a>06603 
<a name="l06604"></a>06604     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMint))
<a name="l06605"></a>06605     {
<a name="l06606"></a>06606         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to load or retrieve necessary mint file for withdrawal.\n&quot;</span>);
<a name="l06607"></a>06607         <span class="keywordflow">return</span> -1;
<a name="l06608"></a>06608     }
<a name="l06609"></a>06609     <span class="comment">// By this point, we know we can successfully load both:</span>
<a name="l06610"></a>06610     <span class="comment">// 1. the proper asset contract.</span>
<a name="l06611"></a>06611     <span class="comment">// 2. the proper (unexpired) mint file.</span>
<a name="l06612"></a>06612     <span class="comment">// ***************************************************************</span>
<a name="l06613"></a>06613     <span class="comment">// HERE, WE SEND THE WITHDRAWAL REQUEST TO THE SERVER</span>
<a name="l06614"></a>06614     <span class="comment">//</span>
<a name="l06615"></a>06615 
<a name="l06616"></a>06616     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a93bef2b6b1857dc20fd8f466f7db62b3">MadeEasy::withdraw_cash</a>(strServerID, strMyNymID, strMyAcctID, lAmount);
<a name="l06617"></a>06617     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;withdraw_cash&quot;</span>;
<a name="l06618"></a>06618     <span class="comment">// ***************************************************************</span>
<a name="l06619"></a>06619 
<a name="l06620"></a>06620     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l06621"></a>06621 
<a name="l06622"></a>06622     <span class="comment">//VerifyMsgTrnxSuccess</span>
<a name="l06623"></a>06623     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strMyNymID, strMyAcctID, strAttempt, strResponse);
<a name="l06624"></a>06624 
<a name="l06625"></a>06625     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l06626"></a>06626     {
<a name="l06627"></a>06627         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l06628"></a>06628         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l06629"></a>06629         <span class="comment">//</span>
<a name="l06630"></a>06630         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strMyNymID, strMyAcctID, <span class="keyword">false</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l06631"></a>06631 
<a name="l06632"></a>06632         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS withdrawing cash! (From account on server to local purse.) \n&quot;</span>);
<a name="l06633"></a>06633         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l06634"></a>06634     }
<a name="l06635"></a>06635 
<a name="l06636"></a>06636     <span class="comment">// ***************************************************************</span>
<a name="l06637"></a>06637     <span class="comment">//</span>
<a name="l06638"></a>06638     <span class="comment">// Return status to caller.</span>
<a name="l06639"></a>06639     <span class="comment">//</span>
<a name="l06640"></a>06640     <span class="keywordflow">return</span> nInterpretReply;
<a name="l06641"></a>06641 }
<a name="l06642"></a>06642 
<a name="l06643"></a>06643 
<a name="l06644"></a>06644 <span class="comment">// HERE, WE GET ALL THE ARGUMENTS TOGETHER,</span>
<a name="l06645"></a>06645 <span class="comment">// and then call the above function.</span>
<a name="l06646"></a>06646 <span class="comment">//</span>
<a name="l06647"></a><a class="code" href="class_o_t___command.html#a3452d4ce275da9100e661dc8ac9ad0c4">06647</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3452d4ce275da9100e661dc8ac9ad0c4">OT_Command::main_withdraw_cash</a>()
<a name="l06648"></a>06648 {
<a name="l06649"></a>06649     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n  USAGE: withdraw --myacct YOUR_ASSET_ACCT \n&quot;</span>,
<a name="l06650"></a>06650         <span class="stringliteral">&quot;You can provide an amount:  --args \&quot;amount PUT_AMOUNT_HERE\&quot;\n\n&quot;</span>);
<a name="l06651"></a>06651 
<a name="l06652"></a>06652     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06653"></a>06653 
<a name="l06654"></a>06654 
<a name="l06655"></a>06655     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06656"></a>06656     {
<a name="l06657"></a>06657 
<a name="l06658"></a>06658         <span class="comment">// strAmount</span>
<a name="l06659"></a>06659         <span class="comment">//</span>
<a name="l06660"></a>06660         <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l06661"></a>06661 
<a name="l06662"></a>06662         <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l06663"></a>06663 
<a name="l06664"></a>06664         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l06665"></a>06665         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l06666"></a>06666         <span class="comment">// at the command line.</span>
<a name="l06667"></a>06667         <span class="comment">//</span>
<a name="l06668"></a>06668         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>)) <span class="comment">// displayErrorMsg=false</span>
<a name="l06669"></a>06669         {
<a name="l06670"></a>06670             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l06671"></a>06671             <span class="comment">//                                  const std::string str_key)</span>
<a name="l06672"></a>06672             <span class="comment">//</span>
<a name="l06673"></a>06673             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l06674"></a>06674             <span class="comment">// EXAMPLE:  --args &quot;amount 1&quot;</span>
<a name="l06675"></a>06675             <span class="comment">//</span>
<a name="l06676"></a>06676             <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>); <span class="comment">// any integer value</span>
<a name="l06677"></a>06677 
<a name="l06678"></a>06678 
<a name="l06679"></a>06679             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l06680"></a>06680             <span class="comment">//</span>
<a name="l06681"></a>06681             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount))
<a name="l06682"></a>06682             {
<a name="l06683"></a>06683                 strAmount = strNewAmount;
<a name="l06684"></a>06684             }
<a name="l06685"></a>06685         }
<a name="l06686"></a>06686 
<a name="l06687"></a>06687 
<a name="l06688"></a>06688         <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06689"></a>06689 
<a name="l06690"></a>06690         <span class="comment">// If the withdrawal parameters aren&#39;t provided, then we</span>
<a name="l06691"></a>06691         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l06692"></a>06692         <span class="comment">//</span>
<a name="l06693"></a>06693         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l06694"></a>06694         {
<a name="l06695"></a>06695             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the amount[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l06696"></a>06696             strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l06697"></a>06697         }
<a name="l06698"></a>06698 
<a name="l06699"></a>06699         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l06700"></a>06700         {
<a name="l06701"></a>06701             strAmount = strDefaultAmount;
<a name="l06702"></a>06702         }
<a name="l06703"></a>06703 
<a name="l06704"></a>06704         int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount);
<a name="l06705"></a>06705 
<a name="l06706"></a>06706         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#acc3f606cbc8020175e6750b0fc919907">details_withdraw_cash</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, lAmount);   <span class="comment">// &lt;========================</span>
<a name="l06707"></a>06707     }
<a name="l06708"></a>06708 
<a name="l06709"></a>06709     <span class="keywordflow">return</span> -1;
<a name="l06710"></a>06710 }
<a name="l06711"></a>06711 
<a name="l06712"></a>06712 
<a name="l06713"></a>06713 <span class="comment">/*</span>
<a name="l06714"></a>06714 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Wallet_GetNymIDFromPartial),     &quot;OT_API_Wallet_GetNymIDFromPartial&quot;)</span>
<a name="l06715"></a>06715 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Wallet_GetServerIDFromPartial),  &quot;OT_API_Wallet_GetServerIDFromPartial&quot;)</span>
<a name="l06716"></a>06716 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Wallet_GetAssetIDFromPartial),   &quot;OT_API_Wallet_GetAssetIDFromPartial&quot;)</span>
<a name="l06717"></a>06717 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Wallet_GetAccountIDFromPartial), &quot;OT_API_Wallet_GetAccountIDFromPartial&quot;)</span>
<a name="l06718"></a>06718 <span class="comment"></span>
<a name="l06719"></a>06719 <span class="comment">*/</span>
<a name="l06720"></a>06720 
<a name="l06721"></a>06721 
<a name="l06722"></a>06722 <span class="comment">//</span>
<a name="l06723"></a>06723 <span class="comment">// WITHDRAW VOUCHER</span>
<a name="l06724"></a>06724 <span class="comment">//</span>
<a name="l06725"></a>06725 <span class="comment">//(From asset account into instrument form,</span>
<a name="l06726"></a>06726 <span class="comment">// like a cashier&#39;s cheque.)</span>
<a name="l06727"></a>06727 <span class="comment">//</span>
<a name="l06728"></a>06728 
<a name="l06729"></a>06729 
<a name="l06730"></a><a class="code" href="class_o_t___command.html#acfed0fa1ec15e3aab249af6a404852e4">06730</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acfed0fa1ec15e3aab249af6a404852e4">OT_Command::details_withdraw_voucher</a>(<span class="keywordtype">string</span> &amp; strOutput)
<a name="l06731"></a>06731 {
<a name="l06732"></a>06732     <span class="comment">// HERE, WE LOOK UP THE NYM ID</span>
<a name="l06733"></a>06733     <span class="comment">//</span>
<a name="l06734"></a>06734     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06735"></a>06735 
<a name="l06736"></a>06736     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l06737"></a>06737     {
<a name="l06738"></a>06738         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06739"></a>06739         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l06740"></a>06740         <span class="keywordflow">return</span> -1;
<a name="l06741"></a>06741     }
<a name="l06742"></a>06742 
<a name="l06743"></a>06743     <span class="comment">// HERE, WE LOOK UP THE SERVER ID</span>
<a name="l06744"></a>06744     <span class="comment">//</span>
<a name="l06745"></a>06745     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06746"></a>06746 
<a name="l06747"></a>06747     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l06748"></a>06748     {
<a name="l06749"></a>06749         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find the server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l06750"></a>06750         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the server ID based on the account.\n\n&quot;</span>);
<a name="l06751"></a>06751         <span class="keywordflow">return</span> -1;
<a name="l06752"></a>06752     }
<a name="l06753"></a>06753 
<a name="l06754"></a>06754     <span class="keywordtype">string</span> strHisNymID;
<a name="l06755"></a>06755 
<a name="l06756"></a>06756     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>)) <span class="comment">// This ID is already validated in the C++ code (in this case.)</span>
<a name="l06757"></a>06757     {
<a name="l06758"></a>06758         strHisNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>;
<a name="l06759"></a>06759 
<a name="l06760"></a>06760         <span class="keywordtype">string</span> strRecipientPubkey = <a class="code" href="class_made_easy.html#a82807325b20589a65adbfc7389c3c45a">MadeEasy::load_or_retrieve_encrypt_key</a>(strServerID, strMyNymID, strHisNymID);
<a name="l06761"></a>06761 
<a name="l06762"></a>06762         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientPubkey))
<a name="l06763"></a>06763         {
<a name="l06764"></a>06764             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to load or download pubkey for HisNym based on given value (&quot;</span> + strHisNymID + <span class="stringliteral">&quot;). To override, use: --hisnym HIS_NYM_ID\n\n&quot;</span>);
<a name="l06765"></a>06765             <span class="keywordflow">return</span> -1;
<a name="l06766"></a>06766         }
<a name="l06767"></a>06767 
<a name="l06768"></a>06768     }
<a name="l06769"></a>06769     <span class="keywordflow">else</span>
<a name="l06770"></a>06770     {
<a name="l06771"></a>06771         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter recipient NymID (abbreviations accepted): &quot;</span>);
<a name="l06772"></a>06772 
<a name="l06773"></a>06773         <span class="keywordtype">string</span> strHisPartialNymID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l06774"></a>06774 
<a name="l06775"></a>06775         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisPartialNymID)) <span class="comment">// If the user typed something...</span>
<a name="l06776"></a>06776         {
<a name="l06777"></a>06777             strHisNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7c526c067a62f1b534fb7bfdb02b869d">OTAPI_Wrap::Wallet_GetNymIDFromPartial</a>(strHisPartialNymID); <span class="comment">// Try to find the associated ID...</span>
<a name="l06778"></a>06778 
<a name="l06779"></a>06779             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymID)) <span class="comment">// But if it returned NULL, failure (return.)</span>
<a name="l06780"></a>06780             {
<a name="l06781"></a>06781                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find HisNym (Recipient) in your wallet. Use: --hisnym NYM_ID\n&quot;</span>);
<a name="l06782"></a>06782                 <span class="keywordflow">return</span> -1;
<a name="l06783"></a>06783             }
<a name="l06784"></a>06784         }
<a name="l06785"></a>06785 
<a name="l06786"></a>06786         <span class="keywordflow">else</span> <span class="comment">// The user just hit &quot;enter&quot; so we&#39;ll default the recipient Nym to the user himself.</span>
<a name="l06787"></a>06787         {
<a name="l06788"></a>06788             strHisNymID = strMyNymID;
<a name="l06789"></a>06789         }
<a name="l06790"></a>06790 
<a name="l06791"></a>06791     }
<a name="l06792"></a>06792 
<a name="l06793"></a>06793     <span class="comment">// ***************************************************************</span>
<a name="l06794"></a>06794     <span class="comment">//</span>
<a name="l06795"></a>06795     <span class="comment">// strAmount and strMemo...</span>
<a name="l06796"></a>06796     <span class="comment">//</span>
<a name="l06797"></a>06797     <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must ultimately be &gt;= 1</span>
<a name="l06798"></a>06798     <span class="keywordtype">string</span> strMemo = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// can be blank</span>
<a name="l06799"></a>06799 
<a name="l06800"></a>06800     <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l06801"></a>06801     <span class="keywordtype">string</span> strDefaultMemo = <span class="stringliteral">&quot;(blank memo field)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l06802"></a>06802 
<a name="l06803"></a>06803     <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l06804"></a>06804     <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l06805"></a>06805     <span class="comment">// at the command line.</span>
<a name="l06806"></a>06806     <span class="comment">//</span>
<a name="l06807"></a>06807     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06808"></a>06808 
<a name="l06809"></a>06809     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l06810"></a>06810     {
<a name="l06811"></a>06811         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l06812"></a>06812         <span class="comment">//                                  const std::string str_key)</span>
<a name="l06813"></a>06813         <span class="comment">//</span>
<a name="l06814"></a>06814         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l06815"></a>06815         <span class="comment">// EXAMPLE:  --args &quot;amount 1&quot;</span>
<a name="l06816"></a>06816         <span class="comment">// EXAMPLE:  --args &quot;amount 15 memo \&quot;Just a memo for the voucher cheque.\&quot;&quot;</span>
<a name="l06817"></a>06817         <span class="comment">//</span>
<a name="l06818"></a>06818         <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>); <span class="comment">// any integer value</span>
<a name="l06819"></a>06819         <span class="keywordtype">string</span> strNewMemo = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;memo&quot;</span>);     <span class="comment">// optional memo field</span>
<a name="l06820"></a>06820 
<a name="l06821"></a>06821 
<a name="l06822"></a>06822         <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l06823"></a>06823         <span class="comment">//</span>
<a name="l06824"></a>06824         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount))
<a name="l06825"></a>06825         {
<a name="l06826"></a>06826             strAmount = strNewAmount;
<a name="l06827"></a>06827         }
<a name="l06828"></a>06828         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMemo))
<a name="l06829"></a>06829         {
<a name="l06830"></a>06830             strMemo = strNewMemo;
<a name="l06831"></a>06831         }
<a name="l06832"></a>06832     }
<a name="l06833"></a>06833 
<a name="l06834"></a>06834     <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l06835"></a>06835     <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l06836"></a>06836     <span class="comment">//</span>
<a name="l06837"></a>06837     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l06838"></a>06838     {
<a name="l06839"></a>06839         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the amount[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l06840"></a>06840         strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l06841"></a>06841     }
<a name="l06842"></a>06842     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l06843"></a>06843     {
<a name="l06844"></a>06844         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a memo on a single line[&quot;</span> + strDefaultMemo + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l06845"></a>06845         strMemo = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l06846"></a>06846     }
<a name="l06847"></a>06847 
<a name="l06848"></a>06848     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l06849"></a>06849     {
<a name="l06850"></a>06850         strAmount = strDefaultAmount;
<a name="l06851"></a>06851     }
<a name="l06852"></a>06852     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l06853"></a>06853     {
<a name="l06854"></a>06854         strMemo = strDefaultMemo;
<a name="l06855"></a>06855     }
<a name="l06856"></a>06856 
<a name="l06857"></a>06857     <span class="comment">// ***************************************************************</span>
<a name="l06858"></a>06858 
<a name="l06859"></a>06859     <span class="comment">// HERE, WE SEND THE VOUCHER WITHDRAWAL REQUEST TO THE SERVER</span>
<a name="l06860"></a>06860     <span class="comment">//</span>
<a name="l06861"></a>06861     int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount);
<a name="l06862"></a>06862     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#ad5d4824f1eaab616ef76ca09e2b259cb">MadeEasy::withdraw_voucher</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strHisNymID, strMemo, lAmount);
<a name="l06863"></a>06863     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;withdraw_voucher&quot;</span>;
<a name="l06864"></a>06864     <span class="comment">//  static int32_t withdrawVoucher(const std::string SERVER_ID,</span>
<a name="l06865"></a>06865     <span class="comment">//                             const std::string USER_ID,</span>
<a name="l06866"></a>06866     <span class="comment">//                             const std::string ACCT_ID,</span>
<a name="l06867"></a>06867     <span class="comment">//                             const std::string RECIPIENT_USER_ID,</span>
<a name="l06868"></a>06868     <span class="comment">//                             const std::string CHEQUE_MEMO,</span>
<a name="l06869"></a>06869     <span class="comment">//                             const std::string AMOUNT)</span>
<a name="l06870"></a>06870     <span class="comment">// ***************************************************************</span>
<a name="l06871"></a>06871     <span class="comment">//</span>
<a name="l06872"></a>06872     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l06873"></a>06873 
<a name="l06874"></a>06874     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strAttempt, strResponse);
<a name="l06875"></a>06875 
<a name="l06876"></a>06876     <span class="keywordflow">if</span> (1 == nInterpretReply) <span class="comment">// Success!</span>
<a name="l06877"></a>06877     {
<a name="l06878"></a>06878 
<a name="l06879"></a>06879         <span class="keywordtype">string</span> strLedger = <a class="code" href="class_o_t_a_p_i___wrap.html#aae2b5bf85126104816f97a15bd54acf6">OTAPI_Wrap::Message_GetLedger</a>(strResponse);
<a name="l06880"></a>06880 
<a name="l06881"></a>06881         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLedger))
<a name="l06882"></a>06882         {
<a name="l06883"></a>06883             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_withdraw_voucher: Error: strLedger is null, returned by OT_API_Message_GetLedger.\n&quot;</span>);
<a name="l06884"></a>06884             <span class="keywordflow">return</span> -1;
<a name="l06885"></a>06885         }
<a name="l06886"></a>06886 
<a name="l06887"></a>06887         <span class="keywordtype">string</span> strTransReply = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strLedger, 0); <span class="comment">// index 0.</span>
<a name="l06888"></a>06888 
<a name="l06889"></a>06889         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransReply))
<a name="l06890"></a>06890         {
<a name="l06891"></a>06891             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;details_withdraw_voucher: Error: strTransReply is unexpectedly null, returned by &quot;</span>,
<a name="l06892"></a>06892                 <span class="stringliteral">&quot;OT_API_Ledger_GetTransactionByIndex, argument passed, index 0 and ledger:\n\n&quot;</span>) + strLedger + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l06893"></a>06893             <span class="keywordflow">return</span> -1;
<a name="l06894"></a>06894         }
<a name="l06895"></a>06895 
<a name="l06896"></a>06896 
<a name="l06897"></a>06897         strOutput = <a class="code" href="class_o_t_a_p_i___wrap.html#a113876abf49f82a6ba0259c3df4053cc">OTAPI_Wrap::Transaction_GetVoucher</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTransReply);
<a name="l06898"></a>06898 
<a name="l06899"></a>06899         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutput))
<a name="l06900"></a>06900         {
<a name="l06901"></a>06901             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;details_withdraw_voucher: Error: Voucher is unexpectedly null, returned by &quot;</span>,
<a name="l06902"></a>06902                 <span class="stringliteral">&quot;OT_API_Transaction_GetVoucher with strTransReply set to:\n\n&quot;</span>) + strTransReply + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l06903"></a>06903             <span class="keywordflow">return</span> -1;
<a name="l06904"></a>06904         }
<a name="l06905"></a>06905         <span class="keywordflow">else</span>
<a name="l06906"></a>06906         {
<a name="l06907"></a>06907             <span class="comment">// Save a copy in my own outpayments box. I don&#39;t want to lose this voucher since it uses</span>
<a name="l06908"></a>06908             <span class="comment">// one of my own transaction numbers. (If I later send the voucher to someone, OT is smart</span>
<a name="l06909"></a>06909             <span class="comment">// enough to remove the first copy from outpayments, when adding the second copy.)</span>
<a name="l06910"></a>06910             <span class="comment">//</span>
<a name="l06911"></a>06911             <span class="comment">// Notice how I can send an instrument to myself. This doesn&#39;t actually send anything --</span>
<a name="l06912"></a>06912             <span class="comment">// it just puts a copy into my outpayments box for safe-keeping.</span>
<a name="l06913"></a>06913             <span class="comment">//</span>
<a name="l06914"></a>06914             <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strMyNymID, strMyNymID, strOutput);
<a name="l06915"></a>06915         }
<a name="l06916"></a>06916 
<a name="l06917"></a>06917         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l06918"></a>06918         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l06919"></a>06919         <span class="comment">//</span>
<a name="l06920"></a>06920         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l06921"></a>06921         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l06922"></a>06922 
<a name="l06923"></a>06923         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_withdraw_voucher: Voucher returned by OT_API_Transaction_GetVoucher:\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l06924"></a>06924         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOutput); <span class="comment">// stdout</span>
<a name="l06925"></a>06925         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr.</span>
<a name="l06926"></a>06926 
<a name="l06927"></a>06927         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS withdrawing voucher (cashier&#39;s cheque)!\n&quot;</span>);
<a name="l06928"></a>06928 
<a name="l06929"></a>06929         <span class="keywordflow">return</span> 1;
<a name="l06930"></a>06930     }
<a name="l06931"></a>06931 
<a name="l06932"></a>06932     <span class="comment">// ***************************************************************</span>
<a name="l06933"></a>06933     <span class="comment">//</span>
<a name="l06934"></a>06934     <span class="comment">// Return status to caller.</span>
<a name="l06935"></a>06935     <span class="comment">//</span>
<a name="l06936"></a>06936     <span class="keywordflow">return</span> nInterpretReply;
<a name="l06937"></a>06937 }
<a name="l06938"></a>06938 
<a name="l06939"></a>06939 
<a name="l06940"></a>06940 <span class="comment">//  static int32_t withdrawVoucher(const std::string SERVER_ID,</span>
<a name="l06941"></a>06941 <span class="comment">//                             const std::string USER_ID,</span>
<a name="l06942"></a>06942 <span class="comment">//                             const std::string ACCT_ID,</span>
<a name="l06943"></a>06943 <span class="comment">//                             const std::string RECIPIENT_USER_ID,</span>
<a name="l06944"></a>06944 <span class="comment">//                             const std::string CHEQUE_MEMO,</span>
<a name="l06945"></a>06945 <span class="comment">//                             const std::string AMOUNT)</span>
<a name="l06946"></a>06946 
<a name="l06947"></a>06947 <span class="comment">// HERE, WE GET ALL THE ARGUMENTS TOGETHER,</span>
<a name="l06948"></a>06948 <span class="comment">// and then call the above function.</span>
<a name="l06949"></a>06949 <span class="comment">//</span>
<a name="l06950"></a><a class="code" href="class_o_t___command.html#a6e03163bf7d82f854953045580d91b82">06950</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a6e03163bf7d82f854953045580d91b82">OT_Command::main_withdraw_voucher</a>()
<a name="l06951"></a>06951 {
<a name="l06952"></a>06952     <span class="keywordtype">string</span> strUsage1 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n  USAGE: buyvoucher --myacct YOUR_ASSET_ACCT --hisnym RECIPIENT_NYM_ID\n\n&quot;</span>,
<a name="l06953"></a>06953         <span class="stringliteral">&quot;Also NECESSARY: --args \&quot;amount PUT_AMOUNT_HERE\&quot;\n&quot;</span>);
<a name="l06954"></a>06954     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1,
<a name="l06955"></a>06955         <span class="stringliteral">&quot;And OPTIONALLY: --args \&quot;memo \\\&quot;Just a memo for the voucher cheque.\\\&quot;\&quot;\n\n&quot;</span>);
<a name="l06956"></a>06956 
<a name="l06957"></a>06957     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06958"></a>06958 
<a name="l06959"></a>06959 
<a name="l06960"></a>06960     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06961"></a>06961     {
<a name="l06962"></a>06962         <span class="keywordtype">string</span> strVoucher = <span class="stringliteral">&quot;&quot;</span>;
<a name="l06963"></a>06963         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#acfed0fa1ec15e3aab249af6a404852e4">details_withdraw_voucher</a>(strVoucher);
<a name="l06964"></a>06964     }
<a name="l06965"></a>06965 
<a name="l06966"></a>06966     <span class="keywordflow">return</span> -1;
<a name="l06967"></a>06967 }
<a name="l06968"></a>06968 
<a name="l06969"></a>06969 
<a name="l06970"></a><a class="code" href="class_o_t___command.html#a39ce10db5202c79b2a6a8e1ee3ef7c85">06970</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a39ce10db5202c79b2a6a8e1ee3ef7c85">OT_Command::main_sendvoucher</a>()
<a name="l06971"></a>06971 {
<a name="l06972"></a>06972     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;Usage:  sendvoucher  --myacct MY_ASSET_ACCT --hisnym RECIPIENT_NYM_ID\n&quot;</span>;
<a name="l06973"></a>06973     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;Server is deduced from MyAcct. This command withdraws AND SENDS the\nvoucher. (Use &#39;buyvoucher&#39;, not &#39;sendvoucher&#39;, if you don&#39;t want it to be immediately SENT.)\n&quot;</span>;
<a name="l06974"></a>06974     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Optionally: --args \&quot;memo \\\&quot;one-line memo allowed here.\\\&quot; amount AMOUNT\&quot;\n&quot;</span>, strUsage2);
<a name="l06975"></a>06975 
<a name="l06976"></a>06976     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l06977"></a>06977 
<a name="l06978"></a>06978     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l06979"></a>06979     {
<a name="l06980"></a>06980         <span class="keywordtype">string</span> strCheque = <span class="stringliteral">&quot;&quot;</span>;
<a name="l06981"></a>06981         int32_t nReturnVal = <a class="code" href="class_o_t___command.html#acfed0fa1ec15e3aab249af6a404852e4">details_withdraw_voucher</a>(strCheque);
<a name="l06982"></a>06982 
<a name="l06983"></a>06983         <span class="comment">//</span>
<a name="l06984"></a>06984         <span class="keywordflow">if</span> ((1 == nReturnVal) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCheque))
<a name="l06985"></a>06985         {
<a name="l06986"></a>06986             <span class="comment">// stderr</span>
<a name="l06987"></a>06987             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n-------------------------------------------\n the voucher:\n\n&quot;</span>);
<a name="l06988"></a>06988             <span class="comment">// stdout</span>
<a name="l06989"></a>06989             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCheque);
<a name="l06990"></a>06990             <span class="comment">// stderr</span>
<a name="l06991"></a>06991             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l06992"></a>06992 
<a name="l06993"></a>06993             <span class="comment">// TODO: Store a copy in outpayments box (OR VERIFY THAT IT&#39;S ALREADY BEING DONE, WHICH I BELIEVE THAT IT IS.)</span>
<a name="l06994"></a>06994 
<a name="l06995"></a>06995             <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strCheque);
<a name="l06996"></a>06996             <span class="keywordtype">string</span> strSenderNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l06997"></a>06997             <span class="keywordtype">string</span> strRecipientNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strCheque);
<a name="l06998"></a>06998 
<a name="l06999"></a>06999             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l07000"></a>07000             {
<a name="l07001"></a>07001                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Server ID from this voucher! Very strange. (Failure.)\n&quot;</span>);
<a name="l07002"></a>07002                 <span class="keywordflow">return</span> -1;
<a name="l07003"></a>07003             }
<a name="l07004"></a>07004             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderNymID))
<a name="l07005"></a>07005             {
<a name="l07006"></a>07006                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve a Sender Nym ID from this voucher! Very strange. (Failure.)\n&quot;</span>);
<a name="l07007"></a>07007                 <span class="keywordflow">return</span> -1;
<a name="l07008"></a>07008             }
<a name="l07009"></a>07009             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientNymID))
<a name="l07010"></a>07010             {
<a name="l07011"></a>07011                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Unable to retrieve a Recipient Nym ID from this voucher! Very strange. (Failure.)\n(Although &quot;</span>,
<a name="l07012"></a>07012                     <span class="stringliteral">&quot;it&#39;s fine to WITHDRAW a voucher with no recipient, still need the recipient ID to SEND one.)\n&quot;</span>));
<a name="l07013"></a>07013                 <span class="keywordflow">return</span> -1;
<a name="l07014"></a>07014             }
<a name="l07015"></a>07015 
<a name="l07016"></a>07016             <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7801c408f80a7b041b31490e33cbc1fd">MadeEasy::send_user_payment</a>(strServerID, strSenderNymID, strRecipientNymID, strCheque);
<a name="l07017"></a>07017 
<a name="l07018"></a>07018             <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07019"></a>07019             <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07020"></a>07020             <span class="comment">// handled at a lower level!</span>
<a name="l07021"></a>07021             <span class="comment">//</span>
<a name="l07022"></a>07022             <span class="comment">// Instead, simply check for success or failure:</span>
<a name="l07023"></a>07023             <span class="comment">//</span>
<a name="l07024"></a>07024             nReturnVal = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l07025"></a>07025 
<a name="l07026"></a>07026             <span class="keywordflow">if</span> (1 != nReturnVal)
<a name="l07027"></a>07027             {
<a name="l07028"></a>07028                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;sendvoucher: Failed.\n&quot;</span>);
<a name="l07029"></a>07029             }
<a name="l07030"></a>07030             <span class="keywordflow">else</span>
<a name="l07031"></a>07031             {
<a name="l07032"></a>07032                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success in sendvoucher! Server response:\n\n&quot;</span>);
<a name="l07033"></a>07033                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse);
<a name="l07034"></a>07034                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;(Success in sendvoucher)\n&quot;</span>);
<a name="l07035"></a>07035                 <span class="keywordflow">return</span> 1;
<a name="l07036"></a>07036             }
<a name="l07037"></a>07037         }
<a name="l07038"></a>07038 
<a name="l07039"></a>07039         <span class="keywordflow">return</span> nReturnVal;
<a name="l07040"></a>07040     }
<a name="l07041"></a>07041 
<a name="l07042"></a>07042     <span class="keywordflow">return</span> -1;
<a name="l07043"></a>07043 }
<a name="l07044"></a>07044 
<a name="l07045"></a>07045 
<a name="l07046"></a><a class="code" href="class_o_t___command.html#aafde379148b8f7c58df785e6e759d94e">07046</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <a class="code" href="class_o_t_d_b_1_1_market_list.html">OTDB::MarketList</a> * <a class="code" href="class_o_t___command.html#aafde379148b8f7c58df785e6e759d94e">OT_Command::loadMarketList</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID)
<a name="l07047"></a>07047 {
<a name="l07048"></a>07048     <span class="keywordflow">if</span> (!<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(<span class="stringliteral">&quot;markets&quot;</span>, serverID, <span class="stringliteral">&quot;market_data.bin&quot;</span>, <span class="stringliteral">&quot;&quot;</span>))
<a name="l07049"></a>07049     {
<a name="l07050"></a>07050         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The market list file doesn&#39;t exist.\n&quot;</span>);
<a name="l07051"></a>07051         <span class="keywordflow">return</span> NULL;
<a name="l07052"></a>07052     }
<a name="l07053"></a>07053 
<a name="l07054"></a>07054     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;Markets file exists...Querying list of markets...\n&quot;</span>);
<a name="l07055"></a>07055 
<a name="l07056"></a>07056     <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a> * storable = <a class="code" href="namespace_o_t_d_b.html#aaf0caee055f843a828e3bac094321886">OTDB::QueryObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82a7a0f581c82f5599271fcd57d0a020f99">OTDB::STORED_OBJ_MARKET_LIST</a>, <span class="stringliteral">&quot;markets&quot;</span>, serverID, <span class="stringliteral">&quot;market_data.bin&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l07057"></a>07057     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(storable, <span class="stringliteral">&quot;OTDB::Storable&quot;</span>))
<a name="l07058"></a>07058     {
<a name="l07059"></a>07059         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed to verify storable object. Probably doesn&#39;t exist.\n&quot;</span>);
<a name="l07060"></a>07060         <span class="keywordflow">return</span> NULL;
<a name="l07061"></a>07061     }
<a name="l07062"></a>07062 
<a name="l07063"></a>07063     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;QueryObject worked. Now dynamic casting from storable to marketlist...\n&quot;</span>);
<a name="l07064"></a>07064 
<a name="l07065"></a>07065     <a class="code" href="class_o_t_d_b_1_1_market_list.html">OTDB::MarketList</a> * marketList = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_d_b_1_1_market_list.html">OTDB::MarketList</a> *<span class="keyword">&gt;</span>(storable);
<a name="l07066"></a>07066     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(marketList, <span class="stringliteral">&quot;OTDB::MarketList&quot;</span>))
<a name="l07067"></a>07067     {
<a name="l07068"></a>07068         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to dynamic cast a storable to a marketlist.\n&quot;</span>);
<a name="l07069"></a>07069         <span class="keywordflow">return</span> NULL;
<a name="l07070"></a>07070     }
<a name="l07071"></a>07071 
<a name="l07072"></a>07072     <span class="keywordflow">return</span> marketList;  <span class="comment">// success.</span>
<a name="l07073"></a>07073 
<a name="l07074"></a>07074     <span class="comment">// This WAS a &quot;load or create&quot; sort of function, but I commented out the &quot;create&quot; part because</span>
<a name="l07075"></a>07075     <span class="comment">// you will literally NEVER need to create this list.</span>
<a name="l07076"></a>07076     <span class="comment">//</span>
<a name="l07077"></a>07077     <span class="comment">//    else</span>
<a name="l07078"></a>07078     <span class="comment">//    {</span>
<a name="l07079"></a>07079     <span class="comment">//        OTAPI_Wrap::Output(0, &quot;Didn&#39;t exist. Creating market list object...\n&quot;);</span>
<a name="l07080"></a>07080     <span class="comment">//        storable := OTDB::CreateObject(STORED_OBJ_MARKET_LIST)</span>
<a name="l07081"></a>07081     <span class="comment">//</span>
<a name="l07082"></a>07082     <span class="comment">//        if (!VerifyStorable(storable))</span>
<a name="l07083"></a>07083     <span class="comment">//        {</span>
<a name="l07084"></a>07084     <span class="comment">//            OTAPI_Wrap::Output(0, &quot;Failed trying to create market list object!\n&quot;);</span>
<a name="l07085"></a>07085     <span class="comment">//            return storable  // containing null or undef</span>
<a name="l07086"></a>07086     <span class="comment">//; }</span>
<a name="l07087"></a>07087     <span class="comment">//</span>
<a name="l07088"></a>07088     <span class="comment">//        OTAPI_Wrap::Output(0, &quot;CreateObject worked. Now dynamic casting from storable to marketlist...\n&quot;);</span>
<a name="l07089"></a>07089     <span class="comment">//        marketList := OTDB::CAST_MARKET_LIST(storable)</span>
<a name="l07090"></a>07090     <span class="comment">//</span>
<a name="l07091"></a>07091     <span class="comment">//        if (!VerifyStorable(marketList))</span>
<a name="l07092"></a>07092     <span class="comment">//        {</span>
<a name="l07093"></a>07093     <span class="comment">//            OTAPI_Wrap::Output(0, &quot;Failed to dynamic cast from storable to marketlist.\n&quot;);</span>
<a name="l07094"></a>07094     <span class="comment">//; }</span>
<a name="l07095"></a>07095     <span class="comment">//; }</span>
<a name="l07096"></a>07096 }
<a name="l07097"></a>07097 
<a name="l07098"></a>07098 
<a name="l07099"></a><a class="code" href="class_o_t___command.html#af678f1adebb61b9a760512eb2384e9b0">07099</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af678f1adebb61b9a760512eb2384e9b0">OT_Command::main_show_market_list</a>()
<a name="l07100"></a>07100 {
<a name="l07101"></a>07101     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l07102"></a>07102     {
<a name="l07103"></a>07103         <span class="keywordflow">if</span> (!<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(<span class="stringliteral">&quot;markets&quot;</span>, <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <span class="stringliteral">&quot;market_data.bin&quot;</span>, <span class="stringliteral">&quot;&quot;</span>))
<a name="l07104"></a>07104         {
<a name="l07105"></a>07105             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;No market list available.\n&quot;</span>);
<a name="l07106"></a>07106             <span class="keywordflow">return</span> 0;
<a name="l07107"></a>07107         }
<a name="l07108"></a>07108 
<a name="l07109"></a>07109         <a class="code" href="class_o_t_d_b_1_1_market_list.html">OTDB::MarketList</a> &amp; marketList = *<a class="code" href="class_o_t___command.html#aafde379148b8f7c58df785e6e759d94e">loadMarketList</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>);
<a name="l07110"></a>07110 
<a name="l07111"></a>07111         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;marketList, <span class="stringliteral">&quot;OTDB::MarketList&quot;</span>))
<a name="l07112"></a>07112         {
<a name="l07113"></a>07113             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to load up marketlist from local storage.\n&quot;</span>);
<a name="l07114"></a>07114             <span class="keywordflow">return</span> -1;
<a name="l07115"></a>07115         }
<a name="l07116"></a>07116 
<a name="l07117"></a>07117         <span class="comment">// LOOP THROUGH THE MARKETS AND PRINT THEM OUT.</span>
<a name="l07118"></a>07118 
<a name="l07119"></a>07119         int32_t nCount = marketList.GetMarketDataCount();
<a name="l07120"></a>07120         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l07121"></a>07121         {
<a name="l07122"></a>07122             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Loaded the market list, but GetMarketDataCount returns an invalid result. (Failure.)\n&quot;</span>);
<a name="l07123"></a>07123         }
<a name="l07124"></a>07124         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(nCount &gt; 0))
<a name="l07125"></a>07125         {
<a name="l07126"></a>07126             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Loaded the market list, but GetMarketDataCount says there aren&#39;t any markets in the list. (Returning.)\n&quot;</span>);
<a name="l07127"></a>07127         }
<a name="l07128"></a>07128         <span class="keywordflow">else</span>
<a name="l07129"></a>07129         {
<a name="l07130"></a>07130             <span class="comment">//          print(&quot;\nIndex\tScale\tMarket\tAsset\tCurrency&quot;)</span>
<a name="l07131"></a>07131             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nIndex\tScale\tMarket\t\t\t\t\t\tAsset\t\t\t\t\t\tCurrency\n&quot;</span>);
<a name="l07132"></a>07132 
<a name="l07133"></a>07133             <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l07134"></a>07134             {
<a name="l07135"></a>07135                 <a class="code" href="class_o_t_d_b_1_1_market_data.html">OTDB::MarketData</a> &amp; marketData = *marketList.GetMarketData(nIndex);
<a name="l07136"></a>07136                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;marketData, <span class="stringliteral">&quot;OTDB::MarketData&quot;</span>))
<a name="l07137"></a>07137                 {
<a name="l07138"></a>07138                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to reference marketData on marketList, at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l07139"></a>07139                     <span class="keywordflow">return</span> -1;
<a name="l07140"></a>07140                 }
<a name="l07141"></a>07141 
<a name="l07142"></a>07142                 <span class="comment">// OUTPUT THE MARKET DATA...</span>
<a name="l07143"></a>07143                 <span class="comment">//</span>
<a name="l07144"></a>07144                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\t&quot;</span> + marketData.<a class="code" href="class_o_t_d_b_1_1_market_data.html#a76e9d00702cfa1284813a1c45fc9d91b">scale</a> + <span class="stringliteral">&quot;\tM &quot;</span> + marketData.<a class="code" href="class_o_t_d_b_1_1_market_data.html#adbe791894d6afbfa49af07102e94b10c">market_id</a> + <span class="stringliteral">&quot;\tA &quot;</span> + marketData.<a class="code" href="class_o_t_d_b_1_1_market_data.html#ad94bc54282a6acefbd34088f8ee5afa6">asset_type_id</a> + <span class="stringliteral">&quot;\tC &quot;</span> + marketData.<a class="code" href="class_o_t_d_b_1_1_market_data.html#a1116aae82af6f197a038688704c2138f">currency_type_id</a>);
<a name="l07145"></a>07145             }
<a name="l07146"></a>07146         }
<a name="l07147"></a>07147 
<a name="l07148"></a>07148         <span class="keywordflow">return</span> 1;
<a name="l07149"></a>07149     }
<a name="l07150"></a>07150 
<a name="l07151"></a>07151     <span class="keywordflow">return</span> -1;
<a name="l07152"></a>07152 }
<a name="l07153"></a>07153 
<a name="l07154"></a>07154 
<a name="l07155"></a><a class="code" href="class_o_t___command.html#a1efee3070c20f55772e35b6541022b2e">07155</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a1efee3070c20f55772e35b6541022b2e">OT_Command::main_get_market_list</a>()
<a name="l07156"></a>07156 {
<a name="l07157"></a>07157     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n USAGE: getmarketlist --server SERVER_ID --mynym YOUR_NYM_ID\n\n&quot;</span>;
<a name="l07158"></a>07158 
<a name="l07159"></a>07159     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07160"></a>07160 
<a name="l07161"></a>07161 
<a name="l07162"></a>07162     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l07163"></a>07163     {
<a name="l07164"></a>07164 
<a name="l07165"></a>07165         <span class="comment">// Send the request.</span>
<a name="l07166"></a>07166         <span class="comment">//</span>
<a name="l07167"></a>07167         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a7284e1a867921939a71ec8e22f67b203">MadeEasy::get_market_list</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l07168"></a>07168         <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;get_market_list&quot;</span>;
<a name="l07169"></a>07169 
<a name="l07170"></a>07170         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07171"></a>07171         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07172"></a>07172         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l07173"></a>07173 
<a name="l07174"></a>07174         <span class="comment">// ***************************************************************</span>
<a name="l07175"></a>07175 
<a name="l07176"></a>07176         int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l07177"></a>07177 
<a name="l07178"></a>07178         <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l07179"></a>07179         {
<a name="l07180"></a>07180             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS getting market list.\n\n&quot;</span>);
<a name="l07181"></a>07181 
<a name="l07182"></a>07182             <a class="code" href="class_o_t___command.html#af678f1adebb61b9a760512eb2384e9b0">OT_Command::main_show_market_list</a>(); <span class="comment">// if it was successful, then we display the list on the screen.</span>
<a name="l07183"></a>07183         }
<a name="l07184"></a>07184 
<a name="l07185"></a>07185         <span class="keywordflow">return</span> nInterpretReply;
<a name="l07186"></a>07186     }
<a name="l07187"></a>07187 
<a name="l07188"></a>07188     <span class="keywordflow">return</span> -1;
<a name="l07189"></a>07189 }
<a name="l07190"></a>07190 
<a name="l07191"></a>07191 
<a name="l07192"></a><a class="code" href="class_o_t___command.html#a44264d0211b5402737b10ef7f71ef765">07192</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <a class="code" href="class_o_t_d_b_1_1_offer_list_market.html">OTDB::OfferListMarket</a> * <a class="code" href="class_o_t___command.html#a44264d0211b5402737b10ef7f71ef765">OT_Command::loadMarketOffers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; serverID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; marketID)
<a name="l07193"></a>07193 {
<a name="l07194"></a>07194     <a class="code" href="class_o_t_d_b_1_1_offer_list_market.html">OTDB::OfferListMarket</a> * offerList = NULL;
<a name="l07195"></a>07195     <a class="code" href="class_o_t_d_b_1_1_storable.html">OTDB::Storable</a> * storable = NULL;
<a name="l07196"></a>07196 
<a name="l07197"></a>07197     <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(<span class="stringliteral">&quot;markets&quot;</span>, serverID, <span class="stringliteral">&quot;offers&quot;</span>, marketID + <span class="stringliteral">&quot;.bin&quot;</span>))
<a name="l07198"></a>07198     {
<a name="l07199"></a>07199         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;Offers file exists... Querying file for market offers...\n&quot;</span>);
<a name="l07200"></a>07200         storable = <a class="code" href="namespace_o_t_d_b.html#aaf0caee055f843a828e3bac094321886">OTDB::QueryObject</a>(<a class="code" href="namespace_o_t_d_b.html#abce432e500285dde333e6f76f6fbde82a2b54a22ce17683d3970981ec94203ad1">OTDB::STORED_OBJ_OFFER_LIST_MARKET</a>, <span class="stringliteral">&quot;markets&quot;</span>, serverID, <span class="stringliteral">&quot;offers&quot;</span>, marketID + <span class="stringliteral">&quot;.bin&quot;</span>);
<a name="l07201"></a>07201 
<a name="l07202"></a>07202         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(storable, <span class="stringliteral">&quot;OTDB::Storable&quot;</span>))
<a name="l07203"></a>07203         {
<a name="l07204"></a>07204             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to verify storable object. Probably doesn&#39;t exist.\n&quot;</span>);
<a name="l07205"></a>07205             <span class="keywordflow">return</span> NULL; <span class="comment">// containing null or undef</span>
<a name="l07206"></a>07206         }
<a name="l07207"></a>07207 
<a name="l07208"></a>07208         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(1, <span class="stringliteral">&quot;QueryObject worked. Now dynamic casting from storable to a (market) offerList...\n&quot;</span>);
<a name="l07209"></a>07209         offerList = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_o_t_d_b_1_1_offer_list_market.html">OTDB::OfferListMarket</a> *<span class="keyword">&gt;</span>(storable);
<a name="l07210"></a>07210 
<a name="l07211"></a>07211         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(offerList, <span class="stringliteral">&quot;OTDB::OfferListMarket&quot;</span>))
<a name="l07212"></a>07212         {
<a name="l07213"></a>07213             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to dynamic cast a storable to a (market) offerList.\n&quot;</span>);
<a name="l07214"></a>07214             <span class="keywordflow">return</span> NULL; <span class="comment">// containing null or undef</span>
<a name="l07215"></a>07215         }
<a name="l07216"></a>07216     }
<a name="l07217"></a>07217 
<a name="l07218"></a>07218     <span class="keywordflow">return</span> offerList;  <span class="comment">// possibly containing the offerList (if success), or possibly containing a null/undef value (if failure.)</span>
<a name="l07219"></a>07219 }
<a name="l07220"></a>07220 
<a name="l07221"></a>07221 
<a name="l07222"></a><a class="code" href="class_o_t___command.html#a2dedafa873ff3a48f6bc2823dc1b2109">07222</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a2dedafa873ff3a48f6bc2823dc1b2109">OT_Command::details_show_market_offers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMarketID)
<a name="l07223"></a>07223 {
<a name="l07224"></a>07224     <a class="code" href="class_o_t_d_b_1_1_offer_list_market.html">OTDB::OfferListMarket</a> &amp; offerList = *<a class="code" href="class_o_t___command.html#a44264d0211b5402737b10ef7f71ef765">loadMarketOffers</a>(strServerID, strMarketID);
<a name="l07225"></a>07225 
<a name="l07226"></a>07226     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;offerList, <span class="stringliteral">&quot;OTDB::OfferListMarket&quot;</span>))
<a name="l07227"></a>07227     {
<a name="l07228"></a>07228         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to load up a (market) offerList from local storage.\n&quot;</span>);
<a name="l07229"></a>07229         <span class="keywordflow">return</span> -1;
<a name="l07230"></a>07230     }
<a name="l07231"></a>07231 
<a name="l07232"></a>07232     <span class="comment">// LOOP THROUGH THE BIDS AND PRINT THEM OUT.</span>
<a name="l07233"></a>07233     int32_t nBidCount = offerList.GetBidDataCount();  <span class="comment">// size_t</span>
<a name="l07234"></a>07234     int32_t nTemp = nBidCount; <span class="comment">// just so it&#39;s created as size_t</span>
<a name="l07235"></a>07235 
<a name="l07236"></a>07236     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nBidCount) &amp;&amp; (nBidCount &gt; 0))
<a name="l07237"></a>07237     {
<a name="l07238"></a>07238         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n** BIDS **\n\nIndex\tTrans#\tPrice\tAvailable\n&quot;</span>);
<a name="l07239"></a>07239 
<a name="l07240"></a>07240         <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nBidCount; ++nIndex)
<a name="l07241"></a>07241         {
<a name="l07242"></a>07242             <a class="code" href="class_o_t_d_b_1_1_bid_data.html">OTDB::BidData</a> &amp; offerData = *offerList.GetBidData(nIndex);
<a name="l07243"></a>07243             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;offerData, <span class="stringliteral">&quot;OTDB::BidData&quot;</span>))
<a name="l07244"></a>07244             {
<a name="l07245"></a>07245                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to reference bidData on offerList, at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l07246"></a>07246                 <span class="keywordflow">return</span> -1;
<a name="l07247"></a>07247             }
<a name="l07248"></a>07248 
<a name="l07249"></a>07249             <span class="comment">// OUTPUT THE BID OFFER DATA...</span>
<a name="l07250"></a>07250             <span class="comment">//</span>
<a name="l07251"></a>07251             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a9204334216c536dbb899f1f99c121f9b">transaction_id</a> + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a599d2dfd56c4232bbbb30d16987efb57">price_per_scale</a> + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a23ce62a0f8c04482ce8b9018bb9126aa">available_assets</a>);
<a name="l07252"></a>07252         }
<a name="l07253"></a>07253     }
<a name="l07254"></a>07254 
<a name="l07255"></a>07255     <span class="comment">// LOOP THROUGH THE ASKS AND PRINT THEM OUT.</span>
<a name="l07256"></a>07256     int32_t nAskCount = offerList.GetAskDataCount();
<a name="l07257"></a>07257 
<a name="l07258"></a>07258     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nAskCount) &amp;&amp; (nAskCount &gt; 0))
<a name="l07259"></a>07259     {
<a name="l07260"></a>07260         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n** ASKS **\n\nIndex\tTrans#\tPrice\tAvailable\n&quot;</span>);
<a name="l07261"></a>07261 
<a name="l07262"></a>07262         <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nAskCount; ++nIndex)
<a name="l07263"></a>07263         {
<a name="l07264"></a>07264             nTemp = nIndex;
<a name="l07265"></a>07265             <a class="code" href="class_o_t_d_b_1_1_ask_data.html">OTDB::AskData</a> &amp; offerData = *offerList.GetAskData(nTemp);
<a name="l07266"></a>07266 
<a name="l07267"></a>07267             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;offerData, <span class="stringliteral">&quot;OTDB::AskData&quot;</span>))
<a name="l07268"></a>07268             {
<a name="l07269"></a>07269                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to reference askData on offerList, at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l07270"></a>07270                 <span class="keywordflow">return</span> -1;
<a name="l07271"></a>07271             }
<a name="l07272"></a>07272 
<a name="l07273"></a>07273             <span class="comment">// OUTPUT THE ASK OFFER DATA...</span>
<a name="l07274"></a>07274             <span class="comment">//</span>
<a name="l07275"></a>07275             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a9204334216c536dbb899f1f99c121f9b">transaction_id</a> + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a599d2dfd56c4232bbbb30d16987efb57">price_per_scale</a> + <span class="stringliteral">&quot;\t&quot;</span> + offerData.<a class="code" href="class_o_t_d_b_1_1_offer_data_market.html#a23ce62a0f8c04482ce8b9018bb9126aa">available_assets</a>);
<a name="l07276"></a>07276         }
<a name="l07277"></a>07277     }
<a name="l07278"></a>07278 
<a name="l07279"></a>07279     <span class="keywordflow">return</span> 1;
<a name="l07280"></a>07280 }
<a name="l07281"></a>07281 
<a name="l07282"></a>07282 
<a name="l07283"></a><a class="code" href="class_o_t___command.html#abd2592574665fd0029e3225158410d21">07283</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#abd2592574665fd0029e3225158410d21">OT_Command::impl_show_market_offers</a>(<span class="keywordtype">string</span> &amp; strMarket)
<a name="l07284"></a>07284 {
<a name="l07285"></a>07285     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\n\n USAGE: showoffers --server SERVER_ID --mynym YOUR_NYM_ID\n&quot;</span>;
<a name="l07286"></a>07286     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Also: --args \&quot;market MARKET_ID\&quot;\n&quot;</span>);
<a name="l07287"></a>07287 
<a name="l07288"></a>07288     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07289"></a>07289 
<a name="l07290"></a>07290 
<a name="l07291"></a>07291     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l07292"></a>07292     {
<a name="l07293"></a>07293 
<a name="l07294"></a>07294         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l07295"></a>07295         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l07296"></a>07296         <span class="comment">// at the command line.</span>
<a name="l07297"></a>07297         <span class="comment">//</span>
<a name="l07298"></a>07298         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMarket) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l07299"></a>07299         {
<a name="l07300"></a>07300             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l07301"></a>07301             <span class="comment">//                                  const std::string str_key)</span>
<a name="l07302"></a>07302             <span class="comment">//</span>
<a name="l07303"></a>07303             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l07304"></a>07304             <span class="comment">// EXAMPLE:  --args &quot;market MARKET_ID&quot;</span>
<a name="l07305"></a>07305             <span class="comment">//</span>
<a name="l07306"></a>07306             <span class="keywordtype">string</span> strNewMarket = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;market&quot;</span>); <span class="comment">// the market ID</span>
<a name="l07307"></a>07307 
<a name="l07308"></a>07308             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l07309"></a>07309             <span class="comment">//</span>
<a name="l07310"></a>07310             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMarket))
<a name="l07311"></a>07311             {
<a name="l07312"></a>07312                 strMarket = strNewMarket;
<a name="l07313"></a>07313             }
<a name="l07314"></a>07314         }
<a name="l07315"></a>07315 
<a name="l07316"></a>07316         <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l07317"></a>07317         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l07318"></a>07318         <span class="comment">//</span>
<a name="l07319"></a>07319         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMarket))
<a name="l07320"></a>07320         {
<a name="l07321"></a>07321             <a class="code" href="class_o_t___command.html#af678f1adebb61b9a760512eb2384e9b0">OT_Command::main_show_market_list</a>();
<a name="l07322"></a>07322 
<a name="l07323"></a>07323             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nEnter the market ID: &quot;</span>);
<a name="l07324"></a>07324             strMarket = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07325"></a>07325         }
<a name="l07326"></a>07326 
<a name="l07327"></a>07327         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMarket))
<a name="l07328"></a>07328         {
<a name="l07329"></a>07329             <span class="keywordflow">return</span> -1;
<a name="l07330"></a>07330         }
<a name="l07331"></a>07331 
<a name="l07332"></a>07332 
<a name="l07333"></a>07333         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a2dedafa873ff3a48f6bc2823dc1b2109">details_show_market_offers</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMarket);
<a name="l07334"></a>07334     }
<a name="l07335"></a>07335 
<a name="l07336"></a>07336     <span class="keywordflow">return</span> -1;
<a name="l07337"></a>07337 }
<a name="l07338"></a>07338 
<a name="l07339"></a>07339 
<a name="l07340"></a><a class="code" href="class_o_t___command.html#aa8329d1d4b9647c30168915474e6f178">07340</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa8329d1d4b9647c30168915474e6f178">OT_Command::main_show_market_offers</a>()
<a name="l07341"></a>07341 {
<a name="l07342"></a>07342     <span class="keywordtype">string</span> strMarket;
<a name="l07343"></a>07343 
<a name="l07344"></a>07344     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#abd2592574665fd0029e3225158410d21">impl_show_market_offers</a>(strMarket);
<a name="l07345"></a>07345 }
<a name="l07346"></a>07346 
<a name="l07347"></a>07347 
<a name="l07348"></a><a class="code" href="class_o_t___command.html#a2b2fe505c2d4df3444ce2370d768107c">07348</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a2b2fe505c2d4df3444ce2370d768107c">OT_Command::main_get_market_offers</a>()
<a name="l07349"></a>07349 {
<a name="l07350"></a>07350     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\n\n USAGE: getoffers --server SERVER_ID --mynym YOUR_NYM_ID\n&quot;</span>;
<a name="l07351"></a>07351     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Also: --args \&quot;market MARKET_ID depth MAX_DEPTH\&quot;\n&quot;</span>);
<a name="l07352"></a>07352 
<a name="l07353"></a>07353     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07354"></a>07354 
<a name="l07355"></a>07355 
<a name="l07356"></a>07356     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l07357"></a>07357     {
<a name="l07358"></a>07358         <span class="keywordtype">string</span> strMarket = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// must ultimately be an ID.</span>
<a name="l07359"></a>07359         <span class="keywordtype">string</span> strDepth = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// can be blank</span>
<a name="l07360"></a>07360 
<a name="l07361"></a>07361         <span class="keywordtype">string</span> strDefaultDepth = <span class="stringliteral">&quot;50&quot;</span>; <span class="comment">// can be blank</span>
<a name="l07362"></a>07362 
<a name="l07363"></a>07363         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l07364"></a>07364         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l07365"></a>07365         <span class="comment">// at the command line.</span>
<a name="l07366"></a>07366         <span class="comment">//</span>
<a name="l07367"></a>07367         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l07368"></a>07368         {
<a name="l07369"></a>07369             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l07370"></a>07370             <span class="comment">//                                  const std::string str_key)</span>
<a name="l07371"></a>07371             <span class="comment">//</span>
<a name="l07372"></a>07372             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l07373"></a>07373             <span class="comment">// EXAMPLE:  --args &quot;market MARKET_ID depth 50&quot;</span>
<a name="l07374"></a>07374             <span class="comment">//</span>
<a name="l07375"></a>07375             <span class="keywordtype">string</span> strNewMarket = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;market&quot;</span>); <span class="comment">// the market ID</span>
<a name="l07376"></a>07376             <span class="keywordtype">string</span> strNewDepth = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;depth&quot;</span>);    <span class="comment">// how many offers should we retrieve?</span>
<a name="l07377"></a>07377 
<a name="l07378"></a>07378 
<a name="l07379"></a>07379             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l07380"></a>07380             <span class="comment">//</span>
<a name="l07381"></a>07381             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewMarket))
<a name="l07382"></a>07382             {
<a name="l07383"></a>07383                 strMarket = strNewMarket;
<a name="l07384"></a>07384             }
<a name="l07385"></a>07385             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewDepth))
<a name="l07386"></a>07386             {
<a name="l07387"></a>07387                 strDepth = strNewDepth;
<a name="l07388"></a>07388             }
<a name="l07389"></a>07389         }
<a name="l07390"></a>07390 
<a name="l07391"></a>07391         <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l07392"></a>07392         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l07393"></a>07393         <span class="comment">//</span>
<a name="l07394"></a>07394         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMarket))
<a name="l07395"></a>07395         {
<a name="l07396"></a>07396             <a class="code" href="class_o_t___command.html#af678f1adebb61b9a760512eb2384e9b0">OT_Command::main_show_market_list</a>();
<a name="l07397"></a>07397 
<a name="l07398"></a>07398             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nEnter the market ID: &quot;</span>);
<a name="l07399"></a>07399             strMarket = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07400"></a>07400         }
<a name="l07401"></a>07401         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strDepth))
<a name="l07402"></a>07402         {
<a name="l07403"></a>07403             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a max depth on a single line[&quot;</span> + strDepth + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l07404"></a>07404             strDepth = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07405"></a>07405         }
<a name="l07406"></a>07406 
<a name="l07407"></a>07407         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMarket))
<a name="l07408"></a>07408         {
<a name="l07409"></a>07409             <span class="keywordflow">return</span> -1;
<a name="l07410"></a>07410         }
<a name="l07411"></a>07411         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strDepth))
<a name="l07412"></a>07412         {
<a name="l07413"></a>07413             strDepth = strDefaultDepth;
<a name="l07414"></a>07414         }
<a name="l07415"></a>07415 
<a name="l07416"></a>07416         <span class="comment">// Send the request.</span>
<a name="l07417"></a>07417         <span class="comment">//</span>
<a name="l07418"></a>07418         int64_t lDepth = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strDepth);
<a name="l07419"></a>07419         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a1774517c42ee33951cace002698e59e0">MadeEasy::get_market_offers</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strMarket, lDepth);
<a name="l07420"></a>07420         <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;get_market_offers&quot;</span>;
<a name="l07421"></a>07421 
<a name="l07422"></a>07422         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07423"></a>07423         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07424"></a>07424         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l07425"></a>07425 
<a name="l07426"></a>07426         <span class="comment">// ***************************************************************</span>
<a name="l07427"></a>07427 
<a name="l07428"></a>07428         int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l07429"></a>07429 
<a name="l07430"></a>07430         <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l07431"></a>07431         {
<a name="l07432"></a>07432             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS getting market offers.\n\n&quot;</span>);
<a name="l07433"></a>07433 
<a name="l07434"></a>07434             <a class="code" href="class_o_t___command.html#abd2592574665fd0029e3225158410d21">impl_show_market_offers</a>(strMarket); <span class="comment">// if it was successful, then we display the list on the screen.</span>
<a name="l07435"></a>07435         }
<a name="l07436"></a>07436 
<a name="l07437"></a>07437         <span class="keywordflow">return</span> nInterpretReply;
<a name="l07438"></a>07438     }
<a name="l07439"></a>07439 
<a name="l07440"></a>07440     <span class="keywordflow">return</span> -1;
<a name="l07441"></a>07441 }
<a name="l07442"></a>07442 
<a name="l07443"></a>07443 
<a name="l07444"></a><a class="code" href="class_o_t___command.html#a793a5e5f1d8e13cd8180976a3e9b47b9">07444</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a793a5e5f1d8e13cd8180976a3e9b47b9">OT_Command::main_adjust_usage_credits</a>()
<a name="l07445"></a>07445 {
<a name="l07446"></a>07446     <span class="keywordtype">string</span> strUsage1 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n  Options: --server SERVER_ID --mynym NYM_ID\n&quot;</span>,
<a name="l07447"></a>07447         <span class="stringliteral">&quot;           --hisnym SUBJECT_NYM_ID\n\n&quot;</span>);
<a name="l07448"></a>07448 
<a name="l07449"></a>07449     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;To adjust (change) a Nym&#39;s usage credits: --args \&quot;adjust POSITIVE_OR_NEGATIVE_VALUE\&quot; \n (Used for giving or taking away usage credits.)\n&quot;</span>,
<a name="l07450"></a>07450         <span class="stringliteral">&quot;For example, --args \&quot;adjust 10000\&quot;   or:  --args \&quot;adjust -100\&quot; \n\nFYI, this command also retrieves the current usage credits,\nand any Nym can use it on himself, read-only.\n\n&quot;</span>);
<a name="l07451"></a>07451 
<a name="l07452"></a>07452     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07453"></a>07453 
<a name="l07454"></a>07454     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>))
<a name="l07455"></a>07455     {
<a name="l07456"></a>07456         <span class="keywordtype">string</span> strAdjustment = <span class="stringliteral">&quot;0&quot;</span>;
<a name="l07457"></a>07457 
<a name="l07458"></a>07458         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l07459"></a>07459         {
<a name="l07460"></a>07460             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l07461"></a>07461             <span class="comment">//                                  const std::string str_key)</span>
<a name="l07462"></a>07462             <span class="comment">//</span>
<a name="l07463"></a>07463             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l07464"></a>07464             <span class="comment">// EXAMPLE:  --args &quot;adjust 1&quot;</span>
<a name="l07465"></a>07465             <span class="comment">//</span>
<a name="l07466"></a>07466             <span class="keywordtype">string</span> strNewAdjust = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;adjust&quot;</span>); <span class="comment">// any positive or negative integer value, or zero.</span>
<a name="l07467"></a>07467 
<a name="l07468"></a>07468 
<a name="l07469"></a>07469             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l07470"></a>07470             <span class="comment">//</span>
<a name="l07471"></a>07471             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAdjust))
<a name="l07472"></a>07472             {
<a name="l07473"></a>07473                 strAdjustment = strNewAdjust;
<a name="l07474"></a>07474             }
<a name="l07475"></a>07475         }
<a name="l07476"></a>07476 
<a name="l07477"></a>07477         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#aa98334efd4d5ed9e76d99c894c0f51a2">MadeEasy::adjust_usage_credits</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>, strAdjustment);
<a name="l07478"></a>07478         int32_t nStatus = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l07479"></a>07479 
<a name="l07480"></a>07480         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07481"></a>07481         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07482"></a>07482         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l07483"></a>07483         <span class="comment">//</span>
<a name="l07484"></a>07484         <span class="comment">// -1 is error,</span>
<a name="l07485"></a>07485         <span class="comment">//  0 is reply received: failure</span>
<a name="l07486"></a>07486         <span class="comment">//  1 is reply received: success</span>
<a name="l07487"></a>07487         <span class="comment">//</span>
<a name="l07488"></a>07488         <span class="keywordflow">switch</span> (nStatus)
<a name="l07489"></a>07489         {
<a name="l07490"></a>07490         <span class="keywordflow">case</span> 1:
<a name="l07491"></a>07491         {
<a name="l07492"></a>07492                   <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Server response:\n\n&quot;</span>);
<a name="l07493"></a>07493                   <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l07494"></a>07494 
<a name="l07495"></a>07495                   <span class="comment">// IF THE_MESSAGE is of command type @usageCredits, and IF it was a SUCCESS,</span>
<a name="l07496"></a>07496                   <span class="comment">// then this function returns the usage credits BALANCE (it&#39;s a int64_t int32_t, but</span>
<a name="l07497"></a>07497                   <span class="comment">// passed as a string). If you adjusted the balance using the usageCredits</span>
<a name="l07498"></a>07498                   <span class="comment">// command (THE_MESSAGE being the server&#39;s reply to that) then you will see</span>
<a name="l07499"></a>07499                   <span class="comment">// the balance AFTER the adjustment. (The current &quot;Usage Credits&quot; balance.)</span>
<a name="l07500"></a>07500                   <span class="comment">//</span>
<a name="l07501"></a>07501                   int64_t lNewUsageBalance = <a class="code" href="class_o_t_a_p_i___wrap.html#a26e966d9b528001268d1b3b72efdc4dd">OTAPI_Wrap::Message_GetUsageCredits</a>(strResponse);
<a name="l07502"></a>07502                   <span class="keywordtype">string</span> strNewUsageBalance = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lNewUsageBalance) ? <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lNewUsageBalance) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l07503"></a>07503 
<a name="l07504"></a>07504                   <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewUsageBalance))
<a name="l07505"></a>07505                   {
<a name="l07506"></a>07506                       strNewUsageBalance = <span class="stringliteral">&quot;(Error while calling API to retrieve usage credits from server reply.)&quot;</span>;
<a name="l07507"></a>07507                   }
<a name="l07508"></a>07508                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (int64_t(-2) == lNewUsageBalance)
<a name="l07509"></a>07509                   {
<a name="l07510"></a>07510                       strNewUsageBalance = <span class="stringliteral">&quot;Error code -2, while attempting to retrieve usage credits from this server reply.&quot;</span>;
<a name="l07511"></a>07511                   }
<a name="l07512"></a>07512                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (int64_t(-1) == lNewUsageBalance)
<a name="l07513"></a>07513                   {
<a name="l07514"></a>07514                       strNewUsageBalance = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Either Nym has unlimited usage credits, or server has its usage credit enforcement turned off.\n&quot;</span>,
<a name="l07515"></a>07515                           <span class="stringliteral">&quot;(Either way, Nym is good to go, since -1 was returned as his &#39;credits balance&#39;.)&quot;</span>);
<a name="l07516"></a>07516                   }
<a name="l07517"></a>07517                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (int64_t(0) == lNewUsageBalance)
<a name="l07518"></a>07518                   {
<a name="l07519"></a>07519                       strNewUsageBalance = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Nym appears to have exhausted his supply of usage credits.\n&quot;</span>,
<a name="l07520"></a>07520                           <span class="stringliteral">&quot;(0 was returned as his &#39;credits balance&#39;.)&quot;</span>);
<a name="l07521"></a>07521                   }
<a name="l07522"></a>07522                   <span class="keywordflow">else</span>
<a name="l07523"></a>07523                   {
<a name="l07524"></a>07524                       strNewUsageBalance = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;Nym currently has &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lNewUsageBalance), <span class="stringliteral">&quot; usage credits.&quot;</span>);
<a name="l07525"></a>07525                   }
<a name="l07526"></a>07526 
<a name="l07527"></a>07527                   <span class="keywordtype">string</span> strOutput = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n adjust_usage_credits -- reply: &quot;</span> + strNewUsageBalance,
<a name="l07528"></a>07528                       <span class="stringliteral">&quot;\n\n(FYI, this server message is the only and proper way to query for your own current usage credits balance, or also to set someone else&#39;s.)\n\n&quot;</span>);
<a name="l07529"></a>07529                   <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strOutput);
<a name="l07530"></a>07530 
<a name="l07531"></a>07531                   <span class="keywordflow">break</span>;
<a name="l07532"></a>07532         }
<a name="l07533"></a>07533         <span class="keywordflow">case</span> 0:
<a name="l07534"></a>07534             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nServer response:\n\n&quot;</span>);
<a name="l07535"></a>07535             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l07536"></a>07536             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILURE in adjust_usage_credits!\n\n&quot;</span>);
<a name="l07537"></a>07537             <span class="keywordflow">break</span>;
<a name="l07538"></a>07538         <span class="keywordflow">default</span>:
<a name="l07539"></a>07539             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l07540"></a>07540             {
<a name="l07541"></a>07541                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response:\n\n&quot;</span>);
<a name="l07542"></a>07542                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l07543"></a>07543             }
<a name="l07544"></a>07544             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nError in adjust_usage_credits! nStatus is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nStatus) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l07545"></a>07545             <span class="keywordflow">break</span>;
<a name="l07546"></a>07546         }
<a name="l07547"></a>07547 
<a name="l07548"></a>07548         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l07549"></a>07549 
<a name="l07550"></a>07550         <span class="keywordflow">return</span> (0 == nStatus) ? -1 : nStatus;
<a name="l07551"></a>07551     }
<a name="l07552"></a>07552 
<a name="l07553"></a>07553     <span class="keywordflow">return</span> -1;
<a name="l07554"></a>07554 }
<a name="l07555"></a>07555 
<a name="l07556"></a>07556 
<a name="l07557"></a>07557 <span class="comment">/*</span>
<a name="l07558"></a>07558 <span class="comment">//      pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::gui_label),          &quot;gui_label&quot;);</span>
<a name="l07559"></a>07559 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::valid_from),         &quot;valid_from&quot;);</span>
<a name="l07560"></a>07560 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::valid_to),           &quot;valid_to&quot;);</span>
<a name="l07561"></a>07561 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::server_id),          &quot;server_id&quot;);</span>
<a name="l07562"></a>07562 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::asset_type_id),      &quot;asset_type_id&quot;);</span>
<a name="l07563"></a>07563 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::asset_acct_id),      &quot;asset_acct_id&quot;);</span>
<a name="l07564"></a>07564 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::currency_type_id),   &quot;currency_type_id&quot;);</span>
<a name="l07565"></a>07565 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::currency_acct_id),   &quot;currency_acct_id&quot;);</span>
<a name="l07566"></a>07566 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::selling),            &quot;selling&quot;);</span>
<a name="l07567"></a>07567 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::scale),              &quot;scale&quot;);</span>
<a name="l07568"></a>07568 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::price_per_scale),    &quot;price_per_scale&quot;);</span>
<a name="l07569"></a>07569 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::transaction_id),     &quot;transaction_id&quot;);</span>
<a name="l07570"></a>07570 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::total_assets),       &quot;total_assets&quot;);</span>
<a name="l07571"></a>07571 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::finished_so_far),    &quot;finished_so_far&quot;);</span>
<a name="l07572"></a>07572 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::minimum_increment),  &quot;minimum_increment&quot;);</span>
<a name="l07573"></a>07573 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::stop_sign),          &quot;stop_sign&quot;);</span>
<a name="l07574"></a>07574 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTDB::OfferDataNym::stop_price),         &quot;stop_price&quot;);</span>
<a name="l07575"></a>07575 <span class="comment"></span>
<a name="l07576"></a>07576 <span class="comment">OT_CHAI_CONTAINER(OfferListNym, OfferDataNym);</span>
<a name="l07577"></a>07577 <span class="comment">*/</span>
<a name="l07578"></a>07578 
<a name="l07579"></a>07579 
<a name="l07580"></a><a class="code" href="class_o_t___command.html#a57f3d8ba47351a59708f2f51c8fd757d">07580</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a57f3d8ba47351a59708f2f51c8fd757d">OT_Command::details_show_nym_offers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymID)
<a name="l07581"></a>07581 {
<a name="l07582"></a>07582     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;details_show_nym_offers&quot;</span>;
<a name="l07583"></a>07583 
<a name="l07584"></a>07584     <a class="code" href="class_o_t_d_b_1_1_offer_list_nym.html">OTDB::OfferListNym</a> &amp; offerList = *<a class="code" href="ot__otapi__ot_8hpp.html#aa3d79addb47bbba18eb44c575b04421d">loadNymOffers</a>(strServerID, strNymID);
<a name="l07585"></a>07585 
<a name="l07586"></a>07586     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a56da374b90a36709e823a1b047604770">VerifyStorable</a>(&amp;offerList, <span class="stringliteral">&quot;OTDB::OfferListNym&quot;</span>))
<a name="l07587"></a>07587     {
<a name="l07588"></a>07588         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load up a (nym) offerList from local storage. Probably doesn&#39;t exist.\n&quot;</span>);
<a name="l07589"></a>07589         <span class="keywordflow">return</span> -1;
<a name="l07590"></a>07590     }
<a name="l07591"></a>07591 
<a name="l07592"></a>07592     <span class="comment">// LOOP THROUGH THE OFFERS and sort them into a map_of_maps, key is: scale-assetID-currencyID</span>
<a name="l07593"></a>07593     <span class="comment">// the value for each key is a sub-map, with the key: transaction ID and value: the offer data itself.</span>
<a name="l07594"></a>07594     <span class="comment">//</span>
<a name="l07595"></a>07595     int32_t nCount = offerList.GetOfferDataNymCount(); <span class="comment">// size_t</span>
<a name="l07596"></a>07596     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) &amp;&amp; (nCount &gt; 0))
<a name="l07597"></a>07597     {
<a name="l07598"></a>07598         <a class="code" href="ot__otapi__ot_8hpp.html#a5982d50c950b8a93cea04d380c3e23e3">MapOfMaps</a> &amp; map_of_maps = *<a class="code" href="ot__otapi__ot_8hpp.html#a9eb26e90faa56436cb65a5ad493eb275">convert_offerlist_to_maps</a>(offerList);
<a name="l07599"></a>07599 
<a name="l07600"></a>07600         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a210a7c90f7abda3fbe2cfb5dcf48ac61">VerifyType</a>(&amp;map_of_maps, <span class="stringliteral">&quot;Map&quot;</span>))
<a name="l07601"></a>07601         {
<a name="l07602"></a>07602             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to convert offer list to map of offers. Perhaps it&#39;s empty?\n&quot;</span>);
<a name="l07603"></a>07603             <span class="keywordflow">return</span> -1;
<a name="l07604"></a>07604         }
<a name="l07605"></a>07605 
<a name="l07606"></a>07606         <span class="comment">// output_nymoffer_data is called for each offer, for this nym,</span>
<a name="l07607"></a>07607         <span class="comment">// as it iterates through the maps.</span>
<a name="l07608"></a>07608         <span class="comment">//</span>
<a name="l07609"></a>07609         <span class="comment">// iterate_nymoffers_maps takes a final parameter extra_vals (not seen here)</span>
<a name="l07610"></a>07610         <span class="comment">// Other sections in the code which use iterate_nymoffers_maps might pass a value</span>
<a name="l07611"></a>07611         <span class="comment">// here, or expect one to be returned through the same mechansim.</span>
<a name="l07612"></a>07612         <span class="comment">//</span>
<a name="l07613"></a>07613         int32_t nIterated = <a class="code" href="ot__otapi__ot_8hpp.html#afda7d1f665c2df05a675b8d491c3d9ef">iterate_nymoffers_maps</a>(map_of_maps, <a class="code" href="ot__otapi__ot_8hpp.html#a7b6d17a4adc63c8b3ecb62438fdbdddf">output_nymoffer_data</a>); <span class="comment">// low level. map_of_maps must be good. (assumed.)</span>
<a name="l07614"></a>07614 
<a name="l07615"></a>07615         <span class="keywordflow">if</span> (-1 == nIterated)
<a name="l07616"></a>07616         {
<a name="l07617"></a>07617             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error trying to iterate nym&#39;s offers.\n&quot;</span>);
<a name="l07618"></a>07618             <span class="keywordflow">return</span> -1;
<a name="l07619"></a>07619         }
<a name="l07620"></a>07620     }
<a name="l07621"></a>07621 
<a name="l07622"></a>07622     <span class="keywordflow">return</span> 1;
<a name="l07623"></a>07623 }
<a name="l07624"></a>07624 
<a name="l07625"></a>07625 
<a name="l07626"></a><a class="code" href="class_o_t___command.html#ac00a2a5040dab600febc94475b4afb89">07626</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac00a2a5040dab600febc94475b4afb89">OT_Command::main_show_nym_offers</a>()
<a name="l07627"></a>07627 {
<a name="l07628"></a>07628     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n USAGE: showmyoffers --server SERVER_ID --mynym YOUR_NYM_ID\n\n&quot;</span>;
<a name="l07629"></a>07629 
<a name="l07630"></a>07630     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07631"></a>07631 
<a name="l07632"></a>07632 
<a name="l07633"></a>07633     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l07634"></a>07634     {
<a name="l07635"></a>07635         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a57f3d8ba47351a59708f2f51c8fd757d">details_show_nym_offers</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l07636"></a>07636     }
<a name="l07637"></a>07637 
<a name="l07638"></a>07638     <span class="keywordflow">return</span> -1;
<a name="l07639"></a>07639 }
<a name="l07640"></a>07640 
<a name="l07641"></a>07641 
<a name="l07642"></a><a class="code" href="class_o_t___command.html#afc0ed9044e576cde886cad1f52cffb4f">07642</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#afc0ed9044e576cde886cad1f52cffb4f">OT_Command::details_get_nym_market_offers</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strNymID)
<a name="l07643"></a>07643 {
<a name="l07644"></a>07644     <span class="keywordtype">string</span> strResponse;
<a name="l07645"></a>07645 
<a name="l07646"></a>07646     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNymID))
<a name="l07647"></a>07647     {
<a name="l07648"></a>07648         <span class="comment">// Send the request.</span>
<a name="l07649"></a>07649         <span class="comment">//</span>
<a name="l07650"></a>07650         strResponse = <a class="code" href="class_made_easy.html#a043b3208fb158d53ee2ea4382ac3c130">MadeEasy::get_nym_market_offers</a>(strServerID, strNymID);
<a name="l07651"></a>07651 
<a name="l07652"></a>07652         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07653"></a>07653         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07654"></a>07654         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l07655"></a>07655     }
<a name="l07656"></a>07656 
<a name="l07657"></a>07657     <span class="keywordflow">return</span> strResponse;
<a name="l07658"></a>07658 }
<a name="l07659"></a>07659 
<a name="l07660"></a>07660 
<a name="l07661"></a><a class="code" href="class_o_t___command.html#aa6231df55bd08a7d118e8ddc3545da0b">07661</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aa6231df55bd08a7d118e8ddc3545da0b">OT_Command::main_get_nym_market_offers</a>()
<a name="l07662"></a>07662 {
<a name="l07663"></a>07663 
<a name="l07664"></a>07664     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n USAGE: getmyoffers --server SERVER_ID --mynym YOUR_NYM_ID\n&quot;</span>;
<a name="l07665"></a>07665 
<a name="l07666"></a>07666     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07667"></a>07667 
<a name="l07668"></a>07668     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l07669"></a>07669     {
<a name="l07670"></a>07670 
<a name="l07671"></a>07671         <span class="comment">// Send the request.</span>
<a name="l07672"></a>07672         <span class="comment">//</span>
<a name="l07673"></a>07673         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_o_t___command.html#afc0ed9044e576cde886cad1f52cffb4f">details_get_nym_market_offers</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l07674"></a>07674         <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;get_nym_market_offers&quot;</span>;
<a name="l07675"></a>07675 
<a name="l07676"></a>07676         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l07677"></a>07677         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l07678"></a>07678         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l07679"></a>07679 
<a name="l07680"></a>07680         <span class="comment">// ***************************************************************</span>
<a name="l07681"></a>07681 
<a name="l07682"></a>07682         int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l07683"></a>07683 
<a name="l07684"></a>07684         <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l07685"></a>07685         {
<a name="l07686"></a>07686             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS getting nym&#39;s market offers.\n\n&quot;</span>);
<a name="l07687"></a>07687 
<a name="l07688"></a>07688             <a class="code" href="class_o_t___command.html#ac00a2a5040dab600febc94475b4afb89">OT_Command::main_show_nym_offers</a>(); <span class="comment">// if it was successful, then we display the list on the screen.</span>
<a name="l07689"></a>07689         }
<a name="l07690"></a>07690 
<a name="l07691"></a>07691         <span class="keywordflow">return</span> nInterpretReply;
<a name="l07692"></a>07692     }
<a name="l07693"></a>07693 
<a name="l07694"></a>07694     <span class="keywordflow">return</span> -1;
<a name="l07695"></a>07695 }
<a name="l07696"></a>07696 
<a name="l07697"></a>07697 
<a name="l07698"></a>07698 <span class="comment">//</span>
<a name="l07699"></a>07699 <span class="comment">// PAY DIVIDEND</span>
<a name="l07700"></a>07700 <span class="comment">//</span>
<a name="l07701"></a>07701 <span class="comment">// Just like withdraw voucher...except instead of withdrawing a single voucher to yourself,</span>
<a name="l07702"></a>07702 <span class="comment">// it removes the total dividend payout from your account, and then divides it up amongst the</span>
<a name="l07703"></a>07703 <span class="comment">// shareholders, sending them EACH a voucher cheque in the amount of strAmount * number of shares owned.</span>
<a name="l07704"></a>07704 <span class="comment">//</span>
<a name="l07705"></a><a class="code" href="class_o_t___command.html#a89c1f6b1103d020b29f524d26c62aa1b">07705</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a89c1f6b1103d020b29f524d26c62aa1b">OT_Command::details_pay_dividend</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAmount, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMemo)
<a name="l07706"></a>07706 {
<a name="l07707"></a>07707     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l07708"></a>07708     <span class="comment">//</span>
<a name="l07709"></a>07709     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l07710"></a>07710 
<a name="l07711"></a>07711     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l07712"></a>07712     {
<a name="l07713"></a>07713         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find Payer NymID based on myacct. Use: --myacct DIVIDEND_SOURCE_ACCT_ID\n&quot;</span>);
<a name="l07714"></a>07714         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account (that the dividends will be paid out of) must be yours. OT will find the Nym based on that account.\n\n&quot;</span>);
<a name="l07715"></a>07715         <span class="keywordflow">return</span> -1;
<a name="l07716"></a>07716     }
<a name="l07717"></a>07717 
<a name="l07718"></a>07718 
<a name="l07719"></a>07719     <span class="keywordtype">string</span> strHisPurse;
<a name="l07720"></a>07720 
<a name="l07721"></a>07721     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisPurse&quot;</span>)) <span class="comment">// This ID is already validated in the C++ code (in this case.)</span>
<a name="l07722"></a>07722     {
<a name="l07723"></a>07723         strHisPurse = <a class="code" href="ot__otapi__ot_8hpp.html#a16aa081bd04ce3d95de8334cab2b955b">HisPurse</a>;
<a name="l07724"></a>07724     }
<a name="l07725"></a>07725     <span class="keywordflow">else</span>
<a name="l07726"></a>07726     {
<a name="l07727"></a>07727         <span class="keywordflow">while</span> (<span class="keyword">true</span>)
<a name="l07728"></a>07728         {
<a name="l07729"></a>07729             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the SHARES asset type ID (Nym must also be the issuer for these shares): &quot;</span>);
<a name="l07730"></a>07730             <span class="keywordtype">string</span> strHisPartialPurseID = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07731"></a>07731 
<a name="l07732"></a>07732             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisPartialPurseID)) <span class="comment">// If the user typed something...</span>
<a name="l07733"></a>07733             {
<a name="l07734"></a>07734                 strHisPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#a5804c9fafc280e4ececc7c8889078afe">OTAPI_Wrap::Wallet_GetAssetIDFromPartial</a>(strHisPartialPurseID); <span class="comment">// Try to find the associated ID...</span>
<a name="l07735"></a>07735 
<a name="l07736"></a>07736                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisPurse)) <span class="comment">// But if it returned NULL, failure (return.)</span>
<a name="l07737"></a>07737                 {
<a name="l07738"></a>07738                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find SHARES_ASSET_TYPE_ID in your wallet. Use: --hispurse SHARES_ASSET_TYPE_ID\n&quot;</span>);
<a name="l07739"></a>07739                     <span class="keywordflow">return</span> -1;
<a name="l07740"></a>07740                 }
<a name="l07741"></a>07741                 <span class="keywordflow">break</span>;
<a name="l07742"></a>07742             }
<a name="l07743"></a>07743         }
<a name="l07744"></a>07744     }
<a name="l07745"></a>07745 
<a name="l07746"></a>07746     <span class="comment">// ***************************************************************</span>
<a name="l07747"></a>07747 
<a name="l07748"></a>07748     <span class="comment">// HERE, WE SEND THE PAY DIVIDEND REQUEST TO THE SERVER</span>
<a name="l07749"></a>07749     <span class="comment">//</span>
<a name="l07750"></a>07750 
<a name="l07751"></a>07751     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l07752"></a>07752 
<a name="l07753"></a>07753     int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount);
<a name="l07754"></a>07754     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a60520eac696de86b1211646bd33cc19c">MadeEasy::pay_dividend</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strHisPurse, strMemo, lAmount);
<a name="l07755"></a>07755     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;pay_dividend&quot;</span>;
<a name="l07756"></a>07756 
<a name="l07757"></a>07757     <span class="comment">//static int32_t payDividend(const std::string SERVER_ID,</span>
<a name="l07758"></a>07758     <span class="comment">//                       const std::string ISSUER_USER_ID,</span>
<a name="l07759"></a>07759     <span class="comment">//                       const std::string DIVIDEND_FROM_ACCT_ID,</span>
<a name="l07760"></a>07760     <span class="comment">//                       const std::string SHARES_ASSET_TYPE_ID,</span>
<a name="l07761"></a>07761     <span class="comment">//                       const std::string DIVIDEND_MEMO,</span>
<a name="l07762"></a>07762     <span class="comment">//                       const std::string AMOUNT_PER_SHARE);</span>
<a name="l07763"></a>07763     <span class="comment">// ***************************************************************</span>
<a name="l07764"></a>07764 
<a name="l07765"></a>07765     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l07766"></a>07766 
<a name="l07767"></a>07767     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strAttempt, strResponse);
<a name="l07768"></a>07768 
<a name="l07769"></a>07769     <span class="keywordflow">if</span> (1 == nInterpretReply) <span class="comment">// Success!</span>
<a name="l07770"></a>07770     {
<a name="l07771"></a>07771 
<a name="l07772"></a>07772         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l07773"></a>07773         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l07774"></a>07774         <span class="comment">//</span>
<a name="l07775"></a>07775         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l07776"></a>07776         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l07777"></a>07777 
<a name="l07778"></a>07778         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nServer response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS paying out dividends.\n&quot;</span>);
<a name="l07779"></a>07779     }
<a name="l07780"></a>07780 
<a name="l07781"></a>07781     <span class="keywordflow">return</span> nInterpretReply;
<a name="l07782"></a>07782 }
<a name="l07783"></a>07783 
<a name="l07784"></a>07784 
<a name="l07785"></a>07785 <span class="comment">//static int32_t payDividend(const std::string SERVER_ID,</span>
<a name="l07786"></a>07786 <span class="comment">//                       const std::string ISSUER_USER_ID,</span>
<a name="l07787"></a>07787 <span class="comment">//                       const std::string DIVIDEND_FROM_ACCT_ID,</span>
<a name="l07788"></a>07788 <span class="comment">//                       const std::string SHARES_ASSET_TYPE_ID,</span>
<a name="l07789"></a>07789 <span class="comment">//                       const std::string DIVIDEND_MEMO,</span>
<a name="l07790"></a>07790 <span class="comment">//                       const std::string AMOUNT_PER_SHARE);</span>
<a name="l07791"></a>07791 
<a name="l07792"></a>07792 <span class="comment">// HERE, WE GET ALL THE ARGUMENTS TOGETHER,</span>
<a name="l07793"></a>07793 <span class="comment">// and then call the above function.</span>
<a name="l07794"></a>07794 <span class="comment">//</span>
<a name="l07795"></a><a class="code" href="class_o_t___command.html#af784286cc4dd090d6a476a620b820f02">07795</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af784286cc4dd090d6a476a620b820f02">OT_Command::main_pay_dividend</a>()
<a name="l07796"></a>07796 {
<a name="l07797"></a>07797     <span class="keywordtype">string</span> strUsage1 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\n  USAGE: paydividend --server SERVER_ID --mynym SHARES_ISSUER_NYM_ID\n&quot;</span>,
<a name="l07798"></a>07798         <span class="stringliteral">&quot;             --myacct DIVIDEND_SOURCE_ACCT_ID --hispurse SHARES_ASSET_TYPE_ID\n\n&quot;</span>);
<a name="l07799"></a>07799 
<a name="l07800"></a>07800     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1 + <span class="stringliteral">&quot;Also necessary: --args \&quot;amount PAYOUT_AMOUNT_PER_SHARE\&quot;\n&quot;</span>,
<a name="l07801"></a>07801         <span class="stringliteral">&quot;And OPTIONALLY: --args \&quot;memo \\\&quot;Just a memo for the dividend payment.\\\&quot;\&quot;\n\n&quot;</span>);
<a name="l07802"></a>07802 
<a name="l07803"></a>07803     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07804"></a>07804 
<a name="l07805"></a>07805 
<a name="l07806"></a>07806     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l07807"></a>07807     {
<a name="l07808"></a>07808         <span class="comment">// strAmount and strNote...</span>
<a name="l07809"></a>07809         <span class="comment">//</span>
<a name="l07810"></a>07810         <span class="keywordtype">string</span> strAmount = <span class="stringliteral">&quot;0&quot;</span>; <span class="comment">// must ultimately be &gt;= 1  (Payout per share.)</span>
<a name="l07811"></a>07811         <span class="keywordtype">string</span> strNote = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// can be blank</span>
<a name="l07812"></a>07812 
<a name="l07813"></a>07813         <span class="keywordtype">string</span> strDefaultAmount = <span class="stringliteral">&quot;1&quot;</span>; <span class="comment">// must be &gt;= 1</span>
<a name="l07814"></a>07814         <span class="keywordtype">string</span> strDefaultNote = <span class="stringliteral">&quot;(blank memo field)&quot;</span>; <span class="comment">// can be blank</span>
<a name="l07815"></a>07815 
<a name="l07816"></a>07816         <span class="comment">// If custom arguments have been passed on the command line,</span>
<a name="l07817"></a>07817         <span class="comment">// then grab them and use them instead of asking the user to enter them</span>
<a name="l07818"></a>07818         <span class="comment">// at the command line.</span>
<a name="l07819"></a>07819         <span class="comment">//</span>
<a name="l07820"></a>07820         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l07821"></a>07821         {
<a name="l07822"></a>07822             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l07823"></a>07823             <span class="comment">//                                  const std::string str_key)</span>
<a name="l07824"></a>07824             <span class="comment">//</span>
<a name="l07825"></a>07825             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l07826"></a>07826             <span class="comment">// EXAMPLE:  --args &quot;amount 1&quot;</span>
<a name="l07827"></a>07827             <span class="comment">// EXAMPLE:  --args &quot;amount 15 memo \&quot;Just a memo for the dividend payout.\&quot;&quot;</span>
<a name="l07828"></a>07828             <span class="comment">//</span>
<a name="l07829"></a>07829             <span class="keywordtype">string</span> strNewAmount = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;amount&quot;</span>); <span class="comment">// any integer value</span>
<a name="l07830"></a>07830             <span class="keywordtype">string</span> strNewNote = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;memo&quot;</span>);     <span class="comment">// optional memo field</span>
<a name="l07831"></a>07831 
<a name="l07832"></a>07832 
<a name="l07833"></a>07833             <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l07834"></a>07834             <span class="comment">//</span>
<a name="l07835"></a>07835             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewAmount))
<a name="l07836"></a>07836             {
<a name="l07837"></a>07837                 strAmount = strNewAmount;
<a name="l07838"></a>07838             }
<a name="l07839"></a>07839             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewNote))
<a name="l07840"></a>07840             {
<a name="l07841"></a>07841                 strNote = strNewNote;
<a name="l07842"></a>07842             }
<a name="l07843"></a>07843         }
<a name="l07844"></a>07844 
<a name="l07845"></a>07845 
<a name="l07846"></a>07846         <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l07847"></a>07847 
<a name="l07848"></a>07848         <span class="comment">// If the transfer parameters aren&#39;t provided, then we</span>
<a name="l07849"></a>07849         <span class="comment">// ask the user to supply them at the command line.</span>
<a name="l07850"></a>07850         <span class="comment">//</span>
<a name="l07851"></a>07851         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l07852"></a>07852         {
<a name="l07853"></a>07853             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Enter the &#39;Payout Amount Per-Share&#39;[&quot;</span> + strDefaultAmount + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l07854"></a>07854             strAmount = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07855"></a>07855         }
<a name="l07856"></a>07856         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNote))
<a name="l07857"></a>07857         {
<a name="l07858"></a>07858             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Optionally, enter a memo on a single line[&quot;</span> + strDefaultNote + <span class="stringliteral">&quot;]: &quot;</span>);
<a name="l07859"></a>07859             strNote = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l07860"></a>07860         }
<a name="l07861"></a>07861 
<a name="l07862"></a>07862         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount) || (<a class="code" href="class_o_t_a_p_i___wrap.html#a790473fafdd13995a31cf4d516398b4b">OTAPI_Wrap::StringToAmount</a>(strAssetTypeID, strAmount) &lt; 1))
<a name="l07863"></a>07863         {
<a name="l07864"></a>07864             strAmount = strDefaultAmount;
<a name="l07865"></a>07865         }
<a name="l07866"></a>07866         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNote))
<a name="l07867"></a>07867         {
<a name="l07868"></a>07868             strNote = strDefaultNote;
<a name="l07869"></a>07869         }
<a name="l07870"></a>07870 
<a name="l07871"></a>07871 
<a name="l07872"></a>07872         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a89c1f6b1103d020b29f524d26c62aa1b">details_pay_dividend</a>(strAmount, strNote);
<a name="l07873"></a>07873     }
<a name="l07874"></a>07874 
<a name="l07875"></a>07875     <span class="keywordflow">return</span> -1;
<a name="l07876"></a>07876 }
<a name="l07877"></a>07877 
<a name="l07878"></a>07878 
<a name="l07879"></a><a class="code" href="class_o_t___command.html#af72d6f1fe65b70455a7da459d3469e1e">07879</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#af72d6f1fe65b70455a7da459d3469e1e">OT_Command::main_show_purse</a>()
<a name="l07880"></a>07880 {
<a name="l07881"></a>07881     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\n\n  USAGE: showpurse --mypurse ASSET_TYPE_ID --mynym YOUR_NYM_ID --server SERVER_ID \n\n&quot;</span>;
<a name="l07882"></a>07882     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l07883"></a>07883 
<a name="l07884"></a>07884 
<a name="l07885"></a>07885     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>))
<a name="l07886"></a>07886     {
<a name="l07887"></a>07887 
<a name="l07888"></a>07888         <span class="keywordtype">string</span> strPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#ae9a7a7386542b3a62f2a44d7ca7cb655">OTAPI_Wrap::LoadPurse</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>); <span class="comment">// returns NULL, or a purse.</span>
<a name="l07889"></a>07889 
<a name="l07890"></a>07890         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPurse))
<a name="l07891"></a>07891         {
<a name="l07892"></a>07892             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n OT_Command::main_show_purse: Unable to load purse. Does it even exist?\n&quot;</span>);
<a name="l07893"></a>07893         }
<a name="l07894"></a>07894         <span class="keywordflow">else</span>
<a name="l07895"></a>07895         {
<a name="l07896"></a>07896             int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a4f9a95ad1b52a125e6118771806ac000" title="Get Purse Total Value (internally uses GetTotalValue().)">OTAPI_Wrap::Purse_GetTotalValue</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strPurse);
<a name="l07897"></a>07897 
<a name="l07898"></a>07898             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;\n\nTOTAL VALUE: &quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, lAmount));
<a name="l07899"></a>07899 
<a name="l07900"></a>07900 
<a name="l07901"></a>07901             <span class="comment">// Loop through purse contents and display tokens.</span>
<a name="l07902"></a>07902             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strPurse);
<a name="l07903"></a>07903             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) || (nCount &lt; 0))
<a name="l07904"></a>07904             {
<a name="l07905"></a>07905                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n OT_Command::main_show_purse: Error: Unexpected bad value returned from OT_API_Purse_Count.\n\n&quot;</span>);
<a name="l07906"></a>07906                 <span class="keywordflow">return</span> -1;
<a name="l07907"></a>07907             }
<a name="l07908"></a>07908 
<a name="l07909"></a>07909 
<a name="l07910"></a>07910             <span class="keywordflow">if</span> (nCount &gt; 0)
<a name="l07911"></a>07911             {
<a name="l07912"></a>07912                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Token count: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCount) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l07913"></a>07913                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Index\tValue\tSeries\tValidFrom\tValidTo\t\tStatus&quot;</span>);
<a name="l07914"></a>07914 
<a name="l07915"></a>07915                 int32_t nIndex = -1;
<a name="l07916"></a>07916 
<a name="l07917"></a>07917                 <span class="keywordflow">while</span> (nCount &gt; 0)
<a name="l07918"></a>07918                 {
<a name="l07919"></a>07919                     --nCount;
<a name="l07920"></a>07920                     ++nIndex;  <span class="comment">// on first iteration, this is now 0.</span>
<a name="l07921"></a>07921 
<a name="l07922"></a>07922                     <span class="keywordtype">string</span> strToken = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strPurse);
<a name="l07923"></a>07923 
<a name="l07924"></a>07924                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strToken))
<a name="l07925"></a>07925                     {
<a name="l07926"></a>07926                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;main_show_purse: Error: OT_API_Purse_Peek unexpectedly returned NULL instead of token.\n&quot;</span>);
<a name="l07927"></a>07927                         <span class="keywordflow">return</span> -1;
<a name="l07928"></a>07928                     }
<a name="l07929"></a>07929 
<a name="l07930"></a>07930 
<a name="l07931"></a>07931                     <span class="keywordtype">string</span> strNewPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strPurse);
<a name="l07932"></a>07932 
<a name="l07933"></a>07933                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewPurse))
<a name="l07934"></a>07934                     {
<a name="l07935"></a>07935                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;main_show_purse: Error: OT_API_Purse_Pop unexpectedly returned NULL instead of updated purse.\n&quot;</span>);
<a name="l07936"></a>07936                         <span class="keywordflow">return</span> -1;
<a name="l07937"></a>07937                     }
<a name="l07938"></a>07938 
<a name="l07939"></a>07939                     strPurse = strNewPurse;
<a name="l07940"></a>07940 
<a name="l07941"></a>07941                     int64_t lDenomination = <a class="code" href="class_o_t_a_p_i___wrap.html#a2ff749810e4686e3b29d803c550e7d2c" title="The actual cash value of the token. Returns a int64_t.">OTAPI_Wrap::Token_GetDenomination</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strToken);
<a name="l07942"></a>07942                     int32_t nSeries = <a class="code" href="class_o_t_a_p_i___wrap.html#a6d275f0fe30c4480c5b9093a91b60e72">OTAPI_Wrap::Token_GetSeries</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strToken);
<a name="l07943"></a>07943                     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidFrom = <a class="code" href="class_o_t_a_p_i___wrap.html#a655baf87b2caf52ae4d67c1882502612" title="the date is seconds since Jan 1970.">OTAPI_Wrap::Token_GetValidFrom</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strToken);
<a name="l07944"></a>07944                     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidTo = <a class="code" href="class_o_t_a_p_i___wrap.html#a2e36b38bce8c8419bed62f406acdc9af">OTAPI_Wrap::Token_GetValidTo</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>, strToken);
<a name="l07945"></a>07945                     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> lTime = <a class="code" href="class_o_t_a_p_i___wrap.html#abf13a18a258717c8e92bb7b28f368a1c">OTAPI_Wrap::GetTime</a>();
<a name="l07946"></a>07946 
<a name="l07947"></a>07947                     <span class="keywordflow">if</span> (0 &gt; lDenomination)
<a name="l07948"></a>07948                     {
<a name="l07949"></a>07949                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad lDenomination.\n&quot;</span>);
<a name="l07950"></a>07950                         <span class="keywordflow">return</span> -1;
<a name="l07951"></a>07951                     }
<a name="l07952"></a>07952                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSeries))
<a name="l07953"></a>07953                     {
<a name="l07954"></a>07954                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad nSeries.\n&quot;</span>);
<a name="l07955"></a>07955                         <span class="keywordflow">return</span> -1;
<a name="l07956"></a>07956                     }
<a name="l07957"></a>07957                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#afaa948cdd91b617321ab6a90f6ac982e">VerifyTimeVal</a>(tValidFrom))
<a name="l07958"></a>07958                     {
<a name="l07959"></a>07959                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad tValidFrom.\n&quot;</span>);
<a name="l07960"></a>07960                         <span class="keywordflow">return</span> -1;
<a name="l07961"></a>07961                     }
<a name="l07962"></a>07962                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#afaa948cdd91b617321ab6a90f6ac982e">VerifyTimeVal</a>(tValidTo))
<a name="l07963"></a>07963                     {
<a name="l07964"></a>07964                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad tValidTo.\n&quot;</span>);
<a name="l07965"></a>07965                         <span class="keywordflow">return</span> -1;
<a name="l07966"></a>07966                     }
<a name="l07967"></a>07967                     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; lTime)
<a name="l07968"></a>07968                     {
<a name="l07969"></a>07969                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad strTime.\n&quot;</span>);
<a name="l07970"></a>07970                         <span class="keywordflow">return</span> -1;
<a name="l07971"></a>07971                     }
<a name="l07972"></a>07972 
<a name="l07973"></a>07973                     <span class="comment">// Output the token...</span>
<a name="l07974"></a>07974 
<a name="l07975"></a>07975                     <span class="keywordtype">string</span> strStatus = (lTime &gt; tValidTo) ? <span class="stringliteral">&quot;expired&quot;</span> : <span class="stringliteral">&quot;valid&quot;</span>;
<a name="l07976"></a>07976 
<a name="l07977"></a>07977                     <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lDenomination) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nSeries) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(tValidFrom) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(tValidTo) + <span class="stringliteral">&quot;\t&quot;</span> + strStatus);
<a name="l07978"></a>07978 
<a name="l07979"></a>07979                 } <span class="comment">// while</span>
<a name="l07980"></a>07980             } <span class="comment">// if nCount &gt; 0</span>
<a name="l07981"></a>07981 
<a name="l07982"></a>07982             <span class="keywordflow">return</span> 1;
<a name="l07983"></a>07983 
<a name="l07984"></a>07984         } <span class="comment">// valid purse string was loaded.</span>
<a name="l07985"></a>07985 
<a name="l07986"></a>07986     }
<a name="l07987"></a>07987 
<a name="l07988"></a>07988     <span class="keywordflow">return</span> -1;
<a name="l07989"></a>07989 }
<a name="l07990"></a>07990 
<a name="l07991"></a>07991 
<a name="l07992"></a>07992 <span class="comment">//</span>
<a name="l07993"></a>07993 <span class="comment">//</span>
<a name="l07994"></a>07994 <span class="comment">// THESE FUNCTIONS were added for the PAYMENTS screen. (They are fairly new.)</span>
<a name="l07995"></a>07995 <span class="comment">//</span>
<a name="l07996"></a>07996 <span class="comment">// Basically there was a need to have DIFFERENT instruments, but to be able to</span>
<a name="l07997"></a>07997 <span class="comment">// treat them as though they are a single type.</span>
<a name="l07998"></a>07998 <span class="comment">//</span>
<a name="l07999"></a>07999 <span class="comment">// In keeping with that, the below functions will work with disparate types.</span>
<a name="l08000"></a>08000 <span class="comment">// You can pass [ CHEQUES / VOUCHERS / INVOICES ] and PAYMENT PLANS, and</span>
<a name="l08001"></a>08001 <span class="comment">// SMART CONTRACTS, and PURSEs into these functions, and they should be able</span>
<a name="l08002"></a>08002 <span class="comment">// to handle any of those types.</span>
<a name="l08003"></a>08003 <span class="comment">//</span>
<a name="l08004"></a>08004 <span class="comment">//</span>
<a name="l08005"></a>08005 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetAmount(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08006"></a>08006 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetTransNum(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08007"></a>08007 <span class="comment">//</span>
<a name="l08008"></a>08008 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetValidFrom(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08009"></a>08009 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetValidTo(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08010"></a>08010 <span class="comment">//</span>
<a name="l08011"></a>08011 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetMemo(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08012"></a>08012 <span class="comment">//</span>
<a name="l08013"></a>08013 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetAssetID(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08014"></a>08014 <span class="comment">//</span>
<a name="l08015"></a>08015 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetSenderUserID(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08016"></a>08016 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetSenderAcctID(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08017"></a>08017 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetRecipientUserID(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08018"></a>08018 <span class="comment">//const char * OTAPI_Wrap::Instrmnt_GetRecipientAcctID(const char * SERVER_ID, const char * THE_INSTRUMENT);</span>
<a name="l08019"></a>08019 <span class="comment">//</span>
<a name="l08020"></a>08020 
<a name="l08021"></a><a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">08021</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">OT_Command::details_deposit_cheque</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcct, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInstrument, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strType)
<a name="l08022"></a>08022 {
<a name="l08023"></a>08023     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strInstrument);
<a name="l08024"></a>08024 
<a name="l08025"></a>08025     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID))
<a name="l08026"></a>08026     {
<a name="l08027"></a>08027         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find Asset Type ID on the instrument.\n\n&quot;</span>);
<a name="l08028"></a>08028         <span class="keywordflow">return</span> -1;
<a name="l08029"></a>08029     }
<a name="l08030"></a>08030 
<a name="l08031"></a>08031     <span class="keywordtype">string</span> strAssetTypeAcct = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcct);
<a name="l08032"></a>08032 
<a name="l08033"></a>08033     <span class="keywordflow">if</span> (strAssetTypeID != strAssetTypeAcct)
<a name="l08034"></a>08034     {
<a name="l08035"></a>08035         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Asset Type ID on the instrument ( &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot; ) doesn&#39;t match the one on the MyAcct ( &quot;</span> + strAssetTypeAcct + <span class="stringliteral">&quot; )\n\n&quot;</span>);
<a name="l08036"></a>08036         <span class="keywordflow">return</span> -1;
<a name="l08037"></a>08037     }
<a name="l08038"></a>08038 
<a name="l08039"></a>08039     <span class="comment">// HERE, WE SEND THE DEPOSIT CHEQUE REQUEST TO THE SERVER</span>
<a name="l08040"></a>08040     <span class="comment">//</span>
<a name="l08041"></a>08041     <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a1ca8c8c4941acb858886b9d9dddfc74d">MadeEasy::deposit_cheque</a>(strServerID, strMyNymID, strMyAcct, strInstrument);
<a name="l08042"></a>08042     <span class="keywordtype">string</span> strAttempt = <span class="stringliteral">&quot;deposit_cheque&quot;</span>;
<a name="l08043"></a>08043 
<a name="l08044"></a>08044     <span class="comment">// ***************************************************************</span>
<a name="l08045"></a>08045 
<a name="l08046"></a>08046     <span class="comment">// HERE, WE INTERPRET THE SERVER REPLY, WHETHER SUCCESS, FAIL, OR ERROR...</span>
<a name="l08047"></a>08047 
<a name="l08048"></a>08048     int32_t nInterpretReply = <a class="code" href="ot__utility__ot_8hpp.html#ac6ca2dbb5cd14f9620b00eae3cabfa56">InterpretTransactionMsgReply</a>(strServerID, strMyNymID, strMyAcct, strAttempt, strResponse);
<a name="l08049"></a>08049 
<a name="l08050"></a>08050     <span class="keywordflow">if</span> (1 == nInterpretReply)
<a name="l08051"></a>08051     {
<a name="l08052"></a>08052         <span class="comment">// Download all the intermediary files (account balance, inbox, outbox, etc)</span>
<a name="l08053"></a>08053         <span class="comment">// since they have probably changed from this operation.</span>
<a name="l08054"></a>08054         <span class="comment">//</span>
<a name="l08055"></a>08055         <span class="keywordtype">bool</span> bRetrieved = <a class="code" href="class_made_easy.html#abe90ead89b980fee9d975b2a276f0b65">MadeEasy::retrieve_account</a>(strServerID, strMyNymID, strMyAcct, <span class="keyword">true</span>); <span class="comment">//bForceDownload defaults to false.</span>
<a name="l08056"></a>08056 
<a name="l08057"></a>08057         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response (&quot;</span> + strAttempt + <span class="stringliteral">&quot;): SUCCESS!\n&quot;</span>);
<a name="l08058"></a>08058         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="keywordtype">string</span>(bRetrieved ? <span class="stringliteral">&quot;Success&quot;</span> : <span class="stringliteral">&quot;Failed&quot;</span>) + <span class="stringliteral">&quot; retrieving intermediary files for account.\n&quot;</span>);
<a name="l08059"></a>08059     }
<a name="l08060"></a>08060 
<a name="l08061"></a>08061     <span class="comment">// ***************************************************************</span>
<a name="l08062"></a>08062     <span class="comment">//</span>
<a name="l08063"></a>08063     <span class="comment">// Return status to caller.</span>
<a name="l08064"></a>08064     <span class="comment">//</span>
<a name="l08065"></a>08065     <span class="keywordflow">return</span> nInterpretReply;
<a name="l08066"></a>08066 
<a name="l08067"></a>08067 
<a name="l08068"></a>08068 }
<a name="l08069"></a>08069 
<a name="l08070"></a>08070 
<a name="l08071"></a><a class="code" href="class_o_t___command.html#a8dd89a72d6da42df034c8a6bfe7950cf">08071</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a8dd89a72d6da42df034c8a6bfe7950cf">OT_Command::details_deposit_purse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcct, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strFromNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInstrument, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l08072"></a>08072 {
<a name="l08073"></a>08073     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;details_deposit_purse&quot;</span>;
<a name="l08074"></a>08074 
<a name="l08075"></a>08075     <span class="keywordtype">string</span> strTHE_Instrument = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08076"></a>08076 
<a name="l08077"></a>08077     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08078"></a>08078     {
<a name="l08079"></a>08079         strTHE_Instrument = strInstrument;
<a name="l08080"></a>08080     }
<a name="l08081"></a>08081 
<a name="l08082"></a>08082     <span class="comment">// HERE, WE LOOK UP THE asset type ID, BASED ON THE ACCOUNT ID.</span>
<a name="l08083"></a>08083     <span class="comment">//</span>
<a name="l08084"></a>08084     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcct);
<a name="l08085"></a>08085 
<a name="l08086"></a>08086     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID))
<a name="l08087"></a>08087     {
<a name="l08088"></a>08088         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find Asset Type ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l08089"></a>08089         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the asset type based on the account.\n\n&quot;</span>);
<a name="l08090"></a>08090         <span class="keywordflow">return</span> -1;
<a name="l08091"></a>08091     }
<a name="l08092"></a>08092 
<a name="l08093"></a>08093     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>, <span class="keyword">false</span>) &amp;&amp; (<a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a> != strAssetTypeID))
<a name="l08094"></a>08094     {
<a name="l08095"></a>08095         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Warning: Depositing to MyAcct, which is NOT the same asset type as the MyPurse asset type specified.\n&quot;</span>);
<a name="l08096"></a>08096     }
<a name="l08097"></a>08097 
<a name="l08098"></a>08098 
<a name="l08099"></a>08099     <span class="keywordtype">bool</span> bLoadedPurse = <span class="keyword">false</span>;
<a name="l08100"></a>08100 
<a name="l08101"></a>08101     <span class="comment">// If strInstrument wasn&#39;t passed, that means we&#39;re supposed to load</span>
<a name="l08102"></a>08102     <span class="comment">// the purse ourselves, from local storage.</span>
<a name="l08103"></a>08103     <span class="comment">//</span>
<a name="l08104"></a>08104     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTHE_Instrument))
<a name="l08105"></a>08105     {
<a name="l08106"></a>08106         <span class="comment">// LOAD PURSE</span>
<a name="l08107"></a>08107 
<a name="l08108"></a>08108         strTHE_Instrument = <a class="code" href="class_o_t_a_p_i___wrap.html#ae9a7a7386542b3a62f2a44d7ca7cb655">OTAPI_Wrap::LoadPurse</a>(strServerID, strAssetTypeID, strFromNymID); <span class="comment">// returns NULL, or a purse.</span>
<a name="l08109"></a>08109 
<a name="l08110"></a>08110         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTHE_Instrument))
<a name="l08111"></a>08111         {
<a name="l08112"></a>08112             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n &quot;</span> + strLocation + <span class="stringliteral">&quot;: Unable to load purse from local storage. Does it even exist?\n&quot;</span>);
<a name="l08113"></a>08113             <span class="keywordflow">return</span> -1;
<a name="l08114"></a>08114         }
<a name="l08115"></a>08115 
<a name="l08116"></a>08116         bLoadedPurse = <span class="keyword">true</span>;
<a name="l08117"></a>08117     }
<a name="l08118"></a>08118 
<a name="l08119"></a>08119     <span class="comment">// Below this point, we know that strTHE_Instrument contains either the purse as it was passed in</span>
<a name="l08120"></a>08120     <span class="comment">// to us, or it contains the purse as we loaded it from local storage.</span>
<a name="l08121"></a>08121     <span class="comment">// If it WAS from local storage, then there&#39;s a chance that strIndices contains &quot;all&quot; or &quot;4, 6, 2&quot; etc.</span>
<a name="l08122"></a>08122     <span class="comment">// If that&#39;s the case, then we need to iterate through the purse, and add the denoted token IDs to</span>
<a name="l08123"></a>08123     <span class="comment">// a vector (selectedTokens) and pass it into depositCashPurse.</span>
<a name="l08124"></a>08124     <span class="comment">//</span>
<a name="l08125"></a>08125 
<a name="l08126"></a>08126 
<a name="l08127"></a>08127     vector&lt;string&gt; vecSelectedTokenIDs;
<a name="l08128"></a>08128 
<a name="l08129"></a>08129     <span class="comment">// If we loaded the purse (vs the user pasting one in...)</span>
<a name="l08130"></a>08130     <span class="comment">// then the user might have wanted to deposit only selected indices,</span>
<a name="l08131"></a>08131     <span class="comment">// rather than ALL the tokens in that purse.</span>
<a name="l08132"></a>08132     <span class="comment">// So we&#39;ll loop through the purse and add any relevant IDs to the</span>
<a name="l08133"></a>08133     <span class="comment">// &quot;selected&quot; list, since the actual Token IDs must be passed.</span>
<a name="l08134"></a>08134     <span class="comment">//</span>
<a name="l08135"></a>08135     <span class="keywordflow">if</span> (bLoadedPurse)
<a name="l08136"></a>08136     {
<a name="l08137"></a>08137 
<a name="l08138"></a>08138         <span class="comment">// Loop through purse contents...</span>
<a name="l08139"></a>08139         <span class="comment">//</span>
<a name="l08140"></a>08140         int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(strServerID, strAssetTypeID, strTHE_Instrument);
<a name="l08141"></a>08141         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) || (nCount &lt; 0))
<a name="l08142"></a>08142         {
<a name="l08143"></a>08143             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n &quot;</span> + strLocation + <span class="stringliteral">&quot;: Error: Unexpected bad value returned from OT_API_Purse_Count.\n\n&quot;</span>);
<a name="l08144"></a>08144             <span class="keywordflow">return</span> -1;
<a name="l08145"></a>08145         }
<a name="l08146"></a>08146 
<a name="l08147"></a>08147         <span class="keywordflow">if</span> (nCount &lt; 1)
<a name="l08148"></a>08148         {
<a name="l08149"></a>08149             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n &quot;</span> + strLocation + <span class="stringliteral">&quot;: The purse is empty, so you can&#39;t deposit it.\n\n&quot;</span>);
<a name="l08150"></a>08150             <span class="keywordflow">return</span> -1;
<a name="l08151"></a>08151         }
<a name="l08152"></a>08152 
<a name="l08153"></a>08153         <span class="keywordflow">else</span> <span class="comment">//nCount &gt;= 1</span>
<a name="l08154"></a>08154         {
<a name="l08155"></a>08155             <span class="comment">// Make a copy of the purse passed in, so we can iterate it and find the</span>
<a name="l08156"></a>08156             <span class="comment">// appropriate Token IDs...</span>
<a name="l08157"></a>08157 
<a name="l08158"></a>08158             <span class="keywordtype">string</span> strPurse = strTHE_Instrument;
<a name="l08159"></a>08159 
<a name="l08160"></a>08160             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices))
<a name="l08161"></a>08161             {
<a name="l08162"></a>08162                 int32_t nIndex = -1;
<a name="l08163"></a>08163 
<a name="l08164"></a>08164                 <span class="keywordflow">while</span> (nCount &gt; 0)
<a name="l08165"></a>08165                 {
<a name="l08166"></a>08166                     --nCount;
<a name="l08167"></a>08167                     ++nIndex;  <span class="comment">// on first iteration, this is now 0.</span>
<a name="l08168"></a>08168 
<a name="l08169"></a>08169                     <span class="comment">//                  string strOwner = bPasswordProtected ? &quot;&quot; : strFromNymID</span>
<a name="l08170"></a>08170 
<a name="l08171"></a>08171                     <span class="comment">// NOTE: Owner can ONLY be strFromNymID in here, since bLoadedPurse</span>
<a name="l08172"></a>08172                     <span class="comment">// is only true in the case where we LOADED the purse from local storage.</span>
<a name="l08173"></a>08173                     <span class="comment">// (Therefore this DEFINITELY is not a password-protected purse.)</span>
<a name="l08174"></a>08174                     <span class="comment">//</span>
<a name="l08175"></a>08175                     <span class="keywordtype">string</span> strToken = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(strServerID, strAssetTypeID,
<a name="l08176"></a>08176                         strFromNymID,
<a name="l08177"></a>08177                         strPurse);
<a name="l08178"></a>08178 
<a name="l08179"></a>08179                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strToken))
<a name="l08180"></a>08180                     {
<a name="l08181"></a>08181                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Peek unexpectedly returned NULL instead of token.\n&quot;</span>);
<a name="l08182"></a>08182                         <span class="keywordflow">return</span> -1;
<a name="l08183"></a>08183                     }
<a name="l08184"></a>08184 
<a name="l08185"></a>08185                     <span class="keywordtype">string</span> strNewPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(strServerID, strAssetTypeID,
<a name="l08186"></a>08186                         strFromNymID,
<a name="l08187"></a>08187                         strPurse);
<a name="l08188"></a>08188 
<a name="l08189"></a>08189                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewPurse))
<a name="l08190"></a>08190                     {
<a name="l08191"></a>08191                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Pop unexpectedly returned NULL instead of updated purse.\n&quot;</span>);
<a name="l08192"></a>08192                         <span class="keywordflow">return</span> -1;
<a name="l08193"></a>08193                     }
<a name="l08194"></a>08194 
<a name="l08195"></a>08195                     strPurse = strNewPurse;
<a name="l08196"></a>08196 
<a name="l08197"></a>08197                     <span class="keywordtype">string</span> strTokenID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6ecf16a9173a0ca9842a07ba771763d1">OTAPI_Wrap::Token_GetID</a>(strServerID, strAssetTypeID, strToken);
<a name="l08198"></a>08198 
<a name="l08199"></a>08199                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTokenID))
<a name="l08200"></a>08200                     {
<a name="l08201"></a>08201                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error while depositing purse: bad strTokenID.\n&quot;</span>);
<a name="l08202"></a>08202                         <span class="keywordflow">return</span> -1;
<a name="l08203"></a>08203                     }
<a name="l08204"></a>08204 
<a name="l08205"></a>08205                     <span class="keywordflow">if</span> (!(<span class="stringliteral">&quot;all&quot;</span> == strIndices) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex))) <span class="comment">// empty vector should be interpreted already as &quot;all&quot;</span>
<a name="l08206"></a>08206                     {
<a name="l08207"></a>08207                         vecSelectedTokenIDs.push_back(strTokenID);
<a name="l08208"></a>08208                     }
<a name="l08209"></a>08209 
<a name="l08210"></a>08210                 } <span class="comment">// while</span>
<a name="l08211"></a>08211             } <span class="comment">// if strIndices</span>
<a name="l08212"></a>08212         } <span class="comment">// if nCount &gt; 0</span>
<a name="l08213"></a>08213     }<span class="comment">// if (bLoadedPurse)</span>
<a name="l08214"></a>08214 
<a name="l08215"></a>08215 
<a name="l08216"></a>08216     int32_t nResult = <a class="code" href="class_made_easy.html#aea3d47969329579e5f2fc078482fe9ef">MadeEasy::depositCashPurse</a>(strServerID, strAssetTypeID, strFromNymID, strTHE_Instrument, vecSelectedTokenIDs, strMyAcct, bLoadedPurse);
<a name="l08217"></a>08217 
<a name="l08218"></a>08218     <span class="keywordflow">return</span> nResult;
<a name="l08219"></a>08219 
<a name="l08220"></a>08220 }
<a name="l08221"></a>08221 
<a name="l08222"></a>08222 
<a name="l08223"></a>08223 <span class="comment">//case (this.DEPOSIT_CASH)</span>
<a name="l08224"></a>08224 <span class="comment">//{ nRetVal = OTAPI_Wrap::notarizeDeposit(this.serverID, this.nymID, this.accountID, this.strData);  break; }</span>
<a name="l08225"></a>08225 <span class="comment">//case (this.DEPOSIT_CHEQUE)</span>
<a name="l08226"></a>08226 <span class="comment">//{ nRetVal = OTAPI_Wrap::depositCheque(this.serverID, this.nymID, this.accountID, this.strData);  break; }</span>
<a name="l08227"></a>08227 <span class="comment">//case (this.DEPOSIT_PAYMENT_PLAN)</span>
<a name="l08228"></a>08228 <span class="comment">//{ nRetVal = OTAPI_Wrap::depositPaymentPlan(this.serverID, this.nymID, this.strData);  break; }</span>
<a name="l08229"></a>08229 
<a name="l08230"></a>08230 
<a name="l08231"></a><a class="code" href="class_o_t___command.html#a1c1fd3b258fb145fd2705d2bc4b75bae">08231</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a1c1fd3b258fb145fd2705d2bc4b75bae">OT_Command::details_deposit</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID)
<a name="l08232"></a>08232 {
<a name="l08233"></a>08233     <span class="keywordtype">string</span> strInstrument = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08234"></a>08234 
<a name="l08235"></a>08235 
<a name="l08236"></a>08236     <span class="comment">// HERE, WE LOOK UP THE recipient NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l08237"></a>08237     <span class="comment">//</span>
<a name="l08238"></a>08238     <span class="keywordtype">string</span> strToNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l08239"></a>08239 
<a name="l08240"></a>08240     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strToNymID))
<a name="l08241"></a>08241     {
<a name="l08242"></a>08242         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to find depositor NymID based on account ( &quot;</span> + strMyAcctID + <span class="stringliteral">&quot; ).\nUse: --myacct ACCT_ID\n&quot;</span>);
<a name="l08243"></a>08243         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l08244"></a>08244         <span class="keywordflow">return</span> -1;
<a name="l08245"></a>08245     }
<a name="l08246"></a>08246 
<a name="l08247"></a>08247     <span class="comment">//</span>
<a name="l08248"></a>08248     <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08249"></a>08249 
<a name="l08250"></a>08250     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l08251"></a>08251     {
<a name="l08252"></a>08252         <span class="comment">// You have the OPTION to pass in indices for tokens in your purse, and deposit</span>
<a name="l08253"></a>08253         <span class="comment">// will automatically assume &quot;deposit cash&quot; and deposit those tokens.</span>
<a name="l08254"></a>08254         <span class="comment">// You can also specify to deposit ALL tokens in your cash purse.</span>
<a name="l08255"></a>08255         <span class="comment">// Without this extra argument, OT will ask you to paste an instrument,</span>
<a name="l08256"></a>08256         <span class="comment">// and then will dynamically determine its contract type.</span>
<a name="l08257"></a>08257         <span class="comment">//</span>
<a name="l08258"></a>08258 
<a name="l08259"></a>08259         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l08260"></a>08260         <span class="comment">//                                  const std::string str_key)</span>
<a name="l08261"></a>08261         <span class="comment">//</span>
<a name="l08262"></a>08262         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l08263"></a>08263         <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l08264"></a>08264         <span class="comment">// EXAMPLE:  --args &quot;indices all&quot;</span>
<a name="l08265"></a>08265         <span class="comment">//</span>
<a name="l08266"></a>08266         strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l08267"></a>08267     }
<a name="l08268"></a>08268 
<a name="l08269"></a>08269     <span class="comment">//</span>
<a name="l08270"></a>08270     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices)) <span class="comment">// He wants to deposit some or all of his local purse.</span>
<a name="l08271"></a>08271     {
<a name="l08272"></a>08272         <span class="comment">// Only in the case of cash, it&#39;s possible you have some cash in Nym A&#39;s purse, but</span>
<a name="l08273"></a>08273         <span class="comment">// you want to deposit it into Nym B&#39;s account. So we have a &quot;to&quot; Nym and a &quot;from&quot; Nym</span>
<a name="l08274"></a>08274         <span class="comment">// even though they will often be the same.</span>
<a name="l08275"></a>08275         <span class="comment">//</span>
<a name="l08276"></a>08276         <span class="keywordtype">string</span> strFromNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08277"></a>08277 
<a name="l08278"></a>08278         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>))
<a name="l08279"></a>08279         {
<a name="l08280"></a>08280             strFromNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l08281"></a>08281         }
<a name="l08282"></a>08282         <span class="keywordflow">else</span>
<a name="l08283"></a>08283         {
<a name="l08284"></a>08284             strFromNymID = strToNymID;
<a name="l08285"></a>08285         }
<a name="l08286"></a>08286 
<a name="l08287"></a>08287         <span class="comment">// In this case, strInstrument is blank.</span>
<a name="l08288"></a>08288         <span class="comment">// That&#39;s how the callee knows that we&#39;re working with the local purse.</span>
<a name="l08289"></a>08289         <span class="comment">// Then strIndices tells him either to use &quot;all&quot; tokens in that purse, or</span>
<a name="l08290"></a>08290         <span class="comment">// the selected indices.</span>
<a name="l08291"></a>08291         <span class="comment">//</span>
<a name="l08292"></a>08292         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a8dd89a72d6da42df034c8a6bfe7950cf">details_deposit_purse</a>(strServerID, strMyAcctID, strFromNymID, strInstrument, strIndices);
<a name="l08293"></a>08293     }
<a name="l08294"></a>08294 
<a name="l08295"></a>08295     <span class="keywordflow">else</span> <span class="comment">// he wants to paste an instrument.</span>
<a name="l08296"></a>08296     {
<a name="l08297"></a>08297         <span class="comment">//</span>
<a name="l08298"></a>08298         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You can deposit a PURSE (containing cash tokens) or a CHEQUE / VOUCHER. \n&quot;</span>);
<a name="l08299"></a>08299         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Paste your financial instrument here, followed by a ~ by itself on a blank line: \n&quot;</span>);
<a name="l08300"></a>08300 
<a name="l08301"></a>08301         strInstrument = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l08302"></a>08302 
<a name="l08303"></a>08303         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08304"></a>08304         {
<a name="l08305"></a>08305             <span class="keywordflow">return</span> -1;
<a name="l08306"></a>08306         }
<a name="l08307"></a>08307 
<a name="l08308"></a>08308 
<a name="l08309"></a>08309         <span class="comment">//      const char * OTPayment::_TypeStrings[] =</span>
<a name="l08310"></a>08310         <span class="comment">//      {</span>
<a name="l08311"></a>08311         <span class="comment">//          // ------------------</span>
<a name="l08312"></a>08312         <span class="comment">//          // OTCheque is derived from OTTrackable, which is derived from OTInstrument, which is</span>
<a name="l08313"></a>08313         <span class="comment">//          // derived from OTScriptable, which is derived from OTContract.</span>
<a name="l08314"></a>08314         <span class="comment">//          // ------------------</span>
<a name="l08315"></a>08315         <span class="comment">//          &quot;CHEQUE&quot;,         // A cheque drawn on a user&#39;s account.</span>
<a name="l08316"></a>08316         <span class="comment">//          &quot;VOUCHER&quot;,        // A cheque drawn on a server account (cashier&#39;s cheque aka banker&#39;s cheque)</span>
<a name="l08317"></a>08317         <span class="comment">//          &quot;INVOICE&quot;,        // A cheque with a negative amount. (Depositing this causes a payment out, instead of a deposit in.)</span>
<a name="l08318"></a>08318         <span class="comment">//          // ------------------</span>
<a name="l08319"></a>08319         <span class="comment">//          &quot;PAYMENT_PLAN&quot;,   // An OTCronItem-derived OTPaymentPlan, related to a recurring payment plan.</span>
<a name="l08320"></a>08320         <span class="comment">//          &quot;SMART_CONTRACT&quot;, // An OTCronItem-derived OTSmartContract, related to a smart contract.</span>
<a name="l08321"></a>08321         <span class="comment">//          // ------------------</span>
<a name="l08322"></a>08322         <span class="comment">//          &quot;PURSE&quot;,          // An OTContract-derived OTPurse containing a list of cash OTTokens.</span>
<a name="l08323"></a>08323         <span class="comment">//          // ------------------</span>
<a name="l08324"></a>08324         <span class="comment">//          &quot;ERROR_STATE&quot;</span>
<a name="l08325"></a>08325         <span class="comment">//; };</span>
<a name="l08326"></a>08326 
<a name="l08327"></a>08327 
<a name="l08328"></a>08328         <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l08329"></a>08329 
<a name="l08330"></a>08330         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType))
<a name="l08331"></a>08331         {
<a name="l08332"></a>08332             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine instrument type. Expected CHEQUE, VOUCHER, INVOICE, or (cash) PURSE.\n&quot;</span>);
<a name="l08333"></a>08333             <span class="keywordflow">return</span> -1;
<a name="l08334"></a>08334         }
<a name="l08335"></a>08335 
<a name="l08336"></a>08336 
<a name="l08337"></a>08337         <span class="keywordflow">if</span> (<span class="stringliteral">&quot;CHEQUE&quot;</span> == strType)
<a name="l08338"></a>08338         {
<a name="l08339"></a>08339             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strToNymID, strInstrument, strType);
<a name="l08340"></a>08340         }
<a name="l08341"></a>08341         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;VOUCHER&quot;</span> == strType)
<a name="l08342"></a>08342         {
<a name="l08343"></a>08343             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strToNymID, strInstrument, strType);
<a name="l08344"></a>08344         }
<a name="l08345"></a>08345         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;INVOICE&quot;</span> == strType)
<a name="l08346"></a>08346         {
<a name="l08347"></a>08347             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strToNymID, strInstrument, strType);
<a name="l08348"></a>08348         }
<a name="l08349"></a>08349         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PURSE&quot;</span> == strType)
<a name="l08350"></a>08350         {
<a name="l08351"></a>08351             <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a8dd89a72d6da42df034c8a6bfe7950cf">details_deposit_purse</a>(strServerID, strMyAcctID, strToNymID, strInstrument, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// strIndices is left blank in this case</span>
<a name="l08352"></a>08352         }
<a name="l08353"></a>08353         <span class="keywordflow">else</span>
<a name="l08354"></a>08354         {
<a name="l08355"></a>08355             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine instrument type. Expected CHEQUE, VOUCHER, INVOICE, or (cash) PURSE.\n&quot;</span>);
<a name="l08356"></a>08356             <span class="keywordflow">return</span> -1;
<a name="l08357"></a>08357         }
<a name="l08358"></a>08358     }
<a name="l08359"></a>08359 
<a name="l08360"></a>08360     <span class="keywordflow">return</span> -1;
<a name="l08361"></a>08361 }
<a name="l08362"></a>08362 
<a name="l08363"></a>08363 
<a name="l08364"></a><a class="code" href="class_o_t___command.html#a65ed727f8a3c03d91ee05c93044e7cdd">08364</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a65ed727f8a3c03d91ee05c93044e7cdd">OT_Command::main_deposit</a>()
<a name="l08365"></a>08365 {
<a name="l08366"></a>08366     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\n\n  USAGE: deposit --myacct YOUR_ACCT_ID  \n(OT will ask you to paste the instrument.)\n&quot;</span>;
<a name="l08367"></a>08367     <span class="keywordtype">string</span> strUsage2 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Optionally:    --mynym YOUR_NYM_ID \n&quot;</span>);
<a name="l08368"></a>08368     <span class="keywordtype">string</span> strUsage3 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage2, <span class="stringliteral">&quot;Optionally:    --args \&quot;indices 4,6,9\&quot;\n&quot;</span>);
<a name="l08369"></a>08369     <span class="keywordtype">string</span> strUsage4 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage3, <span class="stringliteral">&quot;Optionally:    --args \&quot;indices all\&quot;  (To deposit ALL cash tokens in your purse.)\n&quot;</span>);
<a name="l08370"></a>08370     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage4, <span class="stringliteral">&quot;Server and NymID are usually determined based on MyAcct.\n If you supply optional indices, they must correspond to tokens in your cash purse.\n\n&quot;</span>);
<a name="l08371"></a>08371 
<a name="l08372"></a>08372     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l08373"></a>08373 
<a name="l08374"></a>08374 
<a name="l08375"></a>08375     <span class="comment">// A bit complicated:</span>
<a name="l08376"></a>08376     <span class="comment">//</span>
<a name="l08377"></a>08377     <span class="comment">// If I specify MyPurse and MyAcct, then they MUST have the same asset type.</span>
<a name="l08378"></a>08378     <span class="comment">//</span>
<a name="l08379"></a>08379     <span class="comment">// If I specify MyNym and MyPurse, that is where we will look for the purse.</span>
<a name="l08380"></a>08380     <span class="comment">//</span>
<a name="l08381"></a>08381     <span class="comment">// If I specify MyAcct, and it&#39;s owned by a different Nym than MyNym, then the cash</span>
<a name="l08382"></a>08382     <span class="comment">// tokens will be reassigned from MyNym to MyAcct&#39;s Nym, before depositing.</span>
<a name="l08383"></a>08383     <span class="comment">// Basically ALWAYS look up MyAcct&#39;s owner, and set HIM as the recipient Nym.</span>
<a name="l08384"></a>08384     <span class="comment">// (But still use MyNym, independently, to find the purse being deposited.)</span>
<a name="l08385"></a>08385     <span class="comment">//</span>
<a name="l08386"></a>08386     <span class="comment">// Must ALWAYS specify MyAcct because otherwise, where are you depositing to?</span>
<a name="l08387"></a>08387     <span class="comment">//</span>
<a name="l08388"></a>08388     <span class="comment">// If MyNym isn&#39;t available, should use MyAcct&#39;s Nym.</span>
<a name="l08389"></a>08389     <span class="comment">//</span>
<a name="l08390"></a>08390     <span class="comment">// Shouldn&#39;t need to specify MyPurse, since we can ONLY deposit into MyAcct of</span>
<a name="l08391"></a>08391     <span class="comment">// the same type as MyAcct. Thus we should ignore any other asset types or purses</span>
<a name="l08392"></a>08392     <span class="comment">// since they couldn&#39;t possibly be deposited into MyAcct anyway.</span>
<a name="l08393"></a>08393     <span class="comment">//</span>
<a name="l08394"></a>08394 
<a name="l08395"></a>08395     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l08396"></a>08396     {
<a name="l08397"></a>08397 
<a name="l08398"></a>08398         <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l08399"></a>08399         <span class="comment">//</span>
<a name="l08400"></a>08400         <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l08401"></a>08401 
<a name="l08402"></a>08402         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l08403"></a>08403         {
<a name="l08404"></a>08404             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l08405"></a>08405             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l08406"></a>08406             <span class="keywordflow">return</span> -1;
<a name="l08407"></a>08407         }
<a name="l08408"></a>08408 
<a name="l08409"></a>08409         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; !(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> == strServerID))
<a name="l08410"></a>08410         {
<a name="l08411"></a>08411             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;This account is on server ( &quot;</span> + strServerID + <span class="stringliteral">&quot; -- the server is deduced based on the account), but the default server is ( &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot; ). To override it, use:  --server &quot;</span> + strServerID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l08412"></a>08412             <span class="keywordflow">return</span> -1;
<a name="l08413"></a>08413         }
<a name="l08414"></a>08414 
<a name="l08415"></a>08415         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a1c1fd3b258fb145fd2705d2bc4b75bae">details_deposit</a>(strServerID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l08416"></a>08416     }
<a name="l08417"></a>08417 
<a name="l08418"></a>08418     <span class="keywordflow">return</span> -1;
<a name="l08419"></a>08419 }
<a name="l08420"></a>08420 
<a name="l08421"></a>08421 
<a name="l08422"></a>08422 <span class="comment">/*</span>
<a name="l08423"></a>08423 <span class="comment"></span>
<a name="l08424"></a>08424 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetAmount(const char * THE_INSTRUMENT);</span>
<a name="l08425"></a>08425 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetTransNum(const char * THE_INSTRUMENT);</span>
<a name="l08426"></a>08426 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetValidFrom(const char * THE_INSTRUMENT);</span>
<a name="l08427"></a>08427 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetValidTo(const char * THE_INSTRUMENT);</span>
<a name="l08428"></a>08428 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetMemo(const char * THE_INSTRUMENT);</span>
<a name="l08429"></a>08429 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetType(const char * THE_INSTRUMENT);</span>
<a name="l08430"></a>08430 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetServerID(const char * THE_INSTRUMENT);</span>
<a name="l08431"></a>08431 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetAssetID(const char * THE_INSTRUMENT);</span>
<a name="l08432"></a>08432 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetSenderUserID(const char * THE_INSTRUMENT);</span>
<a name="l08433"></a>08433 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetSenderAcctID(const char * THE_INSTRUMENT);</span>
<a name="l08434"></a>08434 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetRecipientUserID(const char * THE_INSTRUMENT);</span>
<a name="l08435"></a>08435 <span class="comment">const char * OTAPI_Wrap::Instrmnt_GetRecipientAcctID(const char * THE_INSTRUMENT);</span>
<a name="l08436"></a>08436 <span class="comment"></span>
<a name="l08437"></a>08437 <span class="comment"></span>
<a name="l08438"></a>08438 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::CreatePurse), &quot;OT_API_CreatePurse&quot;);</span>
<a name="l08439"></a>08439 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::CreatePurse_Passphrase), &quot;OT_API_CreatePurse_Passphrase&quot;);</span>
<a name="l08440"></a>08440 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::SavePurse), &quot;OT_API_SavePurse&quot;);</span>
<a name="l08441"></a>08441 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_GetTotalValue), &quot;OT_API_Purse_GetTotalValue&quot;);</span>
<a name="l08442"></a>08442 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_Count), &quot;OT_API_Purse_Count&quot;);</span>
<a name="l08443"></a>08443 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_Peek), &quot;OT_API_Purse_Peek&quot;);</span>
<a name="l08444"></a>08444 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_Pop), &quot;OT_API_Purse_Pop&quot;);</span>
<a name="l08445"></a>08445 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_Push), &quot;OT_API_Purse_Push&quot;);</span>
<a name="l08446"></a>08446 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Wallet_ImportPurse), &quot;OT_API_Wallet_ImportPurse&quot;);</span>
<a name="l08447"></a>08447 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::exchangePurse), &quot;OT_API_exchangePurse&quot;);</span>
<a name="l08448"></a>08448 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Token_ChangeOwner), &quot;OT_API_Token_ChangeOwner&quot;);</span>
<a name="l08449"></a>08449 <span class="comment">pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Purse_HasPassword), &quot;OT_API_Purse_HasPassword&quot;);</span>
<a name="l08450"></a>08450 <span class="comment"></span>
<a name="l08451"></a>08451 <span class="comment">*/</span>
<a name="l08452"></a>08452 
<a name="l08453"></a>08453 
<a name="l08454"></a><a class="code" href="class_o_t___command.html#a9c6731316ca47f6af897cca11e02c7df">08454</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a9c6731316ca47f6af897cca11e02c7df">OT_Command::details_import_purse</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInstrument, <span class="keyword">const</span> <span class="keywordtype">bool</span> bHasPassword, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPurseOwner)
<a name="l08455"></a>08455 {
<a name="l08456"></a>08456     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08457"></a>08457     {
<a name="l08458"></a>08458         <span class="keywordflow">return</span> -1;
<a name="l08459"></a>08459     }
<a name="l08460"></a>08460 
<a name="l08461"></a>08461     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strInstrument);
<a name="l08462"></a>08462 
<a name="l08463"></a>08463     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l08464"></a>08464     {
<a name="l08465"></a>08465         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine server ID from purse.\n&quot;</span>);
<a name="l08466"></a>08466         <span class="keywordflow">return</span> -1;
<a name="l08467"></a>08467     }
<a name="l08468"></a>08468 
<a name="l08469"></a>08469     <span class="keywordtype">string</span> strAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strInstrument);
<a name="l08470"></a>08470 
<a name="l08471"></a>08471     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetID))
<a name="l08472"></a>08472     {
<a name="l08473"></a>08473         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine asset type ID from purse.\n&quot;</span>);
<a name="l08474"></a>08474         <span class="keywordflow">return</span> -1;
<a name="l08475"></a>08475     }
<a name="l08476"></a>08476 
<a name="l08477"></a>08477     <span class="keywordtype">bool</span> bActuallyHasPassword = <a class="code" href="class_o_t_a_p_i___wrap.html#a5998cc36adb2d2f60b65e441a9263806">OTAPI_Wrap::Purse_HasPassword</a>(strServerID, strInstrument);
<a name="l08478"></a>08478 
<a name="l08479"></a>08479     <span class="keywordflow">if</span> (bHasPassword != bActuallyHasPassword)
<a name="l08480"></a>08480     {
<a name="l08481"></a>08481         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The actual purse&#39;s opinion of whether or not it has a password, doesn&#39;t match the caller&#39;s opinion.\n&quot;</span>);
<a name="l08482"></a>08482         <span class="keywordflow">return</span> -1;
<a name="l08483"></a>08483     }
<a name="l08484"></a>08484 
<a name="l08485"></a>08485     <span class="keywordtype">bool</span> bImported = <a class="code" href="class_o_t_a_p_i___wrap.html#a94256b991cbfda07261cf037c7c13f0a" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Wrap::Wallet_ImportPurse</a>(strServerID, strAssetID, strPurseOwner, strInstrument);
<a name="l08486"></a>08486 
<a name="l08487"></a>08487     <span class="keywordflow">if</span> (bImported)
<a name="l08488"></a>08488     {
<a name="l08489"></a>08489         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Success importing purse!\nServer: &quot;</span> + strServerID + <span class="stringliteral">&quot;\nAsset Type: &quot;</span> + strAssetID + <span class="stringliteral">&quot;\nNym: &quot;</span> + strPurseOwner + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l08490"></a>08490         <span class="keywordflow">return</span> 1;
<a name="l08491"></a>08491     }
<a name="l08492"></a>08492 
<a name="l08493"></a>08493     <span class="keywordflow">return</span> -1;
<a name="l08494"></a>08494 }
<a name="l08495"></a>08495 
<a name="l08496"></a>08496 
<a name="l08497"></a><a class="code" href="class_o_t___command.html#a4c164f925dc168dffc95f4ac843f3b34">08497</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a4c164f925dc168dffc95f4ac843f3b34">OT_Command::details_import_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInstrument)
<a name="l08498"></a>08498 {
<a name="l08499"></a>08499     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08500"></a>08500     {
<a name="l08501"></a>08501         <span class="keywordflow">return</span> -1;
<a name="l08502"></a>08502     }
<a name="l08503"></a>08503 
<a name="l08504"></a>08504     <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l08505"></a>08505 
<a name="l08506"></a>08506     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType))
<a name="l08507"></a>08507     {
<a name="l08508"></a>08508         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine instrument type. Expected (cash) PURSE.\n&quot;</span>);
<a name="l08509"></a>08509         <span class="keywordflow">return</span> -1;
<a name="l08510"></a>08510     }
<a name="l08511"></a>08511 
<a name="l08512"></a>08512     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7ee4172065bb2a4fbf28c55d4519fd39">OTAPI_Wrap::Instrmnt_GetServerID</a>(strInstrument);
<a name="l08513"></a>08513 
<a name="l08514"></a>08514     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l08515"></a>08515     {
<a name="l08516"></a>08516         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine server ID from purse.\n&quot;</span>);
<a name="l08517"></a>08517         <span class="keywordflow">return</span> -1;
<a name="l08518"></a>08518     }
<a name="l08519"></a>08519 
<a name="l08520"></a>08520     <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PURSE&quot;</span> == strType)
<a name="l08521"></a>08521     {
<a name="l08522"></a>08522     }
<a name="l08523"></a>08523     <span class="comment">// Todo: case &quot;TOKEN&quot;</span>
<a name="l08524"></a>08524     <span class="comment">//</span>
<a name="l08525"></a>08525     <span class="comment">// NOTE: This is commented out because since it is guessing the NymID as MyNym,</span>
<a name="l08526"></a>08526     <span class="comment">// then it will just create a purse for MyNym and import it into that purse, and</span>
<a name="l08527"></a>08527     <span class="comment">// then later when doing a deposit, THAT&#39;s when it tries to DECRYPT that token</span>
<a name="l08528"></a>08528     <span class="comment">// and re-encrypt it to the SERVER&#39;s nym... and that&#39;s when we might find out that</span>
<a name="l08529"></a>08529     <span class="comment">// it never was encrypted to MyNym in the first place -- we had just assumed it</span>
<a name="l08530"></a>08530     <span class="comment">// was here, when we did the import. Until I can look at that in more detail, it</span>
<a name="l08531"></a>08531     <span class="comment">// will remain commented out.</span>
<a name="l08532"></a>08532     <span class="keywordflow">else</span>
<a name="l08533"></a>08533     {
<a name="l08534"></a>08534         <span class="comment">//            // This version supports cash tokens (instead of purse...)</span>
<a name="l08535"></a>08535         <span class="comment">//            bool bImportedToken = importCashPurse(strServerID, MyNym, strAssetID, userInput, isPurse)</span>
<a name="l08536"></a>08536         <span class="comment">//</span>
<a name="l08537"></a>08537         <span class="comment">//            if (bImportedToken)</span>
<a name="l08538"></a>08538         <span class="comment">//            {</span>
<a name="l08539"></a>08539         <span class="comment">//                OTAPI_Wrap::Output(0, &quot;\n\n Success importing cash token!\nServer: &quot;+strServerID+&quot;\nAsset Type: &quot;+strAssetID+&quot;\nNym: &quot;+MyNym+&quot;\n\n&quot;);</span>
<a name="l08540"></a>08540         <span class="comment">//                return 1;</span>
<a name="l08541"></a>08541         <span class="comment">//; }</span>
<a name="l08542"></a>08542 
<a name="l08543"></a>08543         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine instrument type. Expected (cash) PURSE.\n&quot;</span>);
<a name="l08544"></a>08544         <span class="keywordflow">return</span> -1;
<a name="l08545"></a>08545     }
<a name="l08546"></a>08546 
<a name="l08547"></a>08547     <span class="comment">// This tells us if the purse is password-protected. (Versus being owned</span>
<a name="l08548"></a>08548     <span class="comment">// by a Nym.)</span>
<a name="l08549"></a>08549     <span class="keywordtype">bool</span> bHasPassword = <a class="code" href="class_o_t_a_p_i___wrap.html#a5998cc36adb2d2f60b65e441a9263806">OTAPI_Wrap::Purse_HasPassword</a>(strServerID, strInstrument);
<a name="l08550"></a>08550 
<a name="l08551"></a>08551     <span class="comment">// Even if the Purse is owned by a Nym, that Nym&#39;s ID may not necessarily</span>
<a name="l08552"></a>08552     <span class="comment">// be present on the purse itself (it&#39;s optional to list it there.)</span>
<a name="l08553"></a>08553     <span class="comment">// OTAPI_Wrap::Instrmnt_GetRecipientUserID tells us WHAT the recipient User ID</span>
<a name="l08554"></a>08554     <span class="comment">// is, IF it&#39;s on the purse. (But does NOT tell us WHETHER there is a</span>
<a name="l08555"></a>08555     <span class="comment">// recipient. The above function is for that.)</span>
<a name="l08556"></a>08556     <span class="comment">//</span>
<a name="l08557"></a>08557     <span class="keywordtype">string</span> strPurseOwner = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08558"></a>08558 
<a name="l08559"></a>08559     <span class="keywordflow">if</span> (!bHasPassword)
<a name="l08560"></a>08560     {
<a name="l08561"></a>08561         strPurseOwner = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strInstrument); <span class="comment">// TRY and get the Nym ID (it may have been left blank.)</span>
<a name="l08562"></a>08562     }
<a name="l08563"></a>08563 
<a name="l08564"></a>08564     <span class="comment">// Whether the purse was password-protected (and thus had no Nym ID)</span>
<a name="l08565"></a>08565     <span class="comment">// or whether it does have a Nym ID (but it wasn&#39;t listed on the purse)</span>
<a name="l08566"></a>08566     <span class="comment">// Then either way, in those cases strPurseOwner will still be NULL.</span>
<a name="l08567"></a>08567     <span class="comment">//</span>
<a name="l08568"></a>08568     <span class="comment">// (The third case is that the purse is Nym protected and the ID WAS available,</span>
<a name="l08569"></a>08569     <span class="comment">// in which case we&#39;ll skip this block, since we already have it.)</span>
<a name="l08570"></a>08570     <span class="comment">//</span>
<a name="l08571"></a>08571     <span class="comment">// But even in the case where there&#39;s no Nym at all (password protected)</span>
<a name="l08572"></a>08572     <span class="comment">// we STILL need to pass a Signer Nym ID into OTAPI_Wrap::Wallet_ImportPurse.</span>
<a name="l08573"></a>08573     <span class="comment">// So if it&#39;s still NULL here, then we use --mynym to make the call.</span>
<a name="l08574"></a>08574     <span class="comment">// And also, even in the case where there IS a Nym but it&#39;s not listed,</span>
<a name="l08575"></a>08575     <span class="comment">// we must assume the USER knows the appropriate NymID, even if it&#39;s not</span>
<a name="l08576"></a>08576     <span class="comment">// listed on the purse itself. And in that case as well, the user can</span>
<a name="l08577"></a>08577     <span class="comment">// simply specify the Nym using --mynym.</span>
<a name="l08578"></a>08578     <span class="comment">//</span>
<a name="l08579"></a>08579     <span class="comment">// Bottom line: by this point, if it&#39;s still not set, then we just use</span>
<a name="l08580"></a>08580     <span class="comment">// MyNym, and if THAT&#39;s not set, then we return failure.</span>
<a name="l08581"></a>08581     <span class="comment">//</span>
<a name="l08582"></a>08582     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPurseOwner))
<a name="l08583"></a>08583     {
<a name="l08584"></a>08584         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n The NymID isn&#39;t evident from the purse itself... (listing it is optional.)\nThe purse may have no Nym at all--it may instead be password-protected.) Either way, a signer nym is still necessary, even for password-protected purses.\n\n Trying MyNym...\n&quot;</span>);
<a name="l08585"></a>08585 
<a name="l08586"></a>08586         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l08587"></a>08587         {
<a name="l08588"></a>08588             <span class="keywordflow">return</span> -1;
<a name="l08589"></a>08589         }
<a name="l08590"></a>08590 
<a name="l08591"></a>08591         strPurseOwner = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l08592"></a>08592     }
<a name="l08593"></a>08593 
<a name="l08594"></a>08594     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a9c6731316ca47f6af897cca11e02c7df">details_import_purse</a>(strInstrument, bHasPassword, strPurseOwner);
<a name="l08595"></a>08595 }
<a name="l08596"></a>08596 
<a name="l08597"></a>08597 
<a name="l08598"></a><a class="code" href="class_o_t___command.html#ac4657db47e3bd12f625337db8b5263c3">08598</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac4657db47e3bd12f625337db8b5263c3">OT_Command::main_import_cash</a>()
<a name="l08599"></a>08599 {
<a name="l08600"></a>08600     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\n\n  USAGE: importcash   (OT will ask you to paste the instrument.)\n&quot;</span>;
<a name="l08601"></a>08601     <span class="keywordtype">string</span> strUsage2 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Optionally: importcash --mynym YOUR_NYM_ID\n\n&quot;</span>);
<a name="l08602"></a>08602     <span class="keywordtype">string</span> strUsage3 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage2, <span class="stringliteral">&quot;Asset (Purse) ID and ServerID are both deduced from the cash purse that you&#39;re importing.\n&quot;</span>);
<a name="l08603"></a>08603     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage3, <span class="stringliteral">&quot;NymID is also deduced, if necessary. (Otherwise, specify using --mynym.)\n\n&quot;</span>);
<a name="l08604"></a>08604 
<a name="l08605"></a>08605     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l08606"></a>08606 
<a name="l08607"></a>08607     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;You can import a PURSE (containing cash tokens.)\n&quot;</span>);
<a name="l08608"></a>08608     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Paste your financial instrument here, followed by a ~ by itself on a blank line: \n&quot;</span>);
<a name="l08609"></a>08609 
<a name="l08610"></a>08610     <span class="keywordtype">string</span> strInstrument = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l08611"></a>08611 
<a name="l08612"></a>08612     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08613"></a>08613     {
<a name="l08614"></a>08614         <span class="keywordflow">return</span> -1;
<a name="l08615"></a>08615     }
<a name="l08616"></a>08616 
<a name="l08617"></a>08617     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a4c164f925dc168dffc95f4ac843f3b34">details_import_cash</a>(strInstrument);
<a name="l08618"></a>08618 }
<a name="l08619"></a>08619 
<a name="l08620"></a>08620 
<a name="l08621"></a>08621 <span class="comment">// MyPurse and HisPurse will call the script even when not found, giving the script</span>
<a name="l08622"></a>08622 <span class="comment">// the opportunity to download the appropriate asset contract from the server, if</span>
<a name="l08623"></a>08623 <span class="comment">// necessary.</span>
<a name="l08624"></a>08624 <span class="comment">//</span>
<a name="l08625"></a>08625 <span class="comment">// Similarly, HisAcct works without being expected to be found in the wallet (since</span>
<a name="l08626"></a>08626 <span class="comment">// maybe it&#39;s HIS account and thus it&#39;s not IN your wallet...)</span>
<a name="l08627"></a>08627 <span class="comment">//</span>
<a name="l08628"></a>08628 <span class="comment">// Similarly, HisNym will call the script even when not found, giving the script the</span>
<a name="l08629"></a>08629 <span class="comment">// opportunity to download the appropriate pubkey (&quot;check_user&quot; aka &quot;checknym&quot;) and</span>
<a name="l08630"></a>08630 <span class="comment">// continue operating.</span>
<a name="l08631"></a>08631 <span class="comment">//</span>
<a name="l08632"></a>08632 <span class="comment">// All of the above, plus Server, ALREADY attempt a partial match search. Therefore,</span>
<a name="l08633"></a>08633 <span class="comment">// it&#39;s not necessary to perform ANOTHER partial match, when the value comes from</span>
<a name="l08634"></a>08634 <span class="comment">// --server, --mynym, --hisnym, --mypurse, --hispurse, --myacct, or --hisacct.</span>
<a name="l08635"></a>08635 <span class="comment">//</span>
<a name="l08636"></a>08636 <span class="comment">// You only need to do partial matches when you get values from ELSEWHERE, such as</span>
<a name="l08637"></a>08637 <span class="comment">// from custom arguments, or user-pasted input.</span>
<a name="l08638"></a>08638 <span class="comment">//</span>
<a name="l08639"></a>08639 <span class="comment">// Therefore, add a function for downloading a Nym&#39;s pubkey if not already in the wallet,</span>
<a name="l08640"></a>08640 <span class="comment">// and one that downloads an asset contract if not already in the wallet</span>
<a name="l08641"></a>08641 
<a name="l08642"></a>08642 
<a name="l08643"></a><a class="code" href="class_o_t___command.html#a325e769bba225b859234d066e6fe8f42">08643</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">string</span> <a class="code" href="class_o_t___command.html#a325e769bba225b859234d066e6fe8f42">OT_Command::details_export_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strFromNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAssetTypeID, <span class="keywordtype">string</span> &amp; strHisNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices, <span class="keyword">const</span> <span class="keywordtype">bool</span> bPasswordProtected, <span class="keywordtype">string</span> &amp; strRetainedCopy)
<a name="l08644"></a>08644 {
<a name="l08645"></a>08645 
<a name="l08646"></a>08646     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;\n details_export_cash&quot;</span>;
<a name="l08647"></a>08647 
<a name="l08648"></a>08648     <span class="comment">// The first three arguments are for loading up the purse we&#39;re exporting FROM.</span>
<a name="l08649"></a>08649     <span class="comment">//</span>
<a name="l08650"></a>08650     <span class="comment">// Then strHisNymID is for the Nym we&#39;re exporting TO (if bPasswordProtected is false.)</span>
<a name="l08651"></a>08651     <span class="comment">//</span>
<a name="l08652"></a>08652     <span class="comment">// Then strIndices contains the indices for the tokens to export.</span>
<a name="l08653"></a>08653     <span class="comment">//</span>
<a name="l08654"></a>08654     <span class="comment">// Then bPasswordProtected tells us whether to export to strHisNymID,</span>
<a name="l08655"></a>08655     <span class="comment">// or to create a password-protected purse and export to that instead.</span>
<a name="l08656"></a>08656     <span class="comment">// (In which case, the purse itself becomes the &quot;owner&quot; and can be passed</span>
<a name="l08657"></a>08657     <span class="comment">// wherever we would normally pass a NymID as a purse owner.)</span>
<a name="l08658"></a>08658     <span class="comment">//</span>
<a name="l08659"></a>08659     <span class="comment">// if bPasswordProtected is false, then strHisNymID needs to contain the recipient Nym.</span>
<a name="l08660"></a>08660     <span class="comment">// This will contain MyNym by default, if --hisnym wasn&#39;t used at the command line.</span>
<a name="l08661"></a>08661     <span class="comment">//</span>
<a name="l08662"></a>08662 
<a name="l08663"></a>08663     <span class="keywordtype">string</span> strContract = <a class="code" href="class_made_easy.html#a40fb6b2438337545a6d677259415c2ff">MadeEasy::load_or_retrieve_contract</a>(strServerID, strFromNymID, strAssetTypeID);
<a name="l08664"></a>08664 
<a name="l08665"></a>08665     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l08666"></a>08666     {
<a name="l08667"></a>08667         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load asset contract: &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l08668"></a>08668         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08669"></a>08669     }
<a name="l08670"></a>08670 
<a name="l08671"></a>08671     <span class="keywordtype">bool</span> bLoadedPurse = <span class="keyword">false</span>;
<a name="l08672"></a>08672 
<a name="l08673"></a>08673     <span class="keywordtype">string</span> strInstrument = <a class="code" href="class_o_t_a_p_i___wrap.html#ae9a7a7386542b3a62f2a44d7ca7cb655">OTAPI_Wrap::LoadPurse</a>(strServerID, strAssetTypeID, strFromNymID); <span class="comment">// returns NULL, or a purse.</span>
<a name="l08674"></a>08674 
<a name="l08675"></a>08675     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l08676"></a>08676     {
<a name="l08677"></a>08677         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load purse from local storage. Does it even exist?\n&quot;</span>);
<a name="l08678"></a>08678         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08679"></a>08679     }
<a name="l08680"></a>08680 
<a name="l08681"></a>08681     bLoadedPurse = <span class="keyword">true</span>;
<a name="l08682"></a>08682 
<a name="l08683"></a>08683     <span class="comment">// Below this point, we know that strInstrument contains the purse as we loaded it from local storage.</span>
<a name="l08684"></a>08684     <span class="comment">// If it WAS from local storage, then there&#39;s a chance that strIndices contains &quot;4, 6, 2&quot; etc.</span>
<a name="l08685"></a>08685     <span class="comment">// If that&#39;s the case, then we need to iterate through the purse, and add the denoted token IDs to</span>
<a name="l08686"></a>08686     <span class="comment">// a vector (selectedTokens) and pass it into exportCashPurse.</span>
<a name="l08687"></a>08687 
<a name="l08688"></a>08688 
<a name="l08689"></a>08689     vector&lt;string&gt; vecSelectedTokenIDs;
<a name="l08690"></a>08690 
<a name="l08691"></a>08691     <span class="comment">// the user might have wanted to export only selected indices,</span>
<a name="l08692"></a>08692     <span class="comment">// rather than ALL the tokens in the purse.</span>
<a name="l08693"></a>08693     <span class="comment">// So we&#39;ll loop through the purse and add any relevant IDs to the</span>
<a name="l08694"></a>08694     <span class="comment">// &quot;selected&quot; list, since the actual Token IDs must be passed.</span>
<a name="l08695"></a>08695     <span class="comment">//</span>
<a name="l08696"></a>08696     <span class="keywordflow">if</span> (bLoadedPurse)
<a name="l08697"></a>08697     {
<a name="l08698"></a>08698 
<a name="l08699"></a>08699         <span class="comment">// Loop through purse contents...</span>
<a name="l08700"></a>08700         <span class="comment">//</span>
<a name="l08701"></a>08701         int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(strServerID, strAssetTypeID, strInstrument);
<a name="l08702"></a>08702         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) || (nCount &lt; 0))
<a name="l08703"></a>08703         {
<a name="l08704"></a>08704             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: Unexpected bad value returned from OT_API_Purse_Count.\n\n&quot;</span>);
<a name="l08705"></a>08705             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08706"></a>08706         }
<a name="l08707"></a>08707 
<a name="l08708"></a>08708         <span class="keywordflow">if</span> (nCount &lt; 1)
<a name="l08709"></a>08709         {
<a name="l08710"></a>08710             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: The purse is empty, so you can&#39;t export it.\n\n&quot;</span>);
<a name="l08711"></a>08711             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08712"></a>08712         }
<a name="l08713"></a>08713 
<a name="l08714"></a>08714         <span class="keywordflow">else</span> <span class="comment">//nCount &gt;= 1</span>
<a name="l08715"></a>08715         {
<a name="l08716"></a>08716             <span class="comment">// Make a COPY of the purse for this loop, so we can iterate it and find the</span>
<a name="l08717"></a>08717             <span class="comment">// appropriate Token IDs...</span>
<a name="l08718"></a>08718 
<a name="l08719"></a>08719             <span class="keywordtype">string</span> strPurse = strInstrument;
<a name="l08720"></a>08720 
<a name="l08721"></a>08721             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices)) <span class="comment">// if strIndices is empty, then we send vecSelectedTokenIDs empty as well (which means, &quot;do them all.&quot;)</span>
<a name="l08722"></a>08722             {
<a name="l08723"></a>08723                 int32_t nIndex = -1;
<a name="l08724"></a>08724 
<a name="l08725"></a>08725                 <span class="keywordflow">while</span> (nCount &gt; 0)
<a name="l08726"></a>08726                 {
<a name="l08727"></a>08727                     --nCount;
<a name="l08728"></a>08728                     ++nIndex;  <span class="comment">// on first iteration, this is now 0.</span>
<a name="l08729"></a>08729 
<a name="l08730"></a>08730                     <span class="keywordtype">string</span> strToken = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(strServerID, strAssetTypeID, strFromNymID, strPurse);
<a name="l08731"></a>08731 
<a name="l08732"></a>08732                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strToken))
<a name="l08733"></a>08733                     {
<a name="l08734"></a>08734                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Peek unexpectedly returned NULL instead of token.\n&quot;</span>);
<a name="l08735"></a>08735                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08736"></a>08736                     }
<a name="l08737"></a>08737 
<a name="l08738"></a>08738                     <span class="keywordtype">string</span> strNewPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(strServerID, strAssetTypeID, strFromNymID, strPurse);
<a name="l08739"></a>08739 
<a name="l08740"></a>08740                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewPurse))
<a name="l08741"></a>08741                     {
<a name="l08742"></a>08742                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Pop unexpectedly returned NULL instead of updated purse.\n&quot;</span>);
<a name="l08743"></a>08743                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08744"></a>08744                     }
<a name="l08745"></a>08745 
<a name="l08746"></a>08746                     strPurse = strNewPurse;
<a name="l08747"></a>08747 
<a name="l08748"></a>08748                     <span class="keywordtype">string</span> strTokenID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6ecf16a9173a0ca9842a07ba771763d1">OTAPI_Wrap::Token_GetID</a>(strServerID, strAssetTypeID, strToken);
<a name="l08749"></a>08749 
<a name="l08750"></a>08750                     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTokenID))
<a name="l08751"></a>08751                     {
<a name="l08752"></a>08752                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error while exporting purse: bad strTokenID.\n&quot;</span>);
<a name="l08753"></a>08753                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08754"></a>08754                     }
<a name="l08755"></a>08755 
<a name="l08756"></a>08756                     <span class="comment">//                  bool NumList_VerifyQuery(const std::string str_NumList, const std::string str_Numbers)</span>
<a name="l08757"></a>08757 
<a name="l08758"></a>08758                     <span class="comment">// If there are no indices, then do them all. (Thus push this one,</span>
<a name="l08759"></a>08759                     <span class="comment">// as we push every one.)</span>
<a name="l08760"></a>08760                     <span class="comment">// OR, If there are indices, and the current index is FOUND on the</span>
<a name="l08761"></a>08761                     <span class="comment">// vector of indices, then we push this one (since it was selected.)</span>
<a name="l08762"></a>08762                     <span class="comment">//</span>
<a name="l08763"></a>08763                     <span class="keywordflow">if</span> (!(<span class="stringliteral">&quot;all&quot;</span> == strIndices) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex))) <span class="comment">// empty vector should be interpreted already as &quot;all&quot;</span>
<a name="l08764"></a>08764                     {
<a name="l08765"></a>08765                         vecSelectedTokenIDs.push_back(strTokenID);
<a name="l08766"></a>08766                     }
<a name="l08767"></a>08767 
<a name="l08768"></a>08768                 } <span class="comment">// while</span>
<a name="l08769"></a>08769             } <span class="comment">// if strIndices</span>
<a name="l08770"></a>08770 
<a name="l08771"></a>08771             <span class="keywordtype">string</span> strExportedCashPurse = <a class="code" href="class_made_easy.html#aa55b3d84e22f5f8ff15df9e3603ec6d4">MadeEasy::exportCashPurse</a>(strServerID, strAssetTypeID, strFromNymID, strInstrument, vecSelectedTokenIDs, strHisNymID, bPasswordProtected, strRetainedCopy);
<a name="l08772"></a>08772 
<a name="l08773"></a>08773             <span class="keywordflow">return</span> strExportedCashPurse;
<a name="l08774"></a>08774 
<a name="l08775"></a>08775         } <span class="comment">// if nCount &gt; 0</span>
<a name="l08776"></a>08776 
<a name="l08777"></a>08777     }<span class="comment">// if (bLoadedPurse)</span>
<a name="l08778"></a>08778 
<a name="l08779"></a>08779     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08780"></a>08780 }
<a name="l08781"></a>08781 
<a name="l08782"></a>08782 
<a name="l08783"></a><a class="code" href="class_o_t___command.html#ab0e83d63a8a7b7949161c145a5984a3c">08783</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab0e83d63a8a7b7949161c145a5984a3c">OT_Command::main_export_cash</a>()
<a name="l08784"></a>08784 {
<a name="l08785"></a>08785     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\n\n  USAGE: exportcash --mypurse ASSET_TYPE_ID --mynym YOUR_NYM_ID --hisnym RECIPIENT_NYM_ID --server SERVER_ID\n&quot;</span>;
<a name="l08786"></a>08786     <span class="keywordtype">string</span> strUsage2 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage1, <span class="stringliteral">&quot;Optionally:    --args \&quot;indices 4,6,9\&quot;\n&quot;</span>);
<a name="l08787"></a>08787     <span class="keywordtype">string</span> strUsage3 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage2, <span class="stringliteral">&quot;Optionally:    --args \&quot;passwd true\&quot;  (To create a password-protected purse.)\n\n&quot;</span>);
<a name="l08788"></a>08788     <span class="keywordtype">string</span> strUsage4 = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage3, <span class="stringliteral">&quot;(If you create a password-protected purse, then HisNym will be ignored and can be left out.)\n&quot;</span>);
<a name="l08789"></a>08789     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(strUsage4, <span class="stringliteral">&quot;If you supply optional indices, they must correspond to tokens in your cash purse.\n\n&quot;</span>);
<a name="l08790"></a>08790 
<a name="l08791"></a>08791     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l08792"></a>08792 
<a name="l08793"></a>08793     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyPurse&quot;</span>))
<a name="l08794"></a>08794     {
<a name="l08795"></a>08795         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08796"></a>08796         <span class="keywordtype">bool</span> bPasswordProtected = <span class="keyword">false</span>;
<a name="l08797"></a>08797 
<a name="l08798"></a>08798         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l08799"></a>08799         {
<a name="l08800"></a>08800             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l08801"></a>08801             <span class="comment">//                                  const std::string str_key)</span>
<a name="l08802"></a>08802             <span class="comment">//</span>
<a name="l08803"></a>08803             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l08804"></a>08804             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l08805"></a>08805             <span class="comment">// EXAMPLE:  --args &quot;indices \&quot;all\&quot; &quot;</span>
<a name="l08806"></a>08806             <span class="comment">//</span>
<a name="l08807"></a>08807             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l08808"></a>08808 
<a name="l08809"></a>08809             <span class="keywordtype">string</span> strPasswordProtected = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;passwd&quot;</span>);
<a name="l08810"></a>08810 
<a name="l08811"></a>08811             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPasswordProtected) &amp;&amp; (<span class="stringliteral">&quot;true&quot;</span> == strPasswordProtected))
<a name="l08812"></a>08812             {
<a name="l08813"></a>08813                 bPasswordProtected = <span class="keyword">true</span>;
<a name="l08814"></a>08814             }
<a name="l08815"></a>08815         }
<a name="l08816"></a>08816 
<a name="l08817"></a>08817         <span class="keywordtype">string</span> strHisNym = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;  <span class="comment">// default export is to your own Nym.</span>
<a name="l08818"></a>08818 
<a name="l08819"></a>08819         <span class="keywordflow">if</span> (!bPasswordProtected &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;HisNym&quot;</span>, <span class="keyword">false</span>))
<a name="l08820"></a>08820         {
<a name="l08821"></a>08821             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;HisNym was provided at the command line.\nDo you wish to export this cash to HisNym instead of MyNym?\n\n&quot;</span>);
<a name="l08822"></a>08822             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;HisNym is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a> + <span class="stringliteral">&quot;\n MyNym is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n\n Type yes to use HisNym, or no to use MyNym.[no]: &quot;</span>);
<a name="l08823"></a>08823 
<a name="l08824"></a>08824             <span class="keywordtype">string</span> strAnswer = <a class="code" href="_o_t___m_e_8hpp.html#a2f6d1287151b67b52f7d187721d48e96">OT_CLI_ReadLine</a>();
<a name="l08825"></a>08825 
<a name="l08826"></a>08826             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAnswer) &amp;&amp; ((<span class="stringliteral">&quot;y&quot;</span> == strAnswer) || (<span class="stringliteral">&quot;yes&quot;</span> == strAnswer)))
<a name="l08827"></a>08827             {
<a name="l08828"></a>08828                 strHisNym = <a class="code" href="ot__otapi__ot_8hpp.html#a25b14fa35dfb0a0e53378c56355f4b7c">HisNym</a>;
<a name="l08829"></a>08829             }
<a name="l08830"></a>08830         }
<a name="l08831"></a>08831 
<a name="l08832"></a>08832         <span class="keywordtype">string</span> strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;  <span class="comment">// so it makes a copy. (Partial ID processing will alter the variable internally here, and that will fail with Server since it&#39;s a global constant.)</span>
<a name="l08833"></a>08833         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;   <span class="comment">// Same reason.</span>
<a name="l08834"></a>08834         <span class="keywordtype">string</span> strMyPurse = <a class="code" href="ot__otapi__ot_8hpp.html#a2981d858bb694fb46294c8c7e05d9661">MyPurse</a>; <span class="comment">// Same reason.</span>
<a name="l08835"></a>08835         <span class="keywordtype">string</span> strRetainedCopy = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// A copy of the exported purse, except this copy is encrypted to the SENDER&#39;s key. (In case he needs to recover it from his outpayments.)</span>
<a name="l08836"></a>08836 
<a name="l08837"></a>08837         <span class="keywordtype">string</span> strExportedPurse = <a class="code" href="class_o_t___command.html#a325e769bba225b859234d066e6fe8f42">details_export_cash</a>(strServerID, strMyNymID, strMyPurse, strHisNym, strIndices, bPasswordProtected, strRetainedCopy);
<a name="l08838"></a>08838 
<a name="l08839"></a>08839         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strExportedPurse))
<a name="l08840"></a>08840         {
<a name="l08841"></a>08841             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;\n&quot;</span> + strExportedPurse + <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stdout</span>
<a name="l08842"></a>08842             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Success exporting cash purse!\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l08843"></a>08843             <span class="keywordflow">return</span> 1; <span class="comment">// Success!</span>
<a name="l08844"></a>08844         }
<a name="l08845"></a>08845     }
<a name="l08846"></a>08846 
<a name="l08847"></a>08847     <span class="keywordflow">return</span> -1;
<a name="l08848"></a>08848 }
<a name="l08849"></a>08849 
<a name="l08850"></a>08850 
<a name="l08851"></a>08851 <span class="comment">// Pass in the exact indices, or an amount, and this function will return true;</span>
<a name="l08852"></a>08852 <span class="comment">// or false.</span>
<a name="l08853"></a>08853 <span class="comment">//</span>
<a name="l08854"></a>08854 <span class="comment">// If you pass the indices, this function returns true if those exact indices</span>
<a name="l08855"></a>08855 <span class="comment">// exist. In that case, this function will also set lAmount to the total.</span>
<a name="l08856"></a>08856 <span class="comment">//</span>
<a name="l08857"></a>08857 <span class="comment">// If, instead, you pass lAmount and a blank indices, this function will try to</span>
<a name="l08858"></a>08858 <span class="comment">// determine the indices that would create lAmount, if they were selected. If it</span>
<a name="l08859"></a>08859 <span class="comment">// returns true, strIndices, will contain the result, at the end of it all.</span>
<a name="l08860"></a>08860 <span class="comment">//</span>
<a name="l08861"></a><a class="code" href="class_o_t___command.html#a54b747884ee93502868637dda660f6a2">08861</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#a54b747884ee93502868637dda660f6a2">OT_Command::purse_get_indices_or_amount</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAssetTypeID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, int64_t &amp; lAmount, <span class="keywordtype">string</span> &amp; strIndices) <span class="comment">// If strIndices is input, lAmount is output. (And vice-versa.)</span>
<a name="l08862"></a>08862 {
<a name="l08863"></a>08863 
<a name="l08864"></a>08864     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;\n purse_get_indices_or_amount&quot;</span>;
<a name="l08865"></a>08865 
<a name="l08866"></a>08866     <span class="keywordtype">string</span> strLoopIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08867"></a>08867     int64_t lLoopAmount = lAmount; <span class="comment">// so they are the same data type.</span>
<a name="l08868"></a>08868     int64_t lAmountRemaining = lAmount; <span class="comment">// so they are the same data type.</span>
<a name="l08869"></a>08869     lLoopAmount = 0; <span class="comment">// to initialize it back to 0.</span>
<a name="l08870"></a>08870 
<a name="l08871"></a>08871     <span class="comment">// lLoopAmount is where we will start at 0, and keep the running total of the value for the selected indices, as we loop.</span>
<a name="l08872"></a>08872     <span class="comment">// lAmountRemaining is where we will start at lAmount, and then SUBTRACT the value of each selected index, as we loop.</span>
<a name="l08873"></a>08873     <span class="comment">// If we are trying to determine the indices based on lAmount, we&#39;ll SEE if the current index is less-than-or-equal-to</span>
<a name="l08874"></a>08874     <span class="comment">// lAmountRemaining, and if so, we&#39;ll concat that index to our output and subtract the denomination of the token at the</span>
<a name="l08875"></a>08875     <span class="comment">// current index from lAmountRemaining.</span>
<a name="l08876"></a>08876     <span class="comment">// If bFindAmountFromIndices is true then lAmount is already 0 and then lAmountRemaining is already 0 as well.</span>
<a name="l08877"></a>08877 
<a name="l08878"></a>08878     <span class="keywordtype">bool</span> bFindIndicesFromAmount = <span class="keyword">false</span>;
<a name="l08879"></a>08879     <span class="keywordtype">bool</span> bFindAmountFromIndices = <span class="keyword">false</span>;
<a name="l08880"></a>08880 
<a name="l08881"></a>08881     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) &amp;&amp; (0 == lAmount))
<a name="l08882"></a>08882     {
<a name="l08883"></a>08883         <span class="comment">// all good.</span>
<a name="l08884"></a>08884         bFindAmountFromIndices = <span class="keyword">true</span>;
<a name="l08885"></a>08885     }
<a name="l08886"></a>08886     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) &amp;&amp; (0 != lAmount))
<a name="l08887"></a>08887     {
<a name="l08888"></a>08888         <span class="comment">// all good.</span>
<a name="l08889"></a>08889         bFindIndicesFromAmount = <span class="keyword">true</span>;
<a name="l08890"></a>08890     }
<a name="l08891"></a>08891     <span class="keywordflow">else</span>
<a name="l08892"></a>08892     {
<a name="l08893"></a>08893         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Can only pass indices, OR amount to this function, but not both (the other becomes output.)\n&quot;</span>);
<a name="l08894"></a>08894         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08895"></a>08895     }
<a name="l08896"></a>08896 
<a name="l08897"></a>08897     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;strServerID: &quot;</span> + strServerID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l08898"></a>08898     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;strAssetTypeID: &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l08899"></a>08899     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;strMyNymID: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l08900"></a>08900 
<a name="l08901"></a>08901     <span class="keywordtype">string</span> strLocalPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#ae9a7a7386542b3a62f2a44d7ca7cb655">OTAPI_Wrap::LoadPurse</a>(strServerID, strAssetTypeID, strMyNymID);
<a name="l08902"></a>08902 
<a name="l08903"></a>08903     <span class="keywordtype">bool</span> bLoadedPurse = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strLocalPurse);
<a name="l08904"></a>08904     <span class="keywordflow">if</span> (!bLoadedPurse)
<a name="l08905"></a>08905     {
<a name="l08906"></a>08906         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to load local purse. Does it even exist?\n&quot;</span>);
<a name="l08907"></a>08907         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08908"></a>08908     }
<a name="l08909"></a>08909     <span class="keywordflow">else</span>
<a name="l08910"></a>08910     {
<a name="l08911"></a>08911 
<a name="l08912"></a>08912         <span class="comment">// Loop through purse contents...</span>
<a name="l08913"></a>08913         <span class="comment">//</span>
<a name="l08914"></a>08914         int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a00a15ef2477cc825a7ed9862bd870d34" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Wrap::Purse_Count</a>(strServerID, strAssetTypeID, strLocalPurse);
<a name="l08915"></a>08915         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount) || (nCount &lt; 0))
<a name="l08916"></a>08916         {
<a name="l08917"></a>08917             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: Unexpected bad value returned from OT_API_Purse_Count.\n\n&quot;</span>);
<a name="l08918"></a>08918             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08919"></a>08919         }
<a name="l08920"></a>08920 
<a name="l08921"></a>08921         <span class="keywordflow">if</span> (nCount &lt; 1)
<a name="l08922"></a>08922         {
<a name="l08923"></a>08923             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: The purse is empty.\n\n&quot;</span>);
<a name="l08924"></a>08924             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08925"></a>08925         }
<a name="l08926"></a>08926 
<a name="l08927"></a>08927         <span class="keywordflow">else</span> <span class="comment">//nCount &gt;= 1</span>
<a name="l08928"></a>08928         {
<a name="l08929"></a>08929             <span class="comment">// Make a copy of the purse passed in, so we can iterate it and find the</span>
<a name="l08930"></a>08930             <span class="comment">// appropriate Token IDs...</span>
<a name="l08931"></a>08931 
<a name="l08932"></a>08932             <span class="keywordtype">string</span> strPurse = strLocalPurse;
<a name="l08933"></a>08933 
<a name="l08934"></a>08934             int32_t nIndex = -1;
<a name="l08935"></a>08935 
<a name="l08936"></a>08936             <span class="keywordflow">while</span> (nCount &gt; 0)
<a name="l08937"></a>08937             {
<a name="l08938"></a>08938                 --nCount;
<a name="l08939"></a>08939                 ++nIndex;  <span class="comment">// on first iteration, this is now 0.</span>
<a name="l08940"></a>08940 
<a name="l08941"></a>08941 
<a name="l08942"></a>08942                 <span class="comment">//                  string strOwner = bPasswordProtected ? &quot;&quot; : strMyNymID</span>
<a name="l08943"></a>08943 
<a name="l08944"></a>08944                 <span class="comment">// NOTE: Owner can ONLY be strMyNymID in here, since bLoadedPurse</span>
<a name="l08945"></a>08945                 <span class="comment">// is only true in the case where we LOADED the purse from local storage.</span>
<a name="l08946"></a>08946                 <span class="comment">// (Therefore this DEFINITELY is not a password-protected purse.)</span>
<a name="l08947"></a>08947                 <span class="comment">//</span>
<a name="l08948"></a>08948                 <span class="keywordtype">string</span> strToken = <a class="code" href="class_o_t_a_p_i___wrap.html#ac0aa01306129db00a32c6bd50683a4d2">OTAPI_Wrap::Purse_Peek</a>(strServerID, strAssetTypeID,
<a name="l08949"></a>08949                     strMyNymID,
<a name="l08950"></a>08950                     strPurse);
<a name="l08951"></a>08951 
<a name="l08952"></a>08952                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strToken))
<a name="l08953"></a>08953                 {
<a name="l08954"></a>08954                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Peek unexpectedly returned NULL instead of token.\n&quot;</span>);
<a name="l08955"></a>08955                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08956"></a>08956                 }
<a name="l08957"></a>08957 
<a name="l08958"></a>08958                 <span class="keywordtype">string</span> strNewPurse = <a class="code" href="class_o_t_a_p_i___wrap.html#abdaac1c21230efadd76da1453d397dd5">OTAPI_Wrap::Purse_Pop</a>(strServerID, strAssetTypeID,
<a name="l08959"></a>08959                     strMyNymID,
<a name="l08960"></a>08960                     strPurse);
<a name="l08961"></a>08961 
<a name="l08962"></a>08962                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strNewPurse))
<a name="l08963"></a>08963                 {
<a name="l08964"></a>08964                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: OT_API_Purse_Pop unexpectedly returned NULL instead of updated purse.\n&quot;</span>);
<a name="l08965"></a>08965                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08966"></a>08966                 }
<a name="l08967"></a>08967 
<a name="l08968"></a>08968                 strPurse = strNewPurse;
<a name="l08969"></a>08969 
<a name="l08970"></a>08970                 <span class="keywordtype">string</span> strTokenID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6ecf16a9173a0ca9842a07ba771763d1">OTAPI_Wrap::Token_GetID</a>(strServerID, strAssetTypeID, strToken);
<a name="l08971"></a>08971                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTokenID))
<a name="l08972"></a>08972                 {
<a name="l08973"></a>08973                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Error: bad strTokenID.\n&quot;</span>);
<a name="l08974"></a>08974                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08975"></a>08975                 }
<a name="l08976"></a>08976                 int64_t lDenomination = <a class="code" href="class_o_t_a_p_i___wrap.html#a2ff749810e4686e3b29d803c550e7d2c" title="The actual cash value of the token. Returns a int64_t.">OTAPI_Wrap::Token_GetDenomination</a>(strServerID, strAssetTypeID, strToken);
<a name="l08977"></a>08977                 <span class="keywordflow">if</span> (0 &gt; lDenomination)
<a name="l08978"></a>08978                 {
<a name="l08979"></a>08979                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad lDenomination.\n&quot;</span>);
<a name="l08980"></a>08980                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08981"></a>08981                 }
<a name="l08982"></a>08982                 int32_t nSeries = <a class="code" href="class_o_t_a_p_i___wrap.html#a6d275f0fe30c4480c5b9093a91b60e72">OTAPI_Wrap::Token_GetSeries</a>(strServerID, strAssetTypeID, strToken);
<a name="l08983"></a>08983                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nSeries))
<a name="l08984"></a>08984                 {
<a name="l08985"></a>08985                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad nSeries.\n&quot;</span>);
<a name="l08986"></a>08986                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08987"></a>08987                 }
<a name="l08988"></a>08988                 <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidFrom = <a class="code" href="class_o_t_a_p_i___wrap.html#a655baf87b2caf52ae4d67c1882502612" title="the date is seconds since Jan 1970.">OTAPI_Wrap::Token_GetValidFrom</a>(strServerID, strAssetTypeID, strToken);
<a name="l08989"></a>08989                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#afaa948cdd91b617321ab6a90f6ac982e">VerifyTimeVal</a>(tValidFrom))
<a name="l08990"></a>08990                 {
<a name="l08991"></a>08991                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad tValidFrom.\n&quot;</span>);
<a name="l08992"></a>08992                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08993"></a>08993                 }
<a name="l08994"></a>08994                 <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidTo = <a class="code" href="class_o_t_a_p_i___wrap.html#a2e36b38bce8c8419bed62f406acdc9af">OTAPI_Wrap::Token_GetValidTo</a>(strServerID, strAssetTypeID, strToken);
<a name="l08995"></a>08995                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#afaa948cdd91b617321ab6a90f6ac982e">VerifyTimeVal</a>(tValidTo))
<a name="l08996"></a>08996                 {
<a name="l08997"></a>08997                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad tValidTo.\n&quot;</span>);
<a name="l08998"></a>08998                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l08999"></a>08999                 }
<a name="l09000"></a>09000                 <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> lTime = <a class="code" href="class_o_t_a_p_i___wrap.html#abf13a18a258717c8e92bb7b28f368a1c">OTAPI_Wrap::GetTime</a>();
<a name="l09001"></a>09001                 <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; lTime)
<a name="l09002"></a>09002                 {
<a name="l09003"></a>09003                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while showing purse: bad lTime.\n&quot;</span>);
<a name="l09004"></a>09004                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09005"></a>09005                 }
<a name="l09006"></a>09006                 <span class="keywordtype">string</span> strStatus = (lTime &gt; tValidTo) ? <span class="stringliteral">&quot;expired&quot;</span> : <span class="stringliteral">&quot;valid&quot;</span>;
<a name="l09007"></a>09007 
<a name="l09008"></a>09008                 <span class="comment">// ------------------------------------------</span>
<a name="l09009"></a>09009                 <span class="comment">// lLoopAmount is where we will start at 0, and keep the running total of the value for the selected indices, as we loop.</span>
<a name="l09010"></a>09010                 <span class="comment">// lAmountRemaining is where we will start at lAmount, and then SUBTRACT the value of each selected index, as we loop.</span>
<a name="l09011"></a>09011                 <span class="comment">// If we are trying to determine the indices based on lAmount, we&#39;ll SEE if value at the current index is less-than-or-equal-to</span>
<a name="l09012"></a>09012                 <span class="comment">// lAmountRemaining, and if so, we&#39;ll concat that index to our output and subtract the denomination of the token at the</span>
<a name="l09013"></a>09013                 <span class="comment">// current index from lAmountRemaining.</span>
<a name="l09014"></a>09014                 <span class="comment">// If bFindAmountFromIndices is true then lAmount is already 0 and then lAmountRemaining is already 0 as well.</span>
<a name="l09015"></a>09015 
<a name="l09016"></a>09016                 <span class="comment">// TODO:  This would work better if the tokens were sorted. In the future, pull the tokens onto a map or something,</span>
<a name="l09017"></a>09017                 <span class="comment">// and then SORT IT based on denomination of token. THEN go through the tokens from largest to smallest and do what we&#39;re</span>
<a name="l09018"></a>09018                 <span class="comment">// doing here in this loop. And then it will work perfectly everytime. Todo.  This version will work okay, but there will be</span>
<a name="l09019"></a>09019                 <span class="comment">// times it fails and ends up withdrawing cash when it didn&#39;t really need to. TOdo.</span>
<a name="l09020"></a>09020 
<a name="l09021"></a>09021                 <span class="keywordflow">if</span> (lTime &gt; tValidTo)
<a name="l09022"></a>09022                 {
<a name="l09023"></a>09023                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Skipping: Token is &quot;</span> + strStatus + <span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l09024"></a>09024                 }
<a name="l09025"></a>09025 
<a name="l09026"></a>09026                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFindAmountFromIndices)
<a name="l09027"></a>09027                 {
<a name="l09028"></a>09028                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) &amp;&amp; ((<span class="stringliteral">&quot;all&quot;</span> == strIndices) || <a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex))))
<a name="l09029"></a>09029                     {
<a name="l09030"></a>09030                         <span class="keywordtype">string</span> strTempIndices = <a class="code" href="class_o_t_a_p_i___wrap.html#a2c99c371d98953958c62d543f2800c21">OTAPI_Wrap::NumList_Add</a>(strLoopIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l09031"></a>09031                         strLoopIndices = strTempIndices;
<a name="l09032"></a>09032                         lLoopAmount += lDenomination;
<a name="l09033"></a>09033                     }
<a name="l09034"></a>09034                 }
<a name="l09035"></a>09035                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFindIndicesFromAmount)
<a name="l09036"></a>09036                 {
<a name="l09037"></a>09037                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount) &amp;&amp; (lAmountRemaining &gt; 0) &amp;&amp; (lDenomination &lt;= lAmountRemaining))
<a name="l09038"></a>09038                     {
<a name="l09039"></a>09039                         <span class="keywordtype">string</span> strTempIndices = <a class="code" href="class_o_t_a_p_i___wrap.html#a2c99c371d98953958c62d543f2800c21">OTAPI_Wrap::NumList_Add</a>(strLoopIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l09040"></a>09040                         strLoopIndices = strTempIndices;
<a name="l09041"></a>09041                         lLoopAmount += lDenomination;
<a name="l09042"></a>09042                         lAmountRemaining -= lDenomination;
<a name="l09043"></a>09043 
<a name="l09044"></a>09044                         <span class="keywordflow">if</span> (0 == lAmountRemaining)
<a name="l09045"></a>09045                         {
<a name="l09046"></a>09046                             <span class="keywordflow">break</span>;
<a name="l09047"></a>09047                         }
<a name="l09048"></a>09048                     }
<a name="l09049"></a>09049                 }
<a name="l09050"></a>09050 
<a name="l09051"></a>09051             } <span class="comment">// while</span>
<a name="l09052"></a>09052         } <span class="comment">// if nCount &gt; 0</span>
<a name="l09053"></a>09053     }<span class="comment">// if (bLoadedPurse)</span>
<a name="l09054"></a>09054 
<a name="l09055"></a>09055     <span class="keywordflow">if</span> (bFindAmountFromIndices)
<a name="l09056"></a>09056     {
<a name="l09057"></a>09057         lAmount = lLoopAmount;
<a name="l09058"></a>09058         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l09059"></a>09059     }
<a name="l09060"></a>09060     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFindIndicesFromAmount)
<a name="l09061"></a>09061     {
<a name="l09062"></a>09062         strIndices = strLoopIndices;
<a name="l09063"></a>09063         lAmount = lAmountRemaining;  <span class="comment">// So the caller, if this fails, sees how much he still needs to withdraw.</span>
<a name="l09064"></a>09064 
<a name="l09065"></a>09065         <span class="keywordflow">if</span> (0 == lAmountRemaining)
<a name="l09066"></a>09066         {
<a name="l09067"></a>09067             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l09068"></a>09068         }
<a name="l09069"></a>09069 
<a name="l09070"></a>09070         strIndices = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Since we&#39;re about to return false, and since we were finding the indices, we set them back to &quot;&quot; again.</span>
<a name="l09071"></a>09071     }
<a name="l09072"></a>09072 
<a name="l09073"></a>09073     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09074"></a>09074 }
<a name="l09075"></a>09075 
<a name="l09076"></a>09076 
<a name="l09077"></a><a class="code" href="class_o_t___command.html#ad27752d5c2d29d69139068aefde41fa7">09077</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#ad27752d5c2d29d69139068aefde41fa7">OT_Command::withdraw_and_send_cash</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keywordtype">string</span> &amp; strHisNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMemo, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAmount)
<a name="l09078"></a>09078 {
<a name="l09079"></a>09079     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;withdraw_and_send_cash&quot;</span>;
<a name="l09080"></a>09080 
<a name="l09081"></a>09081     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strHisNymID) || !<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount))
<a name="l09082"></a>09082     {
<a name="l09083"></a>09083         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: Missing one of: strMyAcctID (&quot;</span> + strMyAcctID + <span class="stringliteral">&quot;), strHisNymID (&quot;</span> + strHisNymID + <span class="stringliteral">&quot;), or strAmount (&quot;</span> + strAmount + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l09084"></a>09084         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09085"></a>09085     }
<a name="l09086"></a>09086 
<a name="l09087"></a>09087     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09088"></a>09088     <span class="comment">//</span>
<a name="l09089"></a>09089     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l09090"></a>09090 
<a name="l09091"></a>09091     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l09092"></a>09092     {
<a name="l09093"></a>09093         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: Unable to find NymID based on strMyAcctID (&quot;</span> + strMyAcctID + <span class="stringliteral">&quot;).\n&quot;</span>);
<a name="l09094"></a>09094         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09095"></a>09095     }
<a name="l09096"></a>09096 
<a name="l09097"></a>09097     <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09098"></a>09098     <span class="comment">//</span>
<a name="l09099"></a>09099     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l09100"></a>09100 
<a name="l09101"></a>09101     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l09102"></a>09102     {
<a name="l09103"></a>09103         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: Unable to find Server ID based on strMyAcctID (&quot;</span> + strMyAcctID + <span class="stringliteral">&quot;).\n&quot;</span>);
<a name="l09104"></a>09104         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09105"></a>09105     }
<a name="l09106"></a>09106 
<a name="l09107"></a>09107     <span class="keywordtype">string</span> strAssetTypeID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcctID);
<a name="l09108"></a>09108 
<a name="l09109"></a>09109     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID))
<a name="l09110"></a>09110     {
<a name="l09111"></a>09111         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Failure: Unable to find Asset Type ID based on strMyAcctID (&quot;</span> + strMyAcctID + <span class="stringliteral">&quot;).\n&quot;</span>);
<a name="l09112"></a>09112         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09113"></a>09113     }
<a name="l09114"></a>09114 
<a name="l09115"></a>09115     int64_t lAmount = int64_t(0);
<a name="l09116"></a>09116 
<a name="l09117"></a>09117     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount))
<a name="l09118"></a>09118     {
<a name="l09119"></a>09119         lAmount = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strAmount);
<a name="l09120"></a>09120     }
<a name="l09121"></a>09121 
<a name="l09122"></a>09122     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount) || (lAmount &lt;= 0))
<a name="l09123"></a>09123     {
<a name="l09124"></a>09124         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Invalid value: strAmount (&quot;</span> + strAmount + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l09125"></a>09125         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09126"></a>09126     }
<a name="l09127"></a>09127 
<a name="l09128"></a>09128     <span class="keywordtype">string</span> strTempMemo = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09129"></a>09129     <span class="keywordtype">string</span> strResponse = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09130"></a>09130     <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09131"></a>09131     <span class="keywordtype">bool</span> bPasswordProtected = <span class="keyword">false</span>;
<a name="l09132"></a>09132 
<a name="l09133"></a>09133     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo))
<a name="l09134"></a>09134     {
<a name="l09135"></a>09135         strTempMemo = strMemo;
<a name="l09136"></a>09136     }
<a name="l09137"></a>09137 
<a name="l09138"></a>09138     <span class="keywordflow">if</span> (1 == <a class="code" href="class_o_t___command.html#ad3592551d59a4de80537f546cd5bddb5">OT_Command::details_send_cash</a>(strResponse, strServerID, strAssetTypeID, strMyNymID, strMyAcctID, strHisNymID, strTempMemo, strAmount, strIndices, bPasswordProtected))
<a name="l09139"></a>09139     {
<a name="l09140"></a>09140         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l09141"></a>09141     }
<a name="l09142"></a>09142 
<a name="l09143"></a>09143     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l09144"></a>09144 }
<a name="l09145"></a>09145 
<a name="l09146"></a><a class="code" href="class_o_t___command.html#ad3592551d59a4de80537f546cd5bddb5">09146</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad3592551d59a4de80537f546cd5bddb5">OT_Command::details_send_cash</a>(<span class="keywordtype">string</span> &amp; strResponse, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAssetTypeID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keywordtype">string</span> &amp; strHisNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMemo, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strAmount, <span class="keywordtype">string</span> &amp; strIndices, <span class="keyword">const</span> <span class="keywordtype">bool</span> bPasswordProtected)
<a name="l09147"></a>09147 {
<a name="l09148"></a>09148 
<a name="l09149"></a>09149     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;\n details_send_cash&quot;</span>;
<a name="l09150"></a>09150 
<a name="l09151"></a>09151     int64_t lStartAmount = int64_t(0);
<a name="l09152"></a>09152 
<a name="l09153"></a>09153     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAmount))
<a name="l09154"></a>09154     {
<a name="l09155"></a>09155         lStartAmount = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strAmount);
<a name="l09156"></a>09156     }
<a name="l09157"></a>09157 
<a name="l09158"></a>09158     int64_t lAmount = lStartAmount;
<a name="l09159"></a>09159 
<a name="l09160"></a>09160     <span class="comment">// What we want to do from here is, see if we can send the cash purely using cash we already</span>
<a name="l09161"></a>09161     <span class="comment">// have in the local purse.</span>
<a name="l09162"></a>09162     <span class="comment">// If so, we just package it up and send it off using send_user_payment.</span>
<a name="l09163"></a>09163     <span class="comment">//</span>
<a name="l09164"></a>09164     <span class="comment">// But if we do NOT have the proper cash tokens in the local purse to send, then we need to</span>
<a name="l09165"></a>09165     <span class="comment">// withdraw enough tokens until we do, and then try sending again.</span>
<a name="l09166"></a>09166     <span class="comment">//</span>
<a name="l09167"></a>09167 
<a name="l09168"></a>09168     <span class="keywordtype">bool</span> bAmountFromIndices = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices);
<a name="l09169"></a>09169     <span class="keywordtype">bool</span> bIndicesFromAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount);
<a name="l09170"></a>09170 
<a name="l09171"></a>09171     <span class="keywordtype">bool</span> bGotData = <a class="code" href="class_o_t___command.html#a54b747884ee93502868637dda660f6a2">purse_get_indices_or_amount</a>(strServerID, strAssetTypeID, strMyNymID, lAmount, strIndices); <span class="comment">// If strIndices is input, lAmount is output. (And vice-versa.)</span>
<a name="l09172"></a>09172 
<a name="l09173"></a>09173     <span class="keywordflow">if</span> (!bGotData)  <span class="comment">// NOT ENOUGH CASH FOUND IN EXISTING PURSE TO MATCH THE AMOUNT (or indices were specified and not found.)</span>
<a name="l09174"></a>09174     {
<a name="l09175"></a>09175         <span class="keywordflow">if</span> (bAmountFromIndices)
<a name="l09176"></a>09176         {
<a name="l09177"></a>09177             <span class="comment">// If we were starting out with indices, and those indices failed to be found, then there&#39;s</span>
<a name="l09178"></a>09178             <span class="comment">// nothing more we can do. They aren&#39;t there.</span>
<a name="l09179"></a>09179             <span class="comment">//</span>
<a name="l09180"></a>09180             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Sorry, those indices weren&#39;t found: &quot;</span> + strIndices + <span class="stringliteral">&quot;\nPerhaps try: &#39;opentxs showpurse&#39;\n&quot;</span>);
<a name="l09181"></a>09181             <span class="keywordflow">return</span> -1;
<a name="l09182"></a>09182         }
<a name="l09183"></a>09183 
<a name="l09184"></a>09184         <span class="comment">// By this point, it means we started with the amount, and tried to use it to find the</span>
<a name="l09185"></a>09185         <span class="comment">// appropriate indices -- and they weren&#39;t there. This means we need to withdraw more cash</span>
<a name="l09186"></a>09186         <span class="comment">// from the server before we can send it, since we don&#39;t have enough in our purse already.</span>
<a name="l09187"></a>09187         <span class="comment">//</span>
<a name="l09188"></a>09188         int32_t nWithdraw = <a class="code" href="class_o_t___command.html#acc3f606cbc8020175e6750b0fc919907">details_withdraw_cash</a>(strMyAcctID, lAmount); <span class="comment">// By this point lAmount is only the remaining amount that wasn&#39;t found in the purse already.</span>
<a name="l09189"></a>09189 
<a name="l09190"></a>09190         <span class="keywordflow">if</span> (1 != nWithdraw)
<a name="l09191"></a>09191         {
<a name="l09192"></a>09192             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Tried to withdraw cash, but failed.\n&quot;</span>);
<a name="l09193"></a>09193             <span class="keywordflow">return</span> -1;
<a name="l09194"></a>09194         }
<a name="l09195"></a>09195 
<a name="l09196"></a>09196         <span class="comment">// Okay we performed the withdrawal, so now let&#39;s see again if we can extract the proper</span>
<a name="l09197"></a>09197         <span class="comment">// cash tokens from the local purse. We&#39;ll load it up again...</span>
<a name="l09198"></a>09198         <span class="comment">//</span>
<a name="l09199"></a>09199         lAmount = lStartAmount;
<a name="l09200"></a>09200 
<a name="l09201"></a>09201         bGotData = <a class="code" href="class_o_t___command.html#a54b747884ee93502868637dda660f6a2">purse_get_indices_or_amount</a>(strServerID, strAssetTypeID, strMyNymID, lAmount, strIndices); <span class="comment">// If strIndices is input, lAmount is output. (And vice-versa.)</span>
<a name="l09202"></a>09202 
<a name="l09203"></a>09203         <span class="keywordflow">if</span> (!bGotData)
<a name="l09204"></a>09204         {
<a name="l09205"></a>09205             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to get enough cash into the local purse to send, EVEN after performing a cash withdrawal. (Failure.)\n strIndices: &quot;</span> + strIndices + <span class="stringliteral">&quot; lAmount: &quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lAmount) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09206"></a>09206             <span class="keywordflow">return</span> -1;
<a name="l09207"></a>09207         }
<a name="l09208"></a>09208     }
<a name="l09209"></a>09209 
<a name="l09210"></a>09210     <span class="comment">// By this point, bGotData is definitely true, meaning there are already enough cash tokens in the purse</span>
<a name="l09211"></a>09211     <span class="comment">// to send, or there are now since performing a withdrawal. Either way, we should be good to go...</span>
<a name="l09212"></a>09212 
<a name="l09213"></a>09213     <span class="comment">// Returns the exported cash purse, with strRetainedCopy containing the sender&#39;s version of that.</span>
<a name="l09214"></a>09214     <span class="comment">//</span>
<a name="l09215"></a>09215     <span class="keywordtype">string</span> strRetainedCopy = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09216"></a>09216     <span class="keywordtype">string</span> strExportedCashPurse = <a class="code" href="class_o_t___command.html#a325e769bba225b859234d066e6fe8f42">details_export_cash</a>(strServerID, strMyNymID, strAssetTypeID, strHisNymID, strIndices, bPasswordProtected, strRetainedCopy);
<a name="l09217"></a>09217     int32_t nReturnVal = -1;
<a name="l09218"></a>09218 
<a name="l09219"></a>09219     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strExportedCashPurse))
<a name="l09220"></a>09220     {
<a name="l09221"></a>09221         strResponse = <a class="code" href="class_made_easy.html#ad87d5a00dc024a7e2f7fa0cac7e21f53">MadeEasy::send_user_cash</a>(strServerID, strMyNymID, strHisNymID, strExportedCashPurse, strRetainedCopy); <span class="comment">// &lt;==================</span>
<a name="l09222"></a>09222 
<a name="l09223"></a>09223         nReturnVal = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l09224"></a>09224 
<a name="l09225"></a>09225         <span class="keywordflow">if</span> (1 != nReturnVal)
<a name="l09226"></a>09226         {
<a name="l09227"></a>09227             <span class="comment">// It failed sending the cash to the recipient Nym.</span>
<a name="l09228"></a>09228             <span class="comment">// Re-import strRetainedCopy back into the sender&#39;s cash purse.</span>
<a name="l09229"></a>09229             <span class="comment">//</span>
<a name="l09230"></a>09230             <span class="keywordtype">bool</span> bImported = <a class="code" href="class_o_t_a_p_i___wrap.html#a94256b991cbfda07261cf037c7c13f0a" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Wrap::Wallet_ImportPurse</a>(strServerID, strAssetTypeID, strMyNymID, strRetainedCopy);
<a name="l09231"></a>09231 
<a name="l09232"></a>09232             <span class="keywordflow">if</span> (bImported)
<a name="l09233"></a>09233             {
<a name="l09234"></a>09234                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailed sending cash, but at least: success re-importing purse.\nServer: &quot;</span> + strServerID + <span class="stringliteral">&quot;\nAsset Type: &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot;\nNym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l09235"></a>09235             }
<a name="l09236"></a>09236             <span class="keywordflow">else</span>
<a name="l09237"></a>09237             {
<a name="l09238"></a>09238                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Failed sending cash AND failed re-importing purse.\nServer: &quot;</span> + strServerID + <span class="stringliteral">&quot;\nAsset Type: &quot;</span> + strAssetTypeID + <span class="stringliteral">&quot;\nNym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n\nPurse (SAVE THIS SOMEWHERE!):\n\n&quot;</span> + strRetainedCopy + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09239"></a>09239             }
<a name="l09240"></a>09240         }
<a name="l09241"></a>09241     }
<a name="l09242"></a>09242 
<a name="l09243"></a>09243 
<a name="l09244"></a>09244     <span class="keywordflow">return</span> nReturnVal;
<a name="l09245"></a>09245 }
<a name="l09246"></a>09246 
<a name="l09247"></a>09247 
<a name="l09248"></a><a class="code" href="class_o_t___command.html#ac4e381b16f0b8c763ff949ae883476f3">09248</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac4e381b16f0b8c763ff949ae883476f3">OT_Command::main_new_symmetric_key</a>()
<a name="l09249"></a>09249 {
<a name="l09250"></a>09250     <span class="keywordtype">string</span> strKey = <a class="code" href="class_o_t_a_p_i___wrap.html#a79ae4dd7040f5c8f358a27b1d15b67c5">OTAPI_Wrap::CreateSymmetricKey</a>();
<a name="l09251"></a>09251 
<a name="l09252"></a>09252     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strKey))
<a name="l09253"></a>09253     {
<a name="l09254"></a>09254         <span class="comment">// stderr</span>
<a name="l09255"></a>09255         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09256"></a>09256 
<a name="l09257"></a>09257         <span class="comment">// stdout</span>
<a name="l09258"></a>09258         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strKey);
<a name="l09259"></a>09259 
<a name="l09260"></a>09260         <span class="comment">// stderr</span>
<a name="l09261"></a>09261         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09262"></a>09262 
<a name="l09263"></a>09263         <span class="keywordflow">return</span> 1;
<a name="l09264"></a>09264     }
<a name="l09265"></a>09265 
<a name="l09266"></a>09266     <span class="comment">// &quot;return value&quot;</span>
<a name="l09267"></a>09267     <span class="keywordflow">return</span> -1;
<a name="l09268"></a>09268 }
<a name="l09269"></a>09269 
<a name="l09270"></a>09270 
<a name="l09271"></a>09271 <span class="comment">//case (&quot;CHEQUE&quot;)</span>
<a name="l09272"></a>09272 <span class="comment">//case (&quot;VOUCHER&quot;)</span>
<a name="l09273"></a>09273 <span class="comment">//case (&quot;INVOICE&quot;)</span>
<a name="l09274"></a>09274 <span class="comment">//case (&quot;PURSE&quot;)</span>
<a name="l09275"></a>09275 <span class="comment">//</span>
<a name="l09276"></a>09276 <span class="comment">// If one of the above types is passed in, then the payment will only be handled if the type matches.</span>
<a name="l09277"></a>09277 <span class="comment">//</span>
<a name="l09278"></a>09278 <span class="comment">// But if &quot;ANY&quot; is passed in, then the payment will be handled for any of them.</span>
<a name="l09279"></a>09279 <span class="comment">//</span>
<a name="l09280"></a>09280 
<a name="l09281"></a><a class="code" href="class_o_t___command.html#a02dd73ea961f323f8d3e99fe7dabe306">09281</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a02dd73ea961f323f8d3e99fe7dabe306">OT_Command::handle_payment_index</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPaymentType, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strInbox) <span class="comment">// (If nIndex is -1, then it will ask user to paste an invoice.)</span>
<a name="l09282"></a>09282 {
<a name="l09283"></a>09283     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctID) || !<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nIndex))
<a name="l09284"></a>09284     {
<a name="l09285"></a>09285         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Either strMyAcctID not a valid string, or nIndex not a valid int32_t.\n&quot;</span>);
<a name="l09286"></a>09286         <span class="keywordflow">return</span> -1;
<a name="l09287"></a>09287     }
<a name="l09288"></a>09288 
<a name="l09289"></a>09289     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09290"></a>09290     <span class="comment">//</span>
<a name="l09291"></a>09291     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l09292"></a>09292 
<a name="l09293"></a>09293     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l09294"></a>09294     {
<a name="l09295"></a>09295         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l09296"></a>09296         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l09297"></a>09297         <span class="keywordflow">return</span> -1;
<a name="l09298"></a>09298     }
<a name="l09299"></a>09299 
<a name="l09300"></a>09300     <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09301"></a>09301     <span class="comment">//</span>
<a name="l09302"></a>09302     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l09303"></a>09303 
<a name="l09304"></a>09304     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l09305"></a>09305     {
<a name="l09306"></a>09306         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l09307"></a>09307         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l09308"></a>09308         <span class="keywordflow">return</span> -1;
<a name="l09309"></a>09309     }
<a name="l09310"></a>09310     <span class="comment">// ***************************************************************</span>
<a name="l09311"></a>09311     <span class="keywordtype">string</span> strInstrument = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09312"></a>09312 
<a name="l09313"></a>09313     <span class="keywordflow">if</span> (-1 == nIndex) <span class="comment">// paste an instrument</span>
<a name="l09314"></a>09314     {
<a name="l09315"></a>09315         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please paste the instrument, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l09316"></a>09316 
<a name="l09317"></a>09317         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l09318"></a>09318         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l09319"></a>09319         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l09320"></a>09320         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l09321"></a>09321         <span class="comment">//</span>
<a name="l09322"></a>09322         strInstrument = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l09323"></a>09323 
<a name="l09324"></a>09324         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l09325"></a>09325         {
<a name="l09326"></a>09326             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, You must paste the instrument, in order to process it. Or, specify an index in the\npayments inbox using the option:  --args \&quot;index INDEX_OF_INVOICE\&quot;.\n\n&quot;</span>);
<a name="l09327"></a>09327             <span class="keywordflow">return</span> -1;
<a name="l09328"></a>09328         }
<a name="l09329"></a>09329     }
<a name="l09330"></a>09330 
<a name="l09331"></a>09331     <span class="keywordflow">else</span> <span class="comment">// Use an instrument from the payments inbox, since a valid index was provided.</span>
<a name="l09332"></a>09332     {
<a name="l09333"></a>09333         strInstrument = <a class="code" href="class_made_easy.html#a36be6514828e74506c8ef217b059d6cd">MadeEasy::get_payment_instrument</a>(strServerID, strMyNymID, nIndex, strInbox); <span class="comment">// strInbox is optional and avoids having to load it multiple times. This function will just load it itself, if it has to.</span>
<a name="l09334"></a>09334 
<a name="l09335"></a>09335         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l09336"></a>09336         {
<a name="l09337"></a>09337             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Unable to get payment instrument based on index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;.\n\n&quot;</span>);
<a name="l09338"></a>09338             <span class="keywordflow">return</span> -1;
<a name="l09339"></a>09339         }
<a name="l09340"></a>09340     }
<a name="l09341"></a>09341     <span class="comment">// ***************************************************************</span>
<a name="l09342"></a>09342     <span class="comment">// By this point, strInstrument is a valid string (whether we got it from the payments inbox,</span>
<a name="l09343"></a>09343     <span class="comment">// or whether we got it from stdin.)</span>
<a name="l09344"></a>09344     <span class="comment">//</span>
<a name="l09345"></a>09345     <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l09346"></a>09346 
<a name="l09347"></a>09347     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType))
<a name="l09348"></a>09348     {
<a name="l09349"></a>09349         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nFailure: Unable to determine strInstrument&#39;s type. Expected CHEQUE, VOUCHER, INVOICE, or (cash) PURSE.\n&quot;</span>);
<a name="l09350"></a>09350         <span class="keywordflow">return</span> -1;
<a name="l09351"></a>09351     }
<a name="l09352"></a>09352 
<a name="l09353"></a>09353     <span class="keywordtype">string</span> strIndexErrorMsg = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09354"></a>09354 
<a name="l09355"></a>09355     <span class="keywordflow">if</span> (-1 != nIndex)
<a name="l09356"></a>09356     {
<a name="l09357"></a>09357         strIndexErrorMsg = <span class="stringliteral">&quot;at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; &quot;</span>;
<a name="l09358"></a>09358     }
<a name="l09359"></a>09359 
<a name="l09360"></a>09360     <span class="comment">// If there&#39;s a payment type,</span>
<a name="l09361"></a>09361     <span class="comment">// and it&#39;s not &quot;ANY&quot;, and it&#39;s the wrong type,</span>
<a name="l09362"></a>09362     <span class="comment">// then skip this one.</span>
<a name="l09363"></a>09363     <span class="comment">//</span>
<a name="l09364"></a>09364     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPaymentType) &amp;&amp; (strPaymentType != <span class="stringliteral">&quot;ANY&quot;</span>) &amp;&amp; (strPaymentType != strType))
<a name="l09365"></a>09365     {
<a name="l09366"></a>09366         <span class="keywordflow">if</span> (((<span class="stringliteral">&quot;CHEQUE&quot;</span> == strPaymentType) &amp;&amp; (<span class="stringliteral">&quot;VOUCHER&quot;</span> == strType)) || ((<span class="stringliteral">&quot;VOUCHER&quot;</span> == strPaymentType) &amp;&amp; (<span class="stringliteral">&quot;CHEQUE&quot;</span> == strType)))
<a name="l09367"></a>09367         {
<a name="l09368"></a>09368             <span class="comment">// in this case we allow it to drop through.</span>
<a name="l09369"></a>09369         }
<a name="l09370"></a>09370         <span class="keywordflow">else</span>
<a name="l09371"></a>09371         {
<a name="l09372"></a>09372             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument &quot;</span> + strIndexErrorMsg + <span class="stringliteral">&quot;is not a &quot;</span> + strPaymentType + <span class="stringliteral">&quot;. (It&#39;s a &quot;</span> + strType + <span class="stringliteral">&quot;. Skipping.)\n&quot;</span>);
<a name="l09373"></a>09373             <span class="keywordflow">return</span> -1;
<a name="l09374"></a>09374         }
<a name="l09375"></a>09375     }
<a name="l09376"></a>09376 
<a name="l09377"></a>09377     <span class="comment">// Note: I USED to check the ASSET TYPE ID here, but then I removed it, since</span>
<a name="l09378"></a>09378     <span class="comment">// details_deposit_cheque() already verifies that (so I don&#39;t need to do it twice.)</span>
<a name="l09379"></a>09379     <span class="comment">//</span>
<a name="l09380"></a>09380     <span class="comment">//  string strInstrumentAssetType  = OTAPI_Wrap::Instrmnt_GetAssetID(strInstrument)</span>
<a name="l09381"></a>09381     <span class="comment">//  string strAccountAssetID       = OTAPI_Wrap::GetAccountWallet_AssetTypeID(strMyAcctID)</span>
<a name="l09382"></a>09382     <span class="comment">//</span>
<a name="l09383"></a>09383     <span class="comment">//  if (strInstrumentAssetType != strAccountAssetID)</span>
<a name="l09384"></a>09384     <span class="comment">//  {</span>
<a name="l09385"></a>09385     <span class="comment">//      OTAPI_Wrap::Output(0, &quot;The instrument&#39;s asset type (&quot;+strInstrumentAssetType+&quot;) doesn&#39;t match the account&#39;s asset type (&quot;+strAccountAssetID+&quot;).\nTry specifying a different account using --myacct ACCT_ID\n&quot;);</span>
<a name="l09386"></a>09386     <span class="comment">//      return -1;</span>
<a name="l09387"></a>09387     <span class="comment">//; }</span>
<a name="l09388"></a>09388 
<a name="l09389"></a>09389     <span class="comment">// By this point, we know the invoice has the right asset type for the account</span>
<a name="l09390"></a>09390     <span class="comment">// we&#39;re trying to use (to pay it from.)</span>
<a name="l09391"></a>09391     <span class="comment">//</span>
<a name="l09392"></a>09392     <span class="comment">// But we need to make sure the invoice is made out to strMyNymID (or to no one.)</span>
<a name="l09393"></a>09393     <span class="comment">// Because if it IS endorsed to a Nym, and strMyNymID is NOT that nym, then the</span>
<a name="l09394"></a>09394     <span class="comment">// transaction will fail. So let&#39;s check, before we bother sending it...</span>
<a name="l09395"></a>09395     <span class="comment">//</span>
<a name="l09396"></a>09396     <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strInstrument);
<a name="l09397"></a>09397 
<a name="l09398"></a>09398     <span class="comment">// Not all instruments have a specified recipient. But if they do, let&#39;s make</span>
<a name="l09399"></a>09399     <span class="comment">// sure the Nym matches.</span>
<a name="l09400"></a>09400     <span class="comment">//</span>
<a name="l09401"></a>09401     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecipientUserID) &amp;&amp; (strRecipientUserID != strMyNymID))
<a name="l09402"></a>09402     {
<a name="l09403"></a>09403         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument &quot;</span> + strIndexErrorMsg + <span class="stringliteral">&quot;is endorsed to a specific recipient (&quot;</span> + strRecipientUserID + <span class="stringliteral">&quot;) and that doesn&#39;t match the account&#39;s owner Nym (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;). (Skipping.)\nTry specifying a different account, using --myacct ACCT_ID \n&quot;</span>);
<a name="l09404"></a>09404         <span class="keywordflow">return</span> -1;
<a name="l09405"></a>09405     }
<a name="l09406"></a>09406 
<a name="l09407"></a>09407     <span class="comment">// At this point I know the invoice isn&#39;t made out to anyone, or if it is, it&#39;s properly</span>
<a name="l09408"></a>09408     <span class="comment">// made out to the owner of the account which I&#39;m trying to use to pay the invoice from.</span>
<a name="l09409"></a>09409     <span class="comment">// So let&#39;s pay it!  P.S. strRecipientUserID might be NULL, but strMyNymID is guaranteed</span>
<a name="l09410"></a>09410     <span class="comment">// to be good.</span>
<a name="l09411"></a>09411 
<a name="l09412"></a>09412     <span class="comment">//  string strPayeeUserID    = OTAPI_Wrap::Instrmnt_GetSenderUserID    (strInstrument)</span>
<a name="l09413"></a>09413     <span class="comment">//  string strPayeeAcctID    = OTAPI_Wrap::Instrmnt_GetSenderAcctID    (strInstrument)</span>
<a name="l09414"></a>09414 
<a name="l09415"></a>09415     <span class="comment">//</span>
<a name="l09416"></a>09416     <span class="keywordtype">string</span> strInstrumentAssetType = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strInstrument);
<a name="l09417"></a>09417     <span class="keywordtype">string</span> strAccountAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strMyAcctID);
<a name="l09418"></a>09418 
<a name="l09419"></a>09419     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrumentAssetType) &amp;&amp; (strAccountAssetID != strInstrumentAssetType))
<a name="l09420"></a>09420     {
<a name="l09421"></a>09421         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; has a different asset type than the selected account. (Skipping.)\nTry specifying a different account, using --myacct ACCT_ID \n&quot;</span>);
<a name="l09422"></a>09422         <span class="keywordflow">return</span> -1;
<a name="l09423"></a>09423     }
<a name="l09424"></a>09424 
<a name="l09425"></a>09425     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tFrom = <a class="code" href="class_o_t_a_p_i___wrap.html#ab5001f7251cfad8bbf7dd81e42892c8d">OTAPI_Wrap::Instrmnt_GetValidFrom</a>(strInstrument);
<a name="l09426"></a>09426     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tTo = <a class="code" href="class_o_t_a_p_i___wrap.html#ae45fee7bad36b1d653c13cc58c94bbe7">OTAPI_Wrap::Instrmnt_GetValidTo</a>(strInstrument);
<a name="l09427"></a>09427     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tTime = <a class="code" href="class_o_t_a_p_i___wrap.html#abf13a18a258717c8e92bb7b28f368a1c">OTAPI_Wrap::GetTime</a>();
<a name="l09428"></a>09428 
<a name="l09429"></a>09429     <span class="keywordflow">if</span> (tTime &lt; tFrom)
<a name="l09430"></a>09430     {
<a name="l09431"></a>09431         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; is not yet within its valid date range. (Skipping.)\n&quot;</span>);
<a name="l09432"></a>09432         <span class="keywordflow">return</span> -1;
<a name="l09433"></a>09433     }
<a name="l09434"></a>09434     <span class="keywordflow">if</span> ((tTo &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>) &amp;&amp; (tTime &gt; tTo))
<a name="l09435"></a>09435     {
<a name="l09436"></a>09436         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The instrument at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; is expired. (Moving it to the record box.)\n&quot;</span>);
<a name="l09437"></a>09437 
<a name="l09438"></a>09438         <span class="comment">// Since this instrument is expired, remove it from the payments inbox, and move to record box.</span>
<a name="l09439"></a>09439 
<a name="l09440"></a>09440         <span class="comment">// Note: this harvests</span>
<a name="l09441"></a>09441         <span class="keywordflow">if</span> ((nIndex &gt;= 0) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(strServerID, strMyNymID, <span class="keyword">true</span>, <span class="comment">// bIsInbox = true;</span>
<a name="l09442"></a>09442             nIndex, <span class="keyword">true</span>)) <span class="comment">// bSaveCopy = true. (Since it&#39;s expired, it&#39;ll go into the expired box.)</span>
<a name="l09443"></a>09443         {
<a name="l09444"></a>09444             <span class="keywordflow">return</span> 0;
<a name="l09445"></a>09445         }
<a name="l09446"></a>09446 
<a name="l09447"></a>09447         <span class="keywordflow">return</span> -1;
<a name="l09448"></a>09448     }
<a name="l09449"></a>09449 
<a name="l09450"></a>09450     <span class="comment">// TODO, IMPORTANT: After the below deposits are completed successfully, the wallet</span>
<a name="l09451"></a>09451     <span class="comment">// will receive a &quot;successful deposit&quot; server reply. When that happens, OT (internally)</span>
<a name="l09452"></a>09452     <span class="comment">// needs to go and see if the deposited item was a payment in the payments inbox. If so,</span>
<a name="l09453"></a>09453     <span class="comment">// it should REMOVE it from that box and move it to the record box.</span>
<a name="l09454"></a>09454     <span class="comment">//</span>
<a name="l09455"></a>09455     <span class="comment">// That&#39;s why you don&#39;t see me messing with the payments inbox even when these are successful.</span>
<a name="l09456"></a>09456     <span class="comment">// They DO need to be removed from the payments inbox, but just not here in the script. (Rather,</span>
<a name="l09457"></a>09457     <span class="comment">// internally by OT itself.)</span>
<a name="l09458"></a>09458     <span class="comment">//</span>
<a name="l09459"></a>09459     <span class="keywordflow">if</span> (<span class="stringliteral">&quot;CHEQUE&quot;</span> == strType)
<a name="l09460"></a>09460     {
<a name="l09461"></a>09461         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strMyNymID, strInstrument, strType);
<a name="l09462"></a>09462     }
<a name="l09463"></a>09463     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;VOUCHER&quot;</span> == strType)
<a name="l09464"></a>09464     {
<a name="l09465"></a>09465         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strMyNymID, strInstrument, strType);
<a name="l09466"></a>09466     }
<a name="l09467"></a>09467     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;INVOICE&quot;</span> == strType)
<a name="l09468"></a>09468     {
<a name="l09469"></a>09469         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab076b431998b65f232aacf29b1de8e8a">details_deposit_cheque</a>(strServerID, strMyAcctID, strMyNymID, strInstrument, strType);
<a name="l09470"></a>09470     }
<a name="l09471"></a>09471     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;PURSE&quot;</span> == strType)
<a name="l09472"></a>09472     {
<a name="l09473"></a>09473         int32_t nDepositPurse = <a class="code" href="class_o_t___command.html#a8dd89a72d6da42df034c8a6bfe7950cf">details_deposit_purse</a>(strServerID, strMyAcctID, strMyNymID, strInstrument, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// strIndices is left blank in this case</span>
<a name="l09474"></a>09474 
<a name="l09475"></a>09475         <span class="comment">// if nIndex !=  -1, go ahead and call RecordPayment on the purse at that index, to</span>
<a name="l09476"></a>09476         <span class="comment">// remove it from payments inbox and move it to the recordbox.</span>
<a name="l09477"></a>09477         <span class="comment">//</span>
<a name="l09478"></a>09478         <span class="keywordflow">if</span> ((nIndex != -1) &amp;&amp; (1 == nDepositPurse))
<a name="l09479"></a>09479         {
<a name="l09480"></a>09480             int32_t nRecorded = <a class="code" href="class_o_t_a_p_i___wrap.html#a8668bf22000481440e41f0681149c13e">OTAPI_Wrap::RecordPayment</a>(strServerID, strMyNymID, <span class="keyword">true</span>, <span class="comment">//bIsInbox=true</span>
<a name="l09481"></a>09481                 nIndex, <span class="keyword">true</span>); <span class="comment">// bSaveCopy=true.</span>
<a name="l09482"></a>09482         }
<a name="l09483"></a>09483 
<a name="l09484"></a>09484         <span class="keywordflow">return</span> nDepositPurse;
<a name="l09485"></a>09485     }
<a name="l09486"></a>09486     <span class="keywordflow">else</span>
<a name="l09487"></a>09487     {
<a name="l09488"></a>09488         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSkipping this instrument: Expected CHEQUE, VOUCHER, INVOICE, or (cash) PURSE.\n&quot;</span>);
<a name="l09489"></a>09489     }
<a name="l09490"></a>09490 
<a name="l09491"></a>09491     <span class="keywordflow">return</span> -1;
<a name="l09492"></a>09492 }
<a name="l09493"></a>09493 
<a name="l09494"></a>09494 
<a name="l09495"></a>09495 <span class="comment">/*</span>
<a name="l09496"></a>09496 <span class="comment">EXPORT static std::string NumList_Add (const std::string &amp; strNumList, const std::string &amp; strNumbers);</span>
<a name="l09497"></a>09497 <span class="comment">EXPORT static std::string NumList_Remove (const std::string &amp; strNumList, const std::string &amp; strNumbers);</span>
<a name="l09498"></a>09498 <span class="comment">EXPORT static bool NumList_VerifyQuery(const std::string &amp; strNumList, const std::string &amp; strNumbers); // returns OT_BOOL</span>
<a name="l09499"></a>09499 <span class="comment">EXPORT static bool NumList_VerifyAll (const std::string &amp; strNumList, const std::string &amp; strNumbers); // returns OT_BOOL</span>
<a name="l09500"></a>09500 <span class="comment">EXPORT static int32_t NumList_Count (const std::string &amp; strNumList);</span>
<a name="l09501"></a>09501 <span class="comment">*/</span>
<a name="l09502"></a>09502 
<a name="l09503"></a>09503 
<a name="l09504"></a>09504 <span class="comment">// COULD have been named &quot;details_accept_specific_instruments_of_specific_types_from_the_payment_inbox.&quot;</span>
<a name="l09505"></a><a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">09505</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">OT_Command::accept_from_paymentbox</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strPaymentType)
<a name="l09506"></a>09506 {
<a name="l09507"></a>09507     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyAcctID))
<a name="l09508"></a>09508     {
<a name="l09509"></a>09509         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: strMyAcctID not a valid string.\n&quot;</span>);
<a name="l09510"></a>09510         <span class="keywordflow">return</span> -1;
<a name="l09511"></a>09511     }
<a name="l09512"></a>09512 
<a name="l09513"></a>09513     <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09514"></a>09514     <span class="comment">//</span>
<a name="l09515"></a>09515     <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(strMyAcctID);
<a name="l09516"></a>09516 
<a name="l09517"></a>09517     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l09518"></a>09518     {
<a name="l09519"></a>09519         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l09520"></a>09520         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l09521"></a>09521         <span class="keywordflow">return</span> -1;
<a name="l09522"></a>09522     }
<a name="l09523"></a>09523 
<a name="l09524"></a>09524     <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l09525"></a>09525     <span class="comment">//</span>
<a name="l09526"></a>09526     <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(strMyAcctID);
<a name="l09527"></a>09527 
<a name="l09528"></a>09528     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l09529"></a>09529     {
<a name="l09530"></a>09530         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l09531"></a>09531         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l09532"></a>09532         <span class="keywordflow">return</span> -1;
<a name="l09533"></a>09533     }
<a name="l09534"></a>09534     <span class="comment">// ******************************************************************</span>
<a name="l09535"></a>09535     <span class="comment">//</span>
<a name="l09536"></a>09536     <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a7e785f8c3a9ad9257c9e251b438a6087">OTAPI_Wrap::LoadPaymentInbox</a>(strServerID, strMyNymID); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l09537"></a>09537 
<a name="l09538"></a>09538     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l09539"></a>09539     {
<a name="l09540"></a>09540         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n accept_from_paymentbox:  OT_API_LoadPaymentInbox Failed.\n\n&quot;</span>);
<a name="l09541"></a>09541         <span class="keywordflow">return</span> -1;
<a name="l09542"></a>09542     }
<a name="l09543"></a>09543 
<a name="l09544"></a>09544     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, strMyNymID, strInbox);
<a name="l09545"></a>09545     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l09546"></a>09546     {
<a name="l09547"></a>09547         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Unable to retrieve size of payments inbox ledger. (Failure.)\n&quot;</span>);
<a name="l09548"></a>09548         <span class="keywordflow">return</span> -1;
<a name="l09549"></a>09549     }
<a name="l09550"></a>09550 
<a name="l09551"></a>09551     int32_t nIndicesCount = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices) : 0;
<a name="l09552"></a>09552 
<a name="l09553"></a>09553     <span class="comment">// Either we loop through all the instruments and accept them all, or</span>
<a name="l09554"></a>09554     <span class="comment">// we loop through all the instruments and accept the specified indices.</span>
<a name="l09555"></a>09555     <span class="comment">//</span>
<a name="l09556"></a>09556     <span class="comment">// (But either way, we loop through all the instruments.)</span>
<a name="l09557"></a>09557     <span class="comment">//</span>
<a name="l09558"></a>09558     <span class="keywordflow">for</span> (int32_t nIndex = (nCount - 1); nIndex &gt;= 0; --nIndex) <span class="comment">// Loop from back to front, so if any are removed, the indices remain accurate subsequently.</span>
<a name="l09559"></a>09559     {
<a name="l09560"></a>09560         <span class="keywordtype">bool</span> bContinue = <span class="keyword">false</span>;
<a name="l09561"></a>09561 
<a name="l09562"></a>09562         <span class="comment">// - If indices are specified, but the current index is not on</span>
<a name="l09563"></a>09563         <span class="comment">//   that list, then continue...</span>
<a name="l09564"></a>09564         <span class="comment">//</span>
<a name="l09565"></a>09565         <span class="comment">// - If NO indices are specified, accept all the ones matching MyAcct&#39;s asset type.</span>
<a name="l09566"></a>09566         <span class="comment">//</span>
<a name="l09567"></a>09567         <span class="keywordflow">if</span> ((nIndicesCount &gt; 0) &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex)))
<a name="l09568"></a>09568         {
<a name="l09569"></a>09569             <span class="comment">//          continue  // apparently not supported by the language.</span>
<a name="l09570"></a>09570             bContinue = <span class="keyword">true</span>;
<a name="l09571"></a>09571         }
<a name="l09572"></a>09572 
<a name="l09573"></a>09573         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!bContinue)
<a name="l09574"></a>09574         {
<a name="l09575"></a>09575             int32_t nHandled = <a class="code" href="class_o_t___command.html#a02dd73ea961f323f8d3e99fe7dabe306">handle_payment_index</a>(strMyAcctID, nIndex, strPaymentType, strInbox);
<a name="l09576"></a>09576         }
<a name="l09577"></a>09577     }
<a name="l09578"></a>09578 
<a name="l09579"></a>09579     <span class="keywordflow">return</span> 1;
<a name="l09580"></a>09580 }
<a name="l09581"></a>09581 
<a name="l09582"></a>09582 
<a name="l09583"></a>09583 <span class="comment">// strIndices == &quot;&quot; when you want to loop through all accounts and accept all invoices for them.</span>
<a name="l09584"></a><a class="code" href="class_o_t___command.html#a5f6ff8226d0552294282776ca28865f5">09584</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a5f6ff8226d0552294282776ca28865f5">OT_Command::details_accept_invoices</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l09585"></a>09585 {
<a name="l09586"></a>09586     <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(strMyAcctID, strIndices, <span class="stringliteral">&quot;INVOICE&quot;</span>);
<a name="l09587"></a>09587 }
<a name="l09588"></a>09588 
<a name="l09589"></a>09589 
<a name="l09590"></a><a class="code" href="class_o_t___command.html#a9f071586dd5dcee2de9348942e40817e">09590</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a9f071586dd5dcee2de9348942e40817e">OT_Command::main_accept_invoices</a>()
<a name="l09591"></a>09591 {
<a name="l09592"></a>09592     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  acceptinvoices --myacct FROM_ACCT --args \&quot;indices 3,6,8\&quot;  \n (Sample indices are shown.)\n&quot;</span>;
<a name="l09593"></a>09593     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;The invoice and myacct must both have same asset type. If indices\nare not specified for the payments inbox, &quot;</span>;
<a name="l09594"></a>09594     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;then OT will pay ALL invoices in it\nthat have the same asset type as MyAcct.\n\n&quot;</span>;
<a name="l09595"></a>09595 
<a name="l09596"></a>09596     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l09597"></a>09597 
<a name="l09598"></a>09598     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l09599"></a>09599     {
<a name="l09600"></a>09600         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09601"></a>09601 
<a name="l09602"></a>09602         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l09603"></a>09603         {
<a name="l09604"></a>09604             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l09605"></a>09605             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l09606"></a>09606             <span class="comment">//</span>
<a name="l09607"></a>09607             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l09608"></a>09608         }
<a name="l09609"></a>09609 
<a name="l09610"></a>09610         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a5f6ff8226d0552294282776ca28865f5">details_accept_invoices</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices);
<a name="l09611"></a>09611     }
<a name="l09612"></a>09612 
<a name="l09613"></a>09613     <span class="keywordflow">return</span> -1;
<a name="l09614"></a>09614 }
<a name="l09615"></a>09615 
<a name="l09616"></a>09616 
<a name="l09617"></a>09617 <span class="comment">// strIndices == &quot;&quot; to accept all incoming &quot;payments&quot; from the payments inbox. (NOT Invoices.)</span>
<a name="l09618"></a><a class="code" href="class_o_t___command.html#a72e5f07b01ce714b0579b3c0f43ecb3b">09618</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a72e5f07b01ce714b0579b3c0f43ecb3b">OT_Command::details_accept_payments</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l09619"></a>09619 {
<a name="l09620"></a>09620 
<a name="l09621"></a>09621     int32_t nAcceptedPurses = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(strMyAcctID, strIndices, <span class="stringliteral">&quot;PURSE&quot;</span>);
<a name="l09622"></a>09622     <span class="comment">// Voucher is already interpreted as a form of cheque, so this is redundant.</span>
<a name="l09623"></a>09623     <span class="comment">//</span>
<a name="l09624"></a>09624     <span class="comment">//  int32_t nAcceptedVouchers = accept_from_paymentbox(strMyAcctID, strIndices, &quot;VOUCHER&quot;)</span>
<a name="l09625"></a>09625     int32_t nAcceptedCheques = <a class="code" href="class_o_t___command.html#a3f513dad3fb5cb0b8dd8825ccc81302e">accept_from_paymentbox</a>(strMyAcctID, strIndices, <span class="stringliteral">&quot;CHEQUE&quot;</span>);
<a name="l09626"></a>09626 
<a name="l09627"></a>09627     <span class="comment">// Note: NOT invoices.</span>
<a name="l09628"></a>09628 
<a name="l09629"></a>09629     <span class="comment">// If all two calls succeed, then the total here is 2.</span>
<a name="l09630"></a>09630     <span class="comment">// So we return success as well (1).</span>
<a name="l09631"></a>09631     <span class="comment">//</span>
<a name="l09632"></a>09632     <span class="keywordflow">if</span> ((nAcceptedPurses &gt; -1) || (nAcceptedCheques &gt; -1))
<a name="l09633"></a>09633     {
<a name="l09634"></a>09634         <span class="keywordflow">return</span> 1;
<a name="l09635"></a>09635     }
<a name="l09636"></a>09636 
<a name="l09637"></a>09637     <span class="keywordflow">return</span> -1;
<a name="l09638"></a>09638 
<a name="l09639"></a>09639 }
<a name="l09640"></a>09640 
<a name="l09641"></a>09641 
<a name="l09642"></a><a class="code" href="class_o_t___command.html#acfe6b34f016440b23ea8b254b8d86890">09642</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acfe6b34f016440b23ea8b254b8d86890">OT_Command::main_accept_payments</a>()
<a name="l09643"></a>09643 {
<a name="l09644"></a>09644     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  acceptpayments --myacct INTO_ACCT --args \&quot;indices 3,6,8\&quot;  \n (Sample indices are shown.)\n&quot;</span>;
<a name="l09645"></a>09645     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;The payment instrument and myacct must both have same asset type. If indices\nare not specified for the payments inbox, &quot;</span>;
<a name="l09646"></a>09646     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;then OT will accept ALL payment\ninstruments in it that have the same asset type as MyAcct.\n\n&quot;</span>;
<a name="l09647"></a>09647 
<a name="l09648"></a>09648     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l09649"></a>09649 
<a name="l09650"></a>09650     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l09651"></a>09651     {
<a name="l09652"></a>09652         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l09653"></a>09653 
<a name="l09654"></a>09654         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l09655"></a>09655         {
<a name="l09656"></a>09656             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l09657"></a>09657             <span class="comment">// EXAMPLE:  --args &quot;indices 4,6,9&quot;</span>
<a name="l09658"></a>09658             <span class="comment">//</span>
<a name="l09659"></a>09659             strIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l09660"></a>09660         }
<a name="l09661"></a>09661 
<a name="l09662"></a>09662         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#a72e5f07b01ce714b0579b3c0f43ecb3b">details_accept_payments</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strIndices);
<a name="l09663"></a>09663     }
<a name="l09664"></a>09664 
<a name="l09665"></a>09665     <span class="keywordflow">return</span> -1;
<a name="l09666"></a>09666 }
<a name="l09667"></a>09667 
<a name="l09668"></a>09668 
<a name="l09669"></a>09669 <span class="comment">// Pay an invoice</span>
<a name="l09670"></a>09670 <span class="comment">//</span>
<a name="l09671"></a><a class="code" href="class_o_t___command.html#a9e67271cb742fc096848d66d39502e14">09671</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a9e67271cb742fc096848d66d39502e14">OT_Command::main_payinvoice</a>()
<a name="l09672"></a>09672 {
<a name="l09673"></a>09673     <span class="keywordtype">string</span> strUsage1 = <span class="stringliteral">&quot;\nUsage:  payinvoice --myacct FROM_ACCT --args \&quot;index INVOICE_INDEX\&quot; \n&quot;</span>;
<a name="l09674"></a>09674     <span class="keywordtype">string</span> strUsage2 = <span class="stringliteral">&quot;The invoice and myacct must both have same asset type. If an index is not\n&quot;</span>;
<a name="l09675"></a>09675     <span class="keywordtype">string</span> strUsage = strUsage1 + strUsage2 + <span class="stringliteral">&quot;specified for the payments inbox, then OT will ask you to paste an invoice.\n\n&quot;</span>;
<a name="l09676"></a>09676 
<a name="l09677"></a>09677     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l09678"></a>09678 
<a name="l09679"></a>09679     <span class="comment">//</span>
<a name="l09680"></a>09680     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l09681"></a>09681     {
<a name="l09682"></a>09682         <span class="keywordflow">return</span> -1;
<a name="l09683"></a>09683     }
<a name="l09684"></a>09684     <span class="comment">// ***************************************************************</span>
<a name="l09685"></a>09685     int32_t nIndex = -1;
<a name="l09686"></a>09686 
<a name="l09687"></a>09687     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l09688"></a>09688     {
<a name="l09689"></a>09689         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l09690"></a>09690         <span class="comment">//                                  const std::string str_key)</span>
<a name="l09691"></a>09691         <span class="comment">//</span>
<a name="l09692"></a>09692         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l09693"></a>09693         <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l09694"></a>09694         <span class="comment">//</span>
<a name="l09695"></a>09695         <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>); <span class="comment">// any integer value</span>
<a name="l09696"></a>09696 
<a name="l09697"></a>09697         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l09698"></a>09698         {
<a name="l09699"></a>09699             int32_t nTempIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l09700"></a>09700 
<a name="l09701"></a>09701             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTempIndex) &amp;&amp; (nTempIndex &gt;= 0))
<a name="l09702"></a>09702             {
<a name="l09703"></a>09703                 nIndex = nTempIndex;
<a name="l09704"></a>09704             }
<a name="l09705"></a>09705         }
<a name="l09706"></a>09706     }
<a name="l09707"></a>09707     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l09708"></a>09708     <span class="comment">// ***************************************************************</span>
<a name="l09709"></a>09709     <span class="comment">//</span>
<a name="l09710"></a>09710     int32_t nPaidInvoice = <a class="code" href="class_o_t___command.html#a02dd73ea961f323f8d3e99fe7dabe306">handle_payment_index</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, nIndex, <span class="stringliteral">&quot;INVOICE&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l09711"></a>09711 
<a name="l09712"></a>09712     <span class="keywordflow">if</span> (1 == nPaidInvoice) <span class="comment">// Success!  (Therefore, remove from payments inbox, and move to record box.)</span>
<a name="l09713"></a>09713     {
<a name="l09714"></a>09714         <span class="comment">// Should I bother moving the invoice from the payments inbox to the record box?</span>
<a name="l09715"></a>09715         <span class="comment">//</span>
<a name="l09716"></a>09716         <span class="comment">// Update: Okay for now, I&#39;m using an API call here (RecordPayment) which moves the invoice.</span>
<a name="l09717"></a>09717         <span class="comment">// HOWEVER, in the int64_t term, we don&#39;t want to do it here. Rather, we want to do it inside OT while</span>
<a name="l09718"></a>09718         <span class="comment">// it&#39;s processesing the server reply for your cheque (invoice) deposit. For example what if there&#39;s</span>
<a name="l09719"></a>09719         <span class="comment">// a network problem and we don&#39;t process that reply here now? There&#39;ll still be a copy of the reply</span>
<a name="l09720"></a>09720         <span class="comment">// in the Nymbox and it will still get processed at a future time... and THAT&#39;s when we need to move</span>
<a name="l09721"></a>09721         <span class="comment">// the record, not here. (But this is what we&#39;ll do for now.)</span>
<a name="l09722"></a>09722         <span class="comment">//</span>
<a name="l09723"></a>09723         <span class="comment">// OTAPI_Wrap::RecordPayment(const OTIdentifier &amp; SERVER_ID,</span>
<a name="l09724"></a>09724         <span class="comment">//                              const OTIdentifier &amp; USER_ID,</span>
<a name="l09725"></a>09725         <span class="comment">//                              bool bIsInbox, // true == payments inbox. false == payments outbox.</span>
<a name="l09726"></a>09726         <span class="comment">//                              int32_t  nIndex)   // removes payment instrument (from payments in or out box) and moves to record box.</span>
<a name="l09727"></a>09727         <span class="comment">//        if (!OTAPI_Wrap::RecordPayment(strServerID, strMyNymID, ))   {; }</span>
<a name="l09728"></a>09728         <span class="comment">//</span>
<a name="l09729"></a>09729 
<a name="l09730"></a>09730         <span class="comment">// UPDATE:</span>
<a name="l09731"></a>09731         <span class="comment">/*</span>
<a name="l09732"></a>09732 <span class="comment">        - In my Payments Inbox, there could be a cheque or invoice. Either way, when I deposit the cheque or</span>
<a name="l09733"></a>09733 <span class="comment">        pay the invoice, the chequeReceipt goes back to the signer&#39;s asset account&#39;s inbox.</span>
<a name="l09734"></a>09734 <span class="comment">        - When he accepts the chequeReceipt (during a processInbox) and WHEN HE GETS THE &quot;SUCCESS&quot; REPLY to that</span>
<a name="l09735"></a>09735 <span class="comment">        processInbox, is when the chequeReceipt should be moved from his inbox to his record box. It MUST be</span>
<a name="l09736"></a>09736 <span class="comment">        done then, inside OT, because the next time he downloads the inbox from the server, that chequeReceipt</span>
<a name="l09737"></a>09737 <span class="comment">        won&#39;t be in there anymore! It&#39;ll be too late to pass it on to the records.</span>
<a name="l09738"></a>09738 <span class="comment">        - Whereas I, being the recipient of his cheque, had it in my **payments inbox,** and thus upon receipt</span>
<a name="l09739"></a>09739 <span class="comment">        of a successful server-reply to my deposit transaction, need to move it from my payments inbox to my</span>
<a name="l09740"></a>09740 <span class="comment">        record box. (The record box will eventually be a callback so that client software can take over that</span>
<a name="l09741"></a>09741 <span class="comment">        functionality, which is outside the scope of OT. The actual CALL to store in the record box, however</span>
<a name="l09742"></a>09742 <span class="comment">        should occur inside OT.)</span>
<a name="l09743"></a>09743 <span class="comment">        - For now, I&#39;m using the below API call, so it&#39;s available inside the scripts. This is &quot;good enough&quot;</span>
<a name="l09744"></a>09744 <span class="comment">        for now, just to get the payments inbox/outbox working for the scripts. But in the int64_t term, I&#39;ll need</span>
<a name="l09745"></a>09745 <span class="comment">        to add the hooks directly into OT as described just above. (It&#39;ll be necessary in order to get the record</span>
<a name="l09746"></a>09746 <span class="comment">        box working.)</span>
<a name="l09747"></a>09747 <span class="comment">        - Since I&#39;m only worried about Payments Inbox for now, and since I&#39;ll be calling the below function</span>
<a name="l09748"></a>09748 <span class="comment">        directly from inside the scripts, how will this work? Incoming cheque or invoice will be in the payments</span>
<a name="l09749"></a>09749 <span class="comment">        inbox, and will need to be moved to recordBox (below call) when the script receives a success reply to</span>
<a name="l09750"></a>09750 <span class="comment">        the depositing/paying of that cheque/invoice.</span>
<a name="l09751"></a>09751 <span class="comment">        - Whereas outoing cheque/invoice is in the Outpayments box, (fundamentally more similar to the outmail</span>
<a name="l09752"></a>09752 <span class="comment">        box than to the payments inbox.) If the cheque/invoice is cashed/paid by the endorsee, **I** will receive</span>
<a name="l09753"></a>09753 <span class="comment">        the chequeReceipt, in MY asset account inbox, and when I accept it during a processInbox transaction,</span>
<a name="l09754"></a>09754 <span class="comment">        the SUCCESS REPLY from the server for that processInbox is where I should actually process that chequeReceipt</span>
<a name="l09755"></a>09755 <span class="comment">        and, if it appears in the outpayments box, move it at that time to the record box. The problem is, I can NOT</span>
<a name="l09756"></a>09756 <span class="comment">        do this much inside the script. To do this part, I thus HAVE to go into OT itself as I just described.</span>
<a name="l09757"></a>09757 <span class="comment">        - Fuck!</span>
<a name="l09758"></a>09758 <span class="comment">        - Therefore I might as well comment this out, since this simply isn&#39;t going to work.</span>
<a name="l09759"></a>09759 <span class="comment"></span>
<a name="l09760"></a>09760 <span class="comment">        - Updated plan:</span>
<a name="l09761"></a>09761 <span class="comment">        1. DONE: Inside OT, when processing successful server reply to processInbox request, if a chequeReceipt</span>
<a name="l09762"></a>09762 <span class="comment">        was processed out successfully, and if that chequeReceipt is found inside the outpayments, then</span>
<a name="l09763"></a>09763 <span class="comment">        move it at that time to the record box.</span>
<a name="l09764"></a>09764 <span class="comment">        2. DONE: Inside OT, when processing successful server reply to depositCheque request, if that cheque is</span>
<a name="l09765"></a>09765 <span class="comment">        found inside the Payments Inbox, move it to the record box.</span>
<a name="l09766"></a>09766 <span class="comment">        3. As for cash:</span>
<a name="l09767"></a>09767 <span class="comment">        If I SENT cash, it will be in my outpayments box. But that&#39;s wrong. Because I can</span>
<a name="l09768"></a>09768 <span class="comment">        never see if the guy cashed it or not. Therefore it should go straight to the record box, when</span>
<a name="l09769"></a>09769 <span class="comment">        sent. AND it needs to be encrypted to MY key, not his -- so need to generate BOTH versions, when</span>
<a name="l09770"></a>09770 <span class="comment">        exporting the purse to him in the FIRST PLACE. Then my version goes straight into my record box and</span>
<a name="l09771"></a>09771 <span class="comment">        I can delete it at my leisure. (If he comes running the next day saying &quot;I lost it!!&quot; I can still</span>
<a name="l09772"></a>09772 <span class="comment">        recover it. But once he deposits it, then the cash will be no good and I might as well archive it</span>
<a name="l09773"></a>09773 <span class="comment">        or destroy it, or whatever I choose to do with my personal records.)</span>
<a name="l09774"></a>09774 <span class="comment">        If I RECEIVED cash, it will be in my payments inbox, and then when I deposit it, and when I process</span>
<a name="l09775"></a>09775 <span class="comment">        the SUCCESSFUL server REPLY to my depositCash request, it should be moved to my record Box.</span>
<a name="l09776"></a>09776 <span class="comment">        4. How about vouchers? If I deposit a voucher, then the &quot;original sender&quot; should get some sort of</span>
<a name="l09777"></a>09777 <span class="comment">        notice. This means attaching his ID to the voucher--which should be optional--and then dropping an</span>
<a name="l09778"></a>09778 <span class="comment">        &quot;FYI&quot; notice to him when it gets deposited. It can&#39;t be a normal chequeReceipt because that&#39;s used</span>
<a name="l09779"></a>09779 <span class="comment">        to verify the balance agreement against a balance change, whereas a &quot;voucher receipt&quot; wouldn&#39;t represent</span>
<a name="l09780"></a>09780 <span class="comment">        a balance change at all, since the balance was already changed when you originally bought the voucher.</span>
<a name="l09781"></a>09781 <span class="comment">        Instead it would probably be send to your Nymbox but it COULD NOT BE PROVEN that it was, since OT currently</span>
<a name="l09782"></a>09782 <span class="comment">        can&#39;t prove NOTICE!!</span>
<a name="l09783"></a>09783 <span class="comment"></span>
<a name="l09784"></a>09784 <span class="comment">        All of the above needs to happen inside OT, since there are many plances where it&#39;s the only appropriate</span>
<a name="l09785"></a>09785 <span class="comment">        place to take the necessary action. (Script cannot.)</span>
<a name="l09786"></a>09786 <span class="comment">        */</span>
<a name="l09787"></a>09787 
<a name="l09788"></a>09788         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;\n Success paying invoice!\n\n&quot;</span>);
<a name="l09789"></a>09789 
<a name="l09790"></a>09790         <span class="keywordflow">return</span> 1;
<a name="l09791"></a>09791     }
<a name="l09792"></a>09792 
<a name="l09793"></a>09793 
<a name="l09794"></a>09794     <span class="keywordflow">return</span> -1;
<a name="l09795"></a>09795 }
<a name="l09796"></a>09796 
<a name="l09797"></a>09797 
<a name="l09798"></a><a class="code" href="ot__commands__ot_8cpp.html#a18eed831558991be382382a5580fef71">09798</a> vector&lt;string&gt; <a class="code" href="ot__commands__ot_8cpp.html#a18eed831558991be382382a5580fef71">tokenize</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; str, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; delimiters, <span class="keyword">const</span> <span class="keywordtype">bool</span> trimEmpty)
<a name="l09799"></a>09799 {
<a name="l09800"></a>09800     int32_t pos = 0;
<a name="l09801"></a>09801     int32_t lastPos = 0;
<a name="l09802"></a>09802     vector&lt;string&gt; tokens;
<a name="l09803"></a>09803 
<a name="l09804"></a>09804     <span class="keywordflow">while</span> (<span class="keyword">true</span>)
<a name="l09805"></a>09805     {
<a name="l09806"></a>09806         pos = str.find_first_of(delimiters, lastPos);
<a name="l09807"></a>09807 
<a name="l09808"></a>09808         <span class="keywordflow">if</span> (-1 == pos)
<a name="l09809"></a>09809         {
<a name="l09810"></a>09810             pos = str.size();
<a name="l09811"></a>09811 
<a name="l09812"></a>09812             <span class="keywordflow">if</span> (pos != lastPos || !trimEmpty)
<a name="l09813"></a>09813             {
<a name="l09814"></a>09814                 tokens.push_back(str.substr(lastPos, pos - lastPos));
<a name="l09815"></a>09815             }
<a name="l09816"></a>09816             <span class="keywordflow">break</span>;
<a name="l09817"></a>09817         }
<a name="l09818"></a>09818         <span class="keywordflow">else</span>
<a name="l09819"></a>09819         {
<a name="l09820"></a>09820             <span class="keywordflow">if</span> (pos != lastPos || !trimEmpty)
<a name="l09821"></a>09821             {
<a name="l09822"></a>09822                 tokens.push_back(str.substr(lastPos, pos - lastPos));
<a name="l09823"></a>09823             }
<a name="l09824"></a>09824         }
<a name="l09825"></a>09825 
<a name="l09826"></a>09826         lastPos = pos + 1;
<a name="l09827"></a>09827     }
<a name="l09828"></a>09828     <span class="keywordflow">return</span> tokens;
<a name="l09829"></a>09829 }
<a name="l09830"></a>09830 
<a name="l09831"></a>09831 
<a name="l09832"></a>09832 
<a name="l09833"></a>09833 <span class="comment">// Show the active cron item IDs, or the details of one by ID.</span>
<a name="l09834"></a>09834 <span class="comment">//</span>
<a name="l09835"></a><a class="code" href="class_o_t___command.html#a22ce2b26b040bf8236a8f480b223ee01">09835</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a22ce2b26b040bf8236a8f480b223ee01">OT_Command::main_show_active</a>()
<a name="l09836"></a>09836 {
<a name="l09837"></a>09837     <span class="keywordtype">string</span> strUsage =
<a name="l09838"></a>09838         <span class="stringliteral">&quot;\nUsage:  showactive --server SERVER_ID --mynym NYM_ID   (To display a list of IDs.)\n&quot;</span>
<a name="l09839"></a>09839         <span class="stringliteral">&quot;OR:     showactive --server SERVER_ID --args \&quot;id TRANSACTION_ID\&quot;\n&quot;</span>
<a name="l09840"></a>09840         <span class="stringliteral">&quot;\nLists the transaction numbers of currently active payment plans\n&quot;</span>
<a name="l09841"></a>09841         <span class="stringliteral">&quot;and smart contracts. Also useful for displaying contents by ID.\n\n&quot;</span>;
<a name="l09842"></a>09842 
<a name="l09843"></a>09843     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l09844"></a>09844     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l09845"></a>09845     <span class="comment">//</span>
<a name="l09846"></a>09846     int64_t lTransNum = 0;
<a name="l09847"></a>09847     <span class="keywordtype">bool</span> bDetailMode = <span class="keyword">false</span>;
<a name="l09848"></a>09848 
<a name="l09849"></a>09849     <span class="keywordtype">string</span> strError =
<a name="l09850"></a>09850         <span class="stringliteral">&quot;\nPlease provide either:  --mynym NYM_ID   (to view a list of active transactions)\n&quot;</span>
<a name="l09851"></a>09851         <span class="stringliteral">&quot;or, to view details for a specific transaction, use --args \&quot;id TRANSACTION_ID\&quot; \n\n&quot;</span>;
<a name="l09852"></a>09852 
<a name="l09853"></a>09853     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l09854"></a>09854     {
<a name="l09855"></a>09855         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l09856"></a>09856         {
<a name="l09857"></a>09857             <span class="keywordtype">string</span> strTransNum = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;id&quot;</span>); <span class="comment">// transaction number.</span>
<a name="l09858"></a>09858             <span class="comment">// -----------------------------</span>
<a name="l09859"></a>09859             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransNum))
<a name="l09860"></a>09860             {
<a name="l09861"></a>09861                 lTransNum = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strTransNum);
<a name="l09862"></a>09862 
<a name="l09863"></a>09863                 <span class="keywordflow">if</span> (lTransNum &gt; 0)
<a name="l09864"></a>09864                 {
<a name="l09865"></a>09865                     bDetailMode = <span class="keyword">true</span>;
<a name="l09866"></a>09866                 }
<a name="l09867"></a>09867                 <span class="keywordflow">else</span>
<a name="l09868"></a>09868                 {
<a name="l09869"></a>09869                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Missing argument (1): &quot;</span> + strError);
<a name="l09870"></a>09870                     <span class="keywordflow">return</span> -1;
<a name="l09871"></a>09871                 }
<a name="l09872"></a>09872             }
<a name="l09873"></a>09873         }
<a name="l09874"></a>09874         <span class="comment">// -----------------------------</span>
<a name="l09875"></a>09875         <span class="keywordflow">if</span> (!bDetailMode &amp;&amp; !<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l09876"></a>09876         {
<a name="l09877"></a>09877             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Missing argument (2): &quot;</span> + strError);
<a name="l09878"></a>09878             <span class="keywordflow">return</span> -1;
<a name="l09879"></a>09879         }
<a name="l09880"></a>09880         <span class="comment">// -----------------------------</span>
<a name="l09881"></a>09881         <span class="comment">// By this point, we know for a fact that either MyNym was supplied, and thus we need to display a list</span>
<a name="l09882"></a>09882         <span class="comment">// of active transactions for the given nym/server, or otherwise, bDetailMode will be true, and lTransNum</span>
<a name="l09883"></a>09883         <span class="comment">// contains a greater-than-zero value in int64_t form, in which case, we need to display the details</span>
<a name="l09884"></a>09884         <span class="comment">// of that cron item.</span>
<a name="l09885"></a>09885         <span class="comment">//</span>
<a name="l09886"></a>09886         <span class="comment">// ***************************************************************</span>
<a name="l09887"></a>09887 
<a name="l09888"></a>09888         <span class="keywordflow">if</span> (bDetailMode)
<a name="l09889"></a>09889         {
<a name="l09890"></a>09890             <span class="keywordtype">string</span> strCronItem = <a class="code" href="class_o_t_a_p_i___wrap.html#a79295a83d562dcf9ed2e0d5ccf00a45c">OTAPI_Wrap::GetActiveCronItem</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, lTransNum);
<a name="l09891"></a>09891 
<a name="l09892"></a>09892             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCronItem))
<a name="l09893"></a>09893             {
<a name="l09894"></a>09894                 <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strCronItem);
<a name="l09895"></a>09895 
<a name="l09896"></a>09896                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType))
<a name="l09897"></a>09897                 {
<a name="l09898"></a>09898                     strType = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l09899"></a>09899                 }
<a name="l09900"></a>09900 
<a name="l09901"></a>09901                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Found an active transaction!\n&quot;</span>);
<a name="l09902"></a>09902                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;ID: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransNum) + <span class="stringliteral">&quot;  Type: &quot;</span> + strType + <span class="stringliteral">&quot;\n\nContents:\n\n&quot;</span>);
<a name="l09903"></a>09903 
<a name="l09904"></a>09904                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strCronItem);
<a name="l09905"></a>09905 
<a name="l09906"></a>09906                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09907"></a>09907             }
<a name="l09908"></a>09908         }
<a name="l09909"></a>09909         <span class="keywordflow">else</span>
<a name="l09910"></a>09910         {
<a name="l09911"></a>09911             <span class="keywordtype">string</span> strIDs = <a class="code" href="class_o_t_a_p_i___wrap.html#a768706db9281bb63ae3cd263f54a7592">OTAPI_Wrap::GetNym_ActiveCronItemIDs</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>);
<a name="l09912"></a>09912 
<a name="l09913"></a>09913             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIDs) &amp;&amp; <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIDs) &gt; 0)
<a name="l09914"></a>09914             {
<a name="l09915"></a>09915                 vector&lt;string&gt; vecIDs = <a class="code" href="ot__commands__ot_8cpp.html#a18eed831558991be382382a5580fef71">tokenize</a>(strIDs, <span class="stringliteral">&quot;,&quot;</span>, <span class="keyword">true</span>);
<a name="l09916"></a>09916 
<a name="l09917"></a>09917                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> nIndex = 0; nIndex &lt; vecIDs.size(); ++nIndex)
<a name="l09918"></a>09918                 {
<a name="l09919"></a>09919                     <span class="keywordtype">string</span> strTransNum = vecIDs[nIndex];
<a name="l09920"></a>09920                     <span class="comment">// -----------------------------</span>
<a name="l09921"></a>09921                     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTransNum))
<a name="l09922"></a>09922                     {
<a name="l09923"></a>09923                         lTransNum = <a class="code" href="ot__otapi__ot_8hpp.html#a3f53de93e1ad98eec0cb7638440a74db">to_long</a>(strTransNum);
<a name="l09924"></a>09924 
<a name="l09925"></a>09925                         <span class="keywordflow">if</span> (lTransNum &gt; 0)
<a name="l09926"></a>09926                         {
<a name="l09927"></a>09927                             <span class="keywordtype">string</span> strCronItem = <a class="code" href="class_o_t_a_p_i___wrap.html#a79295a83d562dcf9ed2e0d5ccf00a45c">OTAPI_Wrap::GetActiveCronItem</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, lTransNum);
<a name="l09928"></a>09928 
<a name="l09929"></a>09929                             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strCronItem))
<a name="l09930"></a>09930                             {
<a name="l09931"></a>09931                                 <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strCronItem);;
<a name="l09932"></a>09932 
<a name="l09933"></a>09933                                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strType))
<a name="l09934"></a>09934                                 {
<a name="l09935"></a>09935                                     strType = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l09936"></a>09936                                 }
<a name="l09937"></a>09937                                 <span class="comment">// ----------------------------------</span>
<a name="l09938"></a>09938                                 <span class="keywordflow">if</span> (0 == nIndex)
<a name="l09939"></a>09939                                 {
<a name="l09940"></a>09940                                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Found &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(vecIDs.size()) + <span class="stringliteral">&quot; active transactions:\n\n&quot;</span>);
<a name="l09941"></a>09941                                 }
<a name="l09942"></a>09942                                 <span class="comment">// ----------------------------------</span>
<a name="l09943"></a>09943                                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;ID: &quot;</span> + strTransNum + <span class="stringliteral">&quot;  Type: &quot;</span> + strType + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09944"></a>09944                             }
<a name="l09945"></a>09945                         }
<a name="l09946"></a>09946                     }
<a name="l09947"></a>09947                 } <span class="comment">// for</span>
<a name="l09948"></a>09948                 <span class="comment">// -----------------------------------</span>
<a name="l09949"></a>09949                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09950"></a>09950             }
<a name="l09951"></a>09951             <span class="keywordflow">else</span>
<a name="l09952"></a>09952             {
<a name="l09953"></a>09953                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nFound no active transactions. Perhaps try &#39;opentxs refresh&#39; first?\n&quot;</span>);
<a name="l09954"></a>09954             }
<a name="l09955"></a>09955         } <span class="comment">// list mode (not detail mode.)</span>
<a name="l09956"></a>09956         <span class="comment">// -----------------------------------</span>
<a name="l09957"></a>09957         <span class="keywordflow">return</span> 1;
<a name="l09958"></a>09958 
<a name="l09959"></a>09959     } <span class="comment">// if (VerifyExists(&quot;Server&quot;))</span>
<a name="l09960"></a>09960     <span class="comment">// -------------------</span>
<a name="l09961"></a>09961     <span class="keywordflow">return</span> -1;
<a name="l09962"></a>09962 }
<a name="l09963"></a>09963 
<a name="l09964"></a>09964 
<a name="l09965"></a>09965 <span class="comment">// Show an individual payment in detail.</span>
<a name="l09966"></a>09966 <span class="comment">//</span>
<a name="l09967"></a><a class="code" href="class_o_t___command.html#ac59baae921d8c4617f3bfadc81f1e596">09967</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac59baae921d8c4617f3bfadc81f1e596">OT_Command::main_show_payment</a>()
<a name="l09968"></a>09968 {
<a name="l09969"></a>09969     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;\nUsage:  showpayment --args \&quot;index PAYMENT_INDEX showmemo true|false\&quot;\n Default index is 0. Default showmemo is false.\n&quot;</span>;
<a name="l09970"></a>09970 
<a name="l09971"></a>09971     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l09972"></a>09972 
<a name="l09973"></a>09973     <span class="comment">// SHOW a payment from the PAYMENTS INBOX</span>
<a name="l09974"></a>09974     <span class="comment">//</span>
<a name="l09975"></a>09975     <span class="comment">// Load an asset account&#39;s payments inbox from local storage and display it on the screen.</span>
<a name="l09976"></a>09976     <span class="comment">//</span>
<a name="l09977"></a>09977 
<a name="l09978"></a>09978     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>))
<a name="l09979"></a>09979     {
<a name="l09980"></a>09980 
<a name="l09981"></a>09981         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l09982"></a>09982         <span class="comment">//                                  const std::string str_key)</span>
<a name="l09983"></a>09983         <span class="comment">//</span>
<a name="l09984"></a>09984         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l09985"></a>09985         <span class="comment">// EXAMPLE:  --args &quot;index 1&quot;</span>
<a name="l09986"></a>09986         <span class="comment">//</span>
<a name="l09987"></a>09987         <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>); <span class="comment">// any integer value</span>
<a name="l09988"></a>09988         <span class="keywordtype">string</span> strShowLargeMemo = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;showmemo&quot;</span>); <span class="comment">// any integer value</span>
<a name="l09989"></a>09989         int32_t nIndex = 0;
<a name="l09990"></a>09990         <span class="keywordtype">bool</span> bShowLargeMemo = <span class="keyword">false</span>;  <span class="comment">// Memos aren&#39;t normally shown if they contain a newline. But you can force them to show anyway.</span>
<a name="l09991"></a>09991 
<a name="l09992"></a>09992         <span class="comment">// Set the values based on the custom arguments, for those found.</span>
<a name="l09993"></a>09993         <span class="comment">//</span>
<a name="l09994"></a>09994         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strShowLargeMemo) &amp;&amp; (<span class="stringliteral">&quot;true&quot;</span> == strShowLargeMemo))
<a name="l09995"></a>09995         {
<a name="l09996"></a>09996             bShowLargeMemo = <span class="keyword">true</span>; <span class="comment">// now we&#39;ll show the memo even if it spans multiple lines.</span>
<a name="l09997"></a>09997         }
<a name="l09998"></a>09998 
<a name="l09999"></a>09999         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l10000"></a>10000         {
<a name="l10001"></a>10001             int32_t nTempIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l10002"></a>10002 
<a name="l10003"></a>10003             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nTempIndex) &amp;&amp; (nTempIndex &gt;= 0))
<a name="l10004"></a>10004             {
<a name="l10005"></a>10005                 nIndex = nTempIndex;
<a name="l10006"></a>10006             }
<a name="l10007"></a>10007         }
<a name="l10008"></a>10008         <span class="comment">// ***************************************************************</span>
<a name="l10009"></a>10009 
<a name="l10010"></a>10010         <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a7e785f8c3a9ad9257c9e251b438a6087">OTAPI_Wrap::LoadPaymentInbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l10011"></a>10011 
<a name="l10012"></a>10012         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l10013"></a>10013         {
<a name="l10014"></a>10014             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n OT_API_LoadPaymentInbox: Failed.\n\n&quot;</span>);
<a name="l10015"></a>10015             <span class="keywordflow">return</span> -1;
<a name="l10016"></a>10016         }
<a name="l10017"></a>10017         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l10018"></a>10018         {
<a name="l10019"></a>10019             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10020"></a>10020             <span class="comment">//          print(strInbox)          // stdout</span>
<a name="l10021"></a>10021 
<a name="l10022"></a>10022             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox);
<a name="l10023"></a>10023             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10024"></a>10024             {
<a name="l10025"></a>10025                 <span class="keywordflow">if</span> (nIndex &gt; (nCount - 1))
<a name="l10026"></a>10026                 {
<a name="l10027"></a>10027                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Index out of bounds. (There are &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCount) + <span class="stringliteral">&quot; indices, starting at 0.\n&quot;</span>);
<a name="l10028"></a>10028                     <span class="keywordflow">return</span> -1;
<a name="l10029"></a>10029                 }
<a name="l10030"></a>10030 
<a name="l10031"></a>10031                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Ind  Amt   Type       Txn#   Memo\n&quot;</span>);
<a name="l10032"></a>10032                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------\n&quot;</span>);
<a name="l10033"></a>10033 
<a name="l10034"></a>10034                 <span class="keywordtype">string</span> strInstrument = <a class="code" href="class_o_t_a_p_i___wrap.html#ae1bf653075e809afe55a82a2513d2958">OTAPI_Wrap::Ledger_GetInstrument</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10035"></a>10035 
<a name="l10036"></a>10036                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l10037"></a>10037                 {
<a name="l10038"></a>10038                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed trying to get payment instrument from payments box.\n&quot;</span>);
<a name="l10039"></a>10039                     <span class="keywordflow">return</span> -1;
<a name="l10040"></a>10040                 }
<a name="l10041"></a>10041 
<a name="l10042"></a>10042                 <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10043"></a>10043                 int64_t lTransNumber = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10044"></a>10044 
<a name="l10045"></a>10045                 int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strTrans);
<a name="l10046"></a>10046 
<a name="l10047"></a>10047                 int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2db31aab9857deb6907204e388b1a8b4">OTAPI_Wrap::Instrmnt_GetAmount</a>(strInstrument);
<a name="l10048"></a>10048                 <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l10049"></a>10049                 <span class="keywordtype">string</span> strAssetType = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strInstrument);  <span class="comment">// todo: output this.</span>
<a name="l10050"></a>10050                 <span class="keywordtype">string</span> strMemo = <a class="code" href="class_o_t_a_p_i___wrap.html#ab2ae137ad0c6b697aefc2c3deaba3d04">OTAPI_Wrap::Instrmnt_GetMemo</a>(strInstrument);
<a name="l10051"></a>10051                 <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strInstrument);
<a name="l10052"></a>10052                 <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae7c2873a9439b938209438311652007e">OTAPI_Wrap::Instrmnt_GetSenderAcctID</a>(strInstrument);
<a name="l10053"></a>10053                 <span class="keywordtype">string</span> strRemitterUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#ab58799407be4d434d10ecd8def911685">OTAPI_Wrap::Instrmnt_GetRemitterUserID</a>(strInstrument);
<a name="l10054"></a>10054                 <span class="keywordtype">string</span> strRemitterAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a55a51b033a66ea943e52aa1185e690c6">OTAPI_Wrap::Instrmnt_GetRemitterAcctID</a>(strInstrument);
<a name="l10055"></a>10055                 <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strInstrument);
<a name="l10056"></a>10056                 <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#acdae4292ddffbea5ae32908f3587f98f">OTAPI_Wrap::Instrmnt_GetRecipientAcctID</a>(strInstrument);
<a name="l10057"></a>10057 
<a name="l10058"></a>10058                 <span class="keywordtype">string</span> strUserID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRemitterUserID) ? strRemitterUserID : strSenderUserID;
<a name="l10059"></a>10059                 <span class="keywordtype">string</span> strAcctID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRemitterAcctID) ? strRemitterAcctID : strSenderAcctID;
<a name="l10060"></a>10060 
<a name="l10061"></a>10061                 <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10062"></a>10062                 <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10063"></a>10063                 <span class="keywordtype">bool</span> bAssetIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetType);
<a name="l10064"></a>10064                 <span class="keywordtype">bool</span> bMemoExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMemo);
<a name="l10065"></a>10065 
<a name="l10066"></a>10066                 <span class="keywordtype">bool</span> bHasAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount);
<a name="l10067"></a>10067 
<a name="l10068"></a>10068 
<a name="l10069"></a>10069                 <span class="keywordflow">if</span> (bMemoExists &amp;&amp; (strMemo.find(<span class="stringliteral">&quot;\n&quot;</span>) != string::npos) &amp;&amp; !bShowLargeMemo)
<a name="l10070"></a>10070                 {
<a name="l10071"></a>10071                     strMemo = <span class="stringliteral">&quot;&lt;too large to display here&gt;&quot;</span>;
<a name="l10072"></a>10072                 }
<a name="l10073"></a>10073                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bMemoExists)
<a name="l10074"></a>10074                 {
<a name="l10075"></a>10075                     <span class="keywordtype">string</span> strTempMemo = <span class="stringliteral">&quot;\&quot;&quot;</span> + strMemo + <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l10076"></a>10076                     strMemo = strTempMemo;
<a name="l10077"></a>10077                 }
<a name="l10078"></a>10078 
<a name="l10079"></a>10079                 <span class="keywordtype">string</span> strNewlineSeparator = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10080"></a>10080 
<a name="l10081"></a>10081                 <span class="keywordflow">if</span> (bUserIDExists || bAcctIDExists)
<a name="l10082"></a>10082                 {
<a name="l10083"></a>10083                     strNewlineSeparator = <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l10084"></a>10084                 }
<a name="l10085"></a>10085 
<a name="l10086"></a>10086                 <span class="keywordtype">string</span> strSeparator = (!bUserIDExists &amp;&amp; !bAcctIDExists &amp;&amp; !bAssetIDExists) ? <span class="stringliteral">&quot;&quot;</span> : strNewlineSeparator;
<a name="l10087"></a>10087 
<a name="l10088"></a>10088                 <span class="comment">// Set up some symbols to appear or not,</span>
<a name="l10089"></a>10089                 <span class="comment">// based on whether there is something to show.</span>
<a name="l10090"></a>10090                 <span class="comment">//</span>
<a name="l10091"></a>10091                 <span class="keywordtype">string</span> strUserDenoter = (bUserIDExists ? <span class="stringliteral">&quot;U:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10092"></a>10092                 <span class="keywordtype">string</span> strUserDenoter2 = (bUserIDExists ? <span class="stringliteral">&quot; - &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10093"></a>10093                 <span class="keywordtype">string</span> strAcctDenoter = (bAcctIDExists ? <span class="stringliteral">&quot;A:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10094"></a>10094                 <span class="keywordtype">string</span> strAcctDenoter2 = (bAcctIDExists ? <span class="stringliteral">&quot; - &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10095"></a>10095                 <span class="keywordtype">string</span> strAssetDenoter = (bAssetIDExists ? <span class="stringliteral">&quot;T:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10096"></a>10096                 <span class="keywordtype">string</span> strAssetDenoter2 = (bAssetIDExists ? <span class="stringliteral">&quot; - &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10097"></a>10097 
<a name="l10098"></a>10098                 <span class="comment">// If we have the user/acct/asset ID, then get the associated name (if that exists.)</span>
<a name="l10099"></a>10099                 <span class="comment">//</span>
<a name="l10100"></a>10100                 <span class="keywordtype">string</span> strUserName = (bUserIDExists ? (<span class="stringliteral">&quot;\&quot;&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strUserID) + <span class="stringliteral">&quot;\&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10101"></a>10101                 <span class="keywordtype">string</span> strAcctName = (bAcctIDExists ? (<span class="stringliteral">&quot;\&quot;&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a18999957d285b958c3f683d3460a0b3f">OTAPI_Wrap::GetAccountWallet_Name</a>(strAcctID) + <span class="stringliteral">&quot;\&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10102"></a>10102                 <span class="keywordtype">string</span> strAssetName = (bAssetIDExists ? (<span class="stringliteral">&quot;\&quot;&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAssetType) + <span class="stringliteral">&quot;\&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10103"></a>10103 
<a name="l10104"></a>10104                 <span class="comment">// Just making sure here that if the string wasn&#39;t there, that it&#39;s set to</span>
<a name="l10105"></a>10105                 <span class="comment">// a proper empty string, instead of a null or a &quot;not a value&quot; value.</span>
<a name="l10106"></a>10106                 <span class="comment">//</span>
<a name="l10107"></a>10107                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserName))      { strUserName = <span class="stringliteral">&quot;&quot;</span>; strUserDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10108"></a>10108                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctName))      { strAcctName = <span class="stringliteral">&quot;&quot;</span>; strAcctDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10109"></a>10109                 <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetName))     { strAssetName = <span class="stringliteral">&quot;&quot;</span>; strAssetDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10110"></a>10110 
<a name="l10111"></a>10111                 <span class="keywordflow">if</span> (<span class="stringliteral">&quot;\&quot;\&quot;&quot;</span> == strUserName)              { strUserName = <span class="stringliteral">&quot;&quot;</span>; strUserDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10112"></a>10112                 <span class="keywordflow">if</span> (<span class="stringliteral">&quot;\&quot;\&quot;&quot;</span> == strAcctName)              { strAcctName = <span class="stringliteral">&quot;&quot;</span>; strAcctDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10113"></a>10113                 <span class="keywordflow">if</span> (<span class="stringliteral">&quot;\&quot;\&quot;&quot;</span> == strAssetName)             { strAssetName = <span class="stringliteral">&quot;&quot;</span>; strAssetDenoter2 = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10114"></a>10114 
<a name="l10115"></a>10115                 <span class="keywordtype">string</span> strOut1 = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>;
<a name="l10116"></a>10116 
<a name="l10117"></a>10117                 <span class="keywordtype">string</span> strOut2 = <span class="stringliteral">&quot;      &quot;</span>;
<a name="l10118"></a>10118 
<a name="l10119"></a>10119                 <span class="keywordflow">if</span> (bAssetIDExists &amp;&amp; bHasAmount)
<a name="l10120"></a>10120                 {
<a name="l10121"></a>10121                     strOut2 = <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetType, lAmount) + (<a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetType, lAmount).size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>);
<a name="l10122"></a>10122                 }
<a name="l10123"></a>10123 
<a name="l10124"></a>10124                 <span class="keywordtype">string</span> strOut3 = strType;
<a name="l10125"></a>10125                 <span class="keywordtype">string</span> strOut4 = strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>;
<a name="l10126"></a>10126                 <span class="keywordtype">string</span> strOut5 = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransNumber) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransNumber).size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>);
<a name="l10127"></a>10127                 <span class="keywordtype">string</span> strOut6 = (bMemoExists ? (strMemo) : <span class="stringliteral">&quot;&quot;</span>) + <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l10128"></a>10128                 <span class="keywordtype">string</span> strOut7 = strUserDenoter + strUserID + strUserDenoter2 + strUserName + strSeparator;
<a name="l10129"></a>10129                 <span class="keywordtype">string</span> strOut8 = strAcctDenoter + strAcctID + strAcctDenoter2 + strAcctName + strSeparator;
<a name="l10130"></a>10130                 <span class="keywordtype">string</span> strOut9 = strAssetDenoter + strAssetType + strAssetDenoter2 + strAssetName;
<a name="l10131"></a>10131 
<a name="l10132"></a>10132                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOut1 + strOut2 + strOut3 + strOut4 + strOut5 + strOut6 + strOut7 + strOut8 + strOut9);
<a name="l10133"></a>10133 
<a name="l10134"></a>10134                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Instrument:\n&quot;</span> + strInstrument);
<a name="l10135"></a>10135 
<a name="l10136"></a>10136             } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10137"></a>10137 
<a name="l10138"></a>10138             <span class="comment">//          OTAPI_Wrap::Output(0, &quot;\n\n&quot;) // stderr</span>
<a name="l10139"></a>10139             <span class="keywordflow">return</span> 1;
<a name="l10140"></a>10140         }
<a name="l10141"></a>10141     }
<a name="l10142"></a>10142     <span class="keywordflow">return</span> -1;
<a name="l10143"></a>10143 }
<a name="l10144"></a>10144 
<a name="l10145"></a>10145 
<a name="l10146"></a><a class="code" href="class_o_t___command.html#a73f052fb32b4391bfd321166f26ea057">10146</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a73f052fb32b4391bfd321166f26ea057">OT_Command::main_show_incoming</a>()
<a name="l10147"></a>10147 {
<a name="l10148"></a>10148     int32_t nShowPayments = -1;
<a name="l10149"></a>10149     int32_t nShowInbox = -1;
<a name="l10150"></a>10150 
<a name="l10151"></a>10151     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>))
<a name="l10152"></a>10152     {
<a name="l10153"></a>10153         nShowInbox = <a class="code" href="class_o_t___command.html#a7e9e17d9349c69322ddea8cbc7b986b1">OT_Command::main_show_inbox</a>();
<a name="l10154"></a>10154     }
<a name="l10155"></a>10155     <span class="keywordflow">else</span>
<a name="l10156"></a>10156     {
<a name="l10157"></a>10157         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try adding --myacct ASSET_ACCT_ID   (to see the asset account&#39;s inbox.)\n&quot;</span>);
<a name="l10158"></a>10158     }
<a name="l10159"></a>10159 
<a name="l10160"></a>10160     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>))
<a name="l10161"></a>10161     {
<a name="l10162"></a>10162         nShowPayments = <a class="code" href="class_o_t___command.html#afa3a8da44e9bbc956f4cc313aa88f83a">OT_Command::main_show_payments_inbox</a>();
<a name="l10163"></a>10163     }
<a name="l10164"></a>10164     <span class="keywordflow">else</span>
<a name="l10165"></a>10165     {
<a name="l10166"></a>10166         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try adding --mynym NYM_ID  and  --server SERVER_ID\n(to see the payments inbox for that Server and Nym.)\n&quot;</span>);
<a name="l10167"></a>10167     }
<a name="l10168"></a>10168 
<a name="l10169"></a>10169     <span class="keywordflow">if</span> ((nShowInbox &gt; -1) || (nShowPayments &gt; -1))
<a name="l10170"></a>10170     {
<a name="l10171"></a>10171         <span class="keywordflow">return</span> 1;
<a name="l10172"></a>10172     }
<a name="l10173"></a>10173 
<a name="l10174"></a>10174     <span class="keywordflow">return</span> -1;
<a name="l10175"></a>10175 }
<a name="l10176"></a>10176 
<a name="l10177"></a>10177 
<a name="l10178"></a><a class="code" href="class_o_t___command.html#ac2c49d5370f8ba0cafb21487e4565fdb">10178</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac2c49d5370f8ba0cafb21487e4565fdb">OT_Command::main_show_outgoing</a>()
<a name="l10179"></a>10179 {
<a name="l10180"></a>10180     int32_t nShowPayments = -1;
<a name="l10181"></a>10181     int32_t nShowOutbox = -1;
<a name="l10182"></a>10182 
<a name="l10183"></a>10183     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>))
<a name="l10184"></a>10184     {
<a name="l10185"></a>10185         nShowOutbox = <a class="code" href="class_o_t___command.html#a2dc2ab9b6d17c6677dd3d05189b93155">OT_Command::main_show_outbox</a>();
<a name="l10186"></a>10186     }
<a name="l10187"></a>10187     <span class="keywordflow">else</span>
<a name="l10188"></a>10188     {
<a name="l10189"></a>10189         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try adding --myacct ASSET_ACCT_ID   (to see the asset account&#39;s outbox.)\n&quot;</span>);
<a name="l10190"></a>10190     }
<a name="l10191"></a>10191 
<a name="l10192"></a>10192     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>))
<a name="l10193"></a>10193     {
<a name="l10194"></a>10194         nShowPayments = <a class="code" href="class_o_t___command.html#a7a1e04f23357a2bfbc090fff6719343c">OT_Command::main_show_outpayment</a>();
<a name="l10195"></a>10195     }
<a name="l10196"></a>10196     <span class="keywordflow">else</span>
<a name="l10197"></a>10197     {
<a name="l10198"></a>10198         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Try adding --mynym NYM_ID (to see the outpayment box for that Nym.)\n&quot;</span>);
<a name="l10199"></a>10199     }
<a name="l10200"></a>10200 
<a name="l10201"></a>10201     <span class="keywordflow">if</span> ((nShowOutbox &gt; -1) || (nShowPayments &gt; -1))
<a name="l10202"></a>10202     {
<a name="l10203"></a>10203         <span class="keywordflow">return</span> 1;
<a name="l10204"></a>10204     }
<a name="l10205"></a>10205 
<a name="l10206"></a>10206     <span class="keywordflow">return</span> -1;
<a name="l10207"></a>10207 }
<a name="l10208"></a>10208 
<a name="l10209"></a>10209 
<a name="l10210"></a><a class="code" href="class_o_t___command.html#afa3a8da44e9bbc956f4cc313aa88f83a">10210</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#afa3a8da44e9bbc956f4cc313aa88f83a">OT_Command::main_show_payments_inbox</a>()
<a name="l10211"></a>10211 {
<a name="l10212"></a>10212     <span class="comment">// SHOW PAYMENTS INBOX</span>
<a name="l10213"></a>10213     <span class="comment">//</span>
<a name="l10214"></a>10214     <span class="comment">// Load an asset account&#39;s payments inbox from local storage and display it on the screen.</span>
<a name="l10215"></a>10215     <span class="comment">//</span>
<a name="l10216"></a>10216 
<a name="l10217"></a>10217     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l10218"></a>10218     {
<a name="l10219"></a>10219         <span class="comment">// ***************************************************************</span>
<a name="l10220"></a>10220 
<a name="l10221"></a>10221         <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a7e785f8c3a9ad9257c9e251b438a6087">OTAPI_Wrap::LoadPaymentInbox</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l10222"></a>10222 
<a name="l10223"></a>10223         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l10224"></a>10224         {
<a name="l10225"></a>10225             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Unable to load the payments inbox (probably doesn&#39;t exist yet.)\n(Nym/Server: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot; / &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot; )\n\n&quot;</span>);
<a name="l10226"></a>10226             <span class="keywordflow">return</span> -1;
<a name="l10227"></a>10227         }
<a name="l10228"></a>10228         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l10229"></a>10229         {
<a name="l10230"></a>10230             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10231"></a>10231             <span class="comment">//          print(strInbox)          // stdout</span>
<a name="l10232"></a>10232 
<a name="l10233"></a>10233             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox);
<a name="l10234"></a>10234             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10235"></a>10235             {
<a name="l10236"></a>10236                 <span class="keywordflow">if</span> (nCount &gt; 0)
<a name="l10237"></a>10237                 {
<a name="l10238"></a>10238                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Show payments inbox (Nym/Server)\n( &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot; / &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot; )\n&quot;</span>);
<a name="l10239"></a>10239                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx  Amt   Type      Txn#  Asset_Type\n&quot;</span>);
<a name="l10240"></a>10240                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------------\n&quot;</span>);
<a name="l10241"></a>10241 
<a name="l10242"></a>10242                     <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l10243"></a>10243                     {
<a name="l10244"></a>10244                         <span class="keywordtype">string</span> strInstrument = <a class="code" href="class_o_t_a_p_i___wrap.html#ae1bf653075e809afe55a82a2513d2958">OTAPI_Wrap::Ledger_GetInstrument</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10245"></a>10245 
<a name="l10246"></a>10246                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInstrument))
<a name="l10247"></a>10247                         {
<a name="l10248"></a>10248                             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failed trying to get payment instrument from payments box.\n&quot;</span>);
<a name="l10249"></a>10249                             <span class="keywordflow">return</span> -1;
<a name="l10250"></a>10250                         }
<a name="l10251"></a>10251 
<a name="l10252"></a>10252                         <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10253"></a>10253                         int64_t lTransNumber = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strInbox, nIndex);
<a name="l10254"></a>10254 
<a name="l10255"></a>10255                         <span class="keywordtype">string</span> strTransID = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lTransNumber) ? <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransNumber) : <span class="stringliteral">&quot;UNKNOWN_TRANS_NUM&quot;</span>;
<a name="l10256"></a>10256 
<a name="l10257"></a>10257                         int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strTrans);
<a name="l10258"></a>10258                         <span class="comment">//                      string strAmount          = OTAPI_Wrap::Transaction_GetAmount(Server, MyNym, MyNym, strTrans)</span>
<a name="l10259"></a>10259                         <span class="comment">//                      string strType            = OTAPI_Wrap::Transaction_GetType(Server, MyNym, MyNym, strTrans)</span>
<a name="l10260"></a>10260                         <span class="comment">//                      string strSenderUserID    = OTAPI_Wrap::Transaction_GetSenderUserID(Server, MyNym, MyNym, strTrans)</span>
<a name="l10261"></a>10261                         <span class="comment">//                      string strSenderAcctID    = OTAPI_Wrap::Transaction_GetSenderAcctID(Server, MyNym, MyNym, strTrans)</span>
<a name="l10262"></a>10262                         <span class="comment">//                      string strRecipientUserID = OTAPI_Wrap::Transaction_GetRecipientUserID(Server, MyNym, MyNym, strTrans)</span>
<a name="l10263"></a>10263                         <span class="comment">//                      string strRecipientAcctID = OTAPI_Wrap::Transaction_GetRecipientAcctID(Server, MyNym, MyNym, strTrans)</span>
<a name="l10264"></a>10264 
<a name="l10265"></a>10265                         <span class="comment">//                      string strRefNum          = OTAPI_Wrap::Transaction_GetDisplayReferenceToNum(Server, MyNym, MyNym, strTrans)</span>
<a name="l10266"></a>10266                         int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2db31aab9857deb6907204e388b1a8b4">OTAPI_Wrap::Instrmnt_GetAmount</a>(strInstrument);
<a name="l10267"></a>10267                         <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strInstrument);
<a name="l10268"></a>10268                         <span class="keywordtype">string</span> strAssetType = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strInstrument);  <span class="comment">// todo: output this.</span>
<a name="l10269"></a>10269                         <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#acc3095ff8818c6574c1ed5e0c85d92f5">OTAPI_Wrap::Instrmnt_GetSenderUserID</a>(strInstrument);
<a name="l10270"></a>10270                         <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae7c2873a9439b938209438311652007e">OTAPI_Wrap::Instrmnt_GetSenderAcctID</a>(strInstrument);
<a name="l10271"></a>10271                         <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7aa841c59f5e33dad0a6d7d12a423b5a">OTAPI_Wrap::Instrmnt_GetRecipientUserID</a>(strInstrument);
<a name="l10272"></a>10272                         <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#acdae4292ddffbea5ae32908f3587f98f">OTAPI_Wrap::Instrmnt_GetRecipientAcctID</a>(strInstrument);
<a name="l10273"></a>10273 
<a name="l10274"></a>10274                         <span class="keywordtype">string</span> strUserID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID) ? strSenderUserID : strRecipientUserID;
<a name="l10275"></a>10275                         <span class="keywordtype">string</span> strAcctID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID) ? strSenderAcctID : strRecipientAcctID;
<a name="l10276"></a>10276 
<a name="l10277"></a>10277                         <span class="keywordtype">bool</span> bHasAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount);
<a name="l10278"></a>10278                         <span class="keywordtype">bool</span> bHasAsset = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetType);
<a name="l10279"></a>10279 
<a name="l10280"></a>10280                         <span class="keywordtype">string</span> strAmount = (bHasAmount &amp;&amp; bHasAsset) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetType, lAmount) : <span class="stringliteral">&quot;UNKNOWN_AMOUNT&quot;</span>;
<a name="l10281"></a>10281 
<a name="l10282"></a>10282                         <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10283"></a>10283                         <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10284"></a>10284                         <span class="keywordtype">bool</span> bAssetIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetType);
<a name="l10285"></a>10285 
<a name="l10286"></a>10286                         <span class="keywordtype">string</span> strAssetDenoter = (bAssetIDExists ? <span class="stringliteral">&quot; - &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10287"></a>10287 
<a name="l10288"></a>10288                         <span class="keywordtype">string</span> strAssetName = (bAssetIDExists ? (<span class="stringliteral">&quot;\&quot;&quot;</span> + <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strAssetType) + <span class="stringliteral">&quot;\&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10289"></a>10289                         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetName))     { strAssetName = <span class="stringliteral">&quot;&quot;</span>; strAssetDenoter = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l10290"></a>10290 
<a name="l10291"></a>10291                         <span class="keywordtype">string</span> strOut1 = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>;
<a name="l10292"></a>10292                         <span class="keywordtype">string</span> strOut2 = strAmount + (strAmount.size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>);
<a name="l10293"></a>10293                         <span class="keywordtype">string</span> strOut3 = strType;
<a name="l10294"></a>10294                         <span class="keywordtype">string</span> strOut4 = strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>;
<a name="l10295"></a>10295                         <span class="keywordtype">string</span> strOut5 = strTransID + (strTransID.size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>);
<a name="l10296"></a>10296                         <span class="keywordtype">string</span> strOut6 = strAssetType + strAssetDenoter + strAssetName;
<a name="l10297"></a>10297 
<a name="l10298"></a>10298                         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strOut1 + strOut2 + strOut3 + strOut4 + strOut5 + strOut6);
<a name="l10299"></a>10299                     } <span class="comment">// for</span>
<a name="l10300"></a>10300 
<a name="l10301"></a>10301                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n For the above, try: acceptpayments, acceptinvoices, acceptmoney, or acceptall.\n EXCEPT for smart contracts and payment plans -- for those, use: opentxs confirm\n\n&quot;</span>);
<a name="l10302"></a>10302                 } <span class="comment">// if nCount &gt; 0</span>
<a name="l10303"></a>10303                 <span class="keywordflow">else</span>
<a name="l10304"></a>10304                 {
<a name="l10305"></a>10305                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Payments inbox is empty (Nym/Server: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot; / &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a> + <span class="stringliteral">&quot; )\n&quot;</span>);
<a name="l10306"></a>10306                 }
<a name="l10307"></a>10307             } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10308"></a>10308 
<a name="l10309"></a>10309             <span class="keywordflow">return</span> 1;
<a name="l10310"></a>10310         }
<a name="l10311"></a>10311     }
<a name="l10312"></a>10312     <span class="keywordflow">return</span> -1;
<a name="l10313"></a>10313 }
<a name="l10314"></a>10314 
<a name="l10315"></a>10315 
<a name="l10316"></a><a class="code" href="class_o_t___command.html#acb464a6055b086ee04943b490e687a8e">10316</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#acb464a6055b086ee04943b490e687a8e">OT_Command::details_show_record</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strRecordBox)
<a name="l10317"></a>10317 {
<a name="l10318"></a>10318     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecordBox))
<a name="l10319"></a>10319     {
<a name="l10320"></a>10320         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_show_record: strRecordBox is empty.\n(Need to load it first before calling this function.)\n\n&quot;</span>);
<a name="l10321"></a>10321         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l10322"></a>10322     }
<a name="l10323"></a>10323 
<a name="l10324"></a>10324     <span class="comment">// Success!</span>
<a name="l10325"></a>10325     <span class="comment">//</span>
<a name="l10326"></a>10326     <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, strMyAcctID, strRecordBox, nIndex);
<a name="l10327"></a>10327     int64_t lTransID = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(strServerID, strMyNymID, strMyAcctID, strRecordBox, nIndex);
<a name="l10328"></a>10328     int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10329"></a>10329     int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac7db382eaf556ea215e341cf87affda8">OTAPI_Wrap::Transaction_GetAmount</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10330"></a>10330     <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10331"></a>10331     <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c61f470e86ae24a62d601d924fb612">OTAPI_Wrap::Transaction_GetSenderUserID</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10332"></a>10332     <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#af3cafe894b6d0b8333d09ac23fa852d3">OTAPI_Wrap::Transaction_GetSenderAcctID</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10333"></a>10333     <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6adf67f6a99e040670c7fc5343853f53">OTAPI_Wrap::Transaction_GetRecipientUserID</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10334"></a>10334     <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6a2a65931cdbda45e0b881c732840522">OTAPI_Wrap::Transaction_GetRecipientAcctID</a>(strServerID, strMyNymID, strMyAcctID, strTrans);
<a name="l10335"></a>10335 
<a name="l10336"></a>10336     <span class="keywordtype">string</span> strUserID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID) ? strSenderUserID : strRecipientUserID;
<a name="l10337"></a>10337     <span class="keywordtype">string</span> strAcctID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID) ? strSenderAcctID : strRecipientAcctID;
<a name="l10338"></a>10338 
<a name="l10339"></a>10339     <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10340"></a>10340     <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10341"></a>10341 
<a name="l10342"></a>10342     <span class="keywordtype">string</span> strNewlineSeparator = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10343"></a>10343 
<a name="l10344"></a>10344     <span class="keywordflow">if</span> (bUserIDExists || bAcctIDExists)
<a name="l10345"></a>10345     {
<a name="l10346"></a>10346         strNewlineSeparator = <span class="stringliteral">&quot;\n                                 |&quot;</span>;
<a name="l10347"></a>10347     }
<a name="l10348"></a>10348 
<a name="l10349"></a>10349     <span class="keywordtype">string</span> strSeparator = (!bUserIDExists &amp;&amp; !bAcctIDExists) ? <span class="stringliteral">&quot;&quot;</span> : strNewlineSeparator;
<a name="l10350"></a>10350 
<a name="l10351"></a>10351     <span class="keywordtype">string</span> strUserDenoter = (bUserIDExists ? <span class="stringliteral">&quot;U:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10352"></a>10352     <span class="keywordtype">string</span> strAcctDenoter = (bAcctIDExists ? <span class="stringliteral">&quot;A:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10353"></a>10353 
<a name="l10354"></a>10354     <span class="keywordtype">string</span> strAssetTypeID = bAcctIDExists ? <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strAcctID) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l10355"></a>10355 
<a name="l10356"></a>10356     <span class="keywordtype">bool</span> bHasAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount);
<a name="l10357"></a>10357     <span class="keywordtype">bool</span> bHasAsset = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID);
<a name="l10358"></a>10358 
<a name="l10359"></a>10359     <span class="keywordtype">string</span> strAmount = bHasAmount ? (bHasAsset ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lAmount) : <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAmount)) : <span class="stringliteral">&quot;UNKNOWN_AMOUNT&quot;</span>;
<a name="l10360"></a>10360 
<a name="l10361"></a>10361     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10362"></a>10362     OTAPI_Wrap::Output(0, strAmount + (strAmount.size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10363"></a>10363     OTAPI_Wrap::Output(0, strType);
<a name="l10364"></a>10364     OTAPI_Wrap::Output(0, strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10365"></a>10365     OTAPI_Wrap::Output(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID).size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10366"></a>10366     OTAPI_Wrap::Output(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum).size() &gt; 2 ? <span class="stringliteral">&quot;  &quot;</span> : <span class="stringliteral">&quot; &quot;</span>) + <span class="stringliteral">&quot;|&quot;</span>);
<a name="l10367"></a>10367     OTAPI_Wrap::Output(0, strUserDenoter + strUserID + strSeparator + strAcctDenoter + strAcctID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l10368"></a>10368 
<a name="l10369"></a>10369     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l10370"></a>10370 }
<a name="l10371"></a>10371 
<a name="l10372"></a>10372 
<a name="l10373"></a><a class="code" href="class_o_t___command.html#a634cfe0f6c47d5b6d6d49fe527bd4c9f">10373</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a634cfe0f6c47d5b6d6d49fe527bd4c9f">OT_Command::details_show_records</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID)
<a name="l10374"></a>10374 {
<a name="l10375"></a>10375     <span class="keywordtype">string</span> strRecordBox = <a class="code" href="class_o_t_a_p_i___wrap.html#a593619dab8d5c1cfe3ea77414a2fa6f5">OTAPI_Wrap::LoadRecordBox</a>(strServerID, strMyNymID, strMyAcctID); <span class="comment">// Returns NULL, or a record box.</span>
<a name="l10376"></a>10376 
<a name="l10377"></a>10377     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strRecordBox))
<a name="l10378"></a>10378     {
<a name="l10379"></a>10379         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_show_records: OT_API_LoadRecordBox: Failed.\n\n&quot;</span>);
<a name="l10380"></a>10380         <span class="keywordflow">return</span> -1;
<a name="l10381"></a>10381     }
<a name="l10382"></a>10382     <span class="comment">// Success!</span>
<a name="l10383"></a>10383     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10384"></a>10384     <span class="comment">//  print(strRecordBox)      // stdout</span>
<a name="l10385"></a>10385 
<a name="l10386"></a>10386     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, strMyAcctID, strRecordBox);
<a name="l10387"></a>10387     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10388"></a>10388     {
<a name="l10389"></a>10389         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;SHOW RECORDS: \n\n&quot;</span>);
<a name="l10390"></a>10390         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx  Amt  Type        Txn# InRef#|User / Acct\n&quot;</span>);
<a name="l10391"></a>10391         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------|(from or to)\n&quot;</span>);
<a name="l10392"></a>10392 
<a name="l10393"></a>10393         <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l10394"></a>10394         {
<a name="l10395"></a>10395             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#acb464a6055b086ee04943b490e687a8e">details_show_record</a>(strServerID, strMyNymID, strMyAcctID, nIndex, strRecordBox))
<a name="l10396"></a>10396             {
<a name="l10397"></a>10397                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_show_records: Error calling details_show_record.\n&quot;</span>);
<a name="l10398"></a>10398                 <span class="keywordflow">return</span> -1;
<a name="l10399"></a>10399             }
<a name="l10400"></a>10400         } <span class="comment">// for</span>
<a name="l10401"></a>10401     } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10402"></a>10402 
<a name="l10403"></a>10403     <span class="keywordflow">return</span> 1;
<a name="l10404"></a>10404 }
<a name="l10405"></a>10405 
<a name="l10406"></a>10406 
<a name="l10407"></a><a class="code" href="class_o_t___command.html#a9557fc1489f18ae8bd3d199a5a0a0b11">10407</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a9557fc1489f18ae8bd3d199a5a0a0b11">OT_Command::main_show_records</a>()
<a name="l10408"></a>10408 {
<a name="l10409"></a>10409     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;main_show_records&quot;</span>;
<a name="l10410"></a>10410 
<a name="l10411"></a>10411     <span class="comment">// SHOW RECORD BOX</span>
<a name="l10412"></a>10412     <span class="comment">//</span>
<a name="l10413"></a>10413     <span class="comment">// Load an asset account&#39;s record box from local storage and display it on the screen.</span>
<a name="l10414"></a>10414     <span class="comment">//</span>
<a name="l10415"></a>10415     <span class="keywordtype">bool</span> bNymExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>);
<a name="l10416"></a>10416     <span class="keywordtype">bool</span> bAcctExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>);
<a name="l10417"></a>10417     <span class="keywordtype">bool</span> bBothExist = (bNymExists &amp;&amp;  bAcctExists);
<a name="l10418"></a>10418     <span class="keywordtype">bool</span> bShowNymOnly = (bNymExists &amp;&amp; !bAcctExists);
<a name="l10419"></a>10419 
<a name="l10420"></a>10420     <span class="comment">//</span>
<a name="l10421"></a>10421     <span class="keywordtype">string</span> strMyNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10422"></a>10422 
<a name="l10423"></a>10423     <span class="keywordflow">if</span> (bShowNymOnly)
<a name="l10424"></a>10424     {
<a name="l10425"></a>10425         strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l10426"></a>10426     }
<a name="l10427"></a>10427     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bAcctExists)
<a name="l10428"></a>10428     {
<a name="l10429"></a>10429         strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10430"></a>10430     }
<a name="l10431"></a>10431     <span class="keywordflow">else</span>
<a name="l10432"></a>10432     {
<a name="l10433"></a>10433         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: This should never happen. (1)\n&quot;</span>);
<a name="l10434"></a>10434         <span class="keywordflow">return</span> -1;
<a name="l10435"></a>10435     }
<a name="l10436"></a>10436 
<a name="l10437"></a>10437     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l10438"></a>10438     {
<a name="l10439"></a>10439         <span class="comment">// if bShowNymOnly is true, then we KNOW MyNym is the Nym, and we ALREADY know he&#39;s</span>
<a name="l10440"></a>10440         <span class="comment">// good, since we called VerifyExists at the top of this function. (MyNym, unlike HisNym,</span>
<a name="l10441"></a>10441         <span class="comment">// is verified against the wallet, so we KNOW it&#39;s there.)</span>
<a name="l10442"></a>10442         <span class="comment">// Therefore, if strMyNymID doesn&#39;t contain a proper string, then we KNOW bShowNymOnly</span>
<a name="l10443"></a>10443         <span class="comment">// must have been false, and that OTAPI_Wrap::GetAccountWallet_NymID(MyAcct) was the call that</span>
<a name="l10444"></a>10444         <span class="comment">// failed. Thus, the error message is appropriate to the latter case and not the former.</span>
<a name="l10445"></a>10445         <span class="comment">//</span>
<a name="l10446"></a>10446         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to find NymID based on myacct. Try a different account or nym, using --myacct ACCT_ID or --mynym NYM_ID\n&quot;</span>);
<a name="l10447"></a>10447         <span class="keywordflow">return</span> -1;
<a name="l10448"></a>10448     }
<a name="l10449"></a>10449     <span class="keywordflow">if</span> (bBothExist &amp;&amp; !(strMyNymID == <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>))
<a name="l10450"></a>10450     {
<a name="l10451"></a>10451         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: MyNym (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;) is not the same nym who owns MyAcct.\nTo override using MyAcct&#39;s owner nym, add:  --mynym (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l10452"></a>10452         <span class="keywordflow">return</span> -1;
<a name="l10453"></a>10453     }
<a name="l10454"></a>10454 
<a name="l10455"></a>10455     <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10456"></a>10456     <span class="comment">//</span>
<a name="l10457"></a>10457     <span class="keywordtype">string</span> strServerID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10458"></a>10458 
<a name="l10459"></a>10459     <span class="keywordflow">if</span> (bAcctExists)
<a name="l10460"></a>10460     {
<a name="l10461"></a>10461         strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10462"></a>10462     }
<a name="l10463"></a>10463     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>))
<a name="l10464"></a>10464     {
<a name="l10465"></a>10465         strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l10466"></a>10466     }
<a name="l10467"></a>10467     <span class="keywordflow">else</span>
<a name="l10468"></a>10468     {
<a name="l10469"></a>10469         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Server was not specified, and either MyAcct wasn&#39;t specified either, or if it was, I was unable to find any ServerID associated with MyAcct.\nTry a different account or different server, using --myacct ACCT_ID or --server SERVER_ID \n\n&quot;</span>);
<a name="l10470"></a>10470         <span class="keywordflow">return</span> -1;
<a name="l10471"></a>10471     }
<a name="l10472"></a>10472 
<a name="l10473"></a>10473     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l10474"></a>10474     {
<a name="l10475"></a>10475         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to find Server ID.\nTry: --server SERVER_ID\nYou might also try: --myacct ACCT_ID  (It will find the server ID based on the account.)\n&quot;</span>);
<a name="l10476"></a>10476         <span class="keywordflow">return</span> -1;
<a name="l10477"></a>10477     }
<a name="l10478"></a>10478     <span class="comment">// ***************************************************************</span>
<a name="l10479"></a>10479     <span class="comment">//</span>
<a name="l10480"></a>10480     <span class="comment">// REMEMBER, recordbox for MyAcct contains the old inbox receipts.</span>
<a name="l10481"></a>10481     <span class="comment">// Whereas recordbox for MyNym contains the old payments (in and out.)</span>
<a name="l10482"></a>10482     <span class="comment">// In the case of the latter, the NYM must be passed as the ACCT...</span>
<a name="l10483"></a>10483     <span class="comment">//</span>
<a name="l10484"></a>10484     <span class="comment">// Meaning: there are TWO record boxes. So must there thus be two commands</span>
<a name="l10485"></a>10485     <span class="comment">// for viewing them? Or do we combine them somehow?</span>
<a name="l10487"></a>10487 <span class="comment"></span>    <span class="comment">// ===&gt; I say combine them, since they are for viewing only (nothing is actually done</span>
<a name="l10488"></a>10488     <span class="comment">// with the records -- they&#39;re just there for the actual client to take and store</span>
<a name="l10489"></a>10489     <span class="comment">// however it wishes.)</span>
<a name="l10490"></a>10490     <span class="comment">//</span>
<a name="l10491"></a>10491     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nNote: OT is completely done with these records. A proper GUI will sweep them out\nperiodically and archive them somewhere, or just erase them. All you can do at the\ncommand line (using this tool) is view them, or erase them using: opentxs clearrecords \n\n&quot;</span>);
<a name="l10492"></a>10492     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nArchived Nym-related records (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;): \n&quot;</span>);
<a name="l10493"></a>10493     int32_t nNymRecords = <a class="code" href="class_o_t___command.html#a634cfe0f6c47d5b6d6d49fe527bd4c9f">details_show_records</a>(strServerID, strMyNymID, strMyNymID);
<a name="l10494"></a>10494     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;--------------------------------------------------------------\n&quot;</span>);
<a name="l10495"></a>10495 
<a name="l10496"></a>10496     int32_t nAcctRecords = 1;
<a name="l10497"></a>10497 
<a name="l10498"></a>10498     <span class="keywordflow">if</span> (bAcctExists)
<a name="l10499"></a>10499     {
<a name="l10500"></a>10500         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nArchived Account-related records (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;): \n&quot;</span>);
<a name="l10501"></a>10501         nAcctRecords = <a class="code" href="class_o_t___command.html#a634cfe0f6c47d5b6d6d49fe527bd4c9f">details_show_records</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10502"></a>10502     }
<a name="l10503"></a>10503 
<a name="l10504"></a>10504     <span class="keywordflow">if</span> (2 == (nNymRecords + nAcctRecords))
<a name="l10505"></a>10505     {
<a name="l10506"></a>10506         <span class="keywordflow">return</span> 1; <span class="comment">// success.</span>
<a name="l10507"></a>10507     }
<a name="l10508"></a>10508 
<a name="l10509"></a>10509     <span class="keywordflow">return</span> -1;
<a name="l10510"></a>10510 }
<a name="l10511"></a>10511 
<a name="l10512"></a>10512 
<a name="l10513"></a><a class="code" href="class_o_t___command.html#a6589aace68362adc7fe072b6398dfe19">10513</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a6589aace68362adc7fe072b6398dfe19">OT_Command::details_clear_records</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyAcctID)
<a name="l10514"></a>10514 {
<a name="l10515"></a>10515     <span class="keywordtype">bool</span> bTrue = <span class="keyword">true</span>;
<a name="l10516"></a>10516     <span class="keywordtype">bool</span> bCleared = <a class="code" href="class_o_t_a_p_i___wrap.html#aa97012b83e573c3bd02b9f7dafca548d">OTAPI_Wrap::ClearRecord</a>(strServerID, strMyNymID, strMyAcctID, 0, bTrue); <span class="comment">// nIndex=0 (ignored when clearing all), ClearAll = true.</span>
<a name="l10517"></a>10517 
<a name="l10518"></a>10518     <span class="keywordflow">return</span> bCleared ? 1 : -1;
<a name="l10519"></a>10519 }
<a name="l10520"></a>10520 
<a name="l10521"></a>10521 
<a name="l10522"></a><a class="code" href="class_o_t___command.html#a581de8c6e7943c651f17fca7a7a8d617">10522</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a581de8c6e7943c651f17fca7a7a8d617">OT_Command::main_clear_records</a>()
<a name="l10523"></a>10523 {
<a name="l10524"></a>10524     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;main_clear_records&quot;</span>;
<a name="l10525"></a>10525 
<a name="l10526"></a>10526     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot; Usage:      opentxs clearrecords\n\n&quot;</span>);
<a name="l10527"></a>10527 
<a name="l10528"></a>10528 
<a name="l10529"></a>10529     <span class="comment">// CLEAR RECORD BOX</span>
<a name="l10530"></a>10530     <span class="comment">//</span>
<a name="l10531"></a>10531     <span class="comment">// Load an asset account&#39;s record box from local storage and display it on the screen.</span>
<a name="l10532"></a>10532     <span class="comment">//</span>
<a name="l10533"></a>10533     <span class="keywordtype">bool</span> bNymExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>, <span class="keyword">false</span>);
<a name="l10534"></a>10534     <span class="keywordtype">bool</span> bAcctExists = <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>, <span class="keyword">false</span>);
<a name="l10535"></a>10535     <span class="keywordtype">bool</span> bBothExist = (bNymExists &amp;&amp;  bAcctExists);
<a name="l10536"></a>10536     <span class="keywordtype">bool</span> bShowNymOnly = (bNymExists &amp;&amp; !bAcctExists);
<a name="l10537"></a>10537 
<a name="l10538"></a>10538     <span class="comment">//</span>
<a name="l10539"></a>10539     <span class="keywordtype">string</span> strMyNymID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10540"></a>10540 
<a name="l10541"></a>10541     <span class="keywordflow">if</span> (bShowNymOnly)
<a name="l10542"></a>10542     {
<a name="l10543"></a>10543         strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l10544"></a>10544     }
<a name="l10545"></a>10545     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bAcctExists)
<a name="l10546"></a>10546     {
<a name="l10547"></a>10547         strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10548"></a>10548     }
<a name="l10549"></a>10549     <span class="keywordflow">else</span>
<a name="l10550"></a>10550     {
<a name="l10551"></a>10551         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: This should never happen. (1)\n&quot;</span>);
<a name="l10552"></a>10552         <span class="keywordflow">return</span> -1;
<a name="l10553"></a>10553     }
<a name="l10554"></a>10554 
<a name="l10555"></a>10555     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l10556"></a>10556     {
<a name="l10557"></a>10557         <span class="comment">// if bShowNymOnly is true, then we KNOW MyNym is the Nym, and we ALREADY know he&#39;s</span>
<a name="l10558"></a>10558         <span class="comment">// good, since we called VerifyExists at the top of this function. (MyNym, unlike HisNym,</span>
<a name="l10559"></a>10559         <span class="comment">// is verified against the wallet, so we KNOW it&#39;s there.)</span>
<a name="l10560"></a>10560         <span class="comment">// Therefore, if strMyNymID doesn&#39;t contain a proper string, then we KNOW bShowNymOnly</span>
<a name="l10561"></a>10561         <span class="comment">// must have been false, and that OTAPI_Wrap::GetAccountWallet_NymID(MyAcct) was the call that</span>
<a name="l10562"></a>10562         <span class="comment">// failed. Thus, the error message is appropriate to the latter case and not the former.</span>
<a name="l10563"></a>10563         <span class="comment">//</span>
<a name="l10564"></a>10564         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to find NymID based on myacct. Try a different account or nym, using --myacct ACCT_ID or --mynym NYM_ID\n&quot;</span>);
<a name="l10565"></a>10565         <span class="keywordflow">return</span> -1;
<a name="l10566"></a>10566     }
<a name="l10567"></a>10567     <span class="keywordflow">if</span> (bBothExist &amp;&amp; !(strMyNymID == <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>))
<a name="l10568"></a>10568     {
<a name="l10569"></a>10569         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: MyNym (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;) is not the same nym who owns MyAcct.\nTo override using MyAcct&#39;s owner nym, add:  --mynym (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;)\n&quot;</span>);
<a name="l10570"></a>10570         <span class="keywordflow">return</span> -1;
<a name="l10571"></a>10571     }
<a name="l10572"></a>10572 
<a name="l10573"></a>10573     <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10574"></a>10574     <span class="comment">//</span>
<a name="l10575"></a>10575     <span class="keywordtype">string</span> strServerID = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10576"></a>10576 
<a name="l10577"></a>10577     <span class="keywordflow">if</span> (bAcctExists)
<a name="l10578"></a>10578     {
<a name="l10579"></a>10579         strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10580"></a>10580     }
<a name="l10581"></a>10581     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>, <span class="keyword">false</span>))
<a name="l10582"></a>10582     {
<a name="l10583"></a>10583         strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l10584"></a>10584     }
<a name="l10585"></a>10585     <span class="keywordflow">else</span>
<a name="l10586"></a>10586     {
<a name="l10587"></a>10587         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Server was not specified, and either MyAcct wasn&#39;t specified either, or if it was, I was unable to find any ServerID associated with MyAcct.\nTry a different account or different server, using --myacct ACCT_ID or --server SERVER_ID \n\n&quot;</span>);
<a name="l10588"></a>10588         <span class="keywordflow">return</span> -1;
<a name="l10589"></a>10589     }
<a name="l10590"></a>10590 
<a name="l10591"></a>10591     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l10592"></a>10592     {
<a name="l10593"></a>10593         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strLocation + <span class="stringliteral">&quot;: Unable to find Server ID.\nTry: --server SERVER_ID\nYou might also try: --myacct ACCT_ID  (It will find the server ID based on the account.)\n&quot;</span>);
<a name="l10594"></a>10594         <span class="keywordflow">return</span> -1;
<a name="l10595"></a>10595     }
<a name="l10596"></a>10596     <span class="comment">// ***************************************************************</span>
<a name="l10597"></a>10597     <span class="comment">//</span>
<a name="l10598"></a>10598     <span class="comment">// REMEMBER, recordbox for MyAcct contains the old inbox receipts.</span>
<a name="l10599"></a>10599     <span class="comment">// Whereas recordbox for MyNym contains the old payments (in and out.)</span>
<a name="l10600"></a>10600     <span class="comment">// In the case of the latter, the NYM must be passed as the ACCT...</span>
<a name="l10601"></a>10601     <span class="comment">//</span>
<a name="l10602"></a>10602     <span class="comment">// Meaning: there are TWO record boxes.</span>
<a name="l10603"></a>10603     <span class="comment">//</span>
<a name="l10604"></a>10604     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Clearing archived Nym-related records (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;)... \n&quot;</span>);
<a name="l10605"></a>10605     int32_t nNymRecords = <a class="code" href="class_o_t___command.html#a6589aace68362adc7fe072b6398dfe19">details_clear_records</a>(strServerID, strMyNymID, strMyNymID);
<a name="l10606"></a>10606     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;--------------------------------------------------------------\n&quot;</span>);
<a name="l10607"></a>10607     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nClearing archived Account-related records (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;)... \n&quot;</span>);
<a name="l10608"></a>10608     int32_t nAcctRecords = <a class="code" href="class_o_t___command.html#a6589aace68362adc7fe072b6398dfe19">details_clear_records</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10609"></a>10609 
<a name="l10610"></a>10610     <span class="keywordflow">if</span> (2 == (nNymRecords + nAcctRecords))
<a name="l10611"></a>10611     {
<a name="l10612"></a>10612         <span class="keywordflow">return</span> 1; <span class="comment">// success.</span>
<a name="l10613"></a>10613     }
<a name="l10614"></a>10614 
<a name="l10615"></a>10615     <span class="keywordflow">return</span> -1;
<a name="l10616"></a>10616 }
<a name="l10617"></a>10617 
<a name="l10618"></a>10618 
<a name="l10619"></a><a class="code" href="class_o_t___command.html#ab793834ec8b927ada5c6b8e83d98ebc2">10619</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ab793834ec8b927ada5c6b8e83d98ebc2">OT_Command::details_clear_expired</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID)
<a name="l10620"></a>10620 {
<a name="l10621"></a>10621     <span class="keywordtype">bool</span> bTrue = <span class="keyword">true</span>;
<a name="l10622"></a>10622     <span class="keywordtype">bool</span> bCleared = <a class="code" href="class_o_t_a_p_i___wrap.html#a1a9433803156ffb41a682698a09fe65c">OTAPI_Wrap::ClearExpired</a>(strServerID, strMyNymID, 0, bTrue); <span class="comment">// nIndex=0 (ignored when clearing all), ClearAll = true.</span>
<a name="l10623"></a>10623 
<a name="l10624"></a>10624     <span class="keywordflow">return</span> bCleared ? 1 : -1;
<a name="l10625"></a>10625 }
<a name="l10626"></a>10626 
<a name="l10627"></a>10627 
<a name="l10628"></a><a class="code" href="class_o_t___command.html#ad3f4275f877b966558aa929ac418cef1">10628</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ad3f4275f877b966558aa929ac418cef1">OT_Command::main_clear_expired</a>()
<a name="l10629"></a>10629 {
<a name="l10630"></a>10630     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot; Usage:      opentxs clearexpired\n\n&quot;</span>);
<a name="l10631"></a>10631 
<a name="l10632"></a>10632     <span class="comment">// CLEAR EXPIRED BOX</span>
<a name="l10633"></a>10633     <span class="comment">//</span>
<a name="l10634"></a>10634     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l10635"></a>10635     {
<a name="l10636"></a>10636         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l10637"></a>10637         <span class="keywordtype">string</span> strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l10638"></a>10638 
<a name="l10639"></a>10639         <span class="comment">//</span>
<a name="l10640"></a>10640         <span class="comment">// expiredBox for MyNym contains the old payments (in and out.)</span>
<a name="l10641"></a>10641         <span class="comment">//</span>
<a name="l10642"></a>10642         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Clearing archived Nym-related expired records (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;)... \n&quot;</span>);
<a name="l10643"></a>10643 
<a name="l10644"></a>10644         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ab793834ec8b927ada5c6b8e83d98ebc2">details_clear_expired</a>(strServerID, strMyNymID);
<a name="l10645"></a>10645     }
<a name="l10646"></a>10646 
<a name="l10647"></a>10647     <span class="keywordflow">return</span> -1;
<a name="l10648"></a>10648 }
<a name="l10649"></a>10649 
<a name="l10650"></a>10650 
<a name="l10651"></a>10651 <span class="comment">// TODO: This is based on details_show_record which assumes it can contain asset inbox records as well</span>
<a name="l10652"></a>10652 <span class="comment">// as payment inbox records. But in fact, the expired box can ONLY contain payment records, not asset</span>
<a name="l10653"></a>10653 <span class="comment">// account records. So at some point, we will want to update this function to use the Instrument calls</span>
<a name="l10654"></a>10654 <span class="comment">// instead of the typical transaction calls, since that is more appropriate in this case. In fact we</span>
<a name="l10655"></a>10655 <span class="comment">// will also want to update details_show_record to do the same thing, in cases where the nymID and</span>
<a name="l10656"></a>10656 <span class="comment">// the account ID are the same.</span>
<a name="l10657"></a>10657 <span class="comment">//</span>
<a name="l10658"></a><a class="code" href="class_o_t___command.html#abfdb0fb76e932214a0059dce7eb6a014">10658</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#abfdb0fb76e932214a0059dce7eb6a014">OT_Command::details_show_expired</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strExpiredBox)
<a name="l10659"></a>10659 {
<a name="l10660"></a>10660     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strExpiredBox))
<a name="l10661"></a>10661     {
<a name="l10662"></a>10662         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_show_expired: strExpiredBox is empty.\n(Need to load it first before calling this function.)\n\n&quot;</span>);
<a name="l10663"></a>10663         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l10664"></a>10664     }
<a name="l10665"></a>10665 
<a name="l10666"></a>10666     <span class="comment">// Success!</span>
<a name="l10667"></a>10667     <span class="comment">//</span>
<a name="l10668"></a>10668     <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, strMyNymID, strExpiredBox, nIndex);
<a name="l10669"></a>10669     int64_t lTransID = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(strServerID, strMyNymID, strMyNymID, strExpiredBox, nIndex);
<a name="l10670"></a>10670     int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10671"></a>10671     int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac7db382eaf556ea215e341cf87affda8">OTAPI_Wrap::Transaction_GetAmount</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10672"></a>10672     <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10673"></a>10673     <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c61f470e86ae24a62d601d924fb612">OTAPI_Wrap::Transaction_GetSenderUserID</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10674"></a>10674     <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#af3cafe894b6d0b8333d09ac23fa852d3">OTAPI_Wrap::Transaction_GetSenderAcctID</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10675"></a>10675     <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6adf67f6a99e040670c7fc5343853f53">OTAPI_Wrap::Transaction_GetRecipientUserID</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10676"></a>10676     <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6a2a65931cdbda45e0b881c732840522">OTAPI_Wrap::Transaction_GetRecipientAcctID</a>(strServerID, strMyNymID, strMyNymID, strTrans);
<a name="l10677"></a>10677 
<a name="l10678"></a>10678     <span class="keywordtype">string</span> strUserID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID) ? strSenderUserID : strRecipientUserID;
<a name="l10679"></a>10679     <span class="keywordtype">string</span> strAcctID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID) ? strSenderAcctID : strRecipientAcctID;
<a name="l10680"></a>10680 
<a name="l10681"></a>10681     <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10682"></a>10682     <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10683"></a>10683 
<a name="l10684"></a>10684     <span class="keywordtype">string</span> strNewlineSeparator = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10685"></a>10685 
<a name="l10686"></a>10686     <span class="keywordflow">if</span> (bUserIDExists || bAcctIDExists)
<a name="l10687"></a>10687     {
<a name="l10688"></a>10688         strNewlineSeparator = <span class="stringliteral">&quot;\n                                 |&quot;</span>;
<a name="l10689"></a>10689     }
<a name="l10690"></a>10690 
<a name="l10691"></a>10691     <span class="keywordtype">string</span> strSeparator = (!bUserIDExists &amp;&amp; !bAcctIDExists) ? <span class="stringliteral">&quot;&quot;</span> : strNewlineSeparator;
<a name="l10692"></a>10692 
<a name="l10693"></a>10693     <span class="keywordtype">string</span> strUserDenoter = (bUserIDExists ? <span class="stringliteral">&quot;U:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10694"></a>10694     <span class="keywordtype">string</span> strAcctDenoter = (bAcctIDExists ? <span class="stringliteral">&quot;A:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10695"></a>10695 
<a name="l10696"></a>10696     <span class="keywordtype">string</span> strAssetTypeID = bAcctIDExists ? <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strAcctID) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l10697"></a>10697 
<a name="l10698"></a>10698     <span class="keywordtype">string</span> strAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount) ? (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lAmount) : <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAmount)) : <span class="stringliteral">&quot;UNKNOWN_AMOUNT&quot;</span>;
<a name="l10699"></a>10699 
<a name="l10700"></a>10700     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10701"></a>10701     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strAmount + (strAmount.size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10702"></a>10702     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType);
<a name="l10703"></a>10703     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10704"></a>10704     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID).size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10705"></a>10705     OTAPI_Wrap::Output(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum).size() &gt; 2 ? <span class="stringliteral">&quot;  &quot;</span> : <span class="stringliteral">&quot; &quot;</span>) + <span class="stringliteral">&quot;|&quot;</span>);
<a name="l10706"></a>10706     OTAPI_Wrap::Output(0, strUserDenoter + strUserID + strSeparator + strAcctDenoter + strAcctID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l10707"></a>10707 
<a name="l10708"></a>10708     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l10709"></a>10709 }
<a name="l10710"></a>10710 
<a name="l10711"></a>10711 
<a name="l10712"></a><a class="code" href="class_o_t___command.html#ac2fdfc9f4787a2a952416a7c3dc008bf">10712</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac2fdfc9f4787a2a952416a7c3dc008bf">OT_Command::details_show_expired_records</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strServerID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID)
<a name="l10713"></a>10713 {
<a name="l10714"></a>10714     <span class="keywordtype">string</span> strExpiredBox = <a class="code" href="class_o_t_a_p_i___wrap.html#a2ccca9414b182114611cb20f8392a279">OTAPI_Wrap::LoadExpiredBox</a>(strServerID, strMyNymID); <span class="comment">// Returns NULL, or an expired box.</span>
<a name="l10715"></a>10715 
<a name="l10716"></a>10716     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strExpiredBox))
<a name="l10717"></a>10717     {
<a name="l10718"></a>10718         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n details_show_expired_records: OT_API_LoadExpiredBox: Failed.\n\n&quot;</span>);
<a name="l10719"></a>10719         <span class="keywordflow">return</span> -1;
<a name="l10720"></a>10720     }
<a name="l10721"></a>10721     <span class="comment">// Success!</span>
<a name="l10722"></a>10722     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10723"></a>10723     <span class="comment">//  print(strExpiredBox)      // stdout</span>
<a name="l10724"></a>10724 
<a name="l10725"></a>10725     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, strMyNymID, strExpiredBox);
<a name="l10726"></a>10726     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10727"></a>10727     {
<a name="l10728"></a>10728         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;SHOW EXPIRED RECORDS: \n\n&quot;</span>);
<a name="l10729"></a>10729         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx  Amt  Type        Txn# InRef#|User / Acct\n&quot;</span>);
<a name="l10730"></a>10730         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------|(from or to)\n&quot;</span>);
<a name="l10731"></a>10731 
<a name="l10732"></a>10732         <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l10733"></a>10733         {
<a name="l10734"></a>10734             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#abfdb0fb76e932214a0059dce7eb6a014">details_show_expired</a>(strServerID, strMyNymID, nIndex, strExpiredBox))
<a name="l10735"></a>10735             {
<a name="l10736"></a>10736                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;details_show_expired_records: Error calling details_show_expired.\n&quot;</span>);
<a name="l10737"></a>10737                 <span class="keywordflow">return</span> -1;
<a name="l10738"></a>10738             }
<a name="l10739"></a>10739         } <span class="comment">// for</span>
<a name="l10740"></a>10740     } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10741"></a>10741 
<a name="l10742"></a>10742     <span class="keywordflow">return</span> 1;
<a name="l10743"></a>10743 }
<a name="l10744"></a>10744 
<a name="l10745"></a>10745 
<a name="l10746"></a><a class="code" href="class_o_t___command.html#a46e56f57d6cd3c6ac73a63f40ba46c71">10746</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a46e56f57d6cd3c6ac73a63f40ba46c71">OT_Command::main_show_expired</a>()
<a name="l10747"></a>10747 {
<a name="l10748"></a>10748     <span class="keywordtype">string</span> strLocation = <span class="stringliteral">&quot;main_show_expired&quot;</span>;
<a name="l10749"></a>10749 
<a name="l10750"></a>10750     <span class="comment">// SHOW EXPIRED RECORD BOX</span>
<a name="l10751"></a>10751     <span class="comment">//</span>
<a name="l10752"></a>10752     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>))
<a name="l10753"></a>10753     {
<a name="l10754"></a>10754         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>;
<a name="l10755"></a>10755         <span class="keywordtype">string</span> strServerID = <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>;
<a name="l10756"></a>10756 
<a name="l10757"></a>10757         <span class="comment">// expiredbox for MyNym contains the old payments (in and out.)</span>
<a name="l10758"></a>10758 
<a name="l10759"></a>10759         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nNote: OT is completely done with these expired records. A proper GUI will sweep them out\nperiodically and archive them somewhere, or just erase them. All you can do at the\ncommand line (using this tool) is view them, or erase them using: opentxs clearexpired \n\n&quot;</span>);
<a name="l10760"></a>10760         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nArchived Nym-related expired records (&quot;</span> + strMyNymID + <span class="stringliteral">&quot;): \n&quot;</span>);
<a name="l10761"></a>10761 
<a name="l10762"></a>10762         <span class="keywordflow">return</span> <a class="code" href="class_o_t___command.html#ac2fdfc9f4787a2a952416a7c3dc008bf">details_show_expired_records</a>(strServerID, strMyNymID);
<a name="l10763"></a>10763     }
<a name="l10764"></a>10764 
<a name="l10765"></a>10765     <span class="keywordflow">return</span> -1;
<a name="l10766"></a>10766 }
<a name="l10767"></a>10767 
<a name="l10768"></a>10768 
<a name="l10769"></a><a class="code" href="class_o_t___command.html#a7e9e17d9349c69322ddea8cbc7b986b1">10769</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7e9e17d9349c69322ddea8cbc7b986b1">OT_Command::main_show_inbox</a>()
<a name="l10770"></a>10770 {
<a name="l10771"></a>10771 
<a name="l10772"></a>10772     <span class="comment">// SHOW INBOX</span>
<a name="l10773"></a>10773     <span class="comment">//</span>
<a name="l10774"></a>10774     <span class="comment">// Load an asset account&#39;s inbox from local storage and display it on the screen.</span>
<a name="l10775"></a>10775     <span class="comment">//</span>
<a name="l10776"></a>10776 
<a name="l10777"></a>10777     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l10778"></a>10778     {
<a name="l10779"></a>10779 
<a name="l10780"></a>10780         <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10781"></a>10781         <span class="comment">//</span>
<a name="l10782"></a>10782         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10783"></a>10783 
<a name="l10784"></a>10784         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l10785"></a>10785         {
<a name="l10786"></a>10786             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l10787"></a>10787             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l10788"></a>10788             <span class="keywordflow">return</span> -1;
<a name="l10789"></a>10789         }
<a name="l10790"></a>10790 
<a name="l10791"></a>10791         <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10792"></a>10792         <span class="comment">//</span>
<a name="l10793"></a>10793         <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10794"></a>10794 
<a name="l10795"></a>10795         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l10796"></a>10796         {
<a name="l10797"></a>10797             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l10798"></a>10798             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l10799"></a>10799             <span class="keywordflow">return</span> -1;
<a name="l10800"></a>10800         }
<a name="l10801"></a>10801         <span class="comment">// ***************************************************************</span>
<a name="l10802"></a>10802 
<a name="l10803"></a>10803         <span class="keywordtype">string</span> strInbox = <a class="code" href="class_o_t_a_p_i___wrap.html#abaca9dcb58932efa4daaaee430901c8e">OTAPI_Wrap::LoadInbox</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>); <span class="comment">// Returns NULL, or an inbox.</span>
<a name="l10804"></a>10804 
<a name="l10805"></a>10805         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strInbox))
<a name="l10806"></a>10806         {
<a name="l10807"></a>10807             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Unable to load asset account inbox. ( &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot; )\n Perhaps it doesn&#39;t exist yet?\n\n&quot;</span>);
<a name="l10808"></a>10808             <span class="keywordflow">return</span> -1;
<a name="l10809"></a>10809         }
<a name="l10810"></a>10810         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l10811"></a>10811         {
<a name="l10812"></a>10812             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10813"></a>10813             <span class="comment">//          print(strInbox)          // stdout</span>
<a name="l10814"></a>10814 
<a name="l10815"></a>10815             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strInbox);
<a name="l10816"></a>10816             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10817"></a>10817             {
<a name="l10818"></a>10818                 <span class="keywordflow">if</span> (nCount &gt; 0)
<a name="l10819"></a>10819                 {
<a name="l10820"></a>10820                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Show inbox for an asset account  (&quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;): \n&quot;</span>);
<a name="l10821"></a>10821                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Idx  Amt  Type        Txn# InRef#|User / Acct\n&quot;</span>);
<a name="l10822"></a>10822                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------|(from or to)\n&quot;</span>);
<a name="l10823"></a>10823 
<a name="l10824"></a>10824                     <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l10825"></a>10825                     {
<a name="l10826"></a>10826                         <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strInbox, nIndex);
<a name="l10827"></a>10827                         int64_t lTransID = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strInbox, nIndex);
<a name="l10828"></a>10828                         int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10829"></a>10829                         int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac7db382eaf556ea215e341cf87affda8">OTAPI_Wrap::Transaction_GetAmount</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10830"></a>10830                         <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10831"></a>10831                         <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c61f470e86ae24a62d601d924fb612">OTAPI_Wrap::Transaction_GetSenderUserID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10832"></a>10832                         <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#af3cafe894b6d0b8333d09ac23fa852d3">OTAPI_Wrap::Transaction_GetSenderAcctID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10833"></a>10833                         <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6adf67f6a99e040670c7fc5343853f53">OTAPI_Wrap::Transaction_GetRecipientUserID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10834"></a>10834                         <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6a2a65931cdbda45e0b881c732840522">OTAPI_Wrap::Transaction_GetRecipientAcctID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10835"></a>10835 
<a name="l10836"></a>10836                         <span class="keywordtype">string</span> strUserID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderUserID) ? strSenderUserID : strRecipientUserID;
<a name="l10837"></a>10837                         <span class="keywordtype">string</span> strAcctID = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strSenderAcctID) ? strSenderAcctID : strRecipientAcctID;
<a name="l10838"></a>10838 
<a name="l10839"></a>10839                         <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10840"></a>10840                         <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10841"></a>10841 
<a name="l10842"></a>10842                         <span class="keywordtype">string</span> strNewlineSeparator = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10843"></a>10843 
<a name="l10844"></a>10844                         <span class="keywordflow">if</span> (bUserIDExists || bAcctIDExists)
<a name="l10845"></a>10845                         {
<a name="l10846"></a>10846                             strNewlineSeparator = <span class="stringliteral">&quot;\n                                 |&quot;</span>;
<a name="l10847"></a>10847                         }
<a name="l10848"></a>10848 
<a name="l10849"></a>10849                         <span class="keywordtype">string</span> strSeparator = (!bUserIDExists &amp;&amp; !bAcctIDExists) ? <span class="stringliteral">&quot;&quot;</span> : strNewlineSeparator;
<a name="l10850"></a>10850 
<a name="l10851"></a>10851                         <span class="keywordtype">string</span> strUserDenoter = (bUserIDExists ? <span class="stringliteral">&quot;U:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10852"></a>10852                         <span class="keywordtype">string</span> strAcctDenoter = (bAcctIDExists ? <span class="stringliteral">&quot;A:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10853"></a>10853 
<a name="l10854"></a>10854                         <span class="keywordtype">string</span> strAssetTypeID = bAcctIDExists ? <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strAcctID) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l10855"></a>10855 
<a name="l10856"></a>10856                         <span class="keywordtype">string</span> strAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount) ? (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lAmount) : <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAmount)) : <span class="stringliteral">&quot;UNKNOWN_AMOUNT&quot;</span>;
<a name="l10857"></a>10857 
<a name="l10858"></a>10858                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10859"></a>10859                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strAmount + (strAmount.size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10860"></a>10860                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType);
<a name="l10861"></a>10861                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10862"></a>10862                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID).size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10863"></a>10863                         OTAPI_Wrap::Output(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum).size() &gt; 2 ? <span class="stringliteral">&quot;  &quot;</span> : <span class="stringliteral">&quot; &quot;</span>) + <span class="stringliteral">&quot;|&quot;</span>);
<a name="l10864"></a>10864                         OTAPI_Wrap::Output(0, strUserDenoter + strUserID + strSeparator + strAcctDenoter + strAcctID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l10865"></a>10865                     } <span class="comment">// for</span>
<a name="l10866"></a>10866 
<a name="l10867"></a>10867                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n For the above, try: accepttransfers, acceptreceipts, acceptinbox, acceptmoney, or acceptall.\n&quot;</span>);
<a name="l10868"></a>10868                 }
<a name="l10869"></a>10869                 <span class="keywordflow">else</span>
<a name="l10870"></a>10870                 {
<a name="l10871"></a>10871                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Asset account inbox ( &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot; ) is empty.\n&quot;</span>);
<a name="l10872"></a>10872                 }
<a name="l10873"></a>10873 
<a name="l10874"></a>10874             } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10875"></a>10875 
<a name="l10876"></a>10876             <span class="keywordflow">return</span> 1;
<a name="l10877"></a>10877         }
<a name="l10878"></a>10878     }
<a name="l10879"></a>10879     <span class="keywordflow">return</span> -1;
<a name="l10880"></a>10880 }
<a name="l10881"></a>10881 
<a name="l10882"></a>10882 
<a name="l10883"></a><a class="code" href="class_o_t___command.html#a2dc2ab9b6d17c6677dd3d05189b93155">10883</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a2dc2ab9b6d17c6677dd3d05189b93155">OT_Command::main_show_outbox</a>()
<a name="l10884"></a>10884 {
<a name="l10885"></a>10885 
<a name="l10886"></a>10886     <span class="comment">// SHOW OUTPUT</span>
<a name="l10887"></a>10887     <span class="comment">//</span>
<a name="l10888"></a>10888     <span class="comment">// Load an asset account&#39;s outbox from local storage and display it on the screen.</span>
<a name="l10889"></a>10889     <span class="comment">//</span>
<a name="l10890"></a>10890     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;-----------------------------------------------\nUSAGE:   outbox --myacct MY_ACCT_ID\n&quot;</span>;
<a name="l10891"></a>10891     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l10892"></a>10892 
<a name="l10893"></a>10893     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyAcct&quot;</span>))
<a name="l10894"></a>10894     {
<a name="l10895"></a>10895 
<a name="l10896"></a>10896         <span class="comment">// HERE, WE LOOK UP THE NYM ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10897"></a>10897         <span class="comment">//</span>
<a name="l10898"></a>10898         <span class="keywordtype">string</span> strMyNymID = <a class="code" href="class_o_t_a_p_i___wrap.html#a8c70b106ba3957ebcc5abce3e3404dfe">OTAPI_Wrap::GetAccountWallet_NymID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10899"></a>10899 
<a name="l10900"></a>10900         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMyNymID))
<a name="l10901"></a>10901         {
<a name="l10902"></a>10902             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find NymID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l10903"></a>10903             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Nym based on the account.\n\n&quot;</span>);
<a name="l10904"></a>10904             <span class="keywordflow">return</span> -1;
<a name="l10905"></a>10905         }
<a name="l10906"></a>10906 
<a name="l10907"></a>10907         <span class="comment">// HERE, WE LOOK UP THE SERVER ID, BASED ON THE ACCOUNT ID.</span>
<a name="l10908"></a>10908         <span class="comment">//</span>
<a name="l10909"></a>10909         <span class="keywordtype">string</span> strServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a938435d114f98fbb2ff8d8b932521296">OTAPI_Wrap::GetAccountWallet_ServerID</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>);
<a name="l10910"></a>10910 
<a name="l10911"></a>10911         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strServerID))
<a name="l10912"></a>10912         {
<a name="l10913"></a>10913             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Failure: Unable to find Server ID based on myacct. Use: --myacct ACCT_ID\n&quot;</span>);
<a name="l10914"></a>10914             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;The designated asset account must be yours. OT will find the Server based on the account.\n\n&quot;</span>);
<a name="l10915"></a>10915             <span class="keywordflow">return</span> -1;
<a name="l10916"></a>10916         }
<a name="l10917"></a>10917         <span class="comment">// ***************************************************************</span>
<a name="l10918"></a>10918 
<a name="l10919"></a>10919         <span class="keywordtype">string</span> strOutbox = <a class="code" href="class_o_t_a_p_i___wrap.html#a8a0a21f1dd0b86700e8bdbceb6e12a3f">OTAPI_Wrap::LoadOutbox</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>); <span class="comment">// Returns NULL, or an outbox.</span>
<a name="l10920"></a>10920 
<a name="l10921"></a>10921         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strOutbox))
<a name="l10922"></a>10922         {
<a name="l10923"></a>10923             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n OT_API_LoadOutbox: Failed.\n\n&quot;</span>);
<a name="l10924"></a>10924             <span class="keywordflow">return</span> -1;
<a name="l10925"></a>10925         }
<a name="l10926"></a>10926         <span class="keywordflow">else</span> <span class="comment">// Success!</span>
<a name="l10927"></a>10927         {
<a name="l10928"></a>10928             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// stderr</span>
<a name="l10929"></a>10929             <span class="comment">//          print(strOutbox)         // stdout</span>
<a name="l10930"></a>10930 
<a name="l10931"></a>10931             int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#adc7892cde5212b7eeb3fe1c75b3f2291" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Wrap::Ledger_GetCount</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strOutbox);
<a name="l10932"></a>10932             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l10933"></a>10933             {
<a name="l10934"></a>10934                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;===&gt; SHOW OUTBOX: \n&quot;</span>);
<a name="l10935"></a>10935 
<a name="l10936"></a>10936                 <span class="keywordflow">if</span> (nCount &lt;= 0)
<a name="l10937"></a>10937                 {
<a name="l10938"></a>10938                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nAsset account outbox is empty for account: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a> + <span class="stringliteral">&quot;\n\n--------------------------------------------\n&quot;</span>);
<a name="l10939"></a>10939                 }
<a name="l10940"></a>10940                 <span class="keywordflow">else</span>
<a name="l10941"></a>10941                 {
<a name="l10942"></a>10942                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nIdx  Amt  Type        Txn# InRef#|User / Acct\n&quot;</span>);
<a name="l10943"></a>10943                     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;---------------------------------|(from or to)\n&quot;</span>);
<a name="l10944"></a>10944 
<a name="l10945"></a>10945                     <span class="keywordflow">for</span> (int32_t nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l10946"></a>10946                     {
<a name="l10947"></a>10947                         <span class="keywordtype">string</span> strTrans = <a class="code" href="class_o_t_a_p_i___wrap.html#a9eaf7499fbb5a011bb1a2e9e16d55849">OTAPI_Wrap::Ledger_GetTransactionByIndex</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strOutbox, nIndex);
<a name="l10948"></a>10948                         int64_t lTransID = <a class="code" href="class_o_t_a_p_i___wrap.html#a658a2d79b83a29fc5cf2d18dc0889856">OTAPI_Wrap::Ledger_GetTransactionIDByIndex</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strOutbox, nIndex);
<a name="l10949"></a>10949                         int64_t lRefNum = <a class="code" href="class_o_t_a_p_i___wrap.html#af8c50cdc12961dc9389c9a6441871484">OTAPI_Wrap::Transaction_GetDisplayReferenceToNum</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10950"></a>10950                         int64_t lAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#ac7db382eaf556ea215e341cf87affda8">OTAPI_Wrap::Transaction_GetAmount</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10951"></a>10951                         <span class="keywordtype">string</span> strType = <a class="code" href="class_o_t_a_p_i___wrap.html#a6023b3d67960b596ca4146a132e6ff83" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Wrap::Transaction_GetType</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10952"></a>10952                         <span class="keywordtype">string</span> strSenderUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a51c61f470e86ae24a62d601d924fb612">OTAPI_Wrap::Transaction_GetSenderUserID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10953"></a>10953                         <span class="keywordtype">string</span> strSenderAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#af3cafe894b6d0b8333d09ac23fa852d3">OTAPI_Wrap::Transaction_GetSenderAcctID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10954"></a>10954                         <span class="keywordtype">string</span> strRecipientUserID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6adf67f6a99e040670c7fc5343853f53">OTAPI_Wrap::Transaction_GetRecipientUserID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10955"></a>10955                         <span class="keywordtype">string</span> strRecipientAcctID = <a class="code" href="class_o_t_a_p_i___wrap.html#a6a2a65931cdbda45e0b881c732840522">OTAPI_Wrap::Transaction_GetRecipientAcctID</a>(strServerID, strMyNymID, <a class="code" href="ot__otapi__ot_8hpp.html#a1221123b8a537df0623cbb5c5f290295">MyAcct</a>, strTrans);
<a name="l10956"></a>10956 
<a name="l10957"></a>10957                         <span class="keywordtype">string</span> strUserID = strRecipientUserID;
<a name="l10958"></a>10958                         <span class="keywordtype">string</span> strAcctID = strRecipientAcctID;
<a name="l10959"></a>10959 
<a name="l10960"></a>10960                         <span class="keywordtype">bool</span> bUserIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strUserID);
<a name="l10961"></a>10961                         <span class="keywordtype">bool</span> bAcctIDExists = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAcctID);
<a name="l10962"></a>10962 
<a name="l10963"></a>10963                         <span class="keywordtype">string</span> strNewlineSeparator = <span class="stringliteral">&quot;&quot;</span>;
<a name="l10964"></a>10964 
<a name="l10965"></a>10965                         <span class="keywordflow">if</span> (bUserIDExists || bAcctIDExists)
<a name="l10966"></a>10966                         {
<a name="l10967"></a>10967                             strNewlineSeparator = <span class="stringliteral">&quot;\n                                 |&quot;</span>;
<a name="l10968"></a>10968                         }
<a name="l10969"></a>10969 
<a name="l10970"></a>10970                         <span class="keywordtype">string</span> strSeparator = (!bUserIDExists &amp;&amp; !bAcctIDExists) ? <span class="stringliteral">&quot;&quot;</span> : strNewlineSeparator;
<a name="l10971"></a>10971 
<a name="l10972"></a>10972                         <span class="keywordtype">string</span> strUserDenoter = (bUserIDExists ? <span class="stringliteral">&quot;U:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10973"></a>10973                         <span class="keywordtype">string</span> strAcctDenoter = (bAcctIDExists ? <span class="stringliteral">&quot;A:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l10974"></a>10974 
<a name="l10975"></a>10975                         <span class="keywordtype">string</span> strAssetTypeID = bAcctIDExists ? <a class="code" href="class_o_t_a_p_i___wrap.html#ad6a01622857def0225807266e62f84dd">OTAPI_Wrap::GetAccountWallet_AssetTypeID</a>(strAcctID) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l10976"></a>10976 
<a name="l10977"></a>10977                         <span class="keywordtype">string</span> strAmount = <a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lAmount) ? (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeID) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strAssetTypeID, lAmount) : <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lAmount)) : <span class="stringliteral">&quot;UNKNOWN_AMOUNT&quot;</span>;
<a name="l10978"></a>10978 
<a name="l10979"></a>10979                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10980"></a>10980                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strAmount + (strAmount.size() &lt; 3 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10981"></a>10981                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType);
<a name="l10982"></a>10982                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strType.size() &gt; 10 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;    &quot;</span>);
<a name="l10983"></a>10983                         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lTransID).size() &lt; 2 ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;   &quot;</span>));
<a name="l10984"></a>10984                         OTAPI_Wrap::Output(0, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum) + (<a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lRefNum).size() &gt; 2 ? <span class="stringliteral">&quot;  &quot;</span> : <span class="stringliteral">&quot; &quot;</span>) + <span class="stringliteral">&quot;|&quot;</span>);
<a name="l10985"></a>10985                         OTAPI_Wrap::Output(0, strUserDenoter + strUserID + strSeparator + strAcctDenoter + strAcctID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l10986"></a>10986                     } <span class="comment">// for</span>
<a name="l10987"></a>10987                 }
<a name="l10988"></a>10988             } <span class="comment">// VerifyIntVal (nCount)</span>
<a name="l10989"></a>10989 
<a name="l10990"></a>10990             <span class="keywordflow">return</span> 1;
<a name="l10991"></a>10991         }
<a name="l10992"></a>10992     }
<a name="l10993"></a>10993     <span class="keywordflow">return</span> -1;
<a name="l10994"></a>10994 }
<a name="l10995"></a>10995 
<a name="l10996"></a>10996 
<a name="l10997"></a><a class="code" href="class_o_t___command.html#a16a30dfd9fa792e6fa12c5874964d90e">10997</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a16a30dfd9fa792e6fa12c5874964d90e">OT_Command::show_mail_message</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">bool</span> bShowContents)
<a name="l10998"></a>10998 {
<a name="l10999"></a>10999     <span class="keywordtype">bool</span> bMailVerified = <a class="code" href="class_o_t_a_p_i___wrap.html#ae92d4016945fa5d155b3bed5de827f70">OTAPI_Wrap::Nym_VerifyMailByIndex</a>(strMyNymID, nIndex);
<a name="l11000"></a>11000 
<a name="l11001"></a>11001     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(bMailVerified))
<a name="l11002"></a>11002     {
<a name="l11003"></a>11003         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_Nym_VerifyMailByIndex at Index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11004"></a>11004         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11005"></a>11005     }
<a name="l11006"></a>11006 
<a name="l11007"></a>11007     <span class="keywordflow">if</span> (!bMailVerified) <span class="comment">// 1 meaning OT_TRUE.</span>
<a name="l11008"></a>11008     {
<a name="l11009"></a>11009         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;UNVERIFIED mail! At index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l11010"></a>11010         <span class="comment">//      return false;</span>
<a name="l11011"></a>11011     }
<a name="l11012"></a>11012 
<a name="l11013"></a>11013     <span class="keywordflow">else</span>
<a name="l11014"></a>11014     {
<a name="l11015"></a>11015         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;------------------------------\nVerified mail at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l11016"></a>11016     }
<a name="l11017"></a>11017 
<a name="l11018"></a>11018     <span class="keywordtype">string</span> strMailServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a7f74f9dfbd1b856204ebc854e0c51d94">OTAPI_Wrap::GetNym_MailServerIDByIndex</a>(strMyNymID, nIndex);
<a name="l11019"></a>11019     <span class="keywordtype">string</span> strMailSenderID = <a class="code" href="class_o_t_a_p_i___wrap.html#a40cb3129dbf4f5af024fbc826c630a49">OTAPI_Wrap::GetNym_MailSenderIDByIndex</a>(strMyNymID, nIndex);
<a name="l11020"></a>11020     <span class="keywordtype">string</span> strMailContents = <a class="code" href="class_o_t_a_p_i___wrap.html#a004c8bd1edb35081e16bda52ded7038a">OTAPI_Wrap::GetNym_MailContentsByIndex</a>(strMyNymID, nIndex);
<a name="l11021"></a>11021 
<a name="l11022"></a>11022     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailSenderID))
<a name="l11023"></a>11023     {
<a name="l11024"></a>11024         <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strMailSenderID);
<a name="l11025"></a>11025         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strName)) { strName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l11026"></a>11026         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Mail from: &quot;</span> + strMailSenderID + <span class="stringliteral">&quot; \&quot;&quot;</span> + strName + <span class="stringliteral">&quot;\&quot; &quot;</span>);
<a name="l11027"></a>11027     }
<a name="l11028"></a>11028     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailServerID))
<a name="l11029"></a>11029     {
<a name="l11030"></a>11030         <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a856f371dd21dba6d6777b6bd087b9518">OTAPI_Wrap::GetServer_Name</a>(strMailServerID);
<a name="l11031"></a>11031         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strName)) { strName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l11032"></a>11032         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Server ID: &quot;</span> + strMailServerID + <span class="stringliteral">&quot; \&quot;&quot;</span> + strName + <span class="stringliteral">&quot;\&quot; &quot;</span>);
<a name="l11033"></a>11033     }
<a name="l11034"></a>11034     <span class="keywordflow">if</span> (bShowContents &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailContents))
<a name="l11035"></a>11035     {
<a name="l11036"></a>11036         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Contents:\n&quot;</span> + strMailContents + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11037"></a>11037     }
<a name="l11038"></a>11038 
<a name="l11039"></a>11039     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l11040"></a>11040 }
<a name="l11041"></a>11041 
<a name="l11042"></a>11042 
<a name="l11043"></a><a class="code" href="class_o_t___command.html#a713ae075bb9e79d53a18b78f55482a7e">11043</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a713ae075bb9e79d53a18b78f55482a7e">OT_Command::details_del_mail</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l11044"></a>11044 {
<a name="l11045"></a>11045 
<a name="l11046"></a>11046     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#abee93614f4a19e0461a51981d2004044">OTAPI_Wrap::GetNym_MailCount</a>(strMyNymID);
<a name="l11047"></a>11047     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l11048"></a>11048     {
<a name="l11049"></a>11049         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_MailCount for Nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11050"></a>11050         <span class="keywordflow">return</span> -1;
<a name="l11051"></a>11051     }
<a name="l11052"></a>11052 
<a name="l11053"></a>11053     <span class="keywordflow">if</span> (0 == nCount)
<a name="l11054"></a>11054     {
<a name="l11055"></a>11055         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n(Mail is empty.)\n\n&quot;</span>);
<a name="l11056"></a>11056         <span class="keywordflow">return</span> 0;
<a name="l11057"></a>11057     }
<a name="l11058"></a>11058 
<a name="l11059"></a>11059     <span class="keywordtype">bool</span> bIndices = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices);
<a name="l11060"></a>11060     <span class="keywordtype">bool</span> bDeleteAll = <span class="keyword">false</span>;
<a name="l11061"></a>11061 
<a name="l11062"></a>11062     <span class="keywordflow">if</span> (bIndices &amp;&amp; (<span class="stringliteral">&quot;all&quot;</span> == strIndices))
<a name="l11063"></a>11063     {
<a name="l11064"></a>11064         bDeleteAll = <span class="keyword">true</span>;
<a name="l11065"></a>11065     }
<a name="l11066"></a>11066 
<a name="l11067"></a>11067     int32_t nIndicesCount = (bIndices &amp;&amp; !bDeleteAll) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices) : 0;
<a name="l11068"></a>11068 
<a name="l11069"></a>11069     <span class="comment">// If we&#39;re not deleting ALL, then we must be deleting SPECIFC indices.</span>
<a name="l11070"></a>11070     <span class="comment">// But no specific indices were supplied!</span>
<a name="l11071"></a>11071     <span class="comment">// Therefore, error.</span>
<a name="l11072"></a>11072     <span class="comment">//</span>
<a name="l11073"></a>11073     <span class="keywordflow">if</span> (!bDeleteAll &amp;&amp; (nIndicesCount &lt; 1))
<a name="l11074"></a>11074     {
<a name="l11075"></a>11075         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Problem: You&#39;re apparently not deleting \&quot;all\&quot; indices, but neither have you selected SPECIFIC indices.\n Try adding: --args \&quot;indices 4,6,7\&quot; (for deleting the messages at indices 4, 6, and 7, for example.)\n\n&quot;</span>);
<a name="l11076"></a>11076         <span class="keywordflow">return</span> -1;
<a name="l11077"></a>11077     }
<a name="l11078"></a>11078 
<a name="l11079"></a>11079     int32_t nReturnVal = 1;
<a name="l11080"></a>11080 
<a name="l11081"></a>11081     <span class="keywordflow">for</span> (int32_t nIndex = (nCount - 1); nIndex &gt;= 0; --nIndex)
<a name="l11082"></a>11082     {
<a name="l11083"></a>11083 
<a name="l11084"></a>11084         <span class="comment">// If we&#39;re not deleting &quot;all&quot; (i.e. we&#39;re deleting specific indices)...</span>
<a name="l11085"></a>11085         <span class="comment">// and the current index doesn&#39;t appear on that specified list, then continue...</span>
<a name="l11086"></a>11086         <span class="comment">//</span>
<a name="l11087"></a>11087         <span class="keywordflow">if</span> (!bDeleteAll &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex)))
<a name="l11088"></a>11088         {
<a name="l11089"></a>11089             <span class="comment">// We skip any indices that the user isn&#39;t trying to delete.</span>
<a name="l11090"></a>11090             <span class="comment">//          continue   // apparently not supported by the language.</span>
<a name="l11091"></a>11091         }
<a name="l11092"></a>11092 
<a name="l11093"></a>11093         <span class="comment">// Let&#39;s try to remove it...</span>
<a name="l11094"></a>11094         <span class="comment">//</span>
<a name="l11095"></a>11095         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#af7da3eb2ca2b36776dffacf77675e895">OTAPI_Wrap::Nym_RemoveMailByIndex</a>(strMyNymID, nIndex))
<a name="l11096"></a>11096         {
<a name="l11097"></a>11097             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Deleted mail at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; for nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l11098"></a>11098         }
<a name="l11099"></a>11099         <span class="keywordflow">else</span>
<a name="l11100"></a>11100         {
<a name="l11101"></a>11101             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while trying to delete mail at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; for nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l11102"></a>11102             nReturnVal = -1;
<a name="l11103"></a>11103         }
<a name="l11104"></a>11104     } <span class="comment">// for</span>
<a name="l11105"></a>11105 
<a name="l11106"></a>11106     <span class="keywordflow">return</span> nReturnVal;
<a name="l11107"></a>11107 }
<a name="l11108"></a>11108 
<a name="l11109"></a>11109 
<a name="l11110"></a><a class="code" href="class_o_t___command.html#a2219c6e1048de6b130625709958e2692">11110</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a2219c6e1048de6b130625709958e2692">OT_Command::main_del_mail</a>()
<a name="l11111"></a>11111 {
<a name="l11112"></a>11112     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE:   delmail --mynym MY_NYM_ID --args \&quot;index 5\&quot;  (To delete message 5.)\n Also, try: --args \&quot;indices all\&quot; (for all messages)\n As well as: --args \&quot;indices 3,5,6\&quot; (for messages 3, 5, and 6)\n\n&quot;</span>;
<a name="l11113"></a>11113     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11114"></a>11114 
<a name="l11115"></a>11115     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11116"></a>11116     {
<a name="l11117"></a>11117         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11118"></a>11118 
<a name="l11119"></a>11119         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l11120"></a>11120         {
<a name="l11121"></a>11121             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l11122"></a>11122             <span class="comment">//                                  const std::string str_key)</span>
<a name="l11123"></a>11123             <span class="comment">//</span>
<a name="l11124"></a>11124             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l11125"></a>11125             <span class="comment">// EXAMPLE:  --args &quot;index 5 &quot;</span>
<a name="l11126"></a>11126             <span class="comment">//</span>
<a name="l11127"></a>11127 
<a name="l11128"></a>11128             <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l11129"></a>11129 
<a name="l11130"></a>11130             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l11131"></a>11131             {
<a name="l11132"></a>11132                 strIndices = strIndex;
<a name="l11133"></a>11133             }
<a name="l11134"></a>11134 
<a name="l11135"></a>11135             <span class="keywordtype">string</span> strTempIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>);
<a name="l11136"></a>11136 
<a name="l11137"></a>11137             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempIndices))
<a name="l11138"></a>11138             {
<a name="l11139"></a>11139                 strIndices = strTempIndices;
<a name="l11140"></a>11140             }
<a name="l11141"></a>11141         }
<a name="l11142"></a>11142 
<a name="l11143"></a>11143         int32_t nDetails = <a class="code" href="class_o_t___command.html#a713ae075bb9e79d53a18b78f55482a7e">details_del_mail</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strIndices);
<a name="l11144"></a>11144         <span class="keywordflow">return</span> nDetails;
<a name="l11145"></a>11145     }
<a name="l11146"></a>11146 
<a name="l11147"></a>11147     <span class="keywordflow">return</span> -1;
<a name="l11148"></a>11148 }
<a name="l11149"></a>11149 
<a name="l11150"></a>11150 
<a name="l11151"></a><a class="code" href="class_o_t___command.html#a88bcbfa212e9c868a638500b1c0143b8">11151</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a88bcbfa212e9c868a638500b1c0143b8">OT_Command::main_show_mail</a>()
<a name="l11152"></a>11152 {
<a name="l11153"></a>11153     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE:   mail --mynym MY_NYM_ID   (To list all the mail messages for mynym.)\n Also:   mail --args \&quot;index 5\&quot;  (To examine a specific message.)\n\n&quot;</span>;
<a name="l11154"></a>11154     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11155"></a>11155 
<a name="l11156"></a>11156     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11157"></a>11157     {
<a name="l11158"></a>11158         <span class="keywordflow">return</span> -1;
<a name="l11159"></a>11159     }
<a name="l11160"></a>11160 
<a name="l11161"></a>11161     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#abee93614f4a19e0461a51981d2004044">OTAPI_Wrap::GetNym_MailCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l11162"></a>11162     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l11163"></a>11163     {
<a name="l11164"></a>11164         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_MailCount for Nym: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11165"></a>11165         <span class="keywordflow">return</span> -1;
<a name="l11166"></a>11166     }
<a name="l11167"></a>11167 
<a name="l11168"></a>11168     <span class="keywordflow">if</span> (0 == nCount)
<a name="l11169"></a>11169     {
<a name="l11170"></a>11170         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n(Mail is empty.)\n\n&quot;</span>);
<a name="l11171"></a>11171         <span class="keywordflow">return</span> 0;
<a name="l11172"></a>11172     }
<a name="l11173"></a>11173 
<a name="l11174"></a>11174     <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11175"></a>11175     int32_t nIndex = -1;
<a name="l11176"></a>11176 
<a name="l11177"></a>11177     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l11178"></a>11178     {
<a name="l11179"></a>11179         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l11180"></a>11180         <span class="comment">//                                  const std::string str_key)</span>
<a name="l11181"></a>11181         <span class="comment">//</span>
<a name="l11182"></a>11182         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l11183"></a>11183         <span class="comment">// EXAMPLE:  --args &quot;index 5 &quot;</span>
<a name="l11184"></a>11184         <span class="comment">//</span>
<a name="l11185"></a>11185         strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l11186"></a>11186 
<a name="l11187"></a>11187         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l11188"></a>11188         {
<a name="l11189"></a>11189             nIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l11190"></a>11190         }
<a name="l11191"></a>11191     }
<a name="l11192"></a>11192 
<a name="l11193"></a>11193     <span class="comment">//</span>
<a name="l11194"></a>11194     int32_t nReturnVal = 1;
<a name="l11195"></a>11195 
<a name="l11196"></a>11196     <span class="keywordflow">if</span> (nIndex &gt; -1)
<a name="l11197"></a>11197     {
<a name="l11198"></a>11198         nReturnVal = <a class="code" href="class_o_t___command.html#a16a30dfd9fa792e6fa12c5874964d90e">show_mail_message</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">true</span>) ? 1 : -1;
<a name="l11199"></a>11199     }
<a name="l11200"></a>11200     <span class="keywordflow">else</span>
<a name="l11201"></a>11201     {
<a name="l11202"></a>11202         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n Mail contents:\n\n&quot;</span>);
<a name="l11203"></a>11203 
<a name="l11204"></a>11204         <span class="keywordflow">for</span> (nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l11205"></a>11205         {
<a name="l11206"></a>11206             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#a16a30dfd9fa792e6fa12c5874964d90e">show_mail_message</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">false</span>))
<a name="l11207"></a>11207             {
<a name="l11208"></a>11208                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;show_mail_message returned false. I&#39;ll finish out the loop, but that&#39;s weird.\n&quot;</span>);
<a name="l11209"></a>11209                 nReturnVal = -1;
<a name="l11210"></a>11210             }
<a name="l11211"></a>11211         }
<a name="l11212"></a>11212     }
<a name="l11213"></a>11213     <span class="keywordflow">return</span> nReturnVal;
<a name="l11214"></a>11214 }
<a name="l11215"></a>11215 
<a name="l11216"></a>11216 <span class="comment">//pScript-&gt;chai.add(fun(&amp;OTAPI_Wrap::Nym_RemoveMailByIndex), &quot;OT_API_Nym_RemoveMailByIndex&quot;);</span>
<a name="l11217"></a>11217 
<a name="l11218"></a>11218 
<a name="l11219"></a><a class="code" href="class_o_t___command.html#ae0d4326651156578feb0f55999f0dfb1">11219</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ae0d4326651156578feb0f55999f0dfb1">OT_Command::show_outmail_message</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">bool</span> bShowContents)
<a name="l11220"></a>11220 {
<a name="l11221"></a>11221     <span class="keywordtype">bool</span> bMailVerified = <a class="code" href="class_o_t_a_p_i___wrap.html#a26180fe473f6fee1efa0c2f0be095d9e">OTAPI_Wrap::Nym_VerifyOutmailByIndex</a>(strMyNymID, nIndex);
<a name="l11222"></a>11222 
<a name="l11223"></a>11223     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(bMailVerified))
<a name="l11224"></a>11224     {
<a name="l11225"></a>11225         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_Nym_VerifyOutmailByIndex at Index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11226"></a>11226         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11227"></a>11227     }
<a name="l11228"></a>11228 
<a name="l11229"></a>11229     <span class="keywordflow">if</span> (!bMailVerified) <span class="comment">// 1 meaning OT_TRUE.</span>
<a name="l11230"></a>11230     {
<a name="l11231"></a>11231         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;UNVERIFIED sent (outgoing) mail! At index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11232"></a>11232         <span class="comment">//      return false;</span>
<a name="l11233"></a>11233     }
<a name="l11234"></a>11234 
<a name="l11235"></a>11235     <span class="keywordflow">else</span>
<a name="l11236"></a>11236     {
<a name="l11237"></a>11237         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;--------------------------------------------------------\nVerified outmail at index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l11238"></a>11238     }
<a name="l11239"></a>11239 
<a name="l11240"></a>11240     <span class="keywordtype">string</span> strMailServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#ab7b4f640fcb700924578894d1d1a0d9d">OTAPI_Wrap::GetNym_OutmailServerIDByIndex</a>(strMyNymID, nIndex);
<a name="l11241"></a>11241     <span class="keywordtype">string</span> strMailRecipientID = <a class="code" href="class_o_t_a_p_i___wrap.html#a4c2cf6833cabdb3b5c389752c0ced7c0">OTAPI_Wrap::GetNym_OutmailRecipientIDByIndex</a>(strMyNymID, nIndex);
<a name="l11242"></a>11242     <span class="keywordtype">string</span> strMailContents = <a class="code" href="class_o_t_a_p_i___wrap.html#ac602409047d0d0a6896f1e403b280c52">OTAPI_Wrap::GetNym_OutmailContentsByIndex</a>(strMyNymID, nIndex);
<a name="l11243"></a>11243 
<a name="l11244"></a>11244     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailRecipientID))
<a name="l11245"></a>11245     {
<a name="l11246"></a>11246         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Mail was sent to: &quot;</span> + strMailRecipientID);
<a name="l11247"></a>11247     }
<a name="l11248"></a>11248     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailServerID))
<a name="l11249"></a>11249     {
<a name="l11250"></a>11250         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;At server ID: &quot;</span> + strMailServerID);
<a name="l11251"></a>11251     }
<a name="l11252"></a>11252     <span class="keywordflow">if</span> (bShowContents &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailContents))
<a name="l11253"></a>11253     {
<a name="l11254"></a>11254         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;Contents:\n&quot;</span> + strMailContents + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11255"></a>11255     }
<a name="l11256"></a>11256     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l11257"></a>11257 }
<a name="l11258"></a>11258 
<a name="l11259"></a>11259 
<a name="l11260"></a><a class="code" href="class_o_t___command.html#a07249f520569965c07ffe29017c60f91">11260</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a07249f520569965c07ffe29017c60f91">OT_Command::main_show_outmail</a>()
<a name="l11261"></a>11261 {
<a name="l11262"></a>11262     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE:   outmail --mynym MY_NYM_ID   (To list all the sent mail messages for mynym.)\n Also:   outmail --args \&quot;index 5\&quot;  (To examine a specific message.)\n\n&quot;</span>;
<a name="l11263"></a>11263     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11264"></a>11264 
<a name="l11265"></a>11265     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11266"></a>11266     {
<a name="l11267"></a>11267         <span class="keywordflow">return</span> -1;
<a name="l11268"></a>11268     }
<a name="l11269"></a>11269 
<a name="l11270"></a>11270     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2bf01a333520cc12fb4be0c0163a0154">OTAPI_Wrap::GetNym_OutmailCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l11271"></a>11271     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l11272"></a>11272     {
<a name="l11273"></a>11273         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_OutmailCount for Nym: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11274"></a>11274         <span class="keywordflow">return</span> -1;
<a name="l11275"></a>11275     }
<a name="l11276"></a>11276 
<a name="l11277"></a>11277     <span class="keywordflow">if</span> (0 == nCount)
<a name="l11278"></a>11278     {
<a name="l11279"></a>11279         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n(Outmail box is empty.)\n\n&quot;</span>);
<a name="l11280"></a>11280         <span class="keywordflow">return</span> 0;
<a name="l11281"></a>11281     }
<a name="l11282"></a>11282 
<a name="l11283"></a>11283     <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11284"></a>11284     int32_t nIndex = -1;
<a name="l11285"></a>11285 
<a name="l11286"></a>11286     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l11287"></a>11287     {
<a name="l11288"></a>11288         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l11289"></a>11289         <span class="comment">//                                  const std::string str_key)</span>
<a name="l11290"></a>11290         <span class="comment">//</span>
<a name="l11291"></a>11291         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l11292"></a>11292         <span class="comment">// EXAMPLE:  --args &quot;index 5 &quot;</span>
<a name="l11293"></a>11293         <span class="comment">//</span>
<a name="l11294"></a>11294         strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l11295"></a>11295 
<a name="l11296"></a>11296         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l11297"></a>11297         {
<a name="l11298"></a>11298             nIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l11299"></a>11299         }
<a name="l11300"></a>11300     }
<a name="l11301"></a>11301 
<a name="l11302"></a>11302     int32_t nReturnVal = 1;
<a name="l11303"></a>11303 
<a name="l11304"></a>11304     <span class="keywordflow">if</span> (nIndex &gt; -1)
<a name="l11305"></a>11305     {
<a name="l11306"></a>11306         nReturnVal = <a class="code" href="class_o_t___command.html#ae0d4326651156578feb0f55999f0dfb1">show_outmail_message</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">true</span>) ? 1 : -1;
<a name="l11307"></a>11307     }
<a name="l11308"></a>11308     <span class="keywordflow">else</span>
<a name="l11309"></a>11309     {
<a name="l11310"></a>11310         <span class="keywordflow">for</span> (nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l11311"></a>11311         {
<a name="l11312"></a>11312             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#ae0d4326651156578feb0f55999f0dfb1">show_outmail_message</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">false</span>))
<a name="l11313"></a>11313             {
<a name="l11314"></a>11314                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;show_outmail_message returned false. I&#39;ll finish out the loop, but that&#39;s weird.\n&quot;</span>);
<a name="l11315"></a>11315                 nReturnVal = -1;
<a name="l11316"></a>11316             }
<a name="l11317"></a>11317         }
<a name="l11318"></a>11318     }
<a name="l11319"></a>11319 
<a name="l11320"></a>11320     <span class="keywordflow">return</span> nReturnVal;
<a name="l11321"></a>11321 }
<a name="l11322"></a>11322 
<a name="l11323"></a>11323 
<a name="l11324"></a><a class="code" href="class_o_t___command.html#ac7716cc41edc7703d8b25aa08725a2af">11324</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#ac7716cc41edc7703d8b25aa08725a2af">OT_Command::details_del_outmail</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNymID, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strIndices)
<a name="l11325"></a>11325 {
<a name="l11326"></a>11326 
<a name="l11327"></a>11327     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2bf01a333520cc12fb4be0c0163a0154">OTAPI_Wrap::GetNym_OutmailCount</a>(strMyNymID);
<a name="l11328"></a>11328     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l11329"></a>11329     {
<a name="l11330"></a>11330         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_OutmailCount for Nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11331"></a>11331         <span class="keywordflow">return</span> -1;
<a name="l11332"></a>11332     }
<a name="l11333"></a>11333 
<a name="l11334"></a>11334     <span class="keywordflow">if</span> (0 == nCount)
<a name="l11335"></a>11335     {
<a name="l11336"></a>11336         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n(Outgoing mail is empty.)\n\n&quot;</span>);
<a name="l11337"></a>11337         <span class="keywordflow">return</span> 0;
<a name="l11338"></a>11338     }
<a name="l11339"></a>11339 
<a name="l11340"></a>11340     <span class="keywordtype">bool</span> bIndices = <a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndices);
<a name="l11341"></a>11341     <span class="keywordtype">bool</span> bDeleteAll = <span class="keyword">false</span>;
<a name="l11342"></a>11342 
<a name="l11343"></a>11343     <span class="keywordflow">if</span> (bIndices &amp;&amp; (<span class="stringliteral">&quot;all&quot;</span> == strIndices))
<a name="l11344"></a>11344     {
<a name="l11345"></a>11345         bDeleteAll = <span class="keyword">true</span>;
<a name="l11346"></a>11346     }
<a name="l11347"></a>11347 
<a name="l11348"></a>11348     int32_t nIndicesCount = (bIndices &amp;&amp; !bDeleteAll) ? <a class="code" href="class_o_t_a_p_i___wrap.html#a1e28bbcccdf1906a0bb470b58e05b0b5">OTAPI_Wrap::NumList_Count</a>(strIndices) : 0;
<a name="l11349"></a>11349 
<a name="l11350"></a>11350     <span class="comment">// If we&#39;re not deleting ALL, then we must be deleting SPECIFC indices.</span>
<a name="l11351"></a>11351     <span class="comment">// But no specific indices were supplied!</span>
<a name="l11352"></a>11352     <span class="comment">// Therefore, error.</span>
<a name="l11353"></a>11353     <span class="comment">//</span>
<a name="l11354"></a>11354     <span class="keywordflow">if</span> (!bDeleteAll &amp;&amp; (nIndicesCount &lt; 1))
<a name="l11355"></a>11355     {
<a name="l11356"></a>11356         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Problem: You&#39;re apparently not deleting \&quot;all\&quot; indices, but neither have you selected SPECIFIC indices.\n Try adding: --args \&quot;indices 4,6,7\&quot; (for deleting the outgoing messages at indices 4, 6, and 7, for example.)\n\n&quot;</span>);
<a name="l11357"></a>11357         <span class="keywordflow">return</span> -1;
<a name="l11358"></a>11358     }
<a name="l11359"></a>11359 
<a name="l11360"></a>11360     int32_t nReturnVal = 1;
<a name="l11361"></a>11361 
<a name="l11362"></a>11362     <span class="keywordflow">for</span> (int32_t nIndex = (nCount - 1); nIndex &gt;= 0; --nIndex)
<a name="l11363"></a>11363     {
<a name="l11364"></a>11364 
<a name="l11365"></a>11365         <span class="comment">// If we&#39;re not deleting &quot;all&quot; (i.e. we&#39;re deleting specific indices)...</span>
<a name="l11366"></a>11366         <span class="comment">// and the current index doesn&#39;t appear on that specified list, then continue...</span>
<a name="l11367"></a>11367         <span class="comment">//</span>
<a name="l11368"></a>11368         <span class="keywordflow">if</span> (!bDeleteAll &amp;&amp; !<a class="code" href="class_o_t_a_p_i___wrap.html#a42d06a7e415c688d45a07f74d33f193c">OTAPI_Wrap::NumList_VerifyQuery</a>(strIndices, <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex)))
<a name="l11369"></a>11369         {
<a name="l11370"></a>11370             <span class="comment">// We skip any indices that the user isn&#39;t trying to delete.</span>
<a name="l11371"></a>11371             <span class="comment">//          continue // apparently not supported by the language.</span>
<a name="l11372"></a>11372         }
<a name="l11373"></a>11373 
<a name="l11374"></a>11374         <span class="comment">// Let&#39;s try to remove it...</span>
<a name="l11375"></a>11375         <span class="comment">//</span>
<a name="l11376"></a>11376         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___wrap.html#a5d067398b1afbfff0e6c855c3dec79f1">OTAPI_Wrap::Nym_RemoveOutmailByIndex</a>(strMyNymID, nIndex))
<a name="l11377"></a>11377         {
<a name="l11378"></a>11378             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Deleted outgoing mail at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; for nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l11379"></a>11379         }
<a name="l11380"></a>11380         <span class="keywordflow">else</span>
<a name="l11381"></a>11381         {
<a name="l11382"></a>11382             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error while trying to delete outgoing mail at index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot; for nym: &quot;</span> + strMyNymID + <span class="stringliteral">&quot; \n&quot;</span>);
<a name="l11383"></a>11383             nReturnVal = -1;
<a name="l11384"></a>11384         }
<a name="l11385"></a>11385     } <span class="comment">// for</span>
<a name="l11386"></a>11386 
<a name="l11387"></a>11387     <span class="keywordflow">return</span> nReturnVal;
<a name="l11388"></a>11388 }
<a name="l11389"></a>11389 
<a name="l11390"></a>11390 
<a name="l11391"></a><a class="code" href="class_o_t___command.html#a045ad8fd23c92b1b6865453ae1298f7c">11391</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a045ad8fd23c92b1b6865453ae1298f7c">OT_Command::main_del_outmail</a>()
<a name="l11392"></a>11392 {
<a name="l11393"></a>11393     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE:   deloutmail --mynym MY_NYM_ID --args \&quot;index 5\&quot;  (To delete outmail message 5.)\n Also, try: --args \&quot;indices all\&quot; (for all outgoing messages)\n As well as: --args \&quot;indices 3,5,6\&quot; (for outgoing messages 3, 5, and 6)\n\n&quot;</span>;
<a name="l11394"></a>11394     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11395"></a>11395 
<a name="l11396"></a>11396     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11397"></a>11397     {
<a name="l11398"></a>11398         <span class="keywordtype">string</span> strIndices = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11399"></a>11399 
<a name="l11400"></a>11400         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l11401"></a>11401         {
<a name="l11402"></a>11402             <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l11403"></a>11403             <span class="comment">//                                  const std::string str_key)</span>
<a name="l11404"></a>11404             <span class="comment">//</span>
<a name="l11405"></a>11405             <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l11406"></a>11406             <span class="comment">// EXAMPLE:  --args &quot;index 5 &quot;</span>
<a name="l11407"></a>11407             <span class="comment">//</span>
<a name="l11408"></a>11408 
<a name="l11409"></a>11409             <span class="keywordtype">string</span> strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l11410"></a>11410 
<a name="l11411"></a>11411             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l11412"></a>11412             {
<a name="l11413"></a>11413                 strIndices = strIndex;
<a name="l11414"></a>11414             }
<a name="l11415"></a>11415 
<a name="l11416"></a>11416             <span class="keywordtype">string</span> strTempIndices = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;indices&quot;</span>);
<a name="l11417"></a>11417 
<a name="l11418"></a>11418             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempIndices))
<a name="l11419"></a>11419             {
<a name="l11420"></a>11420                 strIndices = strTempIndices;
<a name="l11421"></a>11421             }
<a name="l11422"></a>11422         }
<a name="l11423"></a>11423 
<a name="l11424"></a>11424         int32_t nDetails = <a class="code" href="class_o_t___command.html#ac7716cc41edc7703d8b25aa08725a2af">details_del_outmail</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strIndices);
<a name="l11425"></a>11425         <span class="keywordflow">return</span> nDetails;
<a name="l11426"></a>11426     }
<a name="l11427"></a>11427 
<a name="l11428"></a>11428     <span class="keywordflow">return</span> -1;
<a name="l11429"></a>11429 }
<a name="l11430"></a>11430 
<a name="l11431"></a>11431 
<a name="l11432"></a><a class="code" href="class_o_t___command.html#acbfdfdeee2de0cbd0a1146901993666b">11432</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t___command.html#acbfdfdeee2de0cbd0a1146901993666b">OT_Command::show_outpayment</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; strMyNym, <span class="keyword">const</span> int32_t nIndex, <span class="keyword">const</span> <span class="keywordtype">bool</span> bShowInFull)
<a name="l11433"></a>11433 {
<a name="l11434"></a>11434     <span class="keywordtype">bool</span> bMailVerified = <a class="code" href="class_o_t_a_p_i___wrap.html#ab9efd37d44a302e529e18013ea6a0b38">OTAPI_Wrap::Nym_VerifyOutpaymentsByIndex</a>(strMyNym, nIndex);
<a name="l11435"></a>11435 
<a name="l11436"></a>11436     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a7333cee91a6a34abe00d628f13596e3b">VerifyBoolVal</a>(bMailVerified))
<a name="l11437"></a>11437     {
<a name="l11438"></a>11438         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_Nym_VerifyOutpaymentsByIndex at Index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11439"></a>11439         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11440"></a>11440     }
<a name="l11441"></a>11441 
<a name="l11442"></a>11442     <span class="keywordflow">if</span> (!bMailVerified) <span class="comment">// 1 meaning OT_TRUE.</span>
<a name="l11443"></a>11443     {
<a name="l11444"></a>11444         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;UNVERIFIED sent (outgoing) payment! At index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex));
<a name="l11445"></a>11445         <span class="comment">//      return false;</span>
<a name="l11446"></a>11446     }
<a name="l11447"></a>11447 
<a name="l11448"></a>11448     <span class="keywordflow">else</span>
<a name="l11449"></a>11449     {
<a name="l11450"></a>11450         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;\n----------------------------------------------\n(index &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l11451"></a>11451     }
<a name="l11452"></a>11452 
<a name="l11453"></a>11453     <span class="keywordtype">string</span> strMailServerID = <a class="code" href="class_o_t_a_p_i___wrap.html#a38c7e7d4b3fc44afeabbd5d2b366355a">OTAPI_Wrap::GetNym_OutpaymentsServerIDByIndex</a>(strMyNym, nIndex);
<a name="l11454"></a>11454     <span class="keywordtype">string</span> strMailRecipientID = <a class="code" href="class_o_t_a_p_i___wrap.html#a721451913a7bd776050c2de68530060e">OTAPI_Wrap::GetNym_OutpaymentsRecipientIDByIndex</a>(strMyNym, nIndex);
<a name="l11455"></a>11455     <span class="keywordtype">string</span> strMailContents = <a class="code" href="class_o_t_a_p_i___wrap.html#a75db1f5164e65a9ddabef0fc551a4e3d">OTAPI_Wrap::GetNym_OutpaymentsContentsByIndex</a>(strMyNym, nIndex);
<a name="l11456"></a>11456 
<a name="l11457"></a>11457     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailContents))
<a name="l11458"></a>11458     {
<a name="l11459"></a>11459         int64_t lPaymentAmount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2db31aab9857deb6907204e388b1a8b4">OTAPI_Wrap::Instrmnt_GetAmount</a>(strMailContents);
<a name="l11460"></a>11460         <span class="keywordtype">string</span> strPaymentAmount = <span class="stringliteral">&quot;UNKNOWN_PAYMENT_AMOUNT&quot;</span>;
<a name="l11461"></a>11461 
<a name="l11462"></a>11462         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lPaymentAmount))
<a name="l11463"></a>11463         {
<a name="l11464"></a>11464             strPaymentAmount = <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(lPaymentAmount);
<a name="l11465"></a>11465         }
<a name="l11466"></a>11466 
<a name="l11467"></a>11467         <span class="keywordtype">string</span> strPaymentAssetID = <a class="code" href="class_o_t_a_p_i___wrap.html#ae01337d233081e5deb560e9ded9048a5">OTAPI_Wrap::Instrmnt_GetAssetID</a>(strMailContents);
<a name="l11468"></a>11468         <span class="keywordtype">string</span> strPaymentType = <a class="code" href="class_o_t_a_p_i___wrap.html#ad68e5c598090ab277e7ecad0e5ae9312">OTAPI_Wrap::Instrmnt_GetType</a>(strMailContents);
<a name="l11469"></a>11469 
<a name="l11470"></a>11470         <span class="keywordtype">string</span> strFormatted = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11471"></a>11471         <span class="keywordtype">string</span> strAssetTypeName = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11472"></a>11472 
<a name="l11473"></a>11473         <span class="keywordtype">string</span> strRecipientString = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11474"></a>11474         <span class="keywordtype">string</span> strServerString = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11475"></a>11475 
<a name="l11476"></a>11476         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailRecipientID))
<a name="l11477"></a>11477         {
<a name="l11478"></a>11478             <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#acb21f65d80ac8f5a1e01ddbd61a01bb4">OTAPI_Wrap::GetNym_Name</a>(strMailRecipientID);
<a name="l11479"></a>11479             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strName)) { strName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l11480"></a>11480             strRecipientString = <span class="stringliteral">&quot;Payment sent to: &quot;</span> + strMailRecipientID + <span class="stringliteral">&quot; \&quot;&quot;</span> + strName + <span class="stringliteral">&quot;\&quot; &quot;</span>;
<a name="l11481"></a>11481         }
<a name="l11482"></a>11482         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strMailServerID))
<a name="l11483"></a>11483         {
<a name="l11484"></a>11484             <span class="keywordtype">string</span> strName = <a class="code" href="class_o_t_a_p_i___wrap.html#a856f371dd21dba6d6777b6bd087b9518">OTAPI_Wrap::GetServer_Name</a>(strMailServerID);
<a name="l11485"></a>11485             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strName)) { strName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l11486"></a>11486             strServerString = <span class="stringliteral">&quot;   At server ID: &quot;</span> + strMailServerID + <span class="stringliteral">&quot; \&quot;&quot;</span> + strName + <span class="stringliteral">&quot;\&quot; &quot;</span>;
<a name="l11487"></a>11487         }
<a name="l11488"></a>11488 
<a name="l11489"></a>11489         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPaymentAssetID))
<a name="l11490"></a>11490         {
<a name="l11491"></a>11491             strAssetTypeName = <a class="code" href="class_o_t_a_p_i___wrap.html#a5ef7d7ae416f5c4d8ca0242afd5f4216">OTAPI_Wrap::GetAssetType_Name</a>(strPaymentAssetID);
<a name="l11492"></a>11492             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strAssetTypeName)) { strAssetTypeName = <span class="stringliteral">&quot;&quot;</span>; }
<a name="l11493"></a>11493         }
<a name="l11494"></a>11494         <span class="keywordflow">else</span>
<a name="l11495"></a>11495         {
<a name="l11496"></a>11496             strPaymentAssetID = <span class="stringliteral">&quot;UNKNOWN_ASSET_ID&quot;</span>;
<a name="l11497"></a>11497         }
<a name="l11498"></a>11498 
<a name="l11499"></a>11499         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(lPaymentAmount))
<a name="l11500"></a>11500         {
<a name="l11501"></a>11501             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strPaymentType)) { strPaymentType = <span class="stringliteral">&quot;UNKNOWN_PAYMENT_TYPE&quot;</span>; }
<a name="l11502"></a>11502             <span class="keywordtype">string</span> strTempFormat;
<a name="l11503"></a>11503             <span class="keywordflow">if</span> ((lPaymentAmount &gt; -1))
<a name="l11504"></a>11504             {
<a name="l11505"></a>11505                 strTempFormat = <a class="code" href="class_o_t_a_p_i___wrap.html#a1fe9fb17882704fc0f56a975ae765b23">OTAPI_Wrap::FormatAmount</a>(strPaymentAssetID, lPaymentAmount);
<a name="l11506"></a>11506             }
<a name="l11507"></a>11507             <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strTempFormat))  { strTempFormat = strPaymentAmount; }
<a name="l11508"></a>11508 
<a name="l11509"></a>11509             strFormatted = <span class="stringliteral">&quot;( &quot;</span> + strPaymentType + <span class="stringliteral">&quot;: &quot;</span> + strTempFormat + <span class="stringliteral">&quot; )&quot;</span>;
<a name="l11510"></a>11510         }
<a name="l11511"></a>11511 
<a name="l11512"></a>11512         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;         Amount: &quot;</span> + strPaymentAmount + <span class="stringliteral">&quot;  &quot;</span> + strFormatted);
<a name="l11513"></a>11513         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strRecipientString);
<a name="l11514"></a>11514         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;  Of asset type: &quot;</span> + strPaymentAssetID + <span class="stringliteral">&quot; \&quot;&quot;</span> + strAssetTypeName + <span class="stringliteral">&quot;\&quot; &quot;</span>);
<a name="l11515"></a>11515         <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strServerString);
<a name="l11516"></a>11516 
<a name="l11517"></a>11517         <span class="keywordflow">if</span> (bShowInFull)
<a name="l11518"></a>11518         {
<a name="l11519"></a>11519             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(<span class="stringliteral">&quot;     Instrument: \n&quot;</span> + strMailContents + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11520"></a>11520         }
<a name="l11521"></a>11521     }
<a name="l11522"></a>11522     <span class="keywordflow">else</span>
<a name="l11523"></a>11523     {
<a name="l11524"></a>11524         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_OutpaymentsContentsByIndex at Index: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nIndex) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11525"></a>11525         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11526"></a>11526     }
<a name="l11527"></a>11527 
<a name="l11528"></a>11528     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l11529"></a>11529 }
<a name="l11530"></a>11530 
<a name="l11531"></a>11531 
<a name="l11532"></a><a class="code" href="class_o_t___command.html#a7a1e04f23357a2bfbc090fff6719343c">11532</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a7a1e04f23357a2bfbc090fff6719343c">OT_Command::main_show_outpayment</a>()
<a name="l11533"></a>11533 {
<a name="l11534"></a>11534     <span class="keywordtype">string</span> strUsage = <span class="stringliteral">&quot;USAGE:   outpayment --mynym MY_NYM_ID --args \&quot;index 5\&quot;   (for example)\nIf no index is specified, all outgoing payments are listed.\n&quot;</span>;
<a name="l11535"></a>11535     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11536"></a>11536 
<a name="l11537"></a>11537     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11538"></a>11538     {
<a name="l11539"></a>11539         <span class="keywordflow">return</span> -1;
<a name="l11540"></a>11540     }
<a name="l11541"></a>11541 
<a name="l11542"></a>11542     <span class="keywordtype">string</span> strIndex = <span class="stringliteral">&quot;&quot;</span>;
<a name="l11543"></a>11543     int32_t nIndex = -1;
<a name="l11544"></a>11544 
<a name="l11545"></a>11545     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Args&quot;</span>, <span class="keyword">false</span>))
<a name="l11546"></a>11546     {
<a name="l11547"></a>11547         <span class="comment">// std::string OT_CLI_GetValueByKey(const std::string str_Args,</span>
<a name="l11548"></a>11548         <span class="comment">//                                  const std::string str_key)</span>
<a name="l11549"></a>11549         <span class="comment">//</span>
<a name="l11550"></a>11550         <span class="comment">// OPTION:   --args &quot;key value key value&quot;</span>
<a name="l11551"></a>11551         <span class="comment">// EXAMPLE:  --args &quot;index 5 &quot;</span>
<a name="l11552"></a>11552         <span class="comment">//</span>
<a name="l11553"></a>11553         strIndex = <a class="code" href="_o_t___m_e_8hpp.html#ae0e236e348eff6aad2d8e0ee83203cbb">OT_CLI_GetValueByKey</a>(<a class="code" href="ot__otapi__ot_8hpp.html#ae52e8d3079ca7b992dd0285828e4f5cd">Args</a>, <span class="stringliteral">&quot;index&quot;</span>); <span class="comment">// OTNumList will be used for this value.</span>
<a name="l11554"></a>11554 
<a name="l11555"></a>11555         <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strIndex))
<a name="l11556"></a>11556         {
<a name="l11557"></a>11557             nIndex = <a class="code" href="ot__otapi__ot_8hpp.html#acc730be4d7088866cf9c18ca23d7d5e7">to_int</a>(strIndex);
<a name="l11558"></a>11558         }
<a name="l11559"></a>11559     }
<a name="l11560"></a>11560 
<a name="l11561"></a>11561     <span class="comment">//</span>
<a name="l11562"></a>11562     int32_t nCount = <a class="code" href="class_o_t_a_p_i___wrap.html#a2867a2de7baa62a90e24487bc1b7f8d4">OTAPI_Wrap::GetNym_OutpaymentsCount</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>);
<a name="l11563"></a>11563     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a3b5867c23a08707f6b1df41d04e7d5d3">VerifyIntVal</a>(nCount))
<a name="l11564"></a>11564     {
<a name="l11565"></a>11565         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Error: bad result from OT_API_GetNym_OutpaymentsCount for Nym: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a> + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11566"></a>11566         <span class="keywordflow">return</span> -1;
<a name="l11567"></a>11567     }
<a name="l11568"></a>11568 
<a name="l11569"></a>11569     <span class="keywordflow">if</span> (0 == nCount)
<a name="l11570"></a>11570     {
<a name="l11571"></a>11571         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nSent (outgoing) payments box is empty.\n\n&quot;</span>);
<a name="l11572"></a>11572         <span class="keywordflow">return</span> 0;
<a name="l11573"></a>11573     }
<a name="l11574"></a>11574 
<a name="l11575"></a>11575     <span class="keywordflow">if</span> (!(nIndex &lt; nCount))
<a name="l11576"></a>11576     {
<a name="l11577"></a>11577         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\nIndex (&quot;</span> + strIndex + <span class="stringliteral">&quot;) out of bounds. (Acceptable range is 0 to &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nCount - 1) + <span class="stringliteral">&quot;.)\n\n&quot;</span>);
<a name="l11578"></a>11578         <span class="keywordflow">return</span> 0;
<a name="l11579"></a>11579     }
<a name="l11580"></a>11580 
<a name="l11581"></a>11581     int32_t nReturnVal = 1;
<a name="l11582"></a>11582 
<a name="l11583"></a>11583     <span class="keywordflow">if</span> (nIndex &gt; -1)
<a name="l11584"></a>11584     {
<a name="l11585"></a>11585         <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#acbfdfdeee2de0cbd0a1146901993666b">show_outpayment</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">true</span>))  { nReturnVal = -1; }
<a name="l11586"></a>11586     }
<a name="l11587"></a>11587     <span class="keywordflow">else</span>
<a name="l11588"></a>11588     {
<a name="l11589"></a>11589         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n===&gt; SHOW OUTGOING PAYMENTS:\n&quot;</span>);
<a name="l11590"></a>11590 
<a name="l11591"></a>11591         <span class="keywordflow">for</span> (nIndex = 0; nIndex &lt; nCount; ++nIndex)
<a name="l11592"></a>11592         {
<a name="l11593"></a>11593             <span class="keywordflow">if</span> (!<a class="code" href="class_o_t___command.html#acbfdfdeee2de0cbd0a1146901993666b">show_outpayment</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, nIndex, <span class="keyword">false</span>))  { nReturnVal = -1; }
<a name="l11594"></a>11594         }
<a name="l11595"></a>11595     }
<a name="l11596"></a>11596     <span class="keywordflow">return</span> nReturnVal;
<a name="l11597"></a>11597 }
<a name="l11598"></a>11598 
<a name="l11599"></a>11599 
<a name="l11600"></a><a class="code" href="class_o_t___command.html#afaadb0a5fba7c832c32e2eea4e1ff59e">11600</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#afaadb0a5fba7c832c32e2eea4e1ff59e">OT_Command::main_add_server</a>()
<a name="l11601"></a>11601 {
<a name="l11602"></a>11602     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please paste a server contract, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l11603"></a>11603 
<a name="l11604"></a>11604     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l11605"></a>11605     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l11606"></a>11606     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l11607"></a>11607     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l11608"></a>11608 
<a name="l11609"></a>11609     <span class="keywordtype">string</span> strContract = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l11610"></a>11610 
<a name="l11611"></a>11611     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l11612"></a>11612     {
<a name="l11613"></a>11613         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, You must input a server contract, in order to add it to your wallet.\n\n&quot;</span>);
<a name="l11614"></a>11614         <span class="keywordflow">return</span> -1;
<a name="l11615"></a>11615     }
<a name="l11616"></a>11616 
<a name="l11617"></a>11617 
<a name="l11618"></a>11618     int32_t nAdded = <a class="code" href="class_o_t_a_p_i___wrap.html#ad0bd17560026d962636565342242791e">OTAPI_Wrap::AddServerContract</a>(strContract);
<a name="l11619"></a>11619 
<a name="l11620"></a>11620     <span class="keywordflow">if</span> (1 != nAdded)
<a name="l11621"></a>11621     {
<a name="l11622"></a>11622         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, failed. Are you sure that was a server contract?\n\n&quot;</span>);
<a name="l11623"></a>11623         <span class="keywordflow">return</span> -1;
<a name="l11624"></a>11624     }
<a name="l11625"></a>11625 
<a name="l11626"></a>11626     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Success adding server contract to your wallet.\n\n&quot;</span>);
<a name="l11627"></a>11627     <span class="keywordflow">return</span> 1;
<a name="l11628"></a>11628 }
<a name="l11629"></a>11629 
<a name="l11630"></a>11630 
<a name="l11631"></a><a class="code" href="class_o_t___command.html#a3e3fdaa96795a190c15113c9e0471c18">11631</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#a3e3fdaa96795a190c15113c9e0471c18">OT_Command::main_add_asset</a>()
<a name="l11632"></a>11632 {
<a name="l11633"></a>11633     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please paste a currency contract, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l11634"></a>11634 
<a name="l11635"></a>11635     <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l11636"></a>11636     <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l11637"></a>11637     <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l11638"></a>11638     <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l11639"></a>11639 
<a name="l11640"></a>11640     <span class="keywordtype">string</span> strContract = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l11641"></a>11641 
<a name="l11642"></a>11642     <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l11643"></a>11643     {
<a name="l11644"></a>11644         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, You must input a currency contract, in order to add it to your wallet.\n\n&quot;</span>);
<a name="l11645"></a>11645         <span class="keywordflow">return</span> -1;
<a name="l11646"></a>11646     }
<a name="l11647"></a>11647 
<a name="l11648"></a>11648 
<a name="l11649"></a>11649     int32_t nAdded = <a class="code" href="class_o_t_a_p_i___wrap.html#a7678a0304b5a3daaf599b8f05eb65511">OTAPI_Wrap::AddAssetContract</a>(strContract);
<a name="l11650"></a>11650 
<a name="l11651"></a>11651     <span class="keywordflow">if</span> (1 != nAdded)
<a name="l11652"></a>11652     {
<a name="l11653"></a>11653         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, failed. Are you sure that was an asset contract?\n\n&quot;</span>);
<a name="l11654"></a>11654         <span class="keywordflow">return</span> -1;
<a name="l11655"></a>11655     }
<a name="l11656"></a>11656 
<a name="l11657"></a>11657     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Success adding asset contract to your wallet.\n\n&quot;</span>);
<a name="l11658"></a>11658     <span class="keywordflow">return</span> 1;
<a name="l11659"></a>11659 }
<a name="l11660"></a>11660 
<a name="l11661"></a>11661 
<a name="l11662"></a><a class="code" href="class_o_t___command.html#aab8b6e778bc8f0f5580f4f9003fc345a">11662</a> <a class="code" href="ot__commands__ot_8hpp.html#ae24507efa2dca9c5a701212f99064824">OT_COMMANDS_OT</a> int32_t <a class="code" href="class_o_t___command.html#aab8b6e778bc8f0f5580f4f9003fc345a">OT_Command::main_issue_asset</a>()
<a name="l11663"></a>11663 {
<a name="l11664"></a>11664     <span class="keywordtype">string</span> strUsage = <a class="code" href="ot__otapi__ot_8hpp.html#af28213bb736d19ba8637019a486e3f76">concat</a>(<span class="stringliteral">&quot;\n\nUsage: opentxs issueasset --server SERVER_ID --mynym NYM_ID\n\n&quot;</span>,
<a name="l11665"></a>11665         <span class="stringliteral">&quot;       (NYM_ID must already be the &#39;contract&#39; key on the new contract.)\n       See &#39;opentxs newasset&#39; before running this script.\n\n&quot;</span>);
<a name="l11666"></a>11666 
<a name="l11667"></a>11667     <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, strUsage);
<a name="l11668"></a>11668 
<a name="l11669"></a>11669 
<a name="l11670"></a>11670     <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;Server&quot;</span>) &amp;&amp; <a class="code" href="ot__utility__ot_8hpp.html#ae6c4712cdd271cd71ea9ade46732b23f">VerifyExists</a>(<span class="stringliteral">&quot;MyNym&quot;</span>))
<a name="l11671"></a>11671     {
<a name="l11672"></a>11672         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Please paste a currency contract, followed by an EOF or a ~ by itself on a blank line:\n\n&quot;</span>);
<a name="l11673"></a>11673 
<a name="l11674"></a>11674         <span class="comment">// The reason we accept the tilde ~ on a blank line by itself, is because</span>
<a name="l11675"></a>11675         <span class="comment">// the EOF, while it works, causes us not to be able to read any more input</span>
<a name="l11676"></a>11676         <span class="comment">// from stdin. Stdin is considered &quot;closed&quot; for the duration of the run.</span>
<a name="l11677"></a>11677         <span class="comment">// So the tilde allows us to read multiple times without closing stdin.</span>
<a name="l11678"></a>11678 
<a name="l11679"></a>11679         <span class="keywordtype">string</span> strContract = <a class="code" href="_o_t___m_e_8hpp.html#af621e54162979e65c23c0290c96099f0">OT_CLI_ReadUntilEOF</a>();
<a name="l11680"></a>11680 
<a name="l11681"></a>11681         <span class="keywordflow">if</span> (!<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strContract))
<a name="l11682"></a>11682         {
<a name="l11683"></a>11683             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n Sorry, You must input a currency contract, in order to issue it on an OT server.\n\n&quot;</span>);
<a name="l11684"></a>11684             <span class="keywordflow">return</span> -1;
<a name="l11685"></a>11685         }
<a name="l11686"></a>11686 
<a name="l11687"></a>11687         <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___wrap.html#a73f78ec70cc379360856080be6093126">OTAPI_Wrap::IsNym_RegisteredAtServer</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>))
<a name="l11688"></a>11688         {
<a name="l11689"></a>11689             <span class="comment">// If the Nym&#39;s not registered at the server, then register him first.</span>
<a name="l11690"></a>11690             <a class="code" href="class_o_t___command.html#a5a9518d65d67da6ab845839e4a24c848">OT_Command::main_register_nym</a>();
<a name="l11691"></a>11691         }
<a name="l11692"></a>11692 
<a name="l11693"></a>11693         <span class="keywordtype">string</span> strResponse = <a class="code" href="class_made_easy.html#a597fed5020e986c6ef6c8ab42796533a">MadeEasy::issue_asset_type</a>(<a class="code" href="ot__otapi__ot_8hpp.html#a85fdef489199aee67d0c9ca720e92155">Server</a>, <a class="code" href="ot__otapi__ot_8hpp.html#a9914ff396d90b92a22878810161305cd">MyNym</a>, strContract);
<a name="l11694"></a>11694         int32_t nStatus = <a class="code" href="ot__utility__ot_8hpp.html#afdbf3b63181963189d5f77bfd70bbb13">VerifyMessageSuccess</a>(strResponse);
<a name="l11695"></a>11695 
<a name="l11696"></a>11696         <span class="comment">// NOTICE: No need here to deal with retries, timeouts, request number,</span>
<a name="l11697"></a>11697         <span class="comment">// syncing transaction number, download / process nymbox, etc! It&#39;s all</span>
<a name="l11698"></a>11698         <span class="comment">// handled at a lower level!  Instead, simply check for success or failure:</span>
<a name="l11699"></a>11699         <span class="comment">//</span>
<a name="l11700"></a>11700         <span class="comment">// -1 is error,</span>
<a name="l11701"></a>11701         <span class="comment">//  0 is reply received: failure</span>
<a name="l11702"></a>11702         <span class="comment">//  1 is reply received: success</span>
<a name="l11703"></a>11703         <span class="comment">//</span>
<a name="l11704"></a>11704         <span class="keywordflow">switch</span> (nStatus)
<a name="l11705"></a>11705         {
<a name="l11706"></a>11706         <span class="keywordflow">case</span> 1:
<a name="l11707"></a>11707             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n SUCCESS in issue_asset! Server response:\n\n&quot;</span>);
<a name="l11708"></a>11708             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l11709"></a>11709             <span class="keywordflow">break</span>;
<a name="l11710"></a>11710         <span class="keywordflow">case</span> 0:
<a name="l11711"></a>11711             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n FAILURE in issue_asset! Server response:\n\n&quot;</span>);
<a name="l11712"></a>11712             <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l11713"></a>11713             <span class="keywordflow">break</span>;
<a name="l11714"></a>11714         <span class="keywordflow">default</span>:
<a name="l11715"></a>11715             <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\nError in issue_asset! nStatus is: &quot;</span> + <a class="code" href="ot__otapi__ot_8hpp.html#a8011fa809e73c86ef9f399b9529b8ef4">to_string</a>(nStatus) + <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l11716"></a>11716 
<a name="l11717"></a>11717             <span class="keywordflow">if</span> (<a class="code" href="ot__utility__ot_8hpp.html#a69ccecde9b7fed4322eebb917a3890d9">VerifyStringVal</a>(strResponse))
<a name="l11718"></a>11718             {
<a name="l11719"></a>11719                 <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;Server response:\n\n&quot;</span>);
<a name="l11720"></a>11720                 <a class="code" href="ot__otapi__ot_8hpp.html#a411be2719b83edc980cf3cb707b5c42c">print</a>(strResponse); <span class="comment">// stdout</span>
<a name="l11721"></a>11721             }
<a name="l11722"></a>11722             <span class="keywordflow">break</span>;
<a name="l11723"></a>11723         }
<a name="l11724"></a>11724         <a class="code" href="class_o_t_a_p_i___wrap.html#ae077a64733ed6e663938f51519e30235">OTAPI_Wrap::Output</a>(0, <span class="stringliteral">&quot;\n\n&quot;</span>); <span class="comment">//stderr</span>
<a name="l11725"></a>11725 
<a name="l11726"></a>11726         <span class="keywordflow">return</span> (0 == nStatus) ? -1 : nStatus;
<a name="l11727"></a>11727     }
<a name="l11728"></a>11728 
<a name="l11729"></a>11729     <span class="keywordflow">return</span> -1;
<a name="l11730"></a>11730 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ot__commands__ot_8cpp.html">ot_commands_ot.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:01 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
