<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTCronItem Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_cron_item.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">OTCronItem Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTCronItem" --><!-- doxytag: inherits="OTTrackable" -->
<p><code>#include &lt;<a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTCronItem:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_cron_item.png" usemap="#OTCronItem_map" alt=""/>
  <map id="OTCronItem_map" name="OTCronItem_map">
<area href="class_o_t_trackable.html" alt="OTTrackable" shape="rect" coords="119,168,228,192"/>
<area href="class_o_t_instrument.html" alt="OTInstrument" shape="rect" coords="119,112,228,136"/>
<area href="class_o_t_scriptable.html" alt="OTScriptable" shape="rect" coords="119,56,228,80"/>
<area href="class_o_t_contract.html" alt="OTContract" shape="rect" coords="119,0,228,24"/>
<area href="class_o_t_agreement.html" alt="OTAgreement" shape="rect" coords="0,280,109,304"/>
<area href="class_o_t_smart_contract.html" alt="OTSmartContract" shape="rect" coords="119,280,228,304"/>
<area href="class_o_t_trade.html" alt="OTTrade" shape="rect" coords="238,280,347,304"/>
<area href="class_o_t_payment_plan.html" alt="OTPaymentPlan" shape="rect" coords="0,336,109,360"/>
</map>
 </div></div>

<p><a href="class_o_t_cron_item-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a32b2f6d524b7a0b9cacff58845b2161c">DropFinalReceiptToInbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCOUNT_ID, const int64_t &amp;lNewTransactionNumber, const int64_t &amp;lClosingNumber, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOrigCronItem, <a class="el" href="class_o_t_string.html">OTString</a> *pstrNote=NULL, <a class="el" href="class_o_t_string.html">OTString</a> *pstrAttachment=NULL, <a class="el" href="class_o_t_account.html">OTAccount</a> *pActualAcct=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a4ed44ef1289676261061180691359bad">DropFinalReceiptToNymbox</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const int64_t &amp;lNewTransactionNumber, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strOrigCronItem, <a class="el" href="class_o_t_string.html">OTString</a> *pstrNote=NULL, <a class="el" href="class_o_t_string.html">OTString</a> *pstrAttachment=NULL, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pActualNym=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ae79115b7343f9b2700aa59d2701f2334">CanRemoveItemFromCron</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ab4adba19339e539c05bba94717c481cc">HarvestOpeningNumber</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">HarvestClosingNumbers</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a9f3818706d6fe1b8880c538392b4d62c">HookActivationOnCron</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pActivator, bool bForTheFirstTime=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a70fe4a9257f50547dc62b4f553b05f2d">HookRemovalFromCron</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pRemover)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a5fd32eb6600ee9740e5e99acebcaa2d8">IsFlaggedForRemoval</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a3ec8412d780384e48c756eff6726002c">SetCronPointer</a> (<a class="el" href="class_o_t_cron.html">OTCron</a> &amp;theCron)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a7668dc44368861c09a47de0f420cf2fa">SetCreationDate</a> (const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;CREATION_DATE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#aec36ac68b9f13f874ce6c56940bcec24">GetCreationDate</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ab6f1e6febdeb0f6042d751503e648107">SetDateRange</a> (const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_FROM=<a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>, const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> VALID_TO=<a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#aac4ad32d864f5b6e8ce07a28432bf1ef">SetLastProcessDate</a> (const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;THE_DATE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ad8f19edf794a54644ed4822d0bc120a4">GetLastProcessDate</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a7d801b85690f539433e0ccf187f57d99">SetProcessInterval</a> (const int64_t &amp;THE_DATE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const int64_t &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a39dce8a744a7dc6914e130bdde334a97">GetProcessInterval</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_cron.html">OTCron</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#aebfbcf50eeb2effe9c3189518910b48d">SaveCronReceipt</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a215530a92d43d8260dfe8f42327cb3de">SaveActiveCronReceipt</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theNymID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a45b93f38aa36e1b0e4c3ab01e1682119">MoveFunds</a> (const <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp;map_NymsAlreadyLoaded, const int64_t &amp;lAmount, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SOURCE_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SENDER_USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;RECIPIENT_USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#afe5c6a9af86b637fd8b2b3459825565b">ProcessCron</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ad449a1500306d53688a1cc07f05d0f97">~OTCronItem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a5d2f2bb68d5b48775e1e47a091427fb6">InitCronItem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a11e9851acefc9162bb5f107a1952ffb7">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ae714737f65e64b61746d79291ec656f0">Release_CronItem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ac9031aa34854265423155e448be01120">GetCancelerID</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theOutput) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a78f165173c66d8de46fc0a1aebeee629">IsCanceled</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ad5f37660feb3396c382a5ec5987981c7">CancelBeforeActivation</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theCancelerNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a> (uint32_t nIndex) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a310153e4e82ec7fbc887e93c4d12220d">AddClosingTransactionNo</a> (const int64_t &amp;lClosingTransactionNo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#afdbeda9f62eb4d4288d6d06ac78fcdef">GetClosingNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a9fd34100c4c79adf325c61ba268008ef">IsValidOpeningNumber</a> (const int64_t &amp;lOpeningNum) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theNymID) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#acb5f09af7950df9591c267031745a3e7">GetClosingNumber</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a6b7eec23353a8ed49ee40a742c391aa3">ProcessXMLNode</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml)</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_cron_item.html">OTCronItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">NewCronItem</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strCronItem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_cron_item.html">OTCronItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a368603ca2196ecb8817d42a24138f5d7">LoadCronReceipt</a> (const int64_t &amp;lTransactionNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT <a class="el" href="class_o_t_cron_item.html">OTCronItem</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a9478c280789d9400a4b7933626397ece">LoadActiveCronReceipt</a> (const int64_t &amp;lTransactionNum, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;serverID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a06324c676feb8e551757827775055609">EraseActiveCronReceipt</a> (const int64_t &amp;lTransactionNum, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;nymID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;serverID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a2b91cb56eae85d198ef450d0140f1eac">GetActiveCronTransNums</a> (<a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;output, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;nymID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;serverID)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a82fc7c5f44b6d3f22658a2c05a990cfa">OTCronItem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a92beb46425e527915442c16ec44d59c4">OTCronItem</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a9abc7138442ccc888630839cf7379e06">OTCronItem</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a6d5314654e6544ce8d724a89691965fa">onActivate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ac24d58b1aec6a6471a79f30146e7a300">onFinalReceipt</a> (<a class="el" href="class_o_t_cron_item.html">OTCronItem</a> &amp;theOrigCronItem, const int64_t &amp;lNewTransactionNumber, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theOriginator, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pRemover)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#ad7aa9b289746ab01661997a19b1335b1">onRemovalFromCron</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a3941f19ac62239dbeee9a300d9f8c2b1">ClearClosingNumbers</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::deque&lt; int64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00151">151</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a82fc7c5f44b6d3f22658a2c05a990cfa"></a><!-- doxytag: member="OTCronItem::OTCronItem" ref="a82fc7c5f44b6d3f22658a2c05a990cfa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html#a82fc7c5f44b6d3f22658a2c05a990cfa">OTCronItem::OTCronItem</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02331">2331</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">:   ot_super(), m_pCron(NULL), m_CREATION_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), m_LAST_PROCESS_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>),
    m_PROCESS_INTERVAL(1),  <span class="comment">// Default for any cron item is to execute once per second.</span>
    <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>(<span class="keyword">new</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>),
    <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_cron_item.html#a5d2f2bb68d5b48775e1e47a091427fb6">InitCronItem</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a92beb46425e527915442c16ec44d59c4"></a><!-- doxytag: member="OTCronItem::OTCronItem" ref="a92beb46425e527915442c16ec44d59c4" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html#a82fc7c5f44b6d3f22658a2c05a990cfa">OTCronItem::OTCronItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02342">2342</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">:   ot_super(SERVER_ID, ASSET_ID),
    m_pCron(NULL), m_CREATION_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>),
    m_LAST_PROCESS_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), m_PROCESS_INTERVAL(1), <span class="comment">// Default for any cron item is to execute once per second.</span>
    <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>(<span class="keyword">new</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>),
    <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a>(<span class="keyword">false</span>),
    <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a>(<span class="keyword">false</span>)
{
    <a class="code" href="class_o_t_cron_item.html#a5d2f2bb68d5b48775e1e47a091427fb6">InitCronItem</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9abc7138442ccc888630839cf7379e06"></a><!-- doxytag: member="OTCronItem::OTCronItem" ref="a9abc7138442ccc888630839cf7379e06" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID, const OTIdentifier &amp;ACCT_ID, const OTIdentifier &amp;USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html#a82fc7c5f44b6d3f22658a2c05a990cfa">OTCronItem::OTCronItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02354">2354</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                     :
    ot_super(SERVER_ID, ASSET_ID, ACCT_ID, USER_ID),
    m_pCron(NULL), m_CREATION_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>),
    m_LAST_PROCESS_DATE(<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>), m_PROCESS_INTERVAL(1), <span class="comment">// Default for any cron item is to execute once per second.</span>
        <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>(<span class="keyword">new</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>),
        <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a>(<span class="keyword">false</span>),
        <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a>(<span class="keyword">false</span>)

{
    <a class="code" href="class_o_t_cron_item.html#a5d2f2bb68d5b48775e1e47a091427fb6">InitCronItem</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad449a1500306d53688a1cc07f05d0f97"></a><!-- doxytag: member="OTCronItem::~OTCronItem" ref="ad449a1500306d53688a1cc07f05d0f97" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html#ad449a1500306d53688a1cc07f05d0f97">OTCronItem::~OTCronItem</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02413">2413</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron_item.html#ae714737f65e64b61746d79291ec656f0">Release_CronItem</a>();
    <span class="comment">// ------------------</span>
    <span class="comment">// If there were any dynamically allocated objects, clean them up here.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL != <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>)
        <span class="keyword">delete</span> <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>;
    <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a> = NULL;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a310153e4e82ec7fbc887e93c4d12220d"></a><!-- doxytag: member="OTCronItem::AddClosingTransactionNo" ref="a310153e4e82ec7fbc887e93c4d12220d" args="(const int64_t &amp;lClosingTransactionNo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a310153e4e82ec7fbc887e93c4d12220d">OTCronItem::AddClosingTransactionNo</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lClosingTransactionNo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01412">1412</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a>.push_back(lClosingTransactionNo);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad5f37660feb3396c382a5ec5987981c7"></a><!-- doxytag: member="OTCronItem::CancelBeforeActivation" ref="ad5f37660feb3396c382a5ec5987981c7" args="(OTPseudonym &amp;theCancelerNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#ad5f37660feb3396c382a5ec5987981c7">OTCronItem::CancelBeforeActivation</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theCancelerNym</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02383">2383</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>);

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#a78f165173c66d8de46fc0a1aebeee629">IsCanceled</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a> = <span class="keyword">true</span>;
    *<a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a> = theCancelerNym.<a class="code" href="class_o_t_pseudonym.html#a8167f1e2d532ab18227c5c170922c611">GetConstID</a>();

    this-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
    this-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(theCancelerNym);
    this-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae79115b7343f9b2700aa59d2701f2334"></a><!-- doxytag: member="OTCronItem::CanRemoveItemFromCron" ref="ae79115b7343f9b2700aa59d2701f2334" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#ae79115b7343f9b2700aa59d2701f2334">OTCronItem::CanRemoveItemFromCron</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>See if theNym has rights to remove this item from Cron. </p>

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a0d2171ea6d37b37f284c9f1a9a2b9f13">OTAgreement</a>, <a class="el" href="class_o_t_smart_contract.html#a894df89d05a2ce8a3effec71abb23f7d">OTSmartContract</a>, and <a class="el" href="class_o_t_trade.html#a5cb3c8213ac91b1533110edaa3263760">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01420">1420</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// You don&#39;t just go willy-nilly and remove a cron item from a market unless you check first</span>
    <span class="comment">// and make sure the Nym who requested it actually has said number (or a related closing number)</span>
    <span class="comment">// signed out to him on his last receipt...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(5, <span class="stringliteral">&quot;OTCronItem::CanRemoveItem: theNym is not the originator of this CronItem. &quot;</span>
                      <span class="stringliteral">&quot;(He could be a recipient though, so this is normal.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, that means theNym is DEFINITELY the originator (sender)...</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &lt; 1)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;Weird: Sender tried to remove a cron item; expected at least 1 closing number to be available&quot;</span>
                      <span class="stringliteral">&quot;--that wasn&#39;t. (Found %d).\n&quot;</span>, this-&gt;<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, this-&gt;GetClosingNum()))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::CanRemoveItemFromCron: Closing number didn&#39;t verify (for removal from cron).\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, we KNOW theNym is the sender, and we KNOW there are the proper number of transaction</span>
    <span class="comment">// numbers available to close. We also know that this cron item really was on the cron object, since</span>
    <span class="comment">// that is where it was looked up from, when this function got called! So I&#39;m pretty sure, at this point,</span>
    <span class="comment">// to authorize removal, as long as the transaction num is still issued to theNym (this check here.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> theNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, this-&gt;<a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>());

    <span class="comment">// Normally this will be all we need to check. The originator will have the transaction</span>
    <span class="comment">// number signed-out to him still, if he is trying to close it. BUT--in some cases, someone</span>
    <span class="comment">// who is NOT the originator can cancel. Like in a payment plan, the sender is also the depositor,</span>
    <span class="comment">// who would normally be the person cancelling the plan. But technically, the RECIPIENT should</span>
    <span class="comment">// also have the ability to cancel that payment plan.  BUT: the transaction number isn&#39;t signed</span>
    <span class="comment">// out to the RECIPIENT... In THAT case, the below VerifyIssuedNum() won&#39;t work! In those cases,</span>
    <span class="comment">// expect that the special code will be in the subclasses override of this function. (OTPaymentPlan::CanRemoveItem() etc)</span>

    <span class="comment">// P.S. If you override this function, maybe call the parent (OTCronItem::CanRemoveItem) first,</span>
    <span class="comment">// for the VerifyIssuedNum call above. Only if that fails, do you need to dig deeper...</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3941f19ac62239dbeee9a300d9f8c2b1"></a><!-- doxytag: member="OTCronItem::ClearClosingNumbers" ref="a3941f19ac62239dbeee9a300d9f8c2b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a3941f19ac62239dbeee9a300d9f8c2b1">OTCronItem::ClearClosingNumbers</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02407">2407</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a>.clear();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a32b2f6d524b7a0b9cacff58845b2161c"></a><!-- doxytag: member="OTCronItem::DropFinalReceiptToInbox" ref="a32b2f6d524b7a0b9cacff58845b2161c" args="(const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;ACCOUNT_ID, const int64_t &amp;lNewTransactionNumber, const int64_t &amp;lClosingNumber, const OTString &amp;strOrigCronItem, OTString *pstrNote=NULL, OTString *pstrAttachment=NULL, OTAccount *pActualAcct=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a32b2f6d524b7a0b9cacff58845b2161c">OTCronItem::DropFinalReceiptToInbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ACCOUNT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNewTransactionNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lClosingNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOrigCronItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrNote</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrAttachment</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_account.html">OTAccount</a> *&#160;</td>
          <td class="paramname"><em>pActualAcct</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01837">1837</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTCronItem::DropFinalReceiptToInbox&quot;</span>;

    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a> theDestAcctGuardian; <span class="comment">// used in cases where we have to load pActualAcct ourselves.</span>

    <span class="comment">// -----------------------------------------------------</span>
    <span class="comment">// Load the inbox in case it already exists.</span>
    <a class="code" href="class_o_t_ledger.html">OTLedger</a> theInbox (USER_ID, ACCOUNT_ID, <a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());

    <span class="comment">// Inbox will receive notification of something ALREADY DONE.</span>
    <span class="keywordtype">bool</span> bSuccessLoading = theInbox.LoadInbox();

    <span class="comment">// -------------------------------------------------------------------</span>
    <span class="comment">// ...or generate it otherwise...</span>

    <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccessLoading)
        bSuccessLoading     = theInbox.VerifyAccount(*pServerNym);
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR loading inbox ledger.\n&quot;</span>, szFunc);
<span class="comment">//      OTLog::vError(&quot;%s: ERROR loading inbox ledger.\n&quot;, szFunc);</span>
<span class="comment">//  else</span>
<span class="comment">//      bSuccessLoading     = theInbox.GenerateLedger(ACCOUNT_ID, GetServerID(), OTLedger::inbox, true); // bGenerateFile=true</span>

    <span class="comment">// --------------------------------------------------------------------</span>

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSuccessLoading)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR loading or generating an inbox. (FAILED WRITING RECEIPT!!) \n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Start generating the receipts</span>

        <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTrans1 = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(theInbox, <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>, lNewTransactionNumber);
        <span class="comment">// (No need to OT_ASSERT on the above transaction since it occurs in GenerateTransaction().)</span>

        <span class="comment">// The inbox will get a receipt with the new transaction ID.</span>
        <span class="comment">// That receipt has an &quot;in reference to&quot; field containing the original cron item.</span>

        <span class="comment">// set up the transaction items (each transaction may have multiple items... but not in this case.)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem1 = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTrans1, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>);

        <span class="comment">// This may be unnecessary, I&#39;ll have to check CreateItemFromTransaction. I&#39;ll leave it for now.</span>
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem1);

        pItem1-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>);

        <span class="comment">// -------------------------------------------------------------</span>
        <span class="comment">//</span>
        <span class="comment">// Here I make sure that the receipt (the inbox notice) references the</span>
        <span class="comment">// transaction number that the trader originally used to issue the cron item...</span>
        <span class="comment">// This number is used to match up offers to trades, and used to track all cron items.</span>
        <span class="comment">// (All Cron items require a transaction from the user to add them to Cron in the</span>
        <span class="comment">// first place.)</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> int64_t lOpeningNum = <a class="code" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a>(USER_ID);

        pTrans1-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lOpeningNum);
        pTrans1-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(lOpeningNum);
<span class="comment">//      pItem1-&gt; SetReferenceToNum(lOpeningNum);</span>
        <span class="comment">// -------------------------------------------------</span>
        <span class="comment">// The reference on the transaction contains an OTCronItem, in this case.</span>
        <span class="comment">// The original cron item, versus the updated cron item (which is stored</span>
        <span class="comment">// on the finalReceipt item just below here.)</span>
        <span class="comment">//</span>
        pTrans1-&gt;<a class="code" href="class_o_t_transaction_type.html#a9dd50265579347d2e8fa3ea36ca66320">SetReferenceString</a>(strOrigCronItem);
        <span class="comment">// --------------------------------------------</span>
        pTrans1-&gt;<a class="code" href="class_o_t_transaction.html#af3c025bbdeb70a053c6149a32d8b9940">SetClosingNum</a>(lClosingNumber);  <span class="comment">// This transaction is the finalReceipt for GetTransactionNum(), as lClosingNumber.</span>
<span class="comment">//      pItem1-&gt; SetClosingNum(lClosingNumber);</span>
        <span class="comment">//</span>
        <span class="comment">// NOTE: I COULD look up the closing number by doing a call to this-&gt;GetClosingNumber(ACCOUNT_ID);</span>
        <span class="comment">// But that is already taken care of where it matters, and passed in here properly already, so it</span>
        <span class="comment">// would be superfluous.</span>
        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="comment">// The finalReceipt ITEM&#39;s NOTE contains the UPDATED CRON ITEM.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pstrNote)
        {
            pItem1-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(*pstrNote);    <span class="comment">// in markets, this is updated trade.</span>
        }

        <span class="comment">// Also set the ** UPDATED OFFER ** as the ATTACHMENT on the ** item.**</span>
        <span class="comment">// (With the SERVER&#39;s signature on it!) // in markets, this is updated offer.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pstrAttachment)
        {
            pItem1-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(*pstrAttachment);
        }

        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="comment">// sign the item</span>

        pItem1-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
        pItem1-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTrans1-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem1);

        pTrans1-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
        pTrans1-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// Here the transaction we just created is actually added to the ledger.</span>
        theInbox.AddTransaction(*pTrans1);

        <span class="comment">// Release any signatures that were there before (They won&#39;t</span>
        <span class="comment">// verify anymore anyway, since the content has changed.)</span>
        theInbox.ReleaseSignatures();

        <span class="comment">// Sign and save.</span>
        theInbox.   <a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
        theInbox.   <a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// ---------------------------------</span>

        <span class="comment">// TODO: Better rollback capabilities in case of failures here:</span>

        <span class="comment">// --------------------</span>
        <span class="keywordflow">if</span> (NULL == pActualAcct) <span class="comment">// no asset account was passed in as already loaded, so let&#39;s load it ourselves then.</span>
        {
            pActualAcct = <a class="code" href="class_o_t_account.html#a6574057f6e3415546d3a9f7d7e445e4f">OTAccount::LoadExistingAccount</a>(ACCOUNT_ID, this-&gt;<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());
            theDestAcctGuardian.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pActualAcct); <span class="comment">// This is safe in cases where NULL is returned. No need to cleanup pActualAcct.</span>
        }
        <span class="comment">// --------------------</span>
        <span class="comment">// Save inbox to storage. (File, DB, wherever it goes.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pActualAcct)
        {
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(ACCOUNT_ID == pActualAcct-&gt;<a class="code" href="class_o_t_transaction_type.html#aa51ed7e1bb8d701f3ed0641d6b1cde9a">GetPurportedAccountID</a>());

            <span class="keywordflow">if</span> (pActualAcct-&gt;<a class="code" href="class_o_t_transaction_type.html#a5df67ad1e0b4d60e205c0a8e1ae5e703">VerifyAccount</a>(*pServerNym))
            {
                pActualAcct-&gt;<a class="code" href="class_o_t_account.html#a81e503e95310da5ac9c2003cb00d6d2e">SaveInbox</a>(theInbox);
                pActualAcct-&gt;<a class="code" href="class_o_t_account.html#adaba3f4ce60f7ac88f883c0543d9ddb0">SaveAccount</a>();  <span class="comment">// inbox hash has changed here, so we save the account to reflect that change.</span>
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed: pActualAcct-&gt;VerifyAccount(*pServerNym)\n&quot;</span>, szFunc);
            }
        }
        <span class="keywordflow">else</span> <span class="comment">// todo: would the account EVER be null here? Should never be. Therefore should we save the inbox here?</span>
        {
            theInbox.    SaveInbox();
        }
        <span class="comment">// --------------------------------------------------------</span>
        <span class="comment">// Notice above, if the account loads but fails to verify, then we do not save the Inbox.</span>
        <span class="comment">// Todo: ponder wisdom of that decision.</span>
        <span class="comment">// --------------------</span>
        <span class="comment">// Corresponds to the AddTransaction() just above.</span>
        <span class="comment">// Details are stored in separate file these days.</span>
        <span class="comment">//</span>
        pTrans1-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(theInbox);
        <span class="comment">// --------------------------------------------------------</span>
        <span class="keywordflow">return</span> <span class="keyword">true</span>;    <span class="comment">// Really this true should be predicated on ALL the above functions returning true. Right?</span>
    }                   <span class="comment">// ...Right?</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4ed44ef1289676261061180691359bad"></a><!-- doxytag: member="OTCronItem::DropFinalReceiptToNymbox" ref="a4ed44ef1289676261061180691359bad" args="(const OTIdentifier &amp;USER_ID, const int64_t &amp;lNewTransactionNumber, const OTString &amp;strOrigCronItem, OTString *pstrNote=NULL, OTString *pstrAttachment=NULL, OTPseudonym *pActualNym=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a4ed44ef1289676261061180691359bad">OTCronItem::DropFinalReceiptToNymbox</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNewTransactionNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOrigCronItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrNote</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> *&#160;</td>
          <td class="paramname"><em>pstrAttachment</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pActualNym</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02017">2017</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTCronItem::DropFinalReceiptToNymbox&quot;</span>;  <span class="comment">// RESUME!!!!!!!</span>

    <span class="comment">// -----------------------------------------------------</span>

    <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(USER_ID, USER_ID, <a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());

    <span class="comment">// Inbox will receive notification of something ALREADY DONE.</span>
    <span class="keywordtype">bool</span> bSuccessLoading = theLedger.LoadNymbox();

    <span class="comment">// -------------------------------------------------------------------</span>
    <span class="comment">// ...or generate it otherwise...</span>

    <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccessLoading)
        bSuccessLoading     = theLedger.VerifyAccount(*pServerNym);
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load Nymbox.\n&quot;</span>, szFunc);
<span class="comment">//    else</span>
<span class="comment">//      bSuccessLoading     = theLedger.GenerateLedger(USER_ID, GetServerID(), OTLedger::nymbox, true); // bGenerateFile=true</span>

    <span class="comment">// --------------------------------------------------------------------</span>

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSuccessLoading)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR loading or generating a nymbox. (FAILED WRITING RECEIPT!!) \n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// --------------------------------------------------------------------</span>

    <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(theLedger,
                                                                      <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>,
                                                                      lNewTransactionNumber);

    <span class="keywordflow">if</span> (NULL != pTransaction) <span class="comment">// The above has an OT_ASSERT within, but I just like to check my pointers.</span>
    {
        <span class="comment">// The nymbox will get a receipt with the new transaction ID.</span>
        <span class="comment">// That receipt has an &quot;in reference to&quot; field containing the original cron item.</span>


        <span class="comment">// set up the transaction items (each transaction may have multiple items... but not in this case.)</span>
        <a class="code" href="class_o_t_item.html">OTItem</a> * pItem1 = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransaction, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1afb82e1e580788a5f6fa8450d81a74f0b">OTItem::finalReceipt</a>);

        <span class="comment">// This may be unnecessary, I&#39;ll have to check CreateItemFromTransaction. I&#39;ll leave it for now.</span>
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem1);

        pItem1-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>);

        <span class="comment">// -------------------------------------------------------------</span>
        <span class="comment">//</span>
<span class="comment">//      const int64_t lOpeningNumber = GetTransactionNum(); // Notice I&#39;m actually putting the opening # here...</span>
<span class="comment">//</span>
        <span class="keyword">const</span> int64_t lOpeningNumber = <a class="code" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a>(USER_ID);

        <span class="comment">// Here I make sure that the receipt (the nymbox notice) references the</span>
        <span class="comment">// transaction number that the trader originally used to issue the cron item...</span>
        <span class="comment">// This number is used to match up offers to trades, and used to track all cron items.</span>
        <span class="comment">// (All Cron items require a transaction from the user to add them to Cron in the</span>
        <span class="comment">// first place.)</span>
        <span class="comment">//</span>
<span class="comment">//      pItem1-&gt;SetReferenceToNum(lOpeningNumber);  // Notice this same number is set twice (again just below), so might be an opportunity to store something else in one of them.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lOpeningNumber); <span class="comment">// Notice this same number is set twice (again just below), so might be an opportunity to store something else in one of them.</span>

        <span class="comment">// -------------------------------------------------</span>
        <span class="comment">// The reference on the transaction contains an OTCronItem, in this case.</span>
        <span class="comment">// The original cron item, versus the updated cron item (which is stored</span>
        <span class="comment">// on the finalReceipt item just below here.)</span>
        <span class="comment">//</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a9dd50265579347d2e8fa3ea36ca66320">SetReferenceString</a>(strOrigCronItem);

        <span class="comment">// --------------------------------------------</span>

        <span class="comment">// Normally in the Inbox, the &quot;Closing Num&quot; is set to the closing number, in reference to the opening number. (on a finalReceipt)</span>
        <span class="comment">// But in the NYMBOX, we are sending the Opening Number in that spot. The purpose is so the client side will know not to use that</span>
        <span class="comment">// opening number as a valid transaction # in its transaction statements and balance statements, since the number is now gone.</span>
        <span class="comment">// Otherwise the Nym wouldn&#39;t know any better, and he&#39;d keep signing for it, and therefore his balance agreements would start to fail.</span>
        <span class="comment">//</span>
<span class="comment">//      pItem1-&gt;SetClosingNum(lOpeningNumber); // This transaction is the finalReceipt for GetTransactionNum(). (Which is also the original transaction number.)</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#af3c025bbdeb70a053c6149a32d8b9940">SetClosingNum</a>(lOpeningNumber); <span class="comment">// This transaction is the finalReceipt for GetTransactionNum(). (Which is also the original transaction number.)</span>

        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="comment">// The finalReceipt ITEM&#39;s NOTE contains the UPDATED CRON ITEM.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pstrNote)
        {
            pItem1-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(*pstrNote);    <span class="comment">// in markets, this is updated trade.</span>
        }

        <span class="comment">// Also set the ** UPDATED OFFER ** as the ATTACHMENT on the ** item.**</span>
        <span class="comment">// (With the SERVER&#39;s signature on it!) // in markets, this is updated offer.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pstrAttachment)
        {
            pItem1-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(*pstrAttachment);
        }

        <span class="comment">// -----------------------------------------------------------------</span>
        <span class="comment">// sign the item</span>

        pItem1-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
        pItem1-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItem1);

        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
        pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

        <span class="comment">// Here the transaction we just created is actually added to the ledger.</span>
        theLedger.AddTransaction(*pTransaction);

        <span class="comment">// Release any signatures that were there before (They won&#39;t</span>
        <span class="comment">// verify anymore anyway, since the content has changed.)</span>
        theLedger.ReleaseSignatures();

        <span class="comment">// Sign and save.</span>
        theLedger.SignContract(*pServerNym);
        theLedger.SaveContract();

        <span class="comment">// TODO: Better rollback capabilities in case of failures here:</span>

        <span class="comment">// --------------------</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymboxHash;

        <span class="comment">// Save nymbox to storage. (File, DB, wherever it goes.)</span>
        theLedger.  SaveNymbox(&amp;theNymboxHash);

        <span class="comment">// This corresponds to the AddTransaction() call just above.</span>
        <span class="comment">// These are stored in a separate file now.</span>
        <span class="comment">//</span>
        pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(theLedger);

        <span class="comment">// --------------------------------------------------------</span>
        <span class="comment">// Update the NymboxHash (in the nymfile.)</span>
        <span class="comment">//</span>

        <span class="keyword">const</span>
        <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    ACTUAL_NYM_ID = USER_ID;
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>     theActualNym; <span class="comment">// unused unless it&#39;s really not already loaded. (use pActualNym.)</span>

        <span class="comment">// We couldn&#39;t find the Nym among those already loaded--so we have to load</span>
        <span class="comment">// it ourselves (so we can update its NymboxHash value.)</span>

        <span class="keywordflow">if</span> (NULL == pActualNym)
        {
            <span class="keywordflow">if</span> ( (NULL != pServerNym) &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID) )
                pActualNym = pServerNym;
            <span class="comment">// --------------------------</span>
            <span class="keywordflow">else</span>
            {
                theActualNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(ACTUAL_NYM_ID);

                <span class="keywordflow">if</span> (<span class="keyword">false</span> == theActualNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>()) <span class="comment">// Note: this step may be unnecessary since we are only updating his Nymfile, not his key.</span>
                {
                    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading public key for Nym: %s. &quot;</span>
                                  <span class="stringliteral">&quot;(To update his NymboxHash.) \n&quot;</span>, szFunc, strNymID.Get());
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theActualNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>() &amp;&amp; <span class="comment">// this line may be unnecessary.</span>
                         theActualNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym)) <span class="comment">// ServerNym here is not theActualNym&#39;s identity, but merely the signer on this file.</span>
                {
                    <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: Loading actual Nym, since he wasn&#39;t already loaded. &quot;</span>
                                  <span class="stringliteral">&quot;(To update his NymboxHash.)\n&quot;</span>, szFunc);
                    pActualNym = &amp;theActualNym; <span class="comment">//  &lt;=====</span>
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading or verifying Actual Nym public key: %s. &quot;</span>
                                  <span class="stringliteral">&quot;(To update his NymboxHash.)\n&quot;</span>, szFunc, strNymID.Get());
                }
            }
        }
        <span class="comment">// -------------</span>

        <span class="comment">// By this point we&#39;ve made every possible effort to get the proper Nym loaded,</span>
        <span class="comment">// so that we can update his NymboxHash appropriately.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pActualNym)
        {
            pActualNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab3b725b4837a88a8d273d5ca1ad636a0">SetNymboxHashServerSide</a>( theNymboxHash );
            pActualNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pServerNym);
        }

        <span class="comment">// -------------</span>
        <span class="comment">// Really this true should be predicated on ALL the above functions returning true.</span>
        <span class="comment">// Right?</span>
        <span class="comment">//</span>
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to create finalReceipt.\n&quot;</span>, szFunc);

    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// unreachable.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a06324c676feb8e551757827775055609"></a><!-- doxytag: member="OTCronItem::EraseActiveCronReceipt" ref="a06324c676feb8e551757827775055609" args="(const int64_t &amp;lTransactionNum, const OTIdentifier &amp;nymID, const OTIdentifier &amp;serverID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a06324c676feb8e551757827775055609">OTCronItem::EraseActiveCronReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00343">343</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename, strServerID(serverID);
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.crn&quot;</span>, lTransactionNum);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername   = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// Before we remove the cron item receipt itself, first we need to load up</span>
    <span class="comment">// the local list of active (recurring) transactions, and remove the number</span>
    <span class="comment">// from that list. Otherwise the GUI will continue thinking the transaction</span>
    <span class="comment">// is active in cron.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strListFilename(nymID);
    strListFilename.Concatenate(<span class="stringliteral">&quot;.lst&quot;</span>);  <span class="comment">// nymID.lst</span>

    <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), strListFilename.Get()))
    {
        <span class="comment">// Load up existing list, to remove the transaction num from it.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_num_list.html">OTNumList</a> numlist;

        <a class="code" href="class_o_t_string.html">OTString</a> strNumlist(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFoldername, strServerID.Get(), strListFilename.Get()));

        <span class="keywordflow">if</span> (strNumlist.Exists())
        {
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == strNumlist.DecodeIfArmored(<span class="keyword">false</span>)) <span class="comment">// bEscapedIsAllowed=true by default.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: List of recurring transactions; string apparently was encoded &quot;</span>
                              <span class="stringliteral">&quot;and then failed decoding. Contents: \n%s\n&quot;</span>,
                              __FUNCTION__, strNumlist.Get());
            }
            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">else</span>
                numlist.Add(strNumlist);
        }
        <span class="comment">// ------------------------------------</span>
        strNumlist.Release();
        <span class="comment">// ------------------------------------</span>
        <span class="keywordflow">if</span> (numlist.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
            numlist.<a class="code" href="class_o_t_num_list.html#a114a52d23626971683bb2be726712479">Remove</a>(lTransactionNum);
        <span class="comment">// ------------------------------------</span>
        <span class="keywordflow">if</span> (0 == numlist.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>())
        {
            <span class="keywordflow">if</span> (!<a class="code" href="namespace_o_t_d_b.html#ae1b1867b56bcf7d31a5926bcafade0b0">OTDB::EraseValueByKey</a>(szFoldername, strServerID.Get(), strListFilename.Get()))
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTCronItem::%s: FYI, failure erasing recurring IDs file: %s%s%s%s%s\n&quot;</span>,
                              __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                              strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strListFilename.Get());
            }
        }
        <span class="comment">// ------------------------------------</span>
        <span class="keywordflow">else</span>
        {
            numlist.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strNumlist);
            <span class="comment">// ------------------------------------</span>
            <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(strNumlist);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <span class="stringliteral">&quot;ACTIVE CRON ITEMS&quot;</span>)) <span class="comment">// todo hardcoding</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error re-saving recurring IDs (failed writing armored string): %s%s%s%s%s\n&quot;</span>,
                              __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                              strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strListFilename.Get());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// --------------------------------------------------------------------</span>
            <span class="keywordflow">else</span>
            {
                <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),    szFoldername,
                                                     strServerID.Get(), strListFilename.Get());

                <span class="keywordflow">if</span> (!bSaved)
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error re-saving recurring IDs: %s%s%s%s%s\n&quot;</span>,
                                  __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                                  strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strListFilename.Get());
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
            }
        }
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="comment">// Now that the list is updated, let&#39;s go ahead and erase the actual cron item itself.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), szFilename))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: File does not exist: %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (!<a class="code" href="namespace_o_t_d_b.html#ae1b1867b56bcf7d31a5926bcafade0b0">OTDB::EraseValueByKey</a>(szFoldername, strServerID.Get(), szFilename))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error erasing file: %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a34c87380d2f8cd419c9a5cfec86427b4"></a><!-- doxytag: member="OTCronItem::FlagForRemoval" ref="a34c87380d2f8cd419c9a5cfec86427b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">OTCronItem::FlagForRemoval</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00224">224</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a> = <span class="keyword">true</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a2b91cb56eae85d198ef450d0140f1eac"></a><!-- doxytag: member="OTCronItem::GetActiveCronTransNums" ref="a2b91cb56eae85d198ef450d0140f1eac" args="(OTNumList &amp;output, const OTIdentifier &amp;nymID, const OTIdentifier &amp;serverID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a2b91cb56eae85d198ef450d0140f1eac">OTCronItem::GetActiveCronTransNums</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_num_list.html">OTNumList</a> &amp;&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>nymID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00303">303</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// --------------------------------------------------------------------</span>
    output.<a class="code" href="class_o_t_num_list.html#ab90b486b8dc6ac66a34724c6da4f7ec5">Release</a>();
    <span class="comment">// ------------------------------</span>
    <span class="comment">// We need to load up the local list of active (recurring) transactions.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strListFilename(nymID), strServerID(serverID);
    strListFilename.Concatenate(<span class="stringliteral">&quot;.lst&quot;</span>);  <span class="comment">// nymID.lst</span>

    <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), strListFilename.Get()))
    {
        <span class="comment">// Load up existing list, if it exists.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strNumlist(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFoldername, strServerID.Get(), strListFilename.Get()));

        <span class="keywordflow">if</span> (strNumlist.Exists())
        {
            <span class="keywordflow">if</span> (<span class="keyword">false</span> == strNumlist.DecodeIfArmored(<span class="keyword">false</span>)) <span class="comment">// bEscapedIsAllowed=true by default.</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: List of recurring transactions; string apparently was encoded &quot;</span>
                              <span class="stringliteral">&quot;and then failed decoding. Contents: \n%s\n&quot;</span>,
                              __FUNCTION__, strNumlist.Get());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// ------------------------------------------</span>
            <span class="keywordflow">else</span>
                output.Add(strNumlist);
        }
    }
    <span class="comment">// ------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac9031aa34854265423155e448be01120"></a><!-- doxytag: member="OTCronItem::GetCancelerID" ref="ac9031aa34854265423155e448be01120" args="(OTIdentifier &amp;theOutput) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#ac9031aa34854265423155e448be01120">OTCronItem::GetCancelerID</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02368">2368</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_cron_item.html#a78f165173c66d8de46fc0a1aebeee629">IsCanceled</a>())
    {
        theOutput.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    theOutput = *<a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>;
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afdbeda9f62eb4d4288d6d06ac78fcdef"></a><!-- doxytag: member="OTCronItem::GetClosingNum" ref="afdbeda9f62eb4d4288d6d06ac78fcdef" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_cron_item.html#afdbeda9f62eb4d4288d6d06ac78fcdef">OTCronItem::GetClosingNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02232">2232</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &gt; 0) ? <a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(0) : 0; <span class="comment">// todo stop hardcoding.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb5f09af7950df9591c267031745a3e7"></a><!-- doxytag: member="OTCronItem::GetClosingNumber" ref="acb5f09af7950df9591c267031745a3e7" args="(const OTIdentifier &amp;theAcctID) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_cron_item.html#acb5f09af7950df9591c267031745a3e7">OTCronItem::GetClosingNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a3a9a2325c23aa03f4e6ce03fec6f69f7">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#ab9ff6bc2d5f152a9e3f2203a067af40b">OTAgreement</a>, and <a class="el" href="class_o_t_trade.html#ade7f91cb3eddd3e8bf0216f7a0f92f77">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02258">2258</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theSenderAcctID = this-&gt;<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>();

    <span class="keywordflow">if</span> (theAcctID == theSenderAcctID)
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#afdbeda9f62eb4d4288d6d06ac78fcdef">GetClosingNum</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab4bd4e606ddbb49d3f36248f18391ec1"></a><!-- doxytag: member="OTCronItem::GetClosingTransactionNoAt" ref="ab4bd4e606ddbb49d3f36248f18391ec1" args="(uint32_t nIndex) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">OTCronItem::GetClosingTransactionNoAt</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nIndex</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01404">1404</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a>.size() &lt;= nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: %s is equal or larger than m_dequeClosingNumbers.size()!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;nIndex&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }

    <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a>.at(nIndex);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a96d3ae7898526a317dd503daecbf10af"></a><!-- doxytag: member="OTCronItem::GetCountClosingNumbers" ref="a96d3ae7898526a317dd503daecbf10af" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">OTCronItem::GetCountClosingNumbers</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01398">1398</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span> (<a class="code" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">m_dequeClosingNumbers</a>.size());
}
</pre></div>
</div>
</div>
<a class="anchor" id="aec36ac68b9f13f874ce6c56940bcec24"></a><!-- doxytag: member="OTCronItem::GetCreationDate" ref="aec36ac68b9f13f874ce6c56940bcec24" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&amp; <a class="el" href="class_o_t_cron_item.html#aec36ac68b9f13f874ce6c56940bcec24">OTCronItem::GetCreationDate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00240">240</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_CREATION_DATE; }
</pre></div>
</div>
</div>
<a class="anchor" id="af734ad5d309fcc9b4a60d40d6c30f55a"></a><!-- doxytag: member="OTCronItem::GetCron" ref="af734ad5d309fcc9b4a60d40d6c30f55a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron.html">OTCron</a>* <a class="el" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">OTCronItem::GetCron</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00250">250</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_pCron; }
</pre></div>
</div>
</div>
<a class="anchor" id="ad8f19edf794a54644ed4822d0bc120a4"></a><!-- doxytag: member="OTCronItem::GetLastProcessDate" ref="ad8f19edf794a54644ed4822d0bc120a4" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&amp; <a class="el" href="class_o_t_cron_item.html#ad8f19edf794a54644ed4822d0bc120a4">OTCronItem::GetLastProcessDate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00245">245</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_LAST_PROCESS_DATE; }
</pre></div>
</div>
</div>
<a class="anchor" id="acd198571145b47602c121a419723b39a"></a><!-- doxytag: member="OTCronItem::GetOpeningNum" ref="acd198571145b47602c121a419723b39a" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">OTCronItem::GetOpeningNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02226">2226</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8f59139b6000733ec3c1df6d1dbc7632"></a><!-- doxytag: member="OTCronItem::GetOpeningNumber" ref="a8f59139b6000733ec3c1df6d1dbc7632" args="(const OTIdentifier &amp;theNymID) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">OTCronItem::GetOpeningNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theNymID</em></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a2bb8a0f8a1ff8ddf637e5d87d5935e51">OTSmartContract</a>, and <a class="el" href="class_o_t_agreement.html#a809937fd06b26ff5791094592be68b0d">OTAgreement</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02247">2247</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theSenderNymID = this-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>();

    <span class="keywordflow">if</span> (theNymID == theSenderNymID)
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>();

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a39dce8a744a7dc6914e130bdde334a97"></a><!-- doxytag: member="OTCronItem::GetProcessInterval" ref="a39dce8a744a7dc6914e130bdde334a97" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int64_t&amp; <a class="el" href="class_o_t_cron_item.html#a39dce8a744a7dc6914e130bdde334a97">OTCronItem::GetProcessInterval</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00248">248</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_PROCESS_INTERVAL; }
</pre></div>
</div>
</div>
<a class="anchor" id="aeeaf2e2f8c54e7eb3e072336d07b2879"></a><!-- doxytag: member="OTCronItem::HarvestClosingNumbers" ref="aeeaf2e2f8c54e7eb3e072336d07b2879" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#aeeaf2e2f8c54e7eb3e072336d07b2879">OTCronItem::HarvestClosingNumbers</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a098b7e9e0bd808bd1e40863d5404f243">OTAgreement</a>, and <a class="el" href="class_o_t_smart_contract.html#a40befd7381c6c5e68e7d1042c9a7f2d3">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02303">2303</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// The Nym is the original sender. (If Compares true).</span>
    <span class="comment">// GetTransactionNum() is usually already burned, but we can harvest the closing</span>
    <span class="comment">// numbers from the &quot;Closing&quot; list, which is only for the sender&#39;s numbers.</span>
    <span class="comment">// Subclasses will have to override this function for recipients, etc.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (theNym.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()))
    {
        <span class="keywordflow">for</span> (int32_t i = 0; i &lt; <a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>(); i++)
        {
            <span class="comment">// This function will only &quot;add it back&quot; if it was really there in the first place.</span>
            <span class="comment">// (Verifies it is on issued list first, before adding to available list.)</span>
            <span class="comment">//</span>
            <span class="keyword">const</span> <span class="keywordtype">bool</span> bClawedBack =
                theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>(),
                                                 <a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(i),
                                                 (i == (<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>()-1) ? <span class="keyword">true</span> : <span class="keyword">false</span>)); <span class="comment">// bSave=true only on the last iteration.</span>
            <span class="keywordflow">if</span> (!bClawedBack)
            {
<span class="comment">//              OTLog::vError(&quot;OTCronItem::HarvestClosingNumbers: Number (%lld) failed as issued. (Thus didn&#39;t bother &#39;adding it back&#39;.)\n&quot;,</span>
<span class="comment">//                            GetClosingTransactionNoAt(i));</span>
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab4adba19339e539c05bba94717c481cc"></a><!-- doxytag: member="OTCronItem::HarvestOpeningNumber" ref="ab4adba19339e539c05bba94717c481cc" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#ab4adba19339e539c05bba94717c481cc">OTCronItem::HarvestOpeningNumber</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#a181efb58949ade53e690f4ebb0f4cfab">OTAgreement</a>, and <a class="el" href="class_o_t_smart_contract.html#a6eaf2a458eb665dae9e25f026db27f8f">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02275">2275</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// The Nym is the original sender. (If Compares true).</span>
    <span class="comment">// IN CASES where GetTransactionNum() isn&#39;t already burned, we can harvest it here.</span>
    <span class="comment">// Subclasses will have to override this function for recipients, etc.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (theNym.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()))
    {
        <span class="comment">// This function will only &quot;add it back&quot; if it was really there in the first place.</span>
        <span class="comment">// (Verifies it is on issued list first, before adding to available list.)</span>
        <span class="comment">//</span>
        theNym.<a class="code" href="class_o_t_pseudonym.html#a29c787987f96abc9de8f3b268596a79e">ClawbackTransactionNumber</a>(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>(), <a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>(), <span class="keyword">true</span>); <span class="comment">//bSave=true</span>
    }

    <span class="comment">// NOTE: if the message failed (transaction never actually ran) then the sender AND recipient</span>
    <span class="comment">// can both reclaim their opening numbers. But if the message SUCCEEDED and the transaction FAILED,</span>
    <span class="comment">// then only the recipient can claim his opening number -- the sender&#39;s is already burned. So then,</span>
    <span class="comment">// what if you mistakenly call this function and pass the sender, when that number is already burned?</span>
    <span class="comment">// There&#39;s nothing this function can do, because we have no way of telling, from inside here,</span>
    <span class="comment">// whether the message succeeded or not, and whether the transaction succeeded or not. Therefore</span>
    <span class="comment">// we MUST rely on the CALLER to know this, and to avoid calling this function in the first place,</span>
    <span class="comment">// if he&#39;s sitting on a sender with a failed transaction.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9f3818706d6fe1b8880c538392b4d62c"></a><!-- doxytag: member="OTCronItem::HookActivationOnCron" ref="a9f3818706d6fe1b8880c538392b4d62c" args="(OTPseudonym *pActivator, bool bForTheFirstTime=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a9f3818706d6fe1b8880c538392b4d62c">OTCronItem::HookActivationOnCron</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pActivator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bForTheFirstTime</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01504">1504</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);

    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// Put anything else in here, that needs to be done in the</span>
    <span class="comment">// cron item base class, upon activation. (This executes</span>
    <span class="comment">// no matter what, even if onActivate() is overridden.)</span>

    <span class="comment">// -------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (bForTheFirstTime)
        <a class="code" href="class_o_t_cron_item.html#a6d5314654e6544ce8d724a89691965fa">onActivate</a>(); <span class="comment">// Subclasses may override this.</span>
    <span class="comment">//</span>
    <span class="comment">// MOST NOTABLY,</span>
    <span class="comment">// OTSmartContract overrides this, so it can allow the SCRIPT</span>
    <span class="comment">// a chance to hook onActivate() as well.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a70fe4a9257f50547dc62b4f553b05f2d"></a><!-- doxytag: member="OTCronItem::HookRemovalFromCron" ref="a70fe4a9257f50547dc62b4f553b05f2d" args="(OTPseudonym *pRemover)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a70fe4a9257f50547dc62b4f553b05f2d">OTCronItem::HookRemovalFromCron</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pRemover</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01534">1534</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);

    <span class="comment">// -----------------------------------------------------</span>

    <span class="comment">// Generate new transaction number for these new inbox receipts.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int64_t lNewTransactionNumber = pCron-&gt;<a class="code" href="class_o_t_cron.html#a22822e0aeced441b6404cd8a2c8e00da">GetNextTransactionNumber</a>();

    <span class="comment">//  OT_ASSERT(lNewTransactionNumber &gt; 0); // this can be my reminder.</span>
    <span class="keywordflow">if</span> (0 == lNewTransactionNumber)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTCronItem::HookRemovalFromCron: ** ERROR Final receipt not added to inbox, since no &quot;</span>
                     <span class="stringliteral">&quot;transaction numbers were available!\n&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Everytime a payment processes, or a trade, then a receipt is put in the user&#39;s inbox.</span>
        <span class="comment">// This contains a copy of the current payment or trade (which took money from the user&#39;s acct.)</span>
        <span class="comment">//</span>
        <span class="comment">// ==&gt; So I increment the payment count each time before dropping the receipt. (I also use a fresh</span>
        <span class="comment">// transaction number when I put it into the inbox.) That way, the user will never get the same</span>
        <span class="comment">// receipt for the same plan twice. It cannot take funds from his account, without a new payment</span>
        <span class="comment">// count and a new transaction number on a new receipt. Until the user accepts the receipt out</span>
        <span class="comment">// of his inbox with a new balance agreement, the existing receipts can be added up and compared</span>
        <span class="comment">// to the last balance agreement, to verify the current balance. Every receipt from a processing</span>
        <span class="comment">// payment will have the user&#39;s authorization, signature, and terms, as well as the update in balances</span>
        <span class="comment">// due to the payment, signed by the server.</span>

        <span class="comment">// In the case of the FINAL RECEIPT, I do NOT increment the count, so you can see it will have the same</span>
        <span class="comment">// payment count as the last paymentReceipt. (if there were 5 paymentReceipts, from 1 to 5, then the</span>
        <span class="comment">// finalReceipt will also be 5. This is evidence of what the last paymentReceipt WAS.)</span>

        <span class="comment">// -------------------------------------------------------------</span>

        <span class="comment">// The TRANSACTION will be dropped into the INBOX with &quot;In Reference To&quot; information,</span>
        <span class="comment">// containing the ORIGINAL SIGNED REQUEST.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pOrigCronItem  = <a class="code" href="class_o_t_cron_item.html#a368603ca2196ecb8817d42a24138f5d7">OTCronItem::LoadCronReceipt</a>(<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());
        <span class="comment">// OTCronItem::LoadCronReceipt loads the original version with the user&#39;s signature.</span>
        <span class="comment">// (Updated versions, as processing occurs, are signed by the server.)</span>
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOrigCronItem);
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel(*pOrigCronItem);

        <span class="comment">// Note: elsewhere, we verify the Nym&#39;s signature. But in this place, we verify the SERVER&#39;s</span>
        <span class="comment">// signature. (The server signed the cron receipt just before it was first saved, so it has two signatures on it.)</span>
        <span class="comment">//</span>
        {
            <span class="keywordtype">bool</span> bValidSignture = pOrigCronItem-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pServerNym);
            <span class="keywordflow">if</span> (!bValidSignture) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure verifying signature of server on Cron Item!\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
        }

        <span class="comment">// I now have a String copy of the original CronItem...</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOrigCronItem(*pOrigCronItem);
        <span class="comment">// -------------------------------------------------------</span>

        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theOriginatorNym; <span class="comment">// Don&#39;t use this... use the pointer just below.</span>

        <span class="comment">// The Nym who is actively requesting to remove a cron item will be passed in as pRemover.</span>
        <span class="comment">// However, sometimes there is no Nym... perhaps it just expired and pRemover is NULL.</span>
        <span class="comment">// The originating Nym (if different than remover) is loaded up. Otherwise the originator</span>
        <span class="comment">// pointer just pointers to *pRemover.</span>
        <span class="comment">//</span>
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pOriginator = NULL;

        <span class="keywordflow">if</span> (pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(pOrigCronItem-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()))
        {
            pOriginator = pServerNym; <span class="comment">// Just in case the originator Nym is also the server Nym.</span>
        }                               <span class="comment">// This MIGHT be unnecessary, since pRemover is(I think) already transmogrified</span>
        <span class="comment">// ******************************************************* to pServer earlier, if they share the same ID.</span>
        <span class="comment">//</span>
        <span class="comment">// If pRemover is NOT NULL, and he has the Originator&#39;s ID...</span>
        <span class="comment">// then set the pointer accordingly.</span>
        <span class="comment">//</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((NULL != pRemover) &amp;&amp; (<span class="keyword">true</span> == pRemover-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(pOrigCronItem-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>())))
        {
            pOriginator = pRemover; <span class="comment">// &lt;======== now both pointers are set (to same Nym). DONE!</span>
        }
        <span class="comment">// --------------------------------------------------------------------------------------------------</span>
        <span class="comment">// At this point, pRemover MIGHT be set, or NULL. (And that&#39;s that -- pRemover may always be NULL.)</span>
        <span class="comment">//</span>
        <span class="comment">// if pRemover IS set, then pOriginator MIGHT point to it as well. (If the IDs match. Done above.)</span>
        <span class="comment">// pOriginator might also still be NULL. (If pRemover is NULL, then pOriginator DEFINITELY is.)</span>
        <span class="comment">// pRemover is loaded (or not). Next let&#39;s make SURE pOriginator is loaded, if it wasn&#39;t already...</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL == pOriginator)
        {
            <span class="comment">// GetSenderUserID() should be the same on THIS (updated version of the same cron item)</span>
            <span class="comment">// but for whatever reason, I&#39;m checking the userID on the original version. Sue me.</span>
            <span class="comment">//</span>
            <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> NYM_ID(pOrigCronItem-&gt;<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>());

            theOriginatorNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(NYM_ID);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == theOriginatorNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>())
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::HookRemovalFromCron: Failure loading Sender&#39;s public key:\n%s\n&quot;</span>, strNymID.Get());
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theOriginatorNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>() &amp;&amp;
                     theOriginatorNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym)) <span class="comment">// ServerNym here is merely the signer on this file.</span>
            {
                pOriginator = &amp;theOriginatorNym; <span class="comment">//  &lt;=====</span>
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::HookRemovalFromCron: Failure verifying Sender&#39;s public key or loading signed nymfile: %s\n&quot;</span>,
                              strNymID.Get());
            }
        }

        <span class="comment">// -------------------------------</span>

        <span class="comment">// pOriginator should NEVER be NULL by this point, unless there was an ERROR in the above block.</span>
        <span class="comment">// We even loaded the guy from storage, if we had to.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (NULL != pOriginator)
        {
            <span class="comment">// Drop the FINAL RECEIPT(s) into the user&#39;s inbox(es)!!</span>
            <span class="comment">// Pass in strOrigCronItem and lNewTransactionNumber which were obtained above.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_cron_item.html#ac24d58b1aec6a6471a79f30146e7a300">onFinalReceipt</a>(*pOrigCronItem, lNewTransactionNumber, *pOriginator, pRemover);
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;MAJOR ERROR in OTCronItem::HookRemovalFromCron!! Failed loading Originator Nym for Cron Item.\n&quot;</span>);
        }
    }

    <span class="comment">// -------------------------------------------------------</span>
    <span class="comment">// Remove corresponding offer from market, if applicable.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_cron_item.html#ad7aa9b289746ab01661997a19b1335b1">onRemovalFromCron</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d2f2bb68d5b48775e1e47a091427fb6"></a><!-- doxytag: member="OTCronItem::InitCronItem" ref="a5d2f2bb68d5b48775e1e47a091427fb6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a5d2f2bb68d5b48775e1e47a091427fb6">OTCronItem::InitCronItem</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02401">2401</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(<span class="stringliteral">&quot;CRONITEM&quot;</span>); <span class="comment">// in practice should never appear. Child classes will overwrite.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a78f165173c66d8de46fc0a1aebeee629"></a><!-- doxytag: member="OTCronItem::IsCanceled" ref="a78f165173c66d8de46fc0a1aebeee629" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT bool <a class="el" href="class_o_t_cron_item.html#a78f165173c66d8de46fc0a1aebeee629">OTCronItem::IsCanceled</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00312">312</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a5fd32eb6600ee9740e5e99acebcaa2d8"></a><!-- doxytag: member="OTCronItem::IsFlaggedForRemoval" ref="a5fd32eb6600ee9740e5e99acebcaa2d8" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a5fd32eb6600ee9740e5e99acebcaa2d8">OTCronItem::IsFlaggedForRemoval</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00223">223</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a9fd34100c4c79adf325c61ba268008ef"></a><!-- doxytag: member="OTCronItem::IsValidOpeningNumber" ref="a9fd34100c4c79adf325c61ba268008ef" args="(const int64_t &amp;lOpeningNum) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a9fd34100c4c79adf325c61ba268008ef">OTCronItem::IsValidOpeningNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lOpeningNum</em></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#aa5a554f7a5ca7c9a0d0d2377860ef8c2">OTSmartContract</a>, and <a class="el" href="class_o_t_agreement.html#a9519a69017a69b0de357bf8f802ee903">OTAgreement</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02238">2238</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>() == lOpeningNum)
        <span class="keywordflow">return</span> <span class="keyword">true</span>;

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9478c280789d9400a4b7933626397ece"></a><!-- doxytag: member="OTCronItem::LoadActiveCronReceipt" ref="a9478c280789d9400a4b7933626397ece" args="(const int64_t &amp;lTransactionNum, const OTIdentifier &amp;serverID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a> * <a class="el" href="class_o_t_cron_item.html#a9478c280789d9400a4b7933626397ece">OTCronItem::LoadActiveCronReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>serverID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00267">267</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename, strServerID(serverID);
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.crn&quot;</span>, lTransactionNum);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername   = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), szFilename))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: File does not exist: %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFoldername, strServerID.Get(), szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>

    <span class="keywordflow">if</span> (strFileContents.GetLength() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error reading file: %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">else</span>
        <span class="comment">// NOTE: NewCronItem can handle the normal cron item contracts, as well as the OT ARMORED version</span>
        <span class="comment">// (It will decode the armor before instantiating the contract.) Therefore there&#39;s no need HERE in</span>
        <span class="comment">// THIS function to do any decoding...</span>
        <span class="comment">//</span>
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strFileContents);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a368603ca2196ecb8817d42a24138f5d7"></a><!-- doxytag: member="OTCronItem::LoadCronReceipt" ref="a368603ca2196ecb8817d42a24138f5d7" args="(const int64_t &amp;lTransactionNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a> * <a class="el" href="class_o_t_cron_item.html#a368603ca2196ecb8817d42a24138f5d7">OTCronItem::LoadCronReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lTransactionNum</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00234">234</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.crn&quot;</span>, lTransactionNum);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername   = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, szFilename))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: File does not exist: %s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFileContents(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFoldername, szFilename)); <span class="comment">// &lt;=== LOADING FROM DATA STORE.</span>

    <span class="keywordflow">if</span> (strFileContents.GetLength() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error reading file: %s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="keywordflow">else</span>
        <span class="comment">// NOTE: NewCronItem can handle the normal cron item contracts, as well as the OT ARMORED version</span>
        <span class="comment">// (It will decode the armor before instantiating the contract.) Therefore there&#39;s no need HERE in</span>
        <span class="comment">// THIS function to do any decoding...</span>
        <span class="comment">//</span>
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strFileContents);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a45b93f38aa36e1b0e4c3ab01e1682119"></a><!-- doxytag: member="OTCronItem::MoveFunds" ref="a45b93f38aa36e1b0e4c3ab01e1682119" args="(const mapOfNyms &amp;map_NymsAlreadyLoaded, const int64_t &amp;lAmount, const OTIdentifier &amp;SOURCE_ACCT_ID, const OTIdentifier &amp;SENDER_USER_ID, const OTIdentifier &amp;RECIPIENT_ACCT_ID, const OTIdentifier &amp;RECIPIENT_USER_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a45b93f38aa36e1b0e4c3ab01e1682119">OTCronItem::MoveFunds</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> &amp;&#160;</td>
          <td class="paramname"><em>map_NymsAlreadyLoaded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lAmount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SOURCE_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SENDER_USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>RECIPIENT_USER_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00602">602</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);
    <span class="comment">// --------------------------------------------------------</span>

    <span class="keywordflow">if</span> (lAmount &lt;= 0)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot; OTCronItem::MoveFunds: Error: lAmount cannot be 0 or &lt;0. (Value passed in was %lld.)\n&quot;</span>,
                       lAmount);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------</span>

    <span class="keywordtype">bool</span>                    bSuccess = <span class="keyword">false</span>;   <span class="comment">// The return value.</span>
    <span class="comment">// --------------------------------------------------------</span>

    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>      SERVER_ID(pCron-&gt;<a class="code" href="class_o_t_cron.html#a93b52f56c0de94e53bb05a610830ba4b">GetServerID</a>());
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>      SERVER_USER_ID(*pServerNym);
    <span class="comment">// --------------------------------------------------------</span>

    <a class="code" href="class_o_t_string.html">OTString</a>    strSenderUserID(SENDER_USER_ID), strRecipientUserID(RECIPIENT_USER_ID),
                strSourceAcctID(SOURCE_ACCT_ID), strRecipientAcctID(RECIPIENT_ACCT_ID),
                strServerNymID(SERVER_USER_ID);

    <span class="comment">// Make sure they&#39;re not the same Account IDs ...</span>
    <span class="comment">// Otherwise we would have to take care not to load them twice, like with the Nyms below.</span>
    <span class="comment">// (Instead I just disallow it entirely. After all, even if I DID allow the account to transfer</span>
    <span class="comment">// to itself, there would be no difference in balance than disallowing it.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (SOURCE_ACCT_ID == RECIPIENT_ACCT_ID)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Aborted move: both account IDs were identical.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove from Cron</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TODO: should have a &quot;Validate Scripts&quot; function that weeds this crap out before we even get here. (There are other examples...)</span>
    }
    <span class="comment">// When the accounts are actually loaded up, then we should also compare</span>
    <span class="comment">// the asset types to make sure they were what we expected them to be.</span>

    <span class="comment">// -----------------------------------------------------------------</span>

    <span class="comment">// Need to load up the ORIGINAL VERSION OF THIS SMART CONTRACT</span>
    <span class="comment">// Will need to verify the parties&#39; signatures, as well as attach a copy of it to the receipt.</span>

    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pOrigCronItem  = NULL;

    <span class="comment">// OTCronItem::LoadCronReceipt loads the original version with the user&#39;s signature.</span>
    <span class="comment">// (Updated versions, as processing occurs, are signed by the server.)</span>
    pOrigCronItem       = <a class="code" href="class_o_t_cron_item.html#a368603ca2196ecb8817d42a24138f5d7">OTCronItem::LoadCronReceipt</a>(<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOrigCronItem);   <span class="comment">// How am I processing it now if the receipt wasn&#39;t saved in the first place??</span>
    <span class="comment">// TODO: Decide global policy for handling situations where the hard drive stops working, etc.</span>

    <span class="comment">// When theOrigPlanGuardian goes out of scope, pOrigCronItem gets deleted automatically.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a>   theOrigPlanGuardian(*pOrigCronItem);

    <span class="comment">// strOrigPlan is a String copy (a PGP-signed XML file, in string form) of the original Payment Plan request...</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strOrigPlan(*pOrigCronItem); <span class="comment">// &lt;====== Farther down in the code, I attach this string to the receipts.</span>


    <span class="comment">// Make sure to clean these up.</span>
    <span class="comment">//  delete pOrigCronItem;       // theOrigPlanGuardian will handle this now, whenever it goes out of scope.</span>
    <span class="comment">//  pOrigCronItem = NULL;       // So I don&#39;t need to worry about deleting this anymore. I can keep it around and</span>
    <span class="comment">// use it all I want, and return anytime, and it won&#39;t leak.</span>



    <span class="comment">// -------------- Make sure have both nyms loaded and checked out. --------------------------------------------------</span>
    <span class="comment">// WARNING: 1 or both of the Nyms could be also the Server Nym. They could also be the same Nym, but NOT the Server.</span>
    <span class="comment">// In all of those different cases, I don&#39;t want to load the same file twice and overwrite it with itself, losing</span>
    <span class="comment">// half of all my changes. I have to check all three IDs carefully and set the pointers accordingly, and then operate</span>
    <span class="comment">// using the pointers from there.</span>


    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theSenderNym, theRecipientNym; <span class="comment">// We MIGHT use ONE, OR BOTH, of these, or none. (But probably both.)</span>

    <span class="comment">// Find out if either Nym is actually also the server.</span>
    <span class="keywordtype">bool</span> bSenderNymIsServerNym      = ((SENDER_USER_ID      == SERVER_USER_ID) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
    <span class="keywordtype">bool</span> bRecipientNymIsServerNym   = ((RECIPIENT_USER_ID   == SERVER_USER_ID) ? <span class="keyword">true</span> : <span class="keyword">false</span>);

    <span class="comment">// We also see, after all that is done, whether both pointers go to the same entity.</span>
    <span class="comment">// (We&#39;ll want to know that later.)</span>
    <span class="keywordtype">bool</span> bUsersAreSameNym           = ((SENDER_USER_ID == RECIPIENT_USER_ID) ? <span class="keyword">true</span> : <span class="keyword">false</span>);

    <span class="comment">// -----------------------------------------------------</span>

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSenderNym            = NULL;
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pRecipientNym         = NULL;
    <span class="comment">// --------------------------</span>
    mapOfNyms::const_iterator it_sender     = map_NymsAlreadyLoaded.find(strSenderUserID.Get());
    mapOfNyms::const_iterator it_recipient  = map_NymsAlreadyLoaded.find(strRecipientUserID.Get());

    <span class="keywordflow">if</span> (map_NymsAlreadyLoaded.end() != it_sender) <span class="comment">// found the sender in list of Nyms that are already loaded.</span>
    {
        pSenderNym = (*it_sender).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((NULL != pSenderNym) &amp;&amp; (pSenderNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(SENDER_USER_ID)));
    }
    <span class="keywordflow">if</span> (map_NymsAlreadyLoaded.end() != it_recipient) <span class="comment">// found the recipient in list of Nyms that are already loaded.</span>
    {
        pRecipientNym = (*it_recipient).second;
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((NULL != pRecipientNym) &amp;&amp; (pRecipientNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(RECIPIENT_USER_ID)));
    }
    <span class="comment">// ------------------</span>

    <span class="comment">// Figure out if Sender Nym is also Server Nym.</span>
    <span class="keywordflow">if</span> (bSenderNymIsServerNym)
    {
        <span class="comment">// If the First Nym is the server, then just point to that.</span>
        pSenderNym = pServerNym;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pSenderNym)    <span class="comment">// Else load the First Nym from storage, if still not found.</span>
    {
        theSenderNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(SENDER_USER_ID);  <span class="comment">// theSenderNym is pSenderNym</span>

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == theSenderNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strNymID(SENDER_USER_ID);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failure loading Sender Nym public key: %s\n&quot;</span>,
                          strNymID.Get());
            <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="keywordflow">if</span> (theSenderNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>()  &amp;&amp;
            theSenderNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym)) <span class="comment">// ServerNym here is not theSenderNym&#39;s identity, but merely the signer on this file.</span>
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Loading sender Nym, since he **** APPARENTLY **** wasn&#39;t already loaded.\n&quot;</span>
                          <span class="stringliteral">&quot;(On a cron item processing, this is normal. But if you triggered a clause directly, then your Nym SHOULD be already loaded...)\n&quot;</span>);
            pSenderNym = &amp;theSenderNym; <span class="comment">//  &lt;=====</span>
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strNymID(SENDER_USER_ID);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failure loading or verifying Sender Nym public key: %s\n&quot;</span>,
                          strNymID.Get());
            <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// ------------------</span>

    <span class="comment">// Next, we also find out if Recipient Nym is Server Nym...</span>
    <span class="keywordflow">if</span> (bRecipientNymIsServerNym)
    {
        <span class="comment">// If the Recipient Nym is the server, then just point to that.</span>
        pRecipientNym = pServerNym;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bUsersAreSameNym)  <span class="comment">// Else if the participants are the same Nym, point to the one we already loaded.</span>
    {
        pRecipientNym = pSenderNym; <span class="comment">// theSenderNym is pSenderNym</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pRecipientNym) <span class="comment">// Otherwise load the Other Nym from Disk and point to that, if still not found.</span>
    {
        theRecipientNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(RECIPIENT_USER_ID);

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == theRecipientNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>())
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strNymID(RECIPIENT_USER_ID);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failure loading Recipient Nym public key: %s\n&quot;</span>,
                          strNymID.Get());
            <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="keywordflow">if</span> (theRecipientNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>()   &amp;&amp;
            theRecipientNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym))
        {
            <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Loading recipient Nym, since he **** APPARENTLY **** wasn&#39;t already loaded.\n&quot;</span>
                          <span class="stringliteral">&quot;(On a cron item processing, this is normal. But if you triggered a clause directly, then your Nym SHOULD be already loaded...)\n&quot;</span>);

            pRecipientNym = &amp;theRecipientNym; <span class="comment">//  &lt;=====</span>
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strNymID(RECIPIENT_USER_ID);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failure loading or verifying Recipient Nym public key: %s\n&quot;</span>,
                          strNymID.Get());
            <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="comment">// Below this point, both Nyms are loaded and good-to-go.</span>
    <span class="comment">// -----------------------------------------------------------------</span>

    <a class="code" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> map_ALREADY_LOADED; <span class="comment">// I know I passed in one of these, but now I have processed the Nym pointers (above) and have better data here now.</span>
    mapOfNyms::iterator it_temp;

    it_temp = map_ALREADY_LOADED.find(strServerNymID.Get());
    <span class="keywordflow">if</span> (map_ALREADY_LOADED.end() == it_temp)
        map_ALREADY_LOADED.insert(std::pair&lt;std::string,OTPseudonym*&gt;(strServerNymID.Get(),     pServerNym));  <span class="comment">// Add Server Nym to list of Nyms already loaded.</span>
    it_temp = map_ALREADY_LOADED.find(strSenderUserID.Get());
    <span class="keywordflow">if</span> (map_ALREADY_LOADED.end() == it_temp)
        map_ALREADY_LOADED.insert(std::pair&lt;std::string,OTPseudonym*&gt;(strSenderUserID.Get(),    pSenderNym));  <span class="comment">// Add Sender Nym to list of Nyms already loaded.</span>
    it_temp = map_ALREADY_LOADED.find(strRecipientUserID.Get());
    <span class="keywordflow">if</span> (map_ALREADY_LOADED.end() == it_temp)
        map_ALREADY_LOADED.insert(std::pair&lt;std::string,OTPseudonym*&gt;(strRecipientUserID.Get(), pRecipientNym));  <span class="comment">// Add Recipient Nym to list of Nyms already loaded.</span>
    <span class="comment">//</span>
    <span class="comment">//  I set up map_ALREADY_LOADED here so that when I call VerifyAgentAsNym(), I can pass it along. VerifyAgentAsNym often</span>
    <span class="comment">//  just verifies ownership (for individual nym owners who act as their own agents.) BUT... If we&#39;re in a smart contract,</span>
    <span class="comment">//  or other OTScriptable, there might be a party owned by an entity, and a signature needs to be checked that ISN&#39;T the</span>
    <span class="comment">//  same Nym! (Perhaps the entity signed the smartcontract via another signer Nym.) This means I might potentially have to</span>
    <span class="comment">//  LOAD the other signer Nym, in order to verify his signature...BUT WHAT IF HE&#39;S ALREADY LOADED?</span>
    <span class="comment">//</span>
    <span class="comment">//  THAT... is exactly why I am passing in a list now of all the Nyms that are already loaded... So if the authorizing Nym for</span>
    <span class="comment">//  any given party happens to already be loaded on that list, it can use it, instead of loading it twice (and potentially</span>
    <span class="comment">//  overwriting data... Bad thing!)</span>
    <span class="comment">//</span>
    <span class="comment">// Now that I have the original cron item loaded, and all the Nyms ready to go,</span>
    <span class="comment">// let&#39;s make sure that BOTH the nyms in question have SIGNED the original request.</span>
    <span class="comment">// (Their signatures wouldn&#39;t be on the updated version in Cron--the server signs</span>
    <span class="comment">// that one. Except smart contracts, which keep a signed copy automatically for each party.)</span>
    <span class="comment">//</span>
    <span class="comment">// NOTE: originally I used to just verify here that both Nyms have signed the original</span>
    <span class="comment">// cron item. But now I provide a virtual method to do that (which it still does, by default.)</span>
    <span class="comment">// But in the case of smart contracts, it&#39;s more complicated. The Nym might merely be an agent</span>
    <span class="comment">// for a party, (legitimately) but where a DIFFERENT agent is the one who originally signed.</span>
    <span class="comment">// Thus, I have to allow SmartContract to override the method so it can add that extra intelligence.</span>
    <span class="comment">//</span>
    <span class="comment">// NOTE: This function does NOT verify that the Nyms are authorized for the ASSET ACCOUNTS--either the</span>
    <span class="comment">// party providing authorization OR the acct itself. Instead, this ONLY verifies that they are actually</span>
    <span class="comment">// agents for legitimate parties to this agreement ACCORDING TO THOSE PARTIES, (regardless of the asset</span>
    <span class="comment">// accounts) and that said agreement has also been signed by authorized agents of those parties.</span>
    <span class="comment">// (Usually the agent who originally signed, and the agent signing now, and the</span>
    <span class="comment">// party that agent represents, are all in reality the SAME NYM. But in the case of</span>
    <span class="comment">// smart contracts, they can be different Nyms, which is why we now have an overridable virtual method</span>
    <span class="comment">// for this, instead of simply verifying both signatures on the cron item itself, as the default</span>
    <span class="comment">// OTTrade and OTAgreement versions of that virtual method will continue to do.</span>
    <span class="comment">//</span>
    <span class="comment">// Repeat: this is not about verifying account ownershp or permissions. It&#39;s ONLY about verifying</span>
    <span class="comment">// that these nyms are actually authorized to act as parties to the agreement. Verifying their ownership</span>
    <span class="comment">// rights over the asset accounts is done separately below.</span>
    <span class="comment">//</span>
    <span class="comment">// Another thing: The original &quot;VerifySignature()&quot; proved that the NYM HIMSELF had signed/authorized,</span>
    <span class="comment">// whereas now it&#39;s more like, prove which party owns the account, then prove that party has authorized</span>
    <span class="comment">// Nym as his agent.</span>
    <span class="comment">//</span>

    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// VerifyNymAsAgent() replaces VerifySignature() here. It&#39;s polymorphic, so VerifySignature() is still called</span>
    <span class="comment">// directly on theNym in certain versions (agreement, trade...) but otherwise there is now more to it than that.</span>
    <span class="comment">// See OTScriptable for the complicated version. Either way, it makes sure that the right person signed and that</span>
    <span class="comment">// theNym is authorized to act by that person. (As far as pOrigCronItem cares -- the Account may still disagree.)</span>
    <span class="comment">// This verifies:</span>
    <span class="comment">// - that the Nym is found as an agent on one of the parties.</span>
    <span class="comment">// - that there is an &quot;original party signed copy&quot; of the contract attached to the party.</span>
    <span class="comment">// - that there is an authorizing agent for that party whose SIGNATURE VERIFIES on the party&#39;s signed copy.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!pOrigCronItem-&gt;<a class="code" href="class_o_t_scriptable.html#a242f30ff4c6deccf285930efa15638eb">VerifyNymAsAgent</a>(*pSenderNym, *pServerNym,
                                         <span class="comment">// In case it needs to load the AUTHORIZING agent, and that agent is already loaded, it will have access here.</span>
                                         &amp;map_ALREADY_LOADED))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failed authorization for sender Nym: %s\n&quot;</span>, strSenderUserID.Get());
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from Cron.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (!pOrigCronItem-&gt;<a class="code" href="class_o_t_scriptable.html#a242f30ff4c6deccf285930efa15638eb">VerifyNymAsAgent</a>(*pRecipientNym, *pServerNym,
                                         <span class="comment">// In case it needs to load the AUTHORIZING agent, and that agent is already loaded, it will have access here.</span>
                                         &amp;map_ALREADY_LOADED))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Failed authorization for recipient Nym: %s\n&quot;</span>, strRecipientUserID.Get());
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from Cron.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// (verifications)</span>
    <span class="comment">//</span>
    <span class="comment">// -- DONE Verify that both Nyms are actually authorized to act as agents for the parties. (in the cron item.) This is like pOrig-&gt;VerifySignature(theNym);</span>
    <span class="comment">// -- DONE Verify that both parties have properly signed/executed the contract. This may mean loading a DIFFERENT Nym (the authorizing agent who signed for the party originally)</span>
    <span class="comment">//    This is also like pOrig-&gt;VerifySignature(theNym); the extra functionality is added via polymorphism.</span>
    <span class="comment">// -- DONE Verify that both Nyms are authorized agents FOR THE ASSET ACCOUNTS IN QUESTION, according to their PARTIES. This is like pParty-&gt;HasAgent(theNym);</span>
    <span class="comment">// -- DONE Verify that both ACCOUNTS are owned by the parties that the Nyms represent.  According to the ACCOUNTS. This is like pAcct-&gt;VerifyOwner(theNym)</span>
    <span class="comment">//    The above two items should ALSO be done polymorphically, just like the first two.</span>
    <span class="comment">// -- If the Nyms are not the parties they represent, then verify that they have the proper Role at their entities in order to claim such authority.</span>
    <span class="comment">//    Does this last one go into OTAccount itself? Or OTScriptable. And the actual verification part will be probably in OTAgent, just like VerifySignature was.</span>
    <span class="comment">//</span>
    <span class="comment">//  if (!pOrigCronItem-&gt;VerifySignature(*pSenderNym) || !pOrigCronItem-&gt;VerifySignature(*pRecipientNym))</span>
    <span class="comment">//</span>
    <span class="comment">//  {</span>
    <span class="comment">//      OTLog::Error(&quot;OTCronItem::MoveFunds: Failed authorization.\n&quot;);</span>
    <span class="comment">//      FlagForRemoval(); // Remove it from Cron.</span>
    <span class="comment">//      return false;</span>
    <span class="comment">//  }</span>


    <span class="comment">// AT THIS POINT, I have pServerNym, pSenderNym, and pRecipientNym.</span>
    <span class="comment">// ALL are loaded from disk (where necessary.) AND...</span>
    <span class="comment">// ALL are valid pointers, (even if they sometimes point to the same object,)</span>
    <span class="comment">// AND none are capable of overwriting the storage of the other (by accidentally</span>
    <span class="comment">// loading the same storage twice.)</span>
    <span class="comment">// We also have boolean variables at this point to tell us exactly which are which,</span>
    <span class="comment">// (in case some of those pointers do go to the same object.)</span>
    <span class="comment">// They are:</span>
    <span class="comment">// bSenderNymIsServerNym, bRecipientNymIsServerNym, and bUsersAreSameNym.</span>
    <span class="comment">//</span>
    <span class="comment">// I also have pOrigCronItem, which is a dynamically-allocated copy of the original</span>
    <span class="comment">// Cron Receipt for this Cron Item. (And I don&#39;t need to worry about deleting it, either.)</span>
    <span class="comment">// I know for a fact they are both authorized on pOrigCronItem...</span>
    <span class="comment">// -----------------------------------------------------------------</span>

    <span class="comment">// LOAD THE ACCOUNTS</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_account.html">OTAccount</a> * pSourceAcct     = <a class="code" href="class_o_t_account.html#a6574057f6e3415546d3a9f7d7e445e4f">OTAccount::LoadExistingAccount</a>(SOURCE_ACCT_ID, SERVER_ID);

    <span class="keywordflow">if</span> (NULL == pSourceAcct)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR verifying existence of source account.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Past this point we know pSourceAcct is good and will clean itself up.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a>    theSourceAcctSmrtPtr(*pSourceAcct);
    <span class="comment">// -----------------------------------------------------------------</span>

    <a class="code" href="class_o_t_account.html">OTAccount</a> * pRecipientAcct  = <a class="code" href="class_o_t_account.html#a6574057f6e3415546d3a9f7d7e445e4f">OTAccount::LoadExistingAccount</a>(RECIPIENT_ACCT_ID, SERVER_ID);

    <span class="keywordflow">if</span> (NULL == pRecipientAcct)
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR verifying existence of recipient account.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// Past this point we know pRecipientAcct is good and will clean itself up.</span>
    <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a>    theRecipAcctSmrtPtr(*pRecipientAcct);
    <span class="comment">// -----------------------------------------------------------------</span>


    <span class="comment">// BY THIS POINT, both accounts are successfully loaded, and I don&#39;t have to worry about</span>
    <span class="comment">// cleaning either one of them up, either. But I can now use pSourceAcct and pRecipientAcct...</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    <span class="comment">// -----------------------------------------------------------------------------------</span>

    <span class="comment">// A few verification if/elses...</span>

    <span class="comment">// Are both accounts of the same Asset Type?</span>
    <span class="keywordflow">if</span> (pSourceAcct-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>() != pRecipientAcct-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>())
    {   <span class="comment">// We already know the SUPPOSED Asset IDs of these accounts... But only once</span>
        <span class="comment">// the accounts THEMSELVES have been loaded can we VERIFY this to be true.</span>
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR - attempted payment between accounts of different &quot;</span>
                      <span class="stringliteral">&quot;asset types.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// -------------------------------------------------------------------------</span>
    <span class="comment">// I call VerifySignature (WITH SERVER NYM) here since VerifyContractID was</span>
    <span class="comment">// already called in LoadExistingAccount().</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pSourceAcct-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pServerNym) || !this-&gt;<a class="code" href="class_o_t_scriptable.html#a844de5b0eb2560a28bf795c2c4da3f3b">VerifyNymAsAgentForAccount</a>(*pSenderNym, *pSourceAcct) )
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR verifying signature or ownership on source account.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pRecipientAcct-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(*pServerNym) || !this-&gt;<a class="code" href="class_o_t_scriptable.html#a844de5b0eb2560a28bf795c2c4da3f3b">VerifyNymAsAgentForAccount</a>(*pRecipientNym, *pRecipientAcct) )
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR verifying signature or ownership on recipient account.\n&quot;</span>);
        <a class="code" href="class_o_t_cron_item.html#a34c87380d2f8cd419c9a5cfec86427b4">FlagForRemoval</a>(); <span class="comment">// Remove it from future Cron processing, please.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------------------------------</span>


    <span class="comment">// By this point, I know I have both accounts loaded, and I know that they have the right asset types,</span>
    <span class="comment">// and I know they have the right owners and they were all signed by the server.</span>
    <span class="comment">// I also know that their account IDs in their internal records matched the account filename for each acct.</span>
    <span class="comment">// I also have pointers to the Nyms who own these accounts.</span>

    <span class="keywordflow">else</span>
    {
        <span class="comment">// Okay then, everything checks out. Let&#39;s add a receipt to the sender&#39;s inbox and the recipient&#39;s inbox.</span>
        <span class="comment">// IF they can be loaded up from file, or generated, that is.</span>

        <span class="comment">// Load the inboxes in case they already exist</span>
        <a class="code" href="class_o_t_ledger.html">OTLedger</a>    theSenderInbox      (SENDER_USER_ID,    SOURCE_ACCT_ID,     SERVER_ID),
                    theRecipientInbox   (RECIPIENT_USER_ID, RECIPIENT_ACCT_ID,  SERVER_ID);

        <span class="comment">// ALL inboxes -- no outboxes. All will receive notification of something ALREADY DONE.</span>
        <span class="keywordtype">bool</span> bSuccessLoadingSenderInbox     = theSenderInbox.LoadInbox();
        <span class="keywordtype">bool</span> bSuccessLoadingRecipientInbox  = theRecipientInbox.LoadInbox();

        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="comment">// ...or generate them otherwise...</span>

        <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccessLoadingSenderInbox)
            bSuccessLoadingSenderInbox      = theSenderInbox.VerifyAccount(*pServerNym);
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR loading sender inbox ledger.\n&quot;</span>);
<span class="comment">//      else</span>
<span class="comment">//          bSuccessLoadingSenderInbox      = theSenderInbox.GenerateLedger(SOURCE_ACCT_ID, SERVER_ID, OTLedger::inbox, true); // bGenerateFile=true</span>

        <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccessLoadingRecipientInbox)
            bSuccessLoadingRecipientInbox   = theRecipientInbox.VerifyAccount(*pServerNym);
        <span class="keywordflow">else</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR loading recipient inbox ledger.\n&quot;</span>);
<span class="comment">//      else</span>
<span class="comment">//          bSuccessLoadingRecipientInbox   = theRecipientInbox.GenerateLedger(RECIPIENT_ACCT_ID, SERVER_ID, OTLedger::inbox, true); // bGenerateFile=true</span>

        <span class="comment">// --------------------------------------------------------------------</span>

        <span class="keywordflow">if</span> ((<span class="keyword">false</span> == bSuccessLoadingSenderInbox)   ||
            (<span class="keyword">false</span> == bSuccessLoadingRecipientInbox))
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: ERROR loading or generating one (or both) of the inbox ledgers.\n&quot;</span>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Generate new transaction numbers for these new transactions</span>
            int64_t lNewTransactionNumber = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;<a class="code" href="class_o_t_cron.html#a22822e0aeced441b6404cd8a2c8e00da">GetNextTransactionNumber</a>();

            <span class="comment">//          OT_ASSERT(lNewTransactionNumber &gt; 0); // this can be my reminder.</span>
            <span class="keywordflow">if</span> (0 == lNewTransactionNumber)
            {
                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Aborted move: There are no more transaction numbers available.\n&quot;</span>);
                <span class="comment">// (Here I do NOT flag for removal.)</span>
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }

            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransSend      = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(theSenderInbox,
                                                                                 <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>, lNewTransactionNumber);

            <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransRecip     = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(theRecipientInbox,
                                                                                 <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>, lNewTransactionNumber);

            <span class="comment">// (No need to OT_ASSERT on the above transactions since it occurs in GenerateTransaction().)</span>


            <span class="comment">// Both inboxes will get receipts with the same (new) transaction ID on them.</span>
            <span class="comment">// They will have a &quot;In reference to&quot; field containing the original payment plan</span>
            <span class="comment">// (with user&#39;s signature).</span>

            <span class="comment">// set up the transaction items (each transaction may have multiple items... but not in this case.)</span>
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItemSend      = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransSend,  <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);
            <a class="code" href="class_o_t_item.html">OTItem</a> * pItemRecip     = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pTransRecip, <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1abcb18b39d8a5da830bdc9b52a825d47b">OTItem::paymentReceipt</a>);

            <span class="comment">// these may be unnecessary, I&#39;ll have to check CreateItemFromTransaction. I&#39;ll leave em.</span>
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItemSend);
            <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItemRecip);

            pItemSend-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>); <span class="comment">// the default.</span>
            pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>); <span class="comment">// the default.</span>

            <span class="comment">/* (from above)</span>
<span class="comment">            OTString    strSenderUserID(SENDER_USER_ID), strRecipientUserID(RECIPIENT_USER_ID),</span>
<span class="comment">                        strSourceAcctID(SOURCE_ACCT_ID), strRecipientAcctID(RECIPIENT_ACCT_ID),</span>
<span class="comment">                        strServerNymID(SERVER_USER_ID);</span>
<span class="comment"></span>
<span class="comment">             // ------------------------------------------------------</span>
<span class="comment">             // (from OTCronItem.h)</span>
<span class="comment">             virtual int64_t GetOpeningNumber(OTIdentifier  &amp; theNymID) const;</span>
<span class="comment">             virtual int64_t GetClosingNumber(OTIdentifier  &amp; theAcctID) const;</span>
<span class="comment">             // ------------------------------------------------------ */</span>
             <span class="comment">//</span>
<span class="comment">//          const int64_t lTransSendRefNo   = GetTransactionNum();</span>
<span class="comment">//          const int64_t lTransRecipRefNo  = GetTransactionNum();</span>
            <span class="keyword">const</span> int64_t lTransSendRefNo   = this-&gt;<a class="code" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a>(SENDER_USER_ID);
            <span class="keyword">const</span> int64_t lTransRecipRefNo  = this-&gt;<a class="code" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a>(RECIPIENT_USER_ID);

            <span class="comment">// Here I make sure that each receipt (each inbox notice) references the original</span>
            <span class="comment">// transaction number that was used to set the cron item into place...</span>
            <span class="comment">// This number is used to track all cron items. (All Cron items require a transaction</span>
            <span class="comment">// number from the user in order to add them to Cron in the first place.)</span>
            <span class="comment">//</span>
            <span class="comment">// The number is also used to uniquely identify all other transactions, as you</span>
            <span class="comment">// might guess from its name.</span>
            <span class="comment">//</span>
            <span class="comment">// UPDATE: Notice I&#39;m now looking up different numbers based on the UserIDs.</span>
            <span class="comment">// This is to support smart contracts, which have many parties, agents, and accounts.</span>
            <span class="comment">//</span>
<span class="comment">//          pItemSend-&gt;SetReferenceToNum(lTransSendRefNo);</span>
<span class="comment">//          pItemRecip-&gt;SetReferenceToNum(lTransRecipRefNo);</span>
            <span class="comment">// ----------------------------------------------</span>
            pTransSend -&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lTransSendRefNo);
            pTransRecip-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(lTransRecipRefNo);
            <span class="comment">// --------------------------------------------------------</span>
            <span class="comment">// The TRANSACTION (a receipt in my inbox) will be sent with &quot;In Reference To&quot; information</span>
            <span class="comment">// containing the ORIGINAL SIGNED CRON ITEM. (With both parties&#39; original signatures on it.)</span>
            <span class="comment">//</span>
            <span class="comment">// Whereas the TRANSACTION ITEM will include an &quot;attachment&quot; containing the UPDATED</span>
            <span class="comment">// CRON ITEM (this time with the SERVER&#39;s signature on it.)</span>
            <span class="comment">//</span>
            <span class="comment">// Here&#39;s the original one going onto the transaction:</span>
            <span class="comment">//</span>
            pTransSend -&gt;<a class="code" href="class_o_t_transaction_type.html#a9dd50265579347d2e8fa3ea36ca66320">SetReferenceString</a>(strOrigPlan);
            pTransRecip-&gt;<a class="code" href="class_o_t_transaction_type.html#a9dd50265579347d2e8fa3ea36ca66320">SetReferenceString</a>(strOrigPlan);
            <span class="comment">// --------------------------------------------------------------------------</span>
            <span class="comment">// MOVE THE DIGITAL ASSETS FROM ONE ACCOUNT TO ANOTHER...</span>

            <span class="comment">// Calculate the amount and debit/ credit the accounts</span>
            <span class="comment">// Make sure each Account can afford it, and roll back in case of failure.</span>

            <span class="keywordtype">bool</span> bMoveSender    = <span class="keyword">false</span>;
            <span class="keywordtype">bool</span> bMoveRecipient = <span class="keyword">false</span>;

            <span class="comment">// Make sure he can actually afford it...</span>
            <span class="keywordflow">if</span> (pSourceAcct-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() &gt;= lAmount)
            {
                <span class="comment">// Debit the source account.</span>
                bMoveSender = pSourceAcct-&gt;<a class="code" href="class_o_t_account.html#a893c8f197912e9270495f960804b7a5f">Debit</a>(lAmount); <span class="comment">// &lt;====== DEBIT FUNDS</span>

                <span class="comment">// IF success, credit the recipient.</span>
                <span class="keywordflow">if</span> (bMoveSender)
                {
                    bMoveRecipient  = pRecipientAcct-&gt;<a class="code" href="class_o_t_account.html#a9ae37832775933112ad874a9a9110c8b">Credit</a>(lAmount); <span class="comment">// &lt;=== CREDIT FUNDS</span>

                    <span class="comment">// Okay, we already took it from the source account.</span>
                    <span class="comment">// But if we FAIL to credit the recipient, then we need to PUT IT BACK in the source acct.</span>
                    <span class="comment">// (EVEN THOUGH we&#39;ll just &quot;NOT SAVE&quot; after any failure, so it&#39;s really superfluous.)</span>
                    <span class="comment">//</span>
                    <span class="keywordflow">if</span> (!bMoveRecipient)
                        pSourceAcct-&gt;<a class="code" href="class_o_t_account.html#a9ae37832775933112ad874a9a9110c8b">Credit</a>(lAmount); <span class="comment">// put the money back</span>
                    <span class="keywordflow">else</span>
                        bSuccess = <span class="keyword">true</span>;
                }

                <span class="comment">// If ANY of these failed, then roll them all back and break.</span>
                <span class="keywordflow">if</span> (!bMoveSender || !bMoveRecipient)
                {
                    <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTCronItem::MoveFunds: Very strange! Funds were available but &quot;</span>
                                 <span class="stringliteral">&quot;debit or credit failed while performing move.\n&quot;</span>);
                    <span class="comment">// We won&#39;t save the files anyway, if this failed.</span>
                    bSuccess = <span class="keyword">false</span>;
                }
            }
            <span class="comment">// --------------------------------------------------------------------------</span>


            <span class="comment">// DO NOT SAVE ACCOUNTS if bSuccess is false.</span>
            <span class="comment">// We only save these accounts if bSuccess == true.</span>
            <span class="comment">// (But we do save the inboxes either way, since payment failures always merit an inbox notice.)</span>

            <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccess) <span class="comment">// The payment succeeded.</span>
            {
                <span class="comment">// Both accounts involved need to get a receipt of this trade in their inboxes...</span>
                pItemSend-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>); <span class="comment">// pSourceAcct</span>
                pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>); <span class="comment">// pRecipientAcct</span>

                pItemSend-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount*(-1)); <span class="comment">// &quot;paymentReceipt&quot; is otherwise ambigious about whether you are paying or being paid.</span>
                pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(lAmount);     <span class="comment">// So, I decided for payment and market receipts, to use negative and positive amounts.</span>
                <span class="comment">// I will probably do the same for cheques, since they can be negative as well (invoices).</span>

                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(3, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Move performed.\n&quot;</span>);

                <span class="comment">// (I do NOT save m_pCron here, since that already occurs after this function is called.)</span>
            }
            <span class="keywordflow">else</span> <span class="comment">// bSuccess = false.  The payment failed.</span>
            {
                pItemSend-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a> (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>);<span class="comment">// pSourceAcct     // These are already initialized to false.</span>
                pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a789aa4148a0add3092e16c4221bf5844">SetStatus</a>(<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376adbeae2ab1504a5ef318da097d21119db">OTItem::rejection</a>);<span class="comment">// pRecipientAcct  // (But just making sure...)</span>

                pItemSend -&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(0);       <span class="comment">// No money changed hands. Just being explicit.</span>
                pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(0);       <span class="comment">// No money changed hands. Just being explicit.</span>

                <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(3, <span class="stringliteral">&quot;OTCronItem::MoveFunds: Move failed.\n&quot;</span>);
            }

            <span class="comment">// Everytime a payment processes, a receipt is put in the user&#39;s inbox, containing a</span>
            <span class="comment">// CURRENT copy of the cron item (which took just money from the user&#39;s acct, or not,</span>
            <span class="comment">// and either way thus updated its status -- so its internal data has changed.)</span>
            <span class="comment">//</span>
            <span class="comment">// It will also contain a copy of the user&#39;s ORIGINAL signed cron item, where the data</span>
            <span class="comment">// has NOT changed, (so the user&#39;s original signature is still good.)</span>
            <span class="comment">//</span>
            <span class="comment">// In order for it to export the RIGHT VERSION of the CURRENT plan, which has just changed</span>
            <span class="comment">// (above), then I need to re-sign it and save it first. (The original version I&#39;ll load from</span>
            <span class="comment">// a separate file using OTCronItem::LoadCronReceipt(lTransactionNum).</span>
            <span class="comment">//</span>
            <span class="comment">// I should be able to call a method on the original cronitem, where I ask it to verify a certain</span>
            <span class="comment">// nym as being acceptable to that cron item as an agent, based on the signature of the original</span>
            <span class="comment">// authorizing agent for that party.</span>
            <span class="comment">//</span>

            this-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            this-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
            this-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();


            <span class="comment">// This is now at the bottom of this function.</span>
            <span class="comment">//</span>
            <span class="comment">//m_pCron-&gt;SaveCron(); // Cron is where I am serialized, so if Cron&#39;s not saved, I&#39;m not saved.</span>

            <span class="comment">// -----------------------------------------------------------------</span>
            <span class="comment">//</span>
            <span class="comment">// EVERYTHING BELOW is just about notifying the users, by dropping the receipt in their</span>
            <span class="comment">// inboxes. The rest is done.  The accounts and inboxes will all be saved at the same time.</span>
            <span class="comment">//</span>
            <span class="comment">// The Payment Plan is entirely updated and saved by this point, and Cron will</span>
            <span class="comment">// also be saved in the calling function once we return (no matter what.)</span>
            <span class="comment">//</span>
            <span class="comment">// -----------------------------------------------------------------</span>


            <span class="comment">// Basically I load up both INBOXES, which are actually LEDGERS, and then I create</span>
            <span class="comment">// a new transaction, with a new transaction item, for each of the ledgers.</span>
            <span class="comment">// (That&#39;s where the receipt information goes.)</span>
            <span class="comment">//</span>



            <span class="comment">// -----------------------------------------------------------------</span>

            <span class="comment">// The TRANSACTION will be sent with &quot;In Reference To&quot; information containing the</span>
            <span class="comment">// ORIGINAL SIGNED PLAN. (With both of the users&#39; original signatures on it.)</span>
            <span class="comment">//</span>
            <span class="comment">// Whereas the TRANSACTION ITEM will include an &quot;attachment&quot; containing the UPDATED</span>
            <span class="comment">// PLAN (this time with the SERVER&#39;s signature on it.)</span>

            <span class="comment">// (Lucky I just signed and saved the updated plan (above), or it would still have</span>
            <span class="comment">// have the old data in it.)</span>

            <span class="comment">// I also already loaded the original plan. Remember this from above,</span>
            <span class="comment">// near the top of the function:</span>
            <span class="comment">//  OTCronItem * pOrigCronItem  = NULL;</span>
            <span class="comment">//  OTString strOrigPlan(*pOrigCronItem); // &lt;====== Farther down in the code, I attach this string to the receipts.</span>
            <span class="comment">//  ... then lower down...</span>
            <span class="comment">// pTransSend-&gt;SetReferenceString(strOrigPlan);</span>
            <span class="comment">// pTransRecip-&gt;SetReferenceString(strOrigPlan);</span>
            <span class="comment">//</span>
            <span class="comment">// So the original plan is already loaded and copied to the Transaction as the &quot;In Reference To&quot;</span>
            <span class="comment">// Field. Now let&#39;s add the UPDATED plan as an ATTACHMENT on the Transaction ITEM:</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_string.html">OTString</a>    strUpdatedCronItem(*<span class="keyword">this</span>);

            <span class="comment">// Set the updated cron item as the attachment on the transaction item.</span>
            <span class="comment">// (With the SERVER&#39;s signature on it!)</span>
            <span class="comment">// (As a receipt for each party, so they can see their smartcontract updating.)</span>
            <span class="comment">//</span>
            pItemSend-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strUpdatedCronItem);
            pItemRecip-&gt;<a class="code" href="class_o_t_item.html#a6e5e9b0c04cb1eca8acaec5b0be1d641">SetAttachment</a>(strUpdatedCronItem);

            <span class="comment">// -----------------------------------------------------------------</span>

            <span class="comment">// Success OR failure, either way I want a receipt in both inboxes.</span>
            <span class="comment">// But if FAILURE, I do NOT want to save the Accounts, JUST the inboxes.</span>
            <span class="comment">// So the inboxes happen either way, but the accounts are saved only on success.</span>

            <span class="comment">// sign the item</span>
            pItemSend-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
            pItemRecip-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);

            pItemSend-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            pItemRecip-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// the Transaction &quot;owns&quot; the item now and will handle cleaning it up.</span>
            pTransSend-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItemSend);
            pTransRecip-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pItemRecip);

            pTransSend-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
            pTransRecip-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);

            pTransSend-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            pTransRecip-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// -------------------------------------------</span>
            <span class="comment">// Here, the transactions we just created are actually added to the ledgers.</span>
            <span class="comment">// This happens either way, success or fail.</span>

            theSenderInbox.     AddTransaction(*pTransSend);
            theRecipientInbox.  AddTransaction(*pTransRecip);

            <span class="comment">// -------------------------------------------</span>

            <span class="comment">// Release any signatures that were there before (They won&#39;t</span>
            <span class="comment">// verify anymore anyway, since the content has changed.)</span>
            theSenderInbox.     <a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            theRecipientInbox.  <a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();

            <span class="comment">// Sign both of them.</span>
            theSenderInbox.     <a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
            theRecipientInbox.  <a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);

            <span class="comment">// Save both of them internally</span>
            theSenderInbox.     <a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
            theRecipientInbox.  <a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            <span class="comment">// Save both inboxes to storage. (File, DB, wherever it goes.)</span>
            pSourceAcct-&gt;       SaveInbox(theSenderInbox);
            pRecipientAcct-&gt;    SaveInbox(theRecipientInbox);

            <span class="comment">// These correspond to the AddTransaction() calls, just above</span>
            <span class="comment">//</span>
            pTransSend-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(theSenderInbox);
            pTransRecip-&gt;<a class="code" href="class_o_t_transaction.html#a2f991feb7c6178ffabefc7fef312d26e">SaveBoxReceipt</a>(theRecipientInbox);

            <span class="comment">// If success, save the accounts with new balance. (Save inboxes with receipts either way,</span>
            <span class="comment">// and the receipts will contain a rejection or acknowledgment stamped by the Server Nym.)</span>
            <span class="keywordflow">if</span> (<span class="keyword">true</span> == bSuccess)
            {
                <span class="comment">// -------------------------------------------</span>
                <span class="comment">// Release any signatures that were there before (They won&#39;t</span>
                <span class="comment">// verify anymore anyway, since the content has changed.)</span>
                pSourceAcct-&gt;   <a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
                pRecipientAcct-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();

                <span class="comment">// Sign both of them.</span>
                pSourceAcct-&gt;   <a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);
                pRecipientAcct-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pServerNym);

                <span class="comment">// Save both of them internally</span>
                pSourceAcct-&gt;   <a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
                pRecipientAcct-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                <span class="comment">// TODO: Better rollback capabilities in case of failures here:</span>

                <span class="comment">// Save both accounts to storage.</span>
                pSourceAcct-&gt;   SaveAccount();
                pRecipientAcct-&gt;<a class="code" href="class_o_t_account.html#adaba3f4ce60f7ac88f883c0543d9ddb0">SaveAccount</a>();

                <span class="comment">// NO NEED TO LOG HERE, since success / failure is already logged above.</span>
            }
        } <span class="comment">// both inboxes were successfully loaded or generated.</span>
    } <span class="comment">// By the time we enter this block, accounts and nyms are already loaded. As we begin, inboxes are instantiated.</span>

    <span class="comment">// Todo: possibly notify ALL parties here (in Nymbox.)</span>

    <span class="comment">// Either way, Cron should save, since it just updated.</span>
    <span class="comment">// The above function WILL change this smart contract.</span>
    <span class="comment">// and re-sign it and save it, no matter what. So I just</span>
    <span class="comment">// call this here to keep it simple:</span>

    <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;<a class="code" href="class_o_t_cron.html#a24df32b4bf36e48867e7afda0955bb72">SaveCron</a>();


    <span class="keywordflow">return</span> bSuccess;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad448bfdee05f5a1086d19d9edb2e2518"></a><!-- doxytag: member="OTCronItem::NewCronItem" ref="ad448bfdee05f5a1086d19d9edb2e2518" args="(const OTString &amp;strCronItem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a> * <a class="el" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strCronItem</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00164">164</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="unionu__header.html#ac53aebe696286ddee96a16c2b8a50e26">buf</a>[45] = <span class="stringliteral">&quot;&quot;</span>;
    <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> *    pItem = NULL;

    <span class="keywordflow">if</span> (!strCronItem.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Empty string was passed in (returning NULL.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strContract(strCronItem);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == strContract.DecodeIfArmored(<span class="keyword">false</span>)) <span class="comment">// bEscapedIsAllowed=true by default.</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Input string apparently was encoded and then failed decoding. Contents: \n%s\n&quot;</span>,
                      __FUNCTION__, strCronItem.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// ------------------------------------------</span>
    strContract.reset(); <span class="comment">// for sgets</span>
    buf[0] = 0; <span class="comment">// probably unnecessary.</span>
    <span class="keywordtype">bool</span> bGotLine = strContract.sgets(buf, 40);

    <span class="keywordflow">if</span> (!bGotLine)
        <span class="keywordflow">return</span> NULL;

    <a class="code" href="class_o_t_string.html">OTString</a> strFirstLine(buf);
    strContract.reset(); <span class="comment">// set the &quot;file&quot; pointer within this string back to index 0.</span>

    <span class="comment">// Now I feel pretty safe -- the string I&#39;m examining is within</span>
    <span class="comment">// the first 45 characters of the beginning of the contract, and</span>
    <span class="comment">// it will NOT contain the escape &quot;- &quot; sequence. From there, if</span>
    <span class="comment">// it contains the proper sequence, I will instantiate that type.</span>
    <span class="keywordflow">if</span> (!strFirstLine.Exists() || strFirstLine.Contains(<span class="stringliteral">&quot;- -&quot;</span>))
        <span class="keywordflow">return</span> NULL;
    <span class="comment">// -------------------------------------------------------</span>

    <span class="comment">// By this point we know already that it&#39;s not escaped.</span>
    <span class="comment">// BUT it might still be ARMORED!</span>

    <span class="comment">// -------------------------------------------------------</span>
<span class="comment">//  if (strFirstLine.Contains(&quot;-----BEGIN SIGNED AGREEMENT-----&quot;))  // this string is 32 chars long.</span>
<span class="comment">//  {   pItem = new OTAgreement();      OT_ASSERT(NULL != pItem); }</span>

    <span class="keywordflow">if</span> (strFirstLine.Contains(<span class="stringliteral">&quot;-----BEGIN SIGNED PAYMENT PLAN-----&quot;</span>))  <span class="comment">// this string is 35 chars long.</span>
    {   pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a>();    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem); }

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strFirstLine.Contains(<span class="stringliteral">&quot;-----BEGIN SIGNED TRADE-----&quot;</span>))  <span class="comment">// this string is 28 chars long.</span>
    {   pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_trade.html">OTTrade</a>();          <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem); }

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strFirstLine.Contains(<span class="stringliteral">&quot;-----BEGIN SIGNED SMARTCONTRACT-----&quot;</span>))  <span class="comment">// this string is 36 chars long.</span>
    {   pItem = <span class="keyword">new</span> <a class="code" href="class_o_t_smart_contract.html">OTSmartContract</a>();  <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pItem); }


    <span class="comment">// The string didn&#39;t match any of the options in the factory.</span>
    <span class="keywordflow">if</span> (NULL == pItem)
        <span class="keywordflow">return</span> NULL;

    <span class="comment">// Does the contract successfully load from the string passed in?</span>
    <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strContract))
        <span class="keywordflow">return</span> pItem;
    <span class="keywordflow">else</span>
        <span class="keyword">delete</span> pItem;


    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6d5314654e6544ce8d724a89691965fa"></a><!-- doxytag: member="OTCronItem::onActivate" ref="a6d5314654e6544ce8d724a89691965fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_o_t_cron_item.html#a6d5314654e6544ce8d724a89691965fa">OTCronItem::onActivate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a986e939aa9f6e838afc66426cbc0eb12">OTSmartContract</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00178">178</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{}  <span class="comment">// called by HookActivationOnCron().</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ac24d58b1aec6a6471a79f30146e7a300"></a><!-- doxytag: member="OTCronItem::onFinalReceipt" ref="ac24d58b1aec6a6471a79f30146e7a300" args="(OTCronItem &amp;theOrigCronItem, const int64_t &amp;lNewTransactionNumber, OTPseudonym &amp;theOriginator, OTPseudonym *pRemover)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#ac24d58b1aec6a6471a79f30146e7a300">OTCronItem::onFinalReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theOrigCronItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNewTransactionNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theOriginator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pRemover</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#ac956b09210f8037018cd06f11f965df4">OTSmartContract</a>, <a class="el" href="class_o_t_trade.html#a1bdd13967c44b74a74d9189abf980664">OTTrade</a>, and <a class="el" href="class_o_t_agreement.html#a2e1d1848b71b3cad25b595190e30be71">OTAgreement</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01682">1682</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);
    <span class="comment">// -------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// The finalReceipt Item&#39;s ATTACHMENT contains the UPDATED Cron Item.</span>
    <span class="comment">// (With the SERVER&#39;s signature on it!)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem(*<span class="keyword">this</span>);
    <a class="code" href="class_o_t_string.html">OTString</a> * pstrAttachment=&amp;strUpdatedCronItem;
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOrigCronItem(theOrigCronItem);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// First, we are closing the transaction number ITSELF, of this cron item,</span>
    <span class="comment">// as an active issued number on the originating nym. (Changing it to CLOSED.)</span>
    <span class="comment">//</span>
    <span class="comment">// Second, we&#39;re verifying the CLOSING number, and using it as the closing number</span>
    <span class="comment">// on the FINAL RECEIPT (with that receipt being &quot;InReferenceTo&quot; this-&gt;GetTransactionNum())</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int64_t lOpeningNumber = theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>();
    <span class="keyword">const</span> int64_t lClosingNumber = theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#afdbeda9f62eb4d4288d6d06ac78fcdef">GetClosingNum</a>();
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pActualNym    = NULL; <span class="comment">// use this. DON&#39;T use theActualNym.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>     theActualNym;         <span class="comment">// unused unless it&#39;s really not already loaded. (use pActualNym.)</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// I&#39;m ASSUMING here that pRemover is also theOriginator.</span>
    <span class="comment">//</span>
    <span class="comment">// REMEMBER: Most subclasses will override this method, and THEY</span>
    <span class="comment">// are the cases where pRemover is someone other than theOriginator.</span>
    <span class="comment">// That&#39;s why they have a different version of onFinalReceipt.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((lOpeningNumber &gt; 0) &amp;&amp;
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lOpeningNumber))
    {
        <span class="comment">// The Nym (server side) stores a list of all opening and closing cron #s.</span>
        <span class="comment">// So when the number is released from the Nym, we also take it off that list.</span>
        <span class="comment">//</span>
        std::set&lt;int64_t&gt; &amp; theIDSet = theOriginator.<a class="code" href="class_o_t_pseudonym.html#a92abc7a6b6253681f3379f135597f5a9">GetSetOpenCronItems</a>();
        theIDSet.erase(lOpeningNumber);

        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(*pServerNym, strServerID, lOpeningNumber, <span class="keyword">false</span>); <span class="comment">//bSave=false</span>
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pServerNym);

        <span class="comment">// the RemoveIssued call means the original transaction# (to find this cron item on cron) is now CLOSED.</span>
        <span class="comment">// But the Transaction itself is still OPEN. How? Because the CLOSING number is still signed out.</span>
        <span class="comment">// The closing number is also USED, since the NotarizePaymentPlan or NotarizeMarketOffer call, but it</span>
        <span class="comment">// remains ISSUED, until the final receipt itself is accepted during a process inbox.</span>
        <span class="comment">//</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> ACTUAL_NYM_ID = <a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>();

        <span class="keywordflow">if</span> ( (NULL != pServerNym) &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID) )
            pActualNym = pServerNym;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theOriginator.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID))
            pActualNym = &amp;theOriginator;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (NULL != pRemover) &amp;&amp; pRemover-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID) )
            pActualNym = pRemover;
        <span class="comment">// --------------------------</span>
        <span class="keywordflow">else</span>    <span class="comment">// We couldn&#39;t find the Nym among those already loaded--so we have to load</span>
        {       <span class="comment">// it ourselves (so we can update its NymboxHash value.)</span>
            theActualNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(ACTUAL_NYM_ID);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == theActualNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>()) <span class="comment">// Note: this step may be unnecessary since we are only updating his Nymfile, not his key.</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading public key for Nym: %s. (To update his NymboxHash.) \n&quot;</span>,
                              __FUNCTION__, strNymID.Get());
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theActualNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>() &amp;&amp; <span class="comment">// this line may be unnecessary.</span>
                     theActualNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym)) <span class="comment">// ServerNym here is not theActualNym&#39;s identity, but merely the signer on this file.</span>
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: Loading actual Nym, since he wasn&#39;t already loaded. &quot;</span>
                               <span class="stringliteral">&quot;(To update his NymboxHash.)\n&quot;</span>, __FUNCTION__);
                pActualNym = &amp;theActualNym; <span class="comment">//  &lt;=====</span>
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading or verifying Actual Nym public key: %s. (To update his NymboxHash.)\n&quot;</span>,
                              __FUNCTION__, strNymID.Get());
            }
        }
        <span class="comment">// -------------</span>

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == this-&gt;<a class="code" href="class_o_t_cron_item.html#a4ed44ef1289676261061180691359bad">DropFinalReceiptToNymbox</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>(),
                                                    lNewTransactionNumber,
                                                    strOrigCronItem,
                                                    NULL, <span class="comment">// note</span>
                                                    pstrAttachment,
                                                    pActualNym))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure dropping finalReceipt to Nymbox.\n&quot;</span>, __FUNCTION__);
        }
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed doing VerifyIssuedNum(theOrigCronItem.GetTransactionNum())\n&quot;</span>, __FUNCTION__);
    }
    <span class="comment">// ------------------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((lClosingNumber &gt; 0) &amp;&amp;
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lClosingNumber)
        )
    {
        <span class="comment">// SENDER only. (CronItem has no recipient. That&#39;s in the subclass.)</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == this-&gt;<a class="code" href="class_o_t_cron_item.html#a32b2f6d524b7a0b9cacff58845b2161c">DropFinalReceiptToInbox</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>(), <a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>(),
                                                   lNewTransactionNumber,
                                                   lClosingNumber, <span class="comment">// The closing transaction number to put on the receipt.</span>
                                                   strOrigCronItem,
                                                   NULL, <span class="comment">// note</span>
                                                   pstrAttachment)) <span class="comment">// pActualAcct = NULL by default. (This call will load it up in order to update the inbox hash.)</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure dropping receipt into inbox.\n&quot;</span>, __FUNCTION__);

        <span class="comment">// In this case, I&#39;m passing NULL for pstrNote, since there is no note.</span>
        <span class="comment">// (Additional information would normally be stored in the note.)</span>

        <span class="comment">// This part below doesn&#39;t happen until you ACCEPT the final receipt (when processing your inbox.)</span>
        <span class="comment">//</span>
<span class="comment">//      theOriginator.RemoveIssuedNum(strServerID, lClosingNumber, true); //bSave=false</span>
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed verifying lClosingNumber=theOrigCronItem.GetClosingTransactionNoAt(0)&gt;0 &amp;&amp;  &quot;</span>
                     <span class="stringliteral">&quot;theOriginator.VerifyTransactionNum(lClosingNumber)\n&quot;</span>, __FUNCTION__);
    }
    <span class="comment">// -------------------------------</span>

    <span class="comment">// QUESTION: Won&#39;t there be Cron Items that have no asset account at all?</span>
    <span class="comment">// In which case, there&#39;d be no need to drop a final receipt, but I don&#39;t think</span>
    <span class="comment">// that&#39;s the case, since you have to use a transaction number to get onto cron</span>
    <span class="comment">// in the first place.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad7aa9b289746ab01661997a19b1335b1"></a><!-- doxytag: member="OTCronItem::onRemovalFromCron" ref="ad7aa9b289746ab01661997a19b1335b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_o_t_cron_item.html#ad7aa9b289746ab01661997a19b1335b1">OTCronItem::onRemovalFromCron</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#ad0ed5c23badda402c9493b86bef7542e">OTSmartContract</a>, <a class="el" href="class_o_t_trade.html#acdcc621f3bf7f2cf19cbc4bc50a70856">OTTrade</a>, and <a class="el" href="class_o_t_agreement.html#a85e6deabc025decf63a7ab0ee372c747">OTAgreement</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00185">185</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{}  <span class="comment">// called by HookRemovalFromCron().</span>
</pre></div>
</div>
</div>
<a class="anchor" id="afe5c6a9af86b637fd8b2b3459825565b"></a><!-- doxytag: member="OTCronItem::ProcessCron" ref="afe5c6a9af86b637fd8b2b3459825565b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#afe5c6a9af86b637fd8b2b3459825565b">OTCronItem::ProcessCron</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented in <a class="el" href="class_o_t_agreement.html#ac4bda43247e9bac150c197fd5f0db7b2">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#aaec9c2740849989bfbf4f312a0ab201d">OTPaymentPlan</a>, <a class="el" href="class_o_t_smart_contract.html#a717de2aa486b22c8ccde06c25bbb64f5">OTSmartContract</a>, and <a class="el" href="class_o_t_trade.html#a7a7ae6755bab2bbc60c5badb9043285d">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01476">1476</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != m_pCron);

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#a5fd32eb6600ee9740e5e99acebcaa2d8">IsFlaggedForRemoval</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;Cron: Flagged for removal: %s.\n&quot;</span>, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// I call IsExpired() here instead of VerifyCurrentDate(). The Cron Item will stay on</span>
    <span class="comment">// Cron even if it is NOT YET valid. But once it actually expires, this will remove it.</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_instrument.html#ae934e452385265913c5711c785aad4d7">IsExpired</a>())
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;Cron: Expired %s.\n&quot;</span>, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// As far as this code is concerned, the item can stay on cron for now. Return true.</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b7eec23353a8ed49ee40a742c391aa3"></a><!-- doxytag: member="OTCronItem::ProcessXMLNode" ref="a6b7eec23353a8ed49ee40a742c391aa3" args="(irr::io::IrrXMLReader *&amp;xml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_cron_item.html#a6b7eec23353a8ed49ee40a742c391aa3">OTCronItem::ProcessXMLNode</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_trackable.html#ad980c2ad5e97ff6f536dc296a3572e8f">OTTrackable</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a8524c56a7469d39a895bed4b18671972">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#aba122af21b536d24bfb178074f843ff5">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#af1c7a24817b3367f2c76c9867effd557">OTPaymentPlan</a>, and <a class="el" href="class_o_t_trade.html#ab62bbaf94b2df5b01c52d988e023ae8b">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02449">2449</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nReturnVal = 0;

    <span class="comment">// Here we call the parent class first.</span>
    <span class="comment">// If the node is found there, or there is some error,</span>
    <span class="comment">// then we just return either way.  But if it comes back</span>
    <span class="comment">// as &#39;0&#39;, then nothing happened, and we&#39;ll continue executing.</span>
    <span class="comment">//</span>
    <span class="comment">// -- Note you can choose not to call the parent if</span>
    <span class="comment">// you don&#39;t want to use any of those xml tags.</span>
    <span class="comment">//</span>

    nReturnVal = <a class="code" href="class_o_t_trackable.html#ad980c2ad5e97ff6f536dc296a3572e8f">ot_super::ProcessXMLNode</a>(xml);

    <span class="keywordflow">if</span> (nReturnVal != 0) <span class="comment">// -1 is error, and 1 is &quot;found it&quot;. Either way, return.</span>
        <span class="keywordflow">return</span> nReturnVal;  <span class="comment">// 0 means &quot;nothing happened, keep going.&quot;</span>

    <span class="comment">// ---------</span>

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNodeName(xml-&gt;getNodeName());

    <span class="keywordflow">if</span> (strNodeName.Compare(<span class="stringliteral">&quot;closingTransactionNumber&quot;</span>))
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strClosingNumber = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;value&quot;</span>);

        <span class="keywordflow">if</span> (strClosingNumber.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <span class="keyword">const</span> int64_t lClosingNumber = atol(strClosingNumber.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());

            this-&gt;<a class="code" href="class_o_t_cron_item.html#a310153e4e82ec7fbc887e93c4d12220d">AddClosingTransactionNo</a>(lClosingNumber);
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTCronItem::ProcessXMLNode: closingTransactionNumber field without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }

        nReturnVal = 1;
    }

    <span class="keywordflow">return</span> nReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a11e9851acefc9162bb5f107a1952ffb7"></a><!-- doxytag: member="OTCronItem::Release" ref="a11e9851acefc9162bb5f107a1952ffb7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a11e9851acefc9162bb5f107a1952ffb7">OTCronItem::Release</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_trackable.html#a71dcca204d36941c6e2f3f73af4a6c2b">OTTrackable</a>.</p>

<p>Reimplemented in <a class="el" href="class_o_t_smart_contract.html#a335f903820d3128716c7f7b93200b5ac">OTSmartContract</a>, <a class="el" href="class_o_t_agreement.html#aad6f21095f2ea95a1ced567ffc17d2eb">OTAgreement</a>, <a class="el" href="class_o_t_payment_plan.html#a231d9ec26ad3f267bf68cbc5f51c62ac">OTPaymentPlan</a>, and <a class="el" href="class_o_t_trade.html#a677d2b33af8117fb681b52e20a4baaff">OTTrade</a>.</p>

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02439">2439</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron_item.html#ae714737f65e64b61746d79291ec656f0">Release_CronItem</a>();


    <a class="code" href="class_o_t_trackable.html#a71dcca204d36941c6e2f3f73af4a6c2b">ot_super::Release</a>(); <span class="comment">// since I&#39;ve overridden the base class, I call it now...</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae714737f65e64b61746d79291ec656f0"></a><!-- doxytag: member="OTCronItem::Release_CronItem" ref="ae714737f65e64b61746d79291ec656f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#ae714737f65e64b61746d79291ec656f0">OTCronItem::Release_CronItem</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l02425">2425</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    m_CREATION_DATE     = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
    m_LAST_PROCESS_DATE = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
    m_PROCESS_INTERVAL  = 1;

    <a class="code" href="class_o_t_cron_item.html#a3941f19ac62239dbeee9a300d9f8c2b1">ClearClosingNumbers</a>();

    <a class="code" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">m_bRemovalFlag</a> = <span class="keyword">false</span>;
    <a class="code" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">m_bCanceled</a>    = <span class="keyword">false</span>;
    <a class="code" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">m_pCancelerNymID</a>-&gt;<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a215530a92d43d8260dfe8f42327cb3de"></a><!-- doxytag: member="OTCronItem::SaveActiveCronReceipt" ref="a215530a92d43d8260dfe8f42327cb3de" args="(const OTIdentifier &amp;theNymID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a215530a92d43d8260dfe8f42327cb3de">OTCronItem::SaveActiveCronReceipt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theNymID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00450">450</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> int64_t lOpeningNum = <a class="code" href="class_o_t_cron_item.html#a8f59139b6000733ec3c1df6d1dbc7632">GetOpeningNumber</a>(theNymID);
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename, strServerID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.crn&quot;</span>, lOpeningNum);

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername   = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();  <span class="comment">// cron</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();        <span class="comment">// cron/TRANSACTION_NUM.crn</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), szFilename))
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;OTCronItem::%s: Cron Record already exists for transaction %lld %s%s%s%s%s, &quot;</span>
                      <span class="stringliteral">&quot;overwriting.\n&quot;</span>,
                      __FUNCTION__, <a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>(), szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="comment">// NOTE: We could just return here. But what if the record we have is corrupted somehow?</span>
        <span class="comment">// Might as well just write it there again, so I let this continue running.</span>
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="comment">// It wasn&#39;t there already, so we need to save the number in our local list of trans nums.</span>
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strListFilename(theNymID);
        strListFilename.Concatenate(<span class="stringliteral">&quot;.lst&quot;</span>);  <span class="comment">// nymID.lst</span>
        <a class="code" href="class_o_t_num_list.html">OTNumList</a> numlist;

        <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, strServerID.Get(), strListFilename.Get()))
        {
            <span class="comment">// Load up existing list, to add the new transaction num to it.</span>
            <span class="comment">//</span>
            <a class="code" href="class_o_t_string.html">OTString</a> strNumlist(<a class="code" href="namespace_o_t_d_b.html#a921d6f538de00f4e4297c25cf679f00a">OTDB::QueryPlainString</a>(szFoldername, strServerID.Get(), strListFilename.Get()));

            <span class="keywordflow">if</span> (strNumlist.Exists())
            {
                <span class="keywordflow">if</span> (<span class="keyword">false</span> == strNumlist.DecodeIfArmored(<span class="keyword">false</span>)) <span class="comment">// bEscapedIsAllowed=true by default.</span>
                {
                    <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Input string apparently was encoded and then failed decoding. Contents: \n%s\n&quot;</span>,
                                  __FUNCTION__, strNumlist.Get());
                }
                <span class="comment">// ------------------------------------------</span>
                <span class="keywordflow">else</span>
                    numlist.Add(strNumlist);
            }
        }
        <span class="comment">// ------------------------------------</span>
        numlist.Add(lOpeningNum);
        <span class="comment">// ------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strNumlist;

        <span class="keywordflow">if</span> (numlist.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strNumlist))
        {
            <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
            <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(strNumlist);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <span class="stringliteral">&quot;ACTIVE CRON ITEMS&quot;</span>)) <span class="comment">// todo hardcoding</span>
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving recurring IDs (failed writing armored string): %s%s%s%s%s\n&quot;</span>,
                              __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                              strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strListFilename.Get());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
            <span class="comment">// --------------------------------------------------------------------</span>
            <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),    szFoldername,
                                                 strServerID.Get(), strListFilename.Get());

            <span class="keywordflow">if</span> (!bSaved)
            {
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving recurring IDs: %s%s%s%s%s\n&quot;</span>,
                              __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                              strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), strListFilename.Get());
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving file (failed writing armored string): %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), szFoldername, strServerID.Get(), szFilename);

    <span class="keywordflow">if</span> (!bSaved)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving file: %s%s%s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(),
                      strServerID.Get(), <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aebfbcf50eeb2effe9c3189518910b48d"></a><!-- doxytag: member="OTCronItem::SaveCronReceipt" ref="aebfbcf50eeb2effe9c3189518910b48d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#aebfbcf50eeb2effe9c3189518910b48d">OTCronItem::SaveCronReceipt</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l00557">557</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a> strFilename;
    strFilename.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%lld.crn&quot;</span>, <a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());

    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFoldername   = <a class="code" href="class_o_t_folders.html#aabb5605423422af18b156b9cd5e48c22">OTFolders::Cron</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();  <span class="comment">// cron</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFilename     = strFilename.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();        <span class="comment">// cron/TRANSACTION_NUM.crn</span>
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (<a class="code" href="namespace_o_t_d_b.html#a73e39a590dfb64f63065821c6bbcd4c6">OTDB::Exists</a>(szFoldername, szFilename))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Cron Record already exists for transaction %lld %s%s%s,\n&quot;</span>
                      <span class="stringliteral">&quot;yet inexplicably attempted to record it again.\n&quot;</span>,
                      __FUNCTION__, <a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>(), szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strFinal;
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascTemp(<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>);

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == ascTemp.WriteArmoredString(strFinal, <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving file (failed writing armored string): %s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordtype">bool</span> bSaved = <a class="code" href="namespace_o_t_d_b.html#a7ec0a905bba2c1c8ba5b1e873e12eab4">OTDB::StorePlainString</a>(strFinal.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), szFoldername, szFilename);

    <span class="keywordflow">if</span> (!bSaved)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Error saving file: %s%s%s\n&quot;</span>,
                      __FUNCTION__, szFoldername, <a class="code" href="class_o_t_log.html#a42d3c91ff84ecae0690e34efb4619a77">OTLog::PathSeparator</a>(), szFilename);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// --------------------------------------------------------------------</span>
    <span class="keywordflow">return</span> bSaved;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7668dc44368861c09a47de0f420cf2fa"></a><!-- doxytag: member="OTCronItem::SetCreationDate" ref="a7668dc44368861c09a47de0f420cf2fa" args="(const time64_t &amp;CREATION_DATE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a7668dc44368861c09a47de0f420cf2fa">OTCronItem::SetCreationDate</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>CREATION_DATE</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00239">239</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_CREATION_DATE = CREATION_DATE; }
</pre></div>
</div>
</div>
<a class="anchor" id="a3ec8412d780384e48c756eff6726002c"></a><!-- doxytag: member="OTCronItem::SetCronPointer" ref="a3ec8412d780384e48c756eff6726002c" args="(OTCron &amp;theCron)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a3ec8412d780384e48c756eff6726002c">OTCronItem::SetCronPointer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_cron.html">OTCron</a> &amp;&#160;</td>
          <td class="paramname"><em>theCron</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00226">226</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_pCron = &amp;theCron; }
</pre></div>
</div>
</div>
<a class="anchor" id="ab6f1e6febdeb0f6042d751503e648107"></a><!-- doxytag: member="OTCronItem::SetDateRange" ref="ab6f1e6febdeb0f6042d751503e648107" args="(const time64_t VALID_FROM=OT_TIME_ZERO, const time64_t VALID_TO=OT_TIME_ZERO)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#ab6f1e6febdeb0f6042d751503e648107">OTCronItem::SetDateRange</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>VALID_FROM</em> = <code><a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>&#160;</td>
          <td class="paramname"><em>VALID_TO</em> = <code><a class="el" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8cpp_source.html#l01342">1342</a> of file <a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Set the CREATION DATE</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> CURRENT_TIME = <a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>();

    <span class="comment">// Set the Creation Date.</span>
    <a class="code" href="class_o_t_cron_item.html#a7668dc44368861c09a47de0f420cf2fa">SetCreationDate</a>(CURRENT_TIME);

    <span class="comment">// -----------------------------------------</span>
    <span class="comment">// VALID_FROM</span>
    <span class="comment">//</span>
    <span class="comment">// The default &quot;valid from&quot; time is NOW.</span>
    <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt;= VALID_FROM) <span class="comment">// if it&#39;s 0 or less, set to current time.</span>
        <a class="code" href="class_o_t_instrument.html#af8e356f6956ad222a1766435edca8374">SetValidFrom</a>(CURRENT_TIME);
    <span class="keywordflow">else</span> <span class="comment">// Otherwise use whatever was passed in.</span>
        <a class="code" href="class_o_t_instrument.html#af8e356f6956ad222a1766435edca8374">SetValidFrom</a>(VALID_FROM);
    <span class="comment">// -------------------------------------------</span>
    <span class="comment">// VALID_TO</span>
    <span class="comment">//</span>
    <span class="comment">// The default &quot;valid to&quot; time is 0 (which means no expiration date / cancel anytime.)</span>
    <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> == VALID_TO) <span class="comment">// VALID_TO is 0</span>
    {
        <a class="code" href="class_o_t_instrument.html#a5baef9beffaf6627cd9d5277fdbb14c3">SetValidTo</a>(VALID_TO); <span class="comment">// Keep it at zero then, so it won&#39;t expire.</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &lt; VALID_TO) <span class="comment">// VALID_TO is ABOVE zero...</span>
    {
        <span class="keywordflow">if</span> (VALID_TO &lt; VALID_FROM) <span class="comment">// If Valid-To date is EARLIER than Valid-From date...</span>
        {
            int64_t lValidTo = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(VALID_TO);
            int64_t lValidFrom = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(VALID_FROM);
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: VALID_TO (%&quot;</span> PRId64<span class="stringliteral">&quot;) is earlier than VALID_FROM (%&quot;</span> PRId64<span class="stringliteral">&quot;)\n&quot;</span>,
                          __FUNCTION__, lValidTo, lValidFrom);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="class_o_t_instrument.html#a5baef9beffaf6627cd9d5277fdbb14c3">SetValidTo</a>(VALID_TO); <span class="comment">// Set it to whatever it is, since it is now validated as higher than Valid-From.</span>
    }
    <span class="keywordflow">else</span> <span class="comment">// VALID_TO is a NEGATIVE number... Error.</span>
    {
        int64_t lValidTo = <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(VALID_TO);
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTCronItem::%s: Negative value for valid_to: %&quot;</span> PRId64<span class="stringliteral">&quot;\n&quot;</span>,
                      __FUNCTION__, lValidTo);

        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ***************************************************</span>

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aac4ad32d864f5b6e8ce07a28432bf1ef"></a><!-- doxytag: member="OTCronItem::SetLastProcessDate" ref="aac4ad32d864f5b6e8ce07a28432bf1ef" args="(const time64_t &amp;THE_DATE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#aac4ad32d864f5b6e8ce07a28432bf1ef">OTCronItem::SetLastProcessDate</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp;&#160;</td>
          <td class="paramname"><em>THE_DATE</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00244">244</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_LAST_PROCESS_DATE = THE_DATE; }
</pre></div>
</div>
</div>
<a class="anchor" id="a7d801b85690f539433e0ccf187f57d99"></a><!-- doxytag: member="OTCronItem::SetProcessInterval" ref="a7d801b85690f539433e0ccf187f57d99" args="(const int64_t &amp;THE_DATE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_cron_item.html#a7d801b85690f539433e0ccf187f57d99">OTCronItem::SetProcessInterval</a> </td>
          <td>(</td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>THE_DATE</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00247">247</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_PROCESS_INTERVAL = THE_DATE; }
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="abe9ce5c7b4d2fe652908e1f81f2f3b67"></a><!-- doxytag: member="OTCronItem::m_bCanceled" ref="abe9ce5c7b4d2fe652908e1f81f2f3b67" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#abe9ce5c7b4d2fe652908e1f81f2f3b67">OTCronItem::m_bCanceled</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00173">173</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6d3e5ace709ed23d95719ee477bc567e"></a><!-- doxytag: member="OTCronItem::m_bRemovalFlag" ref="a6d3e5ace709ed23d95719ee477bc567e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_cron_item.html#a6d3e5ace709ed23d95719ee477bc567e">OTCronItem::m_bRemovalFlag</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00175">175</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a16711e4ee405a3a27375c633a33edc60"></a><!-- doxytag: member="OTCronItem::m_dequeClosingNumbers" ref="a16711e4ee405a3a27375c633a33edc60" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;int64_t&gt; <a class="el" href="class_o_t_cron_item.html#a16711e4ee405a3a27375c633a33edc60">OTCronItem::m_dequeClosingNumbers</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00163">163</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af7bb48c16e16f664b938a7f235d2872d"></a><!-- doxytag: member="OTCronItem::m_pCancelerNymID" ref="af7bb48c16e16f664b938a7f235d2872d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a>* <a class="el" href="class_o_t_cron_item.html#af7bb48c16e16f664b938a7f235d2872d">OTCronItem::m_pCancelerNymID</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_cron_item_8hpp_source.html#l00171">171</a> of file <a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_cron_item_8hpp_source.html">OTCronItem.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_cron_item_8cpp_source.html">OTCronItem.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:12 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
