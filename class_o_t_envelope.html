<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTEnvelope Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_envelope.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">OTEnvelope Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTEnvelope" -->
<p><code>#include &lt;<a class="el" href="_o_t_envelope_8hpp_source.html">OTEnvelope.hpp</a>&gt;</code></p>

<p><a href="class_o_t_envelope-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#a23df10efae7128c76246abf6326a7209">OTEnvelope</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#a836f12b432ff258ce277fdfcb8ae3979">OTEnvelope</a> (const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;theArmoredText)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#a276f42ccb6b78e7b531f8bf25baf96cc">OTEnvelope</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strArmorWithBookends)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ac52463ee540c3c5e7f4a3aaec7c34f6a">~OTEnvelope</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#aabf0fe42b8839ed8e531d576d45d5d82">Encrypt</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theInput, <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;theKey, const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassword)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ab478da9d1884c67f6ec6bebf38b49a3d">Decrypt</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;theOutput, const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;theKey, const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;thePassword)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a> (const <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theRecipient, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#aa13c275de4b895d1e60882c872768090">Seal</a> (const <a class="el" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> &amp;RecipPubKey, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ad3725c01277b880a22b5639973da1fbf">Seal</a> (<a class="el" href="_o_t_crypto_8hpp.html#a36d2c43b456afda4ba860750a1e67584">setOfNyms</a> &amp;theRecipients, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#af55e3ec3a559c3259037f05877038baf">Seal</a> (<a class="el" href="_o_t_crypto_8hpp.html#a26e3eb3c76441ff452fdae8253c0c375">mapOfAsymmetricKeys</a> &amp;RecipPubKeys, const <a class="el" href="class_o_t_string.html">OTString</a> &amp;theInput)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a> (const <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theRecipient, <a class="el" href="class_o_t_string.html">OTString</a> &amp;theOutput, <a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *pPWData=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">GetAsciiArmoredData</a> (<a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;theArmoredText, bool bLineBreaks=true) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ac8ce11b76410974ec11fcd7afff21027">GetAsBookendedString</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strArmorWithBookends, bool bEscaped=false) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a> (const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;theArmoredText, bool bLineBreaks=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#a8d02b4432da2403c3bf01aeffb8f982c">SetFromBookendedString</a> (const <a class="el" href="class_o_t_string.html">OTString</a> &amp;strArmorWithBookends, bool bEscaped=false)</td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_envelope.html#ae30ec9237eff8224f54468df8341bcc4">OTPayload</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_envelope_8hpp_source.html#l00150">150</a> of file <a class="el" href="_o_t_envelope_8hpp_source.html">OTEnvelope.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a23df10efae7128c76246abf6326a7209"></a><!-- doxytag: member="OTEnvelope::OTEnvelope" ref="a23df10efae7128c76246abf6326a7209" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_envelope.html#a23df10efae7128c76246abf6326a7209">OTEnvelope::OTEnvelope</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00604">604</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    
}
</pre></div>
</div>
</div>
<a class="anchor" id="a836f12b432ff258ce277fdfcb8ae3979"></a><!-- doxytag: member="OTEnvelope::OTEnvelope" ref="a836f12b432ff258ce277fdfcb8ae3979" args="(const OTASCIIArmor &amp;theArmoredText)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_envelope.html#a23df10efae7128c76246abf6326a7209">OTEnvelope::OTEnvelope</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>theArmoredText</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00598">598</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(theArmoredText);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a276f42ccb6b78e7b531f8bf25baf96cc"></a><!-- doxytag: member="OTEnvelope::OTEnvelope" ref="a276f42ccb6b78e7b531f8bf25baf96cc" args="(const OTString &amp;strArmorWithBookends)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EXPORT <a class="el" href="class_o_t_envelope.html#a23df10efae7128c76246abf6326a7209">OTEnvelope::OTEnvelope</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strArmorWithBookends</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac52463ee540c3c5e7f4a3aaec7c34f6a"></a><!-- doxytag: member="OTEnvelope::~OTEnvelope" ref="ac52463ee540c3c5e7f4a3aaec7c34f6a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_envelope.html#ac52463ee540c3c5e7f4a3aaec7c34f6a">OTEnvelope::~OTEnvelope</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00610">610</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab478da9d1884c67f6ec6bebf38b49a3d"></a><!-- doxytag: member="OTEnvelope::Decrypt" ref="ab478da9d1884c67f6ec6bebf38b49a3d" args="(OTString &amp;theOutput, const OTSymmetricKey &amp;theKey, const OTPassword &amp;thePassword)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#ab478da9d1884c67f6ec6bebf38b49a3d">OTEnvelope::Decrypt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;&#160;</td>
          <td class="paramname"><em>theKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassword</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00354">354</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTEnvelope::Decrypt&quot;</span>;
    <span class="comment">// ------------------------------------------------</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((thePassword.<a class="code" href="class_o_t_password.html#a9ff2880813b81165a350c92e930ba311">isPassword</a>() &amp;&amp; (thePassword.<a class="code" href="class_o_t_password.html#a849be9ea50ea9935feba18a9a0919fe5">getPasswordSize</a>() &gt; 0)) || (thePassword.<a class="code" href="class_o_t_password.html#a59342b6d2f7224d6436e4950d0432612">isMemory</a>() &amp;&amp; (thePassword.<a class="code" href="class_o_t_password.html#a9733667570f4ee91a4c8993d11f198a8">getMemorySize</a>() &gt; 0)));
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(theKey.<a class="code" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">IsGenerated</a>());
    <span class="comment">// -----------------------------------------------</span>
    <a class="code" href="class_o_t_password.html">OTPassword</a>  theRawSymmetricKey;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#a6930ce6ccea45d4259a8e44171d27763">GetRawKeyFromPassphrase</a>(thePassword, theRawSymmetricKey))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to retrieve raw symmetric key using password. (Wrong password?)\n&quot;</span>, 
                      szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;   
    }
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">//</span>
    uint32_t    nRead         = 0;
    uint32_t    nRunningTotal = 0;
    
    m_dataContents.<a class="code" href="class_o_t_data.html#ad6e1d52647f43ec65069a9aa676d7e26">reset</a>(); <span class="comment">// Reset the fread position on this object to 0.</span>

    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read the ENVELOPE TYPE (as network order version -- and convert to host version.)</span>
    <span class="comment">//</span>
    <span class="comment">// 0 == Error</span>
    <span class="comment">// 1 == Asymmetric Key  (this function -- Seal / Open)</span>
    <span class="comment">// 2 == Symmetric Key   (other functions -- Encrypt / Decrypt use this.)</span>
    <span class="comment">// Anything else: error.</span>
    <span class="comment">//</span>
    uint16_t  env_type_n = 0;
    
    <span class="keywordflow">if</span> (0 == (nRead = m_dataContents.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;env_type_n),
                                             static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(env_type_n)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading Envelope Type. Expected asymmetric(1) or symmetric (2).\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    nRunningTotal += nRead;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(env_type_n)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert that envelope type from network to HOST endian.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> uint16_t env_type = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(ntohs(static_cast&lt;uint16_t&gt;(env_type_n)));
<span class="comment">//  nRunningTotal += env_type;    // NOPE! Just because envelope type is 1 or 2, doesn&#39;t mean we add 1 or 2 extra bytes to the length here. Nope!</span>
    
    <span class="keywordflow">if</span> (2 != env_type)
    {
        <span class="keyword">const</span> uint32_t l_env_type = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(env_type);
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Expected Envelope for Symmetric key (type 2) but instead found type: %lld.\n&quot;</span>, 
                      szFunc, l_env_type);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Read network-order IV size (and convert to host version) </span>
    <span class="comment">//    </span>
    <span class="keyword">const</span> uint32_t max_iv_length   = <a class="code" href="class_o_t_crypto_config.html#ae6a1a4137bd87e84c342bb4e0149ca56">OTCryptoConfig::SymmetricIvSize</a>(); <span class="comment">// I believe this is a max length, so it may not match the actual length of the IV.</span>
    
    <span class="comment">// Read the IV SIZE (network order version -- convert to host version.)</span>
    <span class="comment">//</span>
    uint32_t    iv_size_n   = 0;
    
    <span class="keywordflow">if</span> (0 == (nRead = m_dataContents.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(reinterpret_cast&lt;uint8_t*&gt;(&amp;iv_size_n),
                                             static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(iv_size_n)))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading IV Size.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    nRunningTotal += nRead;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(iv_size_n)));
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// convert that iv size from network to HOST endian.</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> uint32_t iv_size_host_order = ntohl(iv_size_n);
    
    <span class="keywordflow">if</span> (iv_size_host_order &gt; max_iv_length)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: iv_size (%lld) is larger than max_iv_length (%lld).\n&quot;</span>,
                      szFunc, static_cast&lt;int64_t&gt;(iv_size_host_order), static_cast&lt;int64_t&gt;(max_iv_length));
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
<span class="comment">//  nRunningTotal += iv_size_host_order; // Nope!</span>
    <span class="comment">// ****************************************************************************</span>
    <span class="comment">//</span>
    <span class="comment">// Then read the IV (initialization vector) itself.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theIV;
    theIV.<a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(iv_size_host_order);
    
    <span class="keywordflow">if</span> (0 == (nRead = m_dataContents.<a class="code" href="class_o_t_data.html#a4892d79a257500ee8c798736ce0d1ba8">OTfread</a>(static_cast&lt;uint8_t*&gt;(const_cast&lt;void *&gt;(theIV.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>())), 
                                             <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(iv_size_host_order))))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error reading initialization vector.\n&quot;</span>, szFunc);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    nRunningTotal += nRead;
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead == static_cast&lt;uint32_t&gt;(iv_size_host_order));
    
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nRead &lt;= max_iv_length);
    
    <span class="comment">// ----------------------------------------------------------------------------    </span>
    <span class="comment">// We create an OTPayload object to store the ciphertext itself, which begins AFTER the end of the IV.</span>
    <span class="comment">// So we see pointer + nRunningTotal as the starting point for the ciphertext.</span>
    <span class="comment">// the size of the ciphertext, meanwhile, is the size of the entire thing, MINUS nRunningTotal.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theCipherText(static_cast&lt;const void*&gt;( 
                                               static_cast&lt;const uint8_t *&gt;(m_dataContents.<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>()) + nRunningTotal
                                               ), 
                      m_dataContents.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() - nRunningTotal);
    <span class="comment">// ----------------------------------------------------------------------------</span>
    <span class="comment">// Now we&#39;ve got all the pieces together, let&#39;s try to decrypt it...</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_payload.html">OTPayload</a> thePlaintext; <span class="comment">// for output.</span>
    
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bDecrypted = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a26d95569b445dd5f8f599543a8ede627">Decrypt</a>(theRawSymmetricKey, <span class="comment">// The symmetric key, in clear form.</span>
                                                    <span class="comment">// -------------------------------</span>
                                                    static_cast&lt;const char *&gt;(theCipherText.GetPayloadPointer()),  <span class="comment">// This is the Ciphertext.</span>
                                                    theCipherText.GetSize(),
                                                    <span class="comment">// -------------------------------</span>
                                                    theIV,
                                                    <span class="comment">// -------------------------------</span>
                                                    thePlaintext); <span class="comment">// OUTPUT. (Recovered plaintext.) You can pass OTPassword&amp; OR OTPayload&amp; here (either will work.)</span>
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">// theOutput is where we&#39;ll put the decrypted data.</span>
    <span class="comment">//</span>
    theOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
    
    <span class="keywordflow">if</span> (bDecrypted)
    {
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// Make sure it&#39;s null-terminated...</span>
        <span class="comment">//</span>
        uint32_t nIndex = thePlaintext.GetSize()-1;
        (<span class="keyword">static_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(<span class="keyword">const_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(thePlaintext.GetPointer())))[nIndex] = <span class="charliteral">&#39;\0&#39;</span>;
        
        <span class="comment">// -----------------------------------------------------</span>
        <span class="comment">// Set it into theOutput (to return the plaintext to the caller)</span>
        <span class="comment">//</span>
        theOutput.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(static_cast&lt;const char *&gt;(thePlaintext.GetPointer()));
        <span class="comment">// ----------------</span>
    }
    
    <span class="keywordflow">return</span> bDecrypted;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aabf0fe42b8839ed8e531d576d45d5d82"></a><!-- doxytag: member="OTEnvelope::Encrypt" ref="aabf0fe42b8839ed8e531d576d45d5d82" args="(const OTString &amp;theInput, OTSymmetricKey &amp;theKey, const OTPassword &amp;thePassword)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#aabf0fe42b8839ed8e531d576d45d5d82">OTEnvelope::Encrypt</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_symmetric_key.html">OTSymmetricKey</a> &amp;&#160;</td>
          <td class="paramname"><em>theKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_password.html">OTPassword</a> &amp;&#160;</td>
          <td class="paramname"><em>thePassword</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00236">236</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>((thePassword.<a class="code" href="class_o_t_password.html#a9ff2880813b81165a350c92e930ba311">isPassword</a>() &amp;&amp; (thePassword.<a class="code" href="class_o_t_password.html#a849be9ea50ea9935feba18a9a0919fe5">getPasswordSize</a>() &gt; 0)) || (thePassword.<a class="code" href="class_o_t_password.html#a59342b6d2f7224d6436e4950d0432612">isMemory</a>() &amp;&amp; (thePassword.<a class="code" href="class_o_t_password.html#a9733667570f4ee91a4c8993d11f198a8">getMemorySize</a>() &gt; 0)));
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(theInput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>());
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">// Generate a random initialization vector.</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theIV;

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theIV.Randomize(<a class="code" href="class_o_t_crypto_config.html#ae6a1a4137bd87e84c342bb4e0149ca56">OTCryptoConfig::SymmetricIvSize</a>()))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to randomly generate IV.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;   
    }
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">// If the symmetric key hasn&#39;t already been generated, we&#39;ll just do that now...</span>
    <span class="comment">// (The passphrase is used to derive another key that is used to encrypt the</span>
    <span class="comment">// actual symmetric key, and to access it later.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#a9e2eced2ded569ff96ddace6488a7968">IsGenerated</a>()) &amp;&amp; (<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#a2ef54d17c58afc9edea214ea0a2dcf13">GenerateKey</a>(thePassword)))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to generate symmetric key using password.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;   
    }
    <span class="comment">// -----------------------------------------------</span>

    <span class="keywordflow">if</span> (!theKey.<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>())
    {
        <span class="keywordflow">if</span>(!theKey.<a class="code" href="class_o_t_symmetric_key.html#a9e5ce58cbef7f7799b93803b71950b5e">GenerateHashCheck</a>(thePassword))
        {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to generate hash check using password.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
    }

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(theKey.<a class="code" href="class_o_t_symmetric_key.html#a213fa5c52407fa234f8396c4f795f783">HasHashCheck</a>());

    <a class="code" href="class_o_t_password.html">OTPassword</a>  theRawSymmetricKey;
    
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theKey.<a class="code" href="class_o_t_symmetric_key.html#a6930ce6ccea45d4259a8e44171d27763">GetRawKeyFromPassphrase</a>(thePassword, theRawSymmetricKey))
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to retrieve raw symmetric key using password.\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;   
    }
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_payload.html">OTPayload</a> theCipherText;
    
    <span class="keyword">const</span> <span class="keywordtype">bool</span> bEncrypted = <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#a4fa0bfe14ed42ebf60e696603ae53c0b">Encrypt</a>(theRawSymmetricKey, <span class="comment">// The symmetric key, in clear form.</span>
                                                    <span class="comment">// -------------------------------</span>
                                                    theInput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),     <span class="comment">// This is the Plaintext.</span>
                                                    theInput.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() + 1, <span class="comment">// for null terminator</span>
                                                    <span class="comment">// -------------------------------</span>
                                                    theIV,              <span class="comment">// Initialization vector.</span>
                                                    <span class="comment">// -------------------------------</span>
                                                    theCipherText);     <span class="comment">// OUTPUT. (Ciphertext.)</span>
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Success?</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!bEncrypted)
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: (static) call failed to encrypt. Wrong key? (Returning false.)\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// This is where the envelope final contents will be placed,</span>
    <span class="comment">// including the envelope type, the size of the IV, the IV</span>
    <span class="comment">// itself, and the ciphertext.</span>
    <span class="comment">//</span>
    m_dataContents.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

    <span class="comment">// -----------------------------------------------</span>
    <span class="comment">// Write the ENVELOPE TYPE (network order version.)</span>
    <span class="comment">//</span>
    <span class="comment">// 0 == Error</span>
    <span class="comment">// 1 == Asymmetric Key  (other functions -- Seal / Open.)</span>
    <span class="comment">// 2 == Symmetric Key   (this function -- Encrypt / Decrypt.)</span>
    <span class="comment">// Anything else: error.</span>
    
    uint16_t   env_type_n = <span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(htons(static_cast&lt;uint16_t&gt;(2))); <span class="comment">// Calculate &quot;network-order&quot; version of envelope type 2.</span>
    
    m_dataContents.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;env_type_n),   
                               <span class="comment">// (uint32_t here is the 2nd parameter to Concatenate, and has nothing to do with env_type_n being uint16_t)</span>
                               static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(env_type_n)));  
    <span class="comment">// ------------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Write IV size (in network-order)</span>
    <span class="comment">//</span>
    uint32_t  ivlen   = <a class="code" href="class_o_t_crypto_config.html#ae6a1a4137bd87e84c342bb4e0149ca56">OTCryptoConfig::SymmetricIvSize</a>(); <span class="comment">// Length of IV for this cipher...</span>
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(ivlen &gt;= theIV.GetSize());
    uint32_t  ivlen_n = htonl(theIV.GetSize()); <span class="comment">// Calculate &quot;network-order&quot; version of iv length.</span>
    
    m_dataContents.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(reinterpret_cast&lt;void *&gt;(&amp;ivlen_n),   
                               static_cast&lt;uint32_t&gt;(<span class="keyword">sizeof</span>(ivlen_n)));
    
    <span class="comment">// Write the IV itself.</span>
    <span class="comment">//</span>
    m_dataContents.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(theIV.GetPayloadPointer(), 
                               <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(theIV.GetSize()));
    <span class="comment">// ------------------------------------------------------------</span>
    
    <span class="comment">// Write the Ciphertext.</span>
    <span class="comment">//</span>
    m_dataContents.<a class="code" href="class_o_t_data.html#a95c6d4d474bb010f504d0f2c7ae75211">Concatenate</a>(theCipherText.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(), 
                               <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(theCipherText.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>()));
    
    <span class="comment">// We don&#39;t write the size of the ciphertext before the ciphertext itself,</span>
    <span class="comment">// since the decryption is able to deduce the size based on the total envelope</span>
    <span class="comment">// size minus the other pieces. We might still want to add that size here, however.</span>
    <span class="comment">// (for security / safety reasons.)</span>
    
    <span class="comment">// -----------------------------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8ce11b76410974ec11fcd7afff21027"></a><!-- doxytag: member="OTEnvelope::GetAsBookendedString" ref="ac8ce11b76410974ec11fcd7afff21027" args="(OTString &amp;strArmorWithBookends, bool bEscaped=false) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#ac8ce11b76410974ec11fcd7afff21027">OTEnvelope::GetAsBookendedString</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strArmorWithBookends</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bEscaped</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00180">180</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
    <span class="comment">// This function will base64 ENCODE m_dataContents, and then</span>
    <span class="comment">// Set() that as the string contents on theArmoredText.</span>
    <span class="keyword">const</span> <span class="keywordtype">bool</span>   bSetData = theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a48e0e2e2eff86ad382a2cc63298a0b8b">SetData</a>(m_dataContents, <span class="keyword">true</span>);<span class="comment">//bLineBreaks=true (by default anyway.)</span>
    
    <span class="keywordflow">if</span> (bSetData)
    {
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bWritten = theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a754effb29fd0192ba0a7535846e52890">WriteArmoredString</a>(strArmorWithBookends, <span class="stringliteral">&quot;ENVELOPE&quot;</span>, <span class="comment">// todo hardcoded</span>
                                                                bEscaped);
        <span class="keywordflow">if</span> (!bWritten)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling: &quot;</span>
                          <span class="stringliteral">&quot;theArmoredText.WriteArmoredString\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">else</span>
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling: &quot;</span>
                      <span class="stringliteral">&quot;theArmoredText.SetData(m_dataContents, true)\n&quot;</span>, __FUNCTION__);
    
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4ecb56611bd11931de4fae77b8b735ec"></a><!-- doxytag: member="OTEnvelope::GetAsciiArmoredData" ref="a4ecb56611bd11931de4fae77b8b735ec" args="(OTASCIIArmor &amp;theArmoredText, bool bLineBreaks=true) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">OTEnvelope::GetAsciiArmoredData</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>theArmoredText</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bLineBreaks</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00158">158</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a48e0e2e2eff86ad382a2cc63298a0b8b">SetData</a>(m_dataContents, bLineBreaks);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae2e8fafc4e508ce5d323c089b71c7e7b"></a><!-- doxytag: member="OTEnvelope::Open" ref="ae2e8fafc4e508ce5d323c089b71c7e7b" args="(const OTPseudonym &amp;theRecipient, OTString &amp;theOutput, OTPasswordData *pPWData=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">OTEnvelope::Open</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theRecipient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_password_data.html">OTPasswordData</a> *&#160;</td>
          <td class="paramname"><em>pPWData</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00564">564</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#ad5967e8e7878629c118b5d9644ad96d1">Open</a>(m_dataContents, theRecipient, theOutput, pPWData);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa03a9ff3ec1ad113a894ba4d9fac1876"></a><!-- doxytag: member="OTEnvelope::Seal" ref="aa03a9ff3ec1ad113a894ba4d9fac1876" args="(const OTPseudonym &amp;theRecipient, const OTString &amp;theInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">OTEnvelope::Seal</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theRecipient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00504">504</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_string.html">OTString</a>              strNymID;
    <a class="code" href="_o_t_crypto_8hpp.html#a26e3eb3c76441ff452fdae8253c0c375">mapOfAsymmetricKeys</a>   theKeys;
    theRecipient.<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strNymID);
    theKeys.insert(std::pair&lt;std::string, OTAsymmetricKey *&gt;
                   (strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> *<span class="keyword">&gt;</span>(&amp;(theRecipient.<a class="code" href="class_o_t_pseudonym.html#a7a7b836bb9e8e0df7b3601f44e1b7220">GetPublicEncrKey</a>()))));
    <span class="comment">// -----------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(theKeys, theInput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa13c275de4b895d1e60882c872768090"></a><!-- doxytag: member="OTEnvelope::Seal" ref="aa13c275de4b895d1e60882c872768090" args="(const OTAsymmetricKey &amp;RecipPubKey, const OTString &amp;theInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">OTEnvelope::Seal</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> &amp;&#160;</td>
          <td class="paramname"><em>RecipPubKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00540">540</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_crypto_8hpp.html#a26e3eb3c76441ff452fdae8253c0c375">mapOfAsymmetricKeys</a>   theKeys;
    theKeys.insert(std::pair&lt;std::string, OTAsymmetricKey *&gt;
                   (<span class="stringliteral">&quot;&quot;</span>, <span class="comment">// Normally the NymID goes here, but we don&#39;t know what it is, in this case.</span>
                    const_cast&lt;OTAsymmetricKey *&gt;(&amp;RecipPubKey)));
    <span class="comment">// -----------------------------</span>
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(theKeys, theInput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad3725c01277b880a22b5639973da1fbf"></a><!-- doxytag: member="OTEnvelope::Seal" ref="ad3725c01277b880a22b5639973da1fbf" args="(setOfNyms &amp;theRecipients, const OTString &amp;theInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">OTEnvelope::Seal</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_o_t_crypto_8hpp.html#a36d2c43b456afda4ba860750a1e67584">setOfNyms</a> &amp;&#160;</td>
          <td class="paramname"><em>theRecipients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00516">516</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_crypto_8hpp.html#a26e3eb3c76441ff452fdae8253c0c375">mapOfAsymmetricKeys</a> RecipPubKeys;
    
    <span class="comment">// Loop through theRecipients, and add the public key of each one to a set of keys.</span>
    <span class="comment">//</span>
    <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_crypto_8hpp.html#a36d2c43b456afda4ba860750a1e67584">setOfNyms</a>, theRecipients)
    {
        <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = *it;
        <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(NULL != pNym, <span class="stringliteral">&quot;OTEnvelope::Seal: Assert: NULL pseudonym pointer.&quot;</span>);
        <span class="comment">// ------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a>            strNymID;
        pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strNymID);
        RecipPubKeys.insert(std::pair&lt;std::string, OTAsymmetricKey *&gt;
                            (strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), <span class="keyword">const_cast&lt;</span><a class="code" href="class_o_t_asymmetric_key.html">OTAsymmetricKey</a> *<span class="keyword">&gt;</span>(&amp;(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7a7b836bb9e8e0df7b3601f44e1b7220">GetPublicEncrKey</a>()))));
    }
    <span class="comment">// --------------------------------</span>
    <span class="keywordflow">if</span> (0 == RecipPubKeys.size())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    <span class="comment">// --------------------------------</span>
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">Seal</a>(RecipPubKeys, theInput);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af55e3ec3a559c3259037f05877038baf"></a><!-- doxytag: member="OTEnvelope::Seal" ref="af55e3ec3a559c3259037f05877038baf" args="(mapOfAsymmetricKeys &amp;RecipPubKeys, const OTString &amp;theInput)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#aa03a9ff3ec1ad113a894ba4d9fac1876">OTEnvelope::Seal</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_o_t_crypto_8hpp.html#a26e3eb3c76441ff452fdae8253c0c375">mapOfAsymmetricKeys</a> &amp;&#160;</td>
          <td class="paramname"><em>RecipPubKeys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>theInput</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00553">553</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a033b133f48e61f2b227c52ad2be0c882">OT_ASSERT_MSG</a>(RecipPubKeys.size() &gt; 0, <span class="stringliteral">&quot;OTEnvelope::Seal: ASSERT: RecipPubKeys.size() &gt; 0&quot;</span>);
    <span class="comment">// -----------------------------------------------</span>
    
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_crypto.html#af10d51149df4803f79b4b2fed829430b">OTCrypto::It</a>()-&gt;<a class="code" href="class_o_t_crypto.html#acad67ff92701b915f379a23fa37d9386">Seal</a>(RecipPubKeys, theInput, m_dataContents);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad0d76f534bcda708b0298bcf906cb923"></a><!-- doxytag: member="OTEnvelope::SetAsciiArmoredData" ref="ad0d76f534bcda708b0298bcf906cb923" args="(const OTASCIIArmor &amp;theArmoredText, bool bLineBreaks=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">OTEnvelope::SetAsciiArmoredData</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>theArmoredText</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bLineBreaks</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00173">173</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a5564f05ead3366c5b97c8b7edfea083b">GetData</a>(m_dataContents, bLineBreaks);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8d02b4432da2403c3bf01aeffb8f982c"></a><!-- doxytag: member="OTEnvelope::SetFromBookendedString" ref="a8d02b4432da2403c3bf01aeffb8f982c" args="(const OTString &amp;strArmorWithBookends, bool bEscaped=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_envelope.html#a8d02b4432da2403c3bf01aeffb8f982c">OTEnvelope::SetFromBookendedString</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strArmorWithBookends</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bEscaped</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8cpp_source.html#l00206">206</a> of file <a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmoredText;
    <span class="keyword">const</span> <span class="keywordtype">bool</span>   bLoaded = theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a6b5c0069db88e2c884d213ea64d3bbe4">LoadFromString</a>(const_cast&lt;OTString &amp;&gt;(strArmorWithBookends), bEscaped); <span class="comment">//std::string str_override=&quot;-----BEGIN&quot;);</span>
    
    <span class="keywordflow">if</span> (bLoaded)
    {
        <span class="comment">// This function will base64 DECODE theArmoredText&#39;s string contents</span>
        <span class="comment">// and return them as binary in m_dataContents</span>
        <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotData = theArmoredText.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#a5564f05ead3366c5b97c8b7edfea083b">GetData</a>(m_dataContents, <span class="keyword">true</span>); <span class="comment">// bLineBreaks = true</span>

        <span class="keywordflow">if</span> (!bGotData)
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling: &quot;</span>
                          <span class="stringliteral">&quot;theArmoredText.GetData\n&quot;</span>, __FUNCTION__);
        <span class="keywordflow">else</span>
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while calling: &quot;</span>
                      <span class="stringliteral">&quot;theArmoredText.LoadFromString\n&quot;</span>, __FUNCTION__);
    <span class="comment">// -----------------------------</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="ae30ec9237eff8224f54468df8341bcc4"></a><!-- doxytag: member="OTEnvelope::OTPayload" ref="ae30ec9237eff8224f54468df8341bcc4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="class_o_t_payload.html">OTPayload</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_envelope_8hpp_source.html#l00152">152</a> of file <a class="el" href="_o_t_envelope_8hpp_source.html">OTEnvelope.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_envelope_8hpp_source.html">OTEnvelope.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_envelope_8cpp_source.html">OTEnvelope.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_envelope.html">OTEnvelope</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:12 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
