<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTTrade Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_trade.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OTTrade Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTTrade" --><!-- doxytag: inherits="OTCronItem" -->
<p><code>#include &lt;<a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTTrade:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_trade.png" usemap="#OTTrade_map" alt=""/>
  <map id="OTTrade_map" name="OTTrade_map">
<area href="class_o_t_cron_item.html" alt="OTCronItem" shape="rect" coords="0,224,86,248"/>
<area href="class_o_t_trackable.html" alt="OTTrackable" shape="rect" coords="0,168,86,192"/>
<area href="class_o_t_instrument.html" alt="OTInstrument" shape="rect" coords="0,112,86,136"/>
<area href="class_o_t_scriptable.html" alt="OTScriptable" shape="rect" coords="0,56,86,80"/>
<area href="class_o_t_contract.html" alt="OTContract" shape="rect" coords="0,0,86,24"/>
</map>
 </div></div>

<p><a href="class_o_t_trade-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a6327be5c41af7a34dd3912b8d17947e0">VerifyOffer</a> (<a class="el" href="class_o_t_offer.html">OTOffer</a> &amp;theOffer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a64013127ededb1a9729aeb07ea9cadb7">IssueTrade</a> (<a class="el" href="class_o_t_offer.html">OTOffer</a> &amp;theOffer, char cStopSign=0, int64_t lStopPrice=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a61d3d3ab221ede656fbaeb5f963e2bf3">GetOfferString</a> (<a class="el" href="class_o_t_string.html">OTString</a> &amp;strOffer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ac9a572c0c92699dd2a70f04d0aad933e">IsStopOrder</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const int64_t &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a2234ed0a72b48fa0749cbe89e69d5a54">GetStopPrice</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a532bed3d9d02a34878fb24b0ea615d1b">IsGreaterThan</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ab302e2eb41c65f91118bcd208b78ed4a">IsLessThan</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_o_t_offer.html">OTOffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a6646cc5a3fb798d1fca122161e870281">GetOffer</a> (<a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *pOFFER_MARKET_ID=NULL, <a class="el" href="class_o_t_market.html">OTMarket</a> **ppMarket=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#aecec352539c0f5e77eb7a08eb6353836">SetCurrencyID</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;CURRENCY_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a9918143d418796eab01f05037ced3965">GetCurrencyAcctID</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a6451298536ecc98329c371e00263f741">SetCurrencyAcctID</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;CURRENCY_ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#acc7070bba01b1e1b9dcadf1bb880083c">IncrementTradesAlreadyDone</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a632e944d79fe44e9cd503a41674b58fd">GetCompletedCount</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ad21c6e7d77168d945c1375dedc9a74e0">GetAssetAcctClosingNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#af72dc4e869fe4b25c250398a2da27570">GetCurrencyAcctClosingNum</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a7a7ae6755bab2bbc60c5badb9043285d">ProcessCron</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a5cb3c8213ac91b1533110edaa3263760">CanRemoveItemFromCron</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a821c6861fd2da5ebd81f7b9d078c8af7">VerifyNymAsAgent</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theSignerNym, <a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *pmap_ALREADY_LOADED=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ab1bb54a55733cfe8a996f58b6b43f216">VerifyNymAsAgentForAccount</a> (<a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theNym, <a class="el" href="class_o_t_account.html">OTAccount</a> &amp;theAccount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a6b5e3c013ef8961fe058cdcee1b26a4d">OTTrade</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#af9fe5ed71f8eb4dd7edb12da05302b89">OTTrade</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#aef77bcd3efa8dd101cd16e16442fcc0f">OTTrade</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;SERVER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;ASSET_ACCT_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;USER_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;CURRENCY_ID, const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;CURRENCY_ACCT_ID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a2b3fc4952a0d241a25c7f26aa0d36d6f">~OTTrade</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">InitTrade</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a7649c698b39d19d956586e00bf32c6b3">Release_Trade</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a677d2b33af8117fb681b52e20a4baaff">Release</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ade7f91cb3eddd3e8bf0216f7a0f92f77">GetClosingNumber</a> (const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;theAcctID) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ab62bbaf94b2df5b01c52d988e023ae8b">ProcessXMLNode</a> (<a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;xml)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#ab72fd44769391a80946e0cd51c9bd194">UpdateContents</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a635d7f83beaa3885856900727a457835">SaveContractWallet</a> (std::ofstream &amp;ofs)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#a1bdd13967c44b74a74d9189abf980664">onFinalReceipt</a> (<a class="el" href="class_o_t_cron_item.html">OTCronItem</a> &amp;theOrigCronItem, const int64_t &amp;lNewTransactionNumber, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;theOriginator, <a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *pRemover)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_trade.html#acdcc621f3bf7f2cf19cbc4bc50a70856">onRemovalFromCron</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00170">170</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6b5e3c013ef8961fe058cdcee1b26a4d"></a><!-- doxytag: member="OTTrade::OTTrade" ref="a6b5e3c013ef8961fe058cdcee1b26a4d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_trade.html#a6b5e3c013ef8961fe058cdcee1b26a4d">OTTrade::OTTrade</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01257">1257</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                 : ot_super(), m_pOffer(NULL),
    m_bHasTradeActivated(<span class="keyword">false</span>),
    m_lStopPrice(0),
    m_cStopSign(0),
    m_bHasStopActivated(<span class="keyword">false</span>),
    m_nTradesAlreadyDone(0)
{
<span class="comment">//  m_pOffer            = NULL; // NOT responsible to clean this up. Just keeping the pointer for convenience.</span>
                                <span class="comment">// You might ask, &quot;but what if it goes bad?&quot; Actually only THIS object should ever decide that.</span>
                                <span class="comment">// Only the Trade object decides when to add or remove an offer from any market.</span>

    <a class="code" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">InitTrade</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af9fe5ed71f8eb4dd7edb12da05302b89"></a><!-- doxytag: member="OTTrade::OTTrade" ref="af9fe5ed71f8eb4dd7edb12da05302b89" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_trade.html#a6b5e3c013ef8961fe058cdcee1b26a4d">OTTrade::OTTrade</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01272">1272</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                              :
            ot_super(SERVER_ID, ASSET_ID), m_pOffer(NULL),
    m_bHasTradeActivated(<span class="keyword">false</span>),
    m_lStopPrice(0),
    m_cStopSign(0),
    m_bHasStopActivated(<span class="keyword">false</span>),
    m_nTradesAlreadyDone(0)
{
<span class="comment">//  m_pOffer            = NULL; // NOT responsible to clean this up. Just keeping the pointer for convenience.</span>
                                <span class="comment">// You might ask, &quot;but what if it goes bad?&quot; Actually only THIS object should ever decide that.</span>
                                <span class="comment">// Only the Trade object decides when to add or remove an offer from any market.</span>

    <a class="code" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">InitTrade</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="aef77bcd3efa8dd101cd16e16442fcc0f"></a><!-- doxytag: member="OTTrade::OTTrade" ref="aef77bcd3efa8dd101cd16e16442fcc0f" args="(const OTIdentifier &amp;SERVER_ID, const OTIdentifier &amp;ASSET_ID, const OTIdentifier &amp;ASSET_ACCT_ID, const OTIdentifier &amp;USER_ID, const OTIdentifier &amp;CURRENCY_ID, const OTIdentifier &amp;CURRENCY_ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_trade.html#a6b5e3c013ef8961fe058cdcee1b26a4d">OTTrade::OTTrade</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>SERVER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>ASSET_ACCT_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>USER_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>CURRENCY_ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>CURRENCY_ACCT_ID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01288">1288</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                          :
            ot_super(SERVER_ID, ASSET_ID, ASSET_ACCT_ID, USER_ID), m_pOffer(NULL),
    m_bHasTradeActivated(<span class="keyword">false</span>),
    m_lStopPrice(0),
    m_cStopSign(0),
    m_bHasStopActivated(<span class="keyword">false</span>),
    m_nTradesAlreadyDone(0)
{
<span class="comment">//  m_pOffer            = NULL; // NOT responsible to clean this up. Just keeping the pointer for convenience.</span>
                                <span class="comment">// You might ask, &quot;but what if it goes bad?&quot; Actually only THIS object should ever decide that.</span>
                                <span class="comment">// Only the Trade object decides when to add or remove an offer from any market.</span>

    <a class="code" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">InitTrade</a>();

    <a class="code" href="class_o_t_trade.html#aecec352539c0f5e77eb7a08eb6353836">SetCurrencyID</a>(CURRENCY_ID);
    <a class="code" href="class_o_t_trade.html#a6451298536ecc98329c371e00263f741">SetCurrencyAcctID</a>(CURRENCY_ACCT_ID);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2b3fc4952a0d241a25c7f26aa0d36d6f"></a><!-- doxytag: member="OTTrade::~OTTrade" ref="a2b3fc4952a0d241a25c7f26aa0d36d6f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_trade.html#a2b3fc4952a0d241a25c7f26aa0d36d6f">OTTrade::~OTTrade</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01310">1310</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_trade.html#a7649c698b39d19d956586e00bf32c6b3">Release_Trade</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a5cb3c8213ac91b1533110edaa3263760"></a><!-- doxytag: member="OTTrade::CanRemoveItemFromCron" ref="a5cb3c8213ac91b1533110edaa3263760" args="(OTPseudonym &amp;theNym)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a5cb3c8213ac91b1533110edaa3263760">OTTrade::CanRemoveItemFromCron</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>See if theNym has rights to remove this item from Cron. </p>

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#ae79115b7343f9b2700aa59d2701f2334">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00820">820</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// I don&#39;t call the parent class&#39; version of this function, in the case of OTTrade,</span>
    <span class="comment">// since it would just be redundant.</span>

    <span class="comment">// ---------------------------------------------------------------------------------------</span>
    <span class="comment">// You don&#39;t just go willy-nilly and remove a cron item from a market unless you check first</span>
    <span class="comment">// and make sure the Nym who requested it actually has said trans# (and 2 related closing #s)</span>
    <span class="comment">// signed out to him on his last receipt...</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(5, <span class="stringliteral">&quot;OTTrade::CanRemoveItem: theNym is not the originator of this CronItem. &quot;</span>
                      <span class="stringliteral">&quot;(He could be a recipient though, so this is normal.)\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, that means theNym is DEFINITELY the originator (sender)...</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &lt; 2)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTrade::CanRemoveItem Weird: Sender tried to remove a market trade; expected at &quot;</span>
                       <span class="stringliteral">&quot;least 2 closing numbers to be available--that weren&#39;t. (Found %d).\n&quot;</span>, this-&gt;<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>());
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// ------------------------------------------</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, this-&gt;GetAssetAcctClosingNum()))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTTrade::CanRemoveItemFromCron: Closing number didn&#39;t verify for asset account.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<span class="keyword">false</span> == theNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, this-&gt;GetCurrencyAcctClosingNum()))
    {
        <a class="code" href="class_o_t_log.html#a1f7549d776ee919dcb6517f611ded015">OTLog::Output</a>(0, <span class="stringliteral">&quot;OTTrade::CanRemoveItemFromCron: Closing number didn&#39;t verify for currency account.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// By this point, we KNOW theNym is the sender, and we KNOW there are the proper number of transaction</span>
    <span class="comment">// numbers available to close. We also know that this cron item really was on the cron object, since</span>
    <span class="comment">// that is where it was looked up from, when this function got called! So I&#39;m pretty sure, at this point,</span>
    <span class="comment">// to authorize removal, as long as the transaction num is still issued to theNym (this check here.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> theNym.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, this-&gt;<a class="code" href="class_o_t_cron_item.html#acd198571145b47602c121a419723b39a">GetOpeningNum</a>());

    <span class="comment">// Normally this will be all we need to check. The originator will have the transaction</span>
    <span class="comment">// number signed-out to him still, if he is trying to close it. BUT--in some cases, someone</span>
    <span class="comment">// who is NOT the originator can cancel. Like in a payment plan, the sender is also the depositor,</span>
    <span class="comment">// who would normally be the person cancelling the plan. But technically, the RECIPIENT should</span>
    <span class="comment">// also have the ability to cancel that payment plan.  BUT: the transaction number isn&#39;t signed</span>
    <span class="comment">// out to the RECIPIENT... In THAT case, the below VerifyIssuedNum() won&#39;t work! In those cases,</span>
    <span class="comment">// expect that the special code will be in the subclasses override of this function. (OTPaymentPlan::CanRemoveItem() etc)</span>

    <span class="comment">// P.S. If you override this function, MAKE SURE to call the parent (OTCronItem::CanRemoveItem) first,</span>
    <span class="comment">// for the VerifyIssuedNum call above. Only if that fails, do you need to dig deeper...</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad21c6e7d77168d945c1375dedc9a74e0"></a><!-- doxytag: member="OTTrade::GetAssetAcctClosingNum" ref="ad21c6e7d77168d945c1375dedc9a74e0" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_trade.html#ad21c6e7d77168d945c1375dedc9a74e0">OTTrade::GetAssetAcctClosingNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00806">806</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &gt; 0) ? <a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(0) : 0; <span class="comment">// todo stop hardcoding.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade7f91cb3eddd3e8bf0216f7a0f92f77"></a><!-- doxytag: member="OTTrade::GetClosingNumber" ref="ade7f91cb3eddd3e8bf0216f7a0f92f77" args="(const OTIdentifier &amp;theAcctID) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_trade.html#ade7f91cb3eddd3e8bf0216f7a0f92f77">OTTrade::GetClosingNumber</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>theAcctID</em></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#acb5f09af7950df9591c267031745a3e7">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00792">792</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theAssetAcctID     = this-&gt;<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>();
    <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theCurrencyAcctID  = this-&gt;<a class="code" href="class_o_t_trade.html#a9918143d418796eab01f05037ced3965">GetCurrencyAcctID</a>();

    <span class="keywordflow">if</span> (theAcctID == theAssetAcctID)
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_trade.html#ad21c6e7d77168d945c1375dedc9a74e0">GetAssetAcctClosingNum</a>();
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theAcctID == theCurrencyAcctID)
        <span class="keywordflow">return</span> <a class="code" href="class_o_t_trade.html#af72dc4e869fe4b25c250398a2da27570">GetCurrencyAcctClosingNum</a>();
    <span class="comment">// else...</span>
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a632e944d79fe44e9cd503a41674b58fd"></a><!-- doxytag: member="OTTrade::GetCompletedCount" ref="a632e944d79fe44e9cd503a41674b58fd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_trade.html#a632e944d79fe44e9cd503a41674b58fd">OTTrade::GetCompletedCount</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00224">224</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_nTradesAlreadyDone; }
</pre></div>
</div>
</div>
<a class="anchor" id="af72dc4e869fe4b25c250398a2da27570"></a><!-- doxytag: member="OTTrade::GetCurrencyAcctClosingNum" ref="af72dc4e869fe4b25c250398a2da27570" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_o_t_trade.html#af72dc4e869fe4b25c250398a2da27570">OTTrade::GetCurrencyAcctClosingNum</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00812">812</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &gt; 1) ? <a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(1) : 0; <span class="comment">// todo stop hardcoding.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9918143d418796eab01f05037ced3965"></a><!-- doxytag: member="OTTrade::GetCurrencyAcctID" ref="a9918143d418796eab01f05037ced3965" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a>&amp; <a class="el" href="class_o_t_trade.html#a9918143d418796eab01f05037ced3965">OTTrade::GetCurrencyAcctID</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00220">220</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_CURRENCY_ACCT_ID; }
</pre></div>
</div>
</div>
<a class="anchor" id="a1a8b6c31bb210b4f5df3d5bfca8efa9b"></a><!-- doxytag: member="OTTrade::GetCurrencyID" ref="a1a8b6c31bb210b4f5df3d5bfca8efa9b" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a>&amp; <a class="el" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">OTTrade::GetCurrencyID</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00217">217</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_CURRENCY_TYPE_ID; }
</pre></div>
</div>
</div>
<a class="anchor" id="a6646cc5a3fb798d1fca122161e870281"></a><!-- doxytag: member="OTTrade::GetOffer" ref="a6646cc5a3fb798d1fca122161e870281" args="(OTIdentifier *pOFFER_MARKET_ID=NULL, OTMarket **ppMarket=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_offer.html">OTOffer</a> * <a class="el" href="class_o_t_trade.html#a6646cc5a3fb798d1fca122161e870281">OTTrade::GetOffer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_identifier.html">OTIdentifier</a> *&#160;</td>
          <td class="paramname"><em>pOFFER_MARKET_ID</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_market.html">OTMarket</a> **&#160;</td>
          <td class="paramname"><em>ppMarket</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00443">443</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>());

    <span class="comment">// See if the offer has already been instantiated onto a market...</span>
    <span class="keywordflow">if</span> (NULL != m_pOffer)
    {
        m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#add921a56e6ffba3fc471fdf378a7c26c">SetTrade</a>(*<span class="keyword">this</span>);  <span class="comment">// Probably don&#39;t need this line. I&#39;ll remove it someday while optimizing.</span>
                                    <span class="comment">// In fact since it should already be set, having this here would basically</span>
                                    <span class="comment">// hide it from me if the memory was ever walked on from a bug somewhere.</span>

        <span class="comment">// It loaded. Let&#39;s get the Market ID off of it so we can locate the market.</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> OFFER_MARKET_ID(*m_pOffer);

        <span class="keywordflow">if</span> (NULL != ppMarket)
        {
            <a class="code" href="class_o_t_market.html">OTMarket</a> * pMarket = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;<a class="code" href="class_o_t_cron.html#afcc38ab744f5e3710982c600c4412cf2">GetMarket</a>(OFFER_MARKET_ID);

            <span class="comment">// Sometimes the caller function would like a copy of this market pointer, when available.</span>
            <span class="comment">// So I pass it back to him here, if he wants. That way he doesn&#39;t have to do this work again</span>
            <span class="comment">// to look it up.</span>
            <span class="keywordflow">if</span> (NULL != pMarket)
                *ppMarket = pMarket; <span class="comment">// &lt;=================</span>
            <span class="keywordflow">else</span>
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;OTTrade::%s: m_pOffer already exists, yet unable to find the market it&#39;s supposed to be on.\n&quot;</span>,
                              __FUNCTION__);
        }
        <span class="comment">// ----------------------------------------</span>
        <span class="keywordflow">if</span> (NULL != pOFFER_MARKET_ID)
        {
            <span class="comment">// Sometimes the caller function would like a copy of this ID. So I</span>
            <span class="comment">// give the option to pass in a pointer so I can give it here.</span>
            pOFFER_MARKET_ID-&gt;<a class="code" href="class_o_t_data.html#a253cd3974cb837ad06980579eb7bc0e4">Assign</a>(OFFER_MARKET_ID);
        }
        <span class="comment">// ----------------------------------------</span>
        <span class="keywordflow">return</span> m_pOffer;
    } <span class="comment">// if m_pOffer ALREADY EXISTS.</span>

    <span class="comment">// else (BELOW) m_pOffer IS NULL, and thus it didn&#39;t exist yet...</span>
    <span class="comment">// --------------------------------------------------</span>
    <span class="keywordflow">if</span> (!m_strOffer.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTrade::GetOffer called with empty m_strOffer.\n&quot;</span>);
        <span class="keywordflow">return</span> NULL;
    }
    <span class="comment">// --------------------------------------------------</span>
    <a class="code" href="class_o_t_offer.html">OTOffer</a> * pOffer = <span class="keyword">new</span> <a class="code" href="class_o_t_offer.html">OTOffer</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOffer);

    <span class="comment">// Trying to load the offer from the trader&#39;s original signed request</span>
    <span class="comment">// (So I can use it to lookup the Market ID, so I can see the offer is</span>
    <span class="comment">// already there on the market.)</span>
    <span class="keywordflow">if</span> (!pOffer-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(m_strOffer))
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error loading offer from string in OTTrade::GetOffer\n&quot;</span>);
        <span class="keyword">delete</span> pOffer; pOffer = NULL;
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">// No need to do any additional security verification here on the Offer,</span>
    <span class="comment">// since the Offer is already heavily verified in OTServer::NotarizeMarketOffer().</span>
    <span class="comment">// So as long as you feel safe about the Trade, then you can feel safe about</span>
    <span class="comment">// the Offer already, with no further checks.</span>
    <span class="comment">// *Also remember we saved a copy of the original in the cron folder.</span>

    <span class="comment">// It loaded. Let&#39;s get the Market ID off of it so we can locate the market.</span>
    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> OFFER_MARKET_ID(*pOffer);

    <span class="keywordflow">if</span> (NULL != pOFFER_MARKET_ID)
    {
        <span class="comment">// Sometimes the caller function would like a copy of this ID. So I</span>
        <span class="comment">// give the option to pass in a pointer so I can give it here.</span>
        pOFFER_MARKET_ID-&gt;<a class="code" href="class_o_t_data.html#a253cd3974cb837ad06980579eb7bc0e4">Assign</a>(OFFER_MARKET_ID);
    }

    <span class="comment">// ---------------------------------------------------------------</span>
    <span class="comment">// Previously if a user tried to use a market that didn&#39;t exist, I&#39;d just return failure.</span>
    <span class="comment">// But now we will create any market that doesn&#39;t already exist.</span>
    <span class="comment">// (Remember, the server operator could just erase the market folder--it wouldn&#39;t</span>
    <span class="comment">// affect anyone&#39;s balances!) Update: he probably couldn&#39;t just wipe the markets folder,</span>
    <span class="comment">// actually, without making it impossible for certain Nyms to get rid of certain issued #s.</span>
    <span class="comment">//</span>
<span class="comment">//  OTMarket * pMarket = m_pCron-&gt;GetMarket(OFFER_MARKET_ID);</span>
    <a class="code" href="class_o_t_market.html">OTMarket</a> * pMarket = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;<a class="code" href="class_o_t_cron.html#af4fa1a950a600220ac5e570b58e892ff">GetOrCreateMarket</a>(<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>(), <a class="code" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a>(), pOffer-&gt;<a class="code" href="class_o_t_offer.html#ab8ecbbe501cfa19e8c0726b815f27a9e">GetScale</a>());

    <span class="comment">// Couldn&#39;t find (or create) the market.</span>
    <span class="keywordflow">if</span> (NULL == pMarket)
    {
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTTrade::%s: Unable to find or create market within requested parameters.&quot;</span>,
                       __FUNCTION__);
        <span class="keyword">delete</span> pOffer; pOffer = NULL;
        <span class="keywordflow">return</span> NULL;
    }

    <span class="comment">// If the caller passed in the address of a market pointer (optional)</span>
    <span class="keywordflow">if</span> (NULL != ppMarket)
    {
        <span class="comment">// Sometimes the caller function would like a copy of this market pointer, when available.</span>
        <span class="comment">// So I pass it back to him here, if he wants. That way he doesn&#39;t have to do this work again</span>
        <span class="comment">// to look it up.</span>
        *ppMarket = pMarket;
    }
    <span class="comment">// --------------------------------------------------</span>
    <span class="comment">// At this point, I have heap-allocated the offer, used it to get the Market ID, and successfully</span>
    <span class="comment">// used that to get a pointer to the market matching that ID.</span>
    <span class="comment">//</span>
    <span class="comment">// Let&#39;s see if the offer is ALREADY allocated and on this market!</span>
    <span class="comment">// If so, delete the one I just allocated. If not, add it to the market.</span>
    <a class="code" href="class_o_t_offer.html">OTOffer</a> * pMarketOffer = pMarket-&gt;<a class="code" href="class_o_t_market.html#a61f96f7d546012fd290307d519214088">GetOffer</a>(pOffer-&gt;<a class="code" href="class_o_t_offer.html#abf98bb358bc9fdefc12ea474d18b6d6c">GetTransactionNum</a>());

    <span class="comment">// The Offer is already on the Market.</span>
    <span class="comment">// NOTE: It may just start out this way, without ever being added.</span>
    <span class="comment">// How is that possible? Because maybe it was in the market file when we first loaded up,</span>
    <span class="comment">// and had been added on some previous run of the software. So since we started running,</span>
    <span class="comment">// the pMarket-&gt;AddOffer() code below has literally never run for that offer. Instead we</span>
    <span class="comment">// first find it here, and thus return the pointer before getting any farther.</span>
    <span class="comment">//</span>
    <span class="comment">// IN ALL CASES, we make sure to call m_pOffer-&gt;SetTrade() so that it has a pointer BACK to</span>
    <span class="comment">// this Trade object! (When actually processing the offer, the market will need the account</span>
    <span class="comment">// numbers and Nym IDs... which are stored here on the trade.)</span>
    <span class="keywordflow">if</span> (NULL != pMarketOffer)
    {
        m_pOffer = pMarketOffer;

        <span class="comment">// Since the Offer already exists on the market, no need anymore for the</span>
        <span class="comment">// one we allocated above (to get the market ID.) So we delete it now.</span>
        <span class="keyword">delete</span> pOffer;
        pOffer = NULL;

        m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#add921a56e6ffba3fc471fdf378a7c26c">SetTrade</a>(*<span class="keyword">this</span>);

        <span class="keywordflow">return</span> m_pOffer;
    }

    <span class="comment">// ************************************************************************</span>

    <span class="comment">// Okay so the offer ISN&#39;T already on the market. If it&#39;s not a stop order, let&#39;s ADD the one we</span>
    <span class="comment">// allocated to the market now! (Stop orders are activated through their own logic, which is below</span>
    <span class="comment">// this, in the else block.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_trade.html#ac9a572c0c92699dd2a70f04d0aad933e">IsStopOrder</a>())
    {
        <span class="keywordflow">if</span> (m_bHasTradeActivated)
        {
            <span class="comment">// Error -- how has the trade already activated, yet not on the market and null in my pointer?</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;How has the trade already activated, yet not on the market and null in my pointer?\n&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pMarket-&gt;<a class="code" href="class_o_t_market.html#a4b79224a7214740015fcc7b1f90fa7e6">AddOffer</a>(<span class="keyword">this</span>, *pOffer, <span class="keyword">true</span>))   <span class="comment">// Since we&#39;re actually adding an offer to the market (not just</span>
        {                                                   <span class="comment">// loading from disk) the we actually want to save the market.</span>
                                                            <span class="comment">// bSaveFile=true.</span>
            <span class="comment">// Error adding the offer to the market!</span>
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error adding the offer to the market! (Even though supposedly the right market.)\n&quot;</span>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// SUCCESS!</span>
            m_pOffer = pOffer;

            m_bHasTradeActivated = <span class="keyword">true</span>;

            <span class="comment">// The Trade (stored on Cron) has a copy of the Original Offer, with the User&#39;s signature on it.</span>
            <span class="comment">// A copy of that original Trade object (itself with the user&#39;s signature) is already stored in</span>
            <span class="comment">// the cron folder (by transaction number.) This happens when the Trade is FIRST added to cron,</span>
            <span class="comment">// so it&#39;s already safe before we even get here.</span>
            <span class="comment">//</span>
            <span class="comment">// So thus I am FREE to release the signatures on the offer, and sign with the server instead.</span>
            <span class="comment">// The server-signed offer will be stored by the OTMarket.</span>
            m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
            m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*(<a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;GetServerNym()));
            m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

            pMarket-&gt;<a class="code" href="class_o_t_market.html#ad19e688ee73a7358fe343358ff3e5b8a">SaveMarket</a>();

            <span class="comment">// Now when the market loads next time, it can verify this offer using the server&#39;s signature,</span>
            <span class="comment">// instead of having to load the user. Because the server has verified it and added it, and now</span>
            <span class="comment">// signs it, vouching for it.</span>


            <span class="comment">// The Trade itself (all its other variables) are now allowed to change, since its signatures</span>
            <span class="comment">// are also released and it is now server-signed. (With a copy stored of the original.)</span>

            m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#add921a56e6ffba3fc471fdf378a7c26c">SetTrade</a>(*<span class="keyword">this</span>);

            <span class="keywordflow">return</span> m_pOffer;
        }
    }
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// It&#39;s a stop order, and not activated yet.</span>
    <span class="comment">// Should we activate it now?</span>
    <span class="comment">//</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_trade.html#ac9a572c0c92699dd2a70f04d0aad933e">IsStopOrder</a>() &amp;&amp; !m_bHasStopActivated)
    {
        int64_t lRelevantPrice = 0;

        <span class="comment">// If the stop order is trying to sell something, then it cares about the highest bidder.</span>
        <span class="keywordflow">if</span> (pOffer-&gt;<a class="code" href="class_o_t_offer.html#a02ce6c6b5157d083b06679989877b4f4">IsAsk</a>())
            lRelevantPrice = pMarket-&gt;<a class="code" href="class_o_t_market.html#af56483f0c0166de3859bdc706c071531">GetHighestBidPrice</a>();
        <span class="keywordflow">else</span> <span class="comment">// But if the stop order is trying to buy something, then it cares about the lowest ask price.</span>
            lRelevantPrice = pMarket-&gt;<a class="code" href="class_o_t_market.html#a5580893d6510e601ca3ea48164485764">GetLowestAskPrice</a>();

        <span class="comment">// It&#39;s a stop order that hasn&#39;t activated yet. SHOULD IT ACTIVATE NOW?</span>
        <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_trade.html#a532bed3d9d02a34878fb24b0ea615d1b">IsGreaterThan</a>() &amp;&amp; (lRelevantPrice &gt; <a class="code" href="class_o_t_trade.html#a2234ed0a72b48fa0749cbe89e69d5a54">GetStopPrice</a>())) ||
            (<a class="code" href="class_o_t_trade.html#ab302e2eb41c65f91118bcd208b78ed4a">IsLessThan</a>()    &amp;&amp; (lRelevantPrice &lt; <a class="code" href="class_o_t_trade.html#a2234ed0a72b48fa0749cbe89e69d5a54">GetStopPrice</a>())))
        {
            <span class="comment">// Activate the stop order!</span>
            <span class="keywordflow">if</span> (!pMarket-&gt;<a class="code" href="class_o_t_market.html#a4b79224a7214740015fcc7b1f90fa7e6">AddOffer</a>(<span class="keyword">this</span>, *pOffer, <span class="keyword">true</span>))    <span class="comment">// Since we&#39;re actually adding an offer to the market (not just</span>
            {                                               <span class="comment">// loading from disk) the we actually want to save the market.</span>
                <span class="comment">// Error adding the offer to the market!    // bSaveFile=true.</span>
                <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error adding the stop order to the market! (Even though supposedly the right market.)\n&quot;</span>);
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">// SUCCESS!</span>
                m_pOffer = pOffer;

                m_bHasStopActivated     = <span class="keyword">true</span>;
                m_bHasTradeActivated    = <span class="keyword">true</span>;

                <span class="comment">// The Trade (stored on Cron) has a copy of the Original Offer, with the User&#39;s signature on it.</span>
                <span class="comment">// A copy of that original Trade object (itself with the user&#39;s signature) is already stored in</span>
                <span class="comment">// the cron folder (by transaction number.) This happens when the Trade is FIRST added to cron,</span>
                <span class="comment">// so it&#39;s already safe before we even get here.</span>
                <span class="comment">//</span>
                <span class="comment">// So thus I am FREE to release the signatures on the offer, and sign with the server instead.</span>
                <span class="comment">// The server-signed offer will be stored by the OTMarket.</span>
                m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
                m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*(<a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>()-&gt;GetServerNym()));
                m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();

                pMarket-&gt;<a class="code" href="class_o_t_market.html#ad19e688ee73a7358fe343358ff3e5b8a">SaveMarket</a>();

                <span class="comment">// Now when the market loads next time, it can verify this offer using the server&#39;s signature,</span>
                <span class="comment">// instead of having to load the user. Because the server has verified it and added it, and now</span>
                <span class="comment">// signs it, vouching for it.</span>


                <span class="comment">// The Trade itself (all its other variables) are now allowed to change, since its signatures</span>
                <span class="comment">// are also released and it is now server-signed. (With a copy stored of the original.)</span>


                m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#add921a56e6ffba3fc471fdf378a7c26c">SetTrade</a>(*<span class="keyword">this</span>);

                <span class="keywordflow">return</span> m_pOffer;
            }
        }
    }

    <span class="keyword">delete</span> pOffer;
    pOffer = NULL;

    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a61d3d3ab221ede656fbaeb5f963e2bf3"></a><!-- doxytag: member="OTTrade::GetOfferString" ref="a61d3d3ab221ede656fbaeb5f963e2bf3" args="(OTString &amp;strOffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a61d3d3ab221ede656fbaeb5f963e2bf3">OTTrade::GetOfferString</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_string.html">OTString</a> &amp;&#160;</td>
          <td class="paramname"><em>strOffer</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00204">204</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">    { strOffer.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(m_strOffer); <span class="keywordflow">return</span> m_strOffer.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() ? <span class="keyword">true</span> : <span class="keyword">false</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a2234ed0a72b48fa0749cbe89e69d5a54"></a><!-- doxytag: member="OTTrade::GetStopPrice" ref="a2234ed0a72b48fa0749cbe89e69d5a54" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int64_t&amp; <a class="el" href="class_o_t_trade.html#a2234ed0a72b48fa0749cbe89e69d5a54">OTTrade::GetStopPrice</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00209">209</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">return</span> m_lStopPrice; }
</pre></div>
</div>
</div>
<a class="anchor" id="acc7070bba01b1e1b9dcadf1bb880083c"></a><!-- doxytag: member="OTTrade::IncrementTradesAlreadyDone" ref="acc7070bba01b1e1b9dcadf1bb880083c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#acc7070bba01b1e1b9dcadf1bb880083c">OTTrade::IncrementTradesAlreadyDone</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00223">223</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_nTradesAlreadyDone++;      }
</pre></div>
</div>
</div>
<a class="anchor" id="ac1b932456cb0a1b9af736bdb8f363cee"></a><!-- doxytag: member="OTTrade::InitTrade" ref="ac1b932456cb0a1b9af736bdb8f363cee" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">OTTrade::InitTrade</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01341">1341</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// initialization here. Sometimes also called during cleanup to zero values.</span>
    <a class="code" href="class_o_t_contract.html#ac523dac7d72b72e54b1ebb5b3a3b21cc">m_strContractType</a>   = <span class="stringliteral">&quot;TRADE&quot;</span>;

    <a class="code" href="class_o_t_cron_item.html#a7d801b85690f539433e0ccf187f57d99">SetProcessInterval</a>(<a class="code" href="_o_t_trade_8cpp.html#a39e300c287adc60eb0ac22c29112f4e5">TRADE_PROCESS_INTERVAL</a>); <span class="comment">// Trades default to processing every 10 seconds.</span>
                                                <span class="comment">// (vs 1 second for Cron items and 1 hour for payment plans)</span>

    m_nTradesAlreadyDone= 0;

    m_cStopSign     = 0;        <span class="comment">// IS THIS a STOP order? Value is 0, or &#39;&lt;&#39;, or &#39;&gt;&#39;.</span>
    m_lStopPrice    = 0;        <span class="comment">// The price limit that activates the STOP order.</span>
    m_bHasStopActivated = <span class="keyword">false</span>;<span class="comment">// Once the Stop Order activates, it puts the order on the market.</span>
                                <span class="comment">// I&#39;ll put a &quot;HasOrderOnMarket()&quot; bool method that answers this for u.</span>
    m_bHasTradeActivated = <span class="keyword">false</span>;<span class="comment">// I want to keep track of general activations as well, not just stop orders.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a532bed3d9d02a34878fb24b0ea615d1b"></a><!-- doxytag: member="OTTrade::IsGreaterThan" ref="a532bed3d9d02a34878fb24b0ea615d1b" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a532bed3d9d02a34878fb24b0ea615d1b">OTTrade::IsGreaterThan</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00211">211</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">if</span> ((m_cStopSign == <span class="charliteral">&#39;&gt;&#39;</span>)) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="keywordflow">return</span> <span class="keyword">false</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="ab302e2eb41c65f91118bcd208b78ed4a"></a><!-- doxytag: member="OTTrade::IsLessThan" ref="ab302e2eb41c65f91118bcd208b78ed4a" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#ab302e2eb41c65f91118bcd208b78ed4a">OTTrade::IsLessThan</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00212">212</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">if</span> ((m_cStopSign == <span class="charliteral">&#39;&lt;&#39;</span>)) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="keywordflow">return</span> <span class="keyword">false</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="ac9a572c0c92699dd2a70f04d0aad933e"></a><!-- doxytag: member="OTTrade::IsStopOrder" ref="ac9a572c0c92699dd2a70f04d0aad933e" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#ac9a572c0c92699dd2a70f04d0aad933e">OTTrade::IsStopOrder</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00207">207</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ <span class="keywordflow">if</span> ((m_cStopSign == <span class="charliteral">&#39;&lt;&#39;</span>) || (m_cStopSign == <span class="charliteral">&#39;&gt;&#39;</span>)) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="keywordflow">return</span> <span class="keyword">false</span>; }
</pre></div>
</div>
</div>
<a class="anchor" id="a64013127ededb1a9729aeb07ea9cadb7"></a><!-- doxytag: member="OTTrade::IssueTrade" ref="a64013127ededb1a9729aeb07ea9cadb7" args="(OTOffer &amp;theOffer, char cStopSign=0, int64_t lStopPrice=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a64013127ededb1a9729aeb07ea9cadb7">OTTrade::IssueTrade</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_offer.html">OTOffer</a> &amp;&#160;</td>
          <td class="paramname"><em>theOffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>cStopSign</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>lStopPrice</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01196">1196</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Make sure the Stop Sign is within parameters (0, &#39;&lt;&#39;, or &#39;&gt;&#39;)</span>
    <span class="keywordflow">if</span> ((cStopSign ==  0 )  ||
        (cStopSign == <span class="charliteral">&#39;&lt;&#39;</span>)  ||
        (cStopSign == <span class="charliteral">&#39;&gt;&#39;</span>))
        m_cStopSign = cStopSign;
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Bad data in Stop Sign while issuing trade: %c\n&quot;</span>, cStopSign);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// Make sure, if this IS a Stop order, that the price is within parameters and set.</span>
    <span class="keywordflow">if</span> ((m_cStopSign == <span class="charliteral">&#39;&lt;&#39;</span>)    ||
        (m_cStopSign == <span class="charliteral">&#39;&gt;&#39;</span>))
    {
        <span class="keywordflow">if</span> (0 &gt;= lStopPrice)
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Expected Stop Price for trade.\n&quot;</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        m_lStopPrice = lStopPrice;
    }

    m_nTradesAlreadyDone    = 0;

    <a class="code" href="class_o_t_cron_item.html#a7668dc44368861c09a47de0f420cf2fa">SetCreationDate</a>(<a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>()); <span class="comment">// This time is set to TODAY NOW  (OTCronItem)</span>

    <span class="comment">// ------------------------------------------------------------------------</span>

    <span class="comment">// Validate the Server ID, Asset Type ID, Currency Type ID, and Date Range.</span>
    <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>()          != theOffer.<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>())      ||
        (<a class="code" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a>()        != theOffer.<a class="code" href="class_o_t_offer.html#a3ab6eabaef2152b2f6971f01b1e51fdd">GetCurrencyID</a>())    ||
        (<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>()           != theOffer.<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>())       ||

        (theOffer.<a class="code" href="class_o_t_instrument.html#a08eb5f25566832e1a67b3e33c0dcc13f">GetValidFrom</a>() &lt;  <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>) ||
        (theOffer.<a class="code" href="class_o_t_instrument.html#ab83a62f51692c946ff394408026b0c18">GetValidTo</a>()   &lt; theOffer.<a class="code" href="class_o_t_instrument.html#a08eb5f25566832e1a67b3e33c0dcc13f">GetValidFrom</a>()) )
    {
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

<span class="comment">//  m_CURRENCY_TYPE_ID // This is already set in the constructors of this and the offer. (And compared.)</span>
<span class="comment">//  m_CURRENCY_ACCT_ID // This is already set in the constructor of this.</span>

    <span class="comment">// Set the (now validated) date range as per the Offer.</span>
    <a class="code" href="class_o_t_instrument.html#af8e356f6956ad222a1766435edca8374">SetValidFrom</a>(theOffer.<a class="code" href="class_o_t_instrument.html#a08eb5f25566832e1a67b3e33c0dcc13f">GetValidFrom</a>());
    <a class="code" href="class_o_t_instrument.html#a5baef9beffaf6627cd9d5277fdbb14c3">SetValidTo</a>(theOffer.<a class="code" href="class_o_t_instrument.html#ab83a62f51692c946ff394408026b0c18">GetValidTo</a>());

    <span class="comment">// Get the transaction number from the Offer.</span>
    <a class="code" href="class_o_t_trackable.html#a6ef06e21f2ad3616ab6b3a303662846d">SetTransactionNum</a>(theOffer.<a class="code" href="class_o_t_offer.html#abf98bb358bc9fdefc12ea474d18b6d6c">GetTransactionNum</a>());

    <span class="comment">// Save a copy of the offer, in XML form, here on this Trade.</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strOffer(theOffer);
    m_strOffer.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(strOffer);

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1bdd13967c44b74a74d9189abf980664"></a><!-- doxytag: member="OTTrade::onFinalReceipt" ref="a1bdd13967c44b74a74d9189abf980664" args="(OTCronItem &amp;theOrigCronItem, const int64_t &amp;lNewTransactionNumber, OTPseudonym &amp;theOriginator, OTPseudonym *pRemover)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#a1bdd13967c44b74a74d9189abf980664">OTTrade::onFinalReceipt</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_cron_item.html">OTCronItem</a> &amp;&#160;</td>
          <td class="paramname"><em>theOrigCronItem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t &amp;&#160;</td>
          <td class="paramname"><em>lNewTransactionNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theOriginator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> *&#160;</td>
          <td class="paramname"><em>pRemover</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#ac24d58b1aec6a6471a79f30146e7a300">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00883">883</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">const</span> <span class="keywordtype">char</span> * szFunc = <span class="stringliteral">&quot;OTTrade::onFinalReceipt&quot;</span>;
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pCron-&gt;<a class="code" href="class_o_t_cron.html#a7756d0dcc047209ca87632939dc11db3">GetServerNym</a>();
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pServerNym);
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// First, we are closing the transaction number ITSELF, of this cron item,</span>
    <span class="comment">// as an active issued number on the originating nym. (Changing it to CLOSED.)</span>
    <span class="comment">//</span>
    <span class="comment">// Second, we&#39;re verifying the CLOSING number, and using it as the closing number</span>
    <span class="comment">// on the FINAL RECEIPT (with that receipt being &quot;InReferenceTo&quot; this-&gt;GetTransactionNum())</span>
    <span class="comment">//</span>
    <span class="keyword">const</span> int64_t lOpeningNumber   = theOrigCronItem.<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>();
    <span class="comment">// ---------------------------------------------------------------------------</span>
    <span class="keyword">const</span> int64_t lClosingAssetNumber    = (theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &gt; 0) ? theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(0) : 0;
    <span class="keyword">const</span> int64_t lClosingCurrencyNumber = (theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>() &gt; 1) ? theOrigCronItem.<a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(1) : 0;
    <span class="comment">// ---------------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>());

    <span class="comment">// The marketReceipt ITEM&#39;s NOTE contains the UPDATED TRADE.</span>
    <span class="comment">// And the **UPDATED OFFER** is stored on the ATTACHMENT on the **ITEM.**</span>
    <span class="comment">//</span>
    <span class="comment">// BUT!!! This is not a marketReceipt Item, is it? ***This is a finalReceipt ITEM!***</span>
    <span class="comment">// I&#39;m reversing pstrNote and pstrAttachment for finalReceipt, with the intention of</span>
    <span class="comment">// eventually reversing them for marketReceipt as well. (Making them all in line with paymentReceipt.)</span>
    <span class="comment">//</span>
    <span class="comment">// WHY?  Because I want a standard convention:</span>
    <span class="comment">//          1. ORIGINAL (user-signed) Cron Items are always stored &quot;in reference to&quot; on cron receipts in the Inbox (an OTTransaction).</span>
    <span class="comment">//          2. The UPDATED VERSION of that same cron item (a trade or payment plan) is stored in the ATTACHMENT on the OTItem member.</span>
    <span class="comment">//          3. ADDITIONAL INFORMATION is stored in the NOTE field of the OTItem member.</span>
    <span class="comment">//</span>
    <span class="comment">// Unfortunately, marketReceipt doesn&#39;t adhere to this convention, as it stores the Updated Cron Item (the trade) in</span>
    <span class="comment">// the note instead of the attachment, and it stores the updated Offer (the additional info) in the attachment instead</span>
    <span class="comment">// of the note.</span>
    <span class="comment">// Perhaps this is for the best -- it will certainly kick out any accidental confusions between marketReceipt and finalReceipt!</span>
    <span class="comment">// todo: switch marketReceipt over to be like finalReceipt as described in this paragraph.</span>
    <span class="comment">//</span>
    <span class="comment">// Once everything is consistent on the above convention -- starting here and now with finalReceipt -- then we will ALWAYS</span>
    <span class="comment">// be able to count on a Cron Item being in the Transaction Item&#39;s Attachment! We can load it using the existing factory class,</span>
    <span class="comment">// without regard to type, KNOWING it&#39;s a cron item every time.</span>
    <span class="comment">// todo: convert marketReceipt to do the same.</span>

    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// The finalReceipt Item&#39;s ATTACHMENT contains the UPDATED Cron Item.</span>
    <span class="comment">// (With the SERVER&#39;s signature on it!)</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedCronItem(*<span class="keyword">this</span>);     <a class="code" href="class_o_t_string.html">OTString</a> * pstrAttachment   = &amp;strUpdatedCronItem; <span class="comment">// the Updated TRADE.</span>
    <a class="code" href="class_o_t_string.html">OTString</a> strUpdatedOffer;               <a class="code" href="class_o_t_string.html">OTString</a> * pstrNote         = NULL; <span class="comment">// the updated Offer (if available.)</span>

    <span class="keywordflow">if</span> (m_pOffer)
    {
        m_pOffer-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strUpdatedOffer);
        pstrNote = &amp;strUpdatedOffer;
    }

    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOrigCronItem(theOrigCronItem);

    <span class="keywordtype">bool</span> bDroppedReceiptAssetAcct       = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> bDroppedReceiptCurrencyAcct    = <span class="keyword">false</span>;
    <span class="comment">// -----------------------------------------------------------------</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *   pActualNym   = NULL; <span class="comment">// use this. DON&#39;T use theActualNym.</span>
    <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>     theActualNym;        <span class="comment">// unused unless it&#39;s really not already loaded. (use pActualNym.)</span>
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// The OPENING transaction number must still be signed-out.</span>
    <span class="comment">// It is this act of placing the final receipt, which then finally closes the opening number.</span>
    <span class="comment">// The closing number, by contrast, is not closed out until the final Receipt is ACCEPTED</span>
    <span class="comment">// (which happens in a &quot;process inbox&quot; transaction.)</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((lOpeningNumber &gt; 0) &amp;&amp;
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lOpeningNumber))
    {
        <span class="comment">// The Nym (server side) stores a list of all opening and closing cron #s.</span>
        <span class="comment">// So when the number is released from the Nym, we also take it off that list.</span>
        <span class="comment">//</span>
        std::set&lt;int64_t&gt; &amp; theIDSet = theOriginator.<a class="code" href="class_o_t_pseudonym.html#a92abc7a6b6253681f3379f135597f5a9">GetSetOpenCronItems</a>();
        theIDSet.erase(lOpeningNumber);

        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(*pServerNym, strServerID, lOpeningNumber, <span class="keyword">false</span>); <span class="comment">//bSave=false</span>
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pServerNym); <span class="comment">// forcing a save here, since multiple things have changed.</span>
        <span class="comment">// -----------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> ACTUAL_NYM_ID = <a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>();

        <span class="keywordflow">if</span> ( (NULL != pServerNym) &amp;&amp; pServerNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID) )
            pActualNym = pServerNym;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theOriginator.<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID))
            pActualNym = &amp;theOriginator;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (NULL != pRemover) &amp;&amp; pRemover-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(ACTUAL_NYM_ID) )
            pActualNym = pRemover;
        <span class="comment">// --------------------------</span>
        <span class="keywordflow">else</span>    <span class="comment">// We couldn&#39;t find the Nym among those already loaded--so we have to load</span>
        {       <span class="comment">// it ourselves (so we can update its NymboxHash value.)</span>
            theActualNym.<a class="code" href="class_o_t_pseudonym.html#a4b5f98378bb2ff1c48c5410f7283aff6">SetIdentifier</a>(ACTUAL_NYM_ID);

            <span class="keywordflow">if</span> (<span class="keyword">false</span> == theActualNym.<a class="code" href="class_o_t_pseudonym.html#aeb1c675ec72d6450e5c151d1f3eb95bf">LoadPublicKey</a>()) <span class="comment">// Note: this step may be unnecessary since we are only updating his Nymfile, not his key.</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading public key for Nym: %s. &quot;</span>
                              <span class="stringliteral">&quot;(To update his NymboxHash.) \n&quot;</span>, szFunc, strNymID.Get());
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theActualNym.<a class="code" href="class_o_t_pseudonym.html#aae8a707c7799efb6944d485be31a7c3e">VerifyPseudonym</a>() &amp;&amp; <span class="comment">// this line may be unnecessary.</span>
                     theActualNym.<a class="code" href="class_o_t_pseudonym.html#ad24db39caa89399f659f414b19903f90">LoadSignedNymfile</a>(*pServerNym)) <span class="comment">// ServerNym here is not theActualNym&#39;s identity, but merely the signer on this file.</span>
            {
                <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;%s: Loading actual Nym, since he wasn&#39;t already loaded. &quot;</span>
                               <span class="stringliteral">&quot;(To update his NymboxHash.)\n&quot;</span>, szFunc);
                pActualNym = &amp;theActualNym; <span class="comment">//  &lt;=====</span>
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="class_o_t_string.html">OTString</a> strNymID(ACTUAL_NYM_ID);
                <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure loading or verifying Actual Nym public key: %s. &quot;</span>
                              <span class="stringliteral">&quot;(To update his NymboxHash.)\n&quot;</span>, szFunc, strNymID.Get());
            }
        }
        <span class="comment">// -------------</span>

        <span class="keywordflow">if</span> (<span class="keyword">false</span> == this-&gt;<a class="code" href="class_o_t_cron_item.html#a4ed44ef1289676261061180691359bad">DropFinalReceiptToNymbox</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>(),
                                                    lNewTransactionNumber,
                                                    strOrigCronItem,
                                                    pstrNote,
                                                    pstrAttachment,
                                                    pActualNym))
        {
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure dropping receipt into nymbox.\n&quot;</span>, szFunc);
        }
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Problem verifying Opening Number when calling &quot;</span>
                      <span class="stringliteral">&quot;VerifyIssuedNum(lOpeningNumber)\n&quot;</span>, szFunc);
    }
    <span class="comment">// ***************************************************************************************</span>
    <span class="comment">// ASSET ACCT</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((lClosingAssetNumber &gt; 0) &amp;&amp;
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lClosingAssetNumber)
        )
    {
        bDroppedReceiptAssetAcct = this-&gt;<a class="code" href="class_o_t_cron_item.html#a32b2f6d524b7a0b9cacff58845b2161c">DropFinalReceiptToInbox</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>(),
                                                                 <a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>(),
                                                                 lNewTransactionNumber,
                                                                 lClosingAssetNumber, <span class="comment">// The closing transaction number to put on the receipt.</span>
                                                                 strOrigCronItem,
                                                                 pstrNote,
                                                                 pstrAttachment);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed verifying lClosingAssetNumber=theOrigCronItem.GetClosingTransactionNoAt(0)&gt;0 &amp;&amp;  &quot;</span>
                      <span class="stringliteral">&quot;theOriginator.VerifyTransactionNum(lClosingAssetNumber)\n&quot;</span>, szFunc);
    }
    <span class="comment">// ***************************************************************************************</span>
    <span class="comment">// CURRENCY ACCT</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> ((lClosingCurrencyNumber &gt; 0) &amp;&amp;
        theOriginator.<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, lClosingCurrencyNumber)
        )
    {
        bDroppedReceiptCurrencyAcct = this-&gt;<a class="code" href="class_o_t_cron_item.html#a32b2f6d524b7a0b9cacff58845b2161c">DropFinalReceiptToInbox</a>(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>(),
                                                                    <a class="code" href="class_o_t_trade.html#a9918143d418796eab01f05037ced3965">GetCurrencyAcctID</a>(),
                                                                    lNewTransactionNumber,
                                                                    lClosingCurrencyNumber, <span class="comment">// closing transaction number for the receipt.</span>
                                                                    strOrigCronItem,
                                                                    pstrNote,
                                                                    pstrAttachment);
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed verifying lClosingCurrencyNumber=theOrigCronItem.GetClosingTransactionNoAt(1)&gt;0 &quot;</span>
                      <span class="stringliteral">&quot;&amp;&amp;  theOriginator.VerifyTransactionNum(lClosingCurrencyNumber)\n&quot;</span>, szFunc);
    }
    <span class="comment">// ***************************************************************************************</span>


    <span class="comment">// the RemoveIssued call means the original transaction# (to find this cron item on cron) is now CLOSED.</span>
    <span class="comment">// But the Transaction itself is still OPEN. How? Because the CLOSING number is still signed out.</span>
    <span class="comment">// The closing number is also USED, since the NotarizePaymentPlan or NotarizeMarketOffer call, but it</span>
    <span class="comment">// remains ISSUED, until the final receipt itself is accepted during a process inbox.</span>
    <span class="comment">//</span>
<span class="comment">//    if (bDroppedReceiptAssetAcct || bDroppedReceiptCurrencyAcct)  // ASSET ACCOUNT and CURRENCY ACCOUNT</span>
<span class="comment">//    {</span>
        <span class="comment">// This part below doesn&#39;t happen until you ACCEPT the finalReceipt (when processing your inbox.)</span>
        <span class="comment">//</span>
<span class="comment">//      if (bDroppedReceiptAssetAcct)</span>
<span class="comment">//          theOriginator.RemoveIssuedNum(strServerID, lClosingAssetNumber, true); //bSave=false</span>
<span class="comment">//      else if (bDroppedReceiptCurrencyAcct)</span>
<span class="comment">//          theOriginator.RemoveIssuedNum(strServerID, lClosingCurrencyNumber, true); //bSave=false</span>
<span class="comment">//    }</span>
<span class="comment">//    else</span>
<span class="comment">//    {</span>
<span class="comment">//        OTLog::Error(&quot;OTTrade::onFinalReceipt: Failure dropping receipt into asset or currency inbox.\n&quot;);</span>
<span class="comment">//    }</span>

    <span class="comment">// QUESTION: Won&#39;t there be Cron Items that have no asset account at all?</span>
    <span class="comment">// In which case, there&#39;d be no need to drop a final receipt, but I don&#39;t think</span>
    <span class="comment">// that&#39;s the case, since you have to use a transaction number to get onto cron</span>
    <span class="comment">// in the first place.</span>
    <span class="comment">// -----------------------------------------------------------------</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="acdcc621f3bf7f2cf19cbc4bc50a70856"></a><!-- doxytag: member="OTTrade::onRemovalFromCron" ref="acdcc621f3bf7f2cf19cbc4bc50a70856" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#acdcc621f3bf7f2cf19cbc4bc50a70856">OTTrade::onRemovalFromCron</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#ad7aa9b289746ab01661997a19b1335b1">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00703">703</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_cron.html">OTCron</a> * pCron  = <a class="code" href="class_o_t_cron_item.html#af734ad5d309fcc9b4a60d40d6c30f55a">GetCron</a>();

    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pCron);

    <span class="comment">// If I don&#39;t already have an offer on the market, then I will have trouble figuring out</span>
    <span class="comment">// my SCALE, which is stored on the Offer. Therefore I will instantiate an offer (since I</span>
    <span class="comment">// store the original internally) and I will look up the scale.</span>
    <span class="comment">//</span>

    int64_t lScale = 1; <span class="comment">// todo stop hardcoding.</span>
    int64_t lTransactionNum = 0;

    <span class="keywordflow">if</span> (NULL == m_pOffer)
    {
        <span class="keywordflow">if</span> (!m_strOffer.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;OTTrade::onRemovalFromCron called with NULL m_pOffer and empty m_strOffer.\n&quot;</span>);
            <span class="keywordflow">return</span>;
        }

        <a class="code" href="class_o_t_offer.html">OTOffer</a> * pOffer = NULL;
        <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTOffer&gt;</a> theOfferAngel;

        <span class="comment">// ---------------------------</span>

        pOffer = <span class="keyword">new</span> <a class="code" href="class_o_t_offer.html">OTOffer</a>();
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pOffer);
        theOfferAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pOffer);

        <span class="comment">// --------------------------------------------------</span>

        <span class="comment">// Trying to load the offer from the trader&#39;s original signed request</span>
        <span class="comment">// (So I can use it to lookup the Market ID, so I can see if the offer is</span>
        <span class="comment">// already there on the market.)</span>
        <span class="keywordflow">if</span> (!pOffer-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(m_strOffer))
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error loading offer from string in OTTrade::onRemovalFromCron\n&quot;</span>);
            <span class="keywordflow">return</span>;
        }

        lScale = pOffer-&gt;<a class="code" href="class_o_t_offer.html#ab8ecbbe501cfa19e8c0726b815f27a9e">GetScale</a>();
        lTransactionNum = pOffer-&gt;<a class="code" href="class_o_t_offer.html#abf98bb358bc9fdefc12ea474d18b6d6c">GetTransactionNum</a>();
    }
    <span class="keywordflow">else</span>
    {
        lScale = m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#ab8ecbbe501cfa19e8c0726b815f27a9e">GetScale</a>();
        lTransactionNum = m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#abf98bb358bc9fdefc12ea474d18b6d6c">GetTransactionNum</a>();
    }

    <span class="comment">// -----------------------------------------------------------</span>

    <a class="code" href="class_o_t_market.html">OTMarket</a> * pMarket = pCron-&gt;<a class="code" href="class_o_t_cron.html#af4fa1a950a600220ac5e570b58e892ff">GetOrCreateMarket</a>(<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>(), <a class="code" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a>(), lScale);

    <span class="comment">// Couldn&#39;t find (or create) the market.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL == pMarket)
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Unable to find market within requested parameters in OTTrade::onRemovalFromCron.\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// -----------------------------------------------------------</span>
    <span class="comment">//</span>
    <span class="comment">// Let&#39;s see if the offer is ALREADY allocated and on this market!</span>
    <span class="comment">//</span>
    <a class="code" href="class_o_t_offer.html">OTOffer</a> * pMarketOffer = pMarket-&gt;<a class="code" href="class_o_t_market.html#a61f96f7d546012fd290307d519214088">GetOffer</a>(lTransactionNum);

    <span class="comment">// The Offer is already on the Market.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (NULL != pMarketOffer)
    {
        m_pOffer = pMarketOffer;

        m_pOffer-&gt;<a class="code" href="class_o_t_offer.html#add921a56e6ffba3fc471fdf378a7c26c">SetTrade</a>(*<span class="keyword">this</span>);
    }

    <span class="comment">// -----------------------------------------------------------</span>

    pMarket-&gt;<a class="code" href="class_o_t_market.html#a8c35cf47acba612a33c8aad9a96a0945">RemoveOffer</a>(lTransactionNum);

    <span class="comment">// -----------------------------------------------------------</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a7ae6755bab2bbc60c5badb9043285d"></a><!-- doxytag: member="OTTrade::ProcessCron" ref="a7a7ae6755bab2bbc60c5badb9043285d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a7a7ae6755bab2bbc60c5badb9043285d">OTTrade::ProcessCron</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#afe5c6a9af86b637fd8b2b3459825565b">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01092">1092</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// Right now Cron is called 10 times per second.</span>
    <span class="comment">// I&#39;m going to slow down all trades so they are once every GetProcessInterval()</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#ad8f19edf794a54644ed4822d0bc120a4">GetLastProcessDate</a>() &gt; <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>)
    {
        <span class="comment">// (Default ProcessInterval is 1 second, but Trades will use 10 seconds,</span>
        <span class="comment">// and Payment Plans will use an hour or day.)</span>
        <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#a4c78edddfcabfde278fafe43149f027e">OTTimeGetTimeInterval</a>(<a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>(), <a class="code" href="class_o_t_cron_item.html#ad8f19edf794a54644ed4822d0bc120a4">GetLastProcessDate</a>()) &lt;= <a class="code" href="class_o_t_cron_item.html#a39dce8a744a7dc6914e130bdde334a97">GetProcessInterval</a>())
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// Keep a record of the last time this was processed.</span>
    <span class="comment">// (NOT saved to storage, only used while the software is running.)</span>
    <span class="comment">// (Thus no need to release signatures, sign contract, save contract, etc.)</span>
    <a class="code" href="class_o_t_cron_item.html#aac4ad32d864f5b6e8ce07a28432bf1ef">SetLastProcessDate</a>(<a class="code" href="_o_t_common_8hpp.html#a1163606b2546b160d50c5f0a5afe479a">OTTimeGetCurrentTime</a>());
    <span class="comment">// -----------------------------------------------------------------</span>
    <span class="comment">// PAST END DATE?</span>
    <span class="comment">// First call the parent&#39;s version (which this overrides) so it has</span>
    <span class="comment">// a chance to check its stuff. Currently it checks IsExpired().</span>
    <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_cron_item.html#afe5c6a9af86b637fd8b2b3459825565b">ot_super::ProcessCron</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// It&#39;s expired or flagged for removal--remove it from Cron.</span>
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// You might ask, why not check here if this trade is flagged for removal?</span>
    <span class="comment">// Supposedly the answer is, because it&#39;s only below that I have the market pointer,</span>
    <span class="comment">// and am able to remove the corresponding trade from the market.</span>
    <span class="comment">// Therefore I am adding a hook for &quot;onRemoval&quot; so that Objects such as OTTrade ALWAYS</span>
    <span class="comment">// have the opportunity to perform such cleanup, without having to juggle such logic.</span>
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// REACHED START DATE?</span>
    <span class="comment">// Okay, so it&#39;s not expired. But might not have reached START DATE yet...</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_instrument.html#a8a90b4e37984058d8e6fb836311c5dd9">VerifyCurrentDate</a>())
        <span class="keywordflow">return</span> <span class="keyword">true</span>;    <span class="comment">// The Trade is not yet valid, so we return. BUT, we return</span>
                        <span class="comment">//  true, so it will stay on Cron until it BECOMES valid.</span>
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// TRADE-specific stuff below.</span>

    <span class="keywordtype">bool</span> bStayOnMarket = <span class="keyword">true</span>; <span class="comment">// by default stay on the market (until some rule expires me.)</span>

    <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> OFFER_MARKET_ID;
    <a class="code" href="class_o_t_market.html">OTMarket</a> * pMarket = NULL;
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// If the Offer is already active on a market, then I already have a pointer to</span>
    <span class="comment">// it. This function returns that pointer. If NULL, it tries to find the offer on</span>
    <span class="comment">// the market and then sets the pointer and returns. If it can&#39;t find it, IT TRIES</span>
    <span class="comment">// TO ADD IT TO THE MARKET and sets the pointer and returns it.</span>
    <a class="code" href="class_o_t_offer.html">OTOffer</a> * pOffer = <a class="code" href="class_o_t_trade.html#a6646cc5a3fb798d1fca122161e870281">GetOffer</a>(&amp;OFFER_MARKET_ID, &amp;pMarket); <span class="comment">// Both of these parameters are optional.</span>
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// In this case, the offer is NOT on the market.</span>
    <span class="comment">// Perhaps it wasn&#39;t ready to activate yet.</span>
    <span class="keywordflow">if</span> (NULL == pOffer)
    {
        <span class="comment">// The offer SHOULD HAVE been on the market, since we&#39;re within the valid range,</span>
        <span class="comment">// and GetOffer adds it when it&#39;s not already there.</span>

<span class="comment">//      OTLog::Error(&quot;OTTrade::ProcessCron: Offer SHOULD have been on Market. I might ASSERT this.\n&quot;); // comment this out</span>

        <span class="comment">// Actually! If it&#39;s a Stop Order, then it WOULD be within the valid range, yet would</span>
        <span class="comment">// not yet have activated. So I don&#39;t want to log some big error every time a stop order</span>
        <span class="comment">// checks its prices.</span>
    }
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pMarket)
    {
        <span class="comment">//todo. (This will already leave a log above in GetOffer somewhere.)</span>
<span class="comment">//      OTLog::Error(&quot;OTTrade::ProcessCron: Market was NULL.\n&quot;); // comment this out</span>
    }
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="keywordflow">else</span>  <span class="comment">// If a valid pointer was returned, that means the offer is on the market.</span>
    {
        <span class="comment">// Make sure it hasn&#39;t already been flagged by someone else...</span>
        <span class="keywordflow">if</span> (this-&gt;<a class="code" href="class_o_t_cron_item.html#a5fd32eb6600ee9740e5e99acebcaa2d8">IsFlaggedForRemoval</a>())    <span class="comment">// This is checked above in OTCronItem::ProcessCron().</span>
            bStayOnMarket = <span class="keyword">false</span>;          <span class="comment">// I&#39;m leaving the check here in case the flag was set since then.</span>
        <span class="comment">// ---------------------------------------</span>
        <span class="keywordflow">else</span> <span class="comment">// Process it!  &lt;===================</span>
        {
            <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;Processing trade: %lld.\n&quot;</span>, <a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());

            bStayOnMarket = pMarket-&gt;<a class="code" href="class_o_t_market.html#a6979d1c25675e7f25e3b1ae4cfc546a1">ProcessTrade</a>(*<span class="keyword">this</span>, *pOffer);
            <span class="comment">// No need to save the Trade or Offer, since they will</span>
            <span class="comment">// be saved inside this call if they are changed.</span>
        }
    }
    <span class="comment">// ----------------------------------------------------------------</span>
    <span class="comment">// Return True if I should stay on the Cron list for more processing.</span>
    <span class="comment">// Return False if I should be removed and deleted.</span>
    <span class="keywordflow">return</span> bStayOnMarket; <span class="comment">// defaults true, so if false, that means someone is removing it for a reason.</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab62bbaf94b2df5b01c52d988e023ae8b"></a><!-- doxytag: member="OTTrade::ProcessXMLNode" ref="ab62bbaf94b2df5b01c52d988e023ae8b" args="(irr::io::IrrXMLReader *&amp;xml)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_o_t_trade.html#ab62bbaf94b2df5b01c52d988e023ae8b">OTTrade::ProcessXMLNode</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceirr_1_1io.html#a1628edbb9d5d53f18c82d2a92b0ad27e">irr::io::IrrXMLReader</a> *&amp;&#160;</td>
          <td class="paramname"><em>xml</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#a6b7eec23353a8ed49ee40a742c391aa3">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00184">184</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    int32_t nReturnVal = 0;

    <span class="comment">// Here we call the parent class first.</span>
    <span class="comment">// If the node is found there, or there is some error,</span>
    <span class="comment">// then we just return either way.  But if it comes back</span>
    <span class="comment">// as &#39;0&#39;, then nothing happened, and we&#39;ll continue executing.</span>
    <span class="comment">//</span>
    <span class="comment">// -- Note you can choose not to call the parent if</span>
    <span class="comment">// you don&#39;t want to use any of those xml tags.</span>
    <span class="comment">// As I do below, in the case of OTAccount.</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (0 != (nReturnVal = <a class="code" href="class_o_t_cron_item.html#a6b7eec23353a8ed49ee40a742c391aa3">ot_super::ProcessXMLNode</a>(xml)))
        <span class="keywordflow">return</span> nReturnVal;


    <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;trade&quot;</span>, xml-&gt;getNodeName()))
    {
        <a class="code" href="class_o_t_contract.html#aa0d889e0e1670b56fedca245041a5ed3">m_strVersion</a>         =      xml-&gt;getAttributeValue(<span class="stringliteral">&quot;version&quot;</span>);
        m_nTradesAlreadyDone = atoi(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;completedNoTrades&quot;</span>));
        <span class="comment">// ---------------------------------------------------------------</span>
        <a class="code" href="class_o_t_trackable.html#a6ef06e21f2ad3616ab6b3a303662846d">SetTransactionNum</a>(  atol(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;transactionNum&quot;</span>)) );
        <span class="comment">// ---------------------------------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> str_creation   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;creationDate&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> str_valid_from = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;validFrom&quot;</span>);
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> str_valid_to   = xml-&gt;getAttributeValue(<span class="stringliteral">&quot;validTo&quot;</span>);

        int64_t tCreation  = str_creation.<a class="code" href="class_o_t_string.html#a18ca8f42f6e90ab7801c019611d9dca8">ToLong</a>();
        int64_t tValidFrom = str_valid_from.<a class="code" href="class_o_t_string.html#a18ca8f42f6e90ab7801c019611d9dca8">ToLong</a>();
        int64_t tValidTo   = str_valid_to.<a class="code" href="class_o_t_string.html#a18ca8f42f6e90ab7801c019611d9dca8">ToLong</a>();

        <a class="code" href="class_o_t_cron_item.html#a7668dc44368861c09a47de0f420cf2fa">SetCreationDate</a>(<a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(tCreation));
        <a class="code" href="class_o_t_instrument.html#af8e356f6956ad222a1766435edca8374">SetValidFrom</a>(<a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(tValidFrom));
        <a class="code" href="class_o_t_instrument.html#a5baef9beffaf6627cd9d5277fdbb14c3">SetValidTo</a>(<a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(tValidTo));
        <span class="comment">// ---------------------------------------------------------------</span>
        <a class="code" href="class_o_t_string.html">OTString</a> strActivated(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;hasActivated&quot;</span>));

        <span class="keywordflow">if</span> (strActivated.Compare(<span class="stringliteral">&quot;true&quot;</span>))
            m_bHasTradeActivated = <span class="keyword">true</span>;
        <span class="keywordflow">else</span>
            m_bHasTradeActivated = <span class="keyword">false</span>;
        <span class="comment">// ---------------------------------------------------------------</span>
        <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strServerID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;serverID&quot;</span>)),
                        strUserID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;userID&quot;</span>)),
                        strAssetTypeID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;assetTypeID&quot;</span>)),
                        strAssetAcctID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;assetAcctID&quot;</span>)),
                        strCurrencyTypeID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;currencyTypeID&quot;</span>)),
                        strCurrencyAcctID(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;currencyAcctID&quot;</span>));

        <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  SERVER_ID(strServerID),                 USER_ID(strUserID),
                            ASSET_TYPE_ID(strAssetTypeID),          ASSET_ACCT_ID(strAssetAcctID),
                            CURRENCY_TYPE_ID(strCurrencyTypeID),    CURRENCY_ACCT_ID(strCurrencyAcctID);

        <a class="code" href="class_o_t_instrument.html#a80fc5560fdedf911ec0c184ab9fbb5b7">SetServerID</a>(SERVER_ID);
        <a class="code" href="class_o_t_trackable.html#a689cca3d471d7e85bec084d302f3cd83">SetSenderUserID</a>(USER_ID);
        <a class="code" href="class_o_t_instrument.html#a155933617602731fc5d1ff459961dc24">SetAssetID</a>(ASSET_TYPE_ID);
        <a class="code" href="class_o_t_trackable.html#a75814babcec8eb5cfed15047d4dfb4f6">SetSenderAcctID</a>(ASSET_ACCT_ID);
        <a class="code" href="class_o_t_trade.html#aecec352539c0f5e77eb7a08eb6353836">SetCurrencyID</a>(CURRENCY_TYPE_ID);
        <a class="code" href="class_o_t_trade.html#a6451298536ecc98329c371e00263f741">SetCurrencyAcctID</a>(CURRENCY_ACCT_ID);
        <span class="comment">// ---------------------------------------------------------------</span>
        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3, <span class="stringliteral">&quot;\n\nTrade. Transaction Number: %lld   Completed # of Trades: %d\n&quot;</span>,
                       <a class="code" href="class_o_t_trackable.html#a90bc18f9b5d6b3c8059a83685b86674e">m_lTransactionNum</a>, m_nTradesAlreadyDone);

        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1,
                       <span class="stringliteral">&quot; Creation Date: %&quot;</span> PRId64<span class="stringliteral">&quot;   Valid From: %&quot;</span> PRId64<span class="stringliteral">&quot;\n Valid To: %&quot;</span> PRId64<span class="stringliteral">&quot;\n&quot;</span>
                       <span class="stringliteral">&quot; assetTypeID: %s\n assetAcctID: %s\n&quot;</span>
                       <span class="stringliteral">&quot; ServerID: %s\n UserID: %s\n &quot;</span>
                       <span class="stringliteral">&quot; currencyTypeID: %s\n currencyAcctID: %s\n &quot;</span>,
                       tCreation, tValidFrom, tValidTo,
                       strAssetTypeID.Get(), strAssetAcctID.Get(),
                       strServerID.Get(), strUserID.Get(),
                       strCurrencyTypeID.Get(), strCurrencyAcctID.Get());

        nReturnVal = 1;
    }

    <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;stopOrder&quot;</span>, xml-&gt;getNodeName()))
    {
        <a class="code" href="class_o_t_string.html">OTString</a> strSign(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;sign&quot;</span>));

        <span class="keywordflow">if</span> (strSign.Compare(<span class="stringliteral">&quot;0&quot;</span>))
        {
            m_cStopSign = 0; <span class="comment">// Zero means it isn&#39;t a stop order. So why is the tag in the file?</span>
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Strange: Stop order tag found in trade, but sign character set to 0.\n&quot;</span>
                          <span class="stringliteral">&quot;(Zero means: NOT a stop order.)\n&quot;</span>, strSign.Get());
            <span class="keywordflow">return</span> (-1);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strSign.Compare(<span class="stringliteral">&quot;&lt;&quot;</span>))
            m_cStopSign = <span class="charliteral">&#39;&lt;&#39;</span>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strSign.Compare(<span class="stringliteral">&quot;&gt;&quot;</span>))
            m_cStopSign = <span class="charliteral">&#39;&gt;&#39;</span>;
        <span class="keywordflow">else</span>
        {
            m_cStopSign = 0;
            <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;Unexpected or nonexistent value in stop order sign: %s\n&quot;</span>, strSign.Get());
            <span class="keywordflow">return</span> (-1);
        }
        <span class="comment">// ---------------------</span>

        <span class="comment">// Now we know the sign is properly formed, let&#39;s grab the price value.</span>

        m_lStopPrice = atol(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;price&quot;</span>));

        <span class="comment">// ---------------------</span>

        <a class="code" href="class_o_t_string.html">OTString</a> strActivated(xml-&gt;getAttributeValue(<span class="stringliteral">&quot;hasActivated&quot;</span>));

        <span class="keywordflow">if</span> (strActivated.Compare(<span class="stringliteral">&quot;true&quot;</span>))
            m_bHasStopActivated = <span class="keyword">true</span>;
        <span class="keywordflow">else</span>
            m_bHasStopActivated = <span class="keyword">false</span>;

        <span class="comment">// ---------------------</span>

        <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(3,
                       <span class="stringliteral">&quot;\n\nStop order -- %s when price %s %s: %lld.\n&quot;</span>,
                       (m_bHasStopActivated ? <span class="stringliteral">&quot;Already activated&quot;</span> : <span class="stringliteral">&quot;Will activate&quot;</span>),
                       (m_bHasStopActivated ? <span class="stringliteral">&quot;was&quot;</span> : <span class="stringliteral">&quot;reaches&quot;</span>),
                       ((<span class="charliteral">&#39;&lt;&#39;</span> == m_cStopSign) ? <span class="stringliteral">&quot;LESS THAN&quot;</span> : <span class="stringliteral">&quot;GREATER THAN&quot;</span>),
                       m_lStopPrice);

        nReturnVal = 1;
    }

    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;offer&quot;</span>, xml-&gt;getNodeName()))
    {
        <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_contract.html#a72ffe11fdcf2f6e3566afa9061241f30">OTContract::LoadEncodedTextField</a>(xml, m_strOffer))
        {
            <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Error in OTTrade::ProcessXMLNode: offer field without value.\n&quot;</span>);
            <span class="keywordflow">return</span> (-1); <span class="comment">// error condition</span>
        }

        nReturnVal = 1;
    }

    <span class="keywordflow">return</span> nReturnVal;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a677d2b33af8117fb681b52e20a4baaff"></a><!-- doxytag: member="OTTrade::Release" ref="a677d2b33af8117fb681b52e20a4baaff" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#a677d2b33af8117fb681b52e20a4baaff">OTTrade::Release</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_cron_item.html#a11e9851acefc9162bb5f107a1952ffb7">OTCronItem</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01328">1328</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_trade.html#a7649c698b39d19d956586e00bf32c6b3">Release_Trade</a>();

    <a class="code" href="class_o_t_cron_item.html#a11e9851acefc9162bb5f107a1952ffb7">ot_super::Release</a>();

    <span class="comment">// Then I call this to re-initialize everything</span>
    <span class="comment">// (Only cause it&#39;s convenient...)</span>
    <a class="code" href="class_o_t_trade.html#ac1b932456cb0a1b9af736bdb8f363cee">InitTrade</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7649c698b39d19d956586e00bf32c6b3"></a><!-- doxytag: member="OTTrade::Release_Trade" ref="a7649c698b39d19d956586e00bf32c6b3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#a7649c698b39d19d956586e00bf32c6b3">OTTrade::Release_Trade</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01317">1317</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// If there were any dynamically allocated objects, clean them up here.</span>
    m_CURRENCY_TYPE_ID.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();
    m_CURRENCY_ACCT_ID.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

    m_strOffer.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a635d7f83beaa3885856900727a457835"></a><!-- doxytag: member="OTTrade::SaveContractWallet" ref="a635d7f83beaa3885856900727a457835" args="(std::ofstream &amp;ofs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a635d7f83beaa3885856900727a457835">OTTrade::SaveContractWallet</a> </td>
          <td>(</td>
          <td class="paramtype">std::ofstream &amp;&#160;</td>
          <td class="paramname"><em>ofs</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_trackable.html#a85b7622124dd3d103cb50498cddac2b2">OTTrackable</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l01359">1359</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6451298536ecc98329c371e00263f741"></a><!-- doxytag: member="OTTrade::SetCurrencyAcctID" ref="a6451298536ecc98329c371e00263f741" args="(const OTIdentifier &amp;CURRENCY_ACCT_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#a6451298536ecc98329c371e00263f741">OTTrade::SetCurrencyAcctID</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>CURRENCY_ACCT_ID</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00221">221</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_CURRENCY_ACCT_ID = CURRENCY_ACCT_ID; }
</pre></div>
</div>
</div>
<a class="anchor" id="aecec352539c0f5e77eb7a08eb6353836"></a><!-- doxytag: member="OTTrade::SetCurrencyID" ref="aecec352539c0f5e77eb7a08eb6353836" args="(const OTIdentifier &amp;CURRENCY_ID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#aecec352539c0f5e77eb7a08eb6353836">OTTrade::SetCurrencyID</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_identifier.html">OTIdentifier</a> &amp;&#160;</td>
          <td class="paramname"><em>CURRENCY_ID</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8hpp_source.html#l00218">218</a> of file <a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a>.</p>
<div class="fragment"><pre class="fragment">{ m_CURRENCY_TYPE_ID = CURRENCY_ID; }
</pre></div>
</div>
</div>
<a class="anchor" id="ab72fd44769391a80946e0cd51c9bd194"></a><!-- doxytag: member="OTTrade::UpdateContents" ref="ab72fd44769391a80946e0cd51c9bd194" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_trade.html#ab72fd44769391a80946e0cd51c9bd194">OTTrade::UpdateContents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_trackable.html#ae708d31ab5dca7a4dff24b0534fec889">OTTrackable</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00324">324</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// I release this because I&#39;m about to repopulate it.</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();

    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;?xml version=\&quot;%s\&quot;?&gt;\n\n&quot;</span>, <span class="stringliteral">&quot;1.0&quot;</span>);
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  SERVER_ID(<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>()),           USER_ID(<a class="code" href="class_o_t_trackable.html#aaf5d36407abeeb35eea54f7acb0c3148">GetSenderUserID</a>()),
                    ASSET_TYPE_ID(<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>()),        ASSET_ACCT_ID(<a class="code" href="class_o_t_trackable.html#a3149b0da54958e8da4cf15d26f47711f">GetSenderAcctID</a>()),
                    CURRENCY_TYPE_ID(<a class="code" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a>()),  CURRENCY_ACCT_ID(<a class="code" href="class_o_t_trade.html#a9918143d418796eab01f05037ced3965">GetCurrencyAcctID</a>());

    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;trade\n version=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; hasActivated=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; serverID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; assetTypeID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; assetAcctID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; currencyTypeID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; currencyAcctID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; userID=\&quot;%s\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; completedNoTrades=\&quot;%d\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; transactionNum=\&quot;%lld\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; creationDate=\&quot;%&quot;</span> PRId64<span class="stringliteral">&quot;\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; validFrom=\&quot;%&quot;</span> PRId64<span class="stringliteral">&quot;\&quot;\n&quot;</span>
                              <span class="stringliteral">&quot; validTo=\&quot;%&quot;</span> PRId64<span class="stringliteral">&quot;\&quot;&quot;</span>
                              <span class="stringliteral">&quot; &gt;\n\n&quot;</span>,
                              <a class="code" href="class_o_t_contract.html#aa0d889e0e1670b56fedca245041a5ed3">m_strVersion</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(),
                              (m_bHasTradeActivated ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>),
                              SERVER_ID.Get(),
                              ASSET_TYPE_ID.Get(),
                              ASSET_ACCT_ID.Get(),
                              CURRENCY_TYPE_ID.Get(),
                              CURRENCY_ACCT_ID.Get(),
                              USER_ID.Get(),
                              m_nTradesAlreadyDone,
                              <a class="code" href="class_o_t_trackable.html#a90bc18f9b5d6b3c8059a83685b86674e">m_lTransactionNum</a>,
                              <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_cron_item.html#aec36ac68b9f13f874ce6c56940bcec24">GetCreationDate</a>()),
                              <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_instrument.html#a08eb5f25566832e1a67b3e33c0dcc13f">GetValidFrom</a>()),
                              <a class="code" href="_o_t_common_8hpp.html#a4c31551b478d298d694f7df4915b4302">OTTimeGetSecondsFromTime</a>(<a class="code" href="class_o_t_instrument.html#ab83a62f51692c946ff394408026b0c18">GetValidTo</a>()));
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="comment">// There are &quot;closing&quot; transaction numbers, used to CLOSE a transaction.</span>
    <span class="comment">// Often where Cron items are involved such as this payment plan, or in baskets,</span>
    <span class="comment">// where many asset accounts are involved and require receipts to be closed out.</span>

    <span class="keywordflow">for</span> (int32_t i = 0; i &lt; <a class="code" href="class_o_t_cron_item.html#a96d3ae7898526a317dd503daecbf10af">GetCountClosingNumbers</a>(); i++)
    {
        int64_t lClosingNumber = <a class="code" href="class_o_t_cron_item.html#ab4bd4e606ddbb49d3f36248f18391ec1">GetClosingTransactionNoAt</a>(i);
        <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(lClosingNumber &gt; 0);

        <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;closingTransactionNumber value=\&quot;%lld\&quot;/&gt;\n\n&quot;</span>,
                                  lClosingNumber);

    }
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keywordflow">if</span> ((<span class="charliteral">&#39;&lt;&#39;</span> == m_cStopSign) || (<span class="charliteral">&#39;&gt;&#39;</span> == m_cStopSign))
    {
        <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;stopOrder\n&quot;</span>
                                  <span class="stringliteral">&quot; hasActivated=\&quot;%s\&quot;\n&quot;</span>
                                  <span class="stringliteral">&quot; sign=\&quot;%c\&quot;\n&quot;</span>
                                  <span class="stringliteral">&quot; price=\&quot;%lld\&quot;&quot;</span>
                                  <span class="stringliteral">&quot; /&gt;\n\n&quot;</span>,
                                  (m_bHasStopActivated ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>),
                                  m_cStopSign,
                                  m_lStopPrice);
    }
    <span class="comment">// -------------------------------------------------------------</span>
    <span class="keywordflow">if</span> (m_strOffer.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
    {
        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> ascOffer(m_strOffer);
        <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;offer&gt;\n%s&lt;/offer&gt;\n\n&quot;</span>, ascOffer.Get());
    }
    <span class="comment">// -------------------------------------------------------------</span>
    <a class="code" href="class_o_t_contract.html#a087fc09cfa4b2fd9076088360a5e5039">m_xmlUnsigned</a>.<a class="code" href="class_o_t_string.html#a86e54de385040ff6769d7f2149ce176b">Concatenate</a>(<span class="stringliteral">&quot;&lt;/trade&gt;\n&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a821c6861fd2da5ebd81f7b9d078c8af7"></a><!-- doxytag: member="OTTrade::VerifyNymAsAgent" ref="a821c6861fd2da5ebd81f7b9d078c8af7" args="(OTPseudonym &amp;theNym, OTPseudonym &amp;theSignerNym, mapOfNyms *pmap_ALREADY_LOADED=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a821c6861fd2da5ebd81f7b9d078c8af7">OTTrade::VerifyNymAsAgent</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theSignerNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_o_t_agent_8hpp.html#ac89892658f6bc83e354078647b704e8f">mapOfNyms</a> *&#160;</td>
          <td class="paramname"><em>pmap_ALREADY_LOADED</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_scriptable.html#a242f30ff4c6deccf285930efa15638eb">OTScriptable</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00167">167</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> this-&gt;<a class="code" href="class_o_t_contract.html#a38f51d593b6dfc8a75d1c5a535965392">VerifySignature</a>(theNym);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1bb54a55733cfe8a996f58b6b43f216"></a><!-- doxytag: member="OTTrade::VerifyNymAsAgentForAccount" ref="ab1bb54a55733cfe8a996f58b6b43f216" args="(OTPseudonym &amp;theNym, OTAccount &amp;theAccount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#ab1bb54a55733cfe8a996f58b6b43f216">OTTrade::VerifyNymAsAgentForAccount</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_pseudonym.html">OTPseudonym</a> &amp;&#160;</td>
          <td class="paramname"><em>theNym</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_o_t_account.html">OTAccount</a> &amp;&#160;</td>
          <td class="paramname"><em>theAccount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="class_o_t_scriptable.html#a844de5b0eb2560a28bf795c2c4da3f3b">OTScriptable</a>.</p>

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00177">177</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> theAccount.<a class="code" href="class_o_t_account.html#a73c89c2d411eb7b88326baf87802f238">VerifyOwner</a>(theNym);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6327be5c41af7a34dd3912b8d17947e0"></a><!-- doxytag: member="OTTrade::VerifyOffer" ref="a6327be5c41af7a34dd3912b8d17947e0" args="(OTOffer &amp;theOffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_trade.html#a6327be5c41af7a34dd3912b8d17947e0">OTTrade::VerifyOffer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_offer.html">OTOffer</a> &amp;&#160;</td>
          <td class="paramname"><em>theOffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_trade_8cpp_source.html#l00407">407</a> of file <a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// At this point, I have a working, loaded, model of the Offer.</span>
    <span class="comment">// Let&#39;s verify the thing.</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>() != theOffer.<a class="code" href="class_o_t_offer.html#abf98bb358bc9fdefc12ea474d18b6d6c">GetTransactionNum</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;While verifying offer, failed matching transaction number.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>() != theOffer.<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;While verifying offer, failed matching Server ID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>() != theOffer.<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;While verifying offer, failed matching asset type ID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_trade.html#a1a8b6c31bb210b4f5df3d5bfca8efa9b">GetCurrencyID</a>() != theOffer.<a class="code" href="class_o_t_offer.html#a3ab6eabaef2152b2f6971f01b1e51fdd">GetCurrencyID</a>())
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;While verifying offer, failed matching currency type ID.\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// -------------------------------------------------</span>
    <span class="comment">// the Offer validates properly for this Trade.</span>
    <span class="comment">//</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_trade_8hpp_source.html">OTTrade.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_trade_8cpp_source.html">OTTrade.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_trade.html">OTTrade</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:17 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
