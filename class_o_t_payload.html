<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: OTPayload Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_o_t_payload.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OTPayload Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="OTPayload" --><!-- doxytag: inherits="OTData" -->
<p><code>#include &lt;<a class="el" href="_o_t_payload_8hpp_source.html">OTPayload.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTPayload:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_o_t_payload.png" usemap="#OTPayload_map" alt=""/>
  <map id="OTPayload_map" name="OTPayload_map">
<area href="class_o_t_data.html" alt="OTData" shape="rect" coords="0,0,75,24"/>
</map>
 </div></div>

<p><a href="class_o_t_payload-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#ad2569c3111dfc34327f6ccff49cb836a">OTPayload</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a849901deda6780c35a5fc3648b1f8f11">OTPayload</a> (const void *pNewData, uint32_t nNewSize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#ad1e36f78d224781703f808dd2224b4fe">OTPayload</a> (const <a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;rhs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#ae7d17b7e27f33ca211eee1234d37f05d">OTPayload</a> (const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;theSource)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual EXPORT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a43708e6d31ec44db066ee3ba08ed0604">~OTPayload</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a6acf2a994ed13798718519547e9431fd">ReadBytesFrom</a> (<a class="el" href="class_o_t_data.html">OTData</a> &amp;theData, uint32_t lSize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a> (uint32_t lNewSize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT const void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a2d099c964588c0c1d251992733ac9b5b">SetMessagePayload</a> (const <a class="el" href="class_o_t_message.html">OTMessage</a> &amp;theMessage)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#aa26daa2e7d1d86b88686ecf8431535c5">GetMessagePayload</a> (<a class="el" href="class_o_t_message.html">OTMessage</a> &amp;theMessage) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#af2c079778a1809964c6e2f138e4d6819">GetEnvelope</a> (<a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;theEnvelope) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">EXPORT bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_t_payload.html#a1a5fa31f9c665b99d9d1b96bd20944e3">SetEnvelope</a> (const <a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;theEnvelope)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_o_t_payload_8hpp_source.html#l00145">145</a> of file <a class="el" href="_o_t_payload_8hpp_source.html">OTPayload.hpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad2569c3111dfc34327f6ccff49cb836a"></a><!-- doxytag: member="OTPayload::OTPayload" ref="ad2569c3111dfc34327f6ccff49cb836a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payload.html#ad2569c3111dfc34327f6ccff49cb836a">OTPayload::OTPayload</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00143">143</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                     : <a class="code" href="class_o_t_data.html#a4612d93cff0084014eede4e536f0b082">OTData</a>()
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="a849901deda6780c35a5fc3648b1f8f11"></a><!-- doxytag: member="OTPayload::OTPayload" ref="a849901deda6780c35a5fc3648b1f8f11" args="(const void *pNewData, uint32_t nNewSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payload.html#ad2569c3111dfc34327f6ccff49cb836a">OTPayload::OTPayload</a> </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>pNewData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nNewSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00149">149</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                             : <a class="code" href="class_o_t_data.html#a4612d93cff0084014eede4e536f0b082">OTData</a>(pNewData, nNewSize)
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="ad1e36f78d224781703f808dd2224b4fe"></a><!-- doxytag: member="OTPayload::OTPayload" ref="ad1e36f78d224781703f808dd2224b4fe" args="(const OTPayload &amp;rhs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payload.html#ad2569c3111dfc34327f6ccff49cb836a">OTPayload::OTPayload</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_payload.html">OTPayload</a> &amp;&#160;</td>
          <td class="paramname"><em>rhs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00155">155</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                          : <a class="code" href="class_o_t_data.html#a4612d93cff0084014eede4e536f0b082">OTData</a>(rhs)
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="ae7d17b7e27f33ca211eee1234d37f05d"></a><!-- doxytag: member="OTPayload::OTPayload" ref="ae7d17b7e27f33ca211eee1234d37f05d" args="(const OTASCIIArmor &amp;theSource)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payload.html#ad2569c3111dfc34327f6ccff49cb836a">OTPayload::OTPayload</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp;&#160;</td>
          <td class="paramname"><em>theSource</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00161">161</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                   : <a class="code" href="class_o_t_data.html#a4612d93cff0084014eede4e536f0b082">OTData</a>(theSource)
{

}
</pre></div>
</div>
</div>
<a class="anchor" id="a43708e6d31ec44db066ee3ba08ed0604"></a><!-- doxytag: member="OTPayload::~OTPayload" ref="a43708e6d31ec44db066ee3ba08ed0604" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_t_payload.html#a43708e6d31ec44db066ee3ba08ed0604">OTPayload::~OTPayload</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00167">167</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{

}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="af2c079778a1809964c6e2f138e4d6819"></a><!-- doxytag: member="OTPayload::GetEnvelope" ref="af2c079778a1809964c6e2f138e4d6819" args="(OTEnvelope &amp;theEnvelope) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_payload.html#af2c079778a1809964c6e2f138e4d6819">OTPayload::GetEnvelope</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;&#160;</td>
          <td class="paramname"><em>theEnvelope</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00239">239</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// validate checksum</span>
    uint32_t lSize = <a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>();
    uint32_t lIndex = lSize-2; <span class="comment">// the index to where the NULL terminator SHOULD be if they</span>
                          <span class="comment">// sent us a base64-encoded string, containing an encrypted message. (which we expect...)</span>

    <span class="comment">// (lSize-1 would be the location of the checksum at the end.)</span>
    <span class="keywordflow">if</span> (0 == lSize)
        <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (<a class="code" href="_o_t_data_check_8hpp.html#a3f73adcb6c603c69f3b41833b831a412">IsChecksumValid</a>((<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), (uint32_t)lSize))
    {
        <span class="comment">// We add the null-terminator ourselves at this point, for security reasons,</span>
        <span class="comment">// since we will process the data, soon after this function, as a string.</span>
        ((<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>())[lIndex] = 0;

        theEnvelope.m_dataContents.<a class="code" href="class_o_t_data.html#aab9a5758e85597ef1d7250bcf2cc56a6">Release</a>();

        <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmor;
        <span class="comment">// Why is this safe, where I cast the Payload data pointer as</span>
        <span class="comment">// a char * and tell the data object to set itself from that?</span>
        <span class="comment">// Because (1) I just validated the checksum, and</span>
        <span class="comment">// (2) There place where the NULL should be, I set to 0, by hand,</span>
        <span class="comment">// just above 2 lines. So when this set operation occurs, the</span>
        <span class="comment">// farthest it will go is to that 0.</span>
        theArmor.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>());

        <span class="comment">// Todo NOTE: If I ever want to process bookends here instead of assuming they aren&#39;t there,</span>
        <span class="comment">// IT&#39;S VERY EASY!! All I have to do is call theArmor.LoadFromString instead of theArmor.Set.</span>

        <span class="comment">// Now the ascii-armored string that was sent across is decoded back to binary into the</span>
        <span class="comment">// Envelope object.</span>
        theEnvelope.<a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(theArmor);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Invalid Checksum in OTPayload::GetEnvelope\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa26daa2e7d1d86b88686ecf8431535c5"></a><!-- doxytag: member="OTPayload::GetMessagePayload" ref="aa26daa2e7d1d86b88686ecf8431535c5" args="(OTMessage &amp;theMessage) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_payload.html#aa26daa2e7d1d86b88686ecf8431535c5">OTPayload::GetMessagePayload</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_message.html">OTMessage</a> &amp;&#160;</td>
          <td class="paramname"><em>theMessage</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00284">284</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// validate checksum</span>
    uint32_t lSize  = <a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>();
    uint32_t lIndex = lSize-2; <span class="comment">// the index to where the NULL terminator SHOULD be if they</span>
                          <span class="comment">// sent us a string like they were supposed to. (A contract.)</span>
                          <span class="comment">// (nSize-1 would be the location of the checksum at the end.)</span>
    <span class="keywordflow">if</span> (0 == lSize)
        <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (<a class="code" href="_o_t_data_check_8hpp.html#a3f73adcb6c603c69f3b41833b831a412">IsChecksumValid</a>((<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), (uint32_t)lSize))
    {
        <span class="comment">// We add the null-terminator ourselves at this point, for security reasons,</span>
        <span class="comment">// since we will process the data, after this point, as a string.</span>
        ((<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>())[lIndex] = 0;

        theMessage.<a class="code" href="class_o_t_contract.html#a15e423ca0d650858a23e54f8285feae1">Release</a>();

        <span class="comment">// Why is this safe, where I cast the Payload data pointer as</span>
        <span class="comment">// a char * and tell the string to set itself from that?</span>
        <span class="comment">// Because (1) I just validated the checksum, and</span>
        <span class="comment">// (2) There place where the NULL should be, I set to 0, by hand,</span>
        <span class="comment">// just above 2 lines. So when this set operation occurs, the</span>
        <span class="comment">// farthest it will go is to that 0.</span>
        theMessage.<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>());
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="class_o_t_log.html#a5acd90ac91c2618f395b0ff37ad4f8ee">OTLog::Error</a>(<span class="stringliteral">&quot;Invalid Checksum in OTPayload::GetMessage\n&quot;</span>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aef8d7f40ba7886f7da16290091681aa9"></a><!-- doxytag: member="OTPayload::GetPayloadPointer" ref="aef8d7f40ba7886f7da16290091681aa9" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void * <a class="el" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">OTPayload::GetPayloadPointer</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00325">325</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6acf2a994ed13798718519547e9431fd"></a><!-- doxytag: member="OTPayload::ReadBytesFrom" ref="a6acf2a994ed13798718519547e9431fd" args="(OTData &amp;theData, uint32_t lSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="class_o_t_payload.html#a6acf2a994ed13798718519547e9431fd">OTPayload::ReadBytesFrom</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_o_t_data.html">OTData</a> &amp;&#160;</td>
          <td class="paramname"><em>theData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>lSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00173">173</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(theData.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() &gt;= lSize);

    <span class="comment">// The size requested to read MUST be less or equal to size of theData</span>
    <span class="keywordflow">if</span> (theData.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() &lt; lSize)
        abort();

    <a class="code" href="class_o_t_payload.html">OTPayload</a> &amp; refPayload = (<a class="code" href="class_o_t_payload.html">OTPayload</a> &amp;)theData; <span class="comment">// todo fix this cast.</span>

    <span class="comment">// Copy from theData to this, up until lSize</span>
    <a class="code" href="class_o_t_data.html#a253cd3974cb837ad06980579eb7bc0e4">Assign</a>(refPayload.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>(), lSize);

    <span class="comment">// Create a temp var, starting from theData+lSize, copying to the end of theData</span>
    <a class="code" href="class_o_t_data.html">OTData</a> TEMPdata((uint8_t *)refPayload.<a class="code" href="class_o_t_payload.html#aef8d7f40ba7886f7da16290091681aa9">GetPayloadPointer</a>() + lSize, theData.<a class="code" href="class_o_t_data.html#a18fd0599061eaf2c031548e030c3112d">GetSize</a>() - lSize);

    <span class="comment">// theData is assigned to TEMPdata (thus removing from it the bytes that we just read into this.)</span>
    theData.<a class="code" href="class_o_t_data.html#a253cd3974cb837ad06980579eb7bc0e4">Assign</a>(TEMPdata);

    <span class="keywordflow">return</span> lSize;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1a5fa31f9c665b99d9d1b96bd20944e3"></a><!-- doxytag: member="OTPayload::SetEnvelope" ref="a1a5fa31f9c665b99d9d1b96bd20944e3" args="(const OTEnvelope &amp;theEnvelope)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_payload.html#a1a5fa31f9c665b99d9d1b96bd20944e3">OTPayload::SetEnvelope</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_envelope.html">OTEnvelope</a> &amp;&#160;</td>
          <td class="paramname"><em>theEnvelope</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00197">197</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmor;

    <span class="keywordflow">if</span> (theEnvelope.<a class="code" href="class_o_t_envelope.html#a4ecb56611bd11931de4fae77b8b735ec">GetAsciiArmoredData</a>(theArmor))
    {
        uint32_t lSize = theArmor.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()+1; <span class="comment">//+1 for the null terminater</span>

        <span class="keywordflow">if</span> (theArmor.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())
        {
            <a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lSize + 1); <span class="comment">// +1 for the checksum byte.</span>

            <span class="comment">// Copy it in.</span>
            memcpy((<span class="keywordtype">void</span> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), theArmor.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), lSize);

            <span class="comment">// Add the checksum, success.</span>
            <a class="code" href="_o_t_data_check_8hpp.html#a41af79e5893caddf6a79b5eeeb27da73">AppendChecksum</a>( (<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), lSize );
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2d099c964588c0c1d251992733ac9b5b"></a><!-- doxytag: member="OTPayload::SetMessagePayload" ref="a2d099c964588c0c1d251992733ac9b5b" args="(const OTMessage &amp;theMessage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_o_t_payload.html#a2d099c964588c0c1d251992733ac9b5b">OTPayload::SetMessagePayload</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_o_t_message.html">OTMessage</a> &amp;&#160;</td>
          <td class="paramname"><em>theMessage</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00221">221</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    uint32_t lSize = theMessage.<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>()+1; <span class="comment">//+1 for the null terminater</span>

    <span class="keywordflow">if</span> (theMessage.<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>())
    {
        <a class="code" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">SetPayloadSize</a>(lSize + 1); <span class="comment">// +1 for the checksum byte.</span>
        memcpy((<span class="keywordtype">void</span> *)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), theMessage.<a class="code" href="class_o_t_contract.html#a90c53743214bc0f0025ad63c3ace7bf2">m_strRawFile</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), lSize);

        <span class="comment">// Add the checksum</span>
        <a class="code" href="_o_t_data_check_8hpp.html#a41af79e5893caddf6a79b5eeeb27da73">AppendChecksum</a>( (<a class="code" href="_o_t_data_check_8hpp.html#a3b9364b992d0573b64bd83a75962493d">OT_BYTE</a>*)<a class="code" href="class_o_t_data.html#a649046d86480b41406a8b2d8529378e5">GetPointer</a>(), lSize );
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8a6a8221de63686df445f0e77e73f214"></a><!-- doxytag: member="OTPayload::SetPayloadSize" ref="a8a6a8221de63686df445f0e77e73f214" args="(uint32_t lNewSize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_o_t_payload.html#a8a6a8221de63686df445f0e77e73f214">OTPayload::SetPayloadSize</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>lNewSize</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="_o_t_payload_8cpp_source.html#l00319">319</a> of file <a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_o_t_data.html#a61af4b9b5b9ee1c7c825c32caf383542">SetSize</a>(lNewSize);
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/otlib/<a class="el" href="_o_t_payload_8hpp_source.html">OTPayload.hpp</a></li>
<li>src/otlib/<a class="el" href="_o_t_payload_8cpp_source.html">OTPayload.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_o_t_payload.html">OTPayload</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:14 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
