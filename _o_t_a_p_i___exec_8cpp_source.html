<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Transactions: src/otapi/OTAPI_Exec.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Transactions
   &#160;<span id="projectnumber">master/1066fb4910a63ee3f7de8e0807fee3eb663b66c7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_o_t_a_p_i___exec_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/otapi/OTAPI_Exec.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_o_t_a_p_i___exec_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/************************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">*</span>
<a name="l00003"></a>00003 <span class="comment">* OTAPI.cpp   --    A C++ Low-Level API (wraps OT_API)</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">* This is a C++ class that contains many helper functions.</span>
<a name="l00006"></a>00006 <span class="comment">*</span>
<a name="l00007"></a>00007 <span class="comment">*/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/************************************************************</span>
<a name="l00010"></a>00010 <span class="comment"> -----BEGIN PGP SIGNED MESSAGE-----</span>
<a name="l00011"></a>00011 <span class="comment"> Hash: SHA1</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment"> *                 OPEN TRANSACTIONS</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *       Financial Cryptography and Digital Cash</span>
<a name="l00016"></a>00016 <span class="comment"> *       Library, Protocol, API, Server, CLI, GUI</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> *       -- Anonymous Numbered Accounts.</span>
<a name="l00019"></a>00019 <span class="comment"> *       -- Untraceable Digital Cash.</span>
<a name="l00020"></a>00020 <span class="comment"> *       -- Triple-Signed Receipts.</span>
<a name="l00021"></a>00021 <span class="comment"> *       -- Cheques, Vouchers, Transfers, Inboxes.</span>
<a name="l00022"></a>00022 <span class="comment"> *       -- Basket Currencies, Markets, Payment Plans.</span>
<a name="l00023"></a>00023 <span class="comment"> *       -- Signed, XML, Ricardian-style Contracts.</span>
<a name="l00024"></a>00024 <span class="comment"> *       -- Scripted smart contracts.</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> *  Copyright (C) 2010-2013 by &quot;Fellow Traveler&quot; (A pseudonym)</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *  EMAIL:</span>
<a name="l00029"></a>00029 <span class="comment"> *  FellowTraveler@rayservers.net</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> *  BITCOIN:  1NtTPVVjDsUfDWybS4BwvHpG2pdS9RnYyQ</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> *  KEY FINGERPRINT (PGP Key in license file):</span>
<a name="l00034"></a>00034 <span class="comment"> *  9DD5 90EB 9292 4B48 0484  7910 0308 00ED F951 BB8E</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> *  OFFICIAL PROJECT WIKI(s):</span>
<a name="l00037"></a>00037 <span class="comment"> *  https://github.com/FellowTraveler/Moneychanger</span>
<a name="l00038"></a>00038 <span class="comment"> *  https://github.com/FellowTraveler/Open-Transactions/wiki</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> *  WEBSITE:</span>
<a name="l00041"></a>00041 <span class="comment"> *  http://www.OpenTransactions.org/</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> *  Components and licensing:</span>
<a name="l00044"></a>00044 <span class="comment"> *   -- Moneychanger..A Java client GUI.....LICENSE:.....GPLv3</span>
<a name="l00045"></a>00045 <span class="comment"> *   -- otlib.........A class library.......LICENSE:...LAGPLv3</span>
<a name="l00046"></a>00046 <span class="comment"> *   -- otapi.........A client API..........LICENSE:...LAGPLv3</span>
<a name="l00047"></a>00047 <span class="comment"> *   -- opentxs/ot....Command-line client...LICENSE:...LAGPLv3</span>
<a name="l00048"></a>00048 <span class="comment"> *   -- otserver......Server Application....LICENSE:....AGPLv3</span>
<a name="l00049"></a>00049 <span class="comment"> *  Github.com/FellowTraveler/Open-Transactions/wiki/Components</span>
<a name="l00050"></a>00050 <span class="comment"> *</span>
<a name="l00051"></a>00051 <span class="comment"> *  All of the above OT components were designed and written by</span>
<a name="l00052"></a>00052 <span class="comment"> *  Fellow Traveler, with the exception of Moneychanger, which</span>
<a name="l00053"></a>00053 <span class="comment"> *  was contracted out to Vicky C (bitcointrader4@gmail.com).</span>
<a name="l00054"></a>00054 <span class="comment"> *  The open-source community has since actively contributed.</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> *  -----------------------------------------------------</span>
<a name="l00057"></a>00057 <span class="comment"> *</span>
<a name="l00058"></a>00058 <span class="comment"> *   LICENSE:</span>
<a name="l00059"></a>00059 <span class="comment"> *   This program is free software: you can redistribute it</span>
<a name="l00060"></a>00060 <span class="comment"> *   and/or modify it under the terms of the GNU Affero</span>
<a name="l00061"></a>00061 <span class="comment"> *   General Public License as published by the Free Software</span>
<a name="l00062"></a>00062 <span class="comment"> *   Foundation, either version 3 of the License, or (at your</span>
<a name="l00063"></a>00063 <span class="comment"> *   option) any later version.</span>
<a name="l00064"></a>00064 <span class="comment"> *</span>
<a name="l00065"></a>00065 <span class="comment"> *   ADDITIONAL PERMISSION under the GNU Affero GPL version 3</span>
<a name="l00066"></a>00066 <span class="comment"> *   section 7: (This paragraph applies only to the LAGPLv3</span>
<a name="l00067"></a>00067 <span class="comment"> *   components listed above.) If you modify this Program, or</span>
<a name="l00068"></a>00068 <span class="comment"> *   any covered work, by linking or combining it with other</span>
<a name="l00069"></a>00069 <span class="comment"> *   code, such other code is not for that reason alone subject</span>
<a name="l00070"></a>00070 <span class="comment"> *   to any of the requirements of the GNU Affero GPL version 3.</span>
<a name="l00071"></a>00071 <span class="comment"> *   (==&gt; This means if you are only using the OT API, then you</span>
<a name="l00072"></a>00072 <span class="comment"> *   don&#39;t have to open-source your code--only your changes to</span>
<a name="l00073"></a>00073 <span class="comment"> *   Open-Transactions itself must be open source. Similar to</span>
<a name="l00074"></a>00074 <span class="comment"> *   LGPLv3, except it applies to software-as-a-service, not</span>
<a name="l00075"></a>00075 <span class="comment"> *   just to distributing binaries.)</span>
<a name="l00076"></a>00076 <span class="comment"> *</span>
<a name="l00077"></a>00077 <span class="comment"> *   Extra WAIVER for OpenSSL, Lucre, and all other libraries</span>
<a name="l00078"></a>00078 <span class="comment"> *   used by Open Transactions: This program is released under</span>
<a name="l00079"></a>00079 <span class="comment"> *   the AGPL with the additional exemption that compiling,</span>
<a name="l00080"></a>00080 <span class="comment"> *   linking, and/or using OpenSSL is allowed. The same is true</span>
<a name="l00081"></a>00081 <span class="comment"> *   for any other open source libraries included in this</span>
<a name="l00082"></a>00082 <span class="comment"> *   project: complete waiver from the AGPL is hereby granted to</span>
<a name="l00083"></a>00083 <span class="comment"> *   compile, link, and/or use them with Open-Transactions,</span>
<a name="l00084"></a>00084 <span class="comment"> *   according to their own terms, as long as the rest of the</span>
<a name="l00085"></a>00085 <span class="comment"> *   Open-Transactions terms remain respected, with regard to</span>
<a name="l00086"></a>00086 <span class="comment"> *   the Open-Transactions code itself.</span>
<a name="l00087"></a>00087 <span class="comment"> *</span>
<a name="l00088"></a>00088 <span class="comment"> *   Lucre License:</span>
<a name="l00089"></a>00089 <span class="comment"> *   This code is also &quot;dual-license&quot;, meaning that Ben Lau-</span>
<a name="l00090"></a>00090 <span class="comment"> *   rie&#39;s license must also be included and respected, since</span>
<a name="l00091"></a>00091 <span class="comment"> *   the code for Lucre is also included with Open Transactions.</span>
<a name="l00092"></a>00092 <span class="comment"> *   See Open-Transactions/src/otlib/lucre/LUCRE_LICENSE.txt</span>
<a name="l00093"></a>00093 <span class="comment"> *   The Laurie requirements are light, but if there is any</span>
<a name="l00094"></a>00094 <span class="comment"> *   problem with his license, simply remove the Lucre code.</span>
<a name="l00095"></a>00095 <span class="comment"> *   Although there are no other blind token algorithms in Open</span>
<a name="l00096"></a>00096 <span class="comment"> *   Transactions (yet. credlib is coming), the other functions</span>
<a name="l00097"></a>00097 <span class="comment"> *   will continue to operate.</span>
<a name="l00098"></a>00098 <span class="comment"> *   See Lucre on Github:  https://github.com/benlaurie/lucre</span>
<a name="l00099"></a>00099 <span class="comment"> *   -----------------------------------------------------</span>
<a name="l00100"></a>00100 <span class="comment"> *   You should have received a copy of the GNU Affero General</span>
<a name="l00101"></a>00101 <span class="comment"> *   Public License along with this program.  If not, see:</span>
<a name="l00102"></a>00102 <span class="comment"> *   http://www.gnu.org/licenses/</span>
<a name="l00103"></a>00103 <span class="comment"> *</span>
<a name="l00104"></a>00104 <span class="comment"> *   If you would like to use this software outside of the free</span>
<a name="l00105"></a>00105 <span class="comment"> *   software license, please contact FellowTraveler.</span>
<a name="l00106"></a>00106 <span class="comment"> *   (Unfortunately many will run anonymously and untraceably,</span>
<a name="l00107"></a>00107 <span class="comment"> *   so who could really stop them?)</span>
<a name="l00108"></a>00108 <span class="comment"> *</span>
<a name="l00109"></a>00109 <span class="comment"> *   DISCLAIMER:</span>
<a name="l00110"></a>00110 <span class="comment"> *   This program is distributed in the hope that it will be</span>
<a name="l00111"></a>00111 <span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<a name="l00112"></a>00112 <span class="comment"> *   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<a name="l00113"></a>00113 <span class="comment"> *   PURPOSE.  See the GNU Affero General Public License for</span>
<a name="l00114"></a>00114 <span class="comment"> *   more details.</span>
<a name="l00115"></a>00115 <span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment"> -----BEGIN PGP SIGNATURE-----</span>
<a name="l00117"></a>00117 <span class="comment"> Version: GnuPG v1.4.9 (Darwin)</span>
<a name="l00118"></a>00118 <span class="comment"></span>
<a name="l00119"></a>00119 <span class="comment"> iQIcBAEBAgAGBQJRSsfJAAoJEAMIAO35UbuOQT8P/RJbka8etf7wbxdHQNAY+2cC</span>
<a name="l00120"></a>00120 <span class="comment"> vDf8J3X8VI+pwMqv6wgTVy17venMZJa4I4ikXD/MRyWV1XbTG0mBXk/7AZk7Rexk</span>
<a name="l00121"></a>00121 <span class="comment"> KTvL/U1kWiez6+8XXLye+k2JNM6v7eej8xMrqEcO0ZArh/DsLoIn1y8p8qjBI7+m</span>
<a name="l00122"></a>00122 <span class="comment"> aE7lhstDiD0z8mwRRLKFLN2IH5rAFaZZUvj5ERJaoYUKdn4c+RcQVei2YOl4T0FU</span>
<a name="l00123"></a>00123 <span class="comment"> LWND3YLoH8naqJXkaOKEN4UfJINCwxhe5Ke9wyfLWLUO7NamRkWD2T7CJ0xocnD1</span>
<a name="l00124"></a>00124 <span class="comment"> sjAzlVGNgaFDRflfIF4QhBx1Ddl6wwhJfw+d08bjqblSq8aXDkmFA7HeunSFKkdn</span>
<a name="l00125"></a>00125 <span class="comment"> oIEOEgyj+veuOMRJC5pnBJ9vV+7qRdDKQWaCKotynt4sWJDGQ9kWGWm74SsNaduN</span>
<a name="l00126"></a>00126 <span class="comment"> TPMyr9kNmGsfR69Q2Zq/FLcLX/j8ESxU+HYUB4vaARw2xEOu2xwDDv6jt0j3Vqsg</span>
<a name="l00127"></a>00127 <span class="comment"> x7rWv4S/Eh18FDNDkVRChiNoOIilLYLL6c38uMf1pnItBuxP3uhgY6COm59kVaRh</span>
<a name="l00128"></a>00128 <span class="comment"> nyGTYCDYD2TK+fI9o89F1297uDCwEJ62U0Q7iTDp5QuXCoxkPfv8/kX6lS6T3y9G</span>
<a name="l00129"></a>00129 <span class="comment"> M9mqIoLbIQ1EDntFv7/t6fUTS2+46uCrdZWbQ5RjYXdrzjij02nDmJAm2BngnZvd</span>
<a name="l00130"></a>00130 <span class="comment"> kamH0Y/n11lCvo1oQxM+</span>
<a name="l00131"></a>00131 <span class="comment"> =uSzz</span>
<a name="l00132"></a>00132 <span class="comment"> -----END PGP SIGNATURE-----</span>
<a name="l00133"></a>00133 <span class="comment"> **************************************************************/</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="preprocessor">#include &lt;<a class="code" href="stdafx_8hpp.html">stdafx.hpp</a>&gt;</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_a_p_i___exec_8hpp.html">OTAPI_Exec.hpp</a>&quot;</span>
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="preprocessor">#include &lt;<a class="code" href="_open_transactions_8hpp.html">OpenTransactions.hpp</a>&gt;</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_basket_8hpp.html">OTBasket.hpp</a>&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_cheque_8hpp.html">OTCheque.hpp</a>&quot;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_credential_8hpp.html">OTCredential.hpp</a>&quot;</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_envelope_8hpp.html">OTEnvelope.hpp</a>&quot;</span>
<a name="l00145"></a>00145 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_ledger_8hpp.html">OTLedger.hpp</a>&quot;</span>
<a name="l00146"></a>00146 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_log_8hpp.html">OTLog.hpp</a>&quot;</span>
<a name="l00147"></a>00147 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_message_8hpp.html">OTMessage.hpp</a>&quot;</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_mint_8hpp.html">OTMint.hpp</a>&quot;</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_password_8hpp.html">OTPassword.hpp</a>&quot;</span>
<a name="l00150"></a>00150 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_paths_8hpp.html">OTPaths.hpp</a>&quot;</span>
<a name="l00151"></a>00151 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_payment_8hpp.html">OTPayment.hpp</a>&quot;</span>
<a name="l00152"></a>00152 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_payment_plan_8hpp.html">OTPaymentPlan.hpp</a>&quot;</span>
<a name="l00153"></a>00153 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_purse_8hpp.html">OTPurse.hpp</a>&quot;</span>
<a name="l00154"></a>00154 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_server_contract_8hpp.html">OTServerContract.hpp</a>&quot;</span>
<a name="l00155"></a>00155 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_symmetric_key_8hpp.html">OTSymmetricKey.hpp</a>&quot;</span>
<a name="l00156"></a>00156 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_wallet_8hpp.html">OTWallet.hpp</a>&quot;</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="preprocessor">#include &quot;<a class="code" href="_o_t_account_8hpp.html">OTAccount.hpp</a>&quot;</span>  <span class="comment">//included in OTSmartContract.hpp</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="preprocessor">#ifndef OT_BOOL</span>
<a name="l00162"></a><a class="code" href="_o_t_a_p_i___exec_8cpp.html#af499ebed6d3cadd3ecde166b0a6bf3c8">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define OT_BOOL int32_t</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>
<a name="l00165"></a>00165 <span class="preprocessor">#ifndef OT_FALSE</span>
<a name="l00166"></a><a class="code" href="_o_t_a_p_i___exec_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">00166</a> <span class="preprocessor"></span><span class="keyword">const</span> int32_t <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a> = 0;
<a name="l00167"></a>00167 <span class="preprocessor">#endif</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>
<a name="l00169"></a>00169 <span class="preprocessor">#ifndef OT_TRUE</span>
<a name="l00170"></a><a class="code" href="_o_t_a_p_i___exec_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">00170</a> <span class="preprocessor"></span><span class="keyword">const</span> int32_t <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a> = 1;
<a name="l00171"></a>00171 <span class="preprocessor">#endif</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="preprocessor">#ifndef OT_ERROR</span>
<a name="l00175"></a><a class="code" href="_o_t_a_p_i___exec_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">00175</a> <span class="preprocessor"></span><span class="keyword">const</span> int32_t <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a> = (-1);
<a name="l00176"></a>00176 <span class="preprocessor">#endif</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a>00178 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a908efdafde9c9738835069849c1e05ae">OTAPI_Exec::bInitOTApp</a> = <span class="keyword">false</span>;
<a name="l00182"></a>00182 <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a9faaa894d65345064dddada36d292b46">OTAPI_Exec::bCleanupOTApp</a> = <span class="keyword">false</span>;
<a name="l00183"></a>00183 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac4c534a89b6ea47197e9e9abd831726b">00186</a> <a class="code" href="class_o_t_a_p_i___exec.html#ac4c534a89b6ea47197e9e9abd831726b">OTAPI_Exec::OTAPI_Exec</a>() : p_OTAPI(NULL)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="class_o_t_a_p_i___exec.html#aea5e98c237689dee0885360ca286d882">00190</a> <a class="code" href="class_o_t_a_p_i___exec.html#aea5e98c237689dee0885360ca286d882">OTAPI_Exec::~OTAPI_Exec</a>()
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">// **********************************************************************</span>
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="class_o_t_a_p_i___exec.html#a570af496633a5d0b35048200fee03a89">00197</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a570af496633a5d0b35048200fee03a89">OTAPI_Exec::AppInit</a>()    <span class="comment">// Call this ONLY ONCE, when your App first starts up.</span>
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___exec.html#a9faaa894d65345064dddada36d292b46">OTAPI_Exec::bCleanupOTApp</a>)
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___exec.html#a908efdafde9c9738835069849c1e05ae">OTAPI_Exec::bInitOTApp</a>)
<a name="l00202"></a>00202         {
<a name="l00203"></a>00203             <a class="code" href="class_o_t_a_p_i___exec.html#a908efdafde9c9738835069849c1e05ae">OTAPI_Exec::bInitOTApp</a> = <span class="keyword">true</span>;
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (<a class="code" href="class_o_t___a_p_i.html#adc39b64382968c133c59fd7bf52124de">OT_API::InitOTApp</a>())
<a name="l00205"></a>00205             {
<a name="l00206"></a>00206                 <a class="code" href="class_o_t___a_p_i.html">OT_API</a> * tmpOTAPI = <span class="keyword">new</span> <a class="code" href="class_o_t___a_p_i.html">OT_API</a>();
<a name="l00207"></a>00207                 <span class="keywordflow">if</span> (NULL != tmpOTAPI)
<a name="l00208"></a>00208                 {
<a name="l00209"></a>00209                     <span class="keywordflow">if</span> (tmpOTAPI-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>())
<a name="l00210"></a>00210                     {
<a name="l00211"></a>00211                         <span class="keywordflow">if</span> (tmpOTAPI-&gt;<a class="code" href="class_o_t___a_p_i.html#aae7802dad48d8347a4b3d6b91e7aac0c">SetTransportCallback</a>(<span class="keyword">new</span> <a class="code" href="struct_transport_callback.html">TransportCallback</a>(*tmpOTAPI)))
<a name="l00212"></a>00212                         {
<a name="l00213"></a>00213                             <a class="code" href="class_o_t_a_p_i___exec.html#a4a454ed385391e993ec5ebf323a54063">p_OTAPI</a> = tmpOTAPI; <span class="comment">// success</span>
<a name="l00214"></a>00214                             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00215"></a>00215                         }
<a name="l00216"></a>00216                     }
<a name="l00217"></a>00217                     <span class="keyword">delete</span> tmpOTAPI;
<a name="l00218"></a>00218                     tmpOTAPI = NULL;
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="class_o_t_a_p_i___exec.html#acea9dd5706283762916ed0755b2acac8">00226</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#acea9dd5706283762916ed0755b2acac8">OTAPI_Exec::AppCleanup</a>() <span class="comment">// Call this ONLY ONCE, when your App is shutting down.</span>
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (!<a class="code" href="class_o_t_a_p_i___exec.html#a9faaa894d65345064dddada36d292b46">OTAPI_Exec::bCleanupOTApp</a>) <span class="comment">// if we haven&#39;t cleaned up already</span>
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___exec.html#a908efdafde9c9738835069849c1e05ae">OTAPI_Exec::bInitOTApp</a>) <span class="comment">// and have had a ctx.</span>
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232             <span class="comment">// will cleanup everything.</span>
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (NULL != <a class="code" href="class_o_t_a_p_i___exec.html#a4a454ed385391e993ec5ebf323a54063">p_OTAPI</a>) <span class="keyword">delete</span> <a class="code" href="class_o_t_a_p_i___exec.html#a4a454ed385391e993ec5ebf323a54063">p_OTAPI</a>;
<a name="l00234"></a>00234             <a class="code" href="class_o_t_a_p_i___exec.html#a4a454ed385391e993ec5ebf323a54063">p_OTAPI</a> = NULL;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236             <a class="code" href="class_o_t_a_p_i___exec.html#a9faaa894d65345064dddada36d292b46">OTAPI_Exec::bCleanupOTApp</a> = <span class="keyword">true</span>;
<a name="l00237"></a>00237             <span class="keywordflow">return</span> <a class="code" href="class_o_t___a_p_i.html#a7c1ce59287a7919d518149d9252e9d34">OT_API::CleanupOTApp</a>();
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l00247"></a>00247 <span class="comment">// SetAppBinaryFolder</span>
<a name="l00248"></a>00248 <span class="comment">// OPTIONAL. Used in Android and Qt.</span>
<a name="l00249"></a>00249 <span class="comment">//</span>
<a name="l00250"></a>00250 <span class="comment">// Certain platforms use this to override the Prefix folder.</span>
<a name="l00251"></a>00251 <span class="comment">// Basically /usr/local is the prefix folder by default, meaning</span>
<a name="l00252"></a>00252 <span class="comment">// /usr/local/lib/opentxs will be the location of the scripts. But</span>
<a name="l00253"></a>00253 <span class="comment">// if you override AppBinary folder to, say, &quot;res/raw&quot;</span>
<a name="l00254"></a>00254 <span class="comment">// (Android does something like that) then even though the prefix remains</span>
<a name="l00255"></a>00255 <span class="comment">// as /usr/local, the scripts folder will be res/raw</span>
<a name="l00256"></a>00256 <span class="comment">//</span>
<a name="l00257"></a>00257 <span class="comment">//</span>
<a name="l00258"></a><a class="code" href="class_o_t_a_p_i___exec.html#a52012141810b4ca4a72e713dc0fbbbab">00258</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#a52012141810b4ca4a72e713dc0fbbbab">OTAPI_Exec::SetAppBinaryFolder</a>(<span class="keyword">const</span> std::string &amp; strFolder)
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260     <a class="code" href="class_o_t_a_p_i___exec.html#a52012141810b4ca4a72e713dc0fbbbab">OTPaths::SetAppBinaryFolder</a>(strFolder.c_str());
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l00264"></a>00264 <span class="comment">// SetHomeFolder</span>
<a name="l00265"></a>00265 <span class="comment">// OPTIONAL. Used in Android.</span>
<a name="l00266"></a>00266 <span class="comment">//</span>
<a name="l00267"></a>00267 <span class="comment">// The AppDataFolder, such as /Users/au/.ot, is constructed from the home</span>
<a name="l00268"></a>00268 <span class="comment">// folder, such as /Users/au.</span>
<a name="l00269"></a>00269 <span class="comment">//</span>
<a name="l00270"></a>00270 <span class="comment">// Normally the home folder is auto-detected, but certain platforms, such as</span>
<a name="l00271"></a>00271 <span class="comment">// Android, require us to explicitly set this folder from the Java code. Then</span>
<a name="l00272"></a>00272 <span class="comment">// the AppDataFolder is constructed from it. (It&#39;s the only way it can be done.)</span>
<a name="l00273"></a>00273 <span class="comment">//</span>
<a name="l00274"></a>00274 <span class="comment">// In Android, you would SetAppBinaryFolder to the path to &quot;/data/app/packagename/res/raw&quot;,</span>
<a name="l00275"></a>00275 <span class="comment">// and you would SetHomeFolder to &quot;/data/data/[app package]/files/&quot;</span>
<a name="l00276"></a>00276 <span class="comment">//</span>
<a name="l00277"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae79f96dd7c3c35ce69b39aa7571499a6">00277</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#ae79f96dd7c3c35ce69b39aa7571499a6">OTAPI_Exec::SetHomeFolder</a>(<span class="keyword">const</span> std::string &amp; strFolder)
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279     <a class="code" href="class_o_t_a_p_i___exec.html#ae79f96dd7c3c35ce69b39aa7571499a6">OTPaths::SetHomeFolder</a>(strFolder.c_str());
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">00285</a> <a class="code" href="class_o_t___a_p_i.html">OT_API</a> * <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI_Exec::OTAPI</a>()
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a4a454ed385391e993ec5ebf323a54063">p_OTAPI</a>;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">00291</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">OTAPI_Exec::StringToLong</a>(<span class="keyword">const</span> std::string &amp;strNumber)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">OTString::StringToLong</a>(strNumber);
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab27795fbc9d11a3ada075eaa64b95831">00297</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab27795fbc9d11a3ada075eaa64b95831">OTAPI_Exec::LongToString</a>(<span class="keyword">const</span> int64_t &amp; lNumber)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299     std::string strNumber;
<a name="l00300"></a>00300     std::stringstream strstream;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     strstream &lt;&lt; lNumber;
<a name="l00303"></a>00303     strstream &gt;&gt; strNumber;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="keywordflow">return</span> strNumber;
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a><a class="code" href="class_o_t_a_p_i___exec.html#af0e3de0bfdee8ea9bc6dcb6e58fee398">00309</a> uint64_t <a class="code" href="class_o_t_a_p_i___exec.html#af0e3de0bfdee8ea9bc6dcb6e58fee398">OTAPI_Exec::StringToUlong</a>(<span class="keyword">const</span> std::string &amp;strNumber)
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#af0e3de0bfdee8ea9bc6dcb6e58fee398">OTString::StringToUlong</a>(strNumber);
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="class_o_t_a_p_i___exec.html#a17d4c4b6225b79c5e23929f1ef1669bd">00315</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a17d4c4b6225b79c5e23929f1ef1669bd">OTAPI_Exec::UlongToString</a>(<span class="keyword">const</span> uint64_t &amp; lNumber)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     std::string strNumber;
<a name="l00318"></a>00318     std::stringstream strstream;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     strstream &lt;&lt; lNumber;
<a name="l00321"></a>00321     strstream &gt;&gt; strNumber;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">return</span> strNumber;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l00332"></a><a class="code" href="class_o_t_a_p_i___exec.html#a898873fe2d35440f6963b81e7a83ea84">00332</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#a898873fe2d35440f6963b81e7a83ea84">OTAPI_Exec::Output</a>(<span class="keyword">const</span> int32_t &amp; nLogLevel, <span class="keyword">const</span> std::string &amp; strOutput)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> otstrOutput(!strOutput.empty() ? strOutput : <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <a class="code" href="class_o_t_a_p_i___exec.html#a898873fe2d35440f6963b81e7a83ea84">OTLog::Output</a>(nLogLevel, otstrOutput.Get());
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a><a class="code" href="class_o_t_a_p_i___exec.html#a357e8cea1ca039682fb6d1076c8234fb">00342</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a357e8cea1ca039682fb6d1076c8234fb">OTAPI_Exec::SetWallet</a>(<span class="keyword">const</span> std::string &amp; strWalletFilename)
<a name="l00343"></a>00343 {
<a name="l00344"></a>00344     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (!bIsInitialized)
<a name="l00346"></a>00346     {
<a name="l00347"></a>00347         <a class="code" href="class_o_t_log.html#a8c12a31fb887aa7a3023879a2ff86173">OTLog::sError</a>(<span class="stringliteral">&quot;%s: Error: OT_API not Initialized!!\n&quot;</span>, __FUNCTION__);
<a name="l00348"></a>00348         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350     <span class="keywordflow">else</span>
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <a class="code" href="class_o_t_string.html">OTString</a> sWalletFilename(strWalletFilename);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (sWalletFilename.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356             <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5eaacf363f5fb27e71c196cbb099cced">SetWalletFilename</a>(strWalletFilename);
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358         <span class="keywordflow">else</span>
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360             <a class="code" href="class_o_t_log.html#a8c12a31fb887aa7a3023879a2ff86173">OTLog::sError</a>(<span class="stringliteral">&quot;%s: Error:: Wallet Filename is Null!\n&quot;</span>, __FUNCTION__);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l00375"></a><a class="code" href="class_o_t_a_p_i___exec.html#a06e34b62c3e36073dafa653a28ee6f5d">00375</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a06e34b62c3e36073dafa653a28ee6f5d">OTAPI_Exec::WalletExists</a>()
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a798f3a326f18f31b8e62a682bbaa6a6d">WalletExists</a>();
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="class_o_t_a_p_i___exec.html#a889a6737076054113908d22f6ae4e223">00380</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a889a6737076054113908d22f6ae4e223">OTAPI_Exec::LoadWallet</a>()
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a>();
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0417d34f4d85922e732f4a835cb53c6a">00388</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a0417d34f4d85922e732f4a835cb53c6a">OTAPI_Exec::SwitchWallet</a>()
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3a0ae20d8736f8588d76441a18ac2c6e">LoadWallet</a>();
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 <span class="comment">// ----------------------------------------------------------------</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3480267ea10f15c53bb92240aec254ea">00397</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a3480267ea10f15c53bb92240aec254ea">OTAPI_Exec::GetMemlogSize</a>()
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a3480267ea10f15c53bb92240aec254ea">OTLog::GetMemlogSize</a>();
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="class_o_t_a_p_i___exec.html#a501a0c5fa22dd7a33e3da67002b8690b">00403</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a501a0c5fa22dd7a33e3da67002b8690b">OTAPI_Exec::GetMemlogAtIndex</a>(<span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a501a0c5fa22dd7a33e3da67002b8690b">OTLog::GetMemlogAtIndex</a>(nIndex).Get();
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad6bbb4e5c846af672961cf6d9598be30">00409</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad6bbb4e5c846af672961cf6d9598be30">OTAPI_Exec::PeekMemlogFront</a>()
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#ad6bbb4e5c846af672961cf6d9598be30">OTLog::PeekMemlogFront</a>().Get();
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2feab2347517775be8be3edc4696d603">00415</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2feab2347517775be8be3edc4696d603">OTAPI_Exec::PeekMemlogBack</a>()
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a2feab2347517775be8be3edc4696d603">OTLog::PeekMemlogBack</a>().Get();
<a name="l00418"></a>00418 }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab78238ec98eb77bc76fb018835302037">00421</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ab78238ec98eb77bc76fb018835302037">OTAPI_Exec::PopMemlogFront</a>()
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#ab78238ec98eb77bc76fb018835302037">OTLog::PopMemlogFront</a>();
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="class_o_t_a_p_i___exec.html#afdef7ce04ff0ddc2f67f626739ebaae6">00427</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#afdef7ce04ff0ddc2f67f626739ebaae6">OTAPI_Exec::PopMemlogBack</a>()
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afdef7ce04ff0ddc2f67f626739ebaae6">OTLog::PopMemlogBack</a>();
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 <span class="comment">// OpenTransactions.h</span>
<a name="l00435"></a>00435 <span class="comment">//bool      NumList_Add        (OTNumList &amp; theList, const OTNumList &amp; theNewNumbers);</span>
<a name="l00436"></a>00436 <span class="comment">//bool      NumList_Remove     (OTNumList &amp; theList, const OTNumList &amp; theOldNumbers);</span>
<a name="l00437"></a>00437 <span class="comment">//bool      NumList_VerifyQuery(OTNumList &amp; theList, const OTNumList &amp; theQueryNumbers);</span>
<a name="l00438"></a>00438 <span class="comment">//bool      NumList_VerifyAll  (OTNumList &amp; theList, const OTNumList &amp; theQueryNumbers);</span>
<a name="l00439"></a>00439 <span class="comment">//int32_t   NumList_Count      (OTNumList &amp; theList);</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">// OTAPI_funcdef.h</span>
<a name="l00442"></a>00442 <span class="comment">//std::string      OTAPI_Exec::NumList_Add        (const std::string &amp; strNumList, const std::string &amp; strNumbers);</span>
<a name="l00443"></a>00443 <span class="comment">//std::string      OTAPI_Exec::NumList_Remove     (const std::string &amp; strNumList, const std::string &amp; strNumbers);</span>
<a name="l00444"></a>00444 <span class="comment">//int32_t          OTAPI_Exec::NumList_VerifyQuery(const std::string &amp; strNumList, const std::string &amp; strNumbers); // returns bool</span>
<a name="l00445"></a>00445 <span class="comment">//int32_t          OTAPI_Exec::NumList_VerifyAll  (const std::string &amp; strNumList, const std::string &amp; strNumbers); // returns bool</span>
<a name="l00446"></a>00446 <span class="comment">//int32_t          OTAPI_Exec::NumList_Count      (const std::string &amp; strNumList);</span>
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="comment">// Returns new list if ALL strNumbers are successfully added to strNumList.</span>
<a name="l00450"></a>00450 <span class="comment">// Otherwise returns &quot;&quot; and doesn&#39;t change anything.</span>
<a name="l00451"></a>00451 <span class="comment">//</span>
<a name="l00452"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9124f2093af217b37497f16941e1adc4">00452</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a9124f2093af217b37497f16941e1adc4">OTAPI_Exec::NumList_Add</a>(<span class="keyword">const</span> std::string &amp; strNumList, <span class="keyword">const</span> std::string &amp; strNumbers)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <span class="comment">// -----------------------------------------------------</span>
<a name="l00455"></a>00455     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00456"></a>00456     <span class="keywordflow">if</span> (!bIsInitialized)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (strNumbers.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumbers&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">// strNumList can be null, (create a new one).</span>
<a name="l00460"></a>00460     <span class="comment">// -----------------------------------------------------</span>
<a name="l00461"></a>00461     <a class="code" href="class_o_t_num_list.html">OTNumList</a> theList, theNewNumbers(strNumbers);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (<span class="stringliteral">&quot;&quot;</span> != strNumList)
<a name="l00464"></a>00464     {
<a name="l00465"></a>00465         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> otstrNumList(strNumList);
<a name="l00466"></a>00466         theList.Add(otstrNumList);
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a12f34568b5ed20e3d1744f30e472f454">NumList_Add</a>(theList, theNewNumbers);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (bAdded &amp;&amp; theList.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strOutput))
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="keywordflow">return</span> pBuf;
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="comment">// Returns new list if ALL strNumbers are successfully removed from strNumList.</span>
<a name="l00483"></a>00483 <span class="comment">// Otherwise returns &quot;&quot; and doesn&#39;t change anything.</span>
<a name="l00484"></a>00484 <span class="comment">//</span>
<a name="l00485"></a><a class="code" href="class_o_t_a_p_i___exec.html#a133aaf7224244c363135a98aaef1df18">00485</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a133aaf7224244c363135a98aaef1df18">OTAPI_Exec::NumList_Remove</a>(<span class="keyword">const</span> std::string &amp; strNumList, <span class="keyword">const</span> std::string &amp; strNumbers)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <span class="comment">// -----------------------------------------------------</span>
<a name="l00488"></a>00488     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00489"></a>00489     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="keywordflow">if</span> (strNumList.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumList&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (strNumbers.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumbers&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00493"></a>00493     <span class="comment">// -----------------------------------------------------</span>
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <a class="code" href="class_o_t_num_list.html">OTNumList</a> theList(strNumList), theNewNumbers(strNumbers);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bRemoved = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a577cd1a86933ded118347ca37f537cee">NumList_Remove</a>(theList, theNewNumbers);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (bRemoved &amp;&amp; theList.Output(strOutput))
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="keywordflow">return</span> pBuf;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 <span class="comment">// Verifies strNumbers as a SUBSET of strNumList.</span>
<a name="l00511"></a>00511 <span class="comment">//</span>
<a name="l00512"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae87e416912965485351808676feb6421">00512</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ae87e416912965485351808676feb6421">OTAPI_Exec::NumList_VerifyQuery</a>(<span class="keyword">const</span> std::string &amp; strNumList, <span class="keyword">const</span> std::string &amp; strNumbers)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514     <span class="comment">// -----------------------------------------------------</span>
<a name="l00515"></a>00515     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="keywordflow">if</span> (strNumList.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumList&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (strNumbers.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumbers&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00520"></a>00520     <span class="comment">// -----------------------------------------------------</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <a class="code" href="class_o_t_num_list.html">OTNumList</a> theList(strNumList), theNewNumbers(strNumbers);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bVerified = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ac2bbcfd6aa2d7a7bf0f6a78b4dd2a654">NumList_VerifyQuery</a>(theList, theNewNumbers);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <span class="keywordflow">return</span> bVerified ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">// Verifies COUNT and CONTENT but NOT ORDER.</span>
<a name="l00530"></a>00530 <span class="comment">//</span>
<a name="l00531"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac288e2bf16e7f738d5450e5f43fdcc31">00531</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ac288e2bf16e7f738d5450e5f43fdcc31">OTAPI_Exec::NumList_VerifyAll</a>(<span class="keyword">const</span> std::string &amp; strNumList, <span class="keyword">const</span> std::string &amp; strNumbers)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <span class="comment">// -----------------------------------------------------</span>
<a name="l00534"></a>00534     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (!bIsInitialized)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (strNumList.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumList&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (strNumbers.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumbers&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00538"></a>00538     <span class="comment">// -----------------------------------------------------</span>
<a name="l00539"></a>00539     <a class="code" href="class_o_t_num_list.html">OTNumList</a> theList(strNumList), theNewNumbers(strNumbers);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bVerified = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a909a6234b5e4dd04059a7e86f7883d1c">NumList_VerifyAll</a>(theList, theNewNumbers);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="keywordflow">return</span> bVerified ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6f109e383929c540c666db2c64932834">00546</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a6f109e383929c540c666db2c64932834">OTAPI_Exec::NumList_Count</a>(<span class="keyword">const</span> std::string &amp; strNumList)
<a name="l00547"></a>00547 {
<a name="l00548"></a>00548     <span class="comment">// -----------------------------------------------------</span>
<a name="l00549"></a>00549     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (!bIsInitialized)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (strNumList.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strNumList&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00552"></a>00552     <span class="comment">// -----------------------------------------------------</span>
<a name="l00553"></a>00553     <a class="code" href="class_o_t_num_list.html">OTNumList</a> theList(strNumList);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ad6a7774af0f1af97fe6c36c396e054a3">NumList_Count</a>(theList);
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 <span class="comment">// --------------------------------------------------</span>
<a name="l00562"></a>00562 <span class="comment">// CREATE NYM  -- Create new User</span>
<a name="l00563"></a>00563 <span class="comment">//</span>
<a name="l00564"></a>00564 <span class="comment">// Creates a new Nym and adds it to the wallet.</span>
<a name="l00565"></a>00565 <span class="comment">// (Including PUBLIC and PRIVATE KEYS.)</span>
<a name="l00566"></a>00566 <span class="comment">//</span>
<a name="l00567"></a>00567 <span class="comment">// Returns a new User ID (with files already created)</span>
<a name="l00568"></a>00568 <span class="comment">// or &quot;&quot; upon failure.</span>
<a name="l00569"></a>00569 <span class="comment">//</span>
<a name="l00570"></a>00570 <span class="comment">// Once it exists, use OTAPI_Exec::createUserAccount() to</span>
<a name="l00571"></a>00571 <span class="comment">// register your new Nym at any given Server. (Nearly all</span>
<a name="l00572"></a>00572 <span class="comment">// server requests require this...)</span>
<a name="l00573"></a>00573 <span class="comment">//</span>
<a name="l00574"></a><a class="code" href="class_o_t_a_p_i___exec.html#aac00d07de2eaef92ce3439ae04280502">00574</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aac00d07de2eaef92ce3439ae04280502">OTAPI_Exec::CreateNym</a>(<span class="keyword">const</span> int32_t     &amp; nKeySize, <span class="comment">// must be 1024, 2048, 4096, or 8192</span>
<a name="l00575"></a>00575                                   <span class="keyword">const</span> std::string &amp; NYM_ID_SOURCE, <span class="comment">// Can be empty.</span>
<a name="l00576"></a>00576                                   <span class="keyword">const</span> std::string &amp; ALT_LOCATION)  <span class="comment">// Can be empty.</span>
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (0 &gt;= nKeySize) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Keysize is 0 or less, will fail! Try 1024.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00579"></a>00579     <span class="comment">// -----------------------------------------------------</span>
<a name="l00580"></a>00580     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0de395c333a49913b59ae8cac223d526">CreateNym</a>(nKeySize, NYM_ID_SOURCE, ALT_LOCATION);
<a name="l00581"></a>00581     <span class="keywordflow">if</span> (NULL == pNym) <span class="comment">// Creation failed.</span>
<a name="l00582"></a>00582     {
<a name="l00583"></a>00583         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to create Nym.\n&quot;</span>, __FUNCTION__);
<a name="l00584"></a>00584         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     <span class="comment">// -----------------------------------------------------}</span>
<a name="l00587"></a>00587     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l00588"></a>00588     pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strOutput); <span class="comment">// We&#39;re returning the new Nym ID.</span>
<a name="l00589"></a>00589     <span class="comment">// --------------------------------</span>
<a name="l00590"></a>00590     <span class="keywordflow">if</span> (strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>()) <span class="keywordflow">return</span> strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00591"></a>00591     <span class="comment">// --------------------------------</span>
<a name="l00592"></a>00592     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa2284a93c77800307c39eb84a02004e6">00596</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa2284a93c77800307c39eb84a02004e6">OTAPI_Exec::GetNym_ActiveCronItemIDs</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00597"></a>00597     <span class="keyword">const</span> std::string &amp; SERVER_ID)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599     <span class="keywordflow">if</span> (NYM_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00600"></a>00600     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00601"></a>00601     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00602"></a>00602     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> nymId(NYM_ID), serverId(SERVER_ID);
<a name="l00603"></a>00603     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00604"></a>00604     <a class="code" href="class_o_t_num_list.html">OTNumList</a>   numlist;
<a name="l00605"></a>00605     std::string str_return;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_cron_item.html#a2b91cb56eae85d198ef450d0140f1eac">OTCronItem::GetActiveCronTransNums</a>(numlist, nymId, serverId))
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l00610"></a>00610         numlist.<a class="code" href="class_o_t_num_list.html#a3ebc9e933a8c248d0fdd0b11a3c49fe4">Output</a>(strOutput);
<a name="l00611"></a>00611         str_return = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordflow">return</span> str_return;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="class_o_t_a_p_i___exec.html#abacd1cfa131cd2f8c2b086560137c80e">00617</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abacd1cfa131cd2f8c2b086560137c80e">OTAPI_Exec::GetActiveCronItem</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, int64_t lTransNum)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (0 &gt; lTransNum)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;lTransNum&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00621"></a>00621     <span class="comment">// --------------------------------------</span>
<a name="l00622"></a>00622     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> serverId(SERVER_ID);
<a name="l00623"></a>00623     std::string        str_return;
<a name="l00624"></a>00624     <span class="comment">// --------------------------------------</span>
<a name="l00625"></a>00625     <span class="keyword">const</span> int64_t lTransactionNum = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(lTransNum);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = <a class="code" href="class_o_t_cron_item.html#a9478c280789d9400a4b7933626397ece">OTCronItem::LoadActiveCronReceipt</a>(lTransactionNum, serverId);
<a name="l00628"></a>00628     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theCronItemAngel(pCronItem);
<a name="l00629"></a>00629     <span class="comment">// --------------------------------------</span>
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (NULL != pCronItem)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCronItem(*pCronItem);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         str_return = strCronItem.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636     <span class="comment">// --------------------------------------</span>
<a name="l00637"></a>00637     <span class="keywordflow">return</span> str_return;
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 
<a name="l00641"></a><a class="code" href="class_o_t_a_p_i___exec.html#a772c6fa41664d32d56b0e375487ec975">00641</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a772c6fa41664d32d56b0e375487ec975">OTAPI_Exec::GetNym_SourceForID</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00644"></a>00644     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00645"></a>00645     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00646"></a>00646     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00647"></a>00647     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00648"></a>00648     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00650"></a>00650     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00651"></a>00651     <span class="keyword">const</span> std::string str_return(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab76ac495443316ded275e7bb281388d2">GetNymIDSource</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00652"></a>00652     <span class="keywordflow">return</span> str_return;
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="class_o_t_a_p_i___exec.html#aaad4d7b8a45b1620a6be71288f864c49">00656</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aaad4d7b8a45b1620a6be71288f864c49">OTAPI_Exec::GetNym_AltSourceLocation</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00659"></a>00659     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00660"></a>00660     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00661"></a>00661     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00662"></a>00662     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00663"></a>00663     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00665"></a>00665     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00666"></a>00666     <span class="keyword">const</span> std::string str_return(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ab8bd7424e1b95220cfe66372295664ff">GetAltLocation</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00667"></a>00667     <span class="keywordflow">return</span> str_return;
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1ee6c7e064c4df21af237c2f75bd75b5">00670</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a1ee6c7e064c4df21af237c2f75bd75b5">OTAPI_Exec::GetNym_CredentialCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l00671"></a>00671 {
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00673"></a>00673     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00674"></a>00674     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00675"></a>00675     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00676"></a>00676     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00677"></a>00677     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
<a name="l00679"></a>00679     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00680"></a>00680     <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a6ae670b44bc6728da06141c885e6c7e9">GetMasterCredentialCount</a>());
<a name="l00681"></a>00681     <span class="keywordflow">return</span> nReturnValue;
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 
<a name="l00685"></a><a class="code" href="class_o_t_a_p_i___exec.html#abbe0ccf755337f5baf3b68a36daf067e">00685</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abbe0ccf755337f5baf3b68a36daf067e">OTAPI_Exec::GetNym_CredentialID</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00686"></a>00686                                             <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l00687"></a>00687 {
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00689"></a>00689     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00690"></a>00690     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00691"></a>00691     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00692"></a>00692     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00693"></a>00693     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00695"></a>00695     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00696"></a>00696     std::string    str_return;
<a name="l00697"></a>00697     <span class="keyword">const</span> <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ae32a4525f158913b21f010a796f5fc29">GetMasterCredentialByIndex</a>(static_cast&lt;const int32_t&gt;(nIndex));
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (NULL != pCredential)
<a name="l00700"></a>00700         str_return = pCredential-&gt;<a class="code" href="class_o_t_credential.html#a1e99eeeb4d701f2ea9b56a1201a57680">GetMasterCredID</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00701"></a>00701     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00702"></a>00702     <span class="keywordflow">return</span> str_return;
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8a6bd5cb6059ceea858abb4953af8381">00706</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8a6bd5cb6059ceea858abb4953af8381">OTAPI_Exec::GetNym_CredentialContents</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00707"></a>00707                                                   <span class="keyword">const</span> std::string &amp; CREDENTIAL_ID)
<a name="l00708"></a>00708 {
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00710"></a>00710     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00711"></a>00711     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00712"></a>00712     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00713"></a>00713     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00714"></a>00714     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00716"></a>00716     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00717"></a>00717     std::string    str_return;
<a name="l00718"></a>00718     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(CREDENTIAL_ID);
<a name="l00719"></a>00719     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (NULL != pCredential) <span class="comment">// Found the master credential...</span>
<a name="l00722"></a>00722         str_return = pCredential-&gt;<a class="code" href="class_o_t_credential.html#ab3e65e4abc6a9f2a04047044682329c2">GetPubCredential</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00723"></a>00723     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00724"></a>00724     <span class="keywordflow">return</span> str_return;
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 
<a name="l00728"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0d96420d6faaf80cd76c93a2334b97ec">00728</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a0d96420d6faaf80cd76c93a2334b97ec">OTAPI_Exec::GetNym_RevokedCredCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l00729"></a>00729 {
<a name="l00730"></a>00730     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00731"></a>00731     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00732"></a>00732     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00733"></a>00733     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00734"></a>00734     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00735"></a>00735     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
<a name="l00737"></a>00737     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00738"></a>00738     <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66d28c9b0919dac455167326af405371">GetRevokedCredentialCount</a>());
<a name="l00739"></a>00739     <span class="keywordflow">return</span> nReturnValue;
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 
<a name="l00743"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9b7ff670be66f5bf5bbff7db78b6ebf2">00743</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a9b7ff670be66f5bf5bbff7db78b6ebf2">OTAPI_Exec::GetNym_RevokedCredID</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00744"></a>00744                                              <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l00745"></a>00745 {
<a name="l00746"></a>00746     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00747"></a>00747     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00748"></a>00748     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00749"></a>00749     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00750"></a>00750     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00751"></a>00751     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00752"></a>00752     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00753"></a>00753     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00754"></a>00754     std::string str_return;
<a name="l00755"></a>00755     <span class="keyword">const</span> <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a8b367e9ec526a0621be52bd5569f3b13">GetRevokedCredentialByIndex</a>(static_cast&lt;const int32_t&gt;(nIndex));
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (NULL != pCredential)
<a name="l00758"></a>00758     {
<a name="l00759"></a>00759         str_return = pCredential-&gt;<a class="code" href="class_o_t_credential.html#a1e99eeeb4d701f2ea9b56a1201a57680">GetMasterCredID</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00762"></a>00762     <span class="keywordflow">return</span> str_return;
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="class_o_t_a_p_i___exec.html#abecce474328d66d0d14d6f207c6f16b5">00766</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abecce474328d66d0d14d6f207c6f16b5">OTAPI_Exec::GetNym_RevokedCredContents</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00767"></a>00767                                                    <span class="keyword">const</span> std::string &amp; CREDENTIAL_ID)
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00770"></a>00770     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00771"></a>00771     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00772"></a>00772     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00773"></a>00773     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00774"></a>00774     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00775"></a>00775     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00776"></a>00776     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00777"></a>00777     std::string str_return;
<a name="l00778"></a>00778     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(CREDENTIAL_ID);
<a name="l00779"></a>00779     <span class="keyword">const</span> <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a34722ae73d2b67e12c92ac770f7dd6f1">GetRevokedCredential</a>(strCredID);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="keywordflow">if</span> (NULL != pCredential) <span class="comment">// Found the (revoked) master credential...</span>
<a name="l00782"></a>00782         str_return = pCredential-&gt;<a class="code" href="class_o_t_credential.html#ab3e65e4abc6a9f2a04047044682329c2">GetPubCredential</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00783"></a>00783     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00784"></a>00784     <span class="keywordflow">return</span> str_return;
<a name="l00785"></a>00785 }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 
<a name="l00788"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8ff237ded0d5329cda022ff0570092eb">00788</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a8ff237ded0d5329cda022ff0570092eb">OTAPI_Exec::GetNym_SubcredentialCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00789"></a>00789                                               <span class="keyword">const</span> std::string &amp; MASTER_CRED_ID)
<a name="l00790"></a>00790 {
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00792"></a>00792     <span class="keywordflow">if</span> (MASTER_CRED_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MASTER_CRED_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00793"></a>00793     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00794"></a>00794     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00795"></a>00795     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00796"></a>00796     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00797"></a>00797     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00798"></a>00798     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> (-1);
<a name="l00799"></a>00799     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00800"></a>00800     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(MASTER_CRED_ID);
<a name="l00801"></a>00801     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="keywordflow">if</span> (NULL != pCredential) <span class="comment">// Found the master credential...</span>
<a name="l00804"></a>00804     {
<a name="l00805"></a>00805         <span class="keyword">const</span> <span class="keywordtype">size_t</span> nSubCredCount = pCredential-&gt;<a class="code" href="class_o_t_credential.html#a03f9d76360128e0985ce9ab8fc3e9fc4">GetSubcredentialCount</a>();
<a name="l00806"></a>00806 
<a name="l00807"></a>00807         <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nSubCredCount);
<a name="l00808"></a>00808         <span class="keywordflow">return</span> nReturnValue;
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     <span class="keywordflow">return</span> (-1);
<a name="l00812"></a>00812 }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8beb45adf3c81242a23a990d2dad8425">00815</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8beb45adf3c81242a23a990d2dad8425">OTAPI_Exec::GetNym_SubCredentialID</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00816"></a>00816                                                <span class="keyword">const</span> std::string &amp; MASTER_CRED_ID,
<a name="l00817"></a>00817                                                <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00820"></a>00820     <span class="keywordflow">if</span> (MASTER_CRED_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MASTER_CRED_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00821"></a>00821     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00822"></a>00822     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00823"></a>00823     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00824"></a>00824     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00825"></a>00825     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00826"></a>00826     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00827"></a>00827     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00828"></a>00828     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(MASTER_CRED_ID);
<a name="l00829"></a>00829     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (NULL != pCredential) <span class="comment">// Found the master credential...</span>
<a name="l00832"></a>00832         <span class="keywordflow">return</span> pCredential-&gt;<a class="code" href="class_o_t_credential.html#a9767fa303af5c9a9e9a742d9f72ef834">GetSubcredentialIDByIndex</a>(static_cast&lt;const int32_t&gt;(nIndex));
<a name="l00833"></a>00833 
<a name="l00834"></a>00834     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 
<a name="l00838"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4434157ca86a4bd56620f3cc68ccbde0">00838</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4434157ca86a4bd56620f3cc68ccbde0">OTAPI_Exec::GetNym_SubCredentialContents</a>(<span class="keyword">const</span> std::string &amp; NYM_ID,
<a name="l00839"></a>00839                                                      <span class="keyword">const</span> std::string &amp; MASTER_CRED_ID,
<a name="l00840"></a>00840                                                      <span class="keyword">const</span> std::string &amp; SUB_CRED_ID)
<a name="l00841"></a>00841 {
<a name="l00842"></a>00842     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00843"></a>00843     <span class="keywordflow">if</span> (MASTER_CRED_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MASTER_CRED_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00844"></a>00844     <span class="keywordflow">if</span> (SUB_CRED_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SUB_CRED_ID&quot;</span>);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00845"></a>00845     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00846"></a>00846     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00847"></a>00847     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00848"></a>00848     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00849"></a>00849     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00850"></a>00850     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00851"></a>00851     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00852"></a>00852     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(MASTER_CRED_ID);
<a name="l00853"></a>00853     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (NULL != pCredential) <span class="comment">// Found the master credential...</span>
<a name="l00856"></a>00856     {
<a name="l00857"></a>00857         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strSubID(SUB_CRED_ID);
<a name="l00858"></a>00858         <span class="keyword">const</span> <a class="code" href="class_o_t_subcredential.html">OTSubcredential</a> * pSub = pCredential-&gt;<a class="code" href="class_o_t_credential.html#a194a0401b7e78a94f298897138004e3e">GetSubcredential</a>(strSubID);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (NULL != pSub)
<a name="l00861"></a>00861             <span class="keywordflow">return</span> pSub-&gt;<a class="code" href="class_o_t_subcredential.html#af10db6cd37a86780acbcc0bf1e6101a5">GetPubCredential</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863     <span class="comment">// --------------</span>
<a name="l00864"></a>00864     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 
<a name="l00869"></a><a class="code" href="class_o_t_a_p_i___exec.html#a754e64287eacf85513fc79f3cf6860cb">00869</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a754e64287eacf85513fc79f3cf6860cb">OTAPI_Exec::AddSubcredential</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; MASTER_CRED_ID, <span class="keyword">const</span> int32_t &amp; nKeySize)
<a name="l00870"></a>00870 {
<a name="l00871"></a>00871     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00872"></a>00872     <span class="keywordflow">if</span> (MASTER_CRED_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MASTER_CRED_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (0 &gt;= nKeySize)          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Keysize is 0 or less, will fail! Try 1024.\n&quot;</span>,__FUNCTION__);     <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00874"></a>00874     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00875"></a>00875     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00876"></a>00876     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00877"></a>00877     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00878"></a>00878     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00880"></a>00880     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00881"></a>00881     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(MASTER_CRED_ID);
<a name="l00882"></a>00882     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     <span class="keywordflow">if</span> (NULL == pCredential)
<a name="l00885"></a>00885         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Sorry, (Nym %s) no master credential found with the ID: %s\n&quot;</span>,
<a name="l00886"></a>00886                        __FUNCTION__, NYM_ID.c_str(), strCredID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00887"></a>00887     <span class="keywordflow">else</span> <span class="comment">// Found the master credential...</span>
<a name="l00888"></a>00888     {
<a name="l00889"></a>00889         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idMasterCredential(strCredID);
<a name="l00890"></a>00890         <a class="code" href="class_o_t_string.html">OTString</a> strNewSubcredID;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         <span class="keyword">const</span> <span class="keywordtype">bool</span> bAdded = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a85bd691ffa8d5f066ba04886dccd0d4d">AddNewSubkey</a>(idMasterCredential, nKeySize, NULL, &amp;thePWData, &amp;strNewSubcredID);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894         <span class="keywordflow">if</span> (bAdded)
<a name="l00895"></a>00895         {
<a name="l00896"></a>00896             <span class="keywordflow">return</span> strNewSubcredID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898         <span class="keywordflow">else</span>
<a name="l00899"></a>00899             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to add new subcredential.\n&quot;</span>, __FUNCTION__);
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901     <span class="comment">// --------------</span>
<a name="l00902"></a>00902     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 
<a name="l00906"></a><a class="code" href="class_o_t_a_p_i___exec.html#a71ed07f0a80c69ee796564a1458b3f9b">00906</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a71ed07f0a80c69ee796564a1458b3f9b">OTAPI_Exec::RevokeSubcredential</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; MASTER_CRED_ID, <span class="keyword">const</span> std::string &amp; SUB_CRED_ID)
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>);         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00909"></a>00909     <span class="keywordflow">if</span> (MASTER_CRED_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MASTER_CRED_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (SUB_CRED_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: NULL %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SUB_CRED_ID&quot;</span>);    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00911"></a>00911     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00912"></a>00912     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l00913"></a>00913     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     nym_id(NYM_ID);
<a name="l00914"></a>00914     <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l00915"></a>00915     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(nym_id, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData);
<a name="l00916"></a>00916     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00917"></a>00917     <span class="comment">// ---------------------------------------------------------</span>
<a name="l00918"></a>00918     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strCredID(MASTER_CRED_ID);
<a name="l00919"></a>00919     <a class="code" href="class_o_t_credential.html">OTCredential</a> * pCredential = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a94f8a8812ceae9a1f003aa79bfda73a5">GetMasterCredential</a>(strCredID);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="keywordflow">if</span> (NULL == pCredential)
<a name="l00922"></a>00922         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Sorry, (Nym %s) no master credential found with the ID: %s\n&quot;</span>,
<a name="l00923"></a>00923                        __FUNCTION__, NYM_ID.c_str(), strCredID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00924"></a>00924     <span class="keywordflow">else</span> <span class="comment">// Found the master credential...</span>
<a name="l00925"></a>00925     {
<a name="l00926"></a>00926         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strSubID(SUB_CRED_ID);
<a name="l00927"></a>00927         <span class="keyword">const</span> <a class="code" href="class_o_t_subcredential.html">OTSubcredential</a> * pSub = pCredential-&gt;<a class="code" href="class_o_t_credential.html#a194a0401b7e78a94f298897138004e3e">GetSubcredential</a>(strSubID);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929         <span class="keywordflow">if</span> (NULL == pSub)
<a name="l00930"></a>00930             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Found master credential (%s), but unable to find subcredential with ID: %s\n&quot;</span>,
<a name="l00931"></a>00931                            __FUNCTION__, strCredID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strSubID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l00932"></a>00932         <span class="keywordflow">else</span>
<a name="l00933"></a>00933         {
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 
<a name="l00936"></a>00936             <span class="comment">// TODO: Okay we found master AND subcredential. Now let&#39;s revoke it...</span>
<a name="l00937"></a>00937             <span class="comment">//</span>
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 
<a name="l00940"></a>00940 
<a name="l00941"></a>00941             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;\n\n\nOTAPI_Wrap::%s: TODO: REVOKING IS NOT YET CODED. ADD FUNCTION CALL HERE TO REVOKE SUB-CREDENTIAL!\n\n\n&quot;</span>, __FUNCTION__);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 <span class="comment">//          return true;</span>
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948     <span class="comment">// --------------</span>
<a name="l00949"></a>00949     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00950"></a>00950 }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="class_o_t_a_p_i___exec.html#a497410916b6a8036929551c2d3e45455">00954</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a497410916b6a8036929551c2d3e45455">OTAPI_Exec::CalculateAssetContractID</a>(<span class="keyword">const</span> std::string &amp; str_Contract)
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956     <span class="comment">// -----------------------------------------------------</span>
<a name="l00957"></a>00957     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00959"></a>00959     <span class="comment">// -----------------------------------------------------</span>
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (str_Contract.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;str_Contract&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00961"></a>00961     <span class="comment">// -----------------------------------------------------</span>
<a name="l00962"></a>00962     std::string str_Trim(str_Contract);
<a name="l00963"></a>00963     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l00964"></a>00964     <a class="code" href="class_o_t_string.html">OTString</a> strContract(str_Trim2.c_str());
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (strContract.GetLength() &lt; 2)
<a name="l00967"></a>00967     {
<a name="l00968"></a>00968         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract passed in!\n&quot;</span>, __FUNCTION__);
<a name="l00969"></a>00969         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971     <span class="comment">// -------------------------------------------</span>
<a name="l00972"></a>00972     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> theContract;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keywordflow">if</span> (theContract.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strContract))
<a name="l00975"></a>00975     {
<a name="l00976"></a>00976         <span class="comment">// -------------------------------------------</span>
<a name="l00977"></a>00977         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idOutput;
<a name="l00978"></a>00978         theContract.<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idOutput);
<a name="l00979"></a>00979         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(idOutput);
<a name="l00980"></a>00980         <span class="comment">// -------------------------------------------</span>
<a name="l00981"></a>00981         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         <span class="keywordflow">return</span> pBuf;
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985     <span class="comment">// ----------------</span>
<a name="l00986"></a>00986     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 
<a name="l00990"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8b76995a5783c5686781046249a691a4">00990</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8b76995a5783c5686781046249a691a4">OTAPI_Exec::CalculateServerContractID</a>(<span class="keyword">const</span> std::string &amp; str_Contract)
<a name="l00991"></a>00991 {
<a name="l00992"></a>00992     <span class="comment">// -----------------------------------------------------</span>
<a name="l00993"></a>00993     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l00994"></a>00994     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00995"></a>00995     <span class="comment">// -----------------------------------------------------</span>
<a name="l00996"></a>00996     <span class="keywordflow">if</span> (str_Contract.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;str_Contract&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l00997"></a>00997     <span class="comment">// -----------------------------------------------------</span>
<a name="l00998"></a>00998     std::string str_Trim(str_Contract);
<a name="l00999"></a>00999     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01000"></a>01000     <a class="code" href="class_o_t_string.html">OTString</a> strContract(str_Trim2.c_str());
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     <span class="keywordflow">if</span> (strContract.GetLength() &lt; 2)
<a name="l01003"></a>01003     {
<a name="l01004"></a>01004         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty contract passed in!\n&quot;</span>, __FUNCTION__);
<a name="l01005"></a>01005         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007     <span class="comment">// -------------------------------------------</span>
<a name="l01008"></a>01008     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> theContract;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="keywordflow">if</span> (theContract.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strContract))
<a name="l01011"></a>01011     {
<a name="l01012"></a>01012         <span class="comment">// -------------------------------------------</span>
<a name="l01013"></a>01013         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idOutput;
<a name="l01014"></a>01014         theContract.<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idOutput);
<a name="l01015"></a>01015         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(idOutput);
<a name="l01016"></a>01016         <span class="comment">// -------------------------------------------</span>
<a name="l01017"></a>01017         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         <span class="keywordflow">return</span> pBuf;
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021     <span class="comment">// ----------------</span>
<a name="l01022"></a>01022     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01023"></a>01023 }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 <span class="comment">// Creates a contract based on the contents passed in,</span>
<a name="l01027"></a>01027 <span class="comment">// then sets the contract key based on the NymID,</span>
<a name="l01028"></a>01028 <span class="comment">// and signs it with that Nym.</span>
<a name="l01029"></a>01029 <span class="comment">// This function will also ADD the contract to the wallet.</span>
<a name="l01030"></a>01030 <span class="comment">// Returns: the new contract ID, or &quot;&quot; if failure.</span>
<a name="l01031"></a>01031 <span class="comment">//</span>
<a name="l01032"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0af1034cdeb79f225d424dfb2f9fb45c">01032</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a0af1034cdeb79f225d424dfb2f9fb45c">OTAPI_Exec::CreateServerContract</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; strXMLcontents)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034     <span class="comment">// -----------------------------------------------------</span>
<a name="l01035"></a>01035     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01039"></a>01039     <span class="keywordflow">if</span> (strXMLcontents.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strXMLcontents&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01040"></a>01040     <span class="comment">// -----------------------------------------------------</span>
<a name="l01041"></a>01041 
<a name="l01042"></a>01042     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
<a name="l01043"></a>01043     <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01044"></a>01044     <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
<a name="l01045"></a>01045     <span class="comment">// -----------------------------------------------------</span>
<a name="l01046"></a>01046     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(NYM_ID);
<a name="l01047"></a>01047     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01049"></a>01049     <span class="comment">// -------------------------------------------</span>
<a name="l01050"></a>01050     std::string str_Trim(strXMLcontents);
<a name="l01051"></a>01051     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01052"></a>01052     <a class="code" href="class_o_t_string.html">OTString</a> strContract(str_Trim2.c_str());
<a name="l01053"></a>01053 
<a name="l01054"></a>01054     <span class="keywordflow">if</span> (strContract.GetLength() &lt; 2)
<a name="l01055"></a>01055     {
<a name="l01056"></a>01056         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty XML contents passed in! (Failure.)\n&quot;</span>, __FUNCTION__);
<a name="l01057"></a>01057         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059     <span class="comment">// -------------------------------------------</span>
<a name="l01060"></a>01060     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>;
<a name="l01061"></a>01061     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pContract);
<a name="l01062"></a>01062     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTServerContract&gt;</a> theAngel(*pContract);
<a name="l01063"></a>01063     pContract-&gt;<a class="code" href="class_o_t_contract.html#aefeed014e39aa6dc843d090e03769b5d">CreateContract</a>(strContract, *pNym); <span class="comment">// &lt;==========  **** CREATE CONTRACT!! ****</span>
<a name="l01064"></a>01064     <span class="comment">// -------------------------------------------</span>
<a name="l01065"></a>01065     <span class="comment">// But does it meet our requirements?</span>
<a name="l01066"></a>01066     <span class="comment">//</span>
<a name="l01067"></a>01067     <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pContractKeyNym = pContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l01068"></a>01068 <span class="comment">//  const OTAsymmetricKey * pKey = pContract-&gt;GetContractPublicKey();</span>
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="keywordflow">if</span> (NULL == pContractKeyNym)
<a name="l01071"></a>01071     {
<a name="l01072"></a>01072         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Missing &#39;key&#39; tag with name=\&quot;contract\&quot; and text value containing &quot;</span>
<a name="l01073"></a>01073             <span class="stringliteral">&quot;the public cert or public key of the signer Nym. (Please add it first. Failure.)\n&quot;</span>,
<a name="l01074"></a>01074             __FUNCTION__);
<a name="l01075"></a>01075         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(*pContractKeyNym))
<a name="l01078"></a>01078     {
<a name="l01079"></a>01079         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Found &#39;key&#39; tag with name=\&quot;contract\&quot; and text value, but it apparently does NOT contain &quot;</span>
<a name="l01080"></a>01080             <span class="stringliteral">&quot;the public cert or public key of the signer Nym. Please fix that first; see the sample data. (Failure.)\n&quot;</span>,
<a name="l01081"></a>01081             __FUNCTION__);
<a name="l01082"></a>01082         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084     <span class="comment">/*</span>
<a name="l01085"></a>01085 <span class="comment">    &lt;key name=&quot;contract&quot;&gt;</span>
<a name="l01086"></a>01086 <span class="comment">    - -----BEGIN CERTIFICATE-----</span>
<a name="l01087"></a>01087 <span class="comment">    MIICZjCCAc+gAwIBAgIJAO14L19TJgzcMA0GCSqGSIb3DQEBBQUAMFcxCzAJBgNV</span>
<a name="l01088"></a>01088 <span class="comment">    BAYTAlVTMREwDwYDVQQIEwhWaXJnaW5pYTEQMA4GA1UEBxMHRmFpcmZheDERMA8G</span>
<a name="l01089"></a>01089 <span class="comment">    A1UEChMIWm9yay5vcmcxEDAOBgNVBAMTB1Jvb3QgQ0EwHhcNMTAwOTI5MDUyMzAx</span>
<a name="l01090"></a>01090 <span class="comment">    WhcNMjAwOTI2MDUyMzAxWjBeMQswCQYDVQQGEwJVUzERMA8GA1UECBMIVmlyZ2lu</span>
<a name="l01091"></a>01091 <span class="comment">    aWExEDAOBgNVBAcTB0ZhaXJmYXgxETAPBgNVBAoTCFpvcmsub3JnMRcwFQYDVQQD</span>
<a name="l01092"></a>01092 <span class="comment">    Ew5zaGVsbC56b3JrLm9yZzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA3vD9</span>
<a name="l01093"></a>01093 <span class="comment">    fO4ov4854L8wXrgfv2tltDz0ieVrTNSLuy1xuQyb//+MwZ0EYwu8jMMQrqbUaYG6</span>
<a name="l01094"></a>01094 <span class="comment">    y8zJu32yBKrBNPPwJ+fJE+tfgVg860dGVbwMd4KhpkKtppJXmZaGqLqvELaXa4Uw</span>
<a name="l01095"></a>01095 <span class="comment">    9N3qg/faj0NMEDIBhv/tD/B5U65vH+U0JlRJ07kCAwEAAaMzMDEwCQYDVR0TBAIw</span>
<a name="l01096"></a>01096 <span class="comment">    ADAkBgNVHREEHTAbgg5zaGVsbC56b3JrLm9yZ4IJbG9jYWxob3N0MA0GCSqGSIb3</span>
<a name="l01097"></a>01097 <span class="comment">    DQEBBQUAA4GBALLXPa/naWsiXsw0JwlSiG7aOmvMF2romUkcr6uObhN7sghd38M0</span>
<a name="l01098"></a>01098 <span class="comment">    l2kKTiptnA8txrri8RhqmQgOgiyKFCKBkxY7/XGot62cE8Y1+lqGXlhu2UHm6NjA</span>
<a name="l01099"></a>01099 <span class="comment">    pRKvng75J2HTjmmsbCHy+nexn4t44wssfPYlGPD8sGwmO24u9tRfdzJE</span>
<a name="l01100"></a>01100 <span class="comment">    - -----END CERTIFICATE-----</span>
<a name="l01101"></a>01101 <span class="comment">    &lt;/key&gt;</span>
<a name="l01102"></a>01102 <span class="comment">    */</span>
<a name="l01103"></a>01103     <span class="comment">// -------------------------------------------</span>
<a name="l01104"></a>01104     <a class="code" href="class_o_t_string.html">OTString</a> strHostname; int32_t nPort=0;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pContract-&gt;<a class="code" href="class_o_t_server_contract.html#a0714f92ddd215d7a0120dffc4c9c8cd5">GetConnectInfo</a>(strHostname, nPort))
<a name="l01107"></a>01107     {
<a name="l01108"></a>01108         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to retrieve connection info from this contract. Please &quot;</span>
<a name="l01109"></a>01109             <span class="stringliteral">&quot;fix that first; see the sample data. (Failure.)\n&quot;</span>, __FUNCTION__);
<a name="l01110"></a>01110         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01111"></a>01111     }
<a name="l01112"></a>01112     <span class="comment">// -------------------------------------------</span>
<a name="l01113"></a>01113     <span class="comment">// By this point, we know that the &quot;contract&quot; key is properly attached</span>
<a name="l01114"></a>01114     <span class="comment">// to the raw XML contents, AND that the NymID for that key matches</span>
<a name="l01115"></a>01115     <span class="comment">// the NymID passed into this function.</span>
<a name="l01116"></a>01116     <span class="comment">// We also know that the connect info was properly attached to this</span>
<a name="l01117"></a>01117     <span class="comment">// server contract.</span>
<a name="l01118"></a>01118     <span class="comment">// So we can proceed to add it to the wallet...</span>
<a name="l01119"></a>01119     <span class="comment">//</span>
<a name="l01120"></a>01120     <span class="comment">// -----------------------------------------------------</span>
<a name="l01121"></a>01121     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idOutput;
<a name="l01122"></a>01122     pContract-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idOutput);
<a name="l01123"></a>01123     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(idOutput);
<a name="l01124"></a>01124 
<a name="l01125"></a>01125     pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad925633d8ba2319948b466ca0f0dc438">AddServerContract</a>(*pContract);
<a name="l01126"></a>01126     theAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(NULL); <span class="comment">// (No need to cleanup anymore.)</span>
<a name="l01127"></a>01127     pContract = NULL; <span class="comment">// Success. The wallet &quot;owns&quot; it now, no need to clean it up.</span>
<a name="l01128"></a>01128     <span class="comment">// -------------------------------------------</span>
<a name="l01129"></a>01129     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="keywordflow">return</span> pBuf;
<a name="l01132"></a>01132 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 
<a name="l01135"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3dd567a06b35109c704db1e0ca6f604b">01135</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a3dd567a06b35109c704db1e0ca6f604b">OTAPI_Exec::CreateAssetContract</a> (<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; strXMLcontents )
<a name="l01136"></a>01136 {
<a name="l01137"></a>01137     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01138"></a>01138     <span class="comment">// -----------------------------------------------------</span>
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (!bIsInitialized)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01140"></a>01140     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01141"></a>01141     <span class="keywordflow">if</span> (strXMLcontents.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strXMLcontents&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01142"></a>01142     <span class="comment">// -----------------------------------------------------</span>
<a name="l01143"></a>01143     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
<a name="l01144"></a>01144     <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01145"></a>01145     <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
<a name="l01146"></a>01146     <span class="comment">// -----------------------------------------------------</span>
<a name="l01147"></a>01147     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(NYM_ID);
<a name="l01148"></a>01148     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l01149"></a>01149     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01150"></a>01150     <span class="comment">// -------------------------------------------</span>
<a name="l01151"></a>01151     std::string str_Trim(strXMLcontents);
<a name="l01152"></a>01152     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01153"></a>01153     <a class="code" href="class_o_t_string.html">OTString</a> strContract(str_Trim2.c_str());
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     <span class="keywordflow">if</span> (strContract.GetLength() &lt; 2)
<a name="l01156"></a>01156     {
<a name="l01157"></a>01157         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Empty XML contents passed in! (Failure.)\n&quot;</span>, __FUNCTION__);
<a name="l01158"></a>01158         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160     <span class="comment">// -------------------------------------------</span>
<a name="l01161"></a>01161     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a>;
<a name="l01162"></a>01162     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pContract);
<a name="l01163"></a>01163     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAssetContract&gt;</a> theAngel(*pContract);
<a name="l01164"></a>01164     pContract-&gt;<a class="code" href="class_o_t_contract.html#aefeed014e39aa6dc843d090e03769b5d">CreateContract</a>(strContract, *pNym); <span class="comment">// &lt;==========  **** CREATE CONTRACT!! ****</span>
<a name="l01165"></a>01165     <span class="comment">// -------------------------------------------</span>
<a name="l01166"></a>01166     <span class="comment">// But does it meet our requirements?</span>
<a name="l01167"></a>01167     <span class="comment">//</span>
<a name="l01168"></a>01168     <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pContractKeyNym = pContract-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l01169"></a>01169 <span class="comment">//  const OTAsymmetricKey * pKey = pContract-&gt;GetContractPublicKey();</span>
<a name="l01170"></a>01170 
<a name="l01171"></a>01171     <span class="keywordflow">if</span> (NULL == pContractKeyNym)
<a name="l01172"></a>01172     {
<a name="l01173"></a>01173         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Missing &#39;key&#39; tag with name=\&quot;contract\&quot; and text value containing &quot;</span>
<a name="l01174"></a>01174             <span class="stringliteral">&quot;the public cert or public key of the signer Nym. (Please add it first. Failure.)\n&quot;</span>,
<a name="l01175"></a>01175             __FUNCTION__);
<a name="l01176"></a>01176         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5ec9340b8d1d0fcd32f754ea63f9915a">CompareID</a>(*pContractKeyNym))
<a name="l01179"></a>01179     {
<a name="l01180"></a>01180         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Found &#39;key&#39; tag with name=\&quot;contract\&quot; and text value, but it apparently does NOT contain &quot;</span>
<a name="l01181"></a>01181             <span class="stringliteral">&quot;the public cert or public key of the signer Nym. Please fix that first; see the sample data. (Failure.)\n&quot;</span>,
<a name="l01182"></a>01182             __FUNCTION__);
<a name="l01183"></a>01183         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185     <span class="comment">/*</span>
<a name="l01186"></a>01186 <span class="comment">    &lt;key name=&quot;contract&quot;&gt;</span>
<a name="l01187"></a>01187 <span class="comment">    - -----BEGIN CERTIFICATE-----</span>
<a name="l01188"></a>01188 <span class="comment">    MIICZjCCAc+gAwIBAgIJAO14L19TJgzcMA0GCSqGSIb3DQEBBQUAMFcxCzAJBgNV</span>
<a name="l01189"></a>01189 <span class="comment">    BAYTAlVTMREwDwYDVQQIEwhWaXJnaW5pYTEQMA4GA1UEBxMHRmFpcmZheDERMA8G</span>
<a name="l01190"></a>01190 <span class="comment">    A1UEChMIWm9yay5vcmcxEDAOBgNVBAMTB1Jvb3QgQ0EwHhcNMTAwOTI5MDUyMzAx</span>
<a name="l01191"></a>01191 <span class="comment">    WhcNMjAwOTI2MDUyMzAxWjBeMQswCQYDVQQGEwJVUzERMA8GA1UECBMIVmlyZ2lu</span>
<a name="l01192"></a>01192 <span class="comment">    aWExEDAOBgNVBAcTB0ZhaXJmYXgxETAPBgNVBAoTCFpvcmsub3JnMRcwFQYDVQQD</span>
<a name="l01193"></a>01193 <span class="comment">    Ew5zaGVsbC56b3JrLm9yZzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA3vD9</span>
<a name="l01194"></a>01194 <span class="comment">    fO4ov4854L8wXrgfv2tltDz0ieVrTNSLuy1xuQyb//+MwZ0EYwu8jMMQrqbUaYG6</span>
<a name="l01195"></a>01195 <span class="comment">    y8zJu32yBKrBNPPwJ+fJE+tfgVg860dGVbwMd4KhpkKtppJXmZaGqLqvELaXa4Uw</span>
<a name="l01196"></a>01196 <span class="comment">    9N3qg/faj0NMEDIBhv/tD/B5U65vH+U0JlRJ07kCAwEAAaMzMDEwCQYDVR0TBAIw</span>
<a name="l01197"></a>01197 <span class="comment">    ADAkBgNVHREEHTAbgg5zaGVsbC56b3JrLm9yZ4IJbG9jYWxob3N0MA0GCSqGSIb3</span>
<a name="l01198"></a>01198 <span class="comment">    DQEBBQUAA4GBALLXPa/naWsiXsw0JwlSiG7aOmvMF2romUkcr6uObhN7sghd38M0</span>
<a name="l01199"></a>01199 <span class="comment">    l2kKTiptnA8txrri8RhqmQgOgiyKFCKBkxY7/XGot62cE8Y1+lqGXlhu2UHm6NjA</span>
<a name="l01200"></a>01200 <span class="comment">    pRKvng75J2HTjmmsbCHy+nexn4t44wssfPYlGPD8sGwmO24u9tRfdzJE</span>
<a name="l01201"></a>01201 <span class="comment">    - -----END CERTIFICATE-----</span>
<a name="l01202"></a>01202 <span class="comment">    &lt;/key&gt;</span>
<a name="l01203"></a>01203 <span class="comment">    */</span>
<a name="l01204"></a>01204     <span class="comment">// -------------------------------------------</span>
<a name="l01205"></a>01205     <span class="comment">// By this point, we know that the &quot;contract&quot; key is properly attached</span>
<a name="l01206"></a>01206     <span class="comment">// to the raw XML contents, AND that the NymID for that key matches</span>
<a name="l01207"></a>01207     <span class="comment">// the NymID passed into this function.</span>
<a name="l01208"></a>01208     <span class="comment">// So we can proceed to add it to the wallet...</span>
<a name="l01209"></a>01209     <span class="comment">//</span>
<a name="l01210"></a>01210     <span class="comment">// -----------------------------------------------------</span>
<a name="l01211"></a>01211     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> idOutput;
<a name="l01212"></a>01212     pContract-&gt;<a class="code" href="class_o_t_contract.html#a705597c0b741d3d120624b0388f73508">CalculateContractID</a>(idOutput);
<a name="l01213"></a>01213     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(idOutput);
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aec0dc4e66d6bc87cbec6fc4c0e3851f7">AddAssetContract</a>(*pContract);
<a name="l01216"></a>01216     theAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(NULL); <span class="comment">// (No need to cleanup anymore.)</span>
<a name="l01217"></a>01217     pContract = NULL; <span class="comment">// Success. The wallet &quot;owns&quot; it now, no need to clean it up.</span>
<a name="l01218"></a>01218     <span class="comment">// -------------------------------------------</span>
<a name="l01219"></a>01219     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <span class="keywordflow">return</span> pBuf;
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="comment">// Use these below functions to get the new contract ITSELF, using its ID</span>
<a name="l01227"></a>01227 <span class="comment">// that was returned by the above two functions:</span>
<a name="l01228"></a>01228 <span class="comment">//</span>
<a name="l01229"></a>01229 <span class="comment">//std::string OTAPI_Exec::GetServer_Contract(const std::string &amp; SERVER_ID); // Return&#39;s Server&#39;s contract (based on server ID)</span>
<a name="l01230"></a>01230 <span class="comment">//std::string OTAPI_Exec::GetAssetType_Contract(const std::string &amp; ASSET_TYPE_ID); // Returns currency contract based on Asset Type ID</span>
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 
<a name="l01233"></a><a class="code" href="class_o_t_a_p_i___exec.html#adf0392d6766f66b52a2912279dbc9595">01233</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#adf0392d6766f66b52a2912279dbc9595">OTAPI_Exec::GetServer_Contract</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID) <span class="comment">// Return&#39;s Server&#39;s contract (based on server ID)</span>
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235     <span class="comment">// -----------------------------------------------------</span>
<a name="l01236"></a>01236     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <span class="keywordflow">if</span> (!bIsInitialized)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01239"></a>01239     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01240"></a>01240     <span class="comment">// -----------------------------------------------------</span>
<a name="l01241"></a>01241 
<a name="l01242"></a>01242     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01243"></a>01243     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l01244"></a>01244     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(theServerID, __FUNCTION__);
<a name="l01245"></a>01245     <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01246"></a>01246     <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
<a name="l01247"></a>01247     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01248"></a>01248     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pServer);
<a name="l01249"></a>01249     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     <span class="keywordflow">return</span> pBuf;
<a name="l01252"></a>01252 }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254 
<a name="l01255"></a>01255 <span class="comment">// Returns amount from formatted string, based on currency contract and locale.</span>
<a name="l01256"></a>01256 <span class="comment">//</span>
<a name="l01257"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0188891ee269124f924f7b39e32e4ce7">01257</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a0188891ee269124f924f7b39e32e4ce7">OTAPI_Exec::StringToAmount</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID, <span class="keyword">const</span> std::string &amp; str_input)
<a name="l01258"></a>01258 {
<a name="l01259"></a>01259     <span class="comment">// -----------------------------------------------------</span>
<a name="l01260"></a>01260     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01261"></a>01261     <span class="keywordflow">if</span> (!bIsInitialized)       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01262"></a>01262     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Empty %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01263"></a>01263     <span class="comment">// -----------------------------------------------------</span>
<a name="l01264"></a>01264     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l01265"></a>01265     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(theAssetID, __FUNCTION__);
<a name="l01266"></a>01266     <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> 0;
<a name="l01267"></a>01267     <span class="comment">// By this point, pContract is a good pointer.  (No need to cleanup.)</span>
<a name="l01268"></a>01268     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01269"></a>01269     <a class="code" href="class_o_t_amount.html">OTAmount</a>        theResult;
<a name="l01270"></a>01270     <span class="keyword">const</span> int64_t   lBackup = <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">StringToLong</a>(str_input);
<a name="l01271"></a>01271     <span class="keyword">const</span> <span class="keywordtype">bool</span>      bParsed = pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#a31632d6a9bd0efb34c427b04f3bd2b37">StringToAmount</a>(theResult, str_input); <span class="comment">// Convert $5.45 to 545.</span>
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     <span class="keywordflow">if</span> (bParsed)
<a name="l01274"></a>01274         <span class="keywordflow">return</span> theResult.<a class="code" href="class_o_t_amount.html#a10d1ed25cf2a5262c4f1c73a39663a1c">GetAmount</a>();
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     <span class="keywordflow">return</span> lBackup;
<a name="l01277"></a>01277 }
<a name="l01278"></a>01278 
<a name="l01279"></a>01279 <span class="comment">// Returns formatted string for output, for a given amount, based on currency contract and locale.</span>
<a name="l01280"></a>01280 <span class="comment">//</span>
<a name="l01281"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad68199be44c7c45248ecaafb59194685">01281</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad68199be44c7c45248ecaafb59194685">OTAPI_Exec::FormatAmount</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID, <span class="keyword">const</span> int64_t &amp; THE_AMOUNT)
<a name="l01282"></a>01282 {
<a name="l01283"></a>01283     <span class="comment">// -----------------------------------------------------</span>
<a name="l01284"></a>01284     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01285"></a>01285     <span class="keywordflow">if</span> (!bIsInitialized)       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01286"></a>01286     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Empty %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01287"></a>01287     <span class="comment">// -----------------------------------------------------</span>
<a name="l01288"></a>01288     <span class="comment">// NOTE: probably just remove this. I think we now allow negative amounts to be formatted.</span>
<a name="l01289"></a>01289 <span class="comment">//  if (0 &gt; THE_AMOUNT)</span>
<a name="l01290"></a>01290 <span class="comment">//  {</span>
<a name="l01291"></a>01291 <span class="comment">//      OTLog::vError(&quot;%s: Negative: %s passed in: %s\n&quot;, __FUNCTION__, &quot;THE_AMOUNT&quot;, OTAPI_Exec::LongToString(THE_AMOUNT).c_str());</span>
<a name="l01292"></a>01292 <span class="comment">//      OT_FAIL;</span>
<a name="l01293"></a>01293 <span class="comment">//  }</span>
<a name="l01294"></a>01294     <span class="comment">// -----------------------------------------------------</span>
<a name="l01295"></a>01295     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l01296"></a>01296     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(theAssetID, __FUNCTION__);
<a name="l01297"></a>01297     <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01298"></a>01298     <span class="comment">// By this point, pContract is a good pointer.  (No need to cleanup.)</span>
<a name="l01299"></a>01299     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01300"></a>01300     <span class="keyword">const</span> int64_t    lAmount = THE_AMOUNT;
<a name="l01301"></a>01301     <a class="code" href="class_o_t_amount.html">OTAmount</a>         theAmount(lAmount);
<a name="l01302"></a>01302     <a class="code" href="class_o_t_string.html">OTString</a>         strBackup(<a class="code" href="class_o_t_a_p_i___exec.html#ab27795fbc9d11a3ada075eaa64b95831">LongToString</a>(THE_AMOUNT));
<a name="l01303"></a>01303     std::string      str_result;
<a name="l01304"></a>01304     <span class="keyword">const</span> <span class="keywordtype">bool</span>       bFormatted = pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#ac3ef605c99dcea4c9380684fce292950">FormatAmount</a>(theAmount, str_result); <span class="comment">// Convert 545 to $5.45.</span>
<a name="l01305"></a>01305     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>   strOutput(bFormatted ? str_result.c_str() : strBackup.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01308"></a>01308     <span class="keywordflow">return</span> pBuf;
<a name="l01309"></a>01309 }
<a name="l01310"></a>01310 
<a name="l01311"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6c06c32e07e06efb900564fd96241ed0">01311</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a6c06c32e07e06efb900564fd96241ed0">OTAPI_Exec::GetAssetType_Contract</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID) <span class="comment">// Returns currency contract based on Asset Type ID</span>
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313     <span class="comment">// -----------------------------------------------------</span>
<a name="l01314"></a>01314     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01315"></a>01315     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01318"></a>01318     <span class="comment">// -----------------------------------------------------</span>
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l01321"></a>01321     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(theAssetID, __FUNCTION__);
<a name="l01322"></a>01322     <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01323"></a>01323     <span class="comment">// By this point, pContract is a good pointer.  (No need to cleanup.)</span>
<a name="l01324"></a>01324     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01325"></a>01325     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pContract);
<a name="l01326"></a>01326     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l01327"></a>01327     <span class="keywordflow">return</span> pBuf;
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 
<a name="l01332"></a>01332 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l01333"></a>01333 
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="comment">// If you have a server contract that you&#39;d like to add</span>
<a name="l01338"></a>01338 <span class="comment">// to your wallet, call this function.</span>
<a name="l01339"></a>01339 <span class="comment">//</span>
<a name="l01340"></a><a class="code" href="class_o_t_a_p_i___exec.html#a977725a4fd13ff5ef12831ce967aed5a">01340</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a977725a4fd13ff5ef12831ce967aed5a">OTAPI_Exec::AddServerContract</a>(<span class="keyword">const</span> std::string &amp; strContract)
<a name="l01341"></a>01341 {
<a name="l01342"></a>01342     <span class="keywordflow">if</span> (strContract.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strContract&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01343"></a>01343     <span class="comment">// -----------------------------------------------------</span>
<a name="l01344"></a>01344     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
<a name="l01345"></a>01345     <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01346"></a>01346     <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
<a name="l01347"></a>01347     <span class="comment">// -----------------------------------------------------</span>
<a name="l01348"></a>01348     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(<span class="stringliteral">&quot;&quot;</span> != strContract);
<a name="l01349"></a>01349     std::string str_Trim(strContract);
<a name="l01350"></a>01350     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01351"></a>01351     <a class="code" href="class_o_t_string.html">OTString</a> otstrContract(str_Trim2.c_str());
<a name="l01352"></a>01352     <span class="comment">// -----------------------------------------------------</span>
<a name="l01353"></a>01353     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_server_contract.html">OTServerContract</a>;
<a name="l01354"></a>01354     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pContract);
<a name="l01355"></a>01355 
<a name="l01356"></a>01356     <span class="comment">// Check the server signature on the contract here. (Perhaps the message is good enough?</span>
<a name="l01357"></a>01357     <span class="comment">// After all, the message IS signed by the server and contains the Account.</span>
<a name="l01358"></a>01358     <span class="comment">//  if (pContract-&gt;LoadContract() &amp;&amp; pContract-&gt;VerifyContract())</span>
<a name="l01359"></a>01359     <span class="keywordflow">if</span> (otstrContract.Exists() &amp;&amp; pContract-&gt;LoadContractFromString(otstrContract))
<a name="l01360"></a>01360     {
<a name="l01361"></a>01361         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theContractID;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363         pContract-&gt;CalculateContractID(theContractID);
<a name="l01364"></a>01364         pContract-&gt;SetIdentifier(theContractID);
<a name="l01365"></a>01365 
<a name="l01366"></a>01366         pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ad925633d8ba2319948b466ca0f0dc438">AddServerContract</a>(*pContract);
<a name="l01367"></a>01367         pContract = NULL; <span class="comment">// Success. The wallet &quot;owns&quot; it now, no need to clean it up.</span>
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369     <span class="comment">// cleanup</span>
<a name="l01370"></a>01370     <span class="keywordflow">if</span> (pContract)
<a name="l01371"></a>01371     {
<a name="l01372"></a>01372         <span class="keyword">delete</span> pContract;
<a name="l01373"></a>01373         pContract = NULL;
<a name="l01374"></a>01374 
<a name="l01375"></a>01375         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01379"></a>01379 }
<a name="l01380"></a>01380 
<a name="l01381"></a>01381 
<a name="l01382"></a>01382 <span class="comment">// If you have an asset contract that you&#39;d like to add</span>
<a name="l01383"></a>01383 <span class="comment">// to your wallet, call this function.</span>
<a name="l01384"></a>01384 <span class="comment">//</span>
<a name="l01385"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3fcec3e1ad613490838470bb397675f6">01385</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a3fcec3e1ad613490838470bb397675f6">OTAPI_Exec::AddAssetContract</a>(<span class="keyword">const</span> std::string &amp; strContract)
<a name="l01386"></a>01386 {
<a name="l01387"></a>01387     <span class="keywordflow">if</span> (strContract.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strContract&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01388"></a>01388     <span class="comment">// -----------------------------------------------------</span>
<a name="l01389"></a>01389     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__); <span class="comment">// This logs and ASSERTs already.</span>
<a name="l01390"></a>01390     <span class="keywordflow">if</span> (NULL == pWallet) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01391"></a>01391     <span class="comment">// By this point, pWallet is a good pointer.  (No need to cleanup.)</span>
<a name="l01392"></a>01392     <span class="comment">// -----------------------------------------------------</span>
<a name="l01393"></a>01393     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(<span class="stringliteral">&quot;&quot;</span> != strContract);
<a name="l01394"></a>01394     std::string str_Trim(strContract);
<a name="l01395"></a>01395     std::string str_Trim2 = <a class="code" href="class_o_t_string.html#afe7626d0687eab81200a1af1539faed9">OTString::trim</a>(str_Trim);
<a name="l01396"></a>01396     <a class="code" href="class_o_t_string.html">OTString</a> otstrContract(str_Trim2.c_str());
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <span class="keyword">new</span> <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a>;
<a name="l01399"></a>01399     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pContract);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     <span class="comment">// Check the server signature on the contract here. (Perhaps the message is good enough?</span>
<a name="l01402"></a>01402     <span class="comment">// After all, the message IS signed by the server and contains the Account.</span>
<a name="l01403"></a>01403     <span class="comment">//  if (pContract-&gt;LoadContract() &amp;&amp; pContract-&gt;VerifyContract())</span>
<a name="l01404"></a>01404     <span class="keywordflow">if</span> (otstrContract.Exists() &amp;&amp; pContract-&gt;LoadContractFromString(otstrContract))
<a name="l01405"></a>01405     {
<a name="l01406"></a>01406         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theContractID;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408         pContract-&gt;CalculateContractID(theContractID);
<a name="l01409"></a>01409         pContract-&gt;SetIdentifier(theContractID);
<a name="l01410"></a>01410 
<a name="l01411"></a>01411         <span class="comment">// Next make sure the wallet has this contract on its list...</span>
<a name="l01412"></a>01412         pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aec0dc4e66d6bc87cbec6fc4c0e3851f7">AddAssetContract</a>(*pContract);
<a name="l01413"></a>01413         pContract = NULL; <span class="comment">// Success. The wallet &quot;owns&quot; it now, no need to clean it up.</span>
<a name="l01414"></a>01414     }
<a name="l01415"></a>01415     <span class="comment">// cleanup</span>
<a name="l01416"></a>01416     <span class="keywordflow">if</span> (pContract)
<a name="l01417"></a>01417     {
<a name="l01418"></a>01418         <span class="keyword">delete</span> pContract;
<a name="l01419"></a>01419         pContract = NULL;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01422"></a>01422     }
<a name="l01423"></a>01423     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01424"></a>01424 }
<a name="l01425"></a>01425 
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 
<a name="l01428"></a>01428 <span class="comment">// --------------------------------------------------</span>
<a name="l01429"></a>01429 
<a name="l01430"></a>01430 
<a name="l01431"></a>01431 
<a name="l01432"></a>01432 
<a name="l01433"></a><a class="code" href="class_o_t_a_p_i___exec.html#a363b1cd3cb27fce58e6d113641fb65bb">01433</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a363b1cd3cb27fce58e6d113641fb65bb">OTAPI_Exec::GetNymCount</a>(<span class="keywordtype">void</span>)
<a name="l01434"></a>01434 {
<a name="l01435"></a>01435     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a267d362ca74da9e01ab8e956da42b386">GetNymCount</a>();
<a name="l01436"></a>01436 }
<a name="l01437"></a>01437 
<a name="l01438"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae78b8db3ee94ba98fc4a320f2365a64c">01438</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ae78b8db3ee94ba98fc4a320f2365a64c">OTAPI_Exec::GetServerCount</a>(<span class="keywordtype">void</span>)
<a name="l01439"></a>01439 {
<a name="l01440"></a>01440     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0fad5fe7f5da3cac88b0794c705b1a9b">GetServerCount</a>();
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 
<a name="l01443"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae582e3609b00e870c0234c0b0a95a3d7">01443</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ae582e3609b00e870c0234c0b0a95a3d7">OTAPI_Exec::GetAssetTypeCount</a>(<span class="keywordtype">void</span>)
<a name="l01444"></a>01444 {
<a name="l01445"></a>01445     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acb9cb01e0d828ad885aa8da40b69ffb3">GetAssetTypeCount</a>();
<a name="l01446"></a>01446 }
<a name="l01447"></a>01447 
<a name="l01448"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3b5978e2f813cf10ebe34fa7d85b80be">01448</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a3b5978e2f813cf10ebe34fa7d85b80be">OTAPI_Exec::GetAccountCount</a>(<span class="keywordtype">void</span>)
<a name="l01449"></a>01449 {
<a name="l01450"></a>01450     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a318b1ae501a4ad2b99ce8ff036546e5e">GetAccountCount</a>();
<a name="l01451"></a>01451 }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453 
<a name="l01454"></a>01454 
<a name="l01455"></a>01455 <span class="comment">// ----------------------------------------------------------------</span>
<a name="l01456"></a>01456 
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="comment">// *** FUNCTIONS FOR REMOVING VARIOUS CONTRACTS AND NYMS FROM THE WALLET ***</span>
<a name="l01459"></a>01459 
<a name="l01460"></a>01460 <span class="comment">// Can I remove this server contract from my wallet?</span>
<a name="l01461"></a>01461 <span class="comment">//</span>
<a name="l01462"></a>01462 <span class="comment">// You cannot remove the server contract from your wallet if there are accounts (or nyms) in there using it.</span>
<a name="l01463"></a>01463 <span class="comment">// This function tells you whether you can remove the server contract or not. (Whether there are accounts or nyms using it...)</span>
<a name="l01464"></a>01464 <span class="comment">//</span>
<a name="l01465"></a>01465 <span class="comment">// returns bool</span>
<a name="l01466"></a>01466 <span class="comment">//</span>
<a name="l01467"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad5b66d7e6143d6e75ce5a4d32a87e8ea">01467</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ad5b66d7e6143d6e75ce5a4d32a87e8ea">OTAPI_Exec::Wallet_CanRemoveServer</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID)
<a name="l01468"></a>01468 {
<a name="l01469"></a>01469     <span class="comment">// -----------------------------------------------------</span>
<a name="l01470"></a>01470     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01471"></a>01471     <span class="keywordflow">if</span> (!bIsInitialized)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01473"></a>01473     <span class="comment">// -----------------------------------------------------</span>
<a name="l01474"></a>01474     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(SERVER_ID);
<a name="l01475"></a>01475     <span class="comment">// ------------------------------------------</span>
<a name="l01476"></a>01476     <span class="keyword">const</span> int32_t &amp; nCount = <a class="code" href="class_o_t_a_p_i___exec.html#a3b5978e2f813cf10ebe34fa7d85b80be">OTAPI_Exec::GetAccountCount</a>();
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="comment">// Loop through all the accounts.</span>
<a name="l01479"></a>01479     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
<a name="l01480"></a>01480     {
<a name="l01481"></a>01481         std::string pAcctID = <a class="code" href="class_o_t_a_p_i___exec.html#a07d988d698bb0f914031141297445e72">OTAPI_Exec::GetAccountWallet_ID</a>(i);
<a name="l01482"></a>01482         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(pAcctID);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484         std::string pID = <a class="code" href="class_o_t_a_p_i___exec.html#afb2255e4fb7fb27bbeebe753eb827770">OTAPI_Exec::GetAccountWallet_ServerID</a>(strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01485"></a>01485         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theCompareID(pID);
<a name="l01486"></a>01486 
<a name="l01487"></a>01487         <span class="keywordflow">if</span> (theID == theCompareID)
<a name="l01488"></a>01488         {
<a name="l01489"></a>01489             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove server contract %s from wallet, because Account %s uses it.\n&quot;</span>,__FUNCTION__, SERVER_ID.c_str(), strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01490"></a>01490             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01491"></a>01491         }
<a name="l01492"></a>01492     }
<a name="l01493"></a>01493     <span class="comment">// ------------------------------------------</span>
<a name="l01494"></a>01494     <span class="keyword">const</span> int32_t &amp; nNymCount = <a class="code" href="class_o_t_a_p_i___exec.html#a363b1cd3cb27fce58e6d113641fb65bb">OTAPI_Exec::GetNymCount</a>();
<a name="l01495"></a>01495 
<a name="l01496"></a>01496     <span class="comment">// Loop through all the Nyms. (One might be registered on that server.)</span>
<a name="l01497"></a>01497     <span class="comment">//</span>
<a name="l01498"></a>01498     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nNymCount; i++)
<a name="l01499"></a>01499     {
<a name="l01500"></a>01500         std::string pNymID = <a class="code" href="class_o_t_a_p_i___exec.html#a5c205cfa5e6f9a05e87b4894e92e8086" title="based on Index this returns the Nym&#39;s ID">OTAPI_Exec::GetNym_ID</a>(i);
<a name="l01501"></a>01501         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(pNymID);
<a name="l01502"></a>01502 
<a name="l01503"></a>01503         <span class="keywordflow">if</span> (<span class="keyword">true</span> == <a class="code" href="class_o_t_a_p_i___exec.html#a7de7a08dccfd1343129932f3459b8298">OTAPI_Exec::IsNym_RegisteredAtServer</a>(strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), SERVER_ID))
<a name="l01504"></a>01504         {
<a name="l01505"></a>01505             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove server contract %s from wallet, because Nym %s is registered there. (Delete that first...)\n&quot;</span>,
<a name="l01506"></a>01506                 __FUNCTION__, SERVER_ID.c_str(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01507"></a>01507             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01511"></a>01511 }
<a name="l01512"></a>01512 
<a name="l01513"></a>01513 <span class="comment">// Remove this server contract from my wallet!</span>
<a name="l01514"></a>01514 <span class="comment">//</span>
<a name="l01515"></a>01515 <span class="comment">// Try to remove the server contract from the wallet.</span>
<a name="l01516"></a>01516 <span class="comment">// This will not work if there are any accounts in the wallet for the same server ID.</span>
<a name="l01517"></a>01517 <span class="comment">// returns bool</span>
<a name="l01518"></a>01518 <span class="comment">//</span>
<a name="l01519"></a><a class="code" href="class_o_t_a_p_i___exec.html#a529310cf664653d079f4830c3e00add7">01519</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a529310cf664653d079f4830c3e00add7">OTAPI_Exec::Wallet_RemoveServer</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID)
<a name="l01520"></a>01520 {
<a name="l01521"></a>01521     <span class="comment">// -----------------------------------------------------</span>
<a name="l01522"></a>01522     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01523"></a>01523     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01526"></a>01526     <span class="comment">// -----------------------------------------------------</span>
<a name="l01527"></a>01527 
<a name="l01528"></a>01528     <span class="comment">// Make sure there aren&#39;t any dependent accounts..</span>
<a name="l01529"></a>01529     <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_a_p_i___exec.html#ad5b66d7e6143d6e75ce5a4d32a87e8ea">OTAPI_Exec::Wallet_CanRemoveServer</a>(SERVER_ID))
<a name="l01530"></a>01530         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532     <span class="comment">// TODO: the above call proves that there are no accounts laying around</span>
<a name="l01533"></a>01533     <span class="comment">// for this server ID. (No need to worry about &quot;orphaned accounts.&quot;)</span>
<a name="l01534"></a>01534     <span class="comment">//</span>
<a name="l01535"></a>01535     <span class="comment">// However, there may still be Nyms registered at the server! Therefore,</span>
<a name="l01536"></a>01536     <span class="comment">// we need to loop through the Nyms, and make sure none of them has been</span>
<a name="l01537"></a>01537     <span class="comment">// registered at this server ID. If it has, then we need to message the server</span>
<a name="l01538"></a>01538     <span class="comment">// to &quot;deregister&quot; the Nym, which is much cleaner.  Otherwise server&#39;s only</span>
<a name="l01539"></a>01539     <span class="comment">// other alternative is to expire Nyms that have gone unused for some specific</span>
<a name="l01540"></a>01540     <span class="comment">// period of time, presumably those terms are described in the server contract.</span>
<a name="l01541"></a>01541     <span class="comment">//</span>
<a name="l01542"></a>01542     <span class="comment">// -----------------------------------------------------</span>
<a name="l01543"></a>01543     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__);
<a name="l01544"></a>01544 
<a name="l01545"></a>01545     <span class="keywordflow">if</span> (NULL == pWallet) {
<a name="l01546"></a>01546         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s:  No wallet found...\n&quot;</span>,__FUNCTION__);
<a name="l01547"></a>01547         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01548"></a>01548     }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(SERVER_ID);
<a name="l01551"></a>01551 
<a name="l01552"></a>01552     <span class="keywordflow">if</span> (pWallet-&gt;<a class="code" href="class_o_t_wallet.html#ab739c1b18f6dcc6958cfd1ac53f728d8">RemoveServerContract</a>(theID))
<a name="l01553"></a>01553     {
<a name="l01554"></a>01554         pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();
<a name="l01555"></a>01555         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Removed server contract from the wallet: %s\n&quot;</span>, __FUNCTION__, SERVER_ID.c_str());
<a name="l01556"></a>01556         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01557"></a>01557     }
<a name="l01558"></a>01558     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01559"></a>01559 }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 <span class="comment">// Can I remove this asset contract from my wallet?</span>
<a name="l01564"></a>01564 <span class="comment">//</span>
<a name="l01565"></a>01565 <span class="comment">// You cannot remove the asset contract from your wallet if there are accounts in there using it.</span>
<a name="l01566"></a>01566 <span class="comment">// This function tells you whether you can remove the asset contract or not. (Whether there are accounts...)</span>
<a name="l01567"></a>01567 <span class="comment">// returns bool</span>
<a name="l01568"></a>01568 <span class="comment">//</span>
<a name="l01569"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae0264d14564877e5645790a46e455870">01569</a> <span class="keywordtype">bool</span>    <a class="code" href="class_o_t_a_p_i___exec.html#ae0264d14564877e5645790a46e455870">OTAPI_Exec::Wallet_CanRemoveAssetType</a>(<span class="keyword">const</span> std::string &amp; ASSET_ID)
<a name="l01570"></a>01570 {
<a name="l01571"></a>01571     <span class="comment">// -----------------------------------------------------</span>
<a name="l01572"></a>01572     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01573"></a>01573     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <span class="keywordflow">if</span> (ASSET_ID.empty())           { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01576"></a>01576     <span class="comment">// -----------------------------------------------------</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(ASSET_ID);
<a name="l01579"></a>01579     <span class="comment">// ------------------------------------------</span>
<a name="l01580"></a>01580     <span class="keyword">const</span> int32_t &amp; nCount = <a class="code" href="class_o_t_a_p_i___exec.html#a3b5978e2f813cf10ebe34fa7d85b80be">OTAPI_Exec::GetAccountCount</a>();
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <span class="comment">// Loop through all the accounts.</span>
<a name="l01583"></a>01583     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
<a name="l01584"></a>01584     {
<a name="l01585"></a>01585         std::string pAcctID = <a class="code" href="class_o_t_a_p_i___exec.html#a07d988d698bb0f914031141297445e72">OTAPI_Exec::GetAccountWallet_ID</a>(i);
<a name="l01586"></a>01586         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(pAcctID);
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         std::string pID = <a class="code" href="class_o_t_a_p_i___exec.html#af812b71a9eb104706179bd10e06d5170">OTAPI_Exec::GetAccountWallet_AssetTypeID</a>(strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01589"></a>01589         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theCompareID(pID);
<a name="l01590"></a>01590 
<a name="l01591"></a>01591         <span class="keywordflow">if</span> (theID == theCompareID)
<a name="l01592"></a>01592         {
<a name="l01593"></a>01593             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to remove asset contract %s from wallet: Account %s uses it.\n&quot;</span>, __FUNCTION__,
<a name="l01594"></a>01594                 ASSET_ID.c_str(), strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01595"></a>01595             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01596"></a>01596         }
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01599"></a>01599 }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 <span class="comment">// Remove this asset contract from my wallet!</span>
<a name="l01605"></a>01605 <span class="comment">//</span>
<a name="l01606"></a>01606 <span class="comment">// Try to remove the asset contract from the wallet.</span>
<a name="l01607"></a>01607 <span class="comment">// This will not work if there are any accounts in the wallet for the same asset type ID.</span>
<a name="l01608"></a>01608 <span class="comment">// returns bool</span>
<a name="l01609"></a>01609 <span class="comment">//</span>
<a name="l01610"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3e02e35f0243b096335c78dcb45f4f0c">01610</a> <span class="keywordtype">bool</span>    <a class="code" href="class_o_t_a_p_i___exec.html#a3e02e35f0243b096335c78dcb45f4f0c">OTAPI_Exec::Wallet_RemoveAssetType</a>(<span class="keyword">const</span> std::string &amp; ASSET_ID)
<a name="l01611"></a>01611 {
<a name="l01612"></a>01612     <span class="comment">// -----------------------------------------------------</span>
<a name="l01613"></a>01613     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01614"></a>01614     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616     <span class="keywordflow">if</span> (ASSET_ID.empty())           { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01617"></a>01617     <span class="comment">// -----------------------------------------------------</span>
<a name="l01618"></a>01618 
<a name="l01619"></a>01619     <span class="comment">// Make sure there aren&#39;t any dependent accounts..</span>
<a name="l01620"></a>01620     <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_a_p_i___exec.html#ae0264d14564877e5645790a46e455870">OTAPI_Exec::Wallet_CanRemoveAssetType</a>(ASSET_ID))
<a name="l01621"></a>01621         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     <span class="comment">// -----------------------------------------------------</span>
<a name="l01624"></a>01624     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__);
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <span class="keywordflow">if</span> (NULL == pWallet) {
<a name="l01627"></a>01627         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No wallet found...!\n&quot;</span>,__FUNCTION__);
<a name="l01628"></a>01628         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01629"></a>01629     }
<a name="l01630"></a>01630 
<a name="l01631"></a>01631     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(ASSET_ID);
<a name="l01632"></a>01632 
<a name="l01633"></a>01633     <span class="keywordflow">if</span> (pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a1eae600871447c75a3ddd155c86674a3">RemoveAssetContract</a>(theID))
<a name="l01634"></a>01634     {
<a name="l01635"></a>01635         pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();
<a name="l01636"></a>01636         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Removed asset contract from the wallet: %s\n&quot;</span>,__FUNCTION__, ASSET_ID.c_str());
<a name="l01637"></a>01637         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01638"></a>01638     }
<a name="l01639"></a>01639     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01640"></a>01640 }
<a name="l01641"></a>01641 
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 
<a name="l01644"></a>01644 
<a name="l01645"></a>01645 <span class="comment">// Can I remove this Nym from my wallet?</span>
<a name="l01646"></a>01646 <span class="comment">//</span>
<a name="l01647"></a>01647 <span class="comment">// You cannot remove the Nym from your wallet if there are accounts in there using it.</span>
<a name="l01648"></a>01648 <span class="comment">// This function tells you whether you can remove the Nym or not. (Whether there are accounts...)</span>
<a name="l01649"></a>01649 <span class="comment">// It also checks to see if the Nym in question is registered at any servers.</span>
<a name="l01650"></a>01650 <span class="comment">//</span>
<a name="l01651"></a>01651 <span class="comment">// returns bool</span>
<a name="l01652"></a>01652 <span class="comment">//</span>
<a name="l01653"></a><a class="code" href="class_o_t_a_p_i___exec.html#a021b69143268a7aabd977638cd26cfed">01653</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a021b69143268a7aabd977638cd26cfed">OTAPI_Exec::Wallet_CanRemoveNym</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l01654"></a>01654 {
<a name="l01655"></a>01655     <span class="comment">// -----------------------------------------------------</span>
<a name="l01656"></a>01656     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01657"></a>01657     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01660"></a>01660     <span class="comment">// -----------------------------------------------------</span>
<a name="l01661"></a>01661 
<a name="l01662"></a>01662     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(NYM_ID);
<a name="l01663"></a>01663     <span class="comment">// -----------------------------------------------------</span>
<a name="l01664"></a>01664     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theID, __FUNCTION__);
<a name="l01665"></a>01665     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01666"></a>01666     <span class="comment">// ------------------------------------------</span>
<a name="l01667"></a>01667     <span class="comment">// Make sure the Nym doesn&#39;t have any accounts in the wallet.</span>
<a name="l01668"></a>01668     <span class="comment">// (Client must close those before calling this.)</span>
<a name="l01669"></a>01669     <span class="comment">//</span>
<a name="l01670"></a>01670     <span class="keyword">const</span> int32_t &amp; nCount = <a class="code" href="class_o_t_a_p_i___exec.html#a3b5978e2f813cf10ebe34fa7d85b80be">OTAPI_Exec::GetAccountCount</a>();
<a name="l01671"></a>01671 
<a name="l01672"></a>01672     <span class="comment">// Loop through all the accounts.</span>
<a name="l01673"></a>01673     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nCount; i++)
<a name="l01674"></a>01674     {
<a name="l01675"></a>01675         std::string pAcctID = <a class="code" href="class_o_t_a_p_i___exec.html#a07d988d698bb0f914031141297445e72">OTAPI_Exec::GetAccountWallet_ID</a>(i);
<a name="l01676"></a>01676         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(pAcctID);
<a name="l01677"></a>01677 
<a name="l01678"></a>01678         std::string pID = <a class="code" href="class_o_t_a_p_i___exec.html#a5c11f6d8c1dd9024788124685c8bb8d8">OTAPI_Exec::GetAccountWallet_NymID</a>(strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l01679"></a>01679 
<a name="l01680"></a>01680         <span class="keywordflow">if</span> (pID.empty())
<a name="l01681"></a>01681         {
<a name="l01682"></a>01682             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bug in OTAPI_Exec::Wallet_CanRemoveNym / OTAPI_Exec::GetAccountWallet_NymID\n&quot;</span>, __FUNCTION__);
<a name="l01683"></a>01683             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01684"></a>01684         }
<a name="l01685"></a>01685 
<a name="l01686"></a>01686         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theCompareID(pID);
<a name="l01687"></a>01687 
<a name="l01688"></a>01688         <span class="comment">// Looks like the Nym still has some accounts in this wallet.</span>
<a name="l01689"></a>01689         <span class="keywordflow">if</span> (theID == theCompareID)
<a name="l01690"></a>01690         {
<a name="l01691"></a>01691             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Nym cannot be removed because there are still accounts in the wallet for that Nym.\n&quot;</span>, __FUNCTION__);
<a name="l01692"></a>01692             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01693"></a>01693         }
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <span class="comment">// ------------------------------------------</span>
<a name="l01697"></a>01697     <span class="comment">// Make sure the Nym isn&#39;t registered at any servers...</span>
<a name="l01698"></a>01698     <span class="comment">// (Client must unregister at those servers before calling this function..)</span>
<a name="l01699"></a>01699     <span class="comment">//</span>
<a name="l01700"></a>01700     <span class="keyword">const</span> int32_t &amp; nServerCount = <a class="code" href="class_o_t_a_p_i___exec.html#ae78b8db3ee94ba98fc4a320f2365a64c">OTAPI_Exec::GetServerCount</a>();
<a name="l01701"></a>01701 
<a name="l01702"></a>01702     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; nServerCount; i++)
<a name="l01703"></a>01703     {
<a name="l01704"></a>01704         std::string str_ServerID = <a class="code" href="class_o_t_a_p_i___exec.html#a75a82ad6c9be31757dc6211f7987e815">OTAPI_Exec::GetServer_ID</a>(i);
<a name="l01705"></a>01705 
<a name="l01706"></a>01706         <span class="keywordflow">if</span> (<span class="stringliteral">&quot;&quot;</span> != str_ServerID)
<a name="l01707"></a>01707         {
<a name="l01708"></a>01708             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(str_ServerID);
<a name="l01709"></a>01709 
<a name="l01710"></a>01710             <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#af5e9078ab475e6cd9c53e4ad2fae0417">IsRegisteredAtServer</a>(strServerID))
<a name="l01711"></a>01711             {
<a name="l01712"></a>01712                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Nym cannot be removed because there are still servers in the wallet that the Nym is registered at.\n&quot;</span>, __FUNCTION__);
<a name="l01713"></a>01713                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01714"></a>01714             }
<a name="l01715"></a>01715         }
<a name="l01716"></a>01716     }
<a name="l01717"></a>01717 
<a name="l01718"></a>01718     <span class="comment">// ------------------------------------------</span>
<a name="l01719"></a>01719 
<a name="l01720"></a>01720     <span class="comment">// TODO:  Make sure Nym doesn&#39;t have any cash in any purses...</span>
<a name="l01721"></a>01721 
<a name="l01722"></a>01722     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01723"></a>01723 }
<a name="l01724"></a>01724 
<a name="l01725"></a>01725 <span class="comment">// Remove this Nym from my wallet!</span>
<a name="l01726"></a>01726 <span class="comment">//</span>
<a name="l01727"></a>01727 <span class="comment">// Try to remove the Nym from the wallet.</span>
<a name="l01728"></a>01728 <span class="comment">// This will fail if the Nym is registered at any servers, or has any accounts.</span>
<a name="l01729"></a>01729 <span class="comment">//</span>
<a name="l01730"></a>01730 <span class="comment">// returns bool</span>
<a name="l01731"></a>01731 <span class="comment">//</span>
<a name="l01732"></a><a class="code" href="class_o_t_a_p_i___exec.html#a026fd730a998874c4dbacb72decc550b">01732</a> <span class="keywordtype">bool</span>    <a class="code" href="class_o_t_a_p_i___exec.html#a026fd730a998874c4dbacb72decc550b">OTAPI_Exec::Wallet_RemoveNym</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l01733"></a>01733 {
<a name="l01734"></a>01734     <span class="comment">// -----------------------------------------------------</span>
<a name="l01735"></a>01735     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01736"></a>01736     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01739"></a>01739     <span class="comment">// -----------------------------------------------------</span>
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     <span class="comment">// ------------------------------------------</span>
<a name="l01742"></a>01742     <span class="comment">// DONE: The below call proves already that there are no accounts laying around</span>
<a name="l01743"></a>01743     <span class="comment">// for this Nym. (No need to worry about &quot;orphaned accounts.&quot;)</span>
<a name="l01744"></a>01744     <span class="comment">//</span>
<a name="l01745"></a>01745     <span class="comment">// DONE (finally):</span>
<a name="l01746"></a>01746     <span class="comment">// However, the Nym might still be registered at various servers, even without asset accounts.</span>
<a name="l01747"></a>01747     <span class="comment">// Therefore, we need to iterate through the server contracts, and if the Nym is registered at</span>
<a name="l01748"></a>01748     <span class="comment">// any of the servers, then &quot;deregister&quot; (before deleting the Nym entirely.) This is much</span>
<a name="l01749"></a>01749     <span class="comment">// cleaner for the server side, who otherwise has to expired unused nyms based on some rule</span>
<a name="l01750"></a>01750     <span class="comment">// presumably to be found in the server contract.</span>
<a name="l01751"></a>01751     <span class="comment">// ------------------------------------------</span>
<a name="l01752"></a>01752     <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_a_p_i___exec.html#a021b69143268a7aabd977638cd26cfed">OTAPI_Exec::Wallet_CanRemoveNym</a>(NYM_ID))
<a name="l01753"></a>01753         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01754"></a>01754 
<a name="l01755"></a>01755     <span class="comment">// -----------------------------------------------------</span>
<a name="l01756"></a>01756     <a class="code" href="class_o_t_wallet.html">OTWallet</a> * pWallet = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af759173aae6f4592c3d6ef1f6a9aa4ff">GetWallet</a>(__FUNCTION__);
<a name="l01757"></a>01757 
<a name="l01758"></a>01758     <span class="keywordflow">if</span> (NULL == pWallet) {
<a name="l01759"></a>01759         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No wallet found...!\n&quot;</span>,__FUNCTION__);
<a name="l01760"></a>01760         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(NYM_ID);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765     <span class="keywordflow">if</span> (pWallet-&gt;<a class="code" href="class_o_t_wallet.html#a7dd1cf4ba4922eacc2c3c81d21dd07dc">RemoveNym</a>(theID))
<a name="l01766"></a>01766     {
<a name="l01767"></a>01767         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Success erasing Nym from wallet: %s\n&quot;</span>, __FUNCTION__, NYM_ID.c_str());
<a name="l01768"></a>01768         pWallet-&gt;<a class="code" href="class_o_t_wallet.html#aa16fe70ac5913e3223f994d7dc8a4831">SaveWallet</a>();
<a name="l01769"></a>01769         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01770"></a>01770     }
<a name="l01771"></a>01771     <span class="keywordflow">else</span>
<a name="l01772"></a>01772         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure erasing Nym from wallet: %s\n&quot;</span>, __FUNCTION__, NYM_ID.c_str());
<a name="l01773"></a>01773 
<a name="l01774"></a>01774     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01775"></a>01775 }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777 
<a name="l01778"></a>01778 
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="comment">// Can I remove this Account from my wallet?</span>
<a name="l01781"></a>01781 <span class="comment">//</span>
<a name="l01782"></a>01782 <span class="comment">// You cannot remove the Account from your wallet if there are transactions still open.</span>
<a name="l01783"></a>01783 <span class="comment">// This function tells you whether you can remove the Account or not. (Whether there are transactions...)</span>
<a name="l01784"></a>01784 <span class="comment">// Also, balance must be zero to do this.</span>
<a name="l01785"></a>01785 <span class="comment">//</span>
<a name="l01786"></a>01786 <span class="comment">// returns bool</span>
<a name="l01787"></a>01787 <span class="comment">//</span>
<a name="l01788"></a><a class="code" href="class_o_t_a_p_i___exec.html#a591518898ab86707f0c4a241a3873f93">01788</a> <span class="keywordtype">bool</span>    <a class="code" href="class_o_t_a_p_i___exec.html#a591518898ab86707f0c4a241a3873f93">OTAPI_Exec::Wallet_CanRemoveAccount</a>(<span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l01789"></a>01789 {
<a name="l01790"></a>01790     <span class="comment">// -----------------------------------------------------</span>
<a name="l01791"></a>01791     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01793"></a>01793 
<a name="l01794"></a>01794     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01795"></a>01795     <span class="comment">// -----------------------------------------------------</span>
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l01798"></a>01798     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l01799"></a>01799 
<a name="l01800"></a>01800     <span class="comment">// -----------------------------------------------------</span>
<a name="l01801"></a>01801     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theAccountID, __FUNCTION__);
<a name="l01802"></a>01802     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01803"></a>01803     <span class="comment">// -----------------------------------------------------</span>
<a name="l01804"></a>01804     <span class="comment">// Balance must be zero in order to close an account!</span>
<a name="l01805"></a>01805     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>() != 0)
<a name="l01806"></a>01806     {
<a name="l01807"></a>01807         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Account balance MUST be zero in order to close an asset account: %s.\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l01808"></a>01808         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01809"></a>01809     }
<a name="l01810"></a>01810     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l01811"></a>01811     <span class="keywordtype">bool</span> BOOL_RETURN_VALUE = <span class="keyword">false</span>;
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theServerID    = pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>();
<a name="l01814"></a>01814     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theUserID      = pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>();
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l01817"></a>01817     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l01818"></a>01818     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pInbox   = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a478f3f32e383e05a203807810bc94940">LoadInbox</a>(theServerID, theUserID, theAccountID);
<a name="l01819"></a>01819     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pOutbox  = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aeaf758c15cb39763d3ac80e7582e5409">LoadOutbox</a>(theServerID, theUserID, theAccountID);
<a name="l01820"></a>01820 
<a name="l01821"></a>01821     <span class="comment">// Make sure it gets cleaned up pInbox this goes out of scope.</span>
<a name="l01822"></a>01822     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theInboxAngel(pInbox); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l01823"></a>01823     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theOutboxAngel(pOutbox); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l01824"></a>01824 
<a name="l01825"></a>01825     <span class="keywordflow">if</span> (NULL == pInbox){
<a name="l01826"></a>01826         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadInbox.\n Account ID: %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l01827"></a>01827     }
<a name="l01828"></a>01828     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == pOutbox) {
<a name="l01829"></a>01829         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadOutbox.\n Account ID: %s\n&quot;</span>,__FUNCTION__ , ACCOUNT_ID.c_str());
<a name="l01830"></a>01830     }
<a name="l01831"></a>01831     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (pInbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &gt; 0) || (pOutbox-&gt;<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &gt; 0) ) {
<a name="l01832"></a>01832         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: You cannot remove an asset account if there are inbox/outbox items still waiting to be processed.\n&quot;</span>, __FUNCTION__);
<a name="l01833"></a>01833     }
<a name="l01834"></a>01834     <span class="keywordflow">else</span> BOOL_RETURN_VALUE = <span class="keyword">true</span>; <span class="comment">// SUCCESS!</span>
<a name="l01835"></a>01835 
<a name="l01836"></a>01836     <span class="keywordflow">return</span> BOOL_RETURN_VALUE;
<a name="l01837"></a>01837 }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 
<a name="l01841"></a>01841 <span class="comment">// So the client side knows which ones he has in storage, vs which ones he</span>
<a name="l01842"></a>01842 <span class="comment">// still needs to download.</span>
<a name="l01843"></a>01843 <span class="comment">//</span>
<a name="l01844"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8bbd7f75a75bdd5930c0d42b61fe397f">01844</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a8bbd7f75a75bdd5930c0d42b61fe397f">OTAPI_Exec::DoesBoxReceiptExist</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l01845"></a>01845                                      <span class="keyword">const</span> std::string &amp; USER_ID,   <span class="comment">// Unused here for now, but still convention.</span>
<a name="l01846"></a>01846                                      <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,    <span class="comment">// If for Nymbox (vs inbox/outbox) then pass USER_ID in this field also.</span>
<a name="l01847"></a>01847                                      <span class="keyword">const</span> int32_t &amp;    nBoxType,   <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
<a name="l01848"></a>01848                                      <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER)
<a name="l01849"></a>01849 {
<a name="l01850"></a>01850 
<a name="l01851"></a>01851     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01852"></a>01852     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01853"></a>01853     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01854"></a>01854     <span class="comment">// --------------------------------------</span>
<a name="l01855"></a>01855     <span class="keywordflow">if</span> ( ! ( (0 == nBoxType)    || (1 == nBoxType) || (2 == nBoxType) ) ){
<a name="l01856"></a>01856         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nBoxType is of wrong type: value: %d\n&quot;</span>, __FUNCTION__, nBoxType);
<a name="l01857"></a>01857         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01858"></a>01858     }
<a name="l01859"></a>01859     <span class="comment">// --------------------------------------</span>
<a name="l01860"></a>01860     <span class="keywordflow">if</span> (0 &gt; TRANSACTION_NUMBER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01861"></a>01861     <span class="comment">// --------------------------------------</span>
<a name="l01862"></a>01862     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l01863"></a>01863     <span class="keyword">const</span> int64_t       lTransactionNum = TRANSACTION_NUMBER;
<a name="l01864"></a>01864     <span class="comment">// --------------------------------------</span>
<a name="l01865"></a>01865     <span class="keywordflow">switch</span> (nBoxType)
<a name="l01866"></a>01866     {
<a name="l01867"></a>01867     <span class="keywordflow">case</span> 0:     <span class="comment">// nymbox</span>
<a name="l01868"></a>01868     <span class="keywordflow">case</span> 1:     <span class="comment">// inbox</span>
<a name="l01869"></a>01869     <span class="keywordflow">case</span> 2:     <span class="comment">// outbox</span>
<a name="l01870"></a>01870         <span class="keywordflow">break</span>;
<a name="l01871"></a>01871     <span class="keywordflow">default</span>:
<a name="l01872"></a>01872         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: bad nBoxType: %d for UserID: %s AcctID: %s (expected one of: 0/nymbox, 1/inbox, 2/outbox)\n&quot;</span>,
<a name="l01873"></a>01873             __FUNCTION__, nBoxType, USER_ID.c_str(), ACCOUNT_ID.c_str());
<a name="l01874"></a>01874         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01875"></a>01875     }
<a name="l01876"></a>01876     <span class="comment">// --------------------------------------</span>
<a name="l01877"></a>01877     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acbc0834e9b4c4f995114e62436e54fea">DoesBoxReceiptExist</a>(theServerID,
<a name="l01878"></a>01878         theUserID,
<a name="l01879"></a>01879         theAccountID,   <span class="comment">// If for Nymbox (vs inbox/outbox) then pass USER_ID in this field also.</span>
<a name="l01880"></a>01880         nBoxType,       <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
<a name="l01881"></a>01881         static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l01882"></a>01882 }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884 
<a name="l01885"></a>01885 
<a name="l01886"></a>01886 
<a name="l01887"></a>01887 <span class="comment">// Returns int32_t:</span>
<a name="l01888"></a>01888 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l01889"></a>01889 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l01890"></a>01890 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l01891"></a>01891 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l01892"></a>01892 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l01893"></a>01893 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l01894"></a>01894 <span class="comment">//</span>
<a name="l01895"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac3cdd2bbe3e6fe34eaefe74ae0e5be75">01895</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ac3cdd2bbe3e6fe34eaefe74ae0e5be75">OTAPI_Exec::getBoxReceipt</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l01896"></a>01896                          <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l01897"></a>01897                          <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,        <span class="comment">// If for Nymbox (vs inbox/outbox) then pass USER_ID in this field also.</span>
<a name="l01898"></a>01898                          <span class="keyword">const</span> int32_t &amp; nBoxType,      <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
<a name="l01899"></a>01899                          <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER)
<a name="l01900"></a>01900 {
<a name="l01901"></a>01901     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01902"></a>01902     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01903"></a>01903     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01904"></a>01904     <span class="comment">// --------------------------------------</span>
<a name="l01905"></a>01905     <span class="keywordflow">if</span> ( ! ( (0 == nBoxType)    || (1 == nBoxType) || (2 == nBoxType) ) )
<a name="l01906"></a>01906     {
<a name="l01907"></a>01907         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nBoxType is of wrong type: value: %d\n&quot;</span>, __FUNCTION__, nBoxType);
<a name="l01908"></a>01908         <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l01909"></a>01909     }
<a name="l01910"></a>01910     <span class="comment">// --------------------------------------</span>
<a name="l01911"></a>01911     <span class="keywordflow">if</span> (0 &gt; TRANSACTION_NUMBER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01912"></a>01912     <span class="comment">// --------------------------------------</span>
<a name="l01913"></a>01913     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l01914"></a>01914     <span class="keyword">const</span> int64_t           lTransactionNum = TRANSACTION_NUMBER;
<a name="l01915"></a>01915     <span class="comment">// --------------------------------------</span>
<a name="l01916"></a>01916     <span class="keywordflow">switch</span> (nBoxType)
<a name="l01917"></a>01917     {
<a name="l01918"></a>01918     <span class="keywordflow">case</span> 0:     <span class="comment">// nymbox</span>
<a name="l01919"></a>01919     <span class="keywordflow">case</span> 1:     <span class="comment">// inbox</span>
<a name="l01920"></a>01920     <span class="keywordflow">case</span> 2:     <span class="comment">// outbox</span>
<a name="l01921"></a>01921         <span class="keywordflow">break</span>;
<a name="l01922"></a>01922     <span class="keywordflow">default</span>:
<a name="l01923"></a>01923         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: bad nBoxType: %d for UserID: %s AcctID: %s&quot;</span>
<a name="l01924"></a>01924             <span class="stringliteral">&quot;(expected one of: 0/nymbox, 1/inbox, 2/outbox)\n&quot;</span>, __FUNCTION__,
<a name="l01925"></a>01925                       nBoxType, USER_ID.c_str(), ACCOUNT_ID.c_str());
<a name="l01926"></a>01926         <span class="keywordflow">return</span> -1;
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0cec1627c8efa1c18cdace3894a916e1">getBoxReceipt</a>(theServerID,
<a name="l01930"></a>01930         theUserID,
<a name="l01931"></a>01931         theAccountID, <span class="comment">// If for Nymbox (vs inbox/outbox) then pass USER_ID in this field also.</span>
<a name="l01932"></a>01932         nBoxType,   <span class="comment">// 0/nymbox, 1/inbox, 2/outbox</span>
<a name="l01933"></a>01933         static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l01934"></a>01934 }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="comment">// Returns int32_t:</span>
<a name="l01940"></a>01940 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l01941"></a>01941 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l01942"></a>01942 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l01943"></a>01943 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l01944"></a>01944 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l01945"></a>01945 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l01946"></a>01946 <span class="comment">//</span>
<a name="l01947"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4373b81b1530a392ba5fbab96d7c534d">01947</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4373b81b1530a392ba5fbab96d7c534d">OTAPI_Exec::deleteAssetAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l01948"></a>01948                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l01949"></a>01949                              <span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l01950"></a>01950 {
<a name="l01951"></a>01951     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01952"></a>01952     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01953"></a>01953     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_a_p_i___exec.html#a591518898ab86707f0c4a241a3873f93">OTAPI_Exec::Wallet_CanRemoveAccount</a>(ACCOUNT_ID))
<a name="l01956"></a>01956         <span class="keywordflow">return</span> 0;
<a name="l01957"></a>01957 
<a name="l01958"></a>01958     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l01959"></a>01959 
<a name="l01960"></a>01960     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a75dfa596de3c054af8a9ffb9c51748b0">deleteAssetAccount</a>(theServerID, theUserID, theAccountID);
<a name="l01961"></a>01961 }
<a name="l01962"></a>01962 
<a name="l01963"></a>01963 
<a name="l01964"></a>01964 
<a name="l01965"></a>01965 
<a name="l01966"></a>01966 
<a name="l01967"></a>01967 <span class="comment">// --------------------------------------------</span>
<a name="l01968"></a>01968 
<a name="l01969"></a>01969 
<a name="l01970"></a>01970 
<a name="l01971"></a>01971 <span class="comment">// OT has the capability to export a Nym (normally stored in several files) as an encoded</span>
<a name="l01972"></a>01972 <span class="comment">// object (in base64-encoded form) and then import it again.</span>
<a name="l01973"></a>01973 <span class="comment">// Returns: Exported Nym in String Form.</span>
<a name="l01974"></a>01974 <span class="comment">//</span>
<a name="l01975"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5dbebdf1790c77bb839a6850cc3eb88c">01975</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5dbebdf1790c77bb839a6850cc3eb88c" title="Returns the exported Nym, if success. (Else NULL.)">OTAPI_Exec::Wallet_ExportNym</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l01976"></a>01976 {
<a name="l01977"></a>01977     <span class="comment">// -----------------------------------------------------</span>
<a name="l01978"></a>01978     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l01979"></a>01979     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01980"></a>01980 
<a name="l01981"></a>01981     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(NYM_ID);
<a name="l01984"></a>01984 
<a name="l01985"></a>01985     <span class="comment">// Create a StringMap object with these values:</span>
<a name="l01986"></a>01986     <span class="comment">//</span>
<a name="l01987"></a>01987     <span class="comment">// id:      The NymID.</span>
<a name="l01988"></a>01988     <span class="comment">// name:    The display name from the wallet.</span>
<a name="l01989"></a>01989     <span class="comment">// cert:    The public / private certfile in openssl format.</span>
<a name="l01990"></a>01990     <span class="comment">// nymfile: The contents of the nymfile.</span>
<a name="l01991"></a>01991     <span class="comment">//</span>
<a name="l01992"></a>01992     <span class="comment">// Make sure to use master key when accessing them, but then put that on</span>
<a name="l01993"></a>01993     <span class="comment">// pause while saving them to string. (Then unpause again.)</span>
<a name="l01994"></a>01994     <span class="comment">//</span>
<a name="l01995"></a>01995     <span class="comment">// Then Encode the StringMap into packed string form, and return it</span>
<a name="l01996"></a>01996     <span class="comment">// from this function (or &quot;&quot;.)</span>
<a name="l01997"></a>01997     <span class="comment">//</span>
<a name="l01998"></a>01998     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l01999"></a>01999 
<a name="l02000"></a>02000     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bExported = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#abe3cee60ee8f3d8e3660067d481b2dcc">Wallet_ExportNym</a>(theNymID, strOutput);
<a name="l02001"></a>02001 
<a name="l02002"></a>02002     <span class="keywordflow">if</span> (bExported)
<a name="l02003"></a>02003     {
<a name="l02004"></a>02004         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02005"></a>02005 
<a name="l02006"></a>02006         <span class="keywordflow">return</span> pBuf;
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5caeac705fea6d1e302b8c3c8bda0ca4">02012</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5caeac705fea6d1e302b8c3c8bda0ca4" title="Returns the exported cert, if successful. Else NULL.">OTAPI_Exec::Wallet_ExportCert</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014     <span class="comment">// -----------------------------------------------------</span>
<a name="l02015"></a>02015     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02016"></a>02016     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02017"></a>02017 
<a name="l02018"></a>02018     <span class="keywordflow">if</span> (NYM_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02019"></a>02019 
<a name="l02020"></a>02020     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID(NYM_ID);
<a name="l02021"></a>02021 
<a name="l02022"></a>02022     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l02023"></a>02023 
<a name="l02024"></a>02024     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bExported = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afebfabab4241d6aa75ce0e178e248592">Wallet_ExportCert</a>(theNymID, strOutput);
<a name="l02025"></a>02025 
<a name="l02026"></a>02026     <span class="keywordflow">if</span> (bExported)
<a name="l02027"></a>02027     {
<a name="l02028"></a>02028         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02029"></a>02029 
<a name="l02030"></a>02030         <span class="keywordflow">return</span> pBuf;
<a name="l02031"></a>02031     }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02034"></a>02034 }
<a name="l02035"></a>02035 
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 
<a name="l02038"></a>02038 <span class="comment">// OT has the capability to export a Nym (normally stored in several files) as an encoded</span>
<a name="l02039"></a>02039 <span class="comment">// object (in base64-encoded form) and then import it again.</span>
<a name="l02040"></a>02040 <span class="comment">//</span>
<a name="l02041"></a>02041 <span class="comment">// Returns: Nym ID of newly-imported Nym (or &quot;&quot;.)</span>
<a name="l02042"></a>02042 <span class="comment">//</span>
<a name="l02043"></a><a class="code" href="class_o_t_a_p_i___exec.html#a362daf677ff1aa397a02b4ba9e5be0d2">02043</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a362daf677ff1aa397a02b4ba9e5be0d2" title="returns NymID if success, else NULL.">OTAPI_Exec::Wallet_ImportNym</a>(<span class="keyword">const</span> std::string &amp; FILE_CONTENTS)
<a name="l02044"></a>02044 {
<a name="l02045"></a>02045     <span class="comment">// -----------------------------------------------------</span>
<a name="l02046"></a>02046     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02047"></a>02047     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02048"></a>02048 
<a name="l02049"></a>02049     <span class="keywordflow">if</span> (FILE_CONTENTS.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;FILE_CONTENTS&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02050"></a>02050     <span class="comment">// -----------------------------------------------------</span>
<a name="l02051"></a>02051 
<a name="l02052"></a>02052     <span class="comment">// Pause the master key, since this Nym is coming from outside</span>
<a name="l02053"></a>02053     <span class="comment">// the wallet.</span>
<a name="l02054"></a>02054     <span class="comment">//</span>
<a name="l02055"></a>02055     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strFileContents(FILE_CONTENTS);
<a name="l02056"></a>02056 
<a name="l02057"></a>02057     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bImported = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a77a64ebe7b8942ae50ed25c31834eb7c">Wallet_ImportNym</a>(strFileContents, &amp;theNymID);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061     <span class="comment">// Decode the FILE_CONTENTS into a StringMap object,</span>
<a name="l02062"></a>02062     <span class="comment">// and if success, make sure it contains these values:</span>
<a name="l02063"></a>02063     <span class="comment">//</span>
<a name="l02064"></a>02064     <span class="comment">// id:      The NymID.</span>
<a name="l02065"></a>02065     <span class="comment">// name:    The display name from the wallet.</span>
<a name="l02066"></a>02066     <span class="comment">// cert:    The public / private certfile in openssl format.</span>
<a name="l02067"></a>02067     <span class="comment">// nymfile: The contents of the nymfile.</span>
<a name="l02068"></a>02068     <span class="comment">//</span>
<a name="l02069"></a>02069     <span class="comment">// Unpause the master key.</span>
<a name="l02070"></a>02070     <span class="comment">//</span>
<a name="l02071"></a>02071     <span class="comment">// Do various verifications on the values to make sure there&#39;s no funny business.</span>
<a name="l02072"></a>02072     <span class="comment">//</span>
<a name="l02073"></a>02073     <span class="comment">// Make sure the Nym with this ID isn&#39;t ALREADY in the wallet. If not, then add it.</span>
<a name="l02074"></a>02074     <span class="comment">//</span>
<a name="l02075"></a>02075     <span class="comment">//</span>
<a name="l02076"></a>02076     <span class="comment">//</span>
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     <span class="keywordflow">if</span> (bImported)
<a name="l02079"></a>02079     {
<a name="l02080"></a>02080         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID);
<a name="l02081"></a>02081 
<a name="l02082"></a>02082         std::string pBuf = strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02083"></a>02083 
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 
<a name="l02086"></a>02086         <span class="keywordflow">return</span> pBuf;
<a name="l02087"></a>02087     }
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02090"></a>02090 }
<a name="l02091"></a>02091 
<a name="l02092"></a>02092 
<a name="l02093"></a>02093 
<a name="l02094"></a>02094 <span class="comment">// In this case, instead of importing a special &quot;OT Nym all-in-one exported&quot; file format,</span>
<a name="l02095"></a>02095 <span class="comment">// we are importing the public/private keys only, from their Cert file contents, and then</span>
<a name="l02096"></a>02096 <span class="comment">// creating a blank Nymfile to go aint64_t with it. This is for when people wish to import</span>
<a name="l02097"></a>02097 <span class="comment">// pre-existing keys to create a new Nym.</span>
<a name="l02098"></a>02098 <span class="comment">//</span>
<a name="l02099"></a>02099 <span class="comment">// Returns: Nym ID of newly-imported Nym (or &quot;&quot;.)</span>
<a name="l02100"></a>02100 <span class="comment">//</span>
<a name="l02101"></a><a class="code" href="class_o_t_a_p_i___exec.html#a58c93b75b825ddee3ab441c9384584d8">02101</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a58c93b75b825ddee3ab441c9384584d8" title="Returns the imported cert&#39;s NymID, if successful. Else NULL.">OTAPI_Exec::Wallet_ImportCert</a>(<span class="keyword">const</span> std::string &amp; DISPLAY_NAME, <span class="keyword">const</span> std::string &amp; FILE_CONTENTS)
<a name="l02102"></a>02102 {
<a name="l02103"></a>02103     <span class="comment">// -----------------------------------------------------</span>
<a name="l02104"></a>02104     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02105"></a>02105     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02106"></a>02106 
<a name="l02107"></a>02107 <span class="comment">//  if (DISPLAY_NAME.empty())  { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;DISPLAY_NAME&quot;        ); OT_FAIL; }</span>
<a name="l02108"></a>02108     <span class="keywordflow">if</span> (FILE_CONTENTS.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;FILE_CONTENTS&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strDisplayName (DISPLAY_NAME),
<a name="l02111"></a>02111                    strFileContents(FILE_CONTENTS);
<a name="l02112"></a>02112 
<a name="l02113"></a>02113     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theNymID;
<a name="l02114"></a>02114 
<a name="l02115"></a>02115     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bImported = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a52464281f46358635dde59e3b787354e">Wallet_ImportCert</a>(strDisplayName, strFileContents, &amp;theNymID);
<a name="l02116"></a>02116 
<a name="l02117"></a>02117     <span class="keywordflow">if</span> (bImported)
<a name="l02118"></a>02118     {
<a name="l02119"></a>02119         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID);
<a name="l02120"></a>02120 
<a name="l02121"></a>02121         std::string pBuf = strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02122"></a>02122 
<a name="l02123"></a>02123         <span class="keywordflow">return</span> pBuf;
<a name="l02124"></a>02124     }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02127"></a>02127 }
<a name="l02128"></a>02128 
<a name="l02129"></a>02129 
<a name="l02130"></a>02130 
<a name="l02131"></a>02131 
<a name="l02132"></a>02132 
<a name="l02133"></a>02133 <span class="comment">/*</span>
<a name="l02134"></a>02134 <span class="comment">CHANGE MASTER KEY and PASSWORD.</span>
<a name="l02135"></a>02135 <span class="comment"></span>
<a name="l02136"></a>02136 <span class="comment">Normally your passphrase is used to derive a key, which is used to unlock</span>
<a name="l02137"></a>02137 <span class="comment">a random number (a symmetric key), which is used as the passphrase to open the</span>
<a name="l02138"></a>02138 <span class="comment">master key, which is used as the passphrase to any given Nym.</span>
<a name="l02139"></a>02139 <span class="comment"></span>
<a name="l02140"></a>02140 <span class="comment">Since all the Nyms are encrypted to the master key, and since we can change the</span>
<a name="l02141"></a>02141 <span class="comment">passphrase on the master key without changing the master key itself, then we don&#39;t</span>
<a name="l02142"></a>02142 <span class="comment">have to do anything to update all the Nyms, since that part hasn&#39;t changed.</span>
<a name="l02143"></a>02143 <span class="comment"></span>
<a name="l02144"></a>02144 <span class="comment">But we might want a separate &quot;Change Master Key&quot; function that replaces that key</span>
<a name="l02145"></a>02145 <span class="comment">itself, in which case we&#39;d HAVE to load up all the Nyms and re-save them.</span>
<a name="l02146"></a>02146 <span class="comment"></span>
<a name="l02147"></a>02147 <span class="comment">UPDATE: Seems the easiest thing to do is to just change both the key and passphase</span>
<a name="l02148"></a>02148 <span class="comment">at the same time here, by loading up all the private nyms, destroying the master key,</span>
<a name="l02149"></a>02149 <span class="comment">and then saving all the private Nyms. (With master key never actually being &quot;paused.&quot;)</span>
<a name="l02150"></a>02150 <span class="comment">This will automatically cause it to generate a new master key during the saving process.</span>
<a name="l02151"></a>02151 <span class="comment">(Make sure to save the wallet also.)</span>
<a name="l02152"></a>02152 <span class="comment">*/</span>
<a name="l02153"></a><a class="code" href="class_o_t_a_p_i___exec.html#a16826a31571be5b0281660464b2ff2af">02153</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a16826a31571be5b0281660464b2ff2af">OTAPI_Exec::Wallet_ChangePassphrase</a>()
<a name="l02154"></a>02154 {
<a name="l02155"></a>02155     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a90f13aec197a306faca8f87d1dd8d1dd">Wallet_ChangePassphrase</a>();
<a name="l02156"></a>02156 }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158 
<a name="l02159"></a>02159 <span class="comment">//bool OTPseudonym::Savex509CertAndPrivateKeyToString(OTString &amp; strOutput, OTString * pstrReason/*=&quot;&quot;*/)</span>
<a name="l02160"></a>02160 
<a name="l02161"></a>02161 <span class="comment">//bool OTPseudonym::Savex509CertAndPrivateKey(bool       bCreateFile/*=true*/,</span>
<a name="l02162"></a>02162 <span class="comment">//                                            OTString * pstrReason/*=&quot;&quot;*/)</span>
<a name="l02163"></a>02163 
<a name="l02164"></a>02164 <span class="comment">// ------------------------------------------------------------------------------------------------</span>
<a name="l02165"></a>02165 
<a name="l02166"></a>02166 
<a name="l02167"></a>02167 
<a name="l02168"></a>02168 
<a name="l02169"></a>02169 <span class="comment">// Attempts to find a full ID in the wallet, based on a partial of the same ID.</span>
<a name="l02170"></a>02170 <span class="comment">// Returns &quot;&quot; on failure, otherwise returns the full ID.</span>
<a name="l02171"></a>02171 <span class="comment">//</span>
<a name="l02172"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5b814460ca849a37beb4a11f8983e420">02172</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5b814460ca849a37beb4a11f8983e420">OTAPI_Exec::Wallet_GetNymIDFromPartial</a>(<span class="keyword">const</span> std::string &amp; PARTIAL_ID)
<a name="l02173"></a>02173 {
<a name="l02174"></a>02174 <span class="comment">//  OTPseudonym *   GetNym(const OTIdentifier &amp; NYM_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02175"></a>02175 <span class="comment">//  OTPseudonym *   GetNymByIDPartialMatch(const std::string &amp;PARTIAL_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02176"></a>02176     <span class="comment">// -----------------------------------------------------</span>
<a name="l02177"></a>02177     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02178"></a>02178     <span class="keywordflow">if</span> (!bIsInitialized)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span> ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02179"></a>02179     <span class="keywordflow">if</span> (PARTIAL_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTIAL_ID&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02180"></a>02180     <span class="comment">// -----------------------------------------------------</span>
<a name="l02181"></a>02181     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  thePartialID(PARTIAL_ID);
<a name="l02182"></a>02182 
<a name="l02183"></a>02183     <span class="comment">// In this case, the user passed in the FULL ID.</span>
<a name="l02184"></a>02184     <span class="comment">// (We STILL confirm whether he&#39;s found in the wallet...)</span>
<a name="l02185"></a>02185     <span class="comment">//</span>
<a name="l02186"></a>02186     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(thePartialID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetNymIDFromPartial&quot;</span>);
<a name="l02187"></a>02187 
<a name="l02188"></a>02188     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as full ID.)</span>
<a name="l02189"></a>02189     {
<a name="l02190"></a>02190         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output(thePartialID);
<a name="l02191"></a>02191         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02192"></a>02192 
<a name="l02193"></a>02193         <span class="keywordflow">return</span> pBuf;
<a name="l02194"></a>02194     }
<a name="l02195"></a>02195     <span class="comment">// ------------------------------------------</span>
<a name="l02196"></a>02196     <span class="comment">// Below this point, it definitely wasn&#39;t a FULL ID, so now we can</span>
<a name="l02197"></a>02197     <span class="comment">// go ahead and search for it as a PARTIAL ID...</span>
<a name="l02198"></a>02198     <span class="comment">//</span>
<a name="l02199"></a>02199     pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa0bdb71f4b4b19f8a49061cbc2d037c4">GetNymByIDPartialMatch</a>(PARTIAL_ID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetNymIDFromPartial&quot;</span>);
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as partial ID.)</span>
<a name="l02202"></a>02202     {
<a name="l02203"></a>02203         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output;
<a name="l02204"></a>02204         pObject-&gt;<a class="code" href="class_o_t_pseudonym.html#a1775c7aedd0dd25b2faf3f78dcccabe7">GetIdentifier</a>(strID_Output);
<a name="l02205"></a>02205         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02206"></a>02206         <span class="keywordflow">return</span> pBuf;
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02210"></a>02210 }
<a name="l02211"></a>02211 
<a name="l02212"></a>02212 <span class="comment">// Attempts to find a full ID in the wallet, based on a partial of the same ID.</span>
<a name="l02213"></a>02213 <span class="comment">// Returns &quot;&quot; on failure, otherwise returns the full ID.</span>
<a name="l02214"></a>02214 <span class="comment">//</span>
<a name="l02215"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4dadb29632efad3f1b9f71ae72b14e9d">02215</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4dadb29632efad3f1b9f71ae72b14e9d">OTAPI_Exec::Wallet_GetServerIDFromPartial</a>(<span class="keyword">const</span> std::string &amp; PARTIAL_ID)
<a name="l02216"></a>02216 {
<a name="l02217"></a>02217 <span class="comment">//    OTServerContract *    GetServer(const OTIdentifier &amp; THE_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02218"></a>02218 <span class="comment">//    OTServerContract *    GetServerContractPartialMatch(const std::string &amp;PARTIAL_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02219"></a>02219     <span class="comment">// -----------------------------------------------------</span>
<a name="l02220"></a>02220     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02221"></a>02221     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>      ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223     <span class="keywordflow">if</span> (PARTIAL_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTIAL_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02224"></a>02224     <span class="comment">// -----------------------------------------------------</span>
<a name="l02225"></a>02225     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  thePartialID(PARTIAL_ID);
<a name="l02226"></a>02226 
<a name="l02227"></a>02227     <span class="comment">// In this case, the user passed in the FULL ID.</span>
<a name="l02228"></a>02228     <span class="comment">// (We STILL confirm whether he&#39;s found in the wallet...)</span>
<a name="l02229"></a>02229     <span class="comment">//</span>
<a name="l02230"></a>02230     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(thePartialID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetServerIDFromPartial&quot;</span>);
<a name="l02231"></a>02231 
<a name="l02232"></a>02232     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as full ID.)</span>
<a name="l02233"></a>02233     {
<a name="l02234"></a>02234         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output(thePartialID);
<a name="l02235"></a>02235         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02236"></a>02236 
<a name="l02237"></a>02237         <span class="keywordflow">return</span> pBuf;
<a name="l02238"></a>02238     }
<a name="l02239"></a>02239     <span class="comment">// ------------------------------------------</span>
<a name="l02240"></a>02240     <span class="comment">// Below this point, it definitely wasn&#39;t a FULL ID, so now we can</span>
<a name="l02241"></a>02241     <span class="comment">// go ahead and search for it as a PARTIAL ID...</span>
<a name="l02242"></a>02242     <span class="comment">//</span>
<a name="l02243"></a>02243     pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a27228b655e5c661959812e3a2b7f144e">GetServerContractPartialMatch</a>(PARTIAL_ID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetServerIDFromPartial&quot;</span>);
<a name="l02244"></a>02244 
<a name="l02245"></a>02245     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as partial ID.)</span>
<a name="l02246"></a>02246     {
<a name="l02247"></a>02247         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output;
<a name="l02248"></a>02248         pObject-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strID_Output);
<a name="l02249"></a>02249         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02250"></a>02250 
<a name="l02251"></a>02251         <span class="keywordflow">return</span> pBuf;
<a name="l02252"></a>02252     }
<a name="l02253"></a>02253 
<a name="l02254"></a>02254     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02255"></a>02255 }
<a name="l02256"></a>02256 
<a name="l02257"></a>02257 <span class="comment">// Attempts to find a full ID in the wallet, based on a partial of the same ID.</span>
<a name="l02258"></a>02258 <span class="comment">// Returns &quot;&quot; on failure, otherwise returns the full ID.</span>
<a name="l02259"></a>02259 <span class="comment">//</span>
<a name="l02260"></a><a class="code" href="class_o_t_a_p_i___exec.html#a25b73aa089db9d5b4452e1a2bb5dfff4">02260</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a25b73aa089db9d5b4452e1a2bb5dfff4">OTAPI_Exec::Wallet_GetAssetIDFromPartial</a>(<span class="keyword">const</span> std::string &amp; PARTIAL_ID)
<a name="l02261"></a>02261 {
<a name="l02262"></a>02262     <span class="comment">//    OTAssetContract * GetAssetType(const OTIdentifier &amp; THE_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02263"></a>02263     <span class="comment">//    OTAssetContract * GetAssetContractPartialMatch(const std::string &amp;PARTIAL_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02264"></a>02264 
<a name="l02265"></a>02265     <span class="comment">// -----------------------------------------------------</span>
<a name="l02266"></a>02266     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02267"></a>02267     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>      ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02268"></a>02268 
<a name="l02269"></a>02269     <span class="keywordflow">if</span> (PARTIAL_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTIAL_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02270"></a>02270     <span class="comment">// -----------------------------------------------------</span>
<a name="l02271"></a>02271 
<a name="l02272"></a>02272     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  thePartialID(PARTIAL_ID);
<a name="l02273"></a>02273 
<a name="l02274"></a>02274     <span class="comment">// In this case, the user passed in the FULL ID.</span>
<a name="l02275"></a>02275     <span class="comment">// (We STILL confirm whether he&#39;s found in the wallet...)</span>
<a name="l02276"></a>02276     <span class="comment">//</span>
<a name="l02277"></a>02277     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(thePartialID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetAssetIDFromPartial&quot;</span>);
<a name="l02278"></a>02278 
<a name="l02279"></a>02279     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as full ID.)</span>
<a name="l02280"></a>02280     {
<a name="l02281"></a>02281         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output(thePartialID);
<a name="l02282"></a>02282         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02283"></a>02283 
<a name="l02284"></a>02284         <span class="keywordflow">return</span> pBuf;
<a name="l02285"></a>02285     }
<a name="l02286"></a>02286     <span class="comment">// ------------------------------------------</span>
<a name="l02287"></a>02287     <span class="comment">// Below this point, it definitely wasn&#39;t a FULL ID, so now we can</span>
<a name="l02288"></a>02288     <span class="comment">// go ahead and search for it as a PARTIAL ID...</span>
<a name="l02289"></a>02289     <span class="comment">//</span>
<a name="l02290"></a>02290     pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aec51f205544c3c4a8acf95e1562292ba">GetAssetContractPartialMatch</a>(PARTIAL_ID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetAssetIDFromPartial&quot;</span>);
<a name="l02291"></a>02291 
<a name="l02292"></a>02292     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as partial ID.)</span>
<a name="l02293"></a>02293     {
<a name="l02294"></a>02294         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output;
<a name="l02295"></a>02295         pObject-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strID_Output);
<a name="l02296"></a>02296         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02297"></a>02297 
<a name="l02298"></a>02298         <span class="keywordflow">return</span> pBuf;
<a name="l02299"></a>02299     }
<a name="l02300"></a>02300 
<a name="l02301"></a>02301     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02302"></a>02302 }
<a name="l02303"></a>02303 
<a name="l02304"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5e624ce60190f892ba9e77463862b258">02304</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5e624ce60190f892ba9e77463862b258">OTAPI_Exec::Wallet_GetAccountIDFromPartial</a>(<span class="keyword">const</span> std::string &amp; PARTIAL_ID)
<a name="l02305"></a>02305 {
<a name="l02306"></a>02306     <span class="comment">//    OTAccount *   GetAccount(const OTIdentifier &amp; THE_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02307"></a>02307     <span class="comment">//    OTAccount *   GetAccountPartialMatch(const std::string &amp;PARTIAL_ID, const std::string &amp; strFuncName=&quot;&quot;);</span>
<a name="l02308"></a>02308 
<a name="l02309"></a>02309     <span class="comment">// -----------------------------------------------------</span>
<a name="l02310"></a>02310     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l02311"></a>02311     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>      ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02312"></a>02312 
<a name="l02313"></a>02313     <span class="keywordflow">if</span> (PARTIAL_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTIAL_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02314"></a>02314     <span class="comment">// -----------------------------------------------------</span>
<a name="l02315"></a>02315 
<a name="l02316"></a>02316     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  thePartialID(PARTIAL_ID);
<a name="l02317"></a>02317 
<a name="l02318"></a>02318     <span class="comment">// In this case, the user passed in the FULL ID.</span>
<a name="l02319"></a>02319     <span class="comment">// (We STILL confirm whether he&#39;s found in the wallet...)</span>
<a name="l02320"></a>02320     <span class="comment">//</span>
<a name="l02321"></a>02321     <a class="code" href="class_o_t_account.html">OTAccount</a> * pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(thePartialID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetNymIDFromPartial&quot;</span>);
<a name="l02322"></a>02322 
<a name="l02323"></a>02323     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as full ID.)</span>
<a name="l02324"></a>02324     {
<a name="l02325"></a>02325         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output(thePartialID);
<a name="l02326"></a>02326         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02327"></a>02327 
<a name="l02328"></a>02328         <span class="keywordflow">return</span> pBuf;
<a name="l02329"></a>02329     }
<a name="l02330"></a>02330     <span class="comment">// ------------------------------------------</span>
<a name="l02331"></a>02331     <span class="comment">// Below this point, it definitely wasn&#39;t a FULL ID, so now we can</span>
<a name="l02332"></a>02332     <span class="comment">// go ahead and search for it as a PARTIAL ID...</span>
<a name="l02333"></a>02333     <span class="comment">//</span>
<a name="l02334"></a>02334     pObject = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7a602b75fccd8b11b73508ce358a4594">GetAccountPartialMatch</a>(PARTIAL_ID, <span class="stringliteral">&quot;OTAPI_Exec::Wallet_GetNymIDFromPartial&quot;</span>);
<a name="l02335"></a>02335 
<a name="l02336"></a>02336     <span class="keywordflow">if</span> (NULL != pObject) <span class="comment">// Found it (as partial ID.)</span>
<a name="l02337"></a>02337     {
<a name="l02338"></a>02338         <a class="code" href="class_o_t_string.html">OTString</a> strID_Output;
<a name="l02339"></a>02339         pObject-&gt;<a class="code" href="class_o_t_contract.html#acf77d2db6da3904aa8b03e7b87c02e4e">GetIdentifier</a>(strID_Output);
<a name="l02340"></a>02340         std::string pBuf = strID_Output.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02341"></a>02341 
<a name="l02342"></a>02342         <span class="keywordflow">return</span> pBuf;
<a name="l02343"></a>02343     }
<a name="l02344"></a>02344 
<a name="l02345"></a>02345     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02346"></a>02346 }
<a name="l02347"></a>02347 
<a name="l02348"></a>02348 
<a name="l02349"></a>02349 <span class="comment">// ----------------------------------------------------------------</span>
<a name="l02350"></a>02350 
<a name="l02352"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5c205cfa5e6f9a05e87b4894e92e8086">02352</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5c205cfa5e6f9a05e87b4894e92e8086" title="based on Index this returns the Nym&#39;s ID">OTAPI_Exec::GetNym_ID</a>(<span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02353"></a>02353 {
<a name="l02354"></a>02354     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02355"></a>02355 
<a name="l02356"></a>02356     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID;
<a name="l02357"></a>02357     <a class="code" href="class_o_t_string.html">OTString</a>        strName;
<a name="l02358"></a>02358 
<a name="l02359"></a>02359     <span class="keywordtype">bool</span> bGetNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(nIndex, theNymID, strName);
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     <span class="keywordflow">if</span> (bGetNym)
<a name="l02362"></a>02362     {
<a name="l02363"></a>02363         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID);
<a name="l02364"></a>02364 
<a name="l02365"></a>02365         std::string pBuf = strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02366"></a>02366 
<a name="l02367"></a>02367 
<a name="l02368"></a>02368 
<a name="l02369"></a>02369         <span class="keywordflow">return</span> pBuf;
<a name="l02370"></a>02370     }
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02373"></a>02373 }
<a name="l02374"></a>02374 
<a name="l02376"></a><a class="code" href="class_o_t_a_p_i___exec.html#a67037f27744d22dd75158acccbd54b50">02376</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a67037f27744d22dd75158acccbd54b50" title="Returns Nym Name (based on NymID)">OTAPI_Exec::GetNym_Name</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02377"></a>02377 {
<a name="l02378"></a>02378     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null NYM_ID passed in!\n&quot;</span> ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02379"></a>02379     <span class="comment">// ---------------------------------------------</span>
<a name="l02380"></a>02380     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02381"></a>02381     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>   * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID);
<a name="l02382"></a>02382 
<a name="l02383"></a>02383     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02384"></a>02384     {
<a name="l02385"></a>02385         <a class="code" href="class_o_t_string.html">OTString</a> &amp; strName = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a42e63697c3c3b1bdb526ee7990a9c0e7">GetNymName</a>();
<a name="l02386"></a>02386         std::string pBuf = strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02387"></a>02387 
<a name="l02388"></a>02388         <span class="keywordflow">return</span> pBuf;
<a name="l02389"></a>02389     }
<a name="l02390"></a>02390     <span class="comment">// ---------------------------------------------</span>
<a name="l02391"></a>02391     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02392"></a>02392 }
<a name="l02393"></a>02393 
<a name="l02394"></a>02394 
<a name="l02395"></a>02395 
<a name="l02396"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7de7a08dccfd1343129932f3459b8298">02396</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a7de7a08dccfd1343129932f3459b8298">OTAPI_Exec::IsNym_RegisteredAtServer</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; SERVER_ID)
<a name="l02397"></a>02397 {
<a name="l02398"></a>02398     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02399"></a>02399     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02400"></a>02400 
<a name="l02401"></a>02401     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(NYM_ID),
<a name="l02402"></a>02402         theServerID(SERVER_ID);
<a name="l02403"></a>02403 
<a name="l02404"></a>02404     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1124d87febc45eec06c1c9e8a2cc91da">IsNym_RegisteredAtServer</a>(theNymID, theServerID);
<a name="l02405"></a>02405 
<a name="l02406"></a>02406     <span class="keywordflow">return</span> (bSuccess) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l02407"></a>02407 }
<a name="l02408"></a>02408 
<a name="l02409"></a>02409 
<a name="l02410"></a>02410 <span class="comment">//--------------------------------------------------------</span>
<a name="l02411"></a>02411 
<a name="l02412"></a>02412 
<a name="l02413"></a>02413 
<a name="l02414"></a>02414 <span class="comment">// Returns Nym data (based on NymID)</span>
<a name="l02415"></a>02415 <span class="comment">//</span>
<a name="l02416"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa84ff0c163f6501ea7623a4dd02cdab8">02416</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa84ff0c163f6501ea7623a4dd02cdab8">OTAPI_Exec::GetNym_Stats</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02417"></a>02417 {
<a name="l02418"></a>02418     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02419"></a>02419 
<a name="l02420"></a>02420     <span class="comment">// -------------------------</span>
<a name="l02421"></a>02421     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02422"></a>02422     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02423"></a>02423 
<a name="l02424"></a>02424     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02425"></a>02425     {
<a name="l02426"></a>02426         <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l02427"></a>02427 
<a name="l02428"></a>02428         pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aaded4e78ed9fa9960ee67a391c793b9e">DisplayStatistics</a>(strOutput);
<a name="l02429"></a>02429 
<a name="l02430"></a>02430         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02431"></a>02431 
<a name="l02432"></a>02432 
<a name="l02433"></a>02433 
<a name="l02434"></a>02434         <span class="keywordflow">return</span> pBuf;
<a name="l02435"></a>02435     }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02438"></a>02438 }
<a name="l02439"></a>02439 
<a name="l02440"></a>02440 
<a name="l02441"></a>02441 <span class="comment">// Returns NymboxHash (based on ServerID)</span>
<a name="l02442"></a>02442 <span class="comment">//</span>
<a name="l02443"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6735cad3ccb68577d64222b5c557dc0a">02443</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a6735cad3ccb68577d64222b5c557dc0a">OTAPI_Exec::GetNym_NymboxHash</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; NYM_ID) <span class="comment">// Returns NymboxHash (based on ServerID)</span>
<a name="l02444"></a>02444 {
<a name="l02445"></a>02445     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02446"></a>02446     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02447"></a>02447 
<a name="l02448"></a>02448     <span class="comment">// -------------------------</span>
<a name="l02449"></a>02449     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02450"></a>02450     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02451"></a>02451 
<a name="l02452"></a>02452     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02453"></a>02453     {
<a name="l02454"></a>02454         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymboxHash;
<a name="l02455"></a>02455         <span class="keyword">const</span>
<a name="l02456"></a>02456             std::string     str_server_id(SERVER_ID);
<a name="l02457"></a>02457         <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bGothash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a461ac5959e5f91add57549be10d82e36">GetNymboxHash</a>(str_server_id, theNymboxHash); <span class="comment">// (theNymboxHash is output.)</span>
<a name="l02458"></a>02458 
<a name="l02459"></a>02459         <span class="keywordflow">if</span> (!bGothash)
<a name="l02460"></a>02460         {
<a name="l02461"></a>02461             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID); <span class="comment">// You might ask, why create this string and not just use NYM_ID?</span>
<a name="l02462"></a>02462             <span class="comment">// The answer is because I&#39;m looking forward to a day soon when we don&#39;t passconst std::string &amp; in the first</span>
<a name="l02463"></a>02463             <span class="comment">// place, and thus I can&#39;t always expect that variable will be there.</span>
<a name="l02464"></a>02464             <span class="comment">//</span>
<a name="l02465"></a>02465             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: NymboxHash not found, on client side, &quot;</span>
<a name="l02466"></a>02466                 <span class="stringliteral">&quot;for server %s and nym %s. (Returning &quot;</span><span class="stringliteral">&quot;.)\n&quot;</span>,
<a name="l02467"></a>02467                 __FUNCTION__, str_server_id.c_str(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02468"></a>02468         }
<a name="l02469"></a>02469         <span class="keywordflow">else</span> <span class="comment">// Success: the hash was there, for that Nym, for that server ID.</span>
<a name="l02470"></a>02470         {
<a name="l02471"></a>02471             <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theNymboxHash);
<a name="l02472"></a>02472 
<a name="l02473"></a>02473             std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02474"></a>02474 
<a name="l02475"></a>02475 
<a name="l02476"></a>02476 
<a name="l02477"></a>02477             <span class="keywordflow">return</span> pBuf;
<a name="l02478"></a>02478         }
<a name="l02479"></a>02479     }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02482"></a>02482 }
<a name="l02483"></a>02483 
<a name="l02484"></a>02484 <span class="comment">//--------------------------------------------------------</span>
<a name="l02485"></a>02485 
<a name="l02486"></a>02486 <span class="comment">// Returns RecentHash (based on ServerID)</span>
<a name="l02487"></a>02487 <span class="comment">//</span>
<a name="l02488"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0cbf45897dca8d8959dba18527c5aacb">02488</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a0cbf45897dca8d8959dba18527c5aacb">OTAPI_Exec::GetNym_RecentHash</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; NYM_ID) <span class="comment">// Returns RecentHash (based on ServerID)</span>
<a name="l02489"></a>02489 {
<a name="l02490"></a>02490     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02491"></a>02491     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02492"></a>02492 
<a name="l02493"></a>02493     <span class="comment">// -------------------------</span>
<a name="l02494"></a>02494     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02495"></a>02495     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02496"></a>02496 
<a name="l02497"></a>02497     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02498"></a>02498     {
<a name="l02499"></a>02499         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theHash;
<a name="l02500"></a>02500         <span class="keyword">const</span>
<a name="l02501"></a>02501             std::string     str_server_id(SERVER_ID);
<a name="l02502"></a>02502         <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bGothash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a9222447403d249269bcbc3a4cab5de02">GetRecentHash</a>(str_server_id, theHash); <span class="comment">// (theHash is output.)</span>
<a name="l02503"></a>02503 
<a name="l02504"></a>02504         <span class="keywordflow">if</span> (!bGothash)
<a name="l02505"></a>02505         {
<a name="l02506"></a>02506             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID); <span class="comment">// You might ask, why create this string and not just use NYM_ID?</span>
<a name="l02507"></a>02507             <span class="comment">// The answer is because I&#39;m looking forward to a day soon when we don&#39;t passconst std::string &amp; in the first</span>
<a name="l02508"></a>02508             <span class="comment">// place, and thus I can&#39;t always expect that variable will be there.</span>
<a name="l02509"></a>02509             <span class="comment">//</span>
<a name="l02510"></a>02510             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: RecentHash not found, on client side, &quot;</span>
<a name="l02511"></a>02511                 <span class="stringliteral">&quot;for server %s and nym %s. (Returning &quot;</span><span class="stringliteral">&quot;.)\n&quot;</span>,
<a name="l02512"></a>02512                 __FUNCTION__, str_server_id.c_str(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02513"></a>02513         }
<a name="l02514"></a>02514         <span class="keywordflow">else</span> <span class="comment">// Success: the hash was there, for that Nym, for that server ID.</span>
<a name="l02515"></a>02515         {
<a name="l02516"></a>02516             <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theHash);
<a name="l02517"></a>02517 
<a name="l02518"></a>02518             std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02519"></a>02519 
<a name="l02520"></a>02520 
<a name="l02521"></a>02521 
<a name="l02522"></a>02522             <span class="keywordflow">return</span> pBuf;
<a name="l02523"></a>02523         }
<a name="l02524"></a>02524     }
<a name="l02525"></a>02525 
<a name="l02526"></a>02526     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02527"></a>02527 }
<a name="l02528"></a>02528 
<a name="l02529"></a>02529 
<a name="l02530"></a>02530 
<a name="l02531"></a><a class="code" href="class_o_t_a_p_i___exec.html#afd6570cf9561be931f7b38cdc915a185">02531</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afd6570cf9561be931f7b38cdc915a185">OTAPI_Exec::GetNym_InboxHash</a>(<span class="keyword">const</span> std::string &amp; ACCOUNT_ID, <span class="keyword">const</span> std::string &amp; NYM_ID) <span class="comment">// InboxHash for &quot;most recently DOWNLOADED&quot; Inbox (by AccountID)</span>
<a name="l02532"></a>02532 {
<a name="l02533"></a>02533     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02534"></a>02534     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536     <span class="comment">// -------------------------</span>
<a name="l02537"></a>02537     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02538"></a>02538     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02539"></a>02539 
<a name="l02540"></a>02540     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02541"></a>02541     {
<a name="l02542"></a>02542         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theHash;
<a name="l02543"></a>02543         <span class="keyword">const</span>
<a name="l02544"></a>02544             std::string     str_acct_id(ACCOUNT_ID);
<a name="l02545"></a>02545         <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bGothash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a89fb6af0b242e8b4468d34b0057e95f5">GetInboxHash</a>(str_acct_id, theHash); <span class="comment">// (theHash is output.)</span>
<a name="l02546"></a>02546 
<a name="l02547"></a>02547         <span class="keywordflow">if</span> (!bGothash)
<a name="l02548"></a>02548         {
<a name="l02549"></a>02549             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID); <span class="comment">// You might ask, why create this string and not just use NYM_ID?</span>
<a name="l02550"></a>02550             <span class="comment">// The answer is because I&#39;m looking forward to a day soon when we don&#39;t passconst std::string &amp; in the first</span>
<a name="l02551"></a>02551             <span class="comment">// place, and thus I can&#39;t always expect that variable will be there.</span>
<a name="l02552"></a>02552             <span class="comment">//</span>
<a name="l02553"></a>02553             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: InboxHash not found, on client side, &quot;</span>
<a name="l02554"></a>02554                 <span class="stringliteral">&quot;for account %s and nym %s. (Returning &quot;</span><span class="stringliteral">&quot;.)\n&quot;</span>,
<a name="l02555"></a>02555                 __FUNCTION__, str_acct_id.c_str(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02556"></a>02556         }
<a name="l02557"></a>02557         <span class="keywordflow">else</span> <span class="comment">// Success: the hash was there, for that Nym, for that server ID.</span>
<a name="l02558"></a>02558         {
<a name="l02559"></a>02559             <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theHash);
<a name="l02560"></a>02560 
<a name="l02561"></a>02561             std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02562"></a>02562 
<a name="l02563"></a>02563 
<a name="l02564"></a>02564             <span class="keywordflow">return</span> pBuf;
<a name="l02565"></a>02565         }
<a name="l02566"></a>02566     }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02569"></a>02569 }
<a name="l02570"></a>02570 
<a name="l02571"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab057fc8ea20957ded3338f74e13d8338">02571</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab057fc8ea20957ded3338f74e13d8338">OTAPI_Exec::GetNym_OutboxHash</a>(<span class="keyword">const</span> std::string &amp; ACCOUNT_ID, <span class="keyword">const</span> std::string &amp; NYM_ID) <span class="comment">// OutboxHash for &quot;most recently DOWNLOADED&quot; Outbox (by AccountID)</span>
<a name="l02572"></a>02572 {
<a name="l02573"></a>02573     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02574"></a>02574     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02575"></a>02575 
<a name="l02576"></a>02576     <span class="comment">// -------------------------</span>
<a name="l02577"></a>02577     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02578"></a>02578     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02579"></a>02579 
<a name="l02580"></a>02580     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l02581"></a>02581     {
<a name="l02582"></a>02582         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theHash;
<a name="l02583"></a>02583         <span class="keyword">const</span>
<a name="l02584"></a>02584             std::string     str_acct_id(ACCOUNT_ID);
<a name="l02585"></a>02585         <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bGothash = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aae9b25973d9bce353fb124bcebbb4fc6">GetOutboxHash</a>(str_acct_id, theHash); <span class="comment">// (theHash is output.)</span>
<a name="l02586"></a>02586 
<a name="l02587"></a>02587         <span class="keywordflow">if</span> (!bGothash)
<a name="l02588"></a>02588         {
<a name="l02589"></a>02589             <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theNymID); <span class="comment">// You might ask, why create this string and not just use NYM_ID?</span>
<a name="l02590"></a>02590             <span class="comment">// The answer is because I&#39;m looking forward to a day soon when we don&#39;t passconst std::string &amp; in the first</span>
<a name="l02591"></a>02591             <span class="comment">// place, and thus I can&#39;t always expect that variable will be there.</span>
<a name="l02592"></a>02592             <span class="comment">//</span>
<a name="l02593"></a>02593             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: OutboxHash not found, on client side, &quot;</span>
<a name="l02594"></a>02594                 <span class="stringliteral">&quot;for account %s and nym %s. (Returning &quot;</span><span class="stringliteral">&quot;.)\n&quot;</span>,
<a name="l02595"></a>02595                 __FUNCTION__, str_acct_id.c_str(), strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l02596"></a>02596         }
<a name="l02597"></a>02597         <span class="keywordflow">else</span> <span class="comment">// Success: the hash was there, for that Nym, for that server ID.</span>
<a name="l02598"></a>02598         {
<a name="l02599"></a>02599             <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theHash);
<a name="l02600"></a>02600 
<a name="l02601"></a>02601             std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02602"></a>02602 
<a name="l02603"></a>02603 
<a name="l02604"></a>02604 
<a name="l02605"></a>02605             <span class="keywordflow">return</span> pBuf;
<a name="l02606"></a>02606         }
<a name="l02607"></a>02607     }
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02610"></a>02610 }
<a name="l02611"></a>02611 
<a name="l02612"></a>02612 
<a name="l02613"></a>02613 <span class="comment">//--------------------------------------------------------</span>
<a name="l02614"></a>02614 
<a name="l02615"></a>02615 
<a name="l02616"></a>02616 
<a name="l02617"></a><a class="code" href="class_o_t_a_p_i___exec.html#af741ab0d89e8600a4bca2bc1557a100b">02617</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af741ab0d89e8600a4bca2bc1557a100b">OTAPI_Exec::GetNym_MailCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02618"></a>02618 {
<a name="l02619"></a>02619     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02620"></a>02620     <span class="comment">// -------------------------</span>
<a name="l02621"></a>02621     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02622"></a>02622     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02623"></a>02623     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> 0;
<a name="l02624"></a>02624     <span class="comment">// -------------------------</span>
<a name="l02625"></a>02625     <span class="keywordflow">return</span> pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a6a449ad7415513ce538c4a2e71efde87" title="return the number of mail items available for this Nym.">GetMailCount</a>();
<a name="l02626"></a>02626 }
<a name="l02627"></a>02627 
<a name="l02628"></a>02628 
<a name="l02629"></a>02629 <span class="comment">// returns the message, optionally with Subject: as first line.</span>
<a name="l02630"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3e43100d647014c89e60918a13756245">02630</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a3e43100d647014c89e60918a13756245">OTAPI_Exec::GetNym_MailContentsByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02631"></a>02631 {
<a name="l02632"></a>02632     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02633"></a>02633     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02634"></a>02634     <span class="comment">// -------------------------</span>
<a name="l02635"></a>02635     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02636"></a>02636     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02637"></a>02637     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02638"></a>02638     <span class="comment">// -------------------------</span>
<a name="l02639"></a>02639     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a41d4a62c9e863fa982c7b4899bfcd3cb">GetMailByIndex</a>(nIndex);
<a name="l02640"></a>02640 
<a name="l02641"></a>02641     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02642"></a>02642     {
<a name="l02643"></a>02643         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02644"></a>02644         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02645"></a>02645         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l02646"></a>02646         <span class="comment">//</span>
<a name="l02647"></a>02647         <a class="code" href="class_o_t_envelope.html">OTEnvelope</a>  theEnvelope;
<a name="l02648"></a>02648         <a class="code" href="class_o_t_string.html">OTString</a>    strEnvelopeContents;
<a name="l02649"></a>02649 
<a name="l02650"></a>02650         <span class="comment">// Decrypt the Envelope.</span>
<a name="l02651"></a>02651         <span class="keywordflow">if</span> (theEnvelope.<a class="code" href="class_o_t_envelope.html#ad0d76f534bcda708b0298bcf906cb923">SetAsciiArmoredData</a>(pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>) &amp;&amp;
<a name="l02652"></a>02652             theEnvelope.<a class="code" href="class_o_t_envelope.html#ae2e8fafc4e508ce5d323c089b71c7e7b">Open</a>(*pNym, strEnvelopeContents))
<a name="l02653"></a>02653         {
<a name="l02654"></a>02654             std::string pBuf = strEnvelopeContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02655"></a>02655             <span class="keywordflow">return</span> pBuf;
<a name="l02656"></a>02656         }
<a name="l02657"></a>02657     }
<a name="l02658"></a>02658     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02659"></a>02659 }
<a name="l02660"></a>02660 
<a name="l02661"></a>02661 
<a name="l02662"></a>02662 
<a name="l02663"></a>02663 <span class="comment">// returns the sender ID for a piece of mail. (NymID).</span>
<a name="l02664"></a>02664 <span class="comment">//</span>
<a name="l02665"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9bacc4ffb222363b9215e15ee4a09e6b">02665</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a9bacc4ffb222363b9215e15ee4a09e6b">OTAPI_Exec::GetNym_MailSenderIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02666"></a>02666 {
<a name="l02667"></a>02667     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02668"></a>02668     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02669"></a>02669     <span class="comment">// -------------------------</span>
<a name="l02670"></a>02670     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02671"></a>02671     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02672"></a>02672     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02673"></a>02673     <span class="comment">// -------------------------</span>
<a name="l02674"></a>02674     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a41d4a62c9e863fa982c7b4899bfcd3cb">GetMailByIndex</a>(nIndex);
<a name="l02675"></a>02675 
<a name="l02676"></a>02676     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02677"></a>02677     {
<a name="l02678"></a>02678         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02679"></a>02679         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l02680"></a>02680         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02681"></a>02681         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l02682"></a>02682 
<a name="l02683"></a>02683         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02684"></a>02684         <span class="keywordflow">return</span> pBuf;
<a name="l02685"></a>02685     }
<a name="l02686"></a>02686     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02687"></a>02687 }
<a name="l02688"></a>02688 
<a name="l02689"></a>02689 
<a name="l02690"></a>02690 
<a name="l02691"></a>02691 <span class="comment">// returns the server ID that a piece of mail came from.</span>
<a name="l02692"></a>02692 <span class="comment">//</span>
<a name="l02693"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8739c3250e05ef46df4eeae244e46469">02693</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8739c3250e05ef46df4eeae244e46469">OTAPI_Exec::GetNym_MailServerIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02694"></a>02694 {
<a name="l02695"></a>02695     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02696"></a>02696 
<a name="l02697"></a>02697     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02698"></a>02698 
<a name="l02699"></a>02699     <span class="comment">// -------------------------</span>
<a name="l02700"></a>02700     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02701"></a>02701     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02702"></a>02702     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02703"></a>02703     <span class="comment">// -------------------------</span>
<a name="l02704"></a>02704     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a41d4a62c9e863fa982c7b4899bfcd3cb">GetMailByIndex</a>(nIndex);
<a name="l02705"></a>02705 
<a name="l02706"></a>02706     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02707"></a>02707     {
<a name="l02708"></a>02708         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02709"></a>02709         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l02710"></a>02710         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02711"></a>02711         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l02712"></a>02712 
<a name="l02713"></a>02713         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02714"></a>02714         <span class="keywordflow">return</span> pBuf;
<a name="l02715"></a>02715     }
<a name="l02716"></a>02716     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02717"></a>02717 }
<a name="l02718"></a>02718 
<a name="l02719"></a>02719 
<a name="l02720"></a>02720 
<a name="l02721"></a>02721 <span class="comment">// --------------------------------------------------------</span>
<a name="l02722"></a>02722 
<a name="l02723"></a>02723 
<a name="l02724"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac70ad98b72adb62a7fbe2343fa316dda">02724</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ac70ad98b72adb62a7fbe2343fa316dda">OTAPI_Exec::Nym_RemoveMailByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02725"></a>02725 {
<a name="l02726"></a>02726     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>              ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02727"></a>02727     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02728"></a>02728     <span class="comment">// -------------------------</span>
<a name="l02729"></a>02729     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02730"></a>02730     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02731"></a>02731     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02732"></a>02732     <span class="comment">// -------------------------</span>
<a name="l02733"></a>02733     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
<a name="l02734"></a>02734 
<a name="l02735"></a>02735     <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7f32350b2827a62bbfa5ef09a392f129">RemoveMailByIndex</a>(nIndex))
<a name="l02736"></a>02736     {
<a name="l02737"></a>02737         <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym)) <span class="comment">// &lt;== save Nym to local storage, since a mail was erased.</span>
<a name="l02738"></a>02738             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02739"></a>02739         <span class="keywordflow">else</span>
<a name="l02740"></a>02740             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error saving Nym: %s\n&quot;</span>, __FUNCTION__, NYM_ID.c_str());
<a name="l02741"></a>02741     }
<a name="l02742"></a>02742     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02743"></a>02743 }
<a name="l02744"></a>02744 
<a name="l02745"></a>02745 
<a name="l02746"></a>02746 
<a name="l02747"></a>02747 <span class="comment">// Returns true (1) if the Sender ID on this piece of Mail (by index)</span>
<a name="l02748"></a>02748 <span class="comment">// loads a public key from my wallet, and if the signature on the message</span>
<a name="l02749"></a>02749 <span class="comment">// verifies with that public key.</span>
<a name="l02750"></a>02750 <span class="comment">// (Not only must the signature be good, but I must have added the nym to</span>
<a name="l02751"></a>02751 <span class="comment">// my wallet sometime in the past, since this func returns false if it&#39;s not there.)</span>
<a name="l02752"></a>02752 <span class="comment">//</span>
<a name="l02753"></a>02753 <span class="comment">// A good wallet might be designed to automatically download any keys that</span>
<a name="l02754"></a>02754 <span class="comment">// it doesn&#39;t already have, using OTAPI_Exec::checkUser(). I&#39;ll probably need to</span>
<a name="l02755"></a>02755 <span class="comment">// add something to OTClient where the @checkUser response auto-saves the new</span>
<a name="l02756"></a>02756 <span class="comment">// key into the wallet. That way you can wait for a tenth of a second and then</span>
<a name="l02757"></a>02757 <span class="comment">// just read the Nym (by ID) straight out of your own wallet. Nifty, eh?</span>
<a name="l02758"></a>02758 <span class="comment">//</span>
<a name="l02759"></a>02759 <span class="comment">// All the wallet has to do is fire off a &quot;check user&quot; whenever this call fails,</span>
<a name="l02760"></a>02760 <span class="comment">// then come back when that succeeds and try this again. If STILL failure, then</span>
<a name="l02761"></a>02761 <span class="comment">// you&#39;ve got a signature problem. Otherwise it&#39;ll usually download the nym</span>
<a name="l02762"></a>02762 <span class="comment">// and verify the signature all in an instant, without the user even noticing</span>
<a name="l02763"></a>02763 <span class="comment">// what happened.</span>
<a name="l02764"></a>02764 <span class="comment">//</span>
<a name="l02765"></a><a class="code" href="class_o_t_a_p_i___exec.html#af5445f94adcbb66d9e6acd3962d0128d">02765</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#af5445f94adcbb66d9e6acd3962d0128d">OTAPI_Exec::Nym_VerifyMailByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02766"></a>02766 {
<a name="l02767"></a>02767     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>              ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02768"></a>02768     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02769"></a>02769     <span class="comment">// -------------------------</span>
<a name="l02770"></a>02770     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02771"></a>02771     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02772"></a>02772     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02773"></a>02773     <span class="comment">// -------------------------</span>
<a name="l02774"></a>02774     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a41d4a62c9e863fa982c7b4899bfcd3cb">GetMailByIndex</a>(nIndex);
<a name="l02775"></a>02775 
<a name="l02776"></a>02776     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02777"></a>02777     {
<a name="l02778"></a>02778         <span class="comment">// Grab the NymID of the sender.</span>
<a name="l02779"></a>02779         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderNymID(pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>);
<a name="l02780"></a>02780 
<a name="l02781"></a>02781         <span class="comment">// Grab a pointer to that Nym (if its public key is in my wallet.)</span>
<a name="l02782"></a>02782         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSenderNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theSenderNymID, __FUNCTION__);
<a name="l02783"></a>02783 
<a name="l02784"></a>02784         <span class="comment">// If it&#39;s there, use it to verify the signature on the message.</span>
<a name="l02785"></a>02785         <span class="comment">// return true if successful signature verification.</span>
<a name="l02786"></a>02786         <span class="comment">//</span>
<a name="l02787"></a>02787         <span class="keywordflow">if</span> (NULL != pSenderNym)
<a name="l02788"></a>02788         {
<a name="l02789"></a>02789             <span class="keywordflow">if</span> (pMessage-&gt;<a class="code" href="class_o_t_message.html#aa61f745665166abf8bed98f47c6252d0">VerifySignature</a>(*pSenderNym))
<a name="l02790"></a>02790                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02791"></a>02791         }
<a name="l02792"></a>02792     }
<a name="l02793"></a>02793     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02794"></a>02794 }
<a name="l02795"></a>02795 
<a name="l02796"></a>02796 
<a name="l02797"></a>02797 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l02798"></a>02798 <span class="comment">//</span>
<a name="l02799"></a>02799 <span class="comment">// OUTMAIL!!</span>
<a name="l02800"></a>02800 
<a name="l02801"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4c112f835bc906c63ce9103ca6b64d94">02801</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4c112f835bc906c63ce9103ca6b64d94">OTAPI_Exec::GetNym_OutmailCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02802"></a>02802 {
<a name="l02803"></a>02803     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02804"></a>02804     <span class="comment">// -------------------------</span>
<a name="l02805"></a>02805     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02806"></a>02806     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02807"></a>02807     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> 0;
<a name="l02808"></a>02808     <span class="comment">// -------------------------</span>
<a name="l02809"></a>02809     <span class="keywordflow">return</span> pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a746ab3941be5529f11a772a004e17b69" title="return the number of mail items available for this Nym.">GetOutmailCount</a>();
<a name="l02810"></a>02810 }
<a name="l02811"></a>02811 
<a name="l02812"></a>02812 
<a name="l02813"></a>02813 <span class="comment">// returns the message, optionally with Subject: as first line.</span>
<a name="l02814"></a><a class="code" href="class_o_t_a_p_i___exec.html#a016e019057540d0ed5535b6e76663fe9">02814</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a016e019057540d0ed5535b6e76663fe9">OTAPI_Exec::GetNym_OutmailContentsByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02815"></a>02815 {
<a name="l02816"></a>02816     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>              ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02817"></a>02817     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02818"></a>02818     <span class="comment">// -------------------------</span>
<a name="l02819"></a>02819     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02820"></a>02820     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02821"></a>02821     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02822"></a>02822     <span class="comment">// -------------------------</span>
<a name="l02823"></a>02823     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a126bbb8a3d356a0fd2118c95dfe6cbea">GetOutmailByIndex</a>(nIndex);
<a name="l02824"></a>02824     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02825"></a>02825     {
<a name="l02826"></a>02826         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02827"></a>02827         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02828"></a>02828         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l02829"></a>02829         <a class="code" href="class_o_t_string.html">OTString</a>    strMailContents;
<a name="l02830"></a>02830 
<a name="l02831"></a>02831         <span class="keywordflow">if</span> (pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp;
<a name="l02832"></a>02832             pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strMailContents))
<a name="l02833"></a>02833         {
<a name="l02834"></a>02834             std::string pBuf = strMailContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02835"></a>02835             <span class="keywordflow">return</span> pBuf;
<a name="l02836"></a>02836         }
<a name="l02837"></a>02837     }
<a name="l02838"></a>02838     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02839"></a>02839 }
<a name="l02840"></a>02840 
<a name="l02841"></a>02841 
<a name="l02842"></a>02842 
<a name="l02843"></a>02843 <span class="comment">// returns the recipient ID for a piece of mail. (NymID).</span>
<a name="l02844"></a>02844 <span class="comment">//</span>
<a name="l02845"></a><a class="code" href="class_o_t_a_p_i___exec.html#a53fa11aa2ee5fbda492529980cf0f8e8">02845</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a53fa11aa2ee5fbda492529980cf0f8e8">OTAPI_Exec::GetNym_OutmailRecipientIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02846"></a>02846 {
<a name="l02847"></a>02847     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>                  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02848"></a>02848     <span class="keywordflow">if</span> (0 &gt; nIndex)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02849"></a>02849     <span class="comment">// -------------------------</span>
<a name="l02850"></a>02850     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02851"></a>02851     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02852"></a>02852     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02853"></a>02853     <span class="comment">// -------------------------</span>
<a name="l02854"></a>02854     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a126bbb8a3d356a0fd2118c95dfe6cbea">GetOutmailByIndex</a>(nIndex);
<a name="l02855"></a>02855     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02856"></a>02856     {
<a name="l02857"></a>02857         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02858"></a>02858         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l02859"></a>02859         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02860"></a>02860         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload</span>
<a name="l02861"></a>02861 
<a name="l02862"></a>02862         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02863"></a>02863         <span class="keywordflow">return</span> pBuf;
<a name="l02864"></a>02864     }
<a name="l02865"></a>02865     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02866"></a>02866 }
<a name="l02867"></a>02867 
<a name="l02868"></a>02868 
<a name="l02869"></a>02869 
<a name="l02870"></a>02870 <span class="comment">// returns the server ID that a piece of mail came from.</span>
<a name="l02871"></a>02871 <span class="comment">//</span>
<a name="l02872"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7780a360d9669ed6732f7f42c0a4f7c7">02872</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a7780a360d9669ed6732f7f42c0a4f7c7">OTAPI_Exec::GetNym_OutmailServerIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02873"></a>02873 {
<a name="l02874"></a>02874     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>                  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02875"></a>02875     <span class="keywordflow">if</span> (0 &gt; nIndex)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02876"></a>02876     <span class="comment">// -------------------------</span>
<a name="l02877"></a>02877     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02878"></a>02878     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02879"></a>02879     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02880"></a>02880     <span class="comment">// -------------------------</span>
<a name="l02881"></a>02881     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a126bbb8a3d356a0fd2118c95dfe6cbea">GetOutmailByIndex</a>(nIndex);
<a name="l02882"></a>02882 
<a name="l02883"></a>02883     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02884"></a>02884     {
<a name="l02885"></a>02885         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l02886"></a>02886         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l02887"></a>02887         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l02888"></a>02888         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload</span>
<a name="l02889"></a>02889 
<a name="l02890"></a>02890         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l02891"></a>02891         <span class="keywordflow">return</span> pBuf;
<a name="l02892"></a>02892 
<a name="l02893"></a>02893     }
<a name="l02894"></a>02894     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l02895"></a>02895 }
<a name="l02896"></a>02896 
<a name="l02897"></a>02897 
<a name="l02898"></a>02898 
<a name="l02899"></a>02899 <span class="comment">// --------------------------------------------------------</span>
<a name="l02900"></a>02900 
<a name="l02901"></a>02901 
<a name="l02902"></a><a class="code" href="class_o_t_a_p_i___exec.html#aebc780df2244d90c4ebd6d3ceb0f4268">02902</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#aebc780df2244d90c4ebd6d3ceb0f4268">OTAPI_Exec::Nym_RemoveOutmailByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02903"></a>02903 {
<a name="l02904"></a>02904     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02905"></a>02905     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02906"></a>02906     <span class="comment">// -------------------------</span>
<a name="l02907"></a>02907     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02908"></a>02908     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02909"></a>02909     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02910"></a>02910     <span class="comment">// -------------------------</span>
<a name="l02911"></a>02911     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
<a name="l02912"></a>02912 
<a name="l02913"></a>02913     <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#ae2510d04ffb6c0e01aeda1b75a59d1ef">RemoveOutmailByIndex</a>(nIndex))
<a name="l02914"></a>02914     {
<a name="l02915"></a>02915         <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym)) <span class="comment">// &lt;== save Nym to local storage, since a mail was erased.</span>
<a name="l02916"></a>02916             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02917"></a>02917         <span class="keywordflow">else</span>
<a name="l02918"></a>02918             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error saving Nym: %s\n&quot;</span>, __FUNCTION__, NYM_ID.c_str());
<a name="l02919"></a>02919     }
<a name="l02920"></a>02920     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02921"></a>02921 }
<a name="l02922"></a>02922 
<a name="l02923"></a>02923 
<a name="l02924"></a>02924 
<a name="l02925"></a>02925 <span class="comment">// Returns true (1) if the Sender ID on this piece of Mail (by index)</span>
<a name="l02926"></a>02926 <span class="comment">// loads a public key from my wallet, and if the signature on the message</span>
<a name="l02927"></a>02927 <span class="comment">// verifies with that public key.</span>
<a name="l02928"></a>02928 <span class="comment">// (Not only must the signature be good, but I must have added the nym to</span>
<a name="l02929"></a>02929 <span class="comment">// my wallet sometime in the past, since this func returns false if it&#39;s not there.)</span>
<a name="l02930"></a>02930 <span class="comment">//</span>
<a name="l02931"></a>02931 <span class="comment">// A good wallet might be designed to automatically download any keys that</span>
<a name="l02932"></a>02932 <span class="comment">// it doesn&#39;t already have, using OTAPI_Exec::checkUser(). I&#39;ll probably need to</span>
<a name="l02933"></a>02933 <span class="comment">// add something to OTClient where the @checkUser response auto-saves the new</span>
<a name="l02934"></a>02934 <span class="comment">// key into the wallet. That way you can wait for a tenth of a second and then</span>
<a name="l02935"></a>02935 <span class="comment">// just read the Nym (by ID) straight out of your own wallet. Nifty, eh?</span>
<a name="l02936"></a>02936 <span class="comment">//</span>
<a name="l02937"></a>02937 <span class="comment">// All the wallet has to do is fire off a &quot;check user&quot; whenever this call fails,</span>
<a name="l02938"></a>02938 <span class="comment">// then come back when that succeeds and try this again. If STILL failure, then</span>
<a name="l02939"></a>02939 <span class="comment">// you&#39;ve got a signature problem. Otherwise it&#39;ll usually download the nym</span>
<a name="l02940"></a>02940 <span class="comment">// and verify the signature all in an instant, without the user even noticing</span>
<a name="l02941"></a>02941 <span class="comment">// what happened.</span>
<a name="l02942"></a>02942 <span class="comment">//</span>
<a name="l02943"></a><a class="code" href="class_o_t_a_p_i___exec.html#a16545eb3a6c8b39d83964e01005077b0">02943</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a16545eb3a6c8b39d83964e01005077b0">OTAPI_Exec::Nym_VerifyOutmailByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l02944"></a>02944 {
<a name="l02945"></a>02945     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>              ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02946"></a>02946     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02947"></a>02947     <span class="comment">// -------------------------</span>
<a name="l02948"></a>02948     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02949"></a>02949     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02950"></a>02950     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02951"></a>02951     <span class="comment">// -------------------------</span>
<a name="l02952"></a>02952     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a126bbb8a3d356a0fd2118c95dfe6cbea">GetOutmailByIndex</a>(nIndex);
<a name="l02953"></a>02953     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l02954"></a>02954     {
<a name="l02955"></a>02955         <span class="comment">// Grab the NymID of the sender.</span>
<a name="l02956"></a>02956         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderNymID(pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>);
<a name="l02957"></a>02957 
<a name="l02958"></a>02958         <span class="comment">// Grab a pointer to that Nym (if its public key is in my wallet.)</span>
<a name="l02959"></a>02959         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSenderNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theSenderNymID, __FUNCTION__);
<a name="l02960"></a>02960 
<a name="l02961"></a>02961         <span class="comment">// If it&#39;s there, use it to verify the signature on the message.</span>
<a name="l02962"></a>02962         <span class="comment">// return true if successful signature verification.</span>
<a name="l02963"></a>02963         <span class="comment">//</span>
<a name="l02964"></a>02964         <span class="keywordflow">if</span> (NULL != pSenderNym)
<a name="l02965"></a>02965         {
<a name="l02966"></a>02966             <span class="keywordflow">if</span> (pMessage-&gt;<a class="code" href="class_o_t_message.html#aa61f745665166abf8bed98f47c6252d0">VerifySignature</a>(*pSenderNym))
<a name="l02967"></a>02967                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02968"></a>02968         }
<a name="l02969"></a>02969     }
<a name="l02970"></a>02970     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02971"></a>02971 }
<a name="l02972"></a>02972 
<a name="l02973"></a>02973 
<a name="l02974"></a>02974 
<a name="l02975"></a>02975 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l02976"></a>02976 <span class="comment">//</span>
<a name="l02977"></a>02977 <span class="comment">// OUTPAYMENTS!!</span>
<a name="l02978"></a>02978 <span class="comment">//</span>
<a name="l02979"></a>02979 <span class="comment">// (Outbox on payments screen.)</span>
<a name="l02980"></a>02980 <span class="comment">//</span>
<a name="l02981"></a>02981 <span class="comment">// Todo: Move these and all functions to OpenTransactions.cpp.  This should ONLY</span>
<a name="l02982"></a>02982 <span class="comment">// be a wrapper for that class.  That way we can eventually phase this file out</span>
<a name="l02983"></a>02983 <span class="comment">// entirely and replace it with OTAPI_Wrapper.cpp directly on OpenTransactions.cpp</span>
<a name="l02984"></a>02984 
<a name="l02985"></a><a class="code" href="class_o_t_a_p_i___exec.html#adc2e734d3287c7786115939baba7ea0e">02985</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#adc2e734d3287c7786115939baba7ea0e">OTAPI_Exec::GetNym_OutpaymentsCount</a>(<span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l02986"></a>02986 {
<a name="l02987"></a>02987     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l02988"></a>02988     <span class="comment">// -------------------------</span>
<a name="l02989"></a>02989     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l02990"></a>02990     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l02991"></a>02991     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> 0;
<a name="l02992"></a>02992     <span class="comment">// -------------------------</span>
<a name="l02993"></a>02993     <span class="keywordflow">return</span> pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66289f0575ef0b91cb5fefa4483f0d3e" title="return the number of payments items available for this Nym.">GetOutpaymentsCount</a>();
<a name="l02994"></a>02994 }
<a name="l02995"></a>02995 
<a name="l02996"></a>02996 
<a name="l02997"></a>02997 <span class="comment">// Returns the payment instrument that was sent.</span>
<a name="l02998"></a>02998 <span class="comment">//</span>
<a name="l02999"></a><a class="code" href="class_o_t_a_p_i___exec.html#a71f250e1f40d340680af964f156acea3">02999</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a71f250e1f40d340680af964f156acea3">OTAPI_Exec::GetNym_OutpaymentsContentsByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03000"></a>03000 {
<a name="l03001"></a>03001     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> );                  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03002"></a>03002     <span class="keywordflow">if</span> (0 &gt; nIndex)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03003"></a>03003     <span class="comment">// -------------------------</span>
<a name="l03004"></a>03004     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l03005"></a>03005     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03006"></a>03006     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03007"></a>03007     <span class="comment">// -------------------------</span>
<a name="l03008"></a>03008     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acb808e89943f1f2d0009825a3fbcb34f">GetOutpaymentsByIndex</a>(nIndex);
<a name="l03009"></a>03009     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l03010"></a>03010     {
<a name="l03011"></a>03011         <span class="comment">// SENDER:     pMessage-&gt;m_strNymID</span>
<a name="l03012"></a>03012         <span class="comment">// RECIPIENT:  pMessage-&gt;m_strNymID2</span>
<a name="l03013"></a>03013         <span class="comment">// INSTRUMENT: pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l03014"></a>03014         <a class="code" href="class_o_t_string.html">OTString</a>    strPayment;
<a name="l03015"></a>03015 
<a name="l03016"></a>03016         <span class="comment">// There isn&#39;t any encrypted envelope this time, since it&#39;s my outPayments box.</span>
<a name="l03017"></a>03017         <span class="comment">//</span>
<a name="l03018"></a>03018         <span class="keywordflow">if</span> (pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp;
<a name="l03019"></a>03019             pMessage-&gt;<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strPayment) &amp;&amp;
<a name="l03020"></a>03020             strPayment.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l03021"></a>03021         {
<a name="l03022"></a>03022             <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strPayment);
<a name="l03023"></a>03023             <span class="comment">// ---------------------------------------------</span>
<a name="l03024"></a>03024             <span class="keywordflow">if</span> (thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03025"></a>03025             {
<a name="l03026"></a>03026                 std::string pBuf = strPayment.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03027"></a>03027                 <span class="keywordflow">return</span> pBuf;
<a name="l03028"></a>03028             }
<a name="l03029"></a>03029         }
<a name="l03030"></a>03030     }
<a name="l03031"></a>03031     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03032"></a>03032 }
<a name="l03033"></a>03033 
<a name="l03034"></a>03034 
<a name="l03035"></a>03035 
<a name="l03036"></a>03036 <span class="comment">// returns the recipient ID for a piece of payments outmail. (NymID).</span>
<a name="l03037"></a>03037 <span class="comment">//</span>
<a name="l03038"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0d70d2ff1a18966fad6fd7169982d2bb">03038</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a0d70d2ff1a18966fad6fd7169982d2bb">OTAPI_Exec::GetNym_OutpaymentsRecipientIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03039"></a>03039 {
<a name="l03040"></a>03040     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> );              <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03041"></a>03041     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03042"></a>03042     <span class="comment">// -------------------------</span>
<a name="l03043"></a>03043     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l03044"></a>03044     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03045"></a>03045     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03046"></a>03046     <span class="comment">// -------------------------</span>
<a name="l03047"></a>03047     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acb808e89943f1f2d0009825a3fbcb34f">GetOutpaymentsByIndex</a>(nIndex);
<a name="l03048"></a>03048     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l03049"></a>03049     {
<a name="l03050"></a>03050         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l03051"></a>03051         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l03052"></a>03052         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l03053"></a>03053         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload</span>
<a name="l03054"></a>03054 
<a name="l03055"></a>03055         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#a724247e90624bbc678fb067beeba58b9">m_strNymID2</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03056"></a>03056         <span class="keywordflow">return</span> pBuf;
<a name="l03057"></a>03057     }
<a name="l03058"></a>03058     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03059"></a>03059 }
<a name="l03060"></a>03060 
<a name="l03061"></a>03061 
<a name="l03062"></a>03062 
<a name="l03063"></a>03063 <span class="comment">// returns the server ID that a piece of payments outmail came from.</span>
<a name="l03064"></a>03064 <span class="comment">//</span>
<a name="l03065"></a><a class="code" href="class_o_t_a_p_i___exec.html#abd6ec4a939ea69b5e052c03f0d2b5711">03065</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abd6ec4a939ea69b5e052c03f0d2b5711">OTAPI_Exec::GetNym_OutpaymentsServerIDByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03066"></a>03066 {
<a name="l03067"></a>03067     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> );                  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03068"></a>03068     <span class="keywordflow">if</span> (0 &gt; nIndex)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03069"></a>03069     <span class="comment">// -------------------------</span>
<a name="l03070"></a>03070     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(NYM_ID);
<a name="l03071"></a>03071     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03072"></a>03072     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03073"></a>03073     <span class="comment">// -------------------------</span>
<a name="l03074"></a>03074     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acb808e89943f1f2d0009825a3fbcb34f">GetOutpaymentsByIndex</a>(nIndex);
<a name="l03075"></a>03075 
<a name="l03076"></a>03076     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l03077"></a>03077     {
<a name="l03078"></a>03078         <span class="comment">// SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l03079"></a>03079         <span class="comment">// SERVER:    pMessage-&gt;m_strServerID</span>
<a name="l03080"></a>03080         <span class="comment">// RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l03081"></a>03081         <span class="comment">// MESSAGE:   pMessage-&gt;m_ascPayload</span>
<a name="l03082"></a>03082 
<a name="l03083"></a>03083         int32_t bServerIdLength = pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>();
<a name="l03084"></a>03084         <span class="keywordflow">if</span> (1 &gt;= bServerIdLength)
<a name="l03085"></a>03085         {
<a name="l03086"></a>03086             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: m_strServerID Length is 1 or less!\n&quot;</span>, __FUNCTION__);
<a name="l03087"></a>03087             <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>;
<a name="l03088"></a>03088         }
<a name="l03089"></a>03089 
<a name="l03090"></a>03090         std::string pBuf = pMessage-&gt;<a class="code" href="class_o_t_message.html#ae5304f18eb276ecd0c5370aa41817926">m_strServerID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03091"></a>03091         <span class="keywordflow">return</span> pBuf;
<a name="l03092"></a>03092     }
<a name="l03093"></a>03093     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03094"></a>03094 }
<a name="l03095"></a>03095 
<a name="l03096"></a>03096 
<a name="l03097"></a>03097 
<a name="l03098"></a>03098 <span class="comment">// --------------------------------------------------------</span>
<a name="l03099"></a>03099 
<a name="l03100"></a>03100 
<a name="l03101"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4e56f34553c3f5b2f79b7bf1b9aa46b0">03101</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a4e56f34553c3f5b2f79b7bf1b9aa46b0">OTAPI_Exec::Nym_RemoveOutpaymentsByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03102"></a>03102 {
<a name="l03103"></a>03103     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>                  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03104"></a>03104     <span class="keywordflow">if</span> (0 &gt; nIndex)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03105"></a>03105 
<a name="l03106"></a>03106     <span class="comment">// -------------------------</span>
<a name="l03107"></a>03107     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l03108"></a>03108     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03109"></a>03109     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03110"></a>03110     <span class="comment">// -------------------------</span>
<a name="l03111"></a>03111     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = pNym;
<a name="l03112"></a>03112 
<a name="l03113"></a>03113     <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2d66a8a46d8e147ca0dbc0fb45bc364d">RemoveOutpaymentsByIndex</a>(nIndex))
<a name="l03114"></a>03114     {
<a name="l03115"></a>03115         <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a5d08ef86097db038c2c4fd30034f5dc8">SaveSignedNymfile</a>(*pSignerNym)) <span class="comment">// &lt;== save Nym to local storage, since a payment outmail was erased.</span>
<a name="l03116"></a>03116             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03117"></a>03117         <span class="keywordflow">else</span>
<a name="l03118"></a>03118             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error saving Nym: %s\n&quot;</span>, __FUNCTION__, NYM_ID.c_str());
<a name="l03119"></a>03119     }
<a name="l03120"></a>03120     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03121"></a>03121 }
<a name="l03122"></a>03122 
<a name="l03123"></a>03123 
<a name="l03124"></a>03124 
<a name="l03125"></a>03125 <span class="comment">// Returns true (1) if the Sender ID on this piece of Mail (by index)</span>
<a name="l03126"></a>03126 <span class="comment">// loads a public key from my wallet, and if the signature on the message</span>
<a name="l03127"></a>03127 <span class="comment">// verifies with that public key.</span>
<a name="l03128"></a>03128 <span class="comment">// (Not only must the signature be good, but I must have added the nym to</span>
<a name="l03129"></a>03129 <span class="comment">// my wallet sometime in the past, since this func returns false if it&#39;s not there.)</span>
<a name="l03130"></a>03130 <span class="comment">//</span>
<a name="l03131"></a>03131 <span class="comment">// A good wallet might be designed to automatically download any keys that</span>
<a name="l03132"></a>03132 <span class="comment">// it doesn&#39;t already have, using OTAPI_Exec::checkUser(). I&#39;ll probably need to</span>
<a name="l03133"></a>03133 <span class="comment">// add something to OTClient where the @checkUser response auto-saves the new</span>
<a name="l03134"></a>03134 <span class="comment">// key into the wallet. That way you can wait for a tenth of a second and then</span>
<a name="l03135"></a>03135 <span class="comment">// just read the Nym (by ID) straight out of your own wallet. Nifty, eh?</span>
<a name="l03136"></a>03136 <span class="comment">//</span>
<a name="l03137"></a>03137 <span class="comment">// All the wallet has to do is fire off a &quot;check user&quot; whenever this call fails,</span>
<a name="l03138"></a>03138 <span class="comment">// then come back when that succeeds and try this again. If STILL failure, then</span>
<a name="l03139"></a>03139 <span class="comment">// you&#39;ve got a signature problem. Otherwise it&#39;ll usually download the nym</span>
<a name="l03140"></a>03140 <span class="comment">// and verify the signature all in an instant, without the user even noticing</span>
<a name="l03141"></a>03141 <span class="comment">// what happened.</span>
<a name="l03142"></a>03142 <span class="comment">//</span>
<a name="l03143"></a><a class="code" href="class_o_t_a_p_i___exec.html#a920a1595279a928a5056177f1d4c2adc">03143</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a920a1595279a928a5056177f1d4c2adc">OTAPI_Exec::Nym_VerifyOutpaymentsByIndex</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03144"></a>03144 {
<a name="l03145"></a>03145     <span class="keywordflow">if</span> (NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03146"></a>03146     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03147"></a>03147     <span class="comment">// -------------------------</span>
<a name="l03148"></a>03148     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l03149"></a>03149     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03150"></a>03150     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03151"></a>03151     <span class="comment">// -------------------------</span>
<a name="l03152"></a>03152     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMessage = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#acb808e89943f1f2d0009825a3fbcb34f">GetOutpaymentsByIndex</a>(nIndex);
<a name="l03153"></a>03153     <span class="keywordflow">if</span> (NULL != pMessage)
<a name="l03154"></a>03154     {
<a name="l03155"></a>03155         <span class="comment">// Grab the NymID of the sender.</span>
<a name="l03156"></a>03156         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderNymID(pMessage-&gt;<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>);
<a name="l03157"></a>03157 
<a name="l03158"></a>03158         <span class="comment">// Grab a pointer to that Nym (if its public key is in my wallet.)</span>
<a name="l03159"></a>03159         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSenderNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theSenderNymID, __FUNCTION__);
<a name="l03160"></a>03160 
<a name="l03161"></a>03161         <span class="comment">// If it&#39;s there, use it to verify the signature on the message.</span>
<a name="l03162"></a>03162         <span class="comment">// return true if successful signature verification.</span>
<a name="l03163"></a>03163         <span class="comment">//</span>
<a name="l03164"></a>03164         <span class="keywordflow">if</span> (NULL != pSenderNym)
<a name="l03165"></a>03165         {
<a name="l03166"></a>03166             <span class="keywordflow">if</span> (pMessage-&gt;<a class="code" href="class_o_t_message.html#aa61f745665166abf8bed98f47c6252d0">VerifySignature</a>(*pSenderNym))
<a name="l03167"></a>03167                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03168"></a>03168         }
<a name="l03169"></a>03169     }
<a name="l03170"></a>03170     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03171"></a>03171 }
<a name="l03172"></a>03172 
<a name="l03173"></a>03173 
<a name="l03174"></a>03174 
<a name="l03175"></a>03175 
<a name="l03176"></a>03176 
<a name="l03177"></a>03177 <span class="comment">// ******************************************************************************</span>
<a name="l03178"></a>03178 
<a name="l03179"></a>03179 
<a name="l03180"></a>03180 
<a name="l03181"></a>03181 
<a name="l03182"></a>03182 
<a name="l03183"></a>03183 <span class="comment">//</span>
<a name="l03184"></a>03184 <span class="comment">//</span>
<a name="l03185"></a>03185 <span class="comment">// THESE FUNCTIONS were added for the PAYMENTS screen. (They are fairly new.)</span>
<a name="l03186"></a>03186 <span class="comment">//</span>
<a name="l03187"></a>03187 <span class="comment">// Basically there was a need to have DIFFERENT instruments, but to be able to</span>
<a name="l03188"></a>03188 <span class="comment">// treat them as though they are a single type.</span>
<a name="l03189"></a>03189 <span class="comment">//</span>
<a name="l03190"></a>03190 <span class="comment">// In keeping with that, the below functions will work with disparate types.</span>
<a name="l03191"></a>03191 <span class="comment">// You can pass [ CHEQUES / VOUCHERS / INVOICES ] and PAYMENT PLANS, and</span>
<a name="l03192"></a>03192 <span class="comment">// SMART CONTRACTS, and PURSEs into these functions, and they should be able</span>
<a name="l03193"></a>03193 <span class="comment">// to handle any of those types.</span>
<a name="l03194"></a>03194 <span class="comment">//</span>
<a name="l03195"></a>03195 <span class="comment">//</span>
<a name="l03196"></a>03196 
<a name="l03197"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7e4eb9b2afbb270cd108ddd48662c10c">03197</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a7e4eb9b2afbb270cd108ddd48662c10c">OTAPI_Exec::Instrmnt_GetAmount</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03198"></a>03198 {
<a name="l03199"></a>03199     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03200"></a>03200     <span class="comment">// ------------------------------------</span>
<a name="l03201"></a>03201     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03202"></a>03202     <span class="comment">// ------------------------------------</span>
<a name="l03203"></a>03203     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03204"></a>03204 
<a name="l03205"></a>03205     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03206"></a>03206     {
<a name="l03207"></a>03207         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03208"></a>03208             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03209"></a>03209         <span class="keywordflow">return</span> -1;
<a name="l03210"></a>03210     }
<a name="l03211"></a>03211     <span class="comment">// ---------------------------------------</span>
<a name="l03212"></a>03212     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03213"></a>03213     <span class="comment">// ---------------------------------------</span>
<a name="l03214"></a>03214     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03215"></a>03215     {
<a name="l03216"></a>03216         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03217"></a>03217             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03218"></a>03218         <span class="keywordflow">return</span> -1;
<a name="l03219"></a>03219     }
<a name="l03220"></a>03220     <span class="comment">// ---------------------------------------</span>
<a name="l03221"></a>03221     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03222"></a>03222     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03223"></a>03223 
<a name="l03224"></a>03224     <a class="code" href="class_o_t_string.html">OTString</a>      strOutput;
<a name="l03225"></a>03225     int64_t          lOutput  = 0;
<a name="l03226"></a>03226     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#acb3588ce12579879e64d65ed69afd5f6">GetAmount</a>(lOutput); <span class="comment">// &lt;========</span>
<a name="l03227"></a>03227 
<a name="l03228"></a>03228     <span class="keywordflow">return</span> bGotData ? lOutput : -1;
<a name="l03229"></a>03229 }
<a name="l03230"></a>03230 
<a name="l03231"></a>03231 
<a name="l03232"></a>03232 
<a name="l03233"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac031ea7a5cfcc1616ce37eeaf84f52b6">03233</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#ac031ea7a5cfcc1616ce37eeaf84f52b6">OTAPI_Exec::Instrmnt_GetTransNum</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03234"></a>03234 {
<a name="l03235"></a>03235     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03236"></a>03236     <span class="comment">// ------------------------------------</span>
<a name="l03237"></a>03237     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03238"></a>03238     <span class="comment">// ------------------------------------</span>
<a name="l03239"></a>03239     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03240"></a>03240 
<a name="l03241"></a>03241     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03242"></a>03242     {
<a name="l03243"></a>03243         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03244"></a>03244             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03245"></a>03245         <span class="keywordflow">return</span> -1;
<a name="l03246"></a>03246     }
<a name="l03247"></a>03247     <span class="comment">// ---------------------------------------</span>
<a name="l03248"></a>03248     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03249"></a>03249     <span class="comment">// ---------------------------------------</span>
<a name="l03250"></a>03250     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03251"></a>03251     {
<a name="l03252"></a>03252         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03253"></a>03253             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03254"></a>03254         <span class="keywordflow">return</span> -1;
<a name="l03255"></a>03255     }
<a name="l03256"></a>03256     <span class="comment">// ---------------------------------------</span>
<a name="l03257"></a>03257     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03258"></a>03258     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03259"></a>03259     <a class="code" href="class_o_t_string.html">OTString</a>      strOutput;
<a name="l03260"></a>03260     int64_t          lOutput = 0;
<a name="l03261"></a>03261     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a02ffc34caf84cf6e9f88910b6354fbd8">GetTransactionNum</a>(lOutput); <span class="comment">// &lt;========</span>
<a name="l03262"></a>03262 
<a name="l03263"></a>03263     <span class="keywordflow">return</span> bGotData ? lOutput : -1;
<a name="l03264"></a>03264 }
<a name="l03265"></a>03265 
<a name="l03266"></a>03266 
<a name="l03267"></a>03267 
<a name="l03268"></a>03268 
<a name="l03269"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0f5c2d836a451925d73ef0bd01140967">03269</a> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#a0f5c2d836a451925d73ef0bd01140967">OTAPI_Exec::Instrmnt_GetValidFrom</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03270"></a>03270 {
<a name="l03271"></a>03271     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03272"></a>03272     <span class="comment">// ------------------------------------</span>
<a name="l03273"></a>03273     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03274"></a>03274     <span class="comment">// ------------------------------------</span>
<a name="l03275"></a>03275     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03276"></a>03276 
<a name="l03277"></a>03277     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03278"></a>03278     {
<a name="l03279"></a>03279         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03280"></a>03280             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03281"></a>03281         <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03282"></a>03282     }
<a name="l03283"></a>03283     <span class="comment">// ---------------------------------------</span>
<a name="l03284"></a>03284     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03285"></a>03285     <span class="comment">// ---------------------------------------</span>
<a name="l03286"></a>03286     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03287"></a>03287     {
<a name="l03288"></a>03288         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03289"></a>03289             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03290"></a>03290         <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03291"></a>03291     }
<a name="l03292"></a>03292     <span class="comment">// ---------------------------------------</span>
<a name="l03293"></a>03293 
<a name="l03294"></a>03294     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03295"></a>03295     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03296"></a>03296 
<a name="l03297"></a>03297     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l03298"></a>03298     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tOutput = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l03299"></a>03299     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#af3c3ed5823d48d9cf86463987f67ddae">GetValidFrom</a>(tOutput); <span class="comment">// &lt;========</span>
<a name="l03300"></a>03300 
<a name="l03301"></a>03301     <span class="keywordflow">return</span> bGotData ? tOutput : <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03302"></a>03302 }
<a name="l03303"></a>03303 
<a name="l03304"></a>03304 
<a name="l03305"></a>03305 
<a name="l03306"></a>03306 
<a name="l03307"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae11744cdc4c18885067e263a628268e3">03307</a> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#ae11744cdc4c18885067e263a628268e3">OTAPI_Exec::Instrmnt_GetValidTo</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03308"></a>03308 {
<a name="l03309"></a>03309     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03310"></a>03310     <span class="comment">// ------------------------------------</span>
<a name="l03311"></a>03311     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03312"></a>03312     <span class="comment">// ------------------------------------</span>
<a name="l03313"></a>03313     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03314"></a>03314 
<a name="l03315"></a>03315     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03316"></a>03316     {
<a name="l03317"></a>03317         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03318"></a>03318             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03319"></a>03319         <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03320"></a>03320     }
<a name="l03321"></a>03321     <span class="comment">// ---------------------------------------</span>
<a name="l03322"></a>03322     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03323"></a>03323     <span class="comment">// ---------------------------------------</span>
<a name="l03324"></a>03324     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03325"></a>03325     {
<a name="l03326"></a>03326         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03327"></a>03327             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03328"></a>03328         <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03329"></a>03329     }
<a name="l03330"></a>03330     <span class="comment">// ---------------------------------------</span>
<a name="l03331"></a>03331 
<a name="l03332"></a>03332     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03333"></a>03333     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03334"></a>03334 
<a name="l03335"></a>03335     <a class="code" href="class_o_t_string.html">OTString</a>    strOutput;
<a name="l03336"></a>03336     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      tOutput = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l03337"></a>03337     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a11dbba988d5da835179885043b4c3979">GetValidTo</a>(tOutput); <span class="comment">// &lt;========</span>
<a name="l03338"></a>03338 
<a name="l03339"></a>03339     <span class="keywordflow">return</span> bGotData ? tOutput : <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l03340"></a>03340 }
<a name="l03341"></a>03341 
<a name="l03342"></a>03342 
<a name="l03343"></a>03343 
<a name="l03344"></a>03344 
<a name="l03345"></a>03345 <span class="comment">// ------------------------------------------------</span>
<a name="l03346"></a>03346 
<a name="l03347"></a>03347 
<a name="l03348"></a>03348 
<a name="l03349"></a>03349 
<a name="l03350"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2fd472eebaee74cbac5399240fccca8f">03350</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2fd472eebaee74cbac5399240fccca8f">OTAPI_Exec::Instrmnt_GetType</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03351"></a>03351 {
<a name="l03352"></a>03352     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03353"></a>03353     <span class="comment">// ------------------------------------</span>
<a name="l03354"></a>03354     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03355"></a>03355     <span class="comment">// ------------------------------------</span>
<a name="l03356"></a>03356     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03357"></a>03357 
<a name="l03358"></a>03358     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03359"></a>03359     {
<a name="l03360"></a>03360         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03361"></a>03361             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03362"></a>03362         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03363"></a>03363     }
<a name="l03364"></a>03364     <span class="comment">// ---------------------------------------</span>
<a name="l03365"></a>03365     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03366"></a>03366     <span class="comment">// ---------------------------------------</span>
<a name="l03367"></a>03367     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03368"></a>03368     {
<a name="l03369"></a>03369         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03370"></a>03370             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03371"></a>03371         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03372"></a>03372     }
<a name="l03373"></a>03373     <span class="comment">// ---------------------------------------</span>
<a name="l03374"></a>03374     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03375"></a>03375     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03376"></a>03376 
<a name="l03377"></a>03377     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(thePayment.<a class="code" href="class_o_t_payment.html#a2ed80244fa3583b81f87abf8fc526f67">GetTypeString</a>());
<a name="l03378"></a>03378 
<a name="l03379"></a>03379     <span class="keywordflow">if</span> (strOutput.Exists())
<a name="l03380"></a>03380     {
<a name="l03381"></a>03381         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03382"></a>03382 
<a name="l03383"></a>03383 
<a name="l03384"></a>03384         <span class="keywordflow">return</span> pBuf;
<a name="l03385"></a>03385     }
<a name="l03386"></a>03386 
<a name="l03387"></a>03387     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03388"></a>03388 }
<a name="l03389"></a>03389 
<a name="l03390"></a>03390 
<a name="l03391"></a>03391 
<a name="l03392"></a>03392 <span class="comment">// ------------------------------------------------</span>
<a name="l03393"></a>03393 
<a name="l03394"></a>03394 
<a name="l03395"></a>03395 
<a name="l03396"></a>03396 
<a name="l03397"></a><a class="code" href="class_o_t_a_p_i___exec.html#acd74b10edc2c2d138f392e37292ee680">03397</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#acd74b10edc2c2d138f392e37292ee680">OTAPI_Exec::Instrmnt_GetMemo</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03398"></a>03398 {
<a name="l03399"></a>03399     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03400"></a>03400     <span class="comment">// ------------------------------------</span>
<a name="l03401"></a>03401     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03402"></a>03402     <span class="comment">// ------------------------------------</span>
<a name="l03403"></a>03403     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03404"></a>03404 
<a name="l03405"></a>03405     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03406"></a>03406     {
<a name="l03407"></a>03407         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03408"></a>03408             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03409"></a>03409         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03410"></a>03410     }
<a name="l03411"></a>03411     <span class="comment">// ---------------------------------------</span>
<a name="l03412"></a>03412     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03413"></a>03413     <span class="comment">// ---------------------------------------</span>
<a name="l03414"></a>03414     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03415"></a>03415     {
<a name="l03416"></a>03416         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03417"></a>03417             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03418"></a>03418         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03419"></a>03419     }
<a name="l03420"></a>03420     <span class="comment">// ---------------------------------------</span>
<a name="l03421"></a>03421 
<a name="l03422"></a>03422     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03423"></a>03423     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03424"></a>03424 
<a name="l03425"></a>03425     <a class="code" href="class_o_t_string.html">OTString</a>    strOutput;
<a name="l03426"></a>03426     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a76ed76e62e9b57487f08a6f1296260ab">GetMemo</a>(strOutput); <span class="comment">// &lt;========</span>
<a name="l03427"></a>03427 
<a name="l03428"></a>03428     <span class="keywordflow">if</span> (bGotData)
<a name="l03429"></a>03429     {
<a name="l03430"></a>03430         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03431"></a>03431         <span class="keywordflow">return</span> pBuf;
<a name="l03432"></a>03432     }
<a name="l03433"></a>03433 
<a name="l03434"></a>03434     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03435"></a>03435 }
<a name="l03436"></a>03436 
<a name="l03437"></a>03437 
<a name="l03438"></a>03438 <span class="comment">// ------------------------------------------------</span>
<a name="l03439"></a>03439 
<a name="l03440"></a>03440 
<a name="l03441"></a>03441 
<a name="l03442"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac239b16ee54d312d0cba2e20d90879ed">03442</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ac239b16ee54d312d0cba2e20d90879ed">OTAPI_Exec::Instrmnt_GetServerID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03443"></a>03443 {
<a name="l03444"></a>03444     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03445"></a>03445     <span class="comment">// ------------------------------------</span>
<a name="l03446"></a>03446     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03447"></a>03447     <span class="comment">// ------------------------------------</span>
<a name="l03448"></a>03448     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03449"></a>03449 
<a name="l03450"></a>03450     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03451"></a>03451     {
<a name="l03452"></a>03452         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>, __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03453"></a>03453         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03454"></a>03454     }
<a name="l03455"></a>03455     <span class="comment">// ---------------------------------------</span>
<a name="l03456"></a>03456     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03457"></a>03457     <span class="comment">// ---------------------------------------</span>
<a name="l03458"></a>03458     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03459"></a>03459     {
<a name="l03460"></a>03460         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>, __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03461"></a>03461         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03462"></a>03462     }
<a name="l03463"></a>03463     <span class="comment">// ---------------------------------------</span>
<a name="l03464"></a>03464 
<a name="l03465"></a>03465     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03466"></a>03466     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03467"></a>03467 
<a name="l03468"></a>03468     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03469"></a>03469     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a8bd230489482647591b26c47ad3e31fe">GetServerID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03470"></a>03470 
<a name="l03471"></a>03471     <span class="keywordflow">if</span> (bGotData)
<a name="l03472"></a>03472     {
<a name="l03473"></a>03473         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03474"></a>03474         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03475"></a>03475         <span class="keywordflow">return</span> pBuf;
<a name="l03476"></a>03476     }
<a name="l03477"></a>03477 
<a name="l03478"></a>03478     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03479"></a>03479 }
<a name="l03480"></a>03480 
<a name="l03481"></a>03481 
<a name="l03482"></a>03482 
<a name="l03483"></a>03483 
<a name="l03484"></a><a class="code" href="class_o_t_a_p_i___exec.html#a84f0ede82b6f2c43c2d3d089065bea15">03484</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a84f0ede82b6f2c43c2d3d089065bea15">OTAPI_Exec::Instrmnt_GetAssetID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03485"></a>03485 {
<a name="l03486"></a>03486     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03487"></a>03487     <span class="comment">// ------------------------------------</span>
<a name="l03488"></a>03488     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03489"></a>03489     <span class="comment">// ------------------------------------</span>
<a name="l03490"></a>03490     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03491"></a>03491 
<a name="l03492"></a>03492     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03493"></a>03493     {
<a name="l03494"></a>03494         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>, __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03495"></a>03495         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03496"></a>03496     }
<a name="l03497"></a>03497     <span class="comment">// ---------------------------------------</span>
<a name="l03498"></a>03498     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03499"></a>03499     <span class="comment">// ---------------------------------------</span>
<a name="l03500"></a>03500     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03501"></a>03501     {
<a name="l03502"></a>03502         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>, __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03503"></a>03503         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03504"></a>03504     }
<a name="l03505"></a>03505     <span class="comment">// ---------------------------------------</span>
<a name="l03506"></a>03506 
<a name="l03507"></a>03507     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03508"></a>03508     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03509"></a>03509 
<a name="l03510"></a>03510     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03511"></a>03511     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a37342f7cb3d3fa42afb8531f4989d552">GetAssetTypeID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03512"></a>03512 
<a name="l03513"></a>03513     <span class="keywordflow">if</span> (bGotData)
<a name="l03514"></a>03514     {
<a name="l03515"></a>03515         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03516"></a>03516         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03517"></a>03517         <span class="keywordflow">return</span> pBuf;
<a name="l03518"></a>03518     }
<a name="l03519"></a>03519 
<a name="l03520"></a>03520     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03521"></a>03521 }
<a name="l03522"></a>03522 
<a name="l03523"></a>03523 
<a name="l03524"></a>03524 
<a name="l03525"></a>03525 
<a name="l03526"></a><a class="code" href="class_o_t_a_p_i___exec.html#a814849a3dbd04a4463395b87d2c30569">03526</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a814849a3dbd04a4463395b87d2c30569">OTAPI_Exec::Instrmnt_GetRemitterUserID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03527"></a>03527 {
<a name="l03528"></a>03528     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03529"></a>03529     <span class="comment">// ------------------------------------</span>
<a name="l03530"></a>03530     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03531"></a>03531     <span class="comment">// ------------------------------------</span>
<a name="l03532"></a>03532     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03533"></a>03533 
<a name="l03534"></a>03534     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03535"></a>03535     {
<a name="l03536"></a>03536         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03537"></a>03537                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03538"></a>03538         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03539"></a>03539     }
<a name="l03540"></a>03540     <span class="comment">// ---------------------------------------</span>
<a name="l03541"></a>03541     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03542"></a>03542     <span class="comment">// ---------------------------------------</span>
<a name="l03543"></a>03543     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03544"></a>03544     {
<a name="l03545"></a>03545         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03546"></a>03546                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03547"></a>03547         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03548"></a>03548     }
<a name="l03549"></a>03549     <span class="comment">// ---------------------------------------</span>
<a name="l03550"></a>03550 
<a name="l03551"></a>03551     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03552"></a>03552     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03553"></a>03553 
<a name="l03554"></a>03554     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03555"></a>03555     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#aa1ba92e3012a6c5a847fdab8957eaa48">GetRemitterUserID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03556"></a>03556 
<a name="l03557"></a>03557     <span class="keywordflow">if</span> (bGotData)
<a name="l03558"></a>03558     {
<a name="l03559"></a>03559         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03560"></a>03560         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03561"></a>03561         <span class="keywordflow">return</span> pBuf;
<a name="l03562"></a>03562     }
<a name="l03563"></a>03563 
<a name="l03564"></a>03564     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03565"></a>03565 }
<a name="l03566"></a>03566 
<a name="l03567"></a>03567 
<a name="l03568"></a>03568 
<a name="l03569"></a>03569 
<a name="l03570"></a>03570 
<a name="l03571"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1ac12dffcbb923a2935e8b2d4c98742e">03571</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a1ac12dffcbb923a2935e8b2d4c98742e">OTAPI_Exec::Instrmnt_GetRemitterAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03572"></a>03572 {
<a name="l03573"></a>03573     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03574"></a>03574     <span class="comment">// ------------------------------------</span>
<a name="l03575"></a>03575     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03576"></a>03576     <span class="comment">// ------------------------------------</span>
<a name="l03577"></a>03577     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03578"></a>03578 
<a name="l03579"></a>03579     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03580"></a>03580     {
<a name="l03581"></a>03581         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03582"></a>03582                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03583"></a>03583         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03584"></a>03584     }
<a name="l03585"></a>03585     <span class="comment">// ---------------------------------------</span>
<a name="l03586"></a>03586     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03587"></a>03587     <span class="comment">// ---------------------------------------</span>
<a name="l03588"></a>03588     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03589"></a>03589     {
<a name="l03590"></a>03590         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03591"></a>03591                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03592"></a>03592         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03593"></a>03593     }
<a name="l03594"></a>03594     <span class="comment">// ---------------------------------------</span>
<a name="l03595"></a>03595 
<a name="l03596"></a>03596     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03597"></a>03597     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03598"></a>03598 
<a name="l03599"></a>03599     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03600"></a>03600     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a846843bfb3ae2c69d82c1c7189f2ab12">GetRemitterAcctID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03601"></a>03601 
<a name="l03602"></a>03602     <span class="keywordflow">if</span> (bGotData)
<a name="l03603"></a>03603     {
<a name="l03604"></a>03604         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03605"></a>03605         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03606"></a>03606         <span class="keywordflow">return</span> pBuf;
<a name="l03607"></a>03607     }
<a name="l03608"></a>03608 
<a name="l03609"></a>03609     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03610"></a>03610 }
<a name="l03611"></a>03611 
<a name="l03612"></a>03612 
<a name="l03613"></a>03613 
<a name="l03614"></a>03614 
<a name="l03615"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab251235ae0a34992165da9ac846f3d0e">03615</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab251235ae0a34992165da9ac846f3d0e">OTAPI_Exec::Instrmnt_GetSenderUserID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03616"></a>03616 {
<a name="l03617"></a>03617     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03618"></a>03618     <span class="comment">// ------------------------------------</span>
<a name="l03619"></a>03619     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03620"></a>03620     <span class="comment">// ------------------------------------</span>
<a name="l03621"></a>03621     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03622"></a>03622 
<a name="l03623"></a>03623     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03624"></a>03624     {
<a name="l03625"></a>03625         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03626"></a>03626                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03627"></a>03627         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03628"></a>03628     }
<a name="l03629"></a>03629     <span class="comment">// ---------------------------------------</span>
<a name="l03630"></a>03630     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03631"></a>03631     <span class="comment">// ---------------------------------------</span>
<a name="l03632"></a>03632     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03633"></a>03633     {
<a name="l03634"></a>03634         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03635"></a>03635                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03636"></a>03636         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03637"></a>03637     }
<a name="l03638"></a>03638     <span class="comment">// ---------------------------------------</span>
<a name="l03639"></a>03639 
<a name="l03640"></a>03640     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03641"></a>03641     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03642"></a>03642 
<a name="l03643"></a>03643     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03644"></a>03644     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a0df0b7637d7a74e10008aa349e148abd">GetSenderUserID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03645"></a>03645 
<a name="l03646"></a>03646     <span class="keywordflow">if</span> (bGotData)
<a name="l03647"></a>03647     {
<a name="l03648"></a>03648         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03649"></a>03649         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03650"></a>03650         <span class="keywordflow">return</span> pBuf;
<a name="l03651"></a>03651     }
<a name="l03652"></a>03652 
<a name="l03653"></a>03653     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03654"></a>03654 }
<a name="l03655"></a>03655 
<a name="l03656"></a>03656 
<a name="l03657"></a>03657 
<a name="l03658"></a>03658 
<a name="l03659"></a>03659 
<a name="l03660"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2ecd9a0a69c92f7e623be88eba1abdb7">03660</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2ecd9a0a69c92f7e623be88eba1abdb7">OTAPI_Exec::Instrmnt_GetSenderAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03661"></a>03661 {
<a name="l03662"></a>03662     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03663"></a>03663     <span class="comment">// ------------------------------------</span>
<a name="l03664"></a>03664     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03665"></a>03665     <span class="comment">// ------------------------------------</span>
<a name="l03666"></a>03666     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03667"></a>03667 
<a name="l03668"></a>03668     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03669"></a>03669     {
<a name="l03670"></a>03670         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03671"></a>03671                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03672"></a>03672         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03673"></a>03673     }
<a name="l03674"></a>03674     <span class="comment">// ---------------------------------------</span>
<a name="l03675"></a>03675     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03676"></a>03676     <span class="comment">// ---------------------------------------</span>
<a name="l03677"></a>03677     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03678"></a>03678     {
<a name="l03679"></a>03679         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03680"></a>03680                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03681"></a>03681         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03682"></a>03682     }
<a name="l03683"></a>03683     <span class="comment">// ---------------------------------------</span>
<a name="l03684"></a>03684 
<a name="l03685"></a>03685     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03686"></a>03686     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03687"></a>03687 
<a name="l03688"></a>03688     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03689"></a>03689     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;    bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a866c7dee565216660a9a9c95bfd49aa4">GetSenderAcctID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03690"></a>03690 
<a name="l03691"></a>03691     <span class="keywordflow">if</span> (bGotData)
<a name="l03692"></a>03692     {
<a name="l03693"></a>03693         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03694"></a>03694         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03695"></a>03695         <span class="keywordflow">return</span> pBuf;
<a name="l03696"></a>03696     }
<a name="l03697"></a>03697 
<a name="l03698"></a>03698     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03699"></a>03699 }
<a name="l03700"></a>03700 
<a name="l03701"></a>03701 
<a name="l03702"></a>03702 
<a name="l03703"></a>03703 
<a name="l03704"></a>03704 
<a name="l03705"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6b10e643af20f5aed9fc07b039be0a0b">03705</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a6b10e643af20f5aed9fc07b039be0a0b">OTAPI_Exec::Instrmnt_GetRecipientUserID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03706"></a>03706 {
<a name="l03707"></a>03707     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03708"></a>03708     <span class="comment">// ------------------------------------</span>
<a name="l03709"></a>03709     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03710"></a>03710     <span class="comment">// ------------------------------------</span>
<a name="l03711"></a>03711     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03712"></a>03712 
<a name="l03713"></a>03713     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03714"></a>03714     {
<a name="l03715"></a>03715         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03716"></a>03716             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03717"></a>03717         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03718"></a>03718     }
<a name="l03719"></a>03719     <span class="comment">// ---------------------------------------</span>
<a name="l03720"></a>03720     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03721"></a>03721     <span class="comment">// ---------------------------------------</span>
<a name="l03722"></a>03722     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03723"></a>03723     {
<a name="l03724"></a>03724         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03725"></a>03725             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03726"></a>03726         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03727"></a>03727     }
<a name="l03728"></a>03728     <span class="comment">// ---------------------------------------</span>
<a name="l03729"></a>03729 
<a name="l03730"></a>03730     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03731"></a>03731     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03732"></a>03732 
<a name="l03733"></a>03733     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03734"></a>03734     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a153137d1b34d4c1aee7d6350c56585cb">GetRecipientUserID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03735"></a>03735 
<a name="l03736"></a>03736     <span class="keywordflow">if</span> (bGotData)
<a name="l03737"></a>03737     {
<a name="l03738"></a>03738         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03739"></a>03739         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03740"></a>03740         <span class="keywordflow">return</span> pBuf;
<a name="l03741"></a>03741     }
<a name="l03742"></a>03742 
<a name="l03743"></a>03743     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03744"></a>03744 }
<a name="l03745"></a>03745 
<a name="l03746"></a>03746 
<a name="l03747"></a>03747 
<a name="l03748"></a>03748 
<a name="l03749"></a>03749 
<a name="l03750"></a><a class="code" href="class_o_t_a_p_i___exec.html#adece47c223e4ecb8e33700efad49dcb4">03750</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#adece47c223e4ecb8e33700efad49dcb4">OTAPI_Exec::Instrmnt_GetRecipientAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_INSTRUMENT)
<a name="l03751"></a>03751 {
<a name="l03752"></a>03752     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03753"></a>03753     <span class="comment">// ------------------------------------</span>
<a name="l03754"></a>03754     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strInstrument(THE_INSTRUMENT);
<a name="l03755"></a>03755     <span class="comment">// ------------------------------------</span>
<a name="l03756"></a>03756     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l03757"></a>03757 
<a name="l03758"></a>03758     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l03759"></a>03759     {
<a name="l03760"></a>03760         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to parse instrument:\n\n%s\n\n&quot;</span>,
<a name="l03761"></a>03761             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03762"></a>03762         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03763"></a>03763     }
<a name="l03764"></a>03764     <span class="comment">// ---------------------------------------</span>
<a name="l03765"></a>03765     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSetValues = thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>();
<a name="l03766"></a>03766     <span class="comment">// ---------------------------------------</span>
<a name="l03767"></a>03767     <span class="keywordflow">if</span> (!bSetValues)
<a name="l03768"></a>03768     {
<a name="l03769"></a>03769         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load instrument:\n\n%s\n\n&quot;</span>,
<a name="l03770"></a>03770             __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l03771"></a>03771         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03772"></a>03772     }
<a name="l03773"></a>03773     <span class="comment">// ---------------------------------------</span>
<a name="l03774"></a>03774     <span class="comment">// BY THIS POINT, we have definitely loaded up all the values of the instrument</span>
<a name="l03775"></a>03775     <span class="comment">// into the OTPayment object. (Meaning we can now return the requested data...)</span>
<a name="l03776"></a>03776 
<a name="l03777"></a>03777     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOutput;
<a name="l03778"></a>03778     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;  bGotData = thePayment.<a class="code" href="class_o_t_payment.html#a7ceb4d0048fd3fa3e7359d104274ac56">GetRecipientAcctID</a>(theOutput); <span class="comment">// &lt;========</span>
<a name="l03779"></a>03779 
<a name="l03780"></a>03780     <span class="keywordflow">if</span> (bGotData)
<a name="l03781"></a>03781     {
<a name="l03782"></a>03782         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l03783"></a>03783         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03784"></a>03784         <span class="keywordflow">return</span> pBuf;
<a name="l03785"></a>03785     }
<a name="l03786"></a>03786 
<a name="l03787"></a>03787     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03788"></a>03788 }
<a name="l03789"></a>03789 
<a name="l03790"></a>03790 
<a name="l03791"></a>03791 
<a name="l03792"></a>03792 
<a name="l03793"></a>03793 
<a name="l03794"></a>03794 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l03795"></a>03795 
<a name="l03796"></a>03796 
<a name="l03797"></a>03797 
<a name="l03798"></a>03798 
<a name="l03799"></a>03799 
<a name="l03800"></a>03800 
<a name="l03801"></a>03801 
<a name="l03802"></a>03802 <span class="comment">// -----------------------------------</span>
<a name="l03803"></a>03803 <span class="comment">// SET NYM NAME</span>
<a name="l03804"></a>03804 <span class="comment">//</span>
<a name="l03805"></a>03805 <span class="comment">// You might have 40 of your friends&#39; public nyms in</span>
<a name="l03806"></a>03806 <span class="comment">// your wallet. You might have labels on each of them.</span>
<a name="l03807"></a>03807 <span class="comment">// But whenever you change a label (and thus re-sign the</span>
<a name="l03808"></a>03808 <span class="comment">// file for that Nym when you save it), you only SIGN</span>
<a name="l03809"></a>03809 <span class="comment">// using one of your OWN nyms, for which you have a private</span>
<a name="l03810"></a>03810 <span class="comment">// key available for signing.</span>
<a name="l03811"></a>03811 <span class="comment">//</span>
<a name="l03812"></a>03812 <span class="comment">// When testing, there is only one nym, so you just pass it</span>
<a name="l03813"></a>03813 <span class="comment">// twice.  But in real production, a user will have a default</span>
<a name="l03814"></a>03814 <span class="comment">// signing nym, the same way that he might have a default</span>
<a name="l03815"></a>03815 <span class="comment">// signing key in PGP, and that must be passed in whenever</span>
<a name="l03816"></a>03816 <span class="comment">// he changes the name on any of the other nyms in his wallet.</span>
<a name="l03817"></a>03817 <span class="comment">// (In order to properly sign and save the change.)</span>
<a name="l03818"></a>03818 <span class="comment">//</span>
<a name="l03819"></a>03819 <span class="comment">// Returns true (1) or false (0)</span>
<a name="l03820"></a>03820 <span class="comment">//</span>
<a name="l03821"></a><a class="code" href="class_o_t_a_p_i___exec.html#acef95b1db2970770090244c83c00f4d3">03821</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#acef95b1db2970770090244c83c00f4d3">OTAPI_Exec::SetNym_Name</a>(<span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; NYM_NEW_NAME)
<a name="l03822"></a>03822 {
<a name="l03823"></a>03823     <span class="keywordflow">if</span> (NYM_ID.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03824"></a>03824     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03825"></a>03825     <span class="keywordflow">if</span> (NYM_NEW_NAME.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_NEW_NAME&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03826"></a>03826 
<a name="l03827"></a>03827     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(NYM_ID),
<a name="l03828"></a>03828                         theSignerNymID(SIGNER_NYM_ID);
<a name="l03829"></a>03829     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strNymName(NYM_NEW_NAME);
<a name="l03830"></a>03830 
<a name="l03831"></a>03831     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a765251304181ec99fa3874d0fe0a8568">SetNym_Name</a>(theNymID, theSignerNymID, strNymName);
<a name="l03832"></a>03832 
<a name="l03833"></a>03833     <span class="keywordflow">return</span> bSuccess;
<a name="l03834"></a>03834 }
<a name="l03835"></a>03835 
<a name="l03836"></a>03836 
<a name="l03837"></a>03837 <span class="comment">// Merely a client-side label</span>
<a name="l03838"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae068763567655cc5428ae49de980e616">03838</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ae068763567655cc5428ae49de980e616">OTAPI_Exec::SetServer_Name</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l03839"></a>03839                              <span class="keyword">const</span> std::string &amp; STR_NEW_NAME)
<a name="l03840"></a>03840 {
<a name="l03841"></a>03841     <span class="keywordflow">if</span> (SERVER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null SERVER_ID passed in!\n&quot;</span>    ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03842"></a>03842     <span class="keywordflow">if</span> (STR_NEW_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null STR_NEW_NAME passed in!\n&quot;</span> ,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03843"></a>03843 
<a name="l03844"></a>03844     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theContractID(SERVER_ID);
<a name="l03845"></a>03845     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strNewName(STR_NEW_NAME);
<a name="l03846"></a>03846 
<a name="l03847"></a>03847     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5e063a9ac2d1e9c15eb116948a16fb6e">SetServer_Name</a>(theContractID, strNewName);
<a name="l03848"></a>03848 
<a name="l03849"></a>03849     <span class="keywordflow">return</span> bSuccess;
<a name="l03850"></a>03850 }
<a name="l03851"></a>03851 
<a name="l03852"></a>03852 
<a name="l03853"></a>03853 
<a name="l03854"></a>03854 <span class="comment">// Merely a client-side label</span>
<a name="l03855"></a><a class="code" href="class_o_t_a_p_i___exec.html#abbedf6402584e01cbc3c7716704f35d3">03855</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#abbedf6402584e01cbc3c7716704f35d3">OTAPI_Exec::SetAssetType_Name</a>(<span class="keyword">const</span> std::string &amp; ASSET_ID,
<a name="l03856"></a>03856                                 <span class="keyword">const</span> std::string &amp; STR_NEW_NAME)
<a name="l03857"></a>03857 {
<a name="l03858"></a>03858     <span class="keywordflow">if</span> (ASSET_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03859"></a>03859     <span class="keywordflow">if</span> (STR_NEW_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;STR_NEW_NAME&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03860"></a>03860 
<a name="l03861"></a>03861     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theContractID(ASSET_ID);
<a name="l03862"></a>03862     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strNewName(STR_NEW_NAME);
<a name="l03863"></a>03863 
<a name="l03864"></a>03864     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a62071d84252f0b233071c640b9de67de">SetAssetType_Name</a>(theContractID, strNewName);
<a name="l03865"></a>03865 
<a name="l03866"></a>03866     <span class="keywordflow">return</span> bSuccess;
<a name="l03867"></a>03867 }
<a name="l03868"></a>03868 
<a name="l03869"></a>03869 
<a name="l03870"></a>03870 
<a name="l03871"></a>03871 
<a name="l03872"></a>03872 <span class="comment">//----------------------------------------------------------</span>
<a name="l03873"></a>03873 <span class="comment">// GET NYM TRANSACTION NUM COUNT</span>
<a name="l03874"></a>03874 <span class="comment">// How many transaction numbers does the Nym have (for a given server?)</span>
<a name="l03875"></a>03875 <span class="comment">//</span>
<a name="l03876"></a>03876 <span class="comment">// This function returns the count of numbers available. If 0, then no</span>
<a name="l03877"></a>03877 <span class="comment">// transactions will work until you call OTAPI_Exec::getTransactionNumber()</span>
<a name="l03878"></a>03878 <span class="comment">// to replenish your Nym&#39;s supply for that ServerID...</span>
<a name="l03879"></a>03879 <span class="comment">//</span>
<a name="l03880"></a>03880 <span class="comment">// Returns a count (0 through N numbers available),</span>
<a name="l03881"></a>03881 <span class="comment">// or -1 for error (no nym found.)</span>
<a name="l03882"></a>03882 <span class="comment">//</span>
<a name="l03883"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa429be08bd7a15ae954a5fbb916a16af">03883</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#aa429be08bd7a15ae954a5fbb916a16af">OTAPI_Exec::GetNym_TransactionNumCount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; NYM_ID)
<a name="l03884"></a>03884 {
<a name="l03885"></a>03885     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03886"></a>03886     <span class="keywordflow">if</span> (NYM_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03887"></a>03887 
<a name="l03888"></a>03888     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID);
<a name="l03889"></a>03889     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theNymID(NYM_ID);
<a name="l03890"></a>03890 
<a name="l03891"></a>03891     int32_t nReturnValue = 0;
<a name="l03892"></a>03892     <span class="comment">// -------------------------</span>
<a name="l03893"></a>03893     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theNymID, __FUNCTION__);
<a name="l03894"></a>03894 
<a name="l03895"></a>03895     <span class="keywordflow">if</span> (NULL != pNym)
<a name="l03896"></a>03896         nReturnValue = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#adee7eef0a51e8e94522c43ac898c2308">GetTransactionNumCount</a>(theServerID);
<a name="l03897"></a>03897     <span class="keywordflow">else</span>
<a name="l03898"></a>03898         nReturnValue = -1;
<a name="l03899"></a>03899 
<a name="l03900"></a>03900     <span class="keywordflow">return</span> nReturnValue;
<a name="l03901"></a>03901 }
<a name="l03902"></a>03902 
<a name="l03903"></a>03903 
<a name="l03904"></a>03904 
<a name="l03905"></a>03905 <span class="comment">// based on Index (above 4 functions) this returns the Server&#39;s ID</span>
<a name="l03906"></a><a class="code" href="class_o_t_a_p_i___exec.html#a75a82ad6c9be31757dc6211f7987e815">03906</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a75a82ad6c9be31757dc6211f7987e815">OTAPI_Exec::GetServer_ID</a>(<span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03907"></a>03907 {
<a name="l03908"></a>03908     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03909"></a>03909 
<a name="l03910"></a>03910     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID;
<a name="l03911"></a>03911     <a class="code" href="class_o_t_string.html">OTString</a>        strName;
<a name="l03912"></a>03912     <span class="keywordtype">bool</span> bGetServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(nIndex, theID, strName);
<a name="l03913"></a>03913 
<a name="l03914"></a>03914     <span class="keywordflow">if</span> (bGetServer)
<a name="l03915"></a>03915     {
<a name="l03916"></a>03916         <a class="code" href="class_o_t_string.html">OTString</a> strID(theID);
<a name="l03917"></a>03917 
<a name="l03918"></a>03918         std::string pBuf = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03919"></a>03919 
<a name="l03920"></a>03920 
<a name="l03921"></a>03921 
<a name="l03922"></a>03922         <span class="keywordflow">return</span> pBuf;
<a name="l03923"></a>03923     }
<a name="l03924"></a>03924     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03925"></a>03925 }
<a name="l03926"></a>03926 
<a name="l03927"></a>03927 
<a name="l03928"></a>03928 <span class="comment">// Return&#39;s Server&#39;s name (based on server ID)</span>
<a name="l03929"></a><a class="code" href="class_o_t_a_p_i___exec.html#a901a8e43cec3997fce4a334fd14c14b5">03929</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a901a8e43cec3997fce4a334fd14c14b5">OTAPI_Exec::GetServer_Name</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l03930"></a>03930 {
<a name="l03931"></a>03931     <span class="keywordflow">if</span> (THE_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03932"></a>03932     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l03933"></a>03933 
<a name="l03934"></a>03934     <span class="comment">// -------------------------</span>
<a name="l03935"></a>03935     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(theID, __FUNCTION__);
<a name="l03936"></a>03936     <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03937"></a>03937     <span class="comment">// -------------------------</span>
<a name="l03938"></a>03938     <a class="code" href="class_o_t_string.html">OTString</a> strName;
<a name="l03939"></a>03939     pServer-&gt;<a class="code" href="class_o_t_contract.html#a1afca402333b7c546104d5aa48c8efd9">GetName</a>(strName);
<a name="l03940"></a>03940     std::string pBuf = strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03941"></a>03941 
<a name="l03942"></a>03942     <span class="keywordflow">return</span> pBuf;
<a name="l03943"></a>03943 }
<a name="l03944"></a>03944 
<a name="l03945"></a>03945 <span class="comment">// returns Asset Type ID (based on index from GetAssetTypeCount)</span>
<a name="l03946"></a><a class="code" href="class_o_t_a_p_i___exec.html#afcae7efa87317326a01618ab42c9ddb0">03946</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afcae7efa87317326a01618ab42c9ddb0">OTAPI_Exec::GetAssetType_ID</a>(<span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l03947"></a>03947 {
<a name="l03948"></a>03948     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03949"></a>03949 
<a name="l03950"></a>03950     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID;
<a name="l03951"></a>03951     <a class="code" href="class_o_t_string.html">OTString</a>        strName;
<a name="l03952"></a>03952 
<a name="l03953"></a>03953     <span class="keywordtype">bool</span> bGetServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(nIndex, theID, strName);
<a name="l03954"></a>03954 
<a name="l03955"></a>03955     <span class="keywordflow">if</span> (bGetServer)
<a name="l03956"></a>03956     {
<a name="l03957"></a>03957         <a class="code" href="class_o_t_string.html">OTString</a> strID(theID);
<a name="l03958"></a>03958         std::string pBuf = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03959"></a>03959 
<a name="l03960"></a>03960         <span class="keywordflow">return</span> pBuf;
<a name="l03961"></a>03961     }
<a name="l03962"></a>03962     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03963"></a>03963 }
<a name="l03964"></a>03964 
<a name="l03965"></a>03965 <span class="comment">// Returns asset type Name based on Asset Type ID</span>
<a name="l03966"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6675e1b70df65f26f68fa709ce00e72e">03966</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a6675e1b70df65f26f68fa709ce00e72e">OTAPI_Exec::GetAssetType_Name</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l03967"></a>03967 {
<a name="l03968"></a>03968     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03969"></a>03969 
<a name="l03970"></a>03970     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l03971"></a>03971     <span class="comment">// -------------------------</span>
<a name="l03972"></a>03972     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(theID, __FUNCTION__);
<a name="l03973"></a>03973     <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03974"></a>03974     <span class="comment">// -------------------------</span>
<a name="l03975"></a>03975     <a class="code" href="class_o_t_string.html">OTString</a> strName;
<a name="l03976"></a>03976     pContract-&gt;<a class="code" href="class_o_t_contract.html#a1afca402333b7c546104d5aa48c8efd9">GetName</a>(strName);
<a name="l03977"></a>03977     std::string pBuf = strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03978"></a>03978 
<a name="l03979"></a>03979     <span class="keywordflow">return</span> pBuf;
<a name="l03980"></a>03980 }
<a name="l03981"></a>03981 
<a name="l03982"></a>03982 <span class="comment">// Returns asset type TLA based on Asset Type ID</span>
<a name="l03983"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1f3b27b02d266a328445a1bd9a560655">03983</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a1f3b27b02d266a328445a1bd9a560655">OTAPI_Exec::GetAssetType_TLA</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l03984"></a>03984 {
<a name="l03985"></a>03985     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l03986"></a>03986 
<a name="l03987"></a>03987     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l03988"></a>03988     <span class="comment">// -------------------------</span>
<a name="l03989"></a>03989     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a291b0f7c5298ceecc8d4aa929146d4db">GetAssetType</a>(theID, __FUNCTION__);
<a name="l03990"></a>03990     <span class="keywordflow">if</span> (NULL == pContract) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l03991"></a>03991     <span class="comment">// -------------------------</span>
<a name="l03992"></a>03992     <a class="code" href="class_o_t_string.html">OTString</a> strTLA;
<a name="l03993"></a>03993     strTLA = pContract-&gt;<a class="code" href="class_o_t_asset_contract.html#a57453300ee2ae1c1237078126d993afc">GetCurrencyTLA</a>();
<a name="l03994"></a>03994     std::string pBuf = strTLA.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l03995"></a>03995 
<a name="l03996"></a>03996     <span class="keywordflow">return</span> pBuf;
<a name="l03997"></a>03997 }
<a name="l03998"></a>03998 
<a name="l03999"></a>03999 
<a name="l04000"></a>04000 <span class="comment">// -------------------------------------------------------------</span>
<a name="l04001"></a>04001 
<a name="l04002"></a>04002 
<a name="l04003"></a>04003 <span class="comment">// returns a string containing the account ID, based on index.</span>
<a name="l04004"></a><a class="code" href="class_o_t_a_p_i___exec.html#a07d988d698bb0f914031141297445e72">04004</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a07d988d698bb0f914031141297445e72">OTAPI_Exec::GetAccountWallet_ID</a>(<span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l04005"></a>04005 {
<a name="l04006"></a>04006     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04007"></a>04007 
<a name="l04008"></a>04008     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID;
<a name="l04009"></a>04009     <a class="code" href="class_o_t_string.html">OTString</a>        strName;
<a name="l04010"></a>04010 
<a name="l04011"></a>04011     <span class="keywordtype">bool</span> bGetServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(nIndex, theID, strName);
<a name="l04012"></a>04012 
<a name="l04013"></a>04013     <span class="keywordflow">if</span> (bGetServer)
<a name="l04014"></a>04014     {
<a name="l04015"></a>04015         <a class="code" href="class_o_t_string.html">OTString</a> strID(theID);
<a name="l04016"></a>04016 
<a name="l04017"></a>04017         std::string pBuf = strID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04018"></a>04018 
<a name="l04019"></a>04019         <span class="keywordflow">return</span> pBuf;
<a name="l04020"></a>04020     }
<a name="l04021"></a>04021     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04022"></a>04022 }
<a name="l04023"></a>04023 
<a name="l04024"></a>04024 
<a name="l04025"></a>04025 
<a name="l04026"></a>04026 <span class="comment">// returns the account name, based on account ID.</span>
<a name="l04027"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab3dbd2eed67f029065dfa58c9b20d1ea">04027</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab3dbd2eed67f029065dfa58c9b20d1ea">OTAPI_Exec::GetAccountWallet_Name</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04028"></a>04028 {
<a name="l04029"></a>04029     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04030"></a>04030 
<a name="l04031"></a>04031     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l04032"></a>04032 
<a name="l04033"></a>04033     std::string strFunc = <span class="stringliteral">&quot;OTAPI_Exec::GetAccountWallet_Name&quot;</span>;
<a name="l04034"></a>04034     <span class="comment">// -------------------------</span>
<a name="l04035"></a>04035     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, strFunc.c_str());
<a name="l04036"></a>04036     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04037"></a>04037     <span class="comment">// -------------------------</span>
<a name="l04038"></a>04038     <a class="code" href="class_o_t_string.html">OTString</a> strName;
<a name="l04039"></a>04039     pAccount-&gt;<a class="code" href="class_o_t_contract.html#a1afca402333b7c546104d5aa48c8efd9">GetName</a>(strName);
<a name="l04040"></a>04040     std::string pBuf = strName.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04041"></a>04041 
<a name="l04042"></a>04042     <span class="keywordflow">return</span> pBuf;
<a name="l04043"></a>04043 }
<a name="l04044"></a>04044 
<a name="l04045"></a>04045 
<a name="l04046"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2aff6dd65d83c222076e923033ee088a">04046</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2aff6dd65d83c222076e923033ee088a">OTAPI_Exec::GetAccountWallet_InboxHash</a> (<span class="keyword">const</span> std::string &amp; ACCOUNT_ID)  <span class="comment">// returns latest InboxHash according to the account file. (Usually more recent than: OTAPI_Exec::GetNym_InboxHash)</span>
<a name="l04047"></a>04047 {
<a name="l04048"></a>04048     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04049"></a>04049 
<a name="l04050"></a>04050     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(ACCOUNT_ID);
<a name="l04051"></a>04051 
<a name="l04052"></a>04052     <span class="comment">// -------------------------</span>
<a name="l04053"></a>04053     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04054"></a>04054     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04055"></a>04055     <span class="comment">// -------------------------</span>
<a name="l04056"></a>04056 
<a name="l04057"></a>04057     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l04058"></a>04058     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bGotHash = pAccount-&gt;<a class="code" href="class_o_t_account.html#aa0e90e3692031e59bff0cd5296dfbe0e">GetInboxHash</a>(theOutput);
<a name="l04059"></a>04059 
<a name="l04060"></a>04060     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04061"></a>04061 
<a name="l04062"></a>04062     <span class="keywordflow">if</span> (bGotHash)
<a name="l04063"></a>04063         theOutput.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strOutput);
<a name="l04064"></a>04064 
<a name="l04065"></a>04065     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04066"></a>04066 
<a name="l04067"></a>04067     <span class="keywordflow">return</span> pBuf;
<a name="l04068"></a>04068 }
<a name="l04069"></a>04069 
<a name="l04070"></a>04070 
<a name="l04071"></a>04071 
<a name="l04072"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae47c46f41ae9992a198ad12ee096379b">04072</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae47c46f41ae9992a198ad12ee096379b">OTAPI_Exec::GetAccountWallet_OutboxHash</a>(<span class="keyword">const</span> std::string &amp; ACCOUNT_ID)  <span class="comment">// returns latest OutboxHash according to the account file. (Usually more recent than: OTAPI_Exec::GetNym_OutboxHash)</span>
<a name="l04073"></a>04073 {
<a name="l04074"></a>04074     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04075"></a>04075 
<a name="l04076"></a>04076     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(ACCOUNT_ID);
<a name="l04077"></a>04077 
<a name="l04078"></a>04078     <span class="comment">// -------------------------</span>
<a name="l04079"></a>04079     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04080"></a>04080     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04081"></a>04081     <span class="comment">// -------------------------</span>
<a name="l04082"></a>04082 
<a name="l04083"></a>04083     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l04084"></a>04084     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bGotHash = pAccount-&gt;<a class="code" href="class_o_t_account.html#af5ff8a85bb964fd1cdb811b383bb0d11">GetOutboxHash</a>(theOutput);
<a name="l04085"></a>04085 
<a name="l04086"></a>04086     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04087"></a>04087 
<a name="l04088"></a>04088     <span class="keywordflow">if</span> (bGotHash)
<a name="l04089"></a>04089         theOutput.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strOutput);
<a name="l04090"></a>04090 
<a name="l04091"></a>04091     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04092"></a>04092 
<a name="l04093"></a>04093     <span class="keywordflow">return</span> pBuf;
<a name="l04094"></a>04094 }
<a name="l04095"></a>04095 
<a name="l04096"></a>04096 
<a name="l04097"></a>04097 
<a name="l04098"></a>04098 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04108"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4d3eee535eeb45f738060ee88192c2e7">04108</a> <span class="comment"></span><a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#a4d3eee535eeb45f738060ee88192c2e7">OTAPI_Exec::GetTime</a>(<span class="keywordtype">void</span>)
<a name="l04109"></a>04109 {
<a name="l04110"></a>04110     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a2ff83b1c64286eafdf7af6360e138d6e">GetTime</a>();
<a name="l04111"></a>04111 }
<a name="l04112"></a>04112 
<a name="l04113"></a>04113 
<a name="l04114"></a>04114 
<a name="l04115"></a>04115 
<a name="l04116"></a>04116 
<a name="l04117"></a>04117 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04130"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa3f9f90ebd9b2125a4ad725350eba455">04130</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa3f9f90ebd9b2125a4ad725350eba455">OTAPI_Exec::Encode</a>(<span class="keyword">const</span> std::string &amp; strPlaintext, <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bLineBreaks) <span class="comment">// bLineBreaks should usually be set to true.</span>
<a name="l04131"></a>04131 {
<a name="l04132"></a>04132     <span class="keywordflow">if</span> (strPlaintext.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strPlaintext&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04133"></a>04133 
<a name="l04134"></a>04134     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bLineBreaks           ) &amp;&amp; (<span class="keyword">false</span> != bLineBreaks          ) ) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bLineBreaks&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04135"></a>04135 
<a name="l04136"></a>04136     <span class="keyword">const</span>   <a class="code" href="class_o_t_string.html">OTString</a> otstrPlaintext(strPlaintext);
<a name="l04137"></a>04137     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04138"></a>04138 
<a name="l04139"></a>04139     <span class="keywordtype">bool</span> bEncoded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8f2b202917e923bfe9eeacd152493401">Encode</a>(otstrPlaintext, strOutput, (<span class="keyword">true</span> == bLineBreaks) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l04140"></a>04140 
<a name="l04141"></a>04141     <span class="keywordflow">if</span> (!bEncoded)
<a name="l04142"></a>04142         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04143"></a>04143 
<a name="l04144"></a>04144     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04145"></a>04145 
<a name="l04146"></a>04146     <span class="keywordflow">return</span> pBuf;
<a name="l04147"></a>04147 }
<a name="l04148"></a>04148 
<a name="l04149"></a>04149 
<a name="l04150"></a>04150 
<a name="l04151"></a>04151 
<a name="l04152"></a>04152 
<a name="l04153"></a>04153 
<a name="l04154"></a>04154 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04167"></a><a class="code" href="class_o_t_a_p_i___exec.html#a43a627c39c47d17c4e180b56a0eae3c1">04167</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#a43a627c39c47d17c4e180b56a0eae3c1">OTAPI_Exec::Decode</a>(<span class="keyword">const</span> std::string &amp; strEncoded, <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bLineBreaks)
<a name="l04168"></a>04168 {
<a name="l04169"></a>04169     <span class="keywordflow">if</span> (strEncoded.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strEncoded&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04170"></a>04170 
<a name="l04171"></a>04171     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bLineBreaks           ) &amp;&amp; (<span class="keyword">false</span> != bLineBreaks          ) ) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bLineBreaks&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04172"></a>04172 
<a name="l04173"></a>04173     <span class="keyword">const</span>   <a class="code" href="class_o_t_string.html">OTString</a> otstrEncoded(strEncoded);
<a name="l04174"></a>04174     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04175"></a>04175 
<a name="l04176"></a>04176     <span class="keywordtype">bool</span> bDecoded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3c5209f2f8ba1892edb5cf4614cd04a6">Decode</a>(otstrEncoded, strOutput,  (<span class="keyword">true</span> == bLineBreaks) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l04177"></a>04177 
<a name="l04178"></a>04178     <span class="keywordflow">if</span> (!bDecoded)
<a name="l04179"></a>04179         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04180"></a>04180 
<a name="l04181"></a>04181     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04182"></a>04182 
<a name="l04183"></a>04183     <span class="keywordflow">return</span> pBuf;
<a name="l04184"></a>04184 }
<a name="l04185"></a>04185 
<a name="l04186"></a>04186 
<a name="l04187"></a>04187 
<a name="l04188"></a>04188 
<a name="l04189"></a>04189 
<a name="l04190"></a>04190 
<a name="l04191"></a>04191 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04207"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4daf6ceaab8227c0eb5deb777d8337df">04207</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4daf6ceaab8227c0eb5deb777d8337df">OTAPI_Exec::Encrypt</a>(<span class="keyword">const</span> std::string &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> std::string &amp; strPlaintext)
<a name="l04208"></a>04208 {
<a name="l04209"></a>04209     <span class="keywordflow">if</span> (RECIPIENT_NYM_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_NYM_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04210"></a>04210     <span class="keywordflow">if</span> (strPlaintext.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strPlaintext&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04211"></a>04211     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04212"></a>04212     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      otstrPlaintext(strPlaintext);
<a name="l04213"></a>04213     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theRecipientNymID(RECIPIENT_NYM_ID);
<a name="l04214"></a>04214     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04215"></a>04215     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04216"></a>04216 
<a name="l04217"></a>04217     <span class="keywordtype">bool</span> bEncrypted = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa0fba0e8b0dbbe6a77bc443a6d99fa06">Encrypt</a>(theRecipientNymID, otstrPlaintext, strOutput);
<a name="l04218"></a>04218 
<a name="l04219"></a>04219     <span class="keywordflow">if</span> (!bEncrypted || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l04220"></a>04220         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04221"></a>04221 
<a name="l04222"></a>04222     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04223"></a>04223 
<a name="l04224"></a>04224     <span class="keywordflow">return</span> pBuf;
<a name="l04225"></a>04225 }
<a name="l04226"></a>04226 
<a name="l04227"></a>04227 
<a name="l04228"></a>04228 
<a name="l04229"></a>04229 
<a name="l04230"></a>04230 
<a name="l04231"></a>04231 
<a name="l04232"></a>04232 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04252"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae28cbabad8107e944b504986f929300f">04252</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae28cbabad8107e944b504986f929300f">OTAPI_Exec::Decrypt</a>(<span class="keyword">const</span> std::string &amp; RECIPIENT_NYM_ID, <span class="keyword">const</span> std::string &amp; strCiphertext)
<a name="l04253"></a>04253 {
<a name="l04254"></a>04254     <span class="keywordflow">if</span> (RECIPIENT_NYM_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_NYM_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04255"></a>04255     <span class="keywordflow">if</span> (strCiphertext.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;strCiphertext&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04256"></a>04256     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04257"></a>04257     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      otstrCiphertext(strCiphertext);
<a name="l04258"></a>04258     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theRecipientNymID(RECIPIENT_NYM_ID);
<a name="l04259"></a>04259     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04260"></a>04260     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04261"></a>04261 
<a name="l04262"></a>04262     <span class="keywordtype">bool</span> bDecrypted = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a864877a4f56fbbfee46ad8a650a1bb82">Decrypt</a>(theRecipientNymID, otstrCiphertext, strOutput);
<a name="l04263"></a>04263 
<a name="l04264"></a>04264     <span class="keywordflow">if</span> (!bDecrypted || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l04265"></a>04265         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04266"></a>04266 
<a name="l04267"></a>04267     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04268"></a>04268 
<a name="l04269"></a>04269     <span class="keywordflow">return</span> pBuf;
<a name="l04270"></a>04270 }
<a name="l04271"></a>04271 
<a name="l04272"></a>04272 
<a name="l04273"></a>04273 
<a name="l04274"></a>04274 
<a name="l04275"></a>04275 
<a name="l04276"></a>04276 
<a name="l04277"></a>04277 <span class="comment">// -----------------------------------------------</span>
<a name="l04278"></a>04278 
<a name="l04279"></a>04279 <span class="comment">// SYMMETRIC</span>
<a name="l04280"></a>04280 
<a name="l04281"></a>04281 
<a name="l04282"></a>04282 <span class="comment">// Generates a new symmetric key, based on a passphrase,</span>
<a name="l04283"></a>04283 <span class="comment">// and returns it (or &quot;&quot;.)</span>
<a name="l04284"></a>04284 <span class="comment">//</span>
<a name="l04285"></a><a class="code" href="class_o_t_a_p_i___exec.html#a11ee44a4fd68c82181708d4a1d375f89">04285</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a11ee44a4fd68c82181708d4a1d375f89">OTAPI_Exec::CreateSymmetricKey</a>()
<a name="l04286"></a>04286 {
<a name="l04287"></a>04287     <a class="code" href="class_o_t_string.html">OTString</a>  strOutput;
<a name="l04288"></a>04288     <span class="comment">// -----------------------------------------------</span>
<a name="l04289"></a>04289     std::string    strDisplay = <span class="stringliteral">&quot;OTAPI: Creating a new symmetric key.&quot;</span>;
<a name="l04290"></a>04290     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrDisplay(strDisplay);
<a name="l04291"></a>04291     <span class="comment">// -----------------------------------------------</span>
<a name="l04292"></a>04292     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSuccess = <a class="code" href="class_o_t_symmetric_key.html#a386861ca9897dbbfc1a5fb50d2cfd814">OTSymmetricKey::CreateNewKey</a>(strOutput, &amp;otstrDisplay);<span class="comment">//pAlreadyHavePW=&quot;&quot;</span>
<a name="l04293"></a>04293 
<a name="l04294"></a>04294     <span class="keywordflow">if</span> (!bSuccess)
<a name="l04295"></a>04295         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04296"></a>04296 
<a name="l04297"></a>04297     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04298"></a>04298 
<a name="l04299"></a>04299     <span class="keywordflow">return</span> pBuf;
<a name="l04300"></a>04300 }
<a name="l04301"></a>04301 
<a name="l04302"></a>04302 <span class="comment">// -----------------------------------------------</span>
<a name="l04303"></a>04303 
<a name="l04304"></a>04304 <span class="comment">// OTEnvelope:</span>
<a name="l04305"></a>04305 <span class="comment">//     bool Encrypt(const OTString &amp; theInput,        OTSymmetricKey &amp; theKey, const OTPassword &amp; thePassword);</span>
<a name="l04306"></a>04306 <span class="comment">//     bool Decrypt(      OTString &amp; theOutput, const OTSymmetricKey &amp; theKey, const OTPassword &amp; thePassword);</span>
<a name="l04307"></a>04307 
<a name="l04308"></a>04308 
<a name="l04309"></a>04309 <span class="comment">// Returns the CIPHERTEXT_ENVELOPE (the Envelope encrypted with the Symmetric Key.)</span>
<a name="l04310"></a>04310 <span class="comment">//</span>
<a name="l04311"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2ef85cec19e635f13c565dd93359589e">04311</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2ef85cec19e635f13c565dd93359589e">OTAPI_Exec::SymmetricEncrypt</a>(<span class="keyword">const</span> std::string &amp; SYMMETRIC_KEY, <span class="keyword">const</span> std::string &amp; PLAINTEXT)
<a name="l04312"></a>04312 {
<a name="l04313"></a>04313     <span class="keywordflow">if</span> (SYMMETRIC_KEY.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SYMMETRIC_KEY&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04314"></a>04314     <span class="keywordflow">if</span> (PLAINTEXT.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PLAINTEXT&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04315"></a>04315     <span class="comment">// ---------------------------</span>
<a name="l04316"></a>04316     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strKey(SYMMETRIC_KEY);
<a name="l04317"></a>04317     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strPlaintext(PLAINTEXT);
<a name="l04318"></a>04318     <span class="comment">// -----------------------------------</span>
<a name="l04319"></a>04319     <a class="code" href="class_o_t_string.html">OTString</a>  strOutput;
<a name="l04320"></a>04320     <span class="comment">// ---------------------------</span>
<a name="l04321"></a>04321     std::string    strDisplay = <span class="stringliteral">&quot;OTAPI: Password-protecting a plaintext.&quot;</span>;
<a name="l04322"></a>04322     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrDisplay(strDisplay);
<a name="l04323"></a>04323     <span class="comment">// ---------------------------</span>
<a name="l04324"></a>04324     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#a4daf6ceaab8227c0eb5deb777d8337df">OTSymmetricKey::Encrypt</a>(strKey, strPlaintext, strOutput, &amp;otstrDisplay); <span class="comment">//bBookends=true, pAlreadyHavePW=&quot;&quot;</span>
<a name="l04325"></a>04325 
<a name="l04326"></a>04326     <span class="keywordflow">if</span> (!bSuccess)
<a name="l04327"></a>04327         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04328"></a>04328 
<a name="l04329"></a>04329     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04330"></a>04330 
<a name="l04331"></a>04331     <span class="keywordflow">return</span> pBuf;
<a name="l04332"></a>04332 }
<a name="l04333"></a>04333 
<a name="l04334"></a>04334 <span class="comment">// -----------------------------------------------</span>
<a name="l04335"></a>04335 
<a name="l04336"></a>04336 <span class="comment">// Returns the PLAINTEXT.</span>
<a name="l04337"></a>04337 <span class="comment">//</span>
<a name="l04338"></a><a class="code" href="class_o_t_a_p_i___exec.html#a87fe72dc0aa6fc6f384f87bc3b5269ac">04338</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a87fe72dc0aa6fc6f384f87bc3b5269ac">OTAPI_Exec::SymmetricDecrypt</a>(<span class="keyword">const</span> std::string &amp; SYMMETRIC_KEY, <span class="keyword">const</span> std::string &amp; CIPHERTEXT_ENVELOPE)
<a name="l04339"></a>04339 {
<a name="l04340"></a>04340     <span class="keywordflow">if</span> (SYMMETRIC_KEY.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SYMMETRIC_KEY&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04341"></a>04341     <span class="keywordflow">if</span> (CIPHERTEXT_ENVELOPE.empty()){ <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CIPHERTEXT_ENVELOPE&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04342"></a>04342     <span class="comment">// ---------------------------</span>
<a name="l04343"></a>04343     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strKey(SYMMETRIC_KEY);
<a name="l04344"></a>04344     <a class="code" href="class_o_t_string.html">OTString</a>  strCiphertext(CIPHERTEXT_ENVELOPE);
<a name="l04345"></a>04345     <span class="comment">// ---------------------------</span>
<a name="l04346"></a>04346     <a class="code" href="class_o_t_string.html">OTString</a>  strOutput;
<a name="l04347"></a>04347     <span class="comment">// ---------------------------</span>
<a name="l04348"></a>04348     std::string    strDisplay = <span class="stringliteral">&quot;OTAPI: Decrypting a password-protected ciphertext.&quot;</span>;
<a name="l04349"></a>04349     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrDisplay(strDisplay);
<a name="l04350"></a>04350     <span class="comment">// ---------------------------</span>
<a name="l04351"></a>04351     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;      bSuccess  = <a class="code" href="class_o_t_a_p_i___exec.html#ae28cbabad8107e944b504986f929300f">OTSymmetricKey::Decrypt</a>(strKey, strCiphertext, strOutput, &amp;otstrDisplay);<span class="comment">//pAlreadyHavePW=&quot;&quot;</span>
<a name="l04352"></a>04352 
<a name="l04353"></a>04353     <span class="keywordflow">if</span> (!bSuccess)
<a name="l04354"></a>04354         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04355"></a>04355 
<a name="l04356"></a>04356     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04357"></a>04357 
<a name="l04358"></a>04358     <span class="keywordflow">return</span> pBuf;
<a name="l04359"></a>04359 }
<a name="l04360"></a>04360 
<a name="l04361"></a>04361 <span class="comment">// -----------------------------------------------</span>
<a name="l04362"></a>04362 
<a name="l04363"></a>04363 
<a name="l04364"></a>04364 
<a name="l04365"></a>04365 
<a name="l04366"></a>04366 
<a name="l04367"></a>04367 
<a name="l04368"></a>04368 
<a name="l04369"></a>04369 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04385"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4a74efbfa2260792f86e7712f56c4300">04385</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4a74efbfa2260792f86e7712f56c4300">OTAPI_Exec::SignContract</a>(<span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l04386"></a>04386 {
<a name="l04387"></a>04387     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l04388"></a>04388     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04389"></a>04389 
<a name="l04390"></a>04390     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04391"></a>04391     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04392"></a>04392 
<a name="l04393"></a>04393     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04394"></a>04394     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT);
<a name="l04395"></a>04395     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l04396"></a>04396     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04397"></a>04397     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04398"></a>04398 
<a name="l04399"></a>04399     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSigned  = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa354b7ac168afd7cacfcf045241f4771">SignContract</a>(theSignerNymID, strContract, strOutput);
<a name="l04400"></a>04400 
<a name="l04401"></a>04401     <span class="keywordflow">if</span> (!bSigned || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l04402"></a>04402         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04403"></a>04403 
<a name="l04404"></a>04404     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04405"></a>04405 
<a name="l04406"></a>04406     <span class="keywordflow">return</span> pBuf;
<a name="l04407"></a>04407 }
<a name="l04408"></a>04408 
<a name="l04409"></a>04409 
<a name="l04410"></a>04410 
<a name="l04411"></a>04411 <span class="comment">// Instead of signing an existing contract, this is for just signing a flat message.</span>
<a name="l04412"></a>04412 <span class="comment">// Or, for example, for signing a new contract that has no signature yet. Let&#39;s say you</span>
<a name="l04413"></a>04413 <span class="comment">// have a ledger, for example, with no signatures yet. Pass &quot;LEDGER&quot; as the CONTRACT_TYPE</span>
<a name="l04414"></a>04414 <span class="comment">// and the resulting output will start like this: -----BEGIN OT SIGNED LEDGER----- ...</span>
<a name="l04415"></a>04415 <span class="comment">// Returns the signed output, or &quot;&quot;.</span>
<a name="l04416"></a>04416 <span class="comment">//</span>
<a name="l04417"></a><a class="code" href="class_o_t_a_p_i___exec.html#a73444dac75c57e91b7e4f51a2ec74a13">04417</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a73444dac75c57e91b7e4f51a2ec74a13">OTAPI_Exec::FlatSign</a>(<span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; THE_INPUT, <span class="keyword">const</span> std::string &amp; CONTRACT_TYPE)
<a name="l04418"></a>04418 {
<a name="l04419"></a>04419     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l04420"></a>04420     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04421"></a>04421 
<a name="l04422"></a>04422     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04423"></a>04423     <span class="keywordflow">if</span> (THE_INPUT.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INPUT&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04424"></a>04424     <span class="keywordflow">if</span> (CONTRACT_TYPE.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CONTRACT_TYPE&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04425"></a>04425 
<a name="l04426"></a>04426 
<a name="l04427"></a>04427     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04428"></a>04428     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_INPUT);
<a name="l04429"></a>04429     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContractType(CONTRACT_TYPE);
<a name="l04430"></a>04430     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l04431"></a>04431     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04432"></a>04432     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04433"></a>04433 
<a name="l04434"></a>04434     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSigned  = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a4decdc65f8b0a207a6057b86716e050a">FlatSign</a>(theSignerNymID,  strContract,
<a name="l04435"></a>04435         strContractType, strOutput);
<a name="l04436"></a>04436 
<a name="l04437"></a>04437     <span class="keywordflow">if</span> (!bSigned || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l04438"></a>04438         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04439"></a>04439 
<a name="l04440"></a>04440     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04441"></a>04441 
<a name="l04442"></a>04442     <span class="keywordflow">return</span> pBuf;
<a name="l04443"></a>04443 }
<a name="l04444"></a>04444 
<a name="l04445"></a>04445 
<a name="l04446"></a>04446 
<a name="l04447"></a>04447 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04464"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2afcd57686081fac9f7d1a598c38baa9">04464</a> <span class="comment"></span>std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2afcd57686081fac9f7d1a598c38baa9">OTAPI_Exec::AddSignature</a>(<span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l04465"></a>04465 {
<a name="l04466"></a>04466     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l04467"></a>04467     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04468"></a>04468 
<a name="l04469"></a>04469     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04470"></a>04470     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04471"></a>04471 
<a name="l04472"></a>04472     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04473"></a>04473     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT);
<a name="l04474"></a>04474     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l04475"></a>04475     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04476"></a>04476     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04477"></a>04477 
<a name="l04478"></a>04478     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSigned  = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae5d31c92f0438b3c64ff5466c4e380e1">AddSignature</a>(theSignerNymID, strContract, strOutput);
<a name="l04479"></a>04479 
<a name="l04480"></a>04480     <span class="keywordflow">if</span> (!bSigned || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l04481"></a>04481         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04482"></a>04482 
<a name="l04483"></a>04483     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04484"></a>04484 
<a name="l04485"></a>04485     <span class="keywordflow">return</span> pBuf;
<a name="l04486"></a>04486 
<a name="l04487"></a>04487 }
<a name="l04488"></a>04488 
<a name="l04489"></a>04489 
<a name="l04490"></a>04490 
<a name="l04491"></a>04491 
<a name="l04492"></a>04492 
<a name="l04493"></a>04493 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l04498"></a><a class="code" href="class_o_t_a_p_i___exec.html#afadde01e1b2244f7d85f4420c3f4dfdc">04498</a> <span class="comment"></span><span class="keywordtype">bool</span>    <a class="code" href="class_o_t_a_p_i___exec.html#afadde01e1b2244f7d85f4420c3f4dfdc">OTAPI_Exec::VerifySignature</a>(<span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l04499"></a>04499 {
<a name="l04500"></a>04500     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04501"></a>04501     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04502"></a>04502     <span class="comment">// -----------------------------------------------------</span>
<a name="l04503"></a>04503     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT);
<a name="l04504"></a>04504     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(SIGNER_NYM_ID);
<a name="l04505"></a>04505     <span class="comment">// -----------------------------------------------------</span>
<a name="l04506"></a>04506     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bVerified = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1ffc5ff556721c5ab9fee696ea922ec1">VerifySignature</a>(strContract, theNymID); <span class="comment">/*ppContract=&quot;&quot; (optional third parameter for retrieving loaded contract.)*/</span>
<a name="l04507"></a>04507     <span class="comment">// -----------------------------------------------------</span>
<a name="l04508"></a>04508     <span class="keywordflow">return</span> bVerified ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l04509"></a>04509 }
<a name="l04510"></a>04510 
<a name="l04511"></a>04511 
<a name="l04512"></a>04512 
<a name="l04513"></a>04513 
<a name="l04514"></a>04514 
<a name="l04515"></a>04515 <span class="comment">// --------------------------------------------------</span>
<a name="l04516"></a>04516 <span class="comment">// Verify and Retrieve XML Contents.</span>
<a name="l04517"></a>04517 <span class="comment">//</span>
<a name="l04518"></a>04518 <span class="comment">// Pass in a contract and a user ID, and this function will:</span>
<a name="l04519"></a>04519 <span class="comment">// -- Load the contract up and verify it.</span>
<a name="l04520"></a>04520 <span class="comment">// -- Verify the user&#39;s signature on it.</span>
<a name="l04521"></a>04521 <span class="comment">// -- Remove the PGP-style bookends (the signatures, etc)</span>
<a name="l04522"></a>04522 <span class="comment">//    and return the XML contents of the contract in string form.</span>
<a name="l04523"></a>04523 <span class="comment">//</span>
<a name="l04524"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0233aa61ac24910bdc4671054734ede2">04524</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a0233aa61ac24910bdc4671054734ede2">OTAPI_Exec::VerifyAndRetrieveXMLContents</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l04525"></a>04525                                                 <span class="keyword">const</span> std::string &amp; SIGNER_ID)
<a name="l04526"></a>04526 {
<a name="l04527"></a>04527     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04528"></a>04528     <span class="keywordflow">if</span> (SIGNER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04529"></a>04529 
<a name="l04530"></a>04530     <span class="comment">// -----------------------------------------------------</span>
<a name="l04531"></a>04531     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT);
<a name="l04532"></a>04532     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerID(SIGNER_ID);
<a name="l04533"></a>04533     <span class="comment">// -----------------------------------------------------</span>
<a name="l04534"></a>04534     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l04535"></a>04535 
<a name="l04536"></a>04536     <span class="keywordflow">if</span> (<span class="keyword">false</span> == <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t_a_p_i___exec.html#a0233aa61ac24910bdc4671054734ede2">VerifyAndRetrieveXMLContents</a>(strContract, theSignerID, strOutput))
<a name="l04537"></a>04537     {
<a name="l04538"></a>04538         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure: OTAPI()-&gt;VerifyAndRetrieveXMLContents() returned false.\n&quot;</span>,__FUNCTION__);
<a name="l04539"></a>04539         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04540"></a>04540     }
<a name="l04541"></a>04541     <span class="comment">// -----------------------------------------------------</span>
<a name="l04542"></a>04542     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04543"></a>04543 
<a name="l04544"></a>04544 
<a name="l04545"></a>04545 
<a name="l04546"></a>04546     <span class="keywordflow">return</span> pBuf;
<a name="l04547"></a>04547 }
<a name="l04548"></a>04548 
<a name="l04549"></a>04549 
<a name="l04550"></a>04550 
<a name="l04551"></a>04551 
<a name="l04552"></a>04552 
<a name="l04553"></a>04553 <span class="comment">// === Verify Account Receipt ===</span>
<a name="l04554"></a>04554 <span class="comment">// Returns bool. Verifies any asset account (intermediary files) against its own last signed receipt.</span>
<a name="l04555"></a>04555 <span class="comment">// Obviously this will fail for any new account that hasn&#39;t done any transactions yet, and thus has no receipts.</span>
<a name="l04556"></a>04556 <span class="comment">//</span>
<a name="l04557"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae39f85e4d8ad13120b1f9b90e50b6b21">04557</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ae39f85e4d8ad13120b1f9b90e50b6b21">OTAPI_Exec::VerifyAccountReceipt</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; NYM_ID, <span class="keyword">const</span> std::string &amp; ACCT_ID)
<a name="l04558"></a>04558 {
<a name="l04559"></a>04559     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04560"></a>04560     <span class="keywordflow">if</span> (NYM_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04561"></a>04561     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04562"></a>04562 
<a name="l04563"></a>04563     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theNymID(NYM_ID), theAcctID(ACCT_ID);
<a name="l04564"></a>04564     <span class="comment">// -----------------------------------------------------</span>
<a name="l04565"></a>04565     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bVerified = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a6db6ca5618edfb53c7a8a7bc38e4bd0e">VerifyAccountReceipt</a>(theServerID, theNymID, theAcctID);
<a name="l04566"></a>04566     <span class="comment">// -----------------------------------------------------</span>
<a name="l04567"></a>04567     <span class="keywordflow">return</span> bVerified ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l04568"></a>04568 }
<a name="l04569"></a>04569 
<a name="l04570"></a>04570 
<a name="l04571"></a>04571 
<a name="l04572"></a>04572 
<a name="l04573"></a>04573 
<a name="l04574"></a>04574 
<a name="l04575"></a>04575 <span class="comment">// -------------------------------------------------------</span>
<a name="l04576"></a>04576 <span class="comment">// SET ACCOUNT NAME (client side only. Server cares not about such labels.)</span>
<a name="l04577"></a>04577 <span class="comment">//</span>
<a name="l04578"></a>04578 <span class="comment">// Returns true (1) or false (0)</span>
<a name="l04579"></a>04579 <span class="comment">//</span>
<a name="l04580"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0343b96a3234afefa81e23926935252b">04580</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a0343b96a3234afefa81e23926935252b">OTAPI_Exec::SetAccountWallet_Name</a>(<span class="keyword">const</span> std::string &amp; ACCT_ID, <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="keyword">const</span> std::string &amp; ACCT_NEW_NAME)
<a name="l04581"></a>04581 {
<a name="l04582"></a>04582     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04583"></a>04583     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04584"></a>04584     <span class="keywordflow">if</span> (ACCT_NEW_NAME.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NEW_NAME&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04585"></a>04585 
<a name="l04586"></a>04586     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theAcctID(ACCT_ID),
<a name="l04587"></a>04587         theSignerNymID(SIGNER_NYM_ID);
<a name="l04588"></a>04588     <a class="code" href="class_o_t_string.html">OTString</a>        strAcctNewName(ACCT_NEW_NAME);
<a name="l04589"></a>04589 
<a name="l04590"></a>04590     <span class="keywordtype">bool</span> bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa2213ae9a93b111ca1c774df67818b6b">SetAccount_Name</a>(theAcctID, theSignerNymID, strAcctNewName);
<a name="l04591"></a>04591 
<a name="l04592"></a>04592     <span class="keywordflow">return</span> bSuccess ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l04593"></a>04593 }
<a name="l04594"></a>04594 
<a name="l04595"></a>04595 
<a name="l04596"></a>04596 
<a name="l04597"></a>04597 <span class="comment">// returns the account balance, based on account ID.</span>
<a name="l04598"></a><a class="code" href="class_o_t_a_p_i___exec.html#a879a62e450c8881a0d0db04285fd6103">04598</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a879a62e450c8881a0d0db04285fd6103">OTAPI_Exec::GetAccountWallet_Balance</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04599"></a>04599 {
<a name="l04600"></a>04600     <span class="keywordflow">if</span> (THE_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04601"></a>04601 
<a name="l04602"></a>04602     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l04603"></a>04603     <span class="comment">// -------------------------</span>
<a name="l04604"></a>04604     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04605"></a>04605     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> -1;
<a name="l04606"></a>04606     <span class="comment">// -------------------------</span>
<a name="l04607"></a>04607     int64_t lBalance = pAccount-&gt;<a class="code" href="class_o_t_account.html#a77fbaae9496caec7cd899721971a89c0">GetBalance</a>();
<a name="l04608"></a>04608     <span class="keywordflow">return</span> lBalance;
<a name="l04609"></a>04609 }
<a name="l04610"></a>04610 
<a name="l04611"></a>04611 
<a name="l04612"></a>04612 
<a name="l04613"></a>04613 <span class="comment">// returns an account&#39;s &quot;account type&quot;, (simple, issuer, etc.)</span>
<a name="l04614"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae2f54619b76a48ef8afad46e3d3bfc30">04614</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae2f54619b76a48ef8afad46e3d3bfc30">OTAPI_Exec::GetAccountWallet_Type</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04615"></a>04615 {
<a name="l04616"></a>04616     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04617"></a>04617 
<a name="l04618"></a>04618     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l04619"></a>04619     <span class="comment">// -------------------------</span>
<a name="l04620"></a>04620     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04621"></a>04621     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04622"></a>04622     <span class="comment">// -------------------------</span>
<a name="l04623"></a>04623     std::string pBuf = pAccount-&gt;<a class="code" href="class_o_t_account.html#a15dbf34beb7f8e38c6719120770bc852">GetTypeString</a>();
<a name="l04624"></a>04624 
<a name="l04625"></a>04625 
<a name="l04626"></a>04626     <span class="keywordflow">return</span> pBuf;
<a name="l04627"></a>04627 }
<a name="l04628"></a>04628 
<a name="l04629"></a>04629 
<a name="l04630"></a>04630 
<a name="l04631"></a>04631 <span class="comment">// Returns an account&#39;s asset type ID.</span>
<a name="l04632"></a>04632 <span class="comment">// (Which is a hash of the contract used to issue the asset type.)</span>
<a name="l04633"></a><a class="code" href="class_o_t_a_p_i___exec.html#af812b71a9eb104706179bd10e06d5170">04633</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af812b71a9eb104706179bd10e06d5170">OTAPI_Exec::GetAccountWallet_AssetTypeID</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04634"></a>04634 {
<a name="l04635"></a>04635     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04636"></a>04636 
<a name="l04637"></a>04637     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theID(THE_ID);
<a name="l04638"></a>04638     <span class="comment">// -------------------------</span>
<a name="l04639"></a>04639     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04640"></a>04640     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04641"></a>04641     <span class="comment">// -------------------------</span>
<a name="l04642"></a>04642     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(pAccount-&gt;<a class="code" href="class_o_t_account.html#a3b933b8c929e071a68ec4a29ad5797d6">GetAssetTypeID</a>());
<a name="l04643"></a>04643 
<a name="l04644"></a>04644     <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(theAssetID);
<a name="l04645"></a>04645 
<a name="l04646"></a>04646     <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Returning asset type %s for account %s\n&quot;</span>, __FUNCTION__, strAssetTypeID.Get(), THE_ID.c_str());
<a name="l04647"></a>04647 
<a name="l04648"></a>04648     std::string pBuf = strAssetTypeID.Get();
<a name="l04649"></a>04649 
<a name="l04650"></a>04650     <span class="keywordflow">return</span> pBuf;
<a name="l04651"></a>04651 }
<a name="l04652"></a>04652 
<a name="l04653"></a>04653 
<a name="l04654"></a>04654 
<a name="l04655"></a>04655 <span class="comment">// Returns an account&#39;s Server ID.</span>
<a name="l04656"></a>04656 <span class="comment">// (Which is a hash of the server contract.)</span>
<a name="l04657"></a><a class="code" href="class_o_t_a_p_i___exec.html#afb2255e4fb7fb27bbeebe753eb827770">04657</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afb2255e4fb7fb27bbeebe753eb827770">OTAPI_Exec::GetAccountWallet_ServerID</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04658"></a>04658 {
<a name="l04659"></a>04659     <span class="keywordflow">if</span> (THE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04660"></a>04660 
<a name="l04661"></a>04661     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theID(THE_ID);
<a name="l04662"></a>04662     <span class="comment">// -------------------------</span>
<a name="l04663"></a>04663     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04664"></a>04664     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04665"></a>04665     <span class="comment">// -------------------------</span>
<a name="l04666"></a>04666     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
<a name="l04667"></a>04667     <a class="code" href="class_o_t_string.html">OTString</a> strServerID(theServerID);
<a name="l04668"></a>04668 
<a name="l04669"></a>04669     std::string pBuf = strServerID.Get();
<a name="l04670"></a>04670 
<a name="l04671"></a>04671     <span class="keywordflow">return</span> pBuf;
<a name="l04672"></a>04672 }
<a name="l04673"></a>04673 
<a name="l04674"></a>04674 
<a name="l04675"></a>04675 
<a name="l04676"></a>04676 
<a name="l04677"></a>04677 <span class="comment">// Returns an account&#39;s Nym ID.</span>
<a name="l04678"></a>04678 <span class="comment">// (Which is a hash of the Nym&#39;s public key for the owner of this account.)</span>
<a name="l04679"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5c11f6d8c1dd9024788124685c8bb8d8">04679</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5c11f6d8c1dd9024788124685c8bb8d8">OTAPI_Exec::GetAccountWallet_NymID</a>(<span class="keyword">const</span> std::string &amp; THE_ID)
<a name="l04680"></a>04680 {
<a name="l04681"></a>04681     <span class="keywordflow">if</span> (THE_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04682"></a>04682 
<a name="l04683"></a>04683     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theID(THE_ID);
<a name="l04684"></a>04684 
<a name="l04685"></a>04685     <span class="comment">// -------------------------</span>
<a name="l04686"></a>04686     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theID, __FUNCTION__);
<a name="l04687"></a>04687     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04688"></a>04688     <span class="comment">// -------------------------</span>
<a name="l04689"></a>04689     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a845d76c16f6f5f3f4bc9ac04393ca3c0">GetUserID</a>());
<a name="l04690"></a>04690     <a class="code" href="class_o_t_string.html">OTString</a> strUserID(theUserID);
<a name="l04691"></a>04691 
<a name="l04692"></a>04692     std::string pBuf = strUserID.Get();
<a name="l04693"></a>04693 
<a name="l04694"></a>04694     <span class="keywordflow">return</span> pBuf;
<a name="l04695"></a>04695 }
<a name="l04696"></a>04696 
<a name="l04697"></a>04697 
<a name="l04698"></a>04698 
<a name="l04699"></a>04699 
<a name="l04700"></a>04700 <span class="comment">/*</span>
<a name="l04701"></a>04701 <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l04702"></a>04702 <span class="comment"></span>
<a name="l04703"></a>04703 <span class="comment">WRITE A CHEQUE  --- (Returns the cheque in string form.)</span>
<a name="l04704"></a>04704 <span class="comment"></span>
<a name="l04705"></a>04705 <span class="comment">==&gt; OTAPI_Exec::WriteCheque() internally constructs an OTCheque and issues it, like so:</span>
<a name="l04706"></a>04706 <span class="comment"></span>
<a name="l04707"></a>04707 <span class="comment">OTCheque theCheque( SERVER_ID, ASSET_TYPE_ID );</span>
<a name="l04708"></a>04708 <span class="comment"></span>
<a name="l04709"></a>04709 <span class="comment">theCheque.IssueCheque( AMOUNT // The amount of the cheque, in string form, which OTAPI</span>
<a name="l04710"></a>04710 <span class="comment">// will convert to a int64_t integer. Negative amounts</span>
<a name="l04711"></a>04711 <span class="comment">// allowed, since that is how OT implements invoices.</span>
<a name="l04712"></a>04712 <span class="comment">// (An invoice is just a cheque with a negative amount.)</span>
<a name="l04713"></a>04713 <span class="comment"></span>
<a name="l04714"></a>04714 <span class="comment">lTransactionNumber,   // The API will supply this automatically, as long as</span>
<a name="l04715"></a>04715 <span class="comment">// there are some transaction numbers in the wallet. (Call</span>
<a name="l04716"></a>04716 <span class="comment">// OTAPI_Exec::getTransactionNumber() if your wallet needs more.)</span>
<a name="l04717"></a>04717 <span class="comment"></span>
<a name="l04718"></a>04718 <span class="comment">VALID_FROM, VALID_TO, // Valid date range (in seconds since Jan 1970...)</span>
<a name="l04719"></a>04719 <span class="comment"></span>
<a name="l04720"></a>04720 <span class="comment">ACCOUNT_ID, USER_ID,  // User ID and Acct ID for SENDER.</span>
<a name="l04721"></a>04721 <span class="comment"></span>
<a name="l04722"></a>04722 <span class="comment">CHEQUE_MEMO,  // The memo for the cheque.</span>
<a name="l04723"></a>04723 <span class="comment"></span>
<a name="l04724"></a>04724 <span class="comment">RECIPIENT_USER_ID); // Recipient User ID is optional. (You can use an</span>
<a name="l04725"></a>04725 <span class="comment">// empty string here, to write a blank cheque.)</span>
<a name="l04726"></a>04726 <span class="comment">*/</span>
<a name="l04727"></a><a class="code" href="class_o_t_a_p_i___exec.html#a27dd75c5354aa488495ff2636cff1d64">04727</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a27dd75c5354aa488495ff2636cff1d64">OTAPI_Exec::WriteCheque</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l04728"></a>04728                                     <span class="keyword">const</span> int64_t &amp; CHEQUE_AMOUNT,
<a name="l04729"></a>04729                                     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp; VALID_FROM,
<a name="l04730"></a>04730                                     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp; VALID_TO,
<a name="l04731"></a>04731                                     <span class="keyword">const</span> std::string &amp; SENDER_ACCT_ID,
<a name="l04732"></a>04732                                     <span class="keyword">const</span> std::string &amp; SENDER_USER_ID,
<a name="l04733"></a>04733                                     <span class="keyword">const</span> std::string &amp; CHEQUE_MEMO,
<a name="l04734"></a>04734                                     <span class="keyword">const</span> std::string &amp; RECIPIENT_USER_ID)
<a name="l04735"></a>04735 {
<a name="l04736"></a>04736     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04737"></a>04737     <span class="keywordflow">if</span> (0 == CHEQUE_AMOUNT)         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CHEQUE_AMOUNT&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04738"></a>04738     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_FROM)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_FROM&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04739"></a>04739     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_TO)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_TO&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04740"></a>04740     <span class="keywordflow">if</span> (SENDER_ACCT_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_ACCT_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04741"></a>04741     <span class="keywordflow">if</span> (SENDER_USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_USER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04742"></a>04742 <span class="comment">//  if (CHEQUE_MEMO.empty())        { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;CHEQUE_MEMO&quot;        ); OT_FAIL; } // optional</span>
<a name="l04743"></a>04743 <span class="comment">//  if (RECIPIENT_USER_ID.empty())  { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;RECIPIENT_USER_ID&quot;  ); OT_FAIL; } // optional</span>
<a name="l04744"></a>04744 
<a name="l04745"></a>04745     <span class="keyword">const</span> int64_t lAmount = CHEQUE_AMOUNT;
<a name="l04746"></a>04746     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  time_From = <span class="keyword">static_cast&lt;</span><a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a><span class="keyword">&gt;</span>(VALID_FROM), time_To = static_cast&lt;time64_t&gt;(VALID_TO);
<a name="l04747"></a>04747 
<a name="l04748"></a>04748     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l04749"></a>04749     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderAcctID(SENDER_ACCT_ID);
<a name="l04750"></a>04750     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderUserID(SENDER_USER_ID);
<a name="l04751"></a>04751           <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theRecipientUserID;
<a name="l04752"></a>04752     <span class="keywordtype">bool</span>  bHasRecipient = !RECIPIENT_USER_ID.empty();
<a name="l04753"></a>04753     <span class="keywordflow">if</span> (bHasRecipient)
<a name="l04754"></a>04754         theRecipientUserID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(RECIPIENT_USER_ID);
<a name="l04755"></a>04755     <span class="comment">// ----------------------------------------------------</span>
<a name="l04756"></a>04756     <a class="code" href="class_o_t_string.html">OTString</a> strMemo;
<a name="l04757"></a>04757 
<a name="l04758"></a>04758     <span class="keywordflow">if</span> (!CHEQUE_MEMO.empty())
<a name="l04759"></a>04759         strMemo.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(CHEQUE_MEMO);
<a name="l04760"></a>04760 
<a name="l04761"></a>04761     <a class="code" href="class_o_t_cheque.html">OTCheque</a> * pCheque = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a504e99bac03c227bbecb79f869a76578">WriteCheque</a>(theServerID,
<a name="l04762"></a>04762         static_cast&lt;int64_t&gt;(lAmount),
<a name="l04763"></a>04763         time_From, time_To,
<a name="l04764"></a>04764         theSenderAcctID,
<a name="l04765"></a>04765         theSenderUserID,
<a name="l04766"></a>04766         strMemo,
<a name="l04767"></a>04767         bHasRecipient ? &amp;(theRecipientUserID) : NULL);
<a name="l04768"></a>04768 
<a name="l04769"></a>04769     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCheque&gt;</a> theChequeAngel(pCheque); <span class="comment">// Handles cleanup. (If necessary.)</span>
<a name="l04770"></a>04770 
<a name="l04771"></a>04771     <span class="keywordflow">if</span> (NULL == pCheque)
<a name="l04772"></a>04772     {
<a name="l04773"></a>04773         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: OT_API::WriteCheque failed.\n&quot;</span>,__FUNCTION__);
<a name="l04774"></a>04774         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04775"></a>04775     }
<a name="l04776"></a>04776     <span class="comment">// ------------------------------------------------</span>
<a name="l04777"></a>04777     <span class="comment">// At this point, I know pCheque is good (and will be cleaned up automatically.)</span>
<a name="l04778"></a>04778 
<a name="l04779"></a>04779     <a class="code" href="class_o_t_string.html">OTString</a> strCheque(*pCheque); <span class="comment">// Extract the cheque to string form.</span>
<a name="l04780"></a>04780 
<a name="l04781"></a>04781     std::string pBuf = strCheque.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04782"></a>04782 
<a name="l04783"></a>04783     <span class="keywordflow">return</span> pBuf;
<a name="l04784"></a>04784 }
<a name="l04785"></a>04785 
<a name="l04786"></a>04786 
<a name="l04787"></a>04787 
<a name="l04788"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab036b53cfb6fef0bc6b4c2aad7b132f8">04788</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ab036b53cfb6fef0bc6b4c2aad7b132f8">OTAPI_Exec::DiscardCheque</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l04789"></a>04789                                <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l04790"></a>04790                                <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l04791"></a>04791                                <span class="keyword">const</span> std::string &amp; THE_CHEQUE)
<a name="l04792"></a>04792 {
<a name="l04793"></a>04793     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04794"></a>04794     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04795"></a>04795     <span class="keywordflow">if</span> (ACCT_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04796"></a>04796     <span class="keywordflow">if</span> (THE_CHEQUE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CHEQUE&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04797"></a>04797 
<a name="l04798"></a>04798     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l04799"></a>04799     <a class="code" href="class_o_t_string.html">OTString</a> strCheque(THE_CHEQUE);
<a name="l04800"></a>04800 
<a name="l04801"></a>04801     <span class="keyword">const</span> <span class="keywordtype">bool</span> bDiscarded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8e1fde16ebe39537f28c737844d09d1f">DiscardCheque</a>(theServerID, theUserID, theAcctID, strCheque);
<a name="l04802"></a>04802 
<a name="l04803"></a>04803     <span class="keywordflow">return</span> (bDiscarded ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l04804"></a>04804 }
<a name="l04805"></a>04805 
<a name="l04806"></a>04806 
<a name="l04807"></a>04807 
<a name="l04808"></a>04808 <span class="comment">// -----------------------------------------------------------------</span>
<a name="l04809"></a>04809 <span class="comment">// PROPOSE PAYMENT PLAN</span>
<a name="l04810"></a>04810 <span class="comment">//</span>
<a name="l04811"></a>04811 <span class="comment">// (Return as STRING)</span>
<a name="l04812"></a>04812 <span class="comment">//</span>
<a name="l04813"></a>04813 <span class="comment">// PARAMETER NOTES:</span>
<a name="l04814"></a>04814 <span class="comment">// -- Payment Plan Delay, and Payment Plan Period, both default to 30 days (if you pass 0.)</span>
<a name="l04815"></a>04815 <span class="comment">//</span>
<a name="l04816"></a>04816 <span class="comment">// -- Payment Plan Length, and Payment Plan Max Payments, both default to 0, which means</span>
<a name="l04817"></a>04817 <span class="comment">//    no maximum length and no maximum number of payments.</span>
<a name="l04818"></a>04818 <span class="comment">//</span>
<a name="l04819"></a>04819 <span class="comment">// -----------------------------------------------------------------</span>
<a name="l04820"></a>04820 <span class="comment">// FYI, the payment plan creation process (finally) is:</span>
<a name="l04821"></a>04821 <span class="comment">//</span>
<a name="l04822"></a>04822 <span class="comment">// 1) Payment plan is written, and signed, by the recipient.  (This function: OTAPI_Exec::ProposePaymentPlan)</span>
<a name="l04823"></a>04823 <span class="comment">// 2) He sends it to the sender, who signs it and submits it. (OTAPI_Exec::ConfirmPaymentPlan and OTAPI_Exec::depositPaymentPlan)</span>
<a name="l04824"></a>04824 <span class="comment">// 3) The server loads the recipient nym to verify the transaction</span>
<a name="l04825"></a>04825 <span class="comment">//    number. The sender also had to burn a transaction number (to</span>
<a name="l04826"></a>04826 <span class="comment">//    submit it) so now, both have verified trns#s in this way.</span>
<a name="l04827"></a>04827 <span class="comment">//</span>
<a name="l04828"></a><a class="code" href="class_o_t_a_p_i___exec.html#a40f2d69da9c58ffe07517e2b5f22f125">04828</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a40f2d69da9c58ffe07517e2b5f22f125">OTAPI_Exec::ProposePaymentPlan</a>(
<a name="l04829"></a>04829     <span class="keyword">const</span> std::string   &amp; SERVER_ID,
<a name="l04830"></a>04830     <span class="comment">// ----------------------------------------</span>
<a name="l04831"></a>04831     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>        &amp; VALID_FROM, <span class="comment">// Default (0 or NULL) == current time measured in seconds since Jan 1970.</span>
<a name="l04832"></a>04832     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>        &amp; VALID_TO,     <span class="comment">// Default (0 or NULL) == no expiry / cancel anytime. Otherwise this is ADDED to VALID_FROM (it&#39;s a length.)</span>
<a name="l04833"></a>04833     <span class="comment">// ----------------------------------------</span>
<a name="l04834"></a>04834     <span class="keyword">const</span> std::string   &amp; SENDER_ACCT_ID,           <span class="comment">// Mandatory parameters.</span>
<a name="l04835"></a>04835     <span class="keyword">const</span> std::string   &amp; SENDER_USER_ID,           <span class="comment">// Both sender and recipient must sign before submitting.</span>
<a name="l04836"></a>04836     <span class="comment">// ----------------------------------------</span>
<a name="l04837"></a>04837     <span class="keyword">const</span> std::string   &amp; PLAN_CONSIDERATION,       <span class="comment">// Like a memo.</span>
<a name="l04838"></a>04838     <span class="comment">// ----------------------------------------</span>
<a name="l04839"></a>04839     <span class="keyword">const</span> std::string   &amp; RECIPIENT_ACCT_ID,        <span class="comment">// NOT optional.</span>
<a name="l04840"></a>04840     <span class="keyword">const</span> std::string   &amp; RECIPIENT_USER_ID,        <span class="comment">// Both sender and recipient must sign before submitting.</span>
<a name="l04841"></a>04841     <span class="comment">// -------------------------------</span>
<a name="l04842"></a>04842     <span class="keyword">const</span> int64_t       &amp; INITIAL_PAYMENT_AMOUNT,   <span class="comment">// zero or &quot;&quot; is no initial payment.</span>
<a name="l04843"></a>04843     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      &amp; INITIAL_PAYMENT_DELAY,    <span class="comment">// seconds from creation date. Default is zero or &quot;&quot;.</span>
<a name="l04844"></a>04844     <span class="comment">// ----------------------------------------</span>
<a name="l04845"></a>04845     <span class="keyword">const</span> int64_t       &amp; PAYMENT_PLAN_AMOUNT,      <span class="comment">// Zero or &quot;&quot; is no regular payments.</span>
<a name="l04846"></a>04846     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      &amp; PAYMENT_PLAN_DELAY,       <span class="comment">// No. of seconds from creation date. Default is zero or &quot;&quot;.</span>
<a name="l04847"></a>04847     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      &amp; PAYMENT_PLAN_PERIOD,      <span class="comment">// No. of seconds between payments. Default is zero or &quot;&quot;.</span>
<a name="l04848"></a>04848     <span class="comment">// ---------------------------------------</span>
<a name="l04849"></a>04849     <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      &amp; PAYMENT_PLAN_LENGTH,      <span class="comment">// In seconds. Defaults to 0 or &quot;&quot; (no maximum length.)</span>
<a name="l04850"></a>04850     <span class="keyword">const</span> int32_t       &amp; PAYMENT_PLAN_MAX_PAYMENTS <span class="comment">// Integer. Defaults to 0 or &quot;&quot; (no maximum payments.)</span>
<a name="l04851"></a>04851     )
<a name="l04852"></a>04852 {
<a name="l04853"></a>04853     <span class="keywordflow">if</span> (SERVER_ID.empty())              { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>                 ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04854"></a>04854     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_FROM)      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_FROM&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04855"></a>04855     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_TO)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_TO&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04856"></a>04856     <span class="keywordflow">if</span> (SENDER_ACCT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SENDER_ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04857"></a>04857     <span class="keywordflow">if</span> (SENDER_USER_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SENDER_USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04858"></a>04858     <span class="keywordflow">if</span> (PLAN_CONSIDERATION.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;PLAN_CONSIDERATION&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04859"></a>04859     <span class="keywordflow">if</span> (RECIPIENT_ACCT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_ACCT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04860"></a>04860     <span class="keywordflow">if</span> (RECIPIENT_USER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04861"></a>04861     <span class="keywordflow">if</span> (0 &gt; INITIAL_PAYMENT_AMOUNT)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;INITIAL_PAYMENT_AMOUNT&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04862"></a>04862     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; INITIAL_PAYMENT_DELAY)       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;INITIAL_PAYMENT_DELAY&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04863"></a>04863     <span class="keywordflow">if</span> (0 &gt; PAYMENT_PLAN_AMOUNT)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN_AMOUNT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04864"></a>04864     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; PAYMENT_PLAN_DELAY)          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN_DELAY&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04865"></a>04865     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; PAYMENT_PLAN_PERIOD)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN_PERIOD&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04866"></a>04866     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; PAYMENT_PLAN_LENGTH)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN_LENGTH&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04867"></a>04867     <span class="keywordflow">if</span> (0 &gt; PAYMENT_PLAN_MAX_PAYMENTS)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN_MAX_PAYMENTS&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04868"></a>04868     <span class="comment">// ---------------------------------------</span>
<a name="l04869"></a>04869     <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> * pPlan(<a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t_a_p_i___exec.html#a40f2d69da9c58ffe07517e2b5f22f125">ProposePaymentPlan</a>(
<a name="l04870"></a>04870         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>(SERVER_ID),
<a name="l04871"></a>04871         <span class="comment">// ----------------------------------------</span>
<a name="l04872"></a>04872         VALID_FROM,     <span class="comment">// Default (0) == NOW</span>
<a name="l04873"></a>04873         VALID_TO,       <span class="comment">// Default (0) == no expiry / cancel anytime</span>
<a name="l04874"></a>04874         <span class="comment">// ----------------------------------------</span>
<a name="l04875"></a>04875         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>(SENDER_ACCT_ID),
<a name="l04876"></a>04876         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>(SENDER_USER_ID),
<a name="l04877"></a>04877         <span class="comment">// ----------------------------------------</span>
<a name="l04878"></a>04878         PLAN_CONSIDERATION.empty() ? <span class="stringliteral">&quot;(Consideration for the agreement between the parties is meant to be recorded here.)&quot;</span> : PLAN_CONSIDERATION, <span class="comment">// Like a memo.</span>
<a name="l04879"></a>04879         <span class="comment">// ----------------------------------------</span>
<a name="l04880"></a>04880         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>(RECIPIENT_ACCT_ID),
<a name="l04881"></a>04881         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>(RECIPIENT_USER_ID),
<a name="l04882"></a>04882         <span class="comment">// ----------------------------------------</span>
<a name="l04883"></a>04883         <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(INITIAL_PAYMENT_AMOUNT),
<a name="l04884"></a>04884         INITIAL_PAYMENT_DELAY,
<a name="l04885"></a>04885         <span class="comment">// ----------------------------------------</span>
<a name="l04886"></a>04886         static_cast&lt;int64_t&gt;(PAYMENT_PLAN_AMOUNT),
<a name="l04887"></a>04887         PAYMENT_PLAN_DELAY,
<a name="l04888"></a>04888         PAYMENT_PLAN_PERIOD,
<a name="l04889"></a>04889         <span class="comment">// ----------------------------------------</span>
<a name="l04890"></a>04890         PAYMENT_PLAN_LENGTH,
<a name="l04891"></a>04891         <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(PAYMENT_PLAN_MAX_PAYMENTS)
<a name="l04892"></a>04892         ));
<a name="l04893"></a>04893     <span class="comment">// ---------------------------------------</span>
<a name="l04894"></a>04894     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPaymentPlan&gt;</a> theAngel(pPlan); <span class="comment">// Handles cleanup. (If necessary.)</span>
<a name="l04895"></a>04895     <span class="keywordflow">if</span> (NULL == pPlan)
<a name="l04896"></a>04896     {
<a name="l04897"></a>04897         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: failed in OTAPI_Exec::ProposePaymentPlan.\n&quot;</span>,__FUNCTION__);
<a name="l04898"></a>04898         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l04899"></a>04899     }
<a name="l04900"></a>04900     <span class="comment">// At this point, I know pPlan is good (and will be cleaned up automatically.)</span>
<a name="l04901"></a>04901     <span class="comment">// ---------------------------------------</span>
<a name="l04902"></a>04902     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pPlan); <span class="comment">// Extract the payment plan to string form.</span>
<a name="l04903"></a>04903     <span class="comment">// ---------------------------------------</span>
<a name="l04904"></a>04904     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l04905"></a>04905     <span class="keywordflow">return</span> pBuf;
<a name="l04906"></a>04906 }
<a name="l04907"></a>04907 
<a name="l04908"></a>04908 
<a name="l04909"></a>04909 
<a name="l04910"></a>04910 
<a name="l04911"></a>04911 
<a name="l04912"></a>04912 
<a name="l04913"></a>04913 <span class="comment">// TODO RESUME:</span>
<a name="l04914"></a>04914 <span class="comment">// 1. Find out what DiscardCheque is used for.</span>
<a name="l04915"></a>04915 <span class="comment">// 2. Make sure we don&#39;t need a &quot;Discard Payment Plan&quot; and &quot;Discard Smart Contract&quot; as well.</span>
<a name="l04916"></a>04916 <span class="comment">// 3. Add &quot;EasyProposePlan&quot; to the rest of the API like OTAPI_Basic</span>
<a name="l04917"></a>04917 <span class="comment">// 4. Add &#39;propose&#39; and &#39;confirm&#39; (for payment plan) commands to opentxs client.</span>
<a name="l04918"></a>04918 <span class="comment">// 5. Finish opentxs basket commands, so opentxs is COMPLETE.</span>
<a name="l04919"></a>04919 
<a name="l04920"></a>04920 
<a name="l04921"></a>04921 
<a name="l04922"></a>04922 
<a name="l04923"></a>04923 
<a name="l04924"></a>04924 
<a name="l04925"></a>04925 
<a name="l04926"></a>04926 
<a name="l04927"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab2c738f0be13d027426f81b8c4579280">04927</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab2c738f0be13d027426f81b8c4579280">OTAPI_Exec::EasyProposePlan</a>(
<a name="l04928"></a>04928     <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l04929"></a>04929     <span class="comment">// ----------------------------------------</span>
<a name="l04930"></a>04930     <span class="keyword">const</span> std::string &amp; DATE_RANGE,         <span class="comment">// &quot;from,to&quot;  Default &#39;from&#39; (0 or &quot;&quot;) == NOW, and default &#39;to&#39; (0 or &quot;&quot;) == no expiry / cancel anytime</span>
<a name="l04931"></a>04931     <span class="comment">// ----------------------------------------</span>
<a name="l04932"></a>04932     <span class="keyword">const</span> std::string &amp; SENDER_ACCT_ID,     <span class="comment">// Mandatory parameters.</span>
<a name="l04933"></a>04933     <span class="keyword">const</span> std::string &amp; SENDER_USER_ID,     <span class="comment">// Both sender and recipient must sign before submitting.</span>
<a name="l04934"></a>04934     <span class="comment">// ----------------------------------------</span>
<a name="l04935"></a>04935     <span class="keyword">const</span> std::string &amp; PLAN_CONSIDERATION, <span class="comment">// Like a memo.</span>
<a name="l04936"></a>04936     <span class="comment">// ----------------------------------------</span>
<a name="l04937"></a>04937     <span class="keyword">const</span> std::string &amp; RECIPIENT_ACCT_ID,  <span class="comment">// NOT optional.</span>
<a name="l04938"></a>04938     <span class="keyword">const</span> std::string &amp; RECIPIENT_USER_ID,  <span class="comment">// Both sender and recipient must sign before submitting.</span>
<a name="l04939"></a>04939     <span class="comment">// -------------------------------</span>
<a name="l04940"></a>04940     <span class="keyword">const</span> std::string &amp; INITIAL_PAYMENT,    <span class="comment">// &quot;amount,delay&quot;  Default &#39;amount&#39; (0 or &quot;&quot;) == no initial payment. Default &#39;delay&#39; (0 or NULL) is seconds from creation date.</span>
<a name="l04941"></a>04941     <span class="comment">// -------------------------------</span>
<a name="l04942"></a>04942     <span class="keyword">const</span> std::string &amp; PAYMENT_PLAN,       <span class="comment">// &quot;amount,delay,period&quot; &#39;amount&#39; is a recurring payment. &#39;delay&#39; and &#39;period&#39; cause 30 days if you pass 0 or &quot;&quot;.</span>
<a name="l04943"></a>04943     <span class="comment">// -------------------------------</span>
<a name="l04944"></a>04944     <span class="keyword">const</span> std::string &amp; PLAN_EXPIRY         <span class="comment">// &quot;length,number&quot; &#39;length&#39; is maximum lifetime in seconds. &#39;number&#39; is maximum number of payments in seconds. 0 or &quot;&quot; is unlimited.</span>
<a name="l04945"></a>04945     )
<a name="l04946"></a>04946 {
<a name="l04947"></a>04947     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04948"></a>04948     <span class="keywordflow">if</span> (SENDER_ACCT_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_ACCT_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04949"></a>04949     <span class="keywordflow">if</span> (SENDER_USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_USER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04950"></a>04950     <span class="keywordflow">if</span> (PLAN_CONSIDERATION.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PLAN_CONSIDERATION&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04951"></a>04951     <span class="keywordflow">if</span> (RECIPIENT_ACCT_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_ACCT_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04952"></a>04952     <span class="keywordflow">if</span> (RECIPIENT_USER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_USER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l04953"></a>04953     <span class="comment">// ----------------------------------------</span>
<a name="l04954"></a>04954     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  VALID_FROM                = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04955"></a>04955     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  VALID_TO                  = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04956"></a>04956     <span class="comment">// ----------------------------------------</span>
<a name="l04957"></a>04957     int64_t INITIAL_PAYMENT_AMOUNT      = 0;
<a name="l04958"></a>04958     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  INITIAL_PAYMENT_DELAY     = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04959"></a>04959     <span class="comment">// ----------------------------------------</span>
<a name="l04960"></a>04960     int64_t PAYMENT_PLAN_AMOUNT         = 0;
<a name="l04961"></a>04961     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  PAYMENT_PLAN_DELAY        = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04962"></a>04962     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  PAYMENT_PLAN_PERIOD       = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04963"></a>04963     <span class="comment">// ---------------------------------------</span>
<a name="l04964"></a>04964     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>  PAYMENT_PLAN_LENGTH       = <a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a>;
<a name="l04965"></a>04965     int32_t PAYMENT_PLAN_MAX_PAYMENTS   = 0;
<a name="l04966"></a>04966     <span class="comment">// ---------------------------------------</span>
<a name="l04967"></a>04967     <span class="keywordflow">if</span> (!DATE_RANGE.empty())
<a name="l04968"></a>04968     {
<a name="l04969"></a>04969         <a class="code" href="class_o_t_num_list.html">OTNumList</a>       theList;
<a name="l04970"></a>04970         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrNumList(DATE_RANGE);
<a name="l04971"></a>04971         <span class="comment">// ----------------------</span>
<a name="l04972"></a>04972         theList.Add(otstrNumList);
<a name="l04973"></a>04973         <span class="comment">// ----------------------</span>
<a name="l04974"></a>04974         <span class="comment">// VALID_FROM</span>
<a name="l04975"></a>04975         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l04976"></a>04976         {
<a name="l04977"></a>04977             int64_t lVal = 0;
<a name="l04978"></a>04978             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l04979"></a>04979                 VALID_FROM = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l04980"></a>04980             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l04981"></a>04981         }
<a name="l04982"></a>04982         <span class="comment">// ----------------------</span>
<a name="l04983"></a>04983         <span class="comment">// VALID_TO</span>
<a name="l04984"></a>04984         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l04985"></a>04985         {
<a name="l04986"></a>04986             int64_t lVal = 0;
<a name="l04987"></a>04987             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l04988"></a>04988                 VALID_TO = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l04989"></a>04989             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l04990"></a>04990         }
<a name="l04991"></a>04991     }
<a name="l04992"></a>04992     <span class="comment">// ---------------------------------------</span>
<a name="l04993"></a>04993     <span class="keywordflow">if</span> (!INITIAL_PAYMENT.empty())
<a name="l04994"></a>04994     {
<a name="l04995"></a>04995         <a class="code" href="class_o_t_num_list.html">OTNumList</a>       theList;
<a name="l04996"></a>04996         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrNumList(INITIAL_PAYMENT);
<a name="l04997"></a>04997         <span class="comment">// ----------------------</span>
<a name="l04998"></a>04998         theList.Add(otstrNumList);
<a name="l04999"></a>04999         <span class="comment">// ----------------------</span>
<a name="l05000"></a>05000         <span class="comment">// INITIAL_PAYMENT_AMOUNT</span>
<a name="l05001"></a>05001         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05002"></a>05002         {
<a name="l05003"></a>05003             int64_t lVal = 0;
<a name="l05004"></a>05004             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05005"></a>05005                 INITIAL_PAYMENT_AMOUNT = static_cast&lt;int64_t&gt;(lVal);
<a name="l05006"></a>05006             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05007"></a>05007         }
<a name="l05008"></a>05008         <span class="comment">// ----------------------</span>
<a name="l05009"></a>05009         <span class="comment">// INITIAL_PAYMENT_DELAY</span>
<a name="l05010"></a>05010         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05011"></a>05011         {
<a name="l05012"></a>05012             int64_t lVal = 0;
<a name="l05013"></a>05013             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05014"></a>05014                 INITIAL_PAYMENT_DELAY = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l05015"></a>05015             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05016"></a>05016         }
<a name="l05017"></a>05017     }
<a name="l05018"></a>05018     <span class="comment">// ---------------------------------------</span>
<a name="l05019"></a>05019     <span class="keywordflow">if</span> (!PAYMENT_PLAN.empty())
<a name="l05020"></a>05020     {
<a name="l05021"></a>05021         <a class="code" href="class_o_t_num_list.html">OTNumList</a>       theList;
<a name="l05022"></a>05022         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrNumList(PAYMENT_PLAN);
<a name="l05023"></a>05023         <span class="comment">// ----------------------</span>
<a name="l05024"></a>05024         theList.Add(otstrNumList);
<a name="l05025"></a>05025         <span class="comment">// ----------------------</span>
<a name="l05026"></a>05026         <span class="comment">// PAYMENT_PLAN_AMOUNT</span>
<a name="l05027"></a>05027         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05028"></a>05028         {
<a name="l05029"></a>05029             int64_t lVal = 0;
<a name="l05030"></a>05030             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05031"></a>05031                 PAYMENT_PLAN_AMOUNT = static_cast&lt;int64_t&gt;(lVal);
<a name="l05032"></a>05032             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05033"></a>05033         }
<a name="l05034"></a>05034         <span class="comment">// ----------------------</span>
<a name="l05035"></a>05035         <span class="comment">// PAYMENT_PLAN_DELAY</span>
<a name="l05036"></a>05036         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05037"></a>05037         {
<a name="l05038"></a>05038             int64_t lVal = 0;
<a name="l05039"></a>05039             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05040"></a>05040                 PAYMENT_PLAN_DELAY = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l05041"></a>05041             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05042"></a>05042         }
<a name="l05043"></a>05043         <span class="comment">// ----------------------</span>
<a name="l05044"></a>05044         <span class="comment">// PAYMENT_PLAN_PERIOD</span>
<a name="l05045"></a>05045         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05046"></a>05046         {
<a name="l05047"></a>05047             int64_t lVal = 0;
<a name="l05048"></a>05048             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05049"></a>05049                 PAYMENT_PLAN_PERIOD = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l05050"></a>05050             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05051"></a>05051         }
<a name="l05052"></a>05052     }
<a name="l05053"></a>05053     <span class="comment">// ---------------------------------------</span>
<a name="l05054"></a>05054     <span class="keywordflow">if</span> (!PLAN_EXPIRY.empty())
<a name="l05055"></a>05055     {
<a name="l05056"></a>05056         <a class="code" href="class_o_t_num_list.html">OTNumList</a>       theList;
<a name="l05057"></a>05057         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  otstrNumList(PLAN_EXPIRY);
<a name="l05058"></a>05058         <span class="comment">// ----------------------</span>
<a name="l05059"></a>05059         theList.Add(otstrNumList);
<a name="l05060"></a>05060         <span class="comment">// ----------------------</span>
<a name="l05061"></a>05061         <span class="comment">// PAYMENT_PLAN_LENGTH</span>
<a name="l05062"></a>05062         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05063"></a>05063         {
<a name="l05064"></a>05064             int64_t lVal = 0;
<a name="l05065"></a>05065             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05066"></a>05066                 PAYMENT_PLAN_LENGTH = <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(lVal);
<a name="l05067"></a>05067             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05068"></a>05068         }
<a name="l05069"></a>05069         <span class="comment">// ----------------------</span>
<a name="l05070"></a>05070         <span class="comment">// PAYMENT_PLAN_MAX_PAYMENTS</span>
<a name="l05071"></a>05071         <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#a5772668ef4da7be4d83eb7c7c90838de">Count</a>() &gt; 0)
<a name="l05072"></a>05072         {
<a name="l05073"></a>05073             int64_t lVal = 0;
<a name="l05074"></a>05074             <span class="keywordflow">if</span> (theList.<a class="code" href="class_o_t_num_list.html#afbd8f3863c5c8330c851d30220cea8b9">Peek</a>(lVal))
<a name="l05075"></a>05075                 PAYMENT_PLAN_MAX_PAYMENTS = static_cast&lt;int32_t&gt;(lVal);
<a name="l05076"></a>05076             theList.<a class="code" href="class_o_t_num_list.html#a86c3f5ed864c1a6996f05d6430512c3c">Pop</a>();
<a name="l05077"></a>05077         }
<a name="l05078"></a>05078     }
<a name="l05079"></a>05079     <span class="comment">// ---------------------------------------</span>
<a name="l05080"></a>05080     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#a40f2d69da9c58ffe07517e2b5f22f125">OTAPI_Exec::ProposePaymentPlan</a>(SERVER_ID,
<a name="l05081"></a>05081                                           VALID_FROM, VALID_TO,
<a name="l05082"></a>05082                                           SENDER_ACCT_ID,
<a name="l05083"></a>05083                                           SENDER_USER_ID,
<a name="l05084"></a>05084                                           PLAN_CONSIDERATION,
<a name="l05085"></a>05085                                           RECIPIENT_ACCT_ID,
<a name="l05086"></a>05086                                           RECIPIENT_USER_ID,
<a name="l05087"></a>05087                                           INITIAL_PAYMENT_AMOUNT, INITIAL_PAYMENT_DELAY,
<a name="l05088"></a>05088                                           PAYMENT_PLAN_AMOUNT,    PAYMENT_PLAN_DELAY,       PAYMENT_PLAN_PERIOD,
<a name="l05089"></a>05089                                           PAYMENT_PLAN_LENGTH,    PAYMENT_PLAN_MAX_PAYMENTS);
<a name="l05090"></a>05090 }
<a name="l05091"></a>05091 
<a name="l05092"></a>05092 
<a name="l05093"></a>05093 <span class="comment">// Called by CUSTOMER.</span>
<a name="l05094"></a>05094 <span class="comment">// &quot;PAYMENT_PLAN&quot; is the output of the above function (ProposePaymentPlan)</span>
<a name="l05095"></a>05095 <span class="comment">// Customer should call OTAPI_Exec::depositPaymentPlan after this.</span>
<a name="l05096"></a>05096 <span class="comment">//</span>
<a name="l05097"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4a5efc4a1f8c24300ae218fd0919cedd">05097</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4a5efc4a1f8c24300ae218fd0919cedd">OTAPI_Exec::ConfirmPaymentPlan</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l05098"></a>05098                                            <span class="keyword">const</span> std::string &amp; SENDER_USER_ID,
<a name="l05099"></a>05099                                            <span class="keyword">const</span> std::string &amp; SENDER_ACCT_ID,
<a name="l05100"></a>05100                                            <span class="keyword">const</span> std::string &amp; RECIPIENT_USER_ID,
<a name="l05101"></a>05101                                            <span class="keyword">const</span> std::string &amp; PAYMENT_PLAN)
<a name="l05102"></a>05102 {
<a name="l05103"></a>05103     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05104"></a>05104     <span class="keywordflow">if</span> (SENDER_ACCT_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_ACCT_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05105"></a>05105     <span class="keywordflow">if</span> (SENDER_USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SENDER_USER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05106"></a>05106     <span class="keywordflow">if</span> (RECIPIENT_USER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_USER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05107"></a>05107     <span class="keywordflow">if</span> (PAYMENT_PLAN.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PAYMENT_PLAN&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05108"></a>05108 
<a name="l05109"></a>05109     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l05110"></a>05110     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderUserID(SENDER_USER_ID);
<a name="l05111"></a>05111     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSenderAcctID(SENDER_ACCT_ID);
<a name="l05112"></a>05112     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theRecipientUserID(RECIPIENT_USER_ID);
<a name="l05113"></a>05113 
<a name="l05114"></a>05114     <a class="code" href="class_o_t_payment_plan.html">OTPaymentPlan</a> thePlan;
<a name="l05115"></a>05115     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strPlan(PAYMENT_PLAN);
<a name="l05116"></a>05116 
<a name="l05117"></a>05117     <span class="keywordflow">if</span> (!strPlan.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || (<span class="keyword">false</span> == thePlan.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPlan)))
<a name="l05118"></a>05118     {
<a name="l05119"></a>05119         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading payment plan from string.\n&quot;</span>,__FUNCTION__);
<a name="l05120"></a>05120         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05121"></a>05121     }
<a name="l05122"></a>05122     <span class="comment">// --------------------------------------</span>
<a name="l05123"></a>05123     <span class="keywordtype">bool</span> bConfirmed = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afe54d89f1f94b05bb2ecaffe9a02e1f4">ConfirmPaymentPlan</a>(theServerID,
<a name="l05124"></a>05124         theSenderUserID,
<a name="l05125"></a>05125         theSenderAcctID,
<a name="l05126"></a>05126         theRecipientUserID,
<a name="l05127"></a>05127         thePlan);
<a name="l05128"></a>05128     <span class="keywordflow">if</span> (<span class="keyword">false</span> == bConfirmed)
<a name="l05129"></a>05129     {
<a name="l05130"></a>05130         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: failed in OTAPI_Exec::ConfirmPaymentPlan().\n&quot;</span>,__FUNCTION__);
<a name="l05131"></a>05131         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05132"></a>05132     }
<a name="l05133"></a>05133 
<a name="l05134"></a>05134     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(thePlan); <span class="comment">// Extract the payment plan to string form.</span>
<a name="l05135"></a>05135 
<a name="l05136"></a>05136     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05137"></a>05137 
<a name="l05138"></a>05138     <span class="keywordflow">return</span> pBuf;
<a name="l05139"></a>05139 }
<a name="l05140"></a>05140 
<a name="l05141"></a>05141 
<a name="l05142"></a>05142 
<a name="l05143"></a>05143 
<a name="l05144"></a>05144 <span class="comment">// RETURNS:  the Smart Contract itself. (Or &quot;&quot;.)</span>
<a name="l05145"></a>05145 <span class="comment">//</span>
<a name="l05146"></a><a class="code" href="class_o_t_a_p_i___exec.html#a579170e034d1666d83c17dd314c0c3d1">05146</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a579170e034d1666d83c17dd314c0c3d1">OTAPI_Exec::Create_SmartContract</a>(<span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05147"></a>05147                                              <span class="comment">// ----------------------------------------</span>
<a name="l05148"></a>05148                                              <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp; VALID_FROM,   <span class="comment">// Default (0 or &quot;&quot;) == NOW</span>
<a name="l05149"></a>05149                                              <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> &amp; VALID_TO) <span class="comment">// Default (0 or &quot;&quot;) == no expiry / cancel anytime</span>
<a name="l05150"></a>05150 {
<a name="l05151"></a>05151     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05152"></a>05152     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_FROM) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_FROM&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05153"></a>05153     <span class="keywordflow">if</span> (<a class="code" href="_o_t_common_8hpp.html#af4ca9fa2c7c290d647dd18de0a9ac25f">OT_TIME_ZERO</a> &gt; VALID_TO)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VALID_TO&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05154"></a>05154     <span class="comment">// -----------------------------------------------------</span>
<a name="l05155"></a>05155     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerNymID(SIGNER_NYM_ID);
<a name="l05156"></a>05156     <span class="comment">// -----------------------------------------------------</span>
<a name="l05157"></a>05157     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidFrom = VALID_FROM;
<a name="l05158"></a>05158     <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> tValidTo   = VALID_TO;
<a name="l05159"></a>05159     <span class="comment">// --------------------------------------</span>
<a name="l05160"></a>05160     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05161"></a>05161 
<a name="l05162"></a>05162     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bCreated = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acdcf4e8ee01eb5684ad276a9f2f96ad6">Create_SmartContract</a>(theSignerNymID,
<a name="l05163"></a>05163                                                                       tValidFrom,   <span class="comment">// Default (0 or &quot;&quot;) == NOW</span>
<a name="l05164"></a>05164                                                                       tValidTo,     <span class="comment">// Default (0 or &quot;&quot;) == no expiry / cancel anytime</span>
<a name="l05165"></a>05165                                                                       strOutput);
<a name="l05166"></a>05166     <span class="keywordflow">if</span> (!bCreated || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05167"></a>05167         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05168"></a>05168     <span class="comment">// -----------------------------------------------------</span>
<a name="l05169"></a>05169     <span class="comment">// Success!</span>
<a name="l05170"></a>05170     <span class="comment">//</span>
<a name="l05171"></a>05171     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05172"></a>05172     <span class="keywordflow">return</span> pBuf;
<a name="l05173"></a>05173 }
<a name="l05174"></a>05174 <span class="comment">// ----------------------------------------</span>
<a name="l05175"></a>05175 
<a name="l05176"></a>05176 
<a name="l05177"></a>05177 
<a name="l05178"></a>05178 
<a name="l05179"></a>05179 
<a name="l05180"></a>05180 
<a name="l05181"></a>05181 <span class="comment">//</span>
<a name="l05182"></a>05182 <span class="comment">// todo: Someday add a parameter here BYLAW_LANGUAGE so that people can use</span>
<a name="l05183"></a>05183 <span class="comment">// custom languages in their scripts.  For now I have a default language, so</span>
<a name="l05184"></a>05184 <span class="comment">// I&#39;ll just make that the default. (There&#39;s only one language right now anyway.)</span>
<a name="l05185"></a>05185 <span class="comment">//</span>
<a name="l05186"></a>05186 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05187"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9757000f80a55ac82268036dc50dc01c">05187</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a9757000f80a55ac82268036dc50dc01c">OTAPI_Exec::SmartContract_AddBylaw</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,    <span class="comment">// The contract, about to have the bylaw added to it.</span>
<a name="l05188"></a>05188                                                <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,   <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05189"></a>05189                                                <span class="comment">// ----------------------------------------</span>
<a name="l05190"></a>05190                                                <span class="keyword">const</span> std::string &amp; BYLAW_NAME)  <span class="comment">// The Bylaw&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05191"></a>05191 {
<a name="l05192"></a>05192     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05193"></a>05193     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05194"></a>05194     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05195"></a>05195     <span class="comment">// -----------------------------------------------------</span>
<a name="l05196"></a>05196     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT), strBylawName(BYLAW_NAME);
<a name="l05197"></a>05197     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l05198"></a>05198     <span class="comment">// -----------------------------------------------------</span>
<a name="l05199"></a>05199     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05200"></a>05200 
<a name="l05201"></a>05201     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a68be6928764334d775d466f0e4725d72">SmartContract_AddBylaw</a>(strContract,      <span class="comment">// The contract, about to have the bylaw added to it.</span>
<a name="l05202"></a>05202         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05203"></a>05203         strBylawName,       <span class="comment">// The Bylaw&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05204"></a>05204         strOutput);
<a name="l05205"></a>05205     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05206"></a>05206         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05207"></a>05207     <span class="comment">// -----------------------------------------------------</span>
<a name="l05208"></a>05208     <span class="comment">// Success!</span>
<a name="l05209"></a>05209     <span class="comment">//</span>
<a name="l05210"></a>05210     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05211"></a>05211 
<a name="l05212"></a>05212     <span class="keywordflow">return</span> pBuf;
<a name="l05213"></a>05213 }
<a name="l05214"></a>05214 
<a name="l05215"></a>05215 
<a name="l05216"></a>05216 
<a name="l05217"></a>05217 
<a name="l05218"></a>05218 
<a name="l05219"></a>05219 
<a name="l05220"></a>05220 
<a name="l05221"></a>05221 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05222"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac74dd9091ee7eb88601e88df9efde414">05222</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ac74dd9091ee7eb88601e88df9efde414">OTAPI_Exec::SmartContract_AddClause</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,   <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05223"></a>05223                                             <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,  <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05224"></a>05224                                             <span class="comment">// ----------------------------------------</span>
<a name="l05225"></a>05225                                             <span class="keyword">const</span> std::string &amp; BYLAW_NAME, <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05226"></a>05226                                             <span class="comment">// ----------------------------------------</span>
<a name="l05227"></a>05227                                             <span class="keyword">const</span> std::string &amp; CLAUSE_NAME,    <span class="comment">// The Clause&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05228"></a>05228                                             <span class="keyword">const</span> std::string &amp; SOURCE_CODE)    <span class="comment">// The actual source code for the clause.</span>
<a name="l05229"></a>05229 {
<a name="l05230"></a>05230     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05231"></a>05231     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05232"></a>05232     <span class="keywordflow">if</span> (BYLAW_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05233"></a>05233     <span class="keywordflow">if</span> (CLAUSE_NAME.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CLAUSE_NAME&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05234"></a>05234     <span class="keywordflow">if</span> (SOURCE_CODE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SOURCE_CODE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05235"></a>05235 
<a name="l05236"></a>05236     <span class="comment">// -----------------------------------------------------</span>
<a name="l05237"></a>05237     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strBylawName(BYLAW_NAME),
<a name="l05238"></a>05238         strClauseName(CLAUSE_NAME), strSourceCode(SOURCE_CODE);
<a name="l05239"></a>05239     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l05240"></a>05240     <span class="comment">// -----------------------------------------------------</span>
<a name="l05241"></a>05241     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05242"></a>05242 
<a name="l05243"></a>05243     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a495e1b59fcfedf265a853665c7e2f73c">SmartContract_AddClause</a>(strContract, <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05244"></a>05244         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05245"></a>05245         <span class="comment">// ----------------------------------------</span>
<a name="l05246"></a>05246         strBylawName,   <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05247"></a>05247         <span class="comment">// ----------------------------------------</span>
<a name="l05248"></a>05248         strClauseName,  <span class="comment">// The Clause&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05249"></a>05249         strSourceCode,  <span class="comment">// The actual source code for the clause.</span>
<a name="l05250"></a>05250         strOutput);
<a name="l05251"></a>05251     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05252"></a>05252         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05253"></a>05253     <span class="comment">// -----------------------------------------------------</span>
<a name="l05254"></a>05254     <span class="comment">// Success!</span>
<a name="l05255"></a>05255     <span class="comment">//</span>
<a name="l05256"></a>05256     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05257"></a>05257 
<a name="l05258"></a>05258 
<a name="l05259"></a>05259 
<a name="l05260"></a>05260     <span class="keywordflow">return</span> pBuf;
<a name="l05261"></a>05261 }
<a name="l05262"></a>05262 
<a name="l05263"></a>05263 
<a name="l05264"></a>05264 
<a name="l05265"></a>05265 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05266"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac5f3dd89fb7ec6869d67374ef05457ad">05266</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ac5f3dd89fb7ec6869d67374ef05457ad">OTAPI_Exec::SmartContract_AddVariable</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The contract, about to have the variable added to it.</span>
<a name="l05267"></a>05267                                              <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05268"></a>05268                                               <span class="comment">// ----------------------------------------</span>
<a name="l05269"></a>05269                                              <span class="keyword">const</span> std::string &amp; BYLAW_NAME,    <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05270"></a>05270                                               <span class="comment">// ----------------------------------------</span>
<a name="l05271"></a>05271                                              <span class="keyword">const</span> std::string &amp; VAR_NAME,  <span class="comment">// The Variable&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05272"></a>05272                                              <span class="keyword">const</span> std::string &amp; VAR_ACCESS,    <span class="comment">// &quot;constant&quot;, &quot;persistent&quot;, or &quot;important&quot;.</span>
<a name="l05273"></a>05273                                              <span class="keyword">const</span> std::string &amp; VAR_TYPE,  <span class="comment">// &quot;string&quot;, &quot;int64_t&quot;, or &quot;bool&quot;</span>
<a name="l05274"></a>05274                                              <span class="keyword">const</span> std::string &amp; VAR_VALUE) <span class="comment">// Contains a string. If type is int64_t, StringToLong() will be used to convert value to a int64_t. If type is bool, the strings &quot;true&quot; or &quot;false&quot; are expected here in order to convert to a bool.</span>
<a name="l05275"></a>05275 {
<a name="l05276"></a>05276     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05277"></a>05277     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05278"></a>05278     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05279"></a>05279     <span class="keywordflow">if</span> (VAR_NAME.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VAR_NAME&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05280"></a>05280     <span class="keywordflow">if</span> (VAR_ACCESS.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VAR_ACCESS&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05281"></a>05281     <span class="keywordflow">if</span> (VAR_TYPE.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VAR_TYPE&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05282"></a>05282 <span class="comment">//  if (VAR_VALUE.empty())     { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;VAR_VALUE&quot;     ); OT_FAIL; }</span>
<a name="l05283"></a>05283     <span class="comment">// -----------------------------------------------------</span>
<a name="l05284"></a>05284     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strBylawName(BYLAW_NAME),
<a name="l05285"></a>05285                         strVarName(VAR_NAME),       strVarAccess(VAR_ACCESS),
<a name="l05286"></a>05286                         strVarType(VAR_TYPE),       strVarValue(VAR_VALUE);
<a name="l05287"></a>05287     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID);
<a name="l05288"></a>05288     <span class="comment">// -----------------------------------------------------</span>
<a name="l05289"></a>05289     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05290"></a>05290 
<a name="l05291"></a>05291     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a561b64935144d650a1790b614a593be8">SmartContract_AddVariable</a>(strContract,       <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05292"></a>05292         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05293"></a>05293         <span class="comment">// ----------------------------------------</span>
<a name="l05294"></a>05294         strBylawName,   <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05295"></a>05295         <span class="comment">// ----------------------------------------</span>
<a name="l05296"></a>05296         strVarName,     <span class="comment">// The Variable&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05297"></a>05297         strVarAccess,   <span class="comment">// &quot;constant&quot;, &quot;persistent&quot;, or &quot;important&quot;.</span>
<a name="l05298"></a>05298         strVarType,     <span class="comment">// &quot;string&quot;, &quot;int64_t&quot;, or &quot;bool&quot;</span>
<a name="l05299"></a>05299         strVarValue,        <span class="comment">// Contains a string. If type is int64_t, StringToLong() will be used to convert value to a int64_t. If type is bool, the strings &quot;true&quot; or &quot;false&quot; are expected here in order to convert to a bool.</span>
<a name="l05300"></a>05300         <span class="comment">// ----------------------------------------</span>
<a name="l05301"></a>05301         strOutput);
<a name="l05302"></a>05302     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05303"></a>05303         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05304"></a>05304     <span class="comment">// -----------------------------------------------------</span>
<a name="l05305"></a>05305     <span class="comment">// Success!</span>
<a name="l05306"></a>05306     <span class="comment">//</span>
<a name="l05307"></a>05307     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05308"></a>05308     <span class="keywordflow">return</span> pBuf;
<a name="l05309"></a>05309 }
<a name="l05310"></a>05310 
<a name="l05311"></a>05311 
<a name="l05312"></a>05312 
<a name="l05313"></a>05313 
<a name="l05314"></a>05314 
<a name="l05315"></a>05315 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05316"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa61e5835f6d10923e42800f2e1dc09bf">05316</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa61e5835f6d10923e42800f2e1dc09bf">OTAPI_Exec::SmartContract_AddCallback</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The contract, about to have the callback added to it.</span>
<a name="l05317"></a>05317                                              <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05318"></a>05318                                               <span class="comment">// ----------------------------------------</span>
<a name="l05319"></a>05319                                              <span class="keyword">const</span> std::string &amp; BYLAW_NAME,    <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05320"></a>05320                                               <span class="comment">// ----------------------------------------</span>
<a name="l05321"></a>05321                                              <span class="keyword">const</span> std::string &amp; CALLBACK_NAME, <span class="comment">// The Callback&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05322"></a>05322                                              <span class="keyword">const</span> std::string &amp; CLAUSE_NAME)   <span class="comment">// The actual clause that will be triggered by the callback. (Must exist.)</span>
<a name="l05323"></a>05323 {
<a name="l05324"></a>05324     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05325"></a>05325     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05326"></a>05326     <span class="keywordflow">if</span> (BYLAW_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05327"></a>05327     <span class="keywordflow">if</span> (CALLBACK_NAME.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CALLBACK_NAME&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05328"></a>05328     <span class="keywordflow">if</span> (CLAUSE_NAME.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CLAUSE_NAME&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05329"></a>05329 
<a name="l05330"></a>05330     <span class="comment">// -----------------------------------------------------</span>
<a name="l05331"></a>05331     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strBylawName(BYLAW_NAME),
<a name="l05332"></a>05332         strCallbackName(CALLBACK_NAME), strClauseName(CLAUSE_NAME);
<a name="l05333"></a>05333     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerNymID(SIGNER_NYM_ID);
<a name="l05334"></a>05334     <span class="comment">// -----------------------------------------------------</span>
<a name="l05335"></a>05335     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05336"></a>05336 
<a name="l05337"></a>05337     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acb0a85ed4e9125dea813ba87e2e9ecf8">SmartContract_AddCallback</a>(strContract,       <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05338"></a>05338         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05339"></a>05339         <span class="comment">// ----------------------------------------</span>
<a name="l05340"></a>05340         strBylawName,   <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05341"></a>05341         <span class="comment">// ----------------------------------------</span>
<a name="l05342"></a>05342         strCallbackName,    <span class="comment">// The Callback&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05343"></a>05343         strClauseName,  <span class="comment">// The actual clause that will be triggered by the callback. (Must exist.)</span>
<a name="l05344"></a>05344         strOutput);
<a name="l05345"></a>05345     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05346"></a>05346         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05347"></a>05347     <span class="comment">// -----------------------------------------------------</span>
<a name="l05348"></a>05348     <span class="comment">// Success!</span>
<a name="l05349"></a>05349     <span class="comment">//</span>
<a name="l05350"></a>05350     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05351"></a>05351 
<a name="l05352"></a>05352 
<a name="l05353"></a>05353 
<a name="l05354"></a>05354     <span class="keywordflow">return</span> pBuf;
<a name="l05355"></a>05355 }
<a name="l05356"></a>05356 
<a name="l05357"></a>05357 
<a name="l05358"></a>05358 
<a name="l05359"></a>05359 
<a name="l05360"></a>05360 
<a name="l05361"></a>05361 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05362"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7abd80748cf7bba19b3f6edeb4a20f61">05362</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a7abd80748cf7bba19b3f6edeb4a20f61">OTAPI_Exec::SmartContract_AddHook</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The contract, about to have the hook added to it.</span>
<a name="l05363"></a>05363                                          <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05364"></a>05364                                           <span class="comment">// ----------------------------------------</span>
<a name="l05365"></a>05365                                          <span class="keyword">const</span> std::string &amp; BYLAW_NAME,        <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05366"></a>05366                                           <span class="comment">// ----------------------------------------</span>
<a name="l05367"></a>05367                                          <span class="keyword">const</span> std::string &amp; HOOK_NAME,     <span class="comment">// The Hook&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05368"></a>05368                                          <span class="keyword">const</span> std::string &amp; CLAUSE_NAME)       <span class="comment">// The actual clause that will be triggered by the hook. (You can call this multiple times, and have multiple clauses trigger on the same hook.)</span>
<a name="l05369"></a>05369 {
<a name="l05370"></a>05370     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05371"></a>05371     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05372"></a>05372     <span class="keywordflow">if</span> (BYLAW_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05373"></a>05373     <span class="keywordflow">if</span> (HOOK_NAME.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;HOOK_NAME&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05374"></a>05374     <span class="keywordflow">if</span> (CLAUSE_NAME.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CLAUSE_NAME&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05375"></a>05375 
<a name="l05376"></a>05376     <span class="comment">// -----------------------------------------------------</span>
<a name="l05377"></a>05377     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strBylawName(BYLAW_NAME),
<a name="l05378"></a>05378         strHookName(HOOK_NAME),     strClauseName(CLAUSE_NAME);
<a name="l05379"></a>05379     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerNymID(SIGNER_NYM_ID);
<a name="l05380"></a>05380     <span class="comment">// -----------------------------------------------------</span>
<a name="l05381"></a>05381     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05382"></a>05382 
<a name="l05383"></a>05383     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae4c6e55f20c7609a2a6b774505483bab">SmartContract_AddHook</a>(strContract,       <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05384"></a>05384         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05385"></a>05385         <span class="comment">// ----------------------------------------</span>
<a name="l05386"></a>05386         strBylawName,   <span class="comment">// Should already be on the contract. (This way we can find it.)</span>
<a name="l05387"></a>05387         <span class="comment">// ----------------------------------------</span>
<a name="l05388"></a>05388         strHookName,        <span class="comment">// The Hook&#39;s name as referenced in the smart contract. (And the scripts...)</span>
<a name="l05389"></a>05389         strClauseName,  <span class="comment">// The actual clause that will be triggered by the hook. (You can call this multiple times, and have multiple clauses trigger on the same hook.)</span>
<a name="l05390"></a>05390         strOutput);
<a name="l05391"></a>05391     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05392"></a>05392         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05393"></a>05393     <span class="comment">// -----------------------------------------------------</span>
<a name="l05394"></a>05394     <span class="comment">// Success!</span>
<a name="l05395"></a>05395     <span class="comment">//</span>
<a name="l05396"></a>05396     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05397"></a>05397 
<a name="l05398"></a>05398 
<a name="l05399"></a>05399 
<a name="l05400"></a>05400     <span class="keywordflow">return</span> pBuf;
<a name="l05401"></a>05401 }
<a name="l05402"></a>05402 
<a name="l05403"></a>05403 
<a name="l05404"></a>05404 
<a name="l05405"></a>05405 <span class="comment">// --------------------------------------------------------------</span>
<a name="l05406"></a>05406 
<a name="l05407"></a>05407 
<a name="l05408"></a>05408 
<a name="l05409"></a>05409 <span class="comment">// RETURNS: Updated version of THE_CONTRACT. (Or &quot;&quot;.)</span>
<a name="l05410"></a><a class="code" href="class_o_t_a_p_i___exec.html#a286cb092b658e466d02282075858aadd">05410</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a286cb092b658e466d02282075858aadd">OTAPI_Exec::SmartContract_AddParty</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The contract, about to have the party added to it.</span>
<a name="l05411"></a>05411                                           <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,     <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05412"></a>05412                                            <span class="comment">// ----------------------------------------</span>
<a name="l05413"></a>05413                                           <span class="keyword">const</span> std::string &amp; PARTY_NAME,        <span class="comment">// The Party&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05414"></a>05414                                            <span class="comment">// ----------------------------------------</span>
<a name="l05415"></a>05415                                           <span class="keyword">const</span> std::string &amp; AGENT_NAME)        <span class="comment">// An AGENT will be added by default for this party. Need Agent NAME.</span>
<a name="l05416"></a>05416                                            <span class="comment">// (FYI, that is basically the only option, until I code Entities and Roles. Until then, a party can ONLY be</span>
<a name="l05417"></a>05417                                            <span class="comment">// a Nym, with himself as the agent representing that same party. Nym ID is supplied on ConfirmParty() below.)</span>
<a name="l05418"></a>05418 {
<a name="l05419"></a>05419     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05420"></a>05420     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05421"></a>05421     <span class="keywordflow">if</span> (PARTY_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05422"></a>05422     <span class="keywordflow">if</span> (AGENT_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AGENT_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05423"></a>05423     <span class="comment">// -----------------------------------------------------</span>
<a name="l05424"></a>05424     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strPartyName(PARTY_NAME),
<a name="l05425"></a>05425         strAgentName(AGENT_NAME);
<a name="l05426"></a>05426     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerNymID(SIGNER_NYM_ID);
<a name="l05427"></a>05427     <span class="comment">// -----------------------------------------------------</span>
<a name="l05428"></a>05428     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05429"></a>05429 
<a name="l05430"></a>05430     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a357d0c597723cd9b03bb77b8636ec1ca">SmartContract_AddParty</a>(strContract,      <span class="comment">// The contract, about to have the bylaw added to it.</span>
<a name="l05431"></a>05431         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05432"></a>05432         <span class="comment">// ----------------------------------------</span>
<a name="l05433"></a>05433         strPartyName,       <span class="comment">// The Party&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05434"></a>05434         strAgentName,       <span class="comment">// An AGENT will be added by default for this party. Need Agent NAME.</span>
<a name="l05435"></a>05435         strOutput);
<a name="l05436"></a>05436     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05437"></a>05437         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05438"></a>05438     <span class="comment">// -----------------------------------------------------</span>
<a name="l05439"></a>05439     <span class="comment">// Success!</span>
<a name="l05440"></a>05440     <span class="comment">//</span>
<a name="l05441"></a>05441     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05442"></a>05442     <span class="keywordflow">return</span> pBuf;
<a name="l05443"></a>05443 }
<a name="l05444"></a>05444 
<a name="l05445"></a>05445 
<a name="l05446"></a>05446 
<a name="l05447"></a>05447 
<a name="l05448"></a>05448 <span class="comment">// ----------------------------------------</span>
<a name="l05449"></a>05449 
<a name="l05450"></a>05450 
<a name="l05451"></a>05451 
<a name="l05452"></a>05452 <span class="comment">// Used when creating a theoretical smart contract (that could be used over and over again with different parties.)</span>
<a name="l05453"></a>05453 <span class="comment">//</span>
<a name="l05454"></a>05454 <span class="comment">// returns: the updated smart contract (or &quot;&quot;)</span>
<a name="l05455"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2a052a570cd5fcaef7b58aebb895096f">05455</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2a052a570cd5fcaef7b58aebb895096f">OTAPI_Exec::SmartContract_AddAccount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,      <span class="comment">// The contract, about to have the account added to it.</span>
<a name="l05456"></a>05456                                             <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,  <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05457"></a>05457                                              <span class="comment">// ----------------------------------------</span>
<a name="l05458"></a>05458                                             <span class="keyword">const</span> std::string &amp; PARTY_NAME,     <span class="comment">// The Party&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05459"></a>05459                                              <span class="comment">// ----------------------------------------</span>
<a name="l05460"></a>05460                                             <span class="keyword">const</span> std::string &amp; ACCT_NAME,      <span class="comment">// The Account&#39;s name as referenced in the smart contract</span>
<a name="l05461"></a>05461                                             <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID)  <span class="comment">// Asset Type ID for the Account.</span>
<a name="l05462"></a>05462 {
<a name="l05463"></a>05463     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05464"></a>05464     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05465"></a>05465     <span class="keywordflow">if</span> (PARTY_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05466"></a>05466     <span class="keywordflow">if</span> (ACCT_NAME.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NAME&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05467"></a>05467 <span class="comment">//  if (ASSET_TYPE_ID.empty())      { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;ASSET_TYPE_ID&quot;      ); OT_FAIL; }</span>
<a name="l05468"></a>05468 
<a name="l05469"></a>05469     <span class="comment">// -----------------------------------------------------</span>
<a name="l05470"></a>05470     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT),  strPartyName(PARTY_NAME),
<a name="l05471"></a>05471         strAcctName(ACCT_NAME),     strAssetTypeID(ASSET_TYPE_ID);
<a name="l05472"></a>05472     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerNymID(SIGNER_NYM_ID);
<a name="l05473"></a>05473     <span class="comment">// -----------------------------------------------------</span>
<a name="l05474"></a>05474     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05475"></a>05475 
<a name="l05476"></a>05476     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a47bbd248e72e8d45609a5365f7fa5187">SmartContract_AddAccount</a>(strContract,        <span class="comment">// The contract, about to have the clause added to it.</span>
<a name="l05477"></a>05477         theSignerNymID, <span class="comment">// Use any Nym you wish here. (The signing at this point32_t is only to cause a save.)</span>
<a name="l05478"></a>05478         <span class="comment">// ----------------------------------------</span>
<a name="l05479"></a>05479         strPartyName,       <span class="comment">// The Party&#39;s NAME as referenced in the smart contract. (And the scripts...)</span>
<a name="l05480"></a>05480         <span class="comment">// ----------------------------------------</span>
<a name="l05481"></a>05481         strAcctName,        <span class="comment">// The Account&#39;s name as referenced in the smart contract</span>
<a name="l05482"></a>05482         strAssetTypeID, <span class="comment">// Asset Type ID for the Account.</span>
<a name="l05483"></a>05483         strOutput);
<a name="l05484"></a>05484     <span class="keywordflow">if</span> (!bAdded || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05485"></a>05485         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05486"></a>05486     <span class="comment">// -----------------------------------------------------</span>
<a name="l05487"></a>05487     <span class="comment">// Success!</span>
<a name="l05488"></a>05488     <span class="comment">//</span>
<a name="l05489"></a>05489     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05490"></a>05490 
<a name="l05491"></a>05491 
<a name="l05492"></a>05492 
<a name="l05493"></a>05493     <span class="keywordflow">return</span> pBuf;
<a name="l05494"></a>05494 }
<a name="l05495"></a>05495 
<a name="l05496"></a>05496 
<a name="l05497"></a>05497 
<a name="l05498"></a>05498 
<a name="l05499"></a>05499 
<a name="l05500"></a>05500 <span class="comment">// This function returns the count of how many trans#s a Nym needs in order to confirm as</span>
<a name="l05501"></a>05501 <span class="comment">// a specific agent for a contract. (An opening number is needed for every party of which</span>
<a name="l05502"></a>05502 <span class="comment">// agent is the authorizing agent, plus a closing number for every acct of which agent is the</span>
<a name="l05503"></a>05503 <span class="comment">// authorized agent.)</span>
<a name="l05504"></a>05504 <span class="comment">//</span>
<a name="l05505"></a>05505 <span class="comment">// Otherwise a Nym might try to confirm a smart contract and be unable to, since he doesn&#39;t</span>
<a name="l05506"></a>05506 <span class="comment">// have enough transaction numbers, yet he would have no way of finding out HOW MANY HE *DOES*</span>
<a name="l05507"></a>05507 <span class="comment">// NEED. This function allows him to find out, before confirmation, so he can first grab however</span>
<a name="l05508"></a>05508 <span class="comment">// many transaction#s he will need in order to confirm this smart contract.</span>
<a name="l05509"></a>05509 <span class="comment">//</span>
<a name="l05510"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3007ed01f5915c23604c987b9d9ba30d">05510</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a3007ed01f5915c23604c987b9d9ba30d">OTAPI_Exec::SmartContract_CountNumsNeeded</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The smart contract, about to be queried by this function.</span>
<a name="l05511"></a>05511                                         <span class="keyword">const</span> std::string &amp; AGENT_NAME)
<a name="l05512"></a>05512 {
<a name="l05513"></a>05513     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05514"></a>05514     <span class="keywordflow">if</span> (AGENT_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AGENT_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05515"></a>05515     <span class="comment">// -------------------------------------------------------------</span>
<a name="l05516"></a>05516     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT), strAgentName(AGENT_NAME);
<a name="l05517"></a>05517     <span class="comment">// -------------------------------------------------------------</span>
<a name="l05518"></a>05518     <span class="comment">//</span>
<a name="l05519"></a>05519     <span class="keyword">const</span> int32_t &amp; nCount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae9ebf14defb8aa50c6c40a1b20fbe20d">SmartContract_CountNumsNeeded</a>(strContract, strAgentName);
<a name="l05520"></a>05520 
<a name="l05521"></a>05521     <span class="keywordflow">return</span> nCount;
<a name="l05522"></a>05522 }
<a name="l05523"></a>05523 
<a name="l05524"></a>05524 <span class="comment">// ----------------------------------------</span>
<a name="l05525"></a>05525 
<a name="l05526"></a>05526 <span class="comment">// Used when taking a theoretical smart contract, and setting it up to use specific Nyms and accounts.</span>
<a name="l05527"></a>05527 <span class="comment">// This function sets the ACCT ID and the AGENT NAME for the acct specified by party name and acct name.</span>
<a name="l05528"></a>05528 <span class="comment">// Returns the updated smart contract (or &quot;&quot;.)</span>
<a name="l05529"></a>05529 <span class="comment">//</span>
<a name="l05530"></a><a class="code" href="class_o_t_a_p_i___exec.html#a633214d91a3563d6ea8ba0412a60d9e1">05530</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a633214d91a3563d6ea8ba0412a60d9e1">OTAPI_Exec::SmartContract_ConfirmAccount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05531"></a>05531                                                      <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,
<a name="l05532"></a>05532                                                      <span class="comment">// ----------------------------------------</span>
<a name="l05533"></a>05533                                                      <span class="keyword">const</span> std::string &amp; PARTY_NAME,    <span class="comment">// Should already be on the contract.</span>
<a name="l05534"></a>05534                                                      <span class="keyword">const</span> std::string &amp; ACCT_NAME,     <span class="comment">// Should already be on the contract.</span>
<a name="l05535"></a>05535                                                      <span class="comment">// ----------------------------------------</span>
<a name="l05536"></a>05536                                                      <span class="keyword">const</span> std::string &amp; AGENT_NAME,    <span class="comment">// The agent name for this asset account.</span>
<a name="l05537"></a>05537                                                      <span class="keyword">const</span> std::string &amp; ACCT_ID)       <span class="comment">// AcctID for the asset account. (For acct_name).</span>
<a name="l05538"></a>05538 {
<a name="l05539"></a>05539     <span class="keywordflow">if</span> (THE_CONTRACT.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05540"></a>05540     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05541"></a>05541     <span class="keywordflow">if</span> (PARTY_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05542"></a>05542     <span class="keywordflow">if</span> (ACCT_NAME.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NAME&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05543"></a>05543     <span class="keywordflow">if</span> (AGENT_NAME.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AGENT_NAME&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05544"></a>05544     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05545"></a>05545     <span class="comment">// -----------------------------------------------------</span>
<a name="l05546"></a>05546     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT), strPartyName(PARTY_NAME);
<a name="l05547"></a>05547     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strAccountID(ACCT_ID), strAcctName(ACCT_NAME), strAgentName(AGENT_NAME);
<a name="l05548"></a>05548     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theSignerNymID(SIGNER_NYM_ID), theAcctID(strAccountID);
<a name="l05549"></a>05549     <span class="comment">// -----------------------------------------------------</span>
<a name="l05550"></a>05550     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05551"></a>05551 
<a name="l05552"></a>05552     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bConfirmed = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a10954b356a026ea6729ece4d16b281eb">SmartContract_ConfirmAccount</a>(strContract,
<a name="l05553"></a>05553                                                                                 theSignerNymID,
<a name="l05554"></a>05554                                                                                 strPartyName,
<a name="l05555"></a>05555                                                                                 strAcctName,
<a name="l05556"></a>05556                                                                                 strAgentName,
<a name="l05557"></a>05557                                                                                 strAccountID,
<a name="l05558"></a>05558                                                                                 strOutput);
<a name="l05559"></a>05559     <span class="keywordflow">if</span> (!bConfirmed || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05560"></a>05560         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05561"></a>05561     <span class="comment">// -----------------------------------------------------</span>
<a name="l05562"></a>05562     <span class="comment">// Success!</span>
<a name="l05563"></a>05563     <span class="comment">//</span>
<a name="l05564"></a>05564     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05565"></a>05565     <span class="keywordflow">return</span> pBuf;
<a name="l05566"></a>05566 }
<a name="l05567"></a>05567 
<a name="l05568"></a>05568 
<a name="l05569"></a>05569 
<a name="l05570"></a>05570 
<a name="l05571"></a>05571 <span class="comment">// Called by each Party. Pass in the smart contract obtained in the above call.</span>
<a name="l05572"></a>05572 <span class="comment">// Call OTAPI_Exec::SmartContract_ConfirmAccount() first, as much as you need to, THEN call this (for final signing.)</span>
<a name="l05573"></a>05573 <span class="comment">// This is the last call you make before either passing it on to another party to confirm, or calling OTAPI_Exec::activateSmartContract().</span>
<a name="l05574"></a>05574 <span class="comment">// Returns the updated smart contract (or &quot;&quot;.)</span>
<a name="l05575"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad69b7dcad7d5271e9987900ba6e1d5bb">05575</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad69b7dcad7d5271e9987900ba6e1d5bb">OTAPI_Exec::SmartContract_ConfirmParty</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT, <span class="comment">// The smart contract, about to be changed by this function.</span>
<a name="l05576"></a>05576                                                    <span class="keyword">const</span> std::string &amp; PARTY_NAME,   <span class="comment">// Should already be on the contract. This way we can find it.</span>
<a name="l05577"></a>05577                                                    <span class="comment">// ----------------------------------------</span>
<a name="l05578"></a>05578                                                    <span class="keyword">const</span> std::string &amp; NYM_ID)       <span class="comment">// Nym ID for the party, the actual owner,</span>
<a name="l05579"></a>05579                                                    <span class="comment">// ===&gt; AS WELL AS for the default AGENT of that party. (For now, until I code entities)</span>
<a name="l05580"></a>05580 {
<a name="l05581"></a>05581     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05582"></a>05582     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05583"></a>05583     <span class="keywordflow">if</span> (NYM_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NYM_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05584"></a>05584     <span class="comment">// -----------------------------------------------------</span>
<a name="l05585"></a>05585     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theNymID(NYM_ID);
<a name="l05586"></a>05586     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_CONTRACT), strPartyName(PARTY_NAME);
<a name="l05587"></a>05587     <span class="comment">// -----------------------------------------------------</span>
<a name="l05588"></a>05588     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l05589"></a>05589 
<a name="l05590"></a>05590     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bConfirmed = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3c1974fc1798d311264ff55ef1724dcf">SmartContract_ConfirmParty</a>(strContract,  <span class="comment">// The smart contract, about to be changed by this function.</span>
<a name="l05591"></a>05591         strPartyName,   <span class="comment">// Should already be on the contract. This way we can find it.</span>
<a name="l05592"></a>05592         <span class="comment">// ----------------------------------------</span>
<a name="l05593"></a>05593         theNymID,       <span class="comment">// Nym ID for the party, the actual owner,</span>
<a name="l05594"></a>05594         strOutput);
<a name="l05595"></a>05595     <span class="keywordflow">if</span> (!bConfirmed || !strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05596"></a>05596         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05597"></a>05597     <span class="comment">// -----------------------------------------------------</span>
<a name="l05598"></a>05598     <span class="comment">// Success!</span>
<a name="l05599"></a>05599     <span class="comment">//</span>
<a name="l05600"></a>05600     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l05601"></a>05601     <span class="keywordflow">return</span> pBuf;
<a name="l05602"></a>05602 }
<a name="l05603"></a>05603 
<a name="l05604"></a>05604 
<a name="l05605"></a>05605 
<a name="l05606"></a>05606 
<a name="l05607"></a>05607 
<a name="l05608"></a>05608 <span class="comment">// ----------------------------------------------------------</span>
<a name="l05609"></a>05609 
<a name="l05610"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8b4949fd9c42092c32e40f5f0657e2ea">05610</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a8b4949fd9c42092c32e40f5f0657e2ea">OTAPI_Exec::Smart_AreAllPartiesConfirmed</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT)  <span class="comment">// true or false?</span>
<a name="l05611"></a>05611 {
<a name="l05612"></a>05612     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05613"></a>05613     <span class="comment">// -----------------------------------------------------</span>
<a name="l05614"></a>05614     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05615"></a>05615     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05616"></a>05616     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05617"></a>05617     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05618"></a>05618     {
<a name="l05619"></a>05619         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05620"></a>05620                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05621"></a>05621     }
<a name="l05622"></a>05622     <span class="keywordflow">else</span>
<a name="l05623"></a>05623     {
<a name="l05624"></a>05624         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05625"></a>05625         <span class="comment">// -----------------------------------------------------</span>
<a name="l05626"></a>05626         <span class="keyword">const</span> <span class="keywordtype">bool</span> bConfirmed = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a559702a7d59f37881a892129b911d330">AllPartiesHaveSupposedlyConfirmed</a>();
<a name="l05627"></a>05627         <span class="keyword">const</span> <span class="keywordtype">bool</span> bVerified  = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#ae83de8305c791c41e58e888cb873def0">VerifyThisAgainstAllPartiesSignedCopies</a>();
<a name="l05628"></a>05628         <span class="comment">// -----------------------------------------------------</span>
<a name="l05629"></a>05629         <span class="keywordflow">if</span> (<span class="keyword">false</span> == bConfirmed)
<a name="l05630"></a>05630         {
<a name="l05631"></a>05631 <span class="comment">//          OTLog::vOutput(0, &quot;%s: Smart contract loaded up, but all parties are NOT confirmed:\n\n%s\n\n&quot;,</span>
<a name="l05632"></a>05632 <span class="comment">//                         __FUNCTION__, strContract.Get());</span>
<a name="l05633"></a>05633             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Smart contract loaded up, but all parties are NOT confirmed.\n&quot;</span>,
<a name="l05634"></a>05634                            __FUNCTION__);
<a name="l05635"></a>05635             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05636"></a>05636         }
<a name="l05637"></a>05637         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bVerified)
<a name="l05638"></a>05638         {
<a name="l05639"></a>05639 <span class="comment">//          OTLog::vOutput(0, &quot;%s: Success: Smart contract loaded up, and all parties have confirmed,\n&quot;</span>
<a name="l05640"></a>05640 <span class="comment">//                         &quot;AND their signed versions verified also.\n&quot;, __FUNCTION__);</span>
<a name="l05641"></a>05641 
<a name="l05642"></a>05642             <span class="comment">// Todo security: We have confirmed that all parties have provided signed copies, but we have</span>
<a name="l05643"></a>05643             <span class="comment">// not actually verified the signatures themselves. (Though we HAVE verified that their copies of</span>
<a name="l05644"></a>05644             <span class="comment">// the contract match the main copy.)</span>
<a name="l05645"></a>05645             <span class="comment">// The server DOES verify this before activation, but the client should as well, just in case. Todo.</span>
<a name="l05646"></a>05646             <span class="comment">// (I&#39;d want MY client to do it...)</span>
<a name="l05647"></a>05647             <span class="comment">//</span>
<a name="l05648"></a>05648             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l05649"></a>05649         }
<a name="l05650"></a>05650         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Suspicious: Smart contract loaded up, and is supposedly confirmed by all parties, &quot;</span>
<a name="l05651"></a>05651                        <span class="stringliteral">&quot;but failed to verify:\n\n%s\n\n&quot;</span>, __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05652"></a>05652     }
<a name="l05653"></a>05653     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05654"></a>05654     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05655"></a>05655 }
<a name="l05656"></a>05656 
<a name="l05657"></a>05657 
<a name="l05658"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3d40c93db335a728e07be5a52451a891">05658</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a3d40c93db335a728e07be5a52451a891">OTAPI_Exec::Smart_IsPartyConfirmed</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05659"></a>05659                                         <span class="keyword">const</span> std::string &amp; PARTY_NAME)  <span class="comment">// true or false?</span>
<a name="l05660"></a>05660 {
<a name="l05661"></a>05661     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05662"></a>05662     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05663"></a>05663     <span class="comment">// -----------------------------------------------------</span>
<a name="l05664"></a>05664     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05665"></a>05665     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05666"></a>05666     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05667"></a>05667     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05668"></a>05668     {
<a name="l05669"></a>05669         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05670"></a>05670                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05671"></a>05671     }
<a name="l05672"></a>05672     <span class="keywordflow">else</span>
<a name="l05673"></a>05673     {
<a name="l05674"></a>05674         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05675"></a>05675         <span class="comment">// -----------------------------------------------------</span>
<a name="l05676"></a>05676         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l05677"></a>05677         <span class="comment">// -----------------------------------------------------</span>
<a name="l05678"></a>05678         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l05679"></a>05679         {
<a name="l05680"></a>05680             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a party with the name: %s\n&quot;</span>,
<a name="l05681"></a>05681                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l05682"></a>05682         }
<a name="l05683"></a>05683         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l05684"></a>05684         {
<a name="l05685"></a>05685             <span class="comment">//...is he confirmed?</span>
<a name="l05686"></a>05686             <span class="comment">//</span>
<a name="l05687"></a>05687             <span class="keywordflow">if</span> (<span class="keyword">false</span> == pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>().<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l05688"></a>05688             {
<a name="l05689"></a>05689                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party %s was found, &quot;</span>
<a name="l05690"></a>05690                                <span class="stringliteral">&quot;but didn&#39;t find a signed copy of the agreement for that party.\n&quot;</span>,
<a name="l05691"></a>05691                                __FUNCTION__, PARTY_NAME.c_str());
<a name="l05692"></a>05692             }
<a name="l05693"></a>05693             <span class="keywordflow">else</span> <span class="comment">// FYI, this block comes from OTScriptable::VerifyThisAgainstAllPartiesSignedCopies.</span>
<a name="l05694"></a>05694             {
<a name="l05695"></a>05695                 <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pPartySignedCopy = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(pParty-&gt;<a class="code" href="class_o_t_party.html#a6559c663654d4f9d54628f6116737b47">GetMySignedCopy</a>());
<a name="l05696"></a>05696                 <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theCopyAngel;
<a name="l05697"></a>05697 
<a name="l05698"></a>05698                 <span class="keywordflow">if</span> (NULL == pPartySignedCopy)
<a name="l05699"></a>05699                 {
<a name="l05700"></a>05700                     <span class="keyword">const</span> std::string current_party_name(pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>());
<a name="l05701"></a>05701                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading party&#39;s (%s) signed copy of agreement. Has it been executed?\n&quot;</span>,
<a name="l05702"></a>05702                                   __FUNCTION__, current_party_name.c_str());
<a name="l05703"></a>05703                 }
<a name="l05704"></a>05704                 <span class="keywordflow">else</span>
<a name="l05705"></a>05705                 {
<a name="l05706"></a>05706                     theCopyAngel.SetCleanupTarget(*pPartySignedCopy);
<a name="l05707"></a>05707                     <span class="comment">// ----------------------</span>
<a name="l05708"></a>05708                     <span class="keywordflow">if</span> ( <span class="keyword">false</span> == pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#aa4735bf6c25261ea1a021fd8afb57916">Compare</a>(*pPartySignedCopy) )
<a name="l05709"></a>05709                     {
<a name="l05710"></a>05710                         <span class="keyword">const</span> std::string current_party_name(pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>());
<a name="l05711"></a>05711                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Suspicious: Party&#39;s (%s) signed copy of agreement doesn&#39;t match the contract.\n&quot;</span>,
<a name="l05712"></a>05712                                       __FUNCTION__, current_party_name.c_str());
<a name="l05713"></a>05713                     }
<a name="l05714"></a>05714                     <span class="keywordflow">else</span>
<a name="l05715"></a>05715                     {
<a name="l05716"></a>05716                         <span class="comment">// TODO Security: This function doesn&#39;t actually verify the party&#39;s SIGNATURE on his signed</span>
<a name="l05717"></a>05717                         <span class="comment">// version, only that it exists and it matches the main contract.</span>
<a name="l05718"></a>05718                         <span class="comment">//</span>
<a name="l05719"></a>05719                         <span class="comment">// The actual signatures are all verified by the server before activation, but I&#39;d still like the client</span>
<a name="l05720"></a>05720                         <span class="comment">// to have the option to do so as well. I can imagine getting someone&#39;s signature on something (without</span>
<a name="l05721"></a>05721                         <span class="comment">// signing it yourself) and then just retaining the OPTION to sign it later -- but he might not have</span>
<a name="l05722"></a>05722                         <span class="comment">// actually signed it if he knew that you hadn&#39;t either. He&#39;d want his client to tell him, if this were</span>
<a name="l05723"></a>05723                         <span class="comment">// the case. Todo.</span>
<a name="l05724"></a>05724 
<a name="l05725"></a>05725                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l05726"></a>05726                     }
<a name="l05727"></a>05727                 }
<a name="l05728"></a>05728             }
<a name="l05729"></a>05729         }
<a name="l05730"></a>05730     }
<a name="l05731"></a>05731     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05732"></a>05732     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l05733"></a>05733 }
<a name="l05734"></a>05734 
<a name="l05735"></a>05735 
<a name="l05736"></a>05736 
<a name="l05737"></a>05737 
<a name="l05738"></a>05738 <span class="comment">// ----------------------------------------------------------</span>
<a name="l05739"></a><a class="code" href="class_o_t_a_p_i___exec.html#a61b506249619e54aa58682ba5c723174">05739</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a61b506249619e54aa58682ba5c723174">OTAPI_Exec::Smart_GetPartyCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l05740"></a>05740 {
<a name="l05741"></a>05741     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05742"></a>05742     <span class="comment">// -----------------------------------------------------</span>
<a name="l05743"></a>05743     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05744"></a>05744     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05745"></a>05745     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05746"></a>05746     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05747"></a>05747     {
<a name="l05748"></a>05748         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05749"></a>05749                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05750"></a>05750     }
<a name="l05751"></a>05751     <span class="keywordflow">else</span>
<a name="l05752"></a>05752     {
<a name="l05753"></a>05753         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05754"></a>05754         <span class="comment">// -----------------------------------------------------</span>
<a name="l05755"></a>05755         <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a862b70e3515a874a4fed101ad4af1a50">GetPartyCount</a>());
<a name="l05756"></a>05756         <span class="keywordflow">return</span> nReturnValue;
<a name="l05757"></a>05757     }
<a name="l05758"></a>05758     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05759"></a>05759     <span class="keywordflow">return</span> -1; <span class="comment">// Error condition.</span>
<a name="l05760"></a>05760 }
<a name="l05761"></a>05761 
<a name="l05762"></a>05762 
<a name="l05763"></a><a class="code" href="class_o_t_a_p_i___exec.html#acf89acc77de06a62961d95652495ecd6">05763</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#acf89acc77de06a62961d95652495ecd6">OTAPI_Exec::Smart_GetBylawCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l05764"></a>05764 {
<a name="l05765"></a>05765     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05766"></a>05766     <span class="comment">// -----------------------------------------------------</span>
<a name="l05767"></a>05767     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05768"></a>05768     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05769"></a>05769     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05770"></a>05770     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05771"></a>05771     {
<a name="l05772"></a>05772         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05773"></a>05773                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05774"></a>05774     }
<a name="l05775"></a>05775     <span class="keywordflow">else</span>
<a name="l05776"></a>05776     {
<a name="l05777"></a>05777         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05778"></a>05778         <span class="comment">// -----------------------------------------------------</span>
<a name="l05779"></a>05779         <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a8ceb875e6117eaa14fd02d84e15cb9b3">GetBylawCount</a>());
<a name="l05780"></a>05780         <span class="keywordflow">return</span> nReturnValue;
<a name="l05781"></a>05781     }
<a name="l05782"></a>05782     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05783"></a>05783     <span class="keywordflow">return</span> -1; <span class="comment">// Error condition.</span>
<a name="l05784"></a>05784 }
<a name="l05785"></a>05785 
<a name="l05786"></a>05786 
<a name="l05787"></a>05787 <span class="comment">// ----------------------------------------------------------</span>
<a name="l05788"></a>05788 
<a name="l05789"></a>05789 
<a name="l05791"></a><a class="code" href="class_o_t_a_p_i___exec.html#a468ff276835a0795b1baed7ed7c038fa">05791</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a468ff276835a0795b1baed7ed7c038fa" title="returns the name of the party.">OTAPI_Exec::Smart_GetPartyByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05792"></a>05792                                                       <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l05793"></a>05793 {
<a name="l05794"></a>05794     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05795"></a>05795     <span class="comment">// -----------------------------------------------------</span>
<a name="l05796"></a>05796     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05797"></a>05797     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05798"></a>05798     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05799"></a>05799     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05800"></a>05800     {
<a name="l05801"></a>05801         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05802"></a>05802                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05803"></a>05803     }
<a name="l05804"></a>05804     <span class="keywordflow">else</span>
<a name="l05805"></a>05805     {
<a name="l05806"></a>05806         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05807"></a>05807         <span class="comment">// -----------------------------------------------------</span>
<a name="l05808"></a>05808         <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l05809"></a>05809         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a4be857ffbe603f75f1dc5550ed4c20e9">GetPartyByIndex</a>(nTempIndex); <span class="comment">// has range-checking built-in.</span>
<a name="l05810"></a>05810         <span class="comment">// -----------------------------------------------------</span>
<a name="l05811"></a>05811         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l05812"></a>05812         {
<a name="l05813"></a>05813             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party using index: %d\n&quot;</span>,
<a name="l05814"></a>05814                            __FUNCTION__, nTempIndex);
<a name="l05815"></a>05815         }
<a name="l05816"></a>05816         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l05817"></a>05817         {
<a name="l05818"></a>05818             <span class="keywordflow">return</span> pParty-&gt;<a class="code" href="class_o_t_party.html#ad823a9d89b3d8d0d87bc85114eefcead">GetPartyName</a>();
<a name="l05819"></a>05819         }
<a name="l05820"></a>05820     }
<a name="l05821"></a>05821     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05822"></a>05822     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05823"></a>05823 }
<a name="l05824"></a>05824 
<a name="l05826"></a><a class="code" href="class_o_t_a_p_i___exec.html#adc9632c0a4770131768cb39a5aada718">05826</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#adc9632c0a4770131768cb39a5aada718" title="returns the name of the bylaw.">OTAPI_Exec::Smart_GetBylawByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05827"></a>05827                                                       <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l05828"></a>05828 {
<a name="l05829"></a>05829     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05830"></a>05830     <span class="comment">// -----------------------------------------------------</span>
<a name="l05831"></a>05831     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05832"></a>05832     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05833"></a>05833     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05834"></a>05834     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05835"></a>05835     {
<a name="l05836"></a>05836         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05837"></a>05837                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05838"></a>05838     }
<a name="l05839"></a>05839     <span class="keywordflow">else</span>
<a name="l05840"></a>05840     {
<a name="l05841"></a>05841         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05842"></a>05842         <span class="comment">// -----------------------------------------------------</span>
<a name="l05843"></a>05843         <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l05844"></a>05844         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#addfadf16de3cfbb972ec73e097a8dc81">GetBylawByIndex</a>(nTempIndex); <span class="comment">// has range-checking built-in.</span>
<a name="l05845"></a>05845         <span class="comment">// -----------------------------------------------------</span>
<a name="l05846"></a>05846         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l05847"></a>05847         {
<a name="l05848"></a>05848             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw using index: %d\n&quot;</span>,
<a name="l05849"></a>05849                            __FUNCTION__, nTempIndex);
<a name="l05850"></a>05850         }
<a name="l05851"></a>05851         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l05852"></a>05852         {
<a name="l05853"></a>05853             <span class="keyword">const</span> std::string str_name(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ad7c410277a99a3abed22249a8dfd8fb7">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l05854"></a>05854             <span class="keywordflow">return</span> str_name;
<a name="l05855"></a>05855         }
<a name="l05856"></a>05856     }
<a name="l05857"></a>05857     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05858"></a>05858     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05859"></a>05859 }
<a name="l05860"></a>05860 
<a name="l05861"></a>05861 
<a name="l05862"></a>05862 <span class="comment">// ----------------------------------------------------------</span>
<a name="l05863"></a>05863 
<a name="l05864"></a><a class="code" href="class_o_t_a_p_i___exec.html#a706eb989c8dafd4cd2e7f04ec960ce26">05864</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a706eb989c8dafd4cd2e7f04ec960ce26">OTAPI_Exec::Bylaw_GetLanguage</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05865"></a>05865                                           <span class="keyword">const</span> std::string &amp; BYLAW_NAME)
<a name="l05866"></a>05866 {
<a name="l05867"></a>05867     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05868"></a>05868     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05869"></a>05869     <span class="comment">// -----------------------------------------------------</span>
<a name="l05870"></a>05870     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05871"></a>05871     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05872"></a>05872     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05873"></a>05873     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05874"></a>05874     {
<a name="l05875"></a>05875         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05876"></a>05876                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05877"></a>05877     }
<a name="l05878"></a>05878     <span class="keywordflow">else</span>
<a name="l05879"></a>05879     {
<a name="l05880"></a>05880         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05881"></a>05881         <span class="comment">// -----------------------------------------------------</span>
<a name="l05882"></a>05882         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l05883"></a>05883         <span class="comment">// -----------------------------------------------------</span>
<a name="l05884"></a>05884         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l05885"></a>05885         {
<a name="l05886"></a>05886             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a bylaw with the name: %s\n&quot;</span>,
<a name="l05887"></a>05887                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l05888"></a>05888         }
<a name="l05889"></a>05889         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l05890"></a>05890         {
<a name="l05891"></a>05891             <span class="keyword">const</span> std::string str_return(NULL == pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a9227cd44b9e3bab6efdf0dcb719e126c">GetLanguage</a>() ? <span class="stringliteral">&quot;error_no_language&quot;</span> : pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a9227cd44b9e3bab6efdf0dcb719e126c">GetLanguage</a>());
<a name="l05892"></a>05892             <span class="keywordflow">return</span> str_return;
<a name="l05893"></a>05893         }
<a name="l05894"></a>05894     }
<a name="l05895"></a>05895     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05896"></a>05896     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l05897"></a>05897 }
<a name="l05898"></a>05898 
<a name="l05899"></a><a class="code" href="class_o_t_a_p_i___exec.html#a749aeaa4085bd0145f72b3fa79464f66">05899</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a749aeaa4085bd0145f72b3fa79464f66">OTAPI_Exec::Bylaw_GetClauseCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05900"></a>05900                                          <span class="keyword">const</span> std::string &amp; BYLAW_NAME)
<a name="l05901"></a>05901 {
<a name="l05902"></a>05902     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05903"></a>05903     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05904"></a>05904     <span class="comment">// -----------------------------------------------------</span>
<a name="l05905"></a>05905     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05906"></a>05906     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05907"></a>05907     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05908"></a>05908     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05909"></a>05909     {
<a name="l05910"></a>05910         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05911"></a>05911                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05912"></a>05912     }
<a name="l05913"></a>05913     <span class="keywordflow">else</span>
<a name="l05914"></a>05914     {
<a name="l05915"></a>05915         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05916"></a>05916         <span class="comment">// -----------------------------------------------------</span>
<a name="l05917"></a>05917         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l05918"></a>05918         <span class="comment">// -----------------------------------------------------</span>
<a name="l05919"></a>05919         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l05920"></a>05920         {
<a name="l05921"></a>05921             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a bylaw with the name: %s\n&quot;</span>,
<a name="l05922"></a>05922                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l05923"></a>05923         }
<a name="l05924"></a>05924         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l05925"></a>05925         {
<a name="l05926"></a>05926             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a6ad3cf82cf987d4e8ff69f116ac69e5f">GetClauseCount</a>());
<a name="l05927"></a>05927             <span class="keywordflow">return</span> nReturnValue;
<a name="l05928"></a>05928         }
<a name="l05929"></a>05929     }
<a name="l05930"></a>05930     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05931"></a>05931     <span class="keywordflow">return</span> (-1);
<a name="l05932"></a>05932 }
<a name="l05933"></a>05933 
<a name="l05934"></a>05934 
<a name="l05935"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7a43f960bd87d44de443bc4ab2ef5e84">05935</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a7a43f960bd87d44de443bc4ab2ef5e84">OTAPI_Exec::Bylaw_GetVariableCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05936"></a>05936                                            <span class="keyword">const</span> std::string &amp; BYLAW_NAME)
<a name="l05937"></a>05937 {
<a name="l05938"></a>05938     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05939"></a>05939     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05940"></a>05940     <span class="comment">// -----------------------------------------------------</span>
<a name="l05941"></a>05941     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05942"></a>05942     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05943"></a>05943     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05944"></a>05944     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05945"></a>05945     {
<a name="l05946"></a>05946         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05947"></a>05947                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05948"></a>05948     }
<a name="l05949"></a>05949     <span class="keywordflow">else</span>
<a name="l05950"></a>05950     {
<a name="l05951"></a>05951         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05952"></a>05952         <span class="comment">// -----------------------------------------------------</span>
<a name="l05953"></a>05953         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l05954"></a>05954         <span class="comment">// -----------------------------------------------------</span>
<a name="l05955"></a>05955         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l05956"></a>05956         {
<a name="l05957"></a>05957             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a bylaw with the name: %s\n&quot;</span>,
<a name="l05958"></a>05958                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l05959"></a>05959         }
<a name="l05960"></a>05960         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l05961"></a>05961         {
<a name="l05962"></a>05962             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a4d0ab986192370752eae9a2614f66fb9">GetVariableCount</a>());
<a name="l05963"></a>05963             <span class="keywordflow">return</span> nReturnValue;
<a name="l05964"></a>05964         }
<a name="l05965"></a>05965     }
<a name="l05966"></a>05966     <span class="comment">// -----------------------------------------------------------</span>
<a name="l05967"></a>05967     <span class="keywordflow">return</span> (-1);
<a name="l05968"></a>05968 }
<a name="l05969"></a>05969 
<a name="l05970"></a>05970 
<a name="l05971"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7c6b68722495be2bf1a71024ded5bbc3">05971</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a7c6b68722495be2bf1a71024ded5bbc3">OTAPI_Exec::Bylaw_GetHookCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l05972"></a>05972                                        <span class="keyword">const</span> std::string &amp; BYLAW_NAME)
<a name="l05973"></a>05973 {
<a name="l05974"></a>05974     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05975"></a>05975     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l05976"></a>05976     <span class="comment">// -----------------------------------------------------</span>
<a name="l05977"></a>05977     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l05978"></a>05978     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l05979"></a>05979     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l05980"></a>05980     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l05981"></a>05981     {
<a name="l05982"></a>05982         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l05983"></a>05983                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l05984"></a>05984     }
<a name="l05985"></a>05985     <span class="keywordflow">else</span>
<a name="l05986"></a>05986     {
<a name="l05987"></a>05987         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l05988"></a>05988         <span class="comment">// -----------------------------------------------------</span>
<a name="l05989"></a>05989         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l05990"></a>05990         <span class="comment">// -----------------------------------------------------</span>
<a name="l05991"></a>05991         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l05992"></a>05992         {
<a name="l05993"></a>05993             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a bylaw with the name: %s\n&quot;</span>,
<a name="l05994"></a>05994                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l05995"></a>05995         }
<a name="l05996"></a>05996         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l05997"></a>05997         {
<a name="l05998"></a>05998             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a1dfd25d5882c4c52bc3ce79f4531ad18">GetHookCount</a>());
<a name="l05999"></a>05999             <span class="keywordflow">return</span> nReturnValue;
<a name="l06000"></a>06000         }
<a name="l06001"></a>06001     }
<a name="l06002"></a>06002     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06003"></a>06003     <span class="keywordflow">return</span> (-1);
<a name="l06004"></a>06004 }
<a name="l06005"></a>06005 
<a name="l06006"></a>06006 
<a name="l06007"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5b62bca27e890629808735b0d6639598">06007</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a5b62bca27e890629808735b0d6639598">OTAPI_Exec::Bylaw_GetCallbackCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06008"></a>06008                                            <span class="keyword">const</span> std::string &amp; BYLAW_NAME)
<a name="l06009"></a>06009 {
<a name="l06010"></a>06010     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06011"></a>06011     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06012"></a>06012     <span class="comment">// -----------------------------------------------------</span>
<a name="l06013"></a>06013     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06014"></a>06014     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06015"></a>06015     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06016"></a>06016     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06017"></a>06017     {
<a name="l06018"></a>06018         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06019"></a>06019                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06020"></a>06020     }
<a name="l06021"></a>06021     <span class="keywordflow">else</span>
<a name="l06022"></a>06022     {
<a name="l06023"></a>06023         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06024"></a>06024         <span class="comment">// -----------------------------------------------------</span>
<a name="l06025"></a>06025         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06026"></a>06026         <span class="comment">// -----------------------------------------------------</span>
<a name="l06027"></a>06027         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06028"></a>06028         {
<a name="l06029"></a>06029             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a bylaw with the name: %s\n&quot;</span>,
<a name="l06030"></a>06030                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06031"></a>06031         }
<a name="l06032"></a>06032         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06033"></a>06033         {
<a name="l06034"></a>06034             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#abf6a361b2790d94c7e40f5e5e685551f">GetCallbackCount</a>());
<a name="l06035"></a>06035             <span class="keywordflow">return</span> nReturnValue;
<a name="l06036"></a>06036         }
<a name="l06037"></a>06037     }
<a name="l06038"></a>06038     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06039"></a>06039     <span class="keywordflow">return</span> (-1);
<a name="l06040"></a>06040 }
<a name="l06041"></a>06041 
<a name="l06042"></a>06042 
<a name="l06043"></a>06043 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06044"></a>06044 
<a name="l06045"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5471ebc6235f1e1481860027dac94b5c">06045</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5471ebc6235f1e1481860027dac94b5c">OTAPI_Exec::Clause_GetNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06046"></a>06046                                               <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06047"></a>06047                                               <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the clause.</span>
<a name="l06048"></a>06048 {
<a name="l06049"></a>06049     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06050"></a>06050     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06051"></a>06051     <span class="comment">// -----------------------------------------------------</span>
<a name="l06052"></a>06052     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06053"></a>06053     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06054"></a>06054     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06055"></a>06055     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06056"></a>06056     {
<a name="l06057"></a>06057         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06058"></a>06058                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06059"></a>06059     }
<a name="l06060"></a>06060     <span class="keywordflow">else</span>
<a name="l06061"></a>06061     {
<a name="l06062"></a>06062         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06063"></a>06063         <span class="comment">// -----------------------------------------------------</span>
<a name="l06064"></a>06064         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06065"></a>06065         <span class="comment">// -----------------------------------------------------</span>
<a name="l06066"></a>06066         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06067"></a>06067         {
<a name="l06068"></a>06068             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06069"></a>06069                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06070"></a>06070         }
<a name="l06071"></a>06071         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06072"></a>06072         {
<a name="l06073"></a>06073             <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06074"></a>06074 
<a name="l06075"></a>06075             <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a3646d673eea9aaf16d4d839909193120">GetClauseByIndex</a>(nTempIndex);
<a name="l06076"></a>06076 
<a name="l06077"></a>06077             <span class="keywordflow">if</span> (NULL == pClause)
<a name="l06078"></a>06078             {
<a name="l06079"></a>06079                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the clause at index: %d\n&quot;</span>,
<a name="l06080"></a>06080                                __FUNCTION__, nTempIndex);
<a name="l06081"></a>06081             }
<a name="l06082"></a>06082             <span class="keywordflow">else</span> <span class="comment">// We found the clause...</span>
<a name="l06083"></a>06083             {
<a name="l06084"></a>06084                 <span class="keyword">const</span> std::string str_name(pClause-&gt;<a class="code" href="class_o_t_clause.html#a325b3cfeedbfc1c699de3d0f787e5120">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06085"></a>06085                 <span class="keywordflow">return</span> str_name;
<a name="l06086"></a>06086             }
<a name="l06087"></a>06087         }
<a name="l06088"></a>06088     }
<a name="l06089"></a>06089     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06090"></a>06090     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06091"></a>06091 }
<a name="l06092"></a>06092 
<a name="l06093"></a>06093 
<a name="l06094"></a><a class="code" href="class_o_t_a_p_i___exec.html#affe6c422291c8e6b8389cacd5167c914">06094</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#affe6c422291c8e6b8389cacd5167c914">OTAPI_Exec::Clause_GetContents</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06095"></a>06095                                            <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06096"></a>06096                                            <span class="keyword">const</span> std::string &amp; CLAUSE_NAME)  <span class="comment">// returns the contents of the clause.</span>
<a name="l06097"></a>06097 {
<a name="l06098"></a>06098     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06099"></a>06099     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06100"></a>06100     <span class="keywordflow">if</span> (CLAUSE_NAME.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CLAUSE_NAME&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06101"></a>06101     <span class="comment">// -----------------------------------------------------</span>
<a name="l06102"></a>06102     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06103"></a>06103     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06104"></a>06104     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06105"></a>06105     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06106"></a>06106     {
<a name="l06107"></a>06107         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06108"></a>06108                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06109"></a>06109     }
<a name="l06110"></a>06110     <span class="keywordflow">else</span>
<a name="l06111"></a>06111     {
<a name="l06112"></a>06112         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06113"></a>06113         <span class="comment">// -----------------------------------------------------</span>
<a name="l06114"></a>06114         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06115"></a>06115         <span class="comment">// -----------------------------------------------------</span>
<a name="l06116"></a>06116         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06117"></a>06117         {
<a name="l06118"></a>06118             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06119"></a>06119                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06120"></a>06120         }
<a name="l06121"></a>06121         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06122"></a>06122         {
<a name="l06123"></a>06123             <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#a95b30b2c0f6e2944bb3061e0044f48f5">GetClause</a>(CLAUSE_NAME);
<a name="l06124"></a>06124 
<a name="l06125"></a>06125             <span class="keywordflow">if</span> (NULL == pClause)
<a name="l06126"></a>06126             {
<a name="l06127"></a>06127                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the clause with name: %s\n&quot;</span>,
<a name="l06128"></a>06128                                __FUNCTION__, CLAUSE_NAME.c_str());
<a name="l06129"></a>06129             }
<a name="l06130"></a>06130             <span class="keywordflow">else</span> <span class="comment">// We found the clause...</span>
<a name="l06131"></a>06131             {
<a name="l06132"></a>06132                 <span class="keyword">const</span> std::string str_return(pClause-&gt;<a class="code" href="class_o_t_clause.html#a29dced05f7ab1026ef191dbc013dddd6">GetCode</a>());  <span class="comment">// Success.</span>
<a name="l06133"></a>06133                 <span class="keywordflow">return</span> str_return;
<a name="l06134"></a>06134             }
<a name="l06135"></a>06135         }
<a name="l06136"></a>06136     }
<a name="l06137"></a>06137     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06138"></a>06138     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06139"></a>06139 }
<a name="l06140"></a>06140 
<a name="l06141"></a>06141 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06142"></a>06142 
<a name="l06143"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa7005d90b193d8bf451375145dcdd1c6">06143</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa7005d90b193d8bf451375145dcdd1c6">OTAPI_Exec::Variable_GetNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06144"></a>06144                                                 <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06145"></a>06145                                                 <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the variable.</span>
<a name="l06146"></a>06146 {
<a name="l06147"></a>06147     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06148"></a>06148     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06149"></a>06149     <span class="comment">// -----------------------------------------------------</span>
<a name="l06150"></a>06150     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06151"></a>06151     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06152"></a>06152     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06153"></a>06153     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06154"></a>06154     {
<a name="l06155"></a>06155         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06156"></a>06156                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06157"></a>06157     }
<a name="l06158"></a>06158     <span class="keywordflow">else</span>
<a name="l06159"></a>06159     {
<a name="l06160"></a>06160         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06161"></a>06161         <span class="comment">// -----------------------------------------------------</span>
<a name="l06162"></a>06162         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06163"></a>06163         <span class="comment">// -----------------------------------------------------</span>
<a name="l06164"></a>06164         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06165"></a>06165         {
<a name="l06166"></a>06166             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06167"></a>06167                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06168"></a>06168         }
<a name="l06169"></a>06169         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06170"></a>06170         {
<a name="l06171"></a>06171             <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06172"></a>06172 
<a name="l06173"></a>06173             <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ac849f0ab0c7c14436748761ccd507c11">GetVariableByIndex</a>(nTempIndex);
<a name="l06174"></a>06174 
<a name="l06175"></a>06175             <span class="keywordflow">if</span> (NULL == pVar)
<a name="l06176"></a>06176             {
<a name="l06177"></a>06177                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the variable at index: %d\n&quot;</span>,
<a name="l06178"></a>06178                                __FUNCTION__, nTempIndex);
<a name="l06179"></a>06179             }
<a name="l06180"></a>06180             <span class="keywordflow">else</span> <span class="comment">// We found the variable...</span>
<a name="l06181"></a>06181             {
<a name="l06182"></a>06182                 <span class="keyword">const</span> std::string str_name(pVar-&gt;<a class="code" href="class_o_t_variable.html#ab860143fe625f877ee5d2bbe385e5654">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06183"></a>06183                 <span class="keywordflow">return</span> str_name;
<a name="l06184"></a>06184             }
<a name="l06185"></a>06185         }
<a name="l06186"></a>06186     }
<a name="l06187"></a>06187     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06188"></a>06188     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06189"></a>06189 }
<a name="l06190"></a>06190 
<a name="l06191"></a>06191 
<a name="l06192"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac0e35836e8d0f79d604365a390661cc6">06192</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ac0e35836e8d0f79d604365a390661cc6">OTAPI_Exec::Variable_GetType</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06193"></a>06193                                          <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06194"></a>06194                                          <span class="keyword">const</span> std::string &amp; VARIABLE_NAME) <span class="comment">// returns the type of the variable.</span>
<a name="l06195"></a>06195 {
<a name="l06196"></a>06196     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06197"></a>06197     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06198"></a>06198     <span class="keywordflow">if</span> (VARIABLE_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VARIABLE_NAME&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06199"></a>06199     <span class="comment">// -----------------------------------------------------</span>
<a name="l06200"></a>06200     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06201"></a>06201     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06202"></a>06202     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06203"></a>06203     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06204"></a>06204     {
<a name="l06205"></a>06205         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06206"></a>06206                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06207"></a>06207     }
<a name="l06208"></a>06208     <span class="keywordflow">else</span>
<a name="l06209"></a>06209     {
<a name="l06210"></a>06210         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06211"></a>06211         <span class="comment">// -----------------------------------------------------</span>
<a name="l06212"></a>06212         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06213"></a>06213         <span class="comment">// -----------------------------------------------------</span>
<a name="l06214"></a>06214         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06215"></a>06215         {
<a name="l06216"></a>06216             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06217"></a>06217                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06218"></a>06218         }
<a name="l06219"></a>06219         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06220"></a>06220         {
<a name="l06221"></a>06221             <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#aae26ff96d920fcc17ef69e9f0c762710">GetVariable</a>(VARIABLE_NAME);
<a name="l06222"></a>06222 
<a name="l06223"></a>06223             <span class="keywordflow">if</span> (NULL == pVar)
<a name="l06224"></a>06224             {
<a name="l06225"></a>06225                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the variable with name: %s\n&quot;</span>,
<a name="l06226"></a>06226                                __FUNCTION__, VARIABLE_NAME.c_str());
<a name="l06227"></a>06227             }
<a name="l06228"></a>06228             <span class="keywordflow">else</span> <span class="comment">// We found the variable...</span>
<a name="l06229"></a>06229             {
<a name="l06230"></a>06230                 <span class="keyword">const</span> std::string str_return(  pVar-&gt;<a class="code" href="class_o_t_variable.html#a4f1c8eecf62a4d493e71eaf68b92f18c">IsInteger</a>() ? <span class="stringliteral">&quot;integer&quot;</span> :
<a name="l06231"></a>06231                                              ( pVar-&gt;<a class="code" href="class_o_t_variable.html#a3bd1483f88633f323bd48c491e3060d4">IsBool</a>()    ? <span class="stringliteral">&quot;boolean&quot;</span> :
<a name="l06232"></a>06232                                               (pVar-&gt;<a class="code" href="class_o_t_variable.html#abb756ec5d1fc799387e4aa7189989624">IsString</a>()  ? <span class="stringliteral">&quot;string&quot;</span>  : <span class="stringliteral">&quot;error_type&quot;</span> )) ); <span class="comment">// Success.</span>
<a name="l06233"></a>06233                 <span class="keywordflow">return</span> str_return;
<a name="l06234"></a>06234             }
<a name="l06235"></a>06235         }
<a name="l06236"></a>06236     }
<a name="l06237"></a>06237     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06238"></a>06238     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06239"></a>06239 }
<a name="l06240"></a>06240 
<a name="l06241"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad1a0d1ccc8870c2478f9aa9659dc51e1">06241</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad1a0d1ccc8870c2478f9aa9659dc51e1">OTAPI_Exec::Variable_GetAccess</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06242"></a>06242                                            <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06243"></a>06243                                            <span class="keyword">const</span> std::string &amp; VARIABLE_NAME) <span class="comment">// returns the access level of the variable.</span>
<a name="l06244"></a>06244 {
<a name="l06245"></a>06245     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06246"></a>06246     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06247"></a>06247     <span class="keywordflow">if</span> (VARIABLE_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VARIABLE_NAME&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06248"></a>06248     <span class="comment">// -----------------------------------------------------</span>
<a name="l06249"></a>06249     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06250"></a>06250     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06251"></a>06251     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06252"></a>06252     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06253"></a>06253     {
<a name="l06254"></a>06254         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06255"></a>06255                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06256"></a>06256     }
<a name="l06257"></a>06257     <span class="keywordflow">else</span>
<a name="l06258"></a>06258     {
<a name="l06259"></a>06259         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06260"></a>06260         <span class="comment">// -----------------------------------------------------</span>
<a name="l06261"></a>06261         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06262"></a>06262         <span class="comment">// -----------------------------------------------------</span>
<a name="l06263"></a>06263         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06264"></a>06264         {
<a name="l06265"></a>06265             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06266"></a>06266                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06267"></a>06267         }
<a name="l06268"></a>06268         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06269"></a>06269         {
<a name="l06270"></a>06270             <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#aae26ff96d920fcc17ef69e9f0c762710">GetVariable</a>(VARIABLE_NAME);
<a name="l06271"></a>06271 
<a name="l06272"></a>06272             <span class="keywordflow">if</span> (NULL == pVar)
<a name="l06273"></a>06273             {
<a name="l06274"></a>06274                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the variable with name: %s\n&quot;</span>,
<a name="l06275"></a>06275                                __FUNCTION__, VARIABLE_NAME.c_str());
<a name="l06276"></a>06276             }
<a name="l06277"></a>06277             <span class="keywordflow">else</span> <span class="comment">// We found the variable...</span>
<a name="l06278"></a>06278             {
<a name="l06279"></a>06279                 <span class="keyword">const</span> std::string str_return(  pVar-&gt;<a class="code" href="class_o_t_variable.html#a74916be2f82d09b711e9667c48ef3a4b">IsConstant</a>()   ? <span class="stringliteral">&quot;constant&quot;</span>    :
<a name="l06280"></a>06280                                              ( pVar-&gt;<a class="code" href="class_o_t_variable.html#a36881b81635a0622eac46309a33874ea">IsImportant</a>()  ? <span class="stringliteral">&quot;important&quot;</span>   :
<a name="l06281"></a>06281                                               (pVar-&gt;<a class="code" href="class_o_t_variable.html#abe7b418016381937ac175c58bf5e6792">IsPersistent</a>() ? <span class="stringliteral">&quot;persistent&quot;</span>  : <span class="stringliteral">&quot;error_access&quot;</span> )) ); <span class="comment">// Success.</span>
<a name="l06282"></a>06282                 <span class="keywordflow">return</span> str_return;
<a name="l06283"></a>06283             }
<a name="l06284"></a>06284         }
<a name="l06285"></a>06285     }
<a name="l06286"></a>06286     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06287"></a>06287     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06288"></a>06288 }
<a name="l06289"></a>06289 
<a name="l06290"></a>06290 
<a name="l06291"></a><a class="code" href="class_o_t_a_p_i___exec.html#a041f07e1744c9d1b6008748e5f3c904a">06291</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a041f07e1744c9d1b6008748e5f3c904a">OTAPI_Exec::Variable_GetContents</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06292"></a>06292                                              <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06293"></a>06293                                              <span class="keyword">const</span> std::string &amp; VARIABLE_NAME) <span class="comment">// returns the contents of the variable.</span>
<a name="l06294"></a>06294 {
<a name="l06295"></a>06295     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06296"></a>06296     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06297"></a>06297     <span class="keywordflow">if</span> (VARIABLE_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;VARIABLE_NAME&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06298"></a>06298     <span class="comment">// -----------------------------------------------------</span>
<a name="l06299"></a>06299     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06300"></a>06300     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06301"></a>06301     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06302"></a>06302     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06303"></a>06303     {
<a name="l06304"></a>06304         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06305"></a>06305                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06306"></a>06306     }
<a name="l06307"></a>06307     <span class="keywordflow">else</span>
<a name="l06308"></a>06308     {
<a name="l06309"></a>06309         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06310"></a>06310         <span class="comment">// -----------------------------------------------------</span>
<a name="l06311"></a>06311         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06312"></a>06312         <span class="comment">// -----------------------------------------------------</span>
<a name="l06313"></a>06313         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06314"></a>06314         {
<a name="l06315"></a>06315             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06316"></a>06316                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06317"></a>06317         }
<a name="l06318"></a>06318         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06319"></a>06319         {
<a name="l06320"></a>06320             <a class="code" href="class_o_t_variable.html">OTVariable</a> * pVar = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#aae26ff96d920fcc17ef69e9f0c762710">GetVariable</a>(VARIABLE_NAME);
<a name="l06321"></a>06321 
<a name="l06322"></a>06322             <span class="keywordflow">if</span> (NULL == pVar)
<a name="l06323"></a>06323             {
<a name="l06324"></a>06324                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the variable with name: %s\n&quot;</span>,
<a name="l06325"></a>06325                                __FUNCTION__, VARIABLE_NAME.c_str());
<a name="l06326"></a>06326             }
<a name="l06327"></a>06327             <span class="keywordflow">else</span> <span class="comment">// We found the variable...</span>
<a name="l06328"></a>06328             {
<a name="l06329"></a>06329                 std::string  str_return;
<a name="l06330"></a>06330 
<a name="l06331"></a>06331                 <span class="keywordflow">switch</span> (pVar-&gt;<a class="code" href="class_o_t_variable.html#abcb55fa45012907c7b446d7ab5969168">GetType</a>())
<a name="l06332"></a>06332                 {
<a name="l06333"></a>06333                     <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a814483713bd6ebb3b01c06378fc60fa7">OTVariable::Var_String</a>  : str_return = pVar-&gt;<a class="code" href="class_o_t_variable.html#a74efdd2f7064b6b9429f13884d297043">GetValueString</a>(); <span class="keywordflow">break</span>;
<a name="l06334"></a>06334                     <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009ad6ecaa07337c8641bed85deab47c1a1d">OTVariable::Var_Integer</a> : str_return = <a class="code" href="class_o_t_a_p_i___exec.html#ab27795fbc9d11a3ada075eaa64b95831">OTAPI_Exec::LongToString</a>(static_cast&lt;int64_t&gt;(pVar-&gt;<a class="code" href="class_o_t_variable.html#a2476ccc8b149df1f393a089e5c98c03c">GetValueInteger</a>())); <span class="keywordflow">break</span>;
<a name="l06335"></a>06335                     <span class="keywordflow">case</span> <a class="code" href="class_o_t_variable.html#a368e6a27177cbd9016c4dc40a6c67009a4f6c0ea25b7a5aed16bc7710389e77da">OTVariable::Var_Bool</a>    : str_return = pVar-&gt;<a class="code" href="class_o_t_variable.html#aaab7544d5c8fe9ae82dc5f379a19022a">GetValueBool</a>() ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>; <span class="keywordflow">break</span>;
<a name="l06336"></a>06336                     <span class="keywordflow">default</span>                      : <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Unknown variable type.\n&quot;</span>, __FUNCTION__); <span class="keywordflow">break</span>;
<a name="l06337"></a>06337                 }
<a name="l06338"></a>06338                 <span class="keywordflow">return</span> str_return;
<a name="l06339"></a>06339             }
<a name="l06340"></a>06340         }
<a name="l06341"></a>06341     }
<a name="l06342"></a>06342     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06343"></a>06343     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06344"></a>06344 }
<a name="l06345"></a>06345 
<a name="l06346"></a>06346 
<a name="l06347"></a>06347 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06348"></a>06348 
<a name="l06349"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9c8867d91b72f7bb19dca21a4f85e890">06349</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a9c8867d91b72f7bb19dca21a4f85e890">OTAPI_Exec::Hook_GetNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06350"></a>06350                                             <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06351"></a>06351                                             <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the hook.</span>
<a name="l06352"></a>06352 {
<a name="l06353"></a>06353     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06354"></a>06354     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06355"></a>06355     <span class="comment">// -----------------------------------------------------</span>
<a name="l06356"></a>06356     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06357"></a>06357     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06358"></a>06358     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06359"></a>06359     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06360"></a>06360     {
<a name="l06361"></a>06361         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06362"></a>06362                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06363"></a>06363     }
<a name="l06364"></a>06364     <span class="keywordflow">else</span>
<a name="l06365"></a>06365     {
<a name="l06366"></a>06366         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06367"></a>06367         <span class="comment">// -----------------------------------------------------</span>
<a name="l06368"></a>06368         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06369"></a>06369         <span class="comment">// -----------------------------------------------------</span>
<a name="l06370"></a>06370         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06371"></a>06371         {
<a name="l06372"></a>06372             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06373"></a>06373                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06374"></a>06374         }
<a name="l06375"></a>06375         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06376"></a>06376         {
<a name="l06377"></a>06377             <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06378"></a>06378             <span class="keyword">const</span> std::string str_name(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ae9b4cfc73f3348227007111bb3e16887">GetHookNameByIndex</a>(nTempIndex));
<a name="l06379"></a>06379             <span class="keywordflow">return</span> str_name;
<a name="l06380"></a>06380         }
<a name="l06381"></a>06381     }
<a name="l06382"></a>06382     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06383"></a>06383     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06384"></a>06384 }
<a name="l06385"></a>06385 
<a name="l06387"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9474900b264f56b279fae796e4c054b5">06387</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9474900b264f56b279fae796e4c054b5" title="Returns the number of clauses attached to a specific hook.">OTAPI_Exec::Hook_GetClauseCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06388"></a>06388                                         <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06389"></a>06389                                         <span class="keyword">const</span> std::string &amp; HOOK_NAME)
<a name="l06390"></a>06390 {
<a name="l06391"></a>06391     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06392"></a>06392     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06393"></a>06393     <span class="keywordflow">if</span> (HOOK_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;HOOK_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06394"></a>06394     <span class="comment">// -----------------------------------------------------</span>
<a name="l06395"></a>06395     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06396"></a>06396     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06397"></a>06397     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06398"></a>06398     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06399"></a>06399     {
<a name="l06400"></a>06400         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06401"></a>06401                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06402"></a>06402     }
<a name="l06403"></a>06403     <span class="keywordflow">else</span>
<a name="l06404"></a>06404     {
<a name="l06405"></a>06405         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06406"></a>06406         <span class="comment">// -----------------------------------------------------</span>
<a name="l06407"></a>06407         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06408"></a>06408         <span class="comment">// -----------------------------------------------------</span>
<a name="l06409"></a>06409         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06410"></a>06410         {
<a name="l06411"></a>06411             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06412"></a>06412                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06413"></a>06413         }
<a name="l06414"></a>06414         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06415"></a>06415         {
<a name="l06416"></a>06416             <a class="code" href="_o_t_clause_8hpp.html#a40c16432fa9c16826c026b74351425ad">mapOfClauses</a> theResults;
<a name="l06417"></a>06417             <span class="keyword">const</span> <span class="keywordtype">bool</span> bGotHooks = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ac43e007f0a64ca7c09853340c8a3aab1">GetHooks</a>(HOOK_NAME, theResults); <span class="comment">// Look up all clauses matching a specific hook.</span>
<a name="l06418"></a>06418             <span class="keyword">const</span> int32_t nReturnValue = bGotHooks ? <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(theResults.size()) : (-1);
<a name="l06419"></a>06419             <span class="keywordflow">return</span> nReturnValue;
<a name="l06420"></a>06420         }
<a name="l06421"></a>06421     }
<a name="l06422"></a>06422     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06423"></a>06423     <span class="keywordflow">return</span> (-1);
<a name="l06424"></a>06424 }
<a name="l06425"></a>06425 
<a name="l06430"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa70d330a5a3e6ff06ca06aa6bb2018d7">06430</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa70d330a5a3e6ff06ca06aa6bb2018d7">OTAPI_Exec::Hook_GetClauseAtIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06431"></a>06431                                               <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06432"></a>06432                                               <span class="keyword">const</span> std::string &amp; HOOK_NAME,
<a name="l06433"></a>06433                                               <span class="keyword">const</span> int32_t     &amp; nIndex)
<a name="l06434"></a>06434 {
<a name="l06435"></a>06435     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06436"></a>06436     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06437"></a>06437     <span class="keywordflow">if</span> (HOOK_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;HOOK_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06438"></a>06438     <span class="comment">// -----------------------------------------------------</span>
<a name="l06439"></a>06439     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06440"></a>06440     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06441"></a>06441     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06442"></a>06442     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06443"></a>06443     {
<a name="l06444"></a>06444         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06445"></a>06445                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06446"></a>06446     }
<a name="l06447"></a>06447     <span class="keywordflow">else</span>
<a name="l06448"></a>06448     {
<a name="l06449"></a>06449         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06450"></a>06450         <span class="comment">// -----------------------------------------------------</span>
<a name="l06451"></a>06451         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06452"></a>06452         <span class="comment">// -----------------------------------------------------</span>
<a name="l06453"></a>06453         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06454"></a>06454         {
<a name="l06455"></a>06455             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06456"></a>06456                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06457"></a>06457         }
<a name="l06458"></a>06458         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06459"></a>06459         {
<a name="l06460"></a>06460             <a class="code" href="_o_t_clause_8hpp.html#a40c16432fa9c16826c026b74351425ad">mapOfClauses</a> theResults;
<a name="l06461"></a>06461 
<a name="l06462"></a>06462             <span class="keywordflow">if</span> (pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ac43e007f0a64ca7c09853340c8a3aab1">GetHooks</a>(HOOK_NAME, theResults)) <span class="comment">// Look up all clauses matching a specific hook.</span>
<a name="l06463"></a>06463             {
<a name="l06464"></a>06464                 <span class="keywordflow">if</span> ((nIndex &gt;= 0) &amp;&amp; (nIndex &lt; static_cast&lt;int64_t&gt;(theResults.size())))
<a name="l06465"></a>06465                 {
<a name="l06466"></a>06466                     int32_t nLoopIndex = -1;
<a name="l06467"></a>06467 
<a name="l06468"></a>06468                     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_clause_8hpp.html#a40c16432fa9c16826c026b74351425ad">mapOfClauses</a>, theResults)
<a name="l06469"></a>06469                     {
<a name="l06470"></a>06470                         <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = (*it).second;
<a name="l06471"></a>06471                         <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(NULL != pClause);
<a name="l06472"></a>06472                         <span class="comment">// ---------------------------</span>
<a name="l06473"></a>06473                         ++nLoopIndex; <span class="comment">// on first iteration, this is now 0.</span>
<a name="l06474"></a>06474 
<a name="l06475"></a>06475                         <span class="keywordflow">if</span> (nLoopIndex == nIndex)
<a name="l06476"></a>06476                         {
<a name="l06477"></a>06477                             <span class="keyword">const</span> std::string str_return(pClause-&gt;<a class="code" href="class_o_t_clause.html#a325b3cfeedbfc1c699de3d0f787e5120">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06478"></a>06478                             <span class="keywordflow">return</span> str_return;
<a name="l06479"></a>06479                         }
<a name="l06480"></a>06480                     }
<a name="l06481"></a>06481                 }
<a name="l06482"></a>06482             }
<a name="l06483"></a>06483         }
<a name="l06484"></a>06484     }
<a name="l06485"></a>06485     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06486"></a>06486     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06487"></a>06487 }
<a name="l06488"></a>06488 
<a name="l06489"></a>06489 
<a name="l06490"></a>06490 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06491"></a><a class="code" href="class_o_t_a_p_i___exec.html#afa219a519cc7ddddd735f23e835a6fee">06491</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afa219a519cc7ddddd735f23e835a6fee">OTAPI_Exec::Callback_GetNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06492"></a>06492                                                 <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06493"></a>06493                                                 <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the callback.</span>
<a name="l06494"></a>06494 {
<a name="l06495"></a>06495     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06496"></a>06496     <span class="keywordflow">if</span> (BYLAW_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06497"></a>06497     <span class="comment">// -----------------------------------------------------</span>
<a name="l06498"></a>06498     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06499"></a>06499     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06500"></a>06500     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06501"></a>06501     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06502"></a>06502     {
<a name="l06503"></a>06503         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06504"></a>06504                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06505"></a>06505     }
<a name="l06506"></a>06506     <span class="keywordflow">else</span>
<a name="l06507"></a>06507     {
<a name="l06508"></a>06508         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06509"></a>06509         <span class="comment">// -----------------------------------------------------</span>
<a name="l06510"></a>06510         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06511"></a>06511         <span class="comment">// -----------------------------------------------------</span>
<a name="l06512"></a>06512         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06513"></a>06513         {
<a name="l06514"></a>06514             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06515"></a>06515                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06516"></a>06516         }
<a name="l06517"></a>06517         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06518"></a>06518         {
<a name="l06519"></a>06519             <span class="keyword">const</span> int32_t nTempIndex = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06520"></a>06520             <span class="keyword">const</span> std::string str_name(pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#af974538387c6e71123b3d6093427948c">GetCallbackNameByIndex</a>(nTempIndex));
<a name="l06521"></a>06521             <span class="keywordflow">return</span> str_name;
<a name="l06522"></a>06522         }
<a name="l06523"></a>06523     }
<a name="l06524"></a>06524     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06525"></a>06525     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06526"></a>06526 }
<a name="l06527"></a>06527 
<a name="l06528"></a>06528 
<a name="l06529"></a><a class="code" href="class_o_t_a_p_i___exec.html#af952d83f17ef493cc8d61b22f6276eb3">06529</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af952d83f17ef493cc8d61b22f6276eb3">OTAPI_Exec::Callback_GetClause</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06530"></a>06530                                            <span class="keyword">const</span> std::string &amp; BYLAW_NAME,
<a name="l06531"></a>06531                                            <span class="keyword">const</span> std::string &amp; CALLBACK_NAME) <span class="comment">// returns name of clause attached to callback.</span>
<a name="l06532"></a>06532 {
<a name="l06533"></a>06533     <span class="keywordflow">if</span> (THE_CONTRACT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06534"></a>06534     <span class="keywordflow">if</span> (BYLAW_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BYLAW_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06535"></a>06535     <span class="keywordflow">if</span> (CALLBACK_NAME.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CALLBACK_NAME&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06536"></a>06536     <span class="comment">// -----------------------------------------------------</span>
<a name="l06537"></a>06537     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06538"></a>06538     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06539"></a>06539     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06540"></a>06540     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06541"></a>06541     {
<a name="l06542"></a>06542         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06543"></a>06543                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06544"></a>06544     }
<a name="l06545"></a>06545     <span class="keywordflow">else</span>
<a name="l06546"></a>06546     {
<a name="l06547"></a>06547         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06548"></a>06548         <span class="comment">// -----------------------------------------------------</span>
<a name="l06549"></a>06549         <a class="code" href="class_o_t_bylaw.html">OTBylaw</a> * pBylaw = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#a970014fa028541c7a3c908800bfa4ee9">GetBylaw</a>(BYLAW_NAME);
<a name="l06550"></a>06550         <span class="comment">// -----------------------------------------------------</span>
<a name="l06551"></a>06551         <span class="keywordflow">if</span> (NULL == pBylaw)
<a name="l06552"></a>06552         {
<a name="l06553"></a>06553             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the bylaw with name: %s\n&quot;</span>,
<a name="l06554"></a>06554                            __FUNCTION__, BYLAW_NAME.c_str());
<a name="l06555"></a>06555         }
<a name="l06556"></a>06556         <span class="keywordflow">else</span> <span class="comment">// We found the bylaw...</span>
<a name="l06557"></a>06557         {
<a name="l06558"></a>06558             <a class="code" href="class_o_t_clause.html">OTClause</a> * pClause = pBylaw-&gt;<a class="code" href="class_o_t_bylaw.html#ab1c6c33a33817e60be48e70ce862e898">GetCallback</a>(CALLBACK_NAME);
<a name="l06559"></a>06559 
<a name="l06560"></a>06560             <span class="keywordflow">if</span> (NULL == pClause)
<a name="l06561"></a>06561             {
<a name="l06562"></a>06562                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and bylaw found, but failed to retrieve the clause for callback: %s\n&quot;</span>,
<a name="l06563"></a>06563                                __FUNCTION__, CALLBACK_NAME.c_str());
<a name="l06564"></a>06564             }
<a name="l06565"></a>06565             <span class="keywordflow">else</span> <span class="comment">// We found the clause...</span>
<a name="l06566"></a>06566             {
<a name="l06567"></a>06567                 <span class="keyword">const</span> std::string str_return(pClause-&gt;<a class="code" href="class_o_t_clause.html#a325b3cfeedbfc1c699de3d0f787e5120">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06568"></a>06568                 <span class="keywordflow">return</span> str_return;
<a name="l06569"></a>06569             }
<a name="l06570"></a>06570         }
<a name="l06571"></a>06571     }
<a name="l06572"></a>06572     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06573"></a>06573     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06574"></a>06574 }
<a name="l06575"></a>06575 
<a name="l06576"></a>06576 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06577"></a>06577 
<a name="l06578"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa274d975294488d77a90b462d3e0bbde">06578</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#aa274d975294488d77a90b462d3e0bbde">OTAPI_Exec::Party_GetAcctCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06579"></a>06579                                        <span class="keyword">const</span> std::string &amp; PARTY_NAME)
<a name="l06580"></a>06580 {
<a name="l06581"></a>06581     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06582"></a>06582     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06583"></a>06583     <span class="comment">// -----------------------------------------------------</span>
<a name="l06584"></a>06584     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06585"></a>06585     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06586"></a>06586     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06587"></a>06587     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06588"></a>06588     {
<a name="l06589"></a>06589         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06590"></a>06590                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06591"></a>06591     }
<a name="l06592"></a>06592     <span class="keywordflow">else</span>
<a name="l06593"></a>06593     {
<a name="l06594"></a>06594         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06595"></a>06595         <span class="comment">// -----------------------------------------------------</span>
<a name="l06596"></a>06596         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06597"></a>06597         <span class="comment">// -----------------------------------------------------</span>
<a name="l06598"></a>06598         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06599"></a>06599         {
<a name="l06600"></a>06600             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a party with the name: %s\n&quot;</span>,
<a name="l06601"></a>06601                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06602"></a>06602         }
<a name="l06603"></a>06603         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06604"></a>06604         {
<a name="l06605"></a>06605             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pParty-&gt;<a class="code" href="class_o_t_party.html#a0b130989d275386c980ed34d587e5e87">GetAccountCount</a>());
<a name="l06606"></a>06606             <span class="keywordflow">return</span> nReturnValue;
<a name="l06607"></a>06607         }
<a name="l06608"></a>06608     }
<a name="l06609"></a>06609     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06610"></a>06610     <span class="keywordflow">return</span> (-1);
<a name="l06611"></a>06611 }
<a name="l06612"></a>06612 
<a name="l06613"></a>06613 
<a name="l06614"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4e74fd38565f07849781befa31281149">06614</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4e74fd38565f07849781befa31281149">OTAPI_Exec::Party_GetAgentCount</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06615"></a>06615                                         <span class="keyword">const</span> std::string &amp; PARTY_NAME)
<a name="l06616"></a>06616 {
<a name="l06617"></a>06617     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06618"></a>06618     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06619"></a>06619     <span class="comment">// -----------------------------------------------------</span>
<a name="l06620"></a>06620     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06621"></a>06621     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06622"></a>06622     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06623"></a>06623     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06624"></a>06624     {
<a name="l06625"></a>06625         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06626"></a>06626                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06627"></a>06627     }
<a name="l06628"></a>06628     <span class="keywordflow">else</span>
<a name="l06629"></a>06629     {
<a name="l06630"></a>06630         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06631"></a>06631         <span class="comment">// -----------------------------------------------------</span>
<a name="l06632"></a>06632         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06633"></a>06633         <span class="comment">// -----------------------------------------------------</span>
<a name="l06634"></a>06634         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06635"></a>06635         {
<a name="l06636"></a>06636             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a party with the name: %s\n&quot;</span>,
<a name="l06637"></a>06637                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06638"></a>06638         }
<a name="l06639"></a>06639         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06640"></a>06640         {
<a name="l06641"></a>06641             <span class="keyword">const</span> int32_t nReturnValue = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(pParty-&gt;<a class="code" href="class_o_t_party.html#afb288a76dd356ce029b4792dc2d6c019">GetAgentCount</a>());
<a name="l06642"></a>06642             <span class="keywordflow">return</span> nReturnValue;
<a name="l06643"></a>06643         }
<a name="l06644"></a>06644     }
<a name="l06645"></a>06645     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06646"></a>06646     <span class="keywordflow">return</span> (-1);
<a name="l06647"></a>06647 }
<a name="l06648"></a>06648 
<a name="l06649"></a>06649 
<a name="l06650"></a>06650 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06651"></a>06651 
<a name="l06652"></a><a class="code" href="class_o_t_a_p_i___exec.html#af9e9ccab4b7249ed60d07690a8765a59">06652</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af9e9ccab4b7249ed60d07690a8765a59">OTAPI_Exec::Party_GetID</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06653"></a>06653                                     <span class="keyword">const</span> std::string &amp; PARTY_NAME) <span class="comment">// returns either NymID or Entity ID. (If there is one... Contract might not be signed yet.)</span>
<a name="l06654"></a>06654 {
<a name="l06655"></a>06655     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06656"></a>06656     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06657"></a>06657     <span class="comment">// -----------------------------------------------------</span>
<a name="l06658"></a>06658     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06659"></a>06659     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06660"></a>06660     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06661"></a>06661     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06662"></a>06662     {
<a name="l06663"></a>06663         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06664"></a>06664                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06665"></a>06665     }
<a name="l06666"></a>06666     <span class="keywordflow">else</span>
<a name="l06667"></a>06667     {
<a name="l06668"></a>06668         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06669"></a>06669         <span class="comment">// -----------------------------------------------------</span>
<a name="l06670"></a>06670         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06671"></a>06671         <span class="comment">// -----------------------------------------------------</span>
<a name="l06672"></a>06672         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06673"></a>06673         {
<a name="l06674"></a>06674             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to find a party with the name: %s\n&quot;</span>,
<a name="l06675"></a>06675                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06676"></a>06676         }
<a name="l06677"></a>06677         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06678"></a>06678         {
<a name="l06679"></a>06679             <span class="keywordflow">return</span> pParty-&gt;<a class="code" href="class_o_t_party.html#a4aa12384e93bd6c2f6d437cf8ca97dfa">GetPartyID</a>();
<a name="l06680"></a>06680         }
<a name="l06681"></a>06681     }
<a name="l06682"></a>06682     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06683"></a>06683     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06684"></a>06684 }
<a name="l06685"></a>06685 
<a name="l06686"></a>06686 
<a name="l06687"></a>06687 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06688"></a><a class="code" href="class_o_t_a_p_i___exec.html#a959128265f75ed1a528c589311b9287f">06688</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a959128265f75ed1a528c589311b9287f">OTAPI_Exec::Party_GetAcctNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06689"></a>06689                                                  <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06690"></a>06690                                                  <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the clause.</span>
<a name="l06691"></a>06691 {
<a name="l06692"></a>06692     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06693"></a>06693     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06694"></a>06694     <span class="comment">// -----------------------------------------------------</span>
<a name="l06695"></a>06695     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06696"></a>06696     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06697"></a>06697     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06698"></a>06698     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06699"></a>06699     {
<a name="l06700"></a>06700         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06701"></a>06701                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06702"></a>06702     }
<a name="l06703"></a>06703     <span class="keywordflow">else</span>
<a name="l06704"></a>06704     {
<a name="l06705"></a>06705         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06706"></a>06706         <span class="comment">// -----------------------------------------------------</span>
<a name="l06707"></a>06707         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06708"></a>06708         <span class="comment">// -----------------------------------------------------</span>
<a name="l06709"></a>06709         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06710"></a>06710         {
<a name="l06711"></a>06711             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06712"></a>06712                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06713"></a>06713         }
<a name="l06714"></a>06714         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06715"></a>06715         {
<a name="l06716"></a>06716             <span class="keyword">const</span> int32_t nTempIndex   = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06717"></a>06717             <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#ad085e6ba37a006e0f8cf7e100a9b59eb">GetAccountByIndex</a>(nTempIndex);
<a name="l06718"></a>06718 
<a name="l06719"></a>06719             <span class="keywordflow">if</span> (NULL == pAcct)
<a name="l06720"></a>06720             {
<a name="l06721"></a>06721                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve the account at index: %d\n&quot;</span>,
<a name="l06722"></a>06722                                __FUNCTION__, nTempIndex);
<a name="l06723"></a>06723             }
<a name="l06724"></a>06724             <span class="keywordflow">else</span> <span class="comment">// We found the account...</span>
<a name="l06725"></a>06725             {
<a name="l06726"></a>06726                 <span class="keyword">const</span> std::string str_name(pAcct-&gt;<a class="code" href="class_o_t_party_account.html#a56b14b8bc2279fab08cc9c2c754043d4">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06727"></a>06727                 <span class="keywordflow">return</span> str_name;
<a name="l06728"></a>06728             }
<a name="l06729"></a>06729         }
<a name="l06730"></a>06730     }
<a name="l06731"></a>06731     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06732"></a>06732     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06733"></a>06733 }
<a name="l06734"></a>06734 
<a name="l06735"></a>06735 
<a name="l06736"></a>06736 
<a name="l06737"></a><a class="code" href="class_o_t_a_p_i___exec.html#ade083f86e74e59977670e02fb11de343">06737</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ade083f86e74e59977670e02fb11de343">OTAPI_Exec::Party_GetAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06738"></a>06738                                         <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06739"></a>06739                                         <span class="keyword">const</span> std::string &amp; ACCT_NAME) <span class="comment">// returns the account ID based on the account name. (If there is one yet...)</span>
<a name="l06740"></a>06740 {
<a name="l06741"></a>06741     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06742"></a>06742     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06743"></a>06743     <span class="keywordflow">if</span> (ACCT_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NAME&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06744"></a>06744     <span class="comment">// -----------------------------------------------------</span>
<a name="l06745"></a>06745     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06746"></a>06746     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06747"></a>06747     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06748"></a>06748     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06749"></a>06749     {
<a name="l06750"></a>06750         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06751"></a>06751                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06752"></a>06752     }
<a name="l06753"></a>06753     <span class="keywordflow">else</span>
<a name="l06754"></a>06754     {
<a name="l06755"></a>06755         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06756"></a>06756         <span class="comment">// -----------------------------------------------------</span>
<a name="l06757"></a>06757         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06758"></a>06758         <span class="comment">// -----------------------------------------------------</span>
<a name="l06759"></a>06759         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06760"></a>06760         {
<a name="l06761"></a>06761             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06762"></a>06762                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06763"></a>06763         }
<a name="l06764"></a>06764         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06765"></a>06765         {
<a name="l06766"></a>06766             <span class="keyword">const</span> <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#aee3973dc05c042dab571781a9d454af2">GetAccount</a>(ACCT_NAME);
<a name="l06767"></a>06767 
<a name="l06768"></a>06768             <span class="keywordflow">if</span> (NULL == pAcct)
<a name="l06769"></a>06769             {
<a name="l06770"></a>06770                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve party&#39;s account named: %s\n&quot;</span>,
<a name="l06771"></a>06771                                __FUNCTION__, ACCT_NAME.c_str());
<a name="l06772"></a>06772             }
<a name="l06773"></a>06773             <span class="keywordflow">else</span> <span class="comment">// We found the account...</span>
<a name="l06774"></a>06774             {
<a name="l06775"></a>06775                 <span class="keyword">const</span> std::string str_return(pAcct-&gt;<a class="code" href="class_o_t_party_account.html#aa5e4e0cc77853d08b3708017fe694876">GetAcctID</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06776"></a>06776                 <span class="keywordflow">return</span> str_return;
<a name="l06777"></a>06777             }
<a name="l06778"></a>06778         }
<a name="l06779"></a>06779     }
<a name="l06780"></a>06780     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06781"></a>06781     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06782"></a>06782 }
<a name="l06783"></a>06783 
<a name="l06784"></a>06784 
<a name="l06785"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae8794cf485acf05c70c5e10e66a8b211">06785</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae8794cf485acf05c70c5e10e66a8b211">OTAPI_Exec::Party_GetAcctAssetID</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06786"></a>06786                                              <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06787"></a>06787                                              <span class="keyword">const</span> std::string &amp; ACCT_NAME) <span class="comment">// returns the asset type ID based on the account name.</span>
<a name="l06788"></a>06788 {
<a name="l06789"></a>06789     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06790"></a>06790     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06791"></a>06791     <span class="keywordflow">if</span> (ACCT_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NAME&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06792"></a>06792     <span class="comment">// -----------------------------------------------------</span>
<a name="l06793"></a>06793     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06794"></a>06794     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06795"></a>06795     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06796"></a>06796     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06797"></a>06797     {
<a name="l06798"></a>06798         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06799"></a>06799                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06800"></a>06800     }
<a name="l06801"></a>06801     <span class="keywordflow">else</span>
<a name="l06802"></a>06802     {
<a name="l06803"></a>06803         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06804"></a>06804         <span class="comment">// -----------------------------------------------------</span>
<a name="l06805"></a>06805         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06806"></a>06806         <span class="comment">// -----------------------------------------------------</span>
<a name="l06807"></a>06807         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06808"></a>06808         {
<a name="l06809"></a>06809             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06810"></a>06810                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06811"></a>06811         }
<a name="l06812"></a>06812         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06813"></a>06813         {
<a name="l06814"></a>06814             <span class="keyword">const</span> <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#aee3973dc05c042dab571781a9d454af2">GetAccount</a>(ACCT_NAME);
<a name="l06815"></a>06815 
<a name="l06816"></a>06816             <span class="keywordflow">if</span> (NULL == pAcct)
<a name="l06817"></a>06817             {
<a name="l06818"></a>06818                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve party&#39;s account named: %s\n&quot;</span>,
<a name="l06819"></a>06819                                __FUNCTION__, ACCT_NAME.c_str());
<a name="l06820"></a>06820             }
<a name="l06821"></a>06821             <span class="keywordflow">else</span> <span class="comment">// We found the account...</span>
<a name="l06822"></a>06822             {
<a name="l06823"></a>06823                 <span class="keyword">const</span> std::string str_return(pAcct-&gt;<a class="code" href="class_o_t_party_account.html#adb6df939b40f2abe597cef270073a2fa">GetAssetTypeID</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06824"></a>06824                 <span class="keywordflow">return</span> str_return;
<a name="l06825"></a>06825             }
<a name="l06826"></a>06826         }
<a name="l06827"></a>06827     }
<a name="l06828"></a>06828     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06829"></a>06829     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06830"></a>06830 }
<a name="l06831"></a>06831 
<a name="l06832"></a>06832 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06833"></a>06833 
<a name="l06834"></a><a class="code" href="class_o_t_a_p_i___exec.html#a960e6c5c4819c494e9e5b79b2717d73b">06834</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a960e6c5c4819c494e9e5b79b2717d73b">OTAPI_Exec::Party_GetAcctAgentName</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06835"></a>06835                                                <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06836"></a>06836                                                <span class="keyword">const</span> std::string &amp; ACCT_NAME) <span class="comment">// returns the authorized agent for the named account.</span>
<a name="l06837"></a>06837 {
<a name="l06838"></a>06838     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06839"></a>06839     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06840"></a>06840     <span class="keywordflow">if</span> (ACCT_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_NAME&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06841"></a>06841     <span class="comment">// -----------------------------------------------------</span>
<a name="l06842"></a>06842     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06843"></a>06843     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06844"></a>06844     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06845"></a>06845     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06846"></a>06846     {
<a name="l06847"></a>06847         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06848"></a>06848                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06849"></a>06849     }
<a name="l06850"></a>06850     <span class="keywordflow">else</span>
<a name="l06851"></a>06851     {
<a name="l06852"></a>06852         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06853"></a>06853         <span class="comment">// -----------------------------------------------------</span>
<a name="l06854"></a>06854         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06855"></a>06855         <span class="comment">// -----------------------------------------------------</span>
<a name="l06856"></a>06856         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06857"></a>06857         {
<a name="l06858"></a>06858             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06859"></a>06859                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06860"></a>06860         }
<a name="l06861"></a>06861         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06862"></a>06862         {
<a name="l06863"></a>06863             <span class="keyword">const</span> <a class="code" href="class_o_t_party_account.html">OTPartyAccount</a> * pAcct = pParty-&gt;<a class="code" href="class_o_t_party.html#aee3973dc05c042dab571781a9d454af2">GetAccount</a>(ACCT_NAME);
<a name="l06864"></a>06864 
<a name="l06865"></a>06865             <span class="keywordflow">if</span> (NULL == pAcct)
<a name="l06866"></a>06866             {
<a name="l06867"></a>06867                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve party&#39;s account named: %s\n&quot;</span>,
<a name="l06868"></a>06868                                __FUNCTION__, ACCT_NAME.c_str());
<a name="l06869"></a>06869             }
<a name="l06870"></a>06870             <span class="keywordflow">else</span> <span class="comment">// We found the account...</span>
<a name="l06871"></a>06871             {
<a name="l06872"></a>06872                 <span class="keyword">const</span> std::string str_return(pAcct-&gt;<a class="code" href="class_o_t_party_account.html#a86975046b18ac6d6c5841f5ba0befe69">GetAgentName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06873"></a>06873                 <span class="keywordflow">return</span> str_return;
<a name="l06874"></a>06874             }
<a name="l06875"></a>06875         }
<a name="l06876"></a>06876     }
<a name="l06877"></a>06877     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06878"></a>06878     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06879"></a>06879 }
<a name="l06880"></a>06880 
<a name="l06881"></a>06881 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06882"></a>06882 
<a name="l06883"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3a6b89e1e57b7d76ef9b208e63c13e82">06883</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a3a6b89e1e57b7d76ef9b208e63c13e82">OTAPI_Exec::Party_GetAgentNameByIndex</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06884"></a>06884                                                   <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06885"></a>06885                                                   <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns the name of the agent.</span>
<a name="l06886"></a>06886 {
<a name="l06887"></a>06887     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06888"></a>06888     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06889"></a>06889     <span class="comment">// -----------------------------------------------------</span>
<a name="l06890"></a>06890     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06891"></a>06891     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06892"></a>06892     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06893"></a>06893     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06894"></a>06894     {
<a name="l06895"></a>06895         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06896"></a>06896                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06897"></a>06897     }
<a name="l06898"></a>06898     <span class="keywordflow">else</span>
<a name="l06899"></a>06899     {
<a name="l06900"></a>06900         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06901"></a>06901         <span class="comment">// -----------------------------------------------------</span>
<a name="l06902"></a>06902         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06903"></a>06903         <span class="comment">// -----------------------------------------------------</span>
<a name="l06904"></a>06904         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06905"></a>06905         {
<a name="l06906"></a>06906             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06907"></a>06907                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06908"></a>06908         }
<a name="l06909"></a>06909         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06910"></a>06910         {
<a name="l06911"></a>06911             <span class="keyword">const</span> int32_t nTempIndex   = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>int32_t<span class="keyword">&gt;</span>(nIndex);
<a name="l06912"></a>06912             <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = pParty-&gt;<a class="code" href="class_o_t_party.html#aa3e7fa9717af688b00e1b0b0983fd891">GetAgentByIndex</a>(nTempIndex);
<a name="l06913"></a>06913 
<a name="l06914"></a>06914             <span class="keywordflow">if</span> (NULL == pAgent)
<a name="l06915"></a>06915             {
<a name="l06916"></a>06916                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve the agent at index: %d\n&quot;</span>,
<a name="l06917"></a>06917                                __FUNCTION__, nTempIndex);
<a name="l06918"></a>06918             }
<a name="l06919"></a>06919             <span class="keywordflow">else</span> <span class="comment">// We found the agent...</span>
<a name="l06920"></a>06920             {
<a name="l06921"></a>06921                 <span class="keyword">const</span> std::string str_name(pAgent-&gt;<a class="code" href="class_o_t_agent.html#a123d27f05e46977ecdbe0b83de3c119d">GetName</a>().<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());  <span class="comment">// Success.</span>
<a name="l06922"></a>06922                 <span class="keywordflow">return</span> str_name;
<a name="l06923"></a>06923             }
<a name="l06924"></a>06924         }
<a name="l06925"></a>06925     }
<a name="l06926"></a>06926     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06927"></a>06927     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06928"></a>06928 }
<a name="l06929"></a>06929 
<a name="l06930"></a>06930 
<a name="l06931"></a>06931 <span class="comment">// ----------------------</span>
<a name="l06932"></a>06932 
<a name="l06933"></a>06933 
<a name="l06934"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3fcc85b7d89f3fbc98683ae6c8e2dd9d">06934</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a3fcc85b7d89f3fbc98683ae6c8e2dd9d">OTAPI_Exec::Party_GetAgentID</a>(<span class="keyword">const</span> std::string &amp; THE_CONTRACT,
<a name="l06935"></a>06935                                          <span class="keyword">const</span> std::string &amp; PARTY_NAME,
<a name="l06936"></a>06936                                          <span class="keyword">const</span> std::string &amp; AGENT_NAME) <span class="comment">// returns ID of the agent. (If there is one...)</span>
<a name="l06937"></a>06937 {
<a name="l06938"></a>06938     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06939"></a>06939     <span class="keywordflow">if</span> (PARTY_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PARTY_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06940"></a>06940     <span class="keywordflow">if</span> (AGENT_NAME.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AGENT_NAME&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l06941"></a>06941     <span class="comment">// -----------------------------------------------------</span>
<a name="l06942"></a>06942     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l06943"></a>06943     <a class="code" href="class_o_t_scriptable.html">OTScriptable</a> * pScriptable = <a class="code" href="class_o_t_scriptable.html#a4a89cbc1abd2bac0e5dec64da3452b7a">OTScriptable::InstantiateScriptable</a>(strContract);
<a name="l06944"></a>06944     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTScriptable&gt;</a> theContractAngel;
<a name="l06945"></a>06945     <span class="keywordflow">if</span> (NULL == pScriptable)
<a name="l06946"></a>06946     {
<a name="l06947"></a>06947         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed trying to load smart contract from string:\n\n%s\n\n&quot;</span>,
<a name="l06948"></a>06948                        __FUNCTION__, strContract.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l06949"></a>06949     }
<a name="l06950"></a>06950     <span class="keywordflow">else</span>
<a name="l06951"></a>06951     {
<a name="l06952"></a>06952         theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pScriptable);  <span class="comment">// Auto-cleanup.</span>
<a name="l06953"></a>06953         <span class="comment">// -----------------------------------------------------</span>
<a name="l06954"></a>06954         <a class="code" href="class_o_t_party.html">OTParty</a> * pParty = pScriptable-&gt;<a class="code" href="class_o_t_scriptable.html#acd0f8e884ed00f1d082fa498323d8894">GetParty</a>(PARTY_NAME);
<a name="l06955"></a>06955         <span class="comment">// -----------------------------------------------------</span>
<a name="l06956"></a>06956         <span class="keywordflow">if</span> (NULL == pParty)
<a name="l06957"></a>06957         {
<a name="l06958"></a>06958             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, but failed to retrieve the party with name: %s\n&quot;</span>,
<a name="l06959"></a>06959                            __FUNCTION__, PARTY_NAME.c_str());
<a name="l06960"></a>06960         }
<a name="l06961"></a>06961         <span class="keywordflow">else</span> <span class="comment">// We found the party...</span>
<a name="l06962"></a>06962         {
<a name="l06963"></a>06963             <a class="code" href="class_o_t_agent.html">OTAgent</a> * pAgent = pParty-&gt;<a class="code" href="class_o_t_party.html#af959cf9f0815a145c5a3072eadfaeb14">GetAgent</a>(AGENT_NAME);
<a name="l06964"></a>06964 
<a name="l06965"></a>06965             <span class="keywordflow">if</span> (NULL == pAgent)
<a name="l06966"></a>06966             {
<a name="l06967"></a>06967                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Smart contract loaded up, and party found, but failed to retrieve party&#39;s agent named: %s\n&quot;</span>,
<a name="l06968"></a>06968                                __FUNCTION__, AGENT_NAME.c_str());
<a name="l06969"></a>06969             }
<a name="l06970"></a>06970             <span class="keywordflow">else</span> <span class="comment">// We found the agent...</span>
<a name="l06971"></a>06971             {
<a name="l06972"></a>06972                 std::string str_return;
<a name="l06973"></a>06973                 <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAgentID;
<a name="l06974"></a>06974                 <span class="keywordflow">if</span> (pAgent-&gt;<a class="code" href="class_o_t_agent.html#a1969e4f8a5f13ee34ba0a68d8f082956">IsAnIndividual</a>() &amp;&amp; pAgent-&gt;<a class="code" href="class_o_t_agent.html#ac9a12b4a5e377991024dbe2772c73554">GetNymID</a>(theAgentID))
<a name="l06975"></a>06975                 {
<a name="l06976"></a>06976                     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strTemp(theAgentID);
<a name="l06977"></a>06977                     str_return = strTemp.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l06978"></a>06978                     <span class="keywordflow">return</span> str_return;
<a name="l06979"></a>06979                 }
<a name="l06980"></a>06980             }
<a name="l06981"></a>06981         }
<a name="l06982"></a>06982     }
<a name="l06983"></a>06983     <span class="comment">// -----------------------------------------------------------</span>
<a name="l06984"></a>06984     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l06985"></a>06985 }
<a name="l06986"></a>06986 
<a name="l06987"></a>06987 <span class="comment">// ----------------------------------------------------------</span>
<a name="l06988"></a>06988 
<a name="l06989"></a>06989 
<a name="l06990"></a>06990 
<a name="l06991"></a>06991 
<a name="l06992"></a>06992 
<a name="l06993"></a>06993 
<a name="l06994"></a>06994 
<a name="l06995"></a>06995 <span class="comment">// --------------------------------------------------</span>
<a name="l06996"></a>06996 <span class="comment">// ACTIVATE SMART CONTRACT   (This is a transaction, and messages the server.)</span>
<a name="l06997"></a>06997 <span class="comment">// Take an existing smart contract, which has already been set up, confirmed, etc,</span>
<a name="l06998"></a>06998 <span class="comment">// and then activate it on the server so it can start processing.</span>
<a name="l06999"></a>06999 <span class="comment">//</span>
<a name="l07000"></a>07000 <span class="comment">// See OTAPI_Exec::Create_SmartContract (etc.)</span>
<a name="l07001"></a>07001 <span class="comment">//</span>
<a name="l07002"></a>07002 <span class="comment">// Returns int32_t:</span>
<a name="l07003"></a>07003 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l07004"></a>07004 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l07005"></a>07005 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l07006"></a>07006 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l07007"></a>07007 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l07008"></a>07008 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l07009"></a>07009 <span class="comment">//</span>
<a name="l07010"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2d9125850307fb5b60789c068fa6e2b9">07010</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a2d9125850307fb5b60789c068fa6e2b9">OTAPI_Exec::activateSmartContract</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07011"></a>07011                                           <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07012"></a>07012                                           <span class="keyword">const</span> std::string &amp; THE_SMART_CONTRACT)
<a name="l07013"></a>07013 {
<a name="l07014"></a>07014     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07015"></a>07015     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07016"></a>07016     <span class="keywordflow">if</span> (THE_SMART_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_SMART_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07017"></a>07017 
<a name="l07018"></a>07018     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l07019"></a>07019     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strContract(THE_SMART_CONTRACT);
<a name="l07020"></a>07020 
<a name="l07021"></a>07021     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ab1022d7f5baf3dadf907e1cf1f5adc08">activateSmartContract</a>(theServerID, theUserID, strContract);
<a name="l07022"></a>07022 }
<a name="l07023"></a>07023 
<a name="l07024"></a>07024 
<a name="l07025"></a>07025 
<a name="l07026"></a>07026 
<a name="l07027"></a>07027 
<a name="l07028"></a>07028 <span class="comment">// If a smart contract is already running on the server, this allows a party</span>
<a name="l07029"></a>07029 <span class="comment">// to trigger clauses on that smart contract, by name. This is NOT a transaction,</span>
<a name="l07030"></a>07030 <span class="comment">// but it DOES message the server.</span>
<a name="l07031"></a>07031 <span class="comment">//</span>
<a name="l07032"></a>07032 <span class="comment">// Returns int32_t:</span>
<a name="l07033"></a>07033 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l07034"></a>07034 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l07035"></a>07035 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l07036"></a>07036 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l07037"></a>07037 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l07038"></a>07038 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l07039"></a>07039 <span class="comment">//</span>
<a name="l07040"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9b1d0d0ffda7a21c9b6bb16a4a675d73">07040</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9b1d0d0ffda7a21c9b6bb16a4a675d73">OTAPI_Exec::triggerClause</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07041"></a>07041                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07042"></a>07042                                   <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER,
<a name="l07043"></a>07043                                   <span class="keyword">const</span> std::string &amp; CLAUSE_NAME,
<a name="l07044"></a>07044                                   <span class="keyword">const</span> std::string &amp; STR_PARAM) <span class="comment">// optional param</span>
<a name="l07045"></a>07045 {
<a name="l07046"></a>07046     <span class="keywordflow">if</span> (SERVER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07047"></a>07047     <span class="keywordflow">if</span> (USER_ID.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07048"></a>07048     <span class="keywordflow">if</span> (0 &gt; TRANSACTION_NUMBER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07049"></a>07049     <span class="keywordflow">if</span> (CLAUSE_NAME.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;CLAUSE_NAME&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07050"></a>07050 <span class="comment">//  if (STR_PARAM.empty())      { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;STR_PARAM&quot;          ); OT_FAIL; }  // optional param</span>
<a name="l07051"></a>07051     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l07052"></a>07052                         theUserID(USER_ID);
<a name="l07053"></a>07053     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strClauseName(CLAUSE_NAME);
<a name="l07054"></a>07054     <span class="keyword">const</span> int64_t       lTransactionNum = TRANSACTION_NUMBER;
<a name="l07055"></a>07055     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strParam((STR_PARAM.empty()) ? <span class="stringliteral">&quot;&quot;</span> : STR_PARAM);
<a name="l07056"></a>07056     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0bf5890924481ffbf89bc2a6fb529b04">triggerClause</a>(theServerID,
<a name="l07057"></a>07057                                               theUserID,
<a name="l07058"></a>07058                                               static_cast&lt;int64_t&gt;(lTransactionNum),
<a name="l07059"></a>07059                                               strClauseName,
<a name="l07060"></a>07060                                               STR_PARAM.empty() ? NULL : &amp;strParam);
<a name="l07061"></a>07061 }
<a name="l07062"></a>07062 
<a name="l07063"></a>07063 
<a name="l07064"></a>07064 
<a name="l07065"></a>07065 <span class="comment">/*</span>
<a name="l07066"></a>07066 <span class="comment">OTAPI_Exec::Msg_HarvestTransactionNumbers</span>
<a name="l07067"></a>07067 <span class="comment"></span>
<a name="l07068"></a>07068 <span class="comment">This function will load up the cron item (which is either a market offer, a payment plan,</span>
<a name="l07069"></a>07069 <span class="comment">or a SMART CONTRACT.)  UPDATE: this function operates on messages, not cron items.</span>
<a name="l07070"></a>07070 <span class="comment"></span>
<a name="l07071"></a>07071 <span class="comment">Then it will try to harvest all of the closing transaction numbers for NYM_ID that are</span>
<a name="l07072"></a>07072 <span class="comment">available to be harvested from THE_CRON_ITEM. (There might be zero #s available for that</span>
<a name="l07073"></a>07073 <span class="comment">Nym, which is still a success and will return true. False means error.)</span>
<a name="l07074"></a>07074 <span class="comment"></span>
<a name="l07075"></a>07075 <span class="comment">YOU MIGHT ASK:</span>
<a name="l07076"></a>07076 <span class="comment"></span>
<a name="l07077"></a>07077 <span class="comment">WHY WOULD I WANT to harvest ONLY the closing numbers for the Nym, and not the OPENING</span>
<a name="l07078"></a>07078 <span class="comment">numbers as well? The answer is because for this Nym, the opening number might already</span>
<a name="l07079"></a>07079 <span class="comment">be burned. For example, if Nym just tried to activate a smart contract, and the activation</span>
<a name="l07080"></a>07080 <span class="comment">FAILED, then maybe the opening number is already gone, even though his closing numbers, on the</span>
<a name="l07081"></a>07081 <span class="comment">other hand, are still valid for retrieval. (I have to double check this.)</span>
<a name="l07082"></a>07082 <span class="comment"></span>
<a name="l07083"></a>07083 <span class="comment">HOWEVER, what if the MESSAGE failed, before it even TRIED the transaction? In which case,</span>
<a name="l07084"></a>07084 <span class="comment">the opening number is still good also, and should be retrieved.</span>
<a name="l07085"></a>07085 <span class="comment"></span>
<a name="l07086"></a>07086 <span class="comment">Remember, I have to keep signing for my transaction numbers until they are finally closed out.</span>
<a name="l07087"></a>07087 <span class="comment">They will appear on EVERY balance agreement and transaction statement from here until the end</span>
<a name="l07088"></a>07088 <span class="comment">of time, whenever I finally close out those numbers. If some of them are still good on a failed</span>
<a name="l07089"></a>07089 <span class="comment">transaction, then I want to retrieve them so I can use them, and eventually close them out.</span>
<a name="l07090"></a>07090 <span class="comment"></span>
<a name="l07091"></a>07091 <span class="comment">==&gt; Whereas, what if I am the PARTY to a smart contract, but I am not the actual ACTIVATOR / ORIGINATOR</span>
<a name="l07092"></a>07092 <span class="comment">(who activated the smart contract on the server).  Therefore I never sent any transaction to the</span>
<a name="l07093"></a>07093 <span class="comment">server, and I never burned my opening number. It&#39;s probably still a good #. If my wallet is not a piece</span>
<a name="l07094"></a>07094 <span class="comment">of shit, then I should have a stored copy of any contract that I signed. If it turns out in the future</span>
<a name="l07095"></a>07095 <span class="comment">that that contract wasn&#39;t activated, then I can retrieve not only my closing numbers, but my OPENING</span>
<a name="l07096"></a>07096 <span class="comment">number as well! IN THAT CASE, I would call OTAPI_Exec::HarvestAllNumbers() instead of OTAPI_Exec::HarvestClosingNumbers().</span>
<a name="l07097"></a>07097 <span class="comment"></span>
<a name="l07098"></a>07098 <span class="comment">// -----------------</span>
<a name="l07099"></a>07099 <span class="comment"></span>
<a name="l07100"></a>07100 <span class="comment">UPDATE: The above logic is now handled automatically in OTAPI_Exec::HarvestTransactionNumbers.</span>
<a name="l07101"></a>07101 <span class="comment">Therefore OTAPI_Exec::HarvestClosingNumbers and OTAPI_Exec::HarvestAllNumbers have been removed.</span>
<a name="l07102"></a>07102 <span class="comment"></span>
<a name="l07103"></a>07103 <span class="comment">*/</span>
<a name="l07104"></a>07104 
<a name="l07105"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac54a50dc4fb602bccac015f4af652200">07105</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#ac54a50dc4fb602bccac015f4af652200">OTAPI_Exec::Msg_HarvestTransactionNumbers</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE,
<a name="l07106"></a>07106                                                <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07107"></a>07107                                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bHarvestingForRetry,
<a name="l07108"></a>07108                                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bReplyWasSuccess,
<a name="l07109"></a>07109                                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bReplyWasFailure,
<a name="l07110"></a>07110                                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bTransactionWasSuccess,
<a name="l07111"></a>07111                                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bTransactionWasFailure)
<a name="l07112"></a>07112 {
<a name="l07113"></a>07113     <span class="comment">// -----------------------------------------------------</span>
<a name="l07114"></a>07114     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l07115"></a>07115     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07116"></a>07116     <span class="comment">// -----------------------------------------------------</span>
<a name="l07117"></a>07117     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07118"></a>07118     <span class="keywordflow">if</span> (USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07119"></a>07119     <span class="comment">// -----------------------------------------------------</span>
<a name="l07120"></a>07120     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bHarvestingForRetry    ) &amp;&amp; (<span class="keyword">false</span> != bHarvestingForRetry   ))  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bHarvestingForRetry&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07121"></a>07121     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bReplyWasSuccess       ) &amp;&amp; (<span class="keyword">false</span> != bReplyWasSuccess      ))  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bReplyWasSuccess&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07122"></a>07122     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bReplyWasFailure       ) &amp;&amp; (<span class="keyword">false</span> != bReplyWasFailure      ))  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bReplyWasFailure&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07123"></a>07123     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bTransactionWasSuccess ) &amp;&amp; (<span class="keyword">false</span> != bTransactionWasSuccess))  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bTransactionWasSuccess&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07124"></a>07124     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bTransactionWasFailure ) &amp;&amp; (<span class="keyword">false</span> != bTransactionWasFailure))  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bTransactionWasFailure&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07125"></a>07125     <span class="comment">// -----------------------------------------------------</span>
<a name="l07126"></a>07126     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07127"></a>07127     <span class="comment">// -----------------------------------------------------</span>
<a name="l07128"></a>07128     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l07129"></a>07129     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strMsg(THE_MESSAGE);
<a name="l07130"></a>07130     <span class="keywordflow">if</span> (!strMsg.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l07131"></a>07131     {
<a name="l07132"></a>07132         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to load message from empty string.\n&quot;</span>, __FUNCTION__);
<a name="l07133"></a>07133         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07134"></a>07134     }
<a name="l07135"></a>07135     <span class="comment">// -----------------------------------</span>
<a name="l07136"></a>07136     <span class="comment">// Maybe it&#39;s not a message at all. Maybe it&#39;s a cron item</span>
<a name="l07137"></a>07137     <span class="comment">// (smart contract... payment plan...)</span>
<a name="l07138"></a>07138     <span class="comment">//</span>
<a name="l07139"></a>07139     <span class="keywordflow">if</span> (strMsg.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;PAYMENT PLAN&quot;</span>) || strMsg.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;SMARTCONTRACT&quot;</span>))
<a name="l07140"></a>07140     {
<a name="l07141"></a>07141         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strCronItem = strMsg;
<a name="l07142"></a>07142 
<a name="l07143"></a>07143         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Attempting to harvest transaction numbers from cron item...\n&quot;</span>,
<a name="l07144"></a>07144                        __FUNCTION__);
<a name="l07145"></a>07145         <span class="comment">// -----------------------------------------------------</span>
<a name="l07146"></a>07146         <span class="comment">// Unfortunately the ONLY reason we are loading up this cron item here,</span>
<a name="l07147"></a>07147         <span class="comment">// is so we can get the server ID off of it.</span>
<a name="l07148"></a>07148         <span class="comment">//</span>
<a name="l07149"></a>07149         <a class="code" href="class_o_t_cron_item.html">OTCronItem</a> * pCronItem = <a class="code" href="class_o_t_cron_item.html#ad448bfdee05f5a1086d19d9edb2e2518">OTCronItem::NewCronItem</a>(strCronItem);
<a name="l07150"></a>07150         <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTCronItem&gt;</a> theContractAngel;
<a name="l07151"></a>07151         <span class="keywordflow">if</span> (NULL == pCronItem)
<a name="l07152"></a>07152         {
<a name="l07153"></a>07153             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to load message from string.&quot;</span>, __FUNCTION__);
<a name="l07154"></a>07154 
<a name="l07155"></a>07155             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Error trying to load the cron item from string (a cron item is a smart contract, or &quot;</span>
<a name="l07156"></a>07156                 <span class="stringliteral">&quot;some other recurring transaction such as a market offer, or a payment plan.) Contents:\n\n%s\n\n&quot;</span>,
<a name="l07157"></a>07157                 __FUNCTION__, strCronItem.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07158"></a>07158             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07159"></a>07159         }
<a name="l07160"></a>07160         <span class="keywordflow">else</span>
<a name="l07161"></a>07161             theContractAngel.<a class="code" href="class_o_t_cleanup.html#a00a399db45f730439d2263d4429d00c1">SetCleanupTarget</a>(*pCronItem);  <span class="comment">// Auto-cleanup.</span>
<a name="l07162"></a>07162         <span class="comment">// -----------------------------------------------------</span>
<a name="l07163"></a>07163         <span class="comment">// NOTE:</span>
<a name="l07164"></a>07164         <span class="comment">// If a CronItem is passed in here instead of a Message, that means the client</span>
<a name="l07165"></a>07165         <span class="comment">// didn&#39;t even TRY to send the message. He failed before reaching that point.</span>
<a name="l07166"></a>07166         <span class="comment">// Therefore in this one, strange case, we don&#39;t really care about all the bools</span>
<a name="l07167"></a>07167         <span class="comment">// that were passed in here. We&#39;re just going to harvest ALL the numbers, and</span>
<a name="l07168"></a>07168         <span class="comment">// ASSUME all the bools were false.</span>
<a name="l07169"></a>07169         <span class="comment">// Here goes...</span>
<a name="l07170"></a>07170         <span class="comment">//</span>
<a name="l07171"></a>07171         <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3455b2ed3c8b4abef30b1eaaafa595ab">HarvestAllNumbers</a>(pCronItem-&gt;<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>(), theUserID, strCronItem);
<a name="l07172"></a>07172     }
<a name="l07173"></a>07173     <span class="comment">// ----------------------------------------------------------------</span>
<a name="l07174"></a>07174     <span class="comment">// Maybe it&#39;s not a message at all. Maybe it&#39;s a basket exchange request that never</span>
<a name="l07175"></a>07175     <span class="comment">// even got sent as a message...</span>
<a name="l07176"></a>07176     <span class="comment">//</span>
<a name="l07177"></a>07177     <span class="keywordflow">if</span> (strMsg.<a class="code" href="class_o_t_string.html#acb212b06102322aebb96090601794825">Contains</a>(<span class="stringliteral">&quot;currencyBasket&quot;</span>))
<a name="l07178"></a>07178     {
<a name="l07179"></a>07179         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> &amp; strBasket = strMsg;
<a name="l07180"></a>07180 
<a name="l07181"></a>07181         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Attempting to harvest transaction numbers from a basket currency exchange request...\n&quot;</span>,
<a name="l07182"></a>07182                        __FUNCTION__);
<a name="l07183"></a>07183         <span class="comment">// -----------------------------------------------------</span>
<a name="l07184"></a>07184         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__);
<a name="l07185"></a>07185         <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07186"></a>07186         <span class="comment">// ---------------------------------</span>
<a name="l07187"></a>07187         <a class="code" href="class_o_t_basket.html">OTBasket</a> theRequestBasket;
<a name="l07188"></a>07188 
<a name="l07189"></a>07189         <span class="keywordflow">if</span> (theRequestBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strBasket))
<a name="l07190"></a>07190         {
<a name="l07191"></a>07191             <span class="keywordflow">if</span> (!theRequestBasket.<a class="code" href="class_o_t_basket.html#ada8331e15bbe66127c23c5e405adcfa7">IsExchanging</a>())
<a name="l07192"></a>07192             {
<a name="l07193"></a>07193                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: This is apparently NOT a basket exchange request!\nContents:\n%s\n&quot;</span>,
<a name="l07194"></a>07194                               __FUNCTION__, strBasket.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07195"></a>07195                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07196"></a>07196             }
<a name="l07197"></a>07197             <span class="comment">// -------------------------------------------------</span>
<a name="l07198"></a>07198             <span class="comment">// Now we need to find the account ID (so we can find the server ID...)</span>
<a name="l07199"></a>07199             <span class="comment">//</span>
<a name="l07200"></a>07200             <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theRequestBasket.<a class="code" href="class_o_t_basket.html#ab555be54ac5511072afefe94ee15105a">GetRequestAccountID</a>(),
<a name="l07201"></a>07201                                                                    __FUNCTION__);
<a name="l07202"></a>07202             <span class="keywordflow">if</span> (NULL == pAccount)
<a name="l07203"></a>07203             {
<a name="l07204"></a>07204                 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theRequestBasket.<a class="code" href="class_o_t_basket.html#ab555be54ac5511072afefe94ee15105a">GetRequestAccountID</a>());
<a name="l07205"></a>07205                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Unable to find the main account based on the ID from the exchange request: %s\n&quot;</span>,
<a name="l07206"></a>07206                               __FUNCTION__, strAcctID.Get());
<a name="l07207"></a>07207                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07208"></a>07208             }
<a name="l07209"></a>07209             <span class="comment">// -------------------------------------------------</span>
<a name="l07210"></a>07210             <span class="comment">// Now let&#39;s get the server ID...</span>
<a name="l07211"></a>07211             <span class="comment">//</span>
<a name="l07212"></a>07212             <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), __FUNCTION__);
<a name="l07213"></a>07213 
<a name="l07214"></a>07214             <span class="keywordflow">if</span> (NULL == pServer)
<a name="l07215"></a>07215             {
<a name="l07216"></a>07216                 <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strServerID(pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>());
<a name="l07217"></a>07217                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Unable to find the server based on the exchange request: %s\n&quot;</span>,
<a name="l07218"></a>07218                               __FUNCTION__, strServerID.Get());
<a name="l07219"></a>07219                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07220"></a>07220             }
<a name="l07221"></a>07221             <span class="comment">// -------------------------------------------------</span>
<a name="l07222"></a>07222             theRequestBasket.<a class="code" href="class_o_t_basket.html#a4fa7db8a28ae3adb021cd343b69fe2ff">HarvestClosingNumbers</a>(*pNym, pAccount-&gt;<a class="code" href="class_o_t_transaction_type.html#a59fc08d52ef5bc0ea546da7a56e86fa5">GetPurportedServerID</a>(), <span class="keyword">true</span>); <span class="comment">// bSave=true</span>
<a name="l07223"></a>07223             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07224"></a>07224         }
<a name="l07225"></a>07225         <span class="keywordflow">else</span>
<a name="l07226"></a>07226             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading original basket request.\n&quot;</span>, __FUNCTION__);
<a name="l07227"></a>07227 
<a name="l07228"></a>07228         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07229"></a>07229     }
<a name="l07230"></a>07230     <span class="comment">// ---------------------------------------------------</span>
<a name="l07231"></a>07231     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMsg))
<a name="l07232"></a>07232     {
<a name="l07233"></a>07233         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to load message from string.\n&quot;</span>, __FUNCTION__);
<a name="l07234"></a>07234         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07235"></a>07235     }
<a name="l07236"></a>07236     <span class="comment">// ---------------------------------------------------</span>
<a name="l07237"></a>07237     <span class="comment">// By this point, we have the actual message loaded up.</span>
<a name="l07238"></a>07238     <span class="comment">//</span>
<a name="l07239"></a>07239     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af1e69026904ab8b2a6a3a1185801bdf7">Msg_HarvestTransactionNumbers</a>(theMessage,
<a name="l07240"></a>07240                                                                                theUserID,
<a name="l07241"></a>07241                                                                                bHarvestingForRetry,
<a name="l07242"></a>07242                                                                                bReplyWasSuccess,
<a name="l07243"></a>07243                                                                                bReplyWasFailure,
<a name="l07244"></a>07244                                                                                bTransactionWasSuccess,
<a name="l07245"></a>07245                                                                                bTransactionWasFailure);
<a name="l07246"></a>07246     <span class="keywordflow">return</span> bSuccess ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l07247"></a>07247 }
<a name="l07248"></a>07248 
<a name="l07249"></a>07249 
<a name="l07250"></a>07250 
<a name="l07251"></a>07251 
<a name="l07252"></a>07252 <span class="comment">//bool OTAPI_Exec::HarvestClosingNumbers(const std::string &amp; SERVER_ID,</span>
<a name="l07253"></a>07253 <span class="comment">//                                  const std::string &amp; NYM_ID,</span>
<a name="l07254"></a>07254 <span class="comment">//                                  const std::string &amp; THE_CRON_ITEM)</span>
<a name="l07255"></a>07255 <span class="comment">//{</span>
<a name="l07256"></a>07256 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != SERVER_ID, &quot;OTAPI_Exec::HarvestClosingNumbers: Null SERVER_ID passed in.&quot;);</span>
<a name="l07257"></a>07257 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != NYM_ID, &quot;OTAPI_Exec::HarvestClosingNumbers: Null NYM_ID passed in.&quot;);</span>
<a name="l07258"></a>07258 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != THE_CRON_ITEM, &quot;OTAPI_Exec::HarvestClosingNumbers: Null THE_CRON_ITEM passed in.&quot;);</span>
<a name="l07259"></a>07259 <span class="comment">//  // -----------------------------------------------------</span>
<a name="l07260"></a>07260 <span class="comment">//  const OTIdentifier  theNymID(NYM_ID), theServerID(SERVER_ID);</span>
<a name="l07261"></a>07261 <span class="comment">//  const OTString      strContract(THE_CRON_ITEM);</span>
<a name="l07262"></a>07262 <span class="comment">//  // -----------------------------------------------------</span>
<a name="l07263"></a>07263 <span class="comment">//  const bool &amp; bHarvested = OTAPI()-&gt;HarvestClosingNumbers(theServerID, theNymID, strContract);</span>
<a name="l07264"></a>07264 <span class="comment">//</span>
<a name="l07265"></a>07265 <span class="comment">//  return bHarvested ? true : false;</span>
<a name="l07266"></a>07266 <span class="comment">//}</span>
<a name="l07267"></a>07267 <span class="comment">//</span>
<a name="l07268"></a>07268 <span class="comment">//</span>
<a name="l07269"></a>07269 <span class="comment">// NOTE: usually you will want to call OTAPI_Exec::HarvestClosingNumbers, since the Opening number is usually</span>
<a name="l07270"></a>07270 <span class="comment">// burned up from some failed transaction or whatever. You don&#39;t want to harvest the opening number usually,</span>
<a name="l07271"></a>07271 <span class="comment">// just the closing numbers. (If the opening number is burned up, yet you still harvest it, then your OT wallet</span>
<a name="l07272"></a>07272 <span class="comment">// will end up using that number again on some other transaction, which will obviously then fail since the number</span>
<a name="l07273"></a>07273 <span class="comment">// isn&#39;t good anymore.)</span>
<a name="l07274"></a>07274 <span class="comment">// This function is only for those cases where you are sure that the opening transaction # hasn&#39;t been burned yet,</span>
<a name="l07275"></a>07275 <span class="comment">// such as when the message failed and the transaction wasn&#39;t attempted (because it never got that far) or such as</span>
<a name="l07276"></a>07276 <span class="comment">// when the contract simply never got signed or activated by one of the other parties, and so you want to claw your</span>
<a name="l07277"></a>07277 <span class="comment">// #&#39;s back, and since in that case your opening number is still good, you would use the below function to get it back.</span>
<a name="l07278"></a>07278 <span class="comment">//</span>
<a name="l07279"></a>07279 <span class="comment">//bool OTAPI_Exec::HarvestAllNumbers(const std::string &amp; SERVER_ID,</span>
<a name="l07280"></a>07280 <span class="comment">//                              const std::string &amp; NYM_ID,</span>
<a name="l07281"></a>07281 <span class="comment">//                              const std::string &amp; THE_CRON_ITEM)</span>
<a name="l07282"></a>07282 <span class="comment">//{</span>
<a name="l07283"></a>07283 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != SERVER_ID, &quot;OTAPI_Exec::HarvestAllNumbers: Null SERVER_ID passed in.&quot;);</span>
<a name="l07284"></a>07284 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != NYM_ID, &quot;OTAPI_Exec::HarvestAllNumbers: Null NYM_ID passed in.&quot;);</span>
<a name="l07285"></a>07285 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != THE_CRON_ITEM, &quot;OTAPI_Exec::HarvestAllNumbers: Null THE_CRON_ITEM passed in.&quot;);</span>
<a name="l07286"></a>07286 <span class="comment">//  // -----------------------------------------------------</span>
<a name="l07287"></a>07287 <span class="comment">//  const OTIdentifier  theNymID(NYM_ID), theServerID(SERVER_ID);</span>
<a name="l07288"></a>07288 <span class="comment">//  const OTString      strContract(THE_CRON_ITEM);</span>
<a name="l07289"></a>07289 <span class="comment">//  // -----------------------------------------------------</span>
<a name="l07290"></a>07290 <span class="comment">//  const bool &amp; bHarvested = OTAPI()-&gt;HarvestAllNumbers(theServerID, theNymID, strContract);</span>
<a name="l07291"></a>07291 <span class="comment">//</span>
<a name="l07292"></a>07292 <span class="comment">//  return bHarvested ? true : false;</span>
<a name="l07293"></a>07293 <span class="comment">//}</span>
<a name="l07294"></a>07294 
<a name="l07295"></a>07295 
<a name="l07296"></a>07296 
<a name="l07297"></a>07297 
<a name="l07298"></a>07298 
<a name="l07299"></a>07299 
<a name="l07300"></a>07300 
<a name="l07301"></a>07301 <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07302"></a>07302 <span class="comment">// LOAD PUBLIC KEY (of other users, where no private key is available)</span>
<a name="l07303"></a>07303 <span class="comment">// This is the &quot;address book&quot; versus the private Nym.</span>
<a name="l07304"></a>07304 <span class="comment">// If nothing found in the address book, it still tries to load</span>
<a name="l07305"></a>07305 <span class="comment">// a Private Nym (just to get the pubkey from it.)</span>
<a name="l07306"></a>07306 <span class="comment">// -- from local storage</span>
<a name="l07307"></a>07307 <span class="comment">//</span>
<a name="l07308"></a>07308 <span class="comment">// Return as STRING (NOT escaped.)</span>
<a name="l07309"></a>07309 <span class="comment">//</span>
<a name="l07310"></a>07310 <span class="comment">// Users will most likely store public keys of OTHER users, and they will need</span>
<a name="l07311"></a>07311 <span class="comment">// to load those from time to time, especially to verify signatures, etc.</span>
<a name="l07312"></a>07312 <span class="comment">//</span>
<a name="l07313"></a><a class="code" href="class_o_t_a_p_i___exec.html#af56df073501c675b39619e0a8961b3df">07313</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af56df073501c675b39619e0a8961b3df">OTAPI_Exec::LoadPubkey_Encryption</a>(<span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns &quot;&quot;, or a public key.</span>
<a name="l07314"></a>07314 {
<a name="l07315"></a>07315     <span class="keywordflow">if</span> (USER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07316"></a>07316     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07317"></a>07317     <a class="code" href="class_o_t_string.html">OTString</a> strPubkey; <span class="comment">// For the output</span>
<a name="l07318"></a>07318     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07319"></a>07319     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l07320"></a>07320     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     NYM_ID(USER_ID);
<a name="l07321"></a>07321     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData); <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l07322"></a>07322     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07323"></a>07323     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07324"></a>07324     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7a7b836bb9e8e0df7b3601f44e1b7220">GetPublicEncrKey</a>().<a class="code" href="class_o_t_asymmetric_key.html#ab4eee84fb4faf0a374fa10f110853214">GetPublicKey</a>(strPubkey, <span class="keyword">false</span>)) <span class="comment">// bEscaped defaults to true. 6/13/12</span>
<a name="l07325"></a>07325     {
<a name="l07326"></a>07326         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
<a name="l07327"></a>07327         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure retrieving encryption pubkey from Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07328"></a>07328     }
<a name="l07329"></a>07329     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07330"></a>07330     {
<a name="l07331"></a>07331         std::string pBuf = strPubkey.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07332"></a>07332         <span class="keywordflow">return</span> pBuf;
<a name="l07333"></a>07333     }
<a name="l07334"></a>07334     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07335"></a>07335 }
<a name="l07336"></a>07336 
<a name="l07337"></a><a class="code" href="class_o_t_a_p_i___exec.html#aec2658b220e18c797162c477fe2f5c9c">07337</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aec2658b220e18c797162c477fe2f5c9c">OTAPI_Exec::LoadPubkey_Signing</a>(<span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns &quot;&quot;, or a public key.</span>
<a name="l07338"></a>07338 {
<a name="l07339"></a>07339     <span class="keywordflow">if</span> (USER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07340"></a>07340     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07341"></a>07341     <a class="code" href="class_o_t_string.html">OTString</a> strPubkey; <span class="comment">// For the output</span>
<a name="l07342"></a>07342     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07343"></a>07343     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a>   thePWData(<a class="code" href="_o_t_callback_8hpp.html#aec99f1909896090ab9b64ce848f50c6a">OT_PW_DISPLAY</a>);
<a name="l07344"></a>07344     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>     NYM_ID(USER_ID);
<a name="l07345"></a>07345     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>    * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(NYM_ID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData); <span class="comment">// This tries to get, then tries to load as public, then tries to load as private.</span>
<a name="l07346"></a>07346     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07347"></a>07347     <span class="comment">// ---------------------------------------------------------</span>
<a name="l07348"></a>07348     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aa60e86ffafcfba7c68801530c12c9927">GetPublicSignKey</a>().<a class="code" href="class_o_t_asymmetric_key.html#ab4eee84fb4faf0a374fa10f110853214">GetPublicKey</a>(strPubkey, <span class="keyword">false</span>)) <span class="comment">// bEscaped defaults to true. 6/13/12</span>
<a name="l07349"></a>07349     {
<a name="l07350"></a>07350         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
<a name="l07351"></a>07351         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure retrieving signing pubkey from Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07352"></a>07352     }
<a name="l07353"></a>07353     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07354"></a>07354     {
<a name="l07355"></a>07355         std::string pBuf = strPubkey.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07356"></a>07356         <span class="keywordflow">return</span> pBuf;
<a name="l07357"></a>07357     }
<a name="l07358"></a>07358     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07359"></a>07359 }
<a name="l07360"></a>07360 
<a name="l07361"></a>07361 
<a name="l07362"></a>07362 
<a name="l07363"></a>07363 <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07364"></a>07364 <span class="comment">// LOAD USER PUBLIC KEY  -- from local storage</span>
<a name="l07365"></a>07365 <span class="comment">//</span>
<a name="l07366"></a>07366 <span class="comment">// (return as STRING)</span>
<a name="l07367"></a>07367 <span class="comment">//</span>
<a name="l07368"></a><a class="code" href="class_o_t_a_p_i___exec.html#a27fefe73c76c39085b549433f25ae809">07368</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a27fefe73c76c39085b549433f25ae809">OTAPI_Exec::LoadUserPubkey_Encryption</a>(<span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns &quot;&quot;, or a public key.</span>
<a name="l07369"></a>07369 {
<a name="l07370"></a>07370     <span class="keywordflow">if</span> (USER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07371"></a>07371     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07372"></a>07372     <a class="code" href="class_o_t_string.html">OTString</a> strPubkey; <span class="comment">// For the output</span>
<a name="l07373"></a>07373     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07374"></a>07374     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    NYM_ID(USER_ID);
<a name="l07375"></a>07375     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>   * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID); <span class="comment">// No need to cleanup.</span>
<a name="l07376"></a>07376     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07377"></a>07377     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07378"></a>07378     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a7a7b836bb9e8e0df7b3601f44e1b7220">GetPublicEncrKey</a>().<a class="code" href="class_o_t_asymmetric_key.html#ab4eee84fb4faf0a374fa10f110853214">GetPublicKey</a>(strPubkey))
<a name="l07379"></a>07379     {
<a name="l07380"></a>07380         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
<a name="l07381"></a>07381         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure retrieving encryption pubkey from Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07382"></a>07382     }
<a name="l07383"></a>07383     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07384"></a>07384     {
<a name="l07385"></a>07385         std::string pBuf = strPubkey.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07386"></a>07386         <span class="keywordflow">return</span> pBuf;
<a name="l07387"></a>07387     }
<a name="l07388"></a>07388     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07389"></a>07389 }
<a name="l07390"></a>07390 
<a name="l07391"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab8e9357c59623aad324b56a0e5319f44">07391</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab8e9357c59623aad324b56a0e5319f44">OTAPI_Exec::LoadUserPubkey_Signing</a>(<span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns &quot;&quot;, or a public key.</span>
<a name="l07392"></a>07392 {
<a name="l07393"></a>07393     <span class="keywordflow">if</span> (USER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07394"></a>07394     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07395"></a>07395     <a class="code" href="class_o_t_string.html">OTString</a> strPubkey; <span class="comment">// For the output</span>
<a name="l07396"></a>07396     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07397"></a>07397     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    NYM_ID(USER_ID);
<a name="l07398"></a>07398     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>   * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID); <span class="comment">// No need to cleanup.</span>
<a name="l07399"></a>07399     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07400"></a>07400     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07401"></a>07401     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#aa60e86ffafcfba7c68801530c12c9927">GetPublicSignKey</a>().<a class="code" href="class_o_t_asymmetric_key.html#ab4eee84fb4faf0a374fa10f110853214">GetPublicKey</a>(strPubkey))
<a name="l07402"></a>07402     {
<a name="l07403"></a>07403         <a class="code" href="class_o_t_string.html">OTString</a> strNymID(NYM_ID);
<a name="l07404"></a>07404         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure retrieving signing pubkey from Nym: %s\n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l07405"></a>07405     }
<a name="l07406"></a>07406     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07407"></a>07407     {
<a name="l07408"></a>07408         std::string pBuf = strPubkey.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07409"></a>07409         <span class="keywordflow">return</span> pBuf;
<a name="l07410"></a>07410     }
<a name="l07411"></a>07411     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07412"></a>07412 }
<a name="l07413"></a>07413 
<a name="l07414"></a>07414 
<a name="l07415"></a>07415 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l07416"></a>07416 <span class="comment">//</span>
<a name="l07417"></a>07417 <span class="comment">// Verify that USER_ID (including its Private Key) is an</span>
<a name="l07418"></a>07418 <span class="comment">// available and verified user in local storage.</span>
<a name="l07419"></a>07419 <span class="comment">//</span>
<a name="l07420"></a>07420 <span class="comment">// Loads the user&#39;s private key, verifies, then returns true or false.</span>
<a name="l07421"></a>07421 <span class="comment">//</span>
<a name="l07422"></a><a class="code" href="class_o_t_a_p_i___exec.html#afa8f5a1b2e21636b59f90a3b60f7aa80">07422</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#afa8f5a1b2e21636b59f90a3b60f7aa80">OTAPI_Exec::VerifyUserPrivateKey</a>(<span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns bool</span>
<a name="l07423"></a>07423 {
<a name="l07424"></a>07424     <span class="keywordflow">if</span> (USER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07425"></a>07425     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07426"></a>07426     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    NYM_ID(USER_ID);
<a name="l07427"></a>07427     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a>   * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(NYM_ID); <span class="comment">// No need to cleanup.</span>
<a name="l07428"></a>07428     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07429"></a>07429     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l07430"></a>07430     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07431"></a>07431 }
<a name="l07432"></a>07432 
<a name="l07433"></a>07433 
<a name="l07434"></a>07434 
<a name="l07435"></a>07435 <span class="comment">// --------------------------------------------------</span>
<a name="l07436"></a>07436 <span class="comment">//</span>
<a name="l07437"></a>07437 <span class="comment">// Is Mint32_t Still Good ?   true  (1) == Yes, this mint32_t is still good.</span>
<a name="l07438"></a>07438 <span class="comment">//                        false (0) == No: expired or other error.</span>
<a name="l07439"></a>07439 <span class="comment">//</span>
<a name="l07440"></a><a class="code" href="class_o_t_a_p_i___exec.html#a00f16d7a45e330d3d27fa562f49ada91">07440</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a00f16d7a45e330d3d27fa562f49ada91">OTAPI_Exec::Mint_IsStillGood</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07441"></a>07441                                 <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID)
<a name="l07442"></a>07442 {
<a name="l07443"></a>07443     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07444"></a>07444     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07445"></a>07445 
<a name="l07446"></a>07446     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetID(ASSET_TYPE_ID);
<a name="l07447"></a>07447     <span class="comment">// -----------------------------------------------------</span>
<a name="l07448"></a>07448     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07449"></a>07449     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07450"></a>07450     <a class="code" href="class_o_t_mint.html">OTMint</a> * pMint = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7ed4ec7967a76d735047e5bae1574bf5">LoadMint</a>(theServerID, theAssetID);
<a name="l07451"></a>07451 
<a name="l07452"></a>07452     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07453"></a>07453     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMint&gt;</a>   theMintAngel(pMint); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07454"></a>07454 
<a name="l07455"></a>07455     <span class="keywordflow">if</span> (NULL == pMint)
<a name="l07456"></a>07456         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadMint.\nServer: %s\n Asset Type: %s\n&quot;</span>,
<a name="l07457"></a>07457                        __FUNCTION__, SERVER_ID.c_str(), ASSET_TYPE_ID.c_str());
<a name="l07458"></a>07458     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07459"></a>07459     {
<a name="l07460"></a>07460         <span class="keywordtype">bool</span> bExpired = pMint-&gt;<a class="code" href="class_o_t_mint.html#ae2aa73becb8bd2a00221860520fb8f4e">Expired</a>();
<a name="l07461"></a>07461 
<a name="l07462"></a>07462         <span class="keywordflow">if</span> (!bExpired)
<a name="l07463"></a>07463             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07464"></a>07464     }
<a name="l07465"></a>07465     <span class="comment">// -----------------------------------------------------</span>
<a name="l07466"></a>07466     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07467"></a>07467 }
<a name="l07468"></a>07468 
<a name="l07469"></a>07469 
<a name="l07470"></a>07470 
<a name="l07471"></a><a class="code" href="class_o_t_a_p_i___exec.html#abdede0ee9c0f359d02a405ef0e590863">07471</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abdede0ee9c0f359d02a405ef0e590863">OTAPI_Exec::LoadMint</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07472"></a>07472                             <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID) <span class="comment">// returns &quot;&quot;, or a mint</span>
<a name="l07473"></a>07473 {
<a name="l07474"></a>07474     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07475"></a>07475     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07476"></a>07476 
<a name="l07477"></a>07477     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07478"></a>07478     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l07479"></a>07479 
<a name="l07480"></a>07480     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07481"></a>07481     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07482"></a>07482     <a class="code" href="class_o_t_mint.html">OTMint</a> * pMint = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7ed4ec7967a76d735047e5bae1574bf5">LoadMint</a>(theServerID, theAssetID);
<a name="l07483"></a>07483 
<a name="l07484"></a>07484     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07485"></a>07485     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMint&gt;</a>   theMintAngel(pMint); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07486"></a>07486 
<a name="l07487"></a>07487     <span class="keywordflow">if</span> (NULL == pMint)
<a name="l07488"></a>07488         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;OTAPI_Exec::LoadMint: Failure calling OT_API::LoadMint.\nServer: %s\n Asset Type: %s\n&quot;</span>,
<a name="l07489"></a>07489                        __FUNCTION__, SERVER_ID.c_str(), ASSET_TYPE_ID.c_str());
<a name="l07490"></a>07490     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07491"></a>07491     {
<a name="l07492"></a>07492         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pMint); <span class="comment">// For the output</span>
<a name="l07493"></a>07493         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07494"></a>07494         <span class="keywordflow">return</span> pBuf;
<a name="l07495"></a>07495     }
<a name="l07496"></a>07496     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07497"></a>07497 }
<a name="l07498"></a>07498 
<a name="l07499"></a>07499 
<a name="l07500"></a><a class="code" href="class_o_t_a_p_i___exec.html#a610d699de1a08f3fbed94990cf01b13e">07500</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a610d699de1a08f3fbed94990cf01b13e">OTAPI_Exec::LoadAssetContract</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID) <span class="comment">// returns &quot;&quot;, or an asset contract</span>
<a name="l07501"></a>07501 {
<a name="l07502"></a>07502     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null ASSET_TYPE_ID passed in!\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07503"></a>07503 
<a name="l07504"></a>07504     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l07505"></a>07505 
<a name="l07506"></a>07506     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07507"></a>07507     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07508"></a>07508     <a class="code" href="class_o_t_asset_contract.html">OTAssetContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a9e0c39f51b0c700bfeb378d7ab868724">LoadAssetContract</a>(theAssetID);
<a name="l07509"></a>07509 
<a name="l07510"></a>07510     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07511"></a>07511     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAssetContract&gt;</a>  theAngel(pContract); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07512"></a>07512 
<a name="l07513"></a>07513     <span class="keywordflow">if</span> (NULL == pContract)
<a name="l07514"></a>07514     {
<a name="l07515"></a>07515         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadAssetContract.\n Asset Type: %s\n&quot;</span>,
<a name="l07516"></a>07516                        __FUNCTION__, ASSET_TYPE_ID.c_str());
<a name="l07517"></a>07517     }
<a name="l07518"></a>07518     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07519"></a>07519     {
<a name="l07520"></a>07520         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pContract); <span class="comment">// For the output</span>
<a name="l07521"></a>07521         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07522"></a>07522         <span class="keywordflow">return</span> pBuf;
<a name="l07523"></a>07523     }
<a name="l07524"></a>07524     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07525"></a>07525 }
<a name="l07526"></a>07526 
<a name="l07527"></a>07527 
<a name="l07528"></a><a class="code" href="class_o_t_a_p_i___exec.html#a056a4968b8d9793fb70a7b4b892fb212">07528</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a056a4968b8d9793fb70a7b4b892fb212">OTAPI_Exec::LoadServerContract</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID) <span class="comment">// returns &quot;&quot;, or an asset contract</span>
<a name="l07529"></a>07529 {
<a name="l07530"></a>07530     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null SERVER_ID passed in!\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07531"></a>07531 
<a name="l07532"></a>07532     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07533"></a>07533 
<a name="l07534"></a>07534     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07535"></a>07535     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07536"></a>07536     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pContract = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#adeed94c645c2e2330e536520b9fa5664">LoadServerContract</a>(theServerID);
<a name="l07537"></a>07537 
<a name="l07538"></a>07538     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07539"></a>07539     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTServerContract&gt;</a> theAngel(pContract); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07540"></a>07540 
<a name="l07541"></a>07541     <span class="keywordflow">if</span> (NULL == pContract)
<a name="l07542"></a>07542     {
<a name="l07543"></a>07543         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadServerContract.\nServer ID: %s\n&quot;</span>,
<a name="l07544"></a>07544                        __FUNCTION__, SERVER_ID.c_str());
<a name="l07545"></a>07545     }
<a name="l07546"></a>07546     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07547"></a>07547     {
<a name="l07548"></a>07548         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pContract); <span class="comment">// For the output</span>
<a name="l07549"></a>07549         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07550"></a>07550         <span class="keywordflow">return</span> pBuf;
<a name="l07551"></a>07551     }
<a name="l07552"></a>07552     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07553"></a>07553 }
<a name="l07554"></a>07554 
<a name="l07555"></a>07555 
<a name="l07556"></a>07556 <span class="comment">// --------------------------------------------------------------</span>
<a name="l07557"></a>07557 <span class="comment">// LOAD ACCOUNT / INBOX / OUTBOX   --  (from local storage)</span>
<a name="l07558"></a>07558 <span class="comment">//</span>
<a name="l07559"></a>07559 <span class="comment">// Loads an acct, or inbox or outbox, based on account ID, (from local storage)</span>
<a name="l07560"></a>07560 <span class="comment">// and returns it as string (or returns &quot;&quot; if it couldn&#39;t load it.)</span>
<a name="l07561"></a>07561 <span class="comment">//</span>
<a name="l07562"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac8dc06202229e3ecd7c6284b274f2745">07562</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ac8dc06202229e3ecd7c6284b274f2745">OTAPI_Exec::LoadAssetAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07563"></a>07563                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07564"></a>07564                                     <span class="keyword">const</span> std::string &amp; ACCOUNT_ID) <span class="comment">// Returns &quot;&quot;, or an account.</span>
<a name="l07565"></a>07565 {
<a name="l07566"></a>07566     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07567"></a>07567     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07568"></a>07568     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07569"></a>07569 
<a name="l07570"></a>07570     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07571"></a>07571     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07572"></a>07572     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l07573"></a>07573 
<a name="l07574"></a>07574     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07575"></a>07575     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07576"></a>07576     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ad8538f636eb127ddcb4ca4a72ec7cc88">LoadAssetAccount</a>(theServerID, theUserID, theAccountID);
<a name="l07577"></a>07577 
<a name="l07578"></a>07578     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07579"></a>07579     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTAccount&gt;</a>    theAngel(pAccount); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07580"></a>07580 
<a name="l07581"></a>07581     <span class="keywordflow">if</span> (NULL == pAccount)
<a name="l07582"></a>07582     {
<a name="l07583"></a>07583         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadAssetAccount.\nAccount ID: %s\n&quot;</span>,
<a name="l07584"></a>07584                        __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l07585"></a>07585     }
<a name="l07586"></a>07586     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07587"></a>07587     {
<a name="l07588"></a>07588         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pAccount); <span class="comment">// For the output</span>
<a name="l07589"></a>07589         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07590"></a>07590         <span class="keywordflow">return</span> pBuf;
<a name="l07591"></a>07591     }
<a name="l07592"></a>07592     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07593"></a>07593 }
<a name="l07594"></a>07594 
<a name="l07595"></a>07595 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l07596"></a>07596 
<a name="l07597"></a>07597 
<a name="l07598"></a>07598 <span class="comment">// Some server replies (to your messages) are so important that a notice is dropped</span>
<a name="l07599"></a>07599 <span class="comment">// into your Nymbox with a copy of the server&#39;s reply. It&#39;s called a replyNotice.</span>
<a name="l07600"></a>07600 <span class="comment">// Since the server is usually replying to a message, I&#39;ve added this function for</span>
<a name="l07601"></a>07601 <span class="comment">// quickly looking up the message reply, if it&#39;s there, based on the requestNumber.</span>
<a name="l07602"></a>07602 <span class="comment">// This is the only example in the entire OT API where a Transaction is looked-up from</span>
<a name="l07603"></a>07603 <span class="comment">// a ledger, based on a REQUEST NUMBER. (Normally transactions use transaction numbers,</span>
<a name="l07604"></a>07604 <span class="comment">// and messages use request numbers. But in this case, it&#39;s a transaction that carries</span>
<a name="l07605"></a>07605 <span class="comment">// a copy of a message.)</span>
<a name="l07606"></a>07606 <span class="comment">// Note: Make sure you call this AFTER you download the box receipts, but BEFORE</span>
<a name="l07607"></a>07607 <span class="comment">// you process the Nymbox (because the reply notice will have disappeared.) Basically this</span>
<a name="l07608"></a>07608 <span class="comment">// function will be used for cases where you missed a server reply, and you need to</span>
<a name="l07609"></a>07609 <span class="comment">// search your Nymbox and see if a copy of the missed reply is still there. (Which it</span>
<a name="l07610"></a>07610 <span class="comment">// won&#39;t be, once you process the box.)</span>
<a name="l07611"></a>07611 <span class="comment">//</span>
<a name="l07612"></a><a class="code" href="class_o_t_a_p_i___exec.html#a280cb93214875fe7508fbf0cce2ac67b">07612</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a280cb93214875fe7508fbf0cce2ac67b">OTAPI_Exec::Nymbox_GetReplyNotice</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07613"></a>07613                                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07614"></a>07614                                               <span class="keyword">const</span> int64_t     &amp; REQUEST_NUMBER) <span class="comment">// returns replyNotice transaction by requestNumber.</span>
<a name="l07615"></a>07615 {
<a name="l07616"></a>07616     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07617"></a>07617     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07618"></a>07618     <span class="keywordflow">if</span> (0 &gt; REQUEST_NUMBER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;REQUEST_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07619"></a>07619 
<a name="l07620"></a>07620     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07621"></a>07621     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07622"></a>07622 
<a name="l07623"></a>07623     <span class="keyword">const</span> int64_t lRequestNumber = REQUEST_NUMBER;
<a name="l07624"></a>07624     <span class="comment">// -----------------------------------------</span>
<a name="l07625"></a>07625     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07626"></a>07626     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07627"></a>07627 
<a name="l07628"></a>07628     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5d73d9af141c79478e431d81b3ac641d">LoadNymboxNoVerify</a>(theServerID, theUserID);
<a name="l07629"></a>07629     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07630"></a>07630     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07631"></a>07631 
<a name="l07632"></a>07632     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07633"></a>07633     {
<a name="l07634"></a>07634         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadNymboxNoVerify.\n&quot;</span>, __FUNCTION__);
<a name="l07635"></a>07635         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07636"></a>07636     }
<a name="l07637"></a>07637     <span class="comment">// -----------------------------------</span>
<a name="l07638"></a>07638     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#abff95a14ed703447ec5557183f5dc91c">GetReplyNotice</a>(static_cast&lt;int64_t&gt;(lRequestNumber));
<a name="l07639"></a>07639     <span class="comment">// No need to cleanup this transaction, the ledger owns it already.</span>
<a name="l07640"></a>07640 
<a name="l07641"></a>07641     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l07642"></a>07642     {
<a name="l07643"></a>07643         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(4, <span class="stringliteral">&quot;%s: No replyNotice transactions found in ledger with request number: %lld\n&quot;</span>, __FUNCTION__, lRequestNumber);
<a name="l07644"></a>07644         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Maybe he was just looking; this isn&#39;t necessarily an error.</span>
<a name="l07645"></a>07645     }
<a name="l07646"></a>07646     <span class="comment">// -----------------------------------</span>
<a name="l07647"></a>07647     <span class="comment">// At this point, I actually have the transaction pointer to the replyNotice,</span>
<a name="l07648"></a>07648     <span class="comment">// so let&#39;s return it in string form...</span>
<a name="l07649"></a>07649     <span class="comment">//</span>
<a name="l07650"></a>07650     <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
<a name="l07651"></a>07651 
<a name="l07652"></a>07652     <span class="comment">// Update: for transactions in ABBREVIATED form, the string is empty, since it has never actually</span>
<a name="l07653"></a>07653     <span class="comment">// been signed (in fact the whole point32_t with abbreviated transactions in a ledger is that they</span>
<a name="l07654"></a>07654     <span class="comment">// take up very little room, and have no signature of their own, but exist merely as XML tags on</span>
<a name="l07655"></a>07655     <span class="comment">// their parent ledger.)</span>
<a name="l07656"></a>07656     <span class="comment">//</span>
<a name="l07657"></a>07657     <span class="comment">// THEREFORE I must check to see if this transaction is abbreviated and if so, sign it in order to</span>
<a name="l07658"></a>07658     <span class="comment">// force the UpdateContents() call, so the programmatic user of this API will be able to load it up.</span>
<a name="l07659"></a>07659     <span class="comment">//</span>
<a name="l07660"></a>07660 
<a name="l07661"></a>07661      <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pTransaction); <span class="comment">// we only have the Abbreviated, so we have to use this one.</span>
<a name="l07662"></a>07662 
<a name="l07663"></a>07663     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l07664"></a>07664     {
<a name="l07665"></a>07665         pLedger-&gt;<a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a>(static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l07666"></a>07666         <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pFullTransaction = pLedger-&gt;<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l07667"></a>07667         <span class="comment">// -------------------------</span>
<a name="l07668"></a>07668 
<a name="l07669"></a>07669         <span class="keywordflow">if</span> (NULL != pFullTransaction)
<a name="l07670"></a>07670         {
<a name="l07671"></a>07671             strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
<a name="l07672"></a>07672             strOutput.<a class="code" href="class_o_t_string.html#a248f1b2b5d3f78c6d47e5fbcfb3e5738">zeroMemory</a>();
<a name="l07673"></a>07673             strOutput.<a class="code" href="class_o_t_string.html#aa5db620fe8e60c849585d741975db991">Set</a>(*pFullTransaction); <span class="comment">// we have the FullTransaction, lets use that one.</span>
<a name="l07674"></a>07674         }
<a name="l07675"></a>07675         <span class="keywordflow">else</span> <span class="comment">// NULL == pFullTransaction</span>
<a name="l07676"></a>07676         {
<a name="l07677"></a>07677             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered \&quot;\&quot; pointer after trying to load full &quot;</span>
<a name="l07678"></a>07678                 <span class="stringliteral">&quot;version of receipt (from abbreviated.) Thus, saving abbreviated version instead, &quot;</span>
<a name="l07679"></a>07679                 <span class="stringliteral">&quot;so I can still return SOMETHING.\n&quot;</span>, __FUNCTION__);
<a name="l07680"></a>07680             <span class="comment">// ----------------------------------</span>
<a name="l07681"></a>07681             <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theUserID, __FUNCTION__);
<a name="l07682"></a>07682             <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07683"></a>07683             <span class="comment">// -------------------------</span>
<a name="l07684"></a>07684             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l07685"></a>07685             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l07686"></a>07686             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l07687"></a>07687             <span class="comment">// ------------------------</span>
<a name="l07688"></a>07688         }
<a name="l07689"></a>07689         strOutput.<a class="code" href="class_o_t_string.html#abef4b21b2170468705c58d64212d7257">Release</a>();
<a name="l07690"></a>07690         pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput); <span class="comment">// if it was abbreviated before, now it either IS the box receipt, or it&#39;s the abbreviated version.</span>
<a name="l07691"></a>07691     }
<a name="l07692"></a>07692     <span class="comment">// ------------------------------------------------</span>
<a name="l07693"></a>07693     <span class="comment">// We return the abbreviated version because the developer using the OT API</span>
<a name="l07694"></a>07694     <span class="comment">// needs to know if that receipt is there, whether it&#39;s abbreviated or not.</span>
<a name="l07695"></a>07695     <span class="comment">// So rather than passing &quot;&quot; when it&#39;s abbreviated, and thus leading him</span>
<a name="l07696"></a>07696     <span class="comment">// astray, we give him the next-best thing: the abbreviated version. That</span>
<a name="l07697"></a>07697     <span class="comment">// way at least he knows for sure that the receipt is there, the one he is</span>
<a name="l07698"></a>07698     <span class="comment">// asking about.</span>
<a name="l07699"></a>07699 
<a name="l07700"></a>07700     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07701"></a>07701 
<a name="l07702"></a>07702     <span class="keywordflow">return</span> pBuf;
<a name="l07703"></a>07703 }
<a name="l07704"></a>07704 
<a name="l07705"></a>07705 
<a name="l07706"></a>07706 
<a name="l07707"></a>07707 <span class="comment">// If the client-side has ALREADY seen the server&#39;s reply to a specific</span>
<a name="l07708"></a>07708 <span class="comment">// request number, he stores that number in a list which can be queried</span>
<a name="l07709"></a>07709 <span class="comment">// using this function.  A copy of that list is sent with nearly every request</span>
<a name="l07710"></a>07710 <span class="comment">// message sent to the server.  This way the server can see which replies you</span>
<a name="l07711"></a>07711 <span class="comment">// have already received. The server will mirror every number it sees (it sends</span>
<a name="l07712"></a>07712 <span class="comment">// its own list in all its replies.) Whenever you see a number mirrored in the</span>
<a name="l07713"></a>07713 <span class="comment">// server&#39;s reply, that means the server now knows you got its original reply</span>
<a name="l07714"></a>07714 <span class="comment">// (the one referenced by the number) and the server removed any replyNotice</span>
<a name="l07715"></a>07715 <span class="comment">// of that from your Nymbox (so you don&#39;t have to download it.) Basically that</span>
<a name="l07716"></a>07716 <span class="comment">// means you can go ahead and remove it from your list, and once you do, the server</span>
<a name="l07717"></a>07717 <span class="comment">// will remove its matching copy as well.</span>
<a name="l07718"></a>07718 <span class="comment">//</span>
<a name="l07719"></a>07719 <span class="comment">// *** When you are downloading your box receipts, you can skip any receipts where</span>
<a name="l07720"></a>07720 <span class="comment">// you have ALREADY seen the reply. So you can use this function to see if you already</span>
<a name="l07721"></a>07721 <span class="comment">// saw it, and if you did, then you can skip downloading that box receipt.</span>
<a name="l07722"></a>07722 <span class="comment">// Warning: this function isn&#39;t &quot;perfect&quot;, in the sense that it cannot tell you definitively</span>
<a name="l07723"></a>07723 <span class="comment">// whether you have actually seen a server reply, but it CAN tell you if you have seen</span>
<a name="l07724"></a>07724 <span class="comment">// one until it finishes the above-described protocol (it will work in that way, which is</span>
<a name="l07725"></a>07725 <span class="comment">// how it was intended.) But after that, it will no int64_ter know if you got the reply since</span>
<a name="l07726"></a>07726 <span class="comment">// it has removed it from its list.</span>
<a name="l07727"></a>07727 <span class="comment">//</span>
<a name="l07728"></a><a class="code" href="class_o_t_a_p_i___exec.html#a21fc5967b732f9792d642ca567d2b68b">07728</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a21fc5967b732f9792d642ca567d2b68b">OTAPI_Exec::HaveAlreadySeenReply</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07729"></a>07729                                       <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07730"></a>07730                                       <span class="keyword">const</span> int64_t &amp; REQUEST_NUMBER) <span class="comment">// returns bool</span>
<a name="l07731"></a>07731 {
<a name="l07732"></a>07732     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07733"></a>07733     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07734"></a>07734     <span class="keywordflow">if</span> (0 &gt; REQUEST_NUMBER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;REQUEST_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07735"></a>07735 
<a name="l07736"></a>07736     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07737"></a>07737     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07738"></a>07738 
<a name="l07739"></a>07739     <span class="keyword">const</span> int64_t lRequestNumber = REQUEST_NUMBER;
<a name="l07740"></a>07740 
<a name="l07741"></a>07741     <span class="comment">// const std::string &amp; strFunc = &quot;OTAPI_Exec::HaveAlreadySeenReply&quot;;</span>
<a name="l07742"></a>07742     <span class="comment">// -----------------------------------------</span>
<a name="l07743"></a>07743     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07744"></a>07744     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07745"></a>07745 
<a name="l07746"></a>07746     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bTemp = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a76e14d4a7826d39f55e0dcac022a8474">HaveAlreadySeenReply</a>(theServerID, theUserID, static_cast&lt;int64_t&gt;(lRequestNumber));
<a name="l07747"></a>07747     <span class="keywordflow">return</span> bTemp;
<a name="l07748"></a>07748 }
<a name="l07749"></a>07749 
<a name="l07750"></a>07750 
<a name="l07751"></a>07751 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l07752"></a>07752 
<a name="l07753"></a>07753 
<a name="l07754"></a>07754 
<a name="l07755"></a><a class="code" href="class_o_t_a_p_i___exec.html#adc10400f3c5ca79977afbc32cece6137">07755</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#adc10400f3c5ca79977afbc32cece6137">OTAPI_Exec::LoadNymbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07756"></a>07756                                    <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// Returns &quot;&quot;, or an inbox.</span>
<a name="l07757"></a>07757 {
<a name="l07758"></a>07758     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07759"></a>07759     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07760"></a>07760 
<a name="l07761"></a>07761     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07762"></a>07762     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07763"></a>07763 
<a name="l07764"></a>07764     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07765"></a>07765     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07766"></a>07766     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a407abef5bd443ce7f68e399f76252fd3">LoadNymbox</a>(theServerID, theUserID);
<a name="l07767"></a>07767 
<a name="l07768"></a>07768     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07769"></a>07769     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07770"></a>07770 
<a name="l07771"></a>07771     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07772"></a>07772     {
<a name="l07773"></a>07773         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadNymbox.\n&quot;</span>, __FUNCTION__);
<a name="l07774"></a>07774     }
<a name="l07775"></a>07775     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07776"></a>07776     {
<a name="l07777"></a>07777         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07778"></a>07778         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07779"></a>07779         <span class="keywordflow">return</span> pBuf;
<a name="l07780"></a>07780     }
<a name="l07781"></a>07781 
<a name="l07782"></a>07782     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07783"></a>07783 }
<a name="l07784"></a>07784 
<a name="l07785"></a>07785 
<a name="l07786"></a>07786 
<a name="l07787"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5afcb37758acf603d42bd4a586618077">07787</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a5afcb37758acf603d42bd4a586618077">OTAPI_Exec::LoadNymboxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07788"></a>07788                                            <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// Returns &quot;&quot;, or an inbox.</span>
<a name="l07789"></a>07789 {
<a name="l07790"></a>07790     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07791"></a>07791     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07792"></a>07792 
<a name="l07793"></a>07793     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07794"></a>07794     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07795"></a>07795 
<a name="l07796"></a>07796     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07797"></a>07797     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07798"></a>07798     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5d73d9af141c79478e431d81b3ac641d">LoadNymboxNoVerify</a>(theServerID, theUserID);
<a name="l07799"></a>07799 
<a name="l07800"></a>07800     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07801"></a>07801     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07802"></a>07802 
<a name="l07803"></a>07803     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07804"></a>07804     {
<a name="l07805"></a>07805         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadNymboxNoVerify.\n&quot;</span>, __FUNCTION__);
<a name="l07806"></a>07806     }
<a name="l07807"></a>07807     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07808"></a>07808     {
<a name="l07809"></a>07809         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07810"></a>07810         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07811"></a>07811         <span class="keywordflow">return</span> pBuf;
<a name="l07812"></a>07812     }
<a name="l07813"></a>07813 
<a name="l07814"></a>07814     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07815"></a>07815 }
<a name="l07816"></a>07816 
<a name="l07817"></a>07817 
<a name="l07818"></a>07818 
<a name="l07819"></a>07819 
<a name="l07820"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad13ec1f9fdf6de0d0225f9fe525a449d">07820</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad13ec1f9fdf6de0d0225f9fe525a449d">OTAPI_Exec::LoadInbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07821"></a>07821                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07822"></a>07822                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID) <span class="comment">// Returns &quot;&quot;, or an inbox.</span>
<a name="l07823"></a>07823 {
<a name="l07824"></a>07824     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07825"></a>07825     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07826"></a>07826     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07827"></a>07827 
<a name="l07828"></a>07828     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07829"></a>07829     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07830"></a>07830     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l07831"></a>07831 
<a name="l07832"></a>07832     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07833"></a>07833     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07834"></a>07834     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a478f3f32e383e05a203807810bc94940">LoadInbox</a>(theServerID, theUserID, theAccountID);
<a name="l07835"></a>07835 
<a name="l07836"></a>07836     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07837"></a>07837     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07838"></a>07838 
<a name="l07839"></a>07839     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07840"></a>07840     {
<a name="l07841"></a>07841         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadInbox.\nAccount ID: %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l07842"></a>07842     }
<a name="l07843"></a>07843     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07844"></a>07844     {
<a name="l07845"></a>07845         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07846"></a>07846         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07847"></a>07847         <span class="keywordflow">return</span> pBuf;
<a name="l07848"></a>07848     }
<a name="l07849"></a>07849 
<a name="l07850"></a>07850     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07851"></a>07851 }
<a name="l07852"></a>07852 
<a name="l07853"></a>07853 
<a name="l07854"></a>07854 
<a name="l07855"></a>07855 
<a name="l07856"></a><a class="code" href="class_o_t_a_p_i___exec.html#af2d72e9950e4a1c33019a4a2fac2acf8">07856</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af2d72e9950e4a1c33019a4a2fac2acf8" title="These versions don&#39;t verify the ledger, they just load it up.">OTAPI_Exec::LoadInboxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07857"></a>07857                                           <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07858"></a>07858                                           <span class="keyword">const</span> std::string &amp; ACCOUNT_ID) <span class="comment">// Returns &quot;&quot;, or an inbox.</span>
<a name="l07859"></a>07859 {
<a name="l07860"></a>07860     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07861"></a>07861     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07862"></a>07862     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07863"></a>07863 
<a name="l07864"></a>07864     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07865"></a>07865     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07866"></a>07866     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l07867"></a>07867 
<a name="l07868"></a>07868     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07869"></a>07869     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07870"></a>07870     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a11a9479b4875de4377232237d3521690">LoadInboxNoVerify</a>(theServerID, theUserID, theAccountID);
<a name="l07871"></a>07871 
<a name="l07872"></a>07872     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07873"></a>07873     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07874"></a>07874 
<a name="l07875"></a>07875     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07876"></a>07876     {
<a name="l07877"></a>07877         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadInboxNoVerify.\nAccount ID: %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l07878"></a>07878     }
<a name="l07879"></a>07879     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07880"></a>07880     {
<a name="l07881"></a>07881         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07882"></a>07882         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07883"></a>07883         <span class="keywordflow">return</span> pBuf;
<a name="l07884"></a>07884     }
<a name="l07885"></a>07885 
<a name="l07886"></a>07886     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07887"></a>07887 }
<a name="l07888"></a>07888 
<a name="l07889"></a>07889 
<a name="l07890"></a>07890 
<a name="l07891"></a>07891 
<a name="l07892"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad0eff5c7f97a80201f96034fecfaefa1">07892</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad0eff5c7f97a80201f96034fecfaefa1">OTAPI_Exec::LoadOutbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07893"></a>07893                                    <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07894"></a>07894                                    <span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l07895"></a>07895 {
<a name="l07896"></a>07896     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07897"></a>07897     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07898"></a>07898     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07899"></a>07899 
<a name="l07900"></a>07900     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07901"></a>07901     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07902"></a>07902     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l07903"></a>07903 
<a name="l07904"></a>07904     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07905"></a>07905     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07906"></a>07906     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aeaf758c15cb39763d3ac80e7582e5409">LoadOutbox</a>(theServerID, theUserID, theAccountID);
<a name="l07907"></a>07907 
<a name="l07908"></a>07908     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07909"></a>07909     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07910"></a>07910 
<a name="l07911"></a>07911     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07912"></a>07912     {
<a name="l07913"></a>07913         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadOutbox().\nAccount ID: %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l07914"></a>07914     }
<a name="l07915"></a>07915     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07916"></a>07916     {
<a name="l07917"></a>07917         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07918"></a>07918         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07919"></a>07919         <span class="keywordflow">return</span> pBuf;
<a name="l07920"></a>07920     }
<a name="l07921"></a>07921 
<a name="l07922"></a>07922     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07923"></a>07923 }
<a name="l07924"></a>07924 
<a name="l07925"></a>07925 
<a name="l07926"></a>07926 
<a name="l07927"></a>07927 
<a name="l07928"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae985c8026afab47598da16babeed4864">07928</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae985c8026afab47598da16babeed4864">OTAPI_Exec::LoadOutboxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07929"></a>07929                                            <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l07930"></a>07930                                            <span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l07931"></a>07931 {
<a name="l07932"></a>07932     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07933"></a>07933     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07934"></a>07934     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07935"></a>07935 
<a name="l07936"></a>07936     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07937"></a>07937     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07938"></a>07938     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l07939"></a>07939 
<a name="l07940"></a>07940     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07941"></a>07941     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07942"></a>07942     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af4b4a5ef255263fbda9958082d393875">LoadOutboxNoVerify</a>(theServerID, theUserID, theAccountID);
<a name="l07943"></a>07943 
<a name="l07944"></a>07944     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07945"></a>07945     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07946"></a>07946 
<a name="l07947"></a>07947     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07948"></a>07948     {
<a name="l07949"></a>07949         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadOutboxNoVerify.\nAccount ID: %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l07950"></a>07950     }
<a name="l07951"></a>07951     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07952"></a>07952     {
<a name="l07953"></a>07953         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07954"></a>07954         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07955"></a>07955         <span class="keywordflow">return</span> pBuf;
<a name="l07956"></a>07956     }
<a name="l07957"></a>07957 
<a name="l07958"></a>07958     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l07959"></a>07959 }
<a name="l07960"></a>07960 
<a name="l07961"></a>07961 
<a name="l07962"></a>07962 
<a name="l07963"></a>07963 
<a name="l07964"></a>07964 <span class="comment">// --------------------------------------------------------------</span>
<a name="l07965"></a>07965 
<a name="l07966"></a>07966 
<a name="l07967"></a>07967 
<a name="l07968"></a>07968 
<a name="l07969"></a>07969 <span class="comment">// --------------------------------------------------------------</span>
<a name="l07970"></a>07970 
<a name="l07971"></a>07971 
<a name="l07972"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1459f5272b7b90c2dfde5a833b1b11ab">07972</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a1459f5272b7b90c2dfde5a833b1b11ab">OTAPI_Exec::LoadPaymentInbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l07973"></a>07973                                          <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// Returns &quot;&quot;, or an inbox.</span>
<a name="l07974"></a>07974 {
<a name="l07975"></a>07975     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07976"></a>07976     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l07977"></a>07977 
<a name="l07978"></a>07978     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l07979"></a>07979     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l07980"></a>07980 
<a name="l07981"></a>07981     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l07982"></a>07982     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l07983"></a>07983     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5077987cf25f441923c88cb51b3d940a">LoadPaymentInbox</a>(theServerID, theUserID);
<a name="l07984"></a>07984 
<a name="l07985"></a>07985     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l07986"></a>07986     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l07987"></a>07987 
<a name="l07988"></a>07988     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l07989"></a>07989     {
<a name="l07990"></a>07990         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadPaymentInbox.\n User ID: %s\n&quot;</span>, __FUNCTION__, USER_ID.c_str());
<a name="l07991"></a>07991     }
<a name="l07992"></a>07992     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l07993"></a>07993     {
<a name="l07994"></a>07994         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l07995"></a>07995         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l07996"></a>07996         <span class="keywordflow">return</span> pBuf;
<a name="l07997"></a>07997     }
<a name="l07998"></a>07998 
<a name="l07999"></a>07999     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08000"></a>08000 }
<a name="l08001"></a>08001 
<a name="l08002"></a>08002 
<a name="l08003"></a>08003 
<a name="l08004"></a>08004 
<a name="l08005"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8f6682955ddaea9dca9a6056bd41080b">08005</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8f6682955ddaea9dca9a6056bd41080b">OTAPI_Exec::LoadPaymentInboxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08006"></a>08006                                                  <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// Returns &quot;&quot;, or a paymentInbox.</span>
<a name="l08007"></a>08007 {
<a name="l08008"></a>08008     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08009"></a>08009     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08010"></a>08010 
<a name="l08011"></a>08011     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08012"></a>08012     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l08013"></a>08013 
<a name="l08014"></a>08014     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l08015"></a>08015     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l08016"></a>08016     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8e02cb186854f0b325c4c55da69f2e55">LoadPaymentInboxNoVerify</a>(theServerID, theUserID);
<a name="l08017"></a>08017 
<a name="l08018"></a>08018     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l08019"></a>08019     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l08020"></a>08020 
<a name="l08021"></a>08021     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l08022"></a>08022     {
<a name="l08023"></a>08023         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadPaymentInboxNoVerify.\nUser ID: %s\n&quot;</span>, __FUNCTION__, USER_ID.c_str());
<a name="l08024"></a>08024     }
<a name="l08025"></a>08025     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08026"></a>08026     {
<a name="l08027"></a>08027         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l08028"></a>08028         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08029"></a>08029         <span class="keywordflow">return</span> pBuf;
<a name="l08030"></a>08030     }
<a name="l08031"></a>08031 
<a name="l08032"></a>08032     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08033"></a>08033 }
<a name="l08034"></a>08034 
<a name="l08035"></a>08035 
<a name="l08036"></a>08036 
<a name="l08037"></a>08037 
<a name="l08038"></a>08038 
<a name="l08039"></a>08039 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08040"></a>08040 
<a name="l08041"></a>08041 
<a name="l08042"></a>08042 
<a name="l08043"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1fd5072dec68cf1840c5e414f8ae5a48">08043</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a1fd5072dec68cf1840c5e414f8ae5a48">OTAPI_Exec::LoadRecordBox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08044"></a>08044                                       <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08045"></a>08045                                       <span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l08046"></a>08046 {
<a name="l08047"></a>08047     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08048"></a>08048     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08049"></a>08049     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08050"></a>08050 
<a name="l08051"></a>08051     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08052"></a>08052     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l08053"></a>08053     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l08054"></a>08054 
<a name="l08055"></a>08055     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l08056"></a>08056     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l08057"></a>08057     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a318f160f9a43ac68afcf415ff51ae267">LoadRecordBox</a>(theServerID, theUserID, theAccountID);
<a name="l08058"></a>08058 
<a name="l08059"></a>08059     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l08060"></a>08060     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l08061"></a>08061 
<a name="l08062"></a>08062     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l08063"></a>08063     {
<a name="l08064"></a>08064         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadRecordBox.\n&quot;</span>,__FUNCTION__);
<a name="l08065"></a>08065     }
<a name="l08066"></a>08066     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08067"></a>08067     {
<a name="l08068"></a>08068         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l08069"></a>08069         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08070"></a>08070         <span class="keywordflow">return</span> pBuf;
<a name="l08071"></a>08071     }
<a name="l08072"></a>08072     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08073"></a>08073 }
<a name="l08074"></a>08074 
<a name="l08075"></a>08075 
<a name="l08076"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa1ce8ccf2be283d7bc4df03de5de9c37">08076</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa1ce8ccf2be283d7bc4df03de5de9c37">OTAPI_Exec::LoadRecordBoxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08077"></a>08077                                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08078"></a>08078                                               <span class="keyword">const</span> std::string &amp; ACCOUNT_ID)
<a name="l08079"></a>08079 {
<a name="l08080"></a>08080     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08081"></a>08081     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08082"></a>08082     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08083"></a>08083 
<a name="l08084"></a>08084     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08085"></a>08085     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l08086"></a>08086     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAccountID(ACCOUNT_ID);
<a name="l08087"></a>08087 
<a name="l08088"></a>08088     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l08089"></a>08089     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l08090"></a>08090     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8c288f48dcdc98a6ae02c03e6452c438">LoadRecordBoxNoVerify</a>(theServerID, theUserID, theAccountID);
<a name="l08091"></a>08091 
<a name="l08092"></a>08092     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l08093"></a>08093     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l08094"></a>08094 
<a name="l08095"></a>08095     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l08096"></a>08096     {
<a name="l08097"></a>08097         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadRecordBoxNoVerify.\n&quot;</span>, __FUNCTION__);
<a name="l08098"></a>08098     }
<a name="l08099"></a>08099     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08100"></a>08100     {
<a name="l08101"></a>08101         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l08102"></a>08102         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08103"></a>08103         <span class="keywordflow">return</span> pBuf;
<a name="l08104"></a>08104     }
<a name="l08105"></a>08105     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08106"></a>08106 }
<a name="l08107"></a>08107 
<a name="l08108"></a>08108 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08109"></a>08109 
<a name="l08110"></a><a class="code" href="class_o_t_a_p_i___exec.html#af3f55623e7cfe58ab4395687b5f7b0b6">08110</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#af3f55623e7cfe58ab4395687b5f7b0b6">OTAPI_Exec::LoadExpiredBox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08111"></a>08111                                        <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l08112"></a>08112 {
<a name="l08113"></a>08113     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08114"></a>08114     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08115"></a>08115 
<a name="l08116"></a>08116     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08117"></a>08117     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l08118"></a>08118 
<a name="l08119"></a>08119     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l08120"></a>08120     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l08121"></a>08121     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae3d6ecd9fabfea445d35fd7307008856">LoadExpiredBox</a>(theServerID, theUserID);
<a name="l08122"></a>08122 
<a name="l08123"></a>08123     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l08124"></a>08124     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l08125"></a>08125 
<a name="l08126"></a>08126     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l08127"></a>08127     {
<a name="l08128"></a>08128         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadExpiredBox.\n&quot;</span>,__FUNCTION__);
<a name="l08129"></a>08129     }
<a name="l08130"></a>08130     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08131"></a>08131     {
<a name="l08132"></a>08132         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l08133"></a>08133         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08134"></a>08134         <span class="keywordflow">return</span> pBuf;
<a name="l08135"></a>08135     }
<a name="l08136"></a>08136     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08137"></a>08137 }
<a name="l08138"></a>08138 
<a name="l08139"></a>08139 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08140"></a>08140 
<a name="l08141"></a><a class="code" href="class_o_t_a_p_i___exec.html#a53ad0ca7b23b5dd3f6f075423d4c9fa2">08141</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a53ad0ca7b23b5dd3f6f075423d4c9fa2">OTAPI_Exec::LoadExpiredBoxNoVerify</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08142"></a>08142                                                <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// Returns NULL, or a ExpiredBox.</span>
<a name="l08143"></a>08143 {
<a name="l08144"></a>08144     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08145"></a>08145     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08146"></a>08146 
<a name="l08147"></a>08147     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08148"></a>08148     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l08149"></a>08149 
<a name="l08150"></a>08150     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l08151"></a>08151     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l08152"></a>08152     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pLedger = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7b9a649113879b83befa1d7acc00b79d">LoadExpiredBoxNoVerify</a>(theServerID, theUserID);
<a name="l08153"></a>08153 
<a name="l08154"></a>08154     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l08155"></a>08155     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theAngel(pLedger); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l08156"></a>08156 
<a name="l08157"></a>08157     <span class="keywordflow">if</span> (NULL == pLedger)
<a name="l08158"></a>08158     {
<a name="l08159"></a>08159         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Failure calling OT_API::LoadExpiredBoxNoVerify.\n&quot;</span>, __FUNCTION__);
<a name="l08160"></a>08160     }
<a name="l08161"></a>08161     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08162"></a>08162     {
<a name="l08163"></a>08163         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pLedger); <span class="comment">// For the output</span>
<a name="l08164"></a>08164         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08165"></a>08165         <span class="keywordflow">return</span> pBuf;
<a name="l08166"></a>08166     }
<a name="l08167"></a>08167     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08168"></a>08168 }
<a name="l08169"></a>08169 
<a name="l08170"></a>08170 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08171"></a>08171 
<a name="l08172"></a><a class="code" href="class_o_t_a_p_i___exec.html#a49dd452b5c5f657861c4031e32632378">08172</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a49dd452b5c5f657861c4031e32632378">OTAPI_Exec::RecordPayment</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08173"></a>08173                                <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08174"></a>08174                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bIsInbox, <span class="comment">// true == payments inbox. false == payments outbox.</span>
<a name="l08175"></a>08175                                <span class="keyword">const</span> int32_t     &amp; nIndex,   <span class="comment">// removes payment instrument (from payments in or out box) and moves to record box.</span>
<a name="l08176"></a>08176                                <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bSaveCopy) <span class="comment">// If false, then will NOT save a copy to record box.</span>
<a name="l08177"></a>08177 {
<a name="l08178"></a>08178     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nIndex &gt;= 0);
<a name="l08179"></a>08179     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08180"></a>08180     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08181"></a>08181 
<a name="l08182"></a>08182     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08183"></a>08183     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID  (USER_ID);
<a name="l08184"></a>08184 
<a name="l08185"></a>08185     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ad96c4b1b56f797482b7383072b9037db">RecordPayment</a>(theServerID, theUserID, bIsInbox, nIndex, bSaveCopy);
<a name="l08186"></a>08186 }
<a name="l08187"></a>08187 
<a name="l08188"></a>08188 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08189"></a>08189 
<a name="l08190"></a><a class="code" href="class_o_t_a_p_i___exec.html#a15af92e750fac1175079e746a98233bd">08190</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a15af92e750fac1175079e746a98233bd">OTAPI_Exec::ClearRecord</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08191"></a>08191                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08192"></a>08192                              <span class="keyword">const</span> std::string &amp; ACCOUNT_ID, <span class="comment">// USER_ID can be passed here as well.</span>
<a name="l08193"></a>08193                              <span class="keyword">const</span> int32_t     &amp; nIndex,
<a name="l08194"></a>08194                              <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bClearAll)  <span class="comment">// if true, nIndex is ignored.</span>
<a name="l08195"></a>08195 {
<a name="l08196"></a>08196     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nIndex &gt;= 0);
<a name="l08197"></a>08197     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08198"></a>08198     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08199"></a>08199     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08200"></a>08200 
<a name="l08201"></a>08201     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08202"></a>08202     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID  (USER_ID);
<a name="l08203"></a>08203     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAcctID  (ACCOUNT_ID);
<a name="l08204"></a>08204 
<a name="l08205"></a>08205     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a71244607da4b28d1b33ab623ec9a2a1e">ClearRecord</a>(theServerID, theUserID, theAcctID, nIndex, bClearAll);
<a name="l08206"></a>08206 }
<a name="l08207"></a>08207 
<a name="l08208"></a>08208 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08209"></a>08209 
<a name="l08210"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0ea384dc2ddb41f122e4665f21374654">08210</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a0ea384dc2ddb41f122e4665f21374654">OTAPI_Exec::ClearExpired</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08211"></a>08211                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08212"></a>08212                               <span class="keyword">const</span> int32_t     &amp; nIndex,
<a name="l08213"></a>08213                               <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bClearAll) <span class="comment">// if true, nIndex is ignored.</span>
<a name="l08214"></a>08214 {
<a name="l08215"></a>08215     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(nIndex &gt;= 0);
<a name="l08216"></a>08216     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08217"></a>08217     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08218"></a>08218 
<a name="l08219"></a>08219     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l08220"></a>08220     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID  (USER_ID);
<a name="l08221"></a>08221 
<a name="l08222"></a>08222     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a742952a02e0d947156e8687933602725">ClearExpired</a>(theServerID, theUserID, nIndex, bClearAll);
<a name="l08223"></a>08223 }
<a name="l08224"></a>08224 
<a name="l08225"></a>08225 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08226"></a>08226 
<a name="l08271"></a>08271 <span class="comment">// Returns number of transactions within, or -1 for error.</span>
<a name="l08272"></a><a class="code" href="class_o_t_a_p_i___exec.html#a11db9e97151620ab6754719366754b20">08272</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a11db9e97151620ab6754719366754b20" title="Find out how many pending transactions (and receipts) are in this inbox.">OTAPI_Exec::Ledger_GetCount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08273"></a>08273                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08274"></a>08274                                     <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08275"></a>08275                                     <span class="keyword">const</span> std::string &amp; THE_LEDGER)
<a name="l08276"></a>08276 {
<a name="l08277"></a>08277     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08278"></a>08278     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08279"></a>08279     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08280"></a>08280     <span class="keywordflow">if</span> (THE_LEDGER.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08281"></a>08281 
<a name="l08282"></a>08282     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08283"></a>08283 
<a name="l08284"></a>08284     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08285"></a>08285     <span class="comment">// -----------------------------------------------------</span>
<a name="l08286"></a>08286     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08287"></a>08287 
<a name="l08288"></a>08288     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l08289"></a>08289     {
<a name="l08290"></a>08290         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08291"></a>08291         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08292"></a>08292         <span class="keywordflow">return</span> -1;
<a name="l08293"></a>08293     }
<a name="l08294"></a>08294 
<a name="l08295"></a>08295     <span class="keywordflow">return</span> theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>();
<a name="l08296"></a>08296 }
<a name="l08297"></a>08297 
<a name="l08298"></a>08298 
<a name="l08299"></a>08299 
<a name="l08300"></a>08300 
<a name="l08301"></a>08301 <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l08302"></a>08302 <span class="comment">// Creates a new &#39;response&#39; ledger, set up with the right Server ID, etc, so you</span>
<a name="l08303"></a>08303 <span class="comment">// can add the &#39;response&#39; items to it, one by one. (Pass in the original ledger</span>
<a name="l08304"></a>08304 <span class="comment">// that you are responding to, as it uses the data from it to set up the response.)</span>
<a name="l08305"></a>08305 <span class="comment">// The original ledger is your inbox. Inbox receipts are the only things you would</span>
<a name="l08306"></a>08306 <span class="comment">// ever create a &quot;response&quot; to, as part of your &quot;process inbox&quot; process.</span>
<a name="l08307"></a>08307 <span class="comment">//</span>
<a name="l08308"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6a592a8bd48d7e006fdfe054e79b47ce">08308</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a6a592a8bd48d7e006fdfe054e79b47ce">OTAPI_Exec::Ledger_CreateResponse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08309"></a>08309                                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08310"></a>08310                                               <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08311"></a>08311                                               <span class="keyword">const</span> std::string &amp; ORIGINAL_LEDGER)
<a name="l08312"></a>08312 {
<a name="l08313"></a>08313     <span class="keywordflow">if</span> (SERVER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08314"></a>08314     <span class="keywordflow">if</span> (USER_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08315"></a>08315     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08316"></a>08316     <span class="keywordflow">if</span> (ORIGINAL_LEDGER.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ORIGINAL_LEDGER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08317"></a>08317 
<a name="l08318"></a>08318     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08319"></a>08319     <span class="comment">// -----------------------------------------------------</span>
<a name="l08320"></a>08320     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l08321"></a>08321     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08322"></a>08322     <span class="comment">// -----------------------------------------------------</span>
<a name="l08323"></a>08323     <span class="comment">// Let&#39;s load up the ledger (an inbox) that was passed in...</span>
<a name="l08324"></a>08324     <a class="code" href="class_o_t_string.html">OTString</a> strOriginalLedger(ORIGINAL_LEDGER);
<a name="l08325"></a>08325     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theOriginalLedger(theUserID, theAccountID, theServerID);
<a name="l08326"></a>08326 
<a name="l08327"></a>08327     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theOriginalLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strOriginalLedger))
<a name="l08328"></a>08328     {
<a name="l08329"></a>08329         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08330"></a>08330         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08331"></a>08331         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08332"></a>08332     }
<a name="l08333"></a>08333 
<a name="l08334"></a>08334     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theOriginalLedger.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l08335"></a>08335     {
<a name="l08336"></a>08336         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08337"></a>08337         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying original ledger. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08338"></a>08338         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08339"></a>08339     }
<a name="l08340"></a>08340     <span class="comment">// -----------------------------------------------------</span>
<a name="l08341"></a>08341     <span class="comment">// By this point, the ledger is loaded properly from the string,</span>
<a name="l08342"></a>08342     <span class="comment">// Let&#39;s create the response to it.</span>
<a name="l08343"></a>08343     <a class="code" href="class_o_t_ledger.html">OTLedger</a> * pResponseLedger = <a class="code" href="class_o_t_ledger.html#ae255257ef1a25233ca772d81ab730643">OTLedger::GenerateLedger</a>(theUserID, theAccountID,
<a name="l08344"></a>08344         theServerID, <a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa78e88da32ff989182e4eead9926e7916">OTLedger::message</a>);<span class="comment">// bCreateFile=false</span>
<a name="l08345"></a>08345     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTLedger&gt;</a> theResponseAngel(pResponseLedger); <span class="comment">// Angel will handle cleanup.</span>
<a name="l08346"></a>08346 
<a name="l08347"></a>08347     <span class="keywordflow">if</span> (NULL == pResponseLedger)
<a name="l08348"></a>08348     {
<a name="l08349"></a>08349         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08350"></a>08350         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error generating response ledger. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08351"></a>08351         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08352"></a>08352     }
<a name="l08353"></a>08353     <span class="comment">// -----------------------------------------------------</span>
<a name="l08354"></a>08354     pResponseLedger-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l08355"></a>08355     pResponseLedger-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l08356"></a>08356 
<a name="l08357"></a>08357     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pResponseLedger); <span class="comment">// For the output</span>
<a name="l08358"></a>08358 
<a name="l08359"></a>08359     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08360"></a>08360 
<a name="l08361"></a>08361     <span class="keywordflow">return</span> pBuf;
<a name="l08362"></a>08362 }
<a name="l08363"></a>08363 
<a name="l08364"></a>08364 
<a name="l08365"></a>08365 
<a name="l08366"></a>08366 <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l08367"></a>08367 <span class="comment">// Lookup a transaction or its ID (from within a ledger) based on index or</span>
<a name="l08368"></a>08368 <span class="comment">// transaction number.</span>
<a name="l08369"></a>08369 <span class="comment">//</span>
<a name="l08370"></a>08370 <span class="comment">// The transaction number is returned as a string, because I return ALL int64_t</span>
<a name="l08371"></a>08371 <span class="comment">// ints as a string (in the API.)  In C, you can just call StringToLong to convert it back.</span>
<a name="l08372"></a>08372 <span class="comment">// This makes it easier for the guys who use scripting languages. (This file is</span>
<a name="l08373"></a>08373 <span class="comment">// primarily for them. If you are lower-level, you should use OpenTransactions.h/.cpp</span>
<a name="l08374"></a>08374 <span class="comment">// and then use this one as a model for how to do it. Or use this one if you insist</span>
<a name="l08375"></a>08375 <span class="comment">// on straight C, since all these functions are extern &quot;C&quot;.)</span>
<a name="l08376"></a>08376 <span class="comment">//</span>
<a name="l08377"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad86da1897ef6aa8d9f4bb07a694fe9f6">08377</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad86da1897ef6aa8d9f4bb07a694fe9f6">OTAPI_Exec::Ledger_GetTransactionByIndex</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08378"></a>08378                                                      <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08379"></a>08379                                                      <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08380"></a>08380                                                      <span class="keyword">const</span> std::string &amp; THE_LEDGER,
<a name="l08381"></a>08381                                                      <span class="keyword">const</span> int32_t &amp; nIndex) <span class="comment">// returns transaction by index (from ledger)</span>
<a name="l08382"></a>08382 {
<a name="l08383"></a>08383     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08384"></a>08384     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08385"></a>08385     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08386"></a>08386     <span class="keywordflow">if</span> (THE_LEDGER.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08387"></a>08387 
<a name="l08388"></a>08388     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08389"></a>08389 
<a name="l08390"></a>08390     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08391"></a>08391 
<a name="l08392"></a>08392     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08393"></a>08393     <span class="comment">// -----------------------------------------------------</span>
<a name="l08394"></a>08394     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08395"></a>08395     <span class="comment">//  std::set&lt;int64_t&gt; setUnloaded;</span>
<a name="l08396"></a>08396 
<a name="l08397"></a>08397     <span class="keywordflow">if</span> (    !theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger)
<a name="l08398"></a>08398 <span class="comment">//      ||  !theLedger.LoadBoxReceipts(&amp;setUnloaded)    // This is done below, for the individual transaction, for better optimization.</span>
<a name="l08399"></a>08399             )
<a name="l08400"></a>08400     {
<a name="l08401"></a>08401         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08402"></a>08402         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string, or loading box receipts subsequently. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08403"></a>08403         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08404"></a>08404     }
<a name="l08405"></a>08405 
<a name="l08406"></a>08406     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l08407"></a>08407 
<a name="l08408"></a>08408     <span class="keywordflow">if</span> (nIndex &gt;= theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>())
<a name="l08409"></a>08409     {
<a name="l08410"></a>08410         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: out of bounds: %d\n&quot;</span>, __FUNCTION__, nIndex);
<a name="l08411"></a>08411         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<a name="l08412"></a>08412     }
<a name="l08413"></a>08413 
<a name="l08414"></a>08414     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex);
<a name="l08415"></a>08415     <span class="comment">//  OTCleanup&lt;OTTransaction&gt; theAngel(pTransaction); // THE LEDGER CLEANS THIS ALREADY.</span>
<a name="l08416"></a>08416 
<a name="l08417"></a>08417     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l08418"></a>08418     {
<a name="l08419"></a>08419         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: good index but uncovered \&quot;\&quot; pointer: %d\n&quot;</span>, __FUNCTION__, nIndex);
<a name="l08420"></a>08420         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Weird.</span>
<a name="l08421"></a>08421     }
<a name="l08422"></a>08422 
<a name="l08423"></a>08423     <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
<a name="l08424"></a>08424     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return it in string form...</span>
<a name="l08425"></a>08425 
<a name="l08426"></a>08426     <span class="comment">// Update: for transactions in ABBREVIATED form, the string is empty, since it has never actually</span>
<a name="l08427"></a>08427     <span class="comment">// been signed (in fact the whole point32_t with abbreviated transactions in a ledger is that they</span>
<a name="l08428"></a>08428     <span class="comment">// take up very little room, and have no signature of their own, but exist merely as XML tags on</span>
<a name="l08429"></a>08429     <span class="comment">// their parent ledger.)</span>
<a name="l08430"></a>08430     <span class="comment">//</span>
<a name="l08431"></a>08431     <span class="comment">// THEREFORE I must check to see if this transaction is abbreviated and if so, sign it in order to</span>
<a name="l08432"></a>08432     <span class="comment">// force the UpdateContents() call, so the programmatic user of this API will be able to load it up.</span>
<a name="l08433"></a>08433     <span class="comment">//</span>
<a name="l08434"></a>08434     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l08435"></a>08435     {
<a name="l08436"></a>08436         theLedger.<a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a>(static_cast&lt;int64_t&gt;(lTransactionNum)); <span class="comment">// I don&#39;t check return val here because I still want it to send the abbreviated form, if this fails.</span>
<a name="l08437"></a>08437         pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l08438"></a>08438         <span class="comment">// -------------------------</span>
<a name="l08439"></a>08439         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l08440"></a>08440         {
<a name="l08441"></a>08441             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered \&quot;\&quot; pointer after trying to load full version of receipt (from abbreviated): %d\n&quot;</span>, __FUNCTION__, nIndex);
<a name="l08442"></a>08442             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Weird.</span>
<a name="l08443"></a>08443         }
<a name="l08444"></a>08444         <span class="comment">// I was doing this when it was abbreviated. But now (above) I just</span>
<a name="l08445"></a>08445         <span class="comment">// load the box receipt itself. (This code is a hack that creates a</span>
<a name="l08446"></a>08446         <span class="comment">// serialized abbreviated version.)</span>
<a name="l08447"></a>08447         <span class="comment">//      OTPseudonym * pNym = OTAPI()-&gt;GetNym(theUserID, &quot;OTAPI_Exec::Ledger_GetTransactionByIndex&quot;);</span>
<a name="l08448"></a>08448         <span class="comment">//      if (NULL == pNym) return &quot;&quot;;</span>
<a name="l08449"></a>08449         <span class="comment">//      // -------------------------</span>
<a name="l08450"></a>08450         <span class="comment">//      pTransaction-&gt;ReleaseSignatures();</span>
<a name="l08451"></a>08451         <span class="comment">//      pTransaction-&gt;SignContract(*pNym);</span>
<a name="l08452"></a>08452         <span class="comment">//      pTransaction-&gt;SaveContract();</span>
<a name="l08453"></a>08453     }
<a name="l08454"></a>08454     <span class="comment">// ------------------------------------------------</span>
<a name="l08455"></a>08455 
<a name="l08456"></a>08456     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pTransaction); <span class="comment">// For the output</span>
<a name="l08457"></a>08457     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08458"></a>08458 
<a name="l08459"></a>08459 
<a name="l08460"></a>08460 
<a name="l08461"></a>08461     <span class="keywordflow">return</span> pBuf;
<a name="l08462"></a>08462 }
<a name="l08463"></a>08463 
<a name="l08464"></a>08464 
<a name="l08465"></a>08465 
<a name="l08466"></a>08466 <span class="comment">// Returns transaction by ID (transaction numbers are int64_t ints, and thus</span>
<a name="l08467"></a>08467 <span class="comment">// they are passed as strings in this OT high-level API.)</span>
<a name="l08468"></a>08468 <span class="comment">// Note: If this function returns &quot;&quot; for a transaction you KNOW is on</span>
<a name="l08469"></a>08469 <span class="comment">// the ledger, then you probably just need to download it. (The box receipts</span>
<a name="l08470"></a>08470 <span class="comment">// are stored in separate files and downloaded separately as well.)</span>
<a name="l08471"></a>08471 <span class="comment">//</span>
<a name="l08472"></a><a class="code" href="class_o_t_a_p_i___exec.html#aabc9b8e0c20f23310e9bf1f273d44d04">08472</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aabc9b8e0c20f23310e9bf1f273d44d04">OTAPI_Exec::Ledger_GetTransactionByID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08473"></a>08473                                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08474"></a>08474                                              <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08475"></a>08475                                              <span class="keyword">const</span> std::string &amp; THE_LEDGER,
<a name="l08476"></a>08476                                              <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER)
<a name="l08477"></a>08477 {
<a name="l08478"></a>08478     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08479"></a>08479     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08480"></a>08480     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08481"></a>08481     <span class="keywordflow">if</span> (THE_LEDGER.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08482"></a>08482     <span class="keywordflow">if</span> (0 &gt; TRANSACTION_NUMBER)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08483"></a>08483 
<a name="l08484"></a>08484     <span class="keyword">const</span> int64_t lTransactionNumber = TRANSACTION_NUMBER;
<a name="l08485"></a>08485 
<a name="l08486"></a>08486     <span class="keywordflow">if</span> (0 &gt; lTransactionNumber) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad transaction number passed in (negative value)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08487"></a>08487 
<a name="l08488"></a>08488     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08489"></a>08489 
<a name="l08490"></a>08490     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08491"></a>08491 
<a name="l08492"></a>08492     <span class="comment">// -----------------------------------------------------</span>
<a name="l08493"></a>08493 
<a name="l08494"></a>08494     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08495"></a>08495 
<a name="l08496"></a>08496     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l08497"></a>08497     {
<a name="l08498"></a>08498         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08499"></a>08499         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08500"></a>08500         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08501"></a>08501     }
<a name="l08502"></a>08502     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l08503"></a>08503     <span class="comment">// -----------------------------------------------------</span>
<a name="l08504"></a>08504 
<a name="l08505"></a>08505     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(static_cast&lt;int64_t&gt;(lTransactionNumber));
<a name="l08506"></a>08506     <span class="comment">// No need to cleanup this transaction, the ledger owns it already.</span>
<a name="l08507"></a>08507 
<a name="l08508"></a>08508     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l08509"></a>08509     {
<a name="l08510"></a>08510         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No transaction found in ledger with that number: %lld.\n&quot;</span>, __FUNCTION__, lTransactionNumber);
<a name="l08511"></a>08511         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Maybe he was just looking; this isn&#39;t necessarily an error.</span>
<a name="l08512"></a>08512     }
<a name="l08513"></a>08513     <span class="comment">// -----------------------------------------------------</span>
<a name="l08514"></a>08514 
<a name="l08515"></a>08515     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return it in string form...</span>
<a name="l08516"></a>08516     <span class="comment">//</span>
<a name="l08517"></a>08517     <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
<a name="l08518"></a>08518     <a class="code" href="_o_t_assert_8hpp.html#a74ecab0c6a7b0a9a546bb545160e23b3">OT_ASSERT</a>(lTransactionNum == lTransactionNumber);
<a name="l08519"></a>08519 
<a name="l08520"></a>08520     <span class="comment">// Update: for transactions in ABBREVIATED form, the string is empty, since it has never actually</span>
<a name="l08521"></a>08521     <span class="comment">// been signed (in fact the whole point32_t with abbreviated transactions in a ledger is that they</span>
<a name="l08522"></a>08522     <span class="comment">// take up very little room, and have no signature of their own, but exist merely as XML tags on</span>
<a name="l08523"></a>08523     <span class="comment">// their parent ledger.)</span>
<a name="l08524"></a>08524     <span class="comment">//</span>
<a name="l08525"></a>08525     <span class="comment">// THEREFORE I must check to see if this transaction is abbreviated and if so, sign it in order to</span>
<a name="l08526"></a>08526     <span class="comment">// force the UpdateContents() call, so the programmatic user of this API will be able to load it up.</span>
<a name="l08527"></a>08527     <span class="comment">//</span>
<a name="l08528"></a>08528     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l08529"></a>08529     {
<a name="l08530"></a>08530         <span class="comment">// First we see if we are able to load the full version of this box receipt.</span>
<a name="l08531"></a>08531         <span class="comment">// (Perhaps it has already been downloaded sometime in the past, and simply</span>
<a name="l08532"></a>08532         <span class="comment">// needs to be loaded up. Worth a shot.)</span>
<a name="l08533"></a>08533         <span class="comment">//</span>
<a name="l08534"></a>08534         <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bLoadedBoxReceipt = theLedger.<a class="code" href="class_o_t_ledger.html#ae91873a35ebda05d8d91c78c1c1fcfbf">LoadBoxReceipt</a>(static_cast&lt;int64_t&gt;(lTransactionNum)); <span class="comment">// I still want it to send the abbreviated form, if this fails.</span>
<a name="l08535"></a>08535 
<a name="l08536"></a>08536         <span class="comment">// Grab this pointer again, since the object was re-instantiated</span>
<a name="l08537"></a>08537         <span class="comment">// in the case of a successful LoadBoxReceipt.</span>
<a name="l08538"></a>08538         <span class="comment">//</span>
<a name="l08539"></a>08539         <span class="keywordflow">if</span> (bLoadedBoxReceipt)
<a name="l08540"></a>08540             pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(static_cast&lt;int64_t&gt;(lTransactionNum));
<a name="l08541"></a>08541 
<a name="l08542"></a>08542         <span class="comment">// (else if false == bLoadedBoxReceipt, then pTransaction ALREADY points</span>
<a name="l08543"></a>08543         <span class="comment">// to the abbreviated version.)</span>
<a name="l08544"></a>08544         <span class="comment">// -------------------------</span>
<a name="l08545"></a>08545         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l08546"></a>08546         {
<a name="l08547"></a>08547             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good ID, but uncovered \&quot;\&quot; pointer after trying to load full version &quot;</span>
<a name="l08548"></a>08548                 <span class="stringliteral">&quot;of receipt (from abbreviated.) Probably just need to download this one...\n&quot;</span>,
<a name="l08549"></a>08549                 __FUNCTION__);
<a name="l08550"></a>08550             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Weird.</span>
<a name="l08551"></a>08551         }
<a name="l08552"></a>08552         <span class="comment">// If it&#39;s STILL abbreviated after the above efforts, then there&#39;s nothing else I can do</span>
<a name="l08553"></a>08553         <span class="comment">// except return the abbreviated version. The caller may still need the info available on</span>
<a name="l08554"></a>08554         <span class="comment">// the abbreviated version. (And the caller may yet download the full version...)</span>
<a name="l08555"></a>08555         <span class="comment">//</span>
<a name="l08556"></a>08556         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l08557"></a>08557         {
<a name="l08558"></a>08558             <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theUserID, __FUNCTION__);
<a name="l08559"></a>08559             <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Weird.</span>
<a name="l08560"></a>08560             <span class="comment">// -------------------------</span>
<a name="l08561"></a>08561             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l08562"></a>08562             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l08563"></a>08563             pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l08564"></a>08564         }
<a name="l08565"></a>08565     }
<a name="l08566"></a>08566     <span class="comment">// ------------------------------------------------</span>
<a name="l08567"></a>08567     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pTransaction); <span class="comment">// For the output</span>
<a name="l08568"></a>08568     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08569"></a>08569 
<a name="l08570"></a>08570     <span class="keywordflow">return</span> pBuf;
<a name="l08571"></a>08571 }
<a name="l08572"></a>08572 
<a name="l08573"></a>08573 
<a name="l08574"></a>08574 <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l08575"></a>08575 <span class="comment">// OTAPI_Exec::Ledger_GetInstrument (by index)</span>
<a name="l08576"></a>08576 <span class="comment">//</span>
<a name="l08577"></a>08577 <span class="comment">// Lookup a financial instrument (from within a transaction that is inside</span>
<a name="l08578"></a>08578 <span class="comment">// a paymentInbox ledger) based on index.</span>
<a name="l08579"></a>08579 <span class="comment">/*</span>
<a name="l08580"></a>08580 <span class="comment">sendUserInstrument does this:</span>
<a name="l08581"></a>08581 <span class="comment">-- Puts instrument (a contract string) as encrypted Payload on an OTMessage(1).</span>
<a name="l08582"></a>08582 <span class="comment">-- Also puts instrument (same contract string) as CLEAR payload on an OTMessage(2).</span>
<a name="l08583"></a>08583 <span class="comment">-- (1) is sent to server, and (2) is added to Outpayments messages.</span>
<a name="l08584"></a>08584 <span class="comment">-- (1) gets added to recipient&#39;s Nymbox as &quot;in ref to&quot; string on a &quot;instrumentNotice&quot; transaction.</span>
<a name="l08585"></a>08585 <span class="comment">-- When recipient processes Nymbox, the &quot;instrumentNotice&quot; transaction (containing (1) in its &quot;in ref to&quot;</span>
<a name="l08586"></a>08586 <span class="comment">field) is copied and added to the recipient&#39;s paymentInbox.</span>
<a name="l08587"></a>08587 <span class="comment">-- When recipient iterates through paymentInbox transactions, they are ALL &quot;instrumentNotice&quot; OTMessages.</span>
<a name="l08588"></a>08588 <span class="comment">Each transaction contains an OTMessage in its &quot;in ref to&quot; field, and that OTMessage object contains an</span>
<a name="l08589"></a>08589 <span class="comment">encrypted payload of the instrument itself (a contract string.)</span>
<a name="l08590"></a>08590 <span class="comment">-- When sender gets Outpayments contents, the original instrument (contract string) is stored IN THE</span>
<a name="l08591"></a>08591 <span class="comment">CLEAR as payload on an OTMessage.</span>
<a name="l08592"></a>08592 <span class="comment"></span>
<a name="l08593"></a>08593 <span class="comment">THEREFORE:</span>
<a name="l08594"></a>08594 <span class="comment">TO EXTRACT INSTRUMENT FROM PAYMENTS INBOX:</span>
<a name="l08595"></a>08595 <span class="comment">-- Iterate through the transactions in the payments inbox.</span>
<a name="l08596"></a>08596 <span class="comment">-- (They should all be &quot;instrumentNotice&quot; transactions.)</span>
<a name="l08597"></a>08597 <span class="comment">-- Each transaction contains (1) OTMessage in the &quot;in ref to&quot; field, which in turn contains an encrypted</span>
<a name="l08598"></a>08598 <span class="comment">instrument in the messagePayload field.</span>
<a name="l08599"></a>08599 <span class="comment">-- *** Therefore, this function, based purely on ledger index (as we iterate) extracts the</span>
<a name="l08600"></a>08600 <span class="comment">OTMessage from the Transaction &quot;in ref to&quot; field (for the transaction at that index), then decrypts</span>
<a name="l08601"></a>08601 <span class="comment">the payload on that message and returns the decrypted cleartext.</span>
<a name="l08602"></a>08602 <span class="comment">*/</span>
<a name="l08603"></a>08603 
<a name="l08604"></a>08604 
<a name="l08605"></a>08605 
<a name="l08606"></a>08606 <span class="comment">// DONE:  Move most of the code in the below function into OTLedger::GetInstrument.</span>
<a name="l08607"></a>08607 <span class="comment">//</span>
<a name="l08608"></a>08608 <span class="comment">// DONE: Finish writing OTClient::ProcessDepositResponse</span>
<a name="l08609"></a>08609 
<a name="l08610"></a>08610 
<a name="l08611"></a>08611 
<a name="l08612"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab23050aeec2f70007b6983e4d46c5ea7">08612</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab23050aeec2f70007b6983e4d46c5ea7">OTAPI_Exec::Ledger_GetInstrument</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08613"></a>08613                                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08614"></a>08614                                              <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08615"></a>08615                                              <span class="keyword">const</span> std::string &amp; THE_LEDGER,
<a name="l08616"></a>08616                                              <span class="keyword">const</span> int32_t     &amp; nIndex) <span class="comment">// returns financial instrument by index.</span>
<a name="l08617"></a>08617 {
<a name="l08618"></a>08618     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> );  <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08619"></a>08619     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span> );    <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08620"></a>08620     <span class="keywordflow">if</span> (ACCOUNT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08621"></a>08621     <span class="keywordflow">if</span> (THE_LEDGER.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08622"></a>08622 
<a name="l08623"></a>08623     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08624"></a>08624     <span class="comment">// -----------------------------------------------------</span>
<a name="l08625"></a>08625     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a08144e29a333dd0e1087c4655e6981ee">GetNym</a>(theUserID, __FUNCTION__);
<a name="l08626"></a>08626     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08627"></a>08627     <span class="comment">// -------------------------</span>
<a name="l08628"></a>08628     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08629"></a>08629     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08630"></a>08630 <span class="comment">//  std::set&lt;int64_t&gt; setUnloaded;</span>
<a name="l08631"></a>08631 
<a name="l08632"></a>08632     <span class="keywordflow">if</span> (    !theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger)
<a name="l08633"></a>08633 <span class="comment">//      ||  !theLedger.LoadBoxReceipts(&amp;setUnloaded)    // This is now done below, for the individual transaction, for better optimization.</span>
<a name="l08634"></a>08634             )                                           <span class="comment">// Update: now in the theLedger.GetInstrument call.</span>
<a name="l08635"></a>08635     {
<a name="l08636"></a>08636         <a class="code" href="class_o_t_string.html">OTString</a> strUserID(theUserID);
<a name="l08637"></a>08637         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08638"></a>08638         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. UserID / Acct ID: %s / %s\n&quot;</span>, __FUNCTION__,
<a name="l08639"></a>08639             strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08640"></a>08640         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08641"></a>08641     }
<a name="l08642"></a>08642     <span class="comment">// -----------------------------------------------------</span>
<a name="l08643"></a>08643     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l08644"></a>08644     <span class="comment">//</span>
<a name="l08645"></a>08645     <a class="code" href="class_o_t_payment.html">OTPayment</a> * pPayment = theLedger.<a class="code" href="class_o_t_ledger.html#a114a4d31098807d6cb873a7343a407ae">GetInstrument</a>(*pNym, nIndex); <span class="comment">// caller is responsible to delete.</span>
<a name="l08646"></a>08646     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPayment&gt;</a> thePaymentAngel(pPayment);
<a name="l08647"></a>08647 
<a name="l08648"></a>08648     <span class="keywordflow">if</span> ((NULL == pPayment) || !pPayment-&gt;<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>())
<a name="l08649"></a>08649     {
<a name="l08650"></a>08650         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: theLedger.GetInstrument either returned NULL, or an invalid instrument.\n&quot;</span>,
<a name="l08651"></a>08651                        __FUNCTION__);
<a name="l08652"></a>08652     }
<a name="l08653"></a>08653     <span class="keywordflow">else</span>
<a name="l08654"></a>08654     {
<a name="l08655"></a>08655         <span class="comment">// NOTE: instead of loading up an OTPayment, and then loading a cheque/purse/etc from it,</span>
<a name="l08656"></a>08656         <span class="comment">// we just send the cheque/purse/etc directly and use it to construct the OTPayment.</span>
<a name="l08657"></a>08657         <span class="comment">// (Saves a step.)</span>
<a name="l08658"></a>08658         <span class="comment">//</span>
<a name="l08659"></a>08659         <a class="code" href="class_o_t_string.html">OTString</a> strPaymentContents;
<a name="l08660"></a>08660 
<a name="l08661"></a>08661         <span class="keywordflow">if</span> (<span class="keyword">false</span> == pPayment-&gt;<a class="code" href="class_o_t_payment.html#a1d067b54e63054b1021ef5f187911fab">GetPaymentContents</a>(strPaymentContents))
<a name="l08662"></a>08662         {
<a name="l08663"></a>08663             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed retrieving payment instrument from OTPayment object.\n&quot;</span>,
<a name="l08664"></a>08664                            __FUNCTION__);
<a name="l08665"></a>08665             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08666"></a>08666         }
<a name="l08667"></a>08667         <span class="comment">// ------------------------------------------------------</span>
<a name="l08668"></a>08668         std::string gBuf = strPaymentContents.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08669"></a>08669         <span class="keywordflow">return</span> gBuf;
<a name="l08670"></a>08670     }
<a name="l08671"></a>08671 
<a name="l08672"></a>08672     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08673"></a>08673 }
<a name="l08674"></a>08674 
<a name="l08675"></a>08675 
<a name="l08676"></a>08676 
<a name="l08677"></a>08677 
<a name="l08678"></a>08678 <span class="comment">/*</span>
<a name="l08679"></a>08679 <span class="comment"></span>
<a name="l08680"></a>08680 <span class="comment">// returns the message, optionally with Subject: as first line.</span>
<a name="l08681"></a>08681 <span class="comment"></span>
<a name="l08682"></a>08682 <span class="comment"> std::string OTAPI_Exec::GetNym_MailContentsByIndex(const std::string &amp; NYM_ID, const int32_t &amp; nIndex)</span>
<a name="l08683"></a>08683 <span class="comment">{</span>
<a name="l08684"></a>08684 <span class="comment">    OT_ASSERT_MSG(&quot;&quot; != NYM_ID, &quot;Null NYM_ID passed to OTAPI_Exec::GetNym_MailContentsByIndex&quot;);</span>
<a name="l08685"></a>08685 <span class="comment"></span>
<a name="l08686"></a>08686 <span class="comment">    std::string strFunc = &quot;OTAPI_Exec::GetNym_MailContentsByIndex&quot;;</span>
<a name="l08687"></a>08687 <span class="comment">    // -------------------------</span>
<a name="l08688"></a>08688 <span class="comment">    OTIdentifier    theNymID(NYM_ID);</span>
<a name="l08689"></a>08689 <span class="comment">    OTPseudonym * pNym = OTAPI()-&gt;GetNym(theNymID, strFunc);</span>
<a name="l08690"></a>08690 <span class="comment">    if (NULL == pNym) return &quot;&quot;;</span>
<a name="l08691"></a>08691 <span class="comment">    // -------------------------</span>
<a name="l08692"></a>08692 <span class="comment">    OTMessage * pMessage = pNym-&gt;GetMailByIndex(nIndex);</span>
<a name="l08693"></a>08693 <span class="comment"></span>
<a name="l08694"></a>08694 <span class="comment">    if (NULL != pMessage)</span>
<a name="l08695"></a>08695 <span class="comment">    {</span>
<a name="l08696"></a>08696 <span class="comment">        // SENDER:    pMessage-&gt;m_strNymID</span>
<a name="l08697"></a>08697 <span class="comment">        // RECIPIENT: pMessage-&gt;m_strNymID2</span>
<a name="l08698"></a>08698 <span class="comment">        // MESSAGE:   pMessage-&gt;m_ascPayload (in an OTEnvelope)</span>
<a name="l08699"></a>08699 <span class="comment">        //</span>
<a name="l08700"></a>08700 <span class="comment">        OTEnvelope  theEnvelope;</span>
<a name="l08701"></a>08701 <span class="comment">        OTString    strEnvelopeContents;</span>
<a name="l08702"></a>08702 <span class="comment"></span>
<a name="l08703"></a>08703 <span class="comment">        // Decrypt the Envelope.</span>
<a name="l08704"></a>08704 <span class="comment">        if (theEnvelope.SetAsciiArmoredData(pMessage-&gt;m_ascPayload) &amp;&amp;</span>
<a name="l08705"></a>08705 <span class="comment">            theEnvelope.Open(*pNym, strEnvelopeContents))</span>
<a name="l08706"></a>08706 <span class="comment">        {</span>
<a name="l08707"></a>08707 <span class="comment">            std::string pBuf = strEnvelopeContents.Get();</span>
<a name="l08708"></a>08708 <span class="comment"></span>
<a name="l08709"></a>08709 <span class="comment">            return pBuf;</span>
<a name="l08710"></a>08710 <span class="comment">        }</span>
<a name="l08711"></a>08711 <span class="comment">    }</span>
<a name="l08712"></a>08712 <span class="comment">    return &quot;&quot;;</span>
<a name="l08713"></a>08713 <span class="comment">}</span>
<a name="l08714"></a>08714 <span class="comment"></span>
<a name="l08715"></a>08715 <span class="comment">*/</span>
<a name="l08716"></a>08716 
<a name="l08717"></a>08717 
<a name="l08718"></a>08718 <span class="comment">// Returns a transaction number, or -1 for error.</span>
<a name="l08719"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0a4e3ff37ee5c1be0b5805f6498b43eb">08719</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a0a4e3ff37ee5c1be0b5805f6498b43eb">OTAPI_Exec::Ledger_GetTransactionIDByIndex</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08720"></a>08720                                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08721"></a>08721                                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08722"></a>08722                                                   <span class="keyword">const</span> std::string &amp; THE_LEDGER,
<a name="l08723"></a>08723                                                    <span class="keyword">const</span> int32_t &amp; nIndex) <span class="comment">// returns transaction number by index.</span>
<a name="l08724"></a>08724 {
<a name="l08725"></a>08725     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08726"></a>08726     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08727"></a>08727     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08728"></a>08728     <span class="keywordflow">if</span> (THE_LEDGER.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08729"></a>08729 
<a name="l08730"></a>08730     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08731"></a>08731 
<a name="l08732"></a>08732     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08733"></a>08733 
<a name="l08734"></a>08734     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08735"></a>08735     <span class="comment">// -----------------------------------------------------</span>
<a name="l08736"></a>08736     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(<span class="stringliteral">&quot;-1&quot;</span>); <span class="comment">// For the output</span>
<a name="l08737"></a>08737 
<a name="l08738"></a>08738     int64_t lTransactionNumber = 0;
<a name="l08739"></a>08739     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l08740"></a>08740 
<a name="l08741"></a>08741     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08742"></a>08742 
<a name="l08743"></a>08743     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l08744"></a>08744     {
<a name="l08745"></a>08745         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08746"></a>08746         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08747"></a>08747     }
<a name="l08748"></a>08748 
<a name="l08749"></a>08749     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l08750"></a>08750 
<a name="l08751"></a>08751     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nIndex &gt;= theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>())
<a name="l08752"></a>08752     {
<a name="l08753"></a>08753         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: out of bounds: %d\n&quot;</span>, __FUNCTION__, nIndex);
<a name="l08754"></a>08754         <span class="comment">// out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<a name="l08755"></a>08755     }
<a name="l08756"></a>08756 
<a name="l08757"></a>08757     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == (pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(nIndex)))
<a name="l08758"></a>08758     {
<a name="l08759"></a>08759         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered \&quot;\&quot; pointer: %d\n&quot;</span>, __FUNCTION__, nIndex);
<a name="l08760"></a>08760     } <span class="comment">// NO NEED TO CLEANUP the transaction, since it is already &quot;owned&quot; by theLedger.</span>
<a name="l08761"></a>08761 
<a name="l08762"></a>08762     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s get the ID...</span>
<a name="l08763"></a>08763 
<a name="l08764"></a>08764     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 &gt;= (lTransactionNumber = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>()))
<a name="l08765"></a>08765     {
<a name="l08766"></a>08766         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: negative or zero transaction num: %lld\n&quot;</span>, __FUNCTION__, lTransactionNumber);
<a name="l08767"></a>08767         <span class="keywordflow">return</span> -1;
<a name="l08768"></a>08768     }
<a name="l08769"></a>08769     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l08770"></a>08770     {
<a name="l08771"></a>08771         <span class="keywordflow">return</span> lTransactionNumber;
<a name="l08772"></a>08772     }
<a name="l08773"></a>08773 
<a name="l08774"></a>08774     <span class="keywordflow">return</span> -1;
<a name="l08775"></a>08775 }
<a name="l08776"></a>08776 
<a name="l08777"></a>08777 
<a name="l08778"></a>08778 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08779"></a>08779 <span class="comment">// Add a transaction to a ledger.</span>
<a name="l08780"></a>08780 <span class="comment">// (Returns the updated ledger.)</span>
<a name="l08781"></a>08781 <span class="comment">//</span>
<a name="l08782"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab1c6a2da160b7c47081e3a09756899a7">08782</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ab1c6a2da160b7c47081e3a09756899a7" title="Add a transaction to a ledger.">OTAPI_Exec::Ledger_AddTransaction</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08783"></a>08783                                          <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08784"></a>08784                                          <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08785"></a>08785                                          <span class="keyword">const</span> std::string &amp; THE_LEDGER,
<a name="l08786"></a>08786                                          <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l08787"></a>08787 {
<a name="l08788"></a>08788     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08789"></a>08789     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08790"></a>08790     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08791"></a>08791     <span class="keywordflow">if</span> (THE_LEDGER.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08792"></a>08792     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08793"></a>08793 
<a name="l08794"></a>08794     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l08795"></a>08795 
<a name="l08796"></a>08796     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08797"></a>08797     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l08798"></a>08798 
<a name="l08799"></a>08799     <span class="comment">// -----------------------------------------------------</span>
<a name="l08800"></a>08800     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l08801"></a>08801     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08802"></a>08802     <span class="comment">// -----------------------------------------------------</span>
<a name="l08803"></a>08803 
<a name="l08804"></a>08804     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l08805"></a>08805 
<a name="l08806"></a>08806     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l08807"></a>08807     {
<a name="l08808"></a>08808         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08809"></a>08809         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08810"></a>08810         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08811"></a>08811     }
<a name="l08812"></a>08812     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l08813"></a>08813     {
<a name="l08814"></a>08814         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08815"></a>08815         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying ledger in OTAPI_Exec::Ledger_AddTransaction. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08816"></a>08816         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08817"></a>08817     }
<a name="l08818"></a>08818 
<a name="l08819"></a>08819     <span class="comment">// At this point, I know theLedger loaded and verified successfully.</span>
<a name="l08820"></a>08820     <span class="comment">// -----------------------------------------------------</span>
<a name="l08821"></a>08821 
<a name="l08822"></a>08822     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = <span class="keyword">new</span> <a class="code" href="class_o_t_transaction.html">OTTransaction</a>(theUserID, theAccountID, theServerID);
<a name="l08823"></a>08823     <span class="keywordflow">if</span> (NULL == pTransaction)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error allocating memory in the OTAPI: %s !\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;pTransaction&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08824"></a>08824 
<a name="l08825"></a>08825     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l08826"></a>08826     {
<a name="l08827"></a>08827         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08828"></a>08828         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08829"></a>08829         <span class="keyword">delete</span> pTransaction; pTransaction = NULL;
<a name="l08830"></a>08830         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08831"></a>08831     }
<a name="l08832"></a>08832     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#afba0d981b40568e307178f908788fd7b">VerifyAccount</a>(*pNym))
<a name="l08833"></a>08833     {
<a name="l08834"></a>08834         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l08835"></a>08835         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying transaction. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08836"></a>08836         <span class="keyword">delete</span> pTransaction; pTransaction = NULL;
<a name="l08837"></a>08837         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08838"></a>08838     }
<a name="l08839"></a>08839     <span class="comment">// -----------------------------------------------------</span>
<a name="l08840"></a>08840     <span class="comment">// At this point, I know pTransaction loaded and verified successfully.</span>
<a name="l08841"></a>08841     <span class="comment">// So let&#39;s add it to the ledger, save, and return updated ledger in string form.</span>
<a name="l08842"></a>08842 
<a name="l08843"></a>08843     theLedger.<a class="code" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a>(*pTransaction); <span class="comment">// Ledger now &quot;owns&quot; it and will handle cleanup.</span>
<a name="l08844"></a>08844 
<a name="l08845"></a>08845     theLedger.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l08846"></a>08846     theLedger.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l08847"></a>08847     theLedger.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l08848"></a>08848 
<a name="l08849"></a>08849     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theLedger); <span class="comment">// For the output</span>
<a name="l08850"></a>08850 
<a name="l08851"></a>08851     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l08852"></a>08852 
<a name="l08853"></a>08853 
<a name="l08854"></a>08854 
<a name="l08855"></a>08855     <span class="keywordflow">return</span> pBuf;
<a name="l08856"></a>08856 }
<a name="l08857"></a>08857 
<a name="l08858"></a>08858 
<a name="l08859"></a>08859 
<a name="l08860"></a>08860 <span class="comment">// --------------------------------------------------------------</span>
<a name="l08861"></a>08861 <span class="comment">// Create a &#39;response&#39; transaction, that will be used to indicate my</span>
<a name="l08862"></a>08862 <span class="comment">// acceptance or rejection of another transaction. Usually an entire</span>
<a name="l08863"></a>08863 <span class="comment">// ledger full of these is sent to the server as I process the various</span>
<a name="l08864"></a>08864 <span class="comment">// transactions in my inbox.</span>
<a name="l08865"></a>08865 <span class="comment">//</span>
<a name="l08866"></a>08866 <span class="comment">// The original transaction is passed in, and I generate a response transaction based on it.</span>
<a name="l08867"></a>08867 <span class="comment">// Also, the response ledger is passed in, so I load it, add the response transaction, save</span>
<a name="l08868"></a>08868 <span class="comment">// it back to string, and return the string.</span>
<a name="l08869"></a>08869 <span class="comment">//</span>
<a name="l08870"></a>08870 <span class="comment">// This way, users can call this function multiple times, adding transactions until done.</span>
<a name="l08871"></a>08871 <span class="comment">//</span>
<a name="l08872"></a><a class="code" href="class_o_t_a_p_i___exec.html#aff7a984d28b09d76103f52faebfb754c">08872</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aff7a984d28b09d76103f52faebfb754c">OTAPI_Exec::Transaction_CreateResponse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l08873"></a>08873                                                    <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l08874"></a>08874                                                    <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l08875"></a>08875                                                    <span class="keyword">const</span> std::string &amp; THE_LEDGER, <span class="comment">// &#39;Response&#39; ledger be sent to the server...</span>
<a name="l08876"></a>08876                                                    <span class="keyword">const</span> std::string &amp; THE_TRANSACTION, <span class="comment">// Responding to...?</span>
<a name="l08877"></a>08877                                                    <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; BOOL_DO_I_ACCEPT)   <span class="comment">// 0 or 1  (true or false.)</span>
<a name="l08878"></a>08878 {
<a name="l08879"></a>08879     <span class="keywordflow">if</span> (SERVER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08880"></a>08880     <span class="keywordflow">if</span> (USER_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08881"></a>08881     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08882"></a>08882     <span class="keywordflow">if</span> (THE_LEDGER.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08883"></a>08883     <span class="keywordflow">if</span> (THE_TRANSACTION.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l08884"></a>08884 
<a name="l08885"></a>08885     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCOUNT_ID);
<a name="l08886"></a>08886 
<a name="l08887"></a>08887     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER);
<a name="l08888"></a>08888     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l08889"></a>08889     <span class="comment">// -----------------------------------------------------</span>
<a name="l08890"></a>08890     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(theServerID, __FUNCTION__);
<a name="l08891"></a>08891     <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08892"></a>08892     <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
<a name="l08893"></a>08893     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l08894"></a>08894     <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServer-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l08895"></a>08895 
<a name="l08896"></a>08896     <span class="keywordflow">if</span> (NULL == pServerNym)
<a name="l08897"></a>08897     {
<a name="l08898"></a>08898         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No Contract Nym found in that Server Contract.\n&quot;</span>, __FUNCTION__);
<a name="l08899"></a>08899         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08900"></a>08900     }
<a name="l08901"></a>08901     <span class="comment">// By this point, pServerNym is a good pointer.  (No need to cleanup.)</span>
<a name="l08902"></a>08902     <span class="comment">// -----------------------------------------------------</span>
<a name="l08903"></a>08903     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs, ASSERTs, etc.</span>
<a name="l08904"></a>08904     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08905"></a>08905     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l08906"></a>08906     <span class="comment">// -----------------------------------------------------</span>
<a name="l08907"></a>08907     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAcctID, theServerID);
<a name="l08908"></a>08908 
<a name="l08909"></a>08909     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l08910"></a>08910     {
<a name="l08911"></a>08911         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l08912"></a>08912         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08913"></a>08913         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08914"></a>08914     }
<a name="l08915"></a>08915     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l08916"></a>08916     {
<a name="l08917"></a>08917         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l08918"></a>08918         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying ledger. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08919"></a>08919         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08920"></a>08920     }
<a name="l08921"></a>08921 
<a name="l08922"></a>08922     <span class="comment">// At this point, I know theLedger loaded and verified successfully.</span>
<a name="l08923"></a>08923     <span class="comment">// (This is the &#39;response&#39; ledger that the user previously generated,</span>
<a name="l08924"></a>08924     <span class="comment">// and now he is loading it up with responses that this function will</span>
<a name="l08925"></a>08925     <span class="comment">// generate on his behalf.)</span>
<a name="l08926"></a>08926     <span class="comment">// -----------------------------------------------------</span>
<a name="l08927"></a>08927     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAcctID, theServerID);
<a name="l08928"></a>08928 
<a name="l08929"></a>08929     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l08930"></a>08930     {
<a name="l08931"></a>08931         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l08932"></a>08932         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08933"></a>08933         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08934"></a>08934     }
<a name="l08935"></a>08935     <span class="comment">// --------------------------------------</span>
<a name="l08936"></a>08936     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l08937"></a>08937     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l08938"></a>08938 
<a name="l08939"></a>08939     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l08940"></a>08940     {
<a name="l08941"></a>08941         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>));
<a name="l08942"></a>08942 
<a name="l08943"></a>08943         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l08944"></a>08944         {
<a name="l08945"></a>08945             <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l08946"></a>08946             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading full transaction from abbreviated version of inbox receipt. Acct ID: %s\n&quot;</span>,
<a name="l08947"></a>08947                           __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08948"></a>08948             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08949"></a>08949         }
<a name="l08950"></a>08950         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l08951"></a>08951     }
<a name="l08952"></a>08952     <span class="keywordflow">else</span>
<a name="l08953"></a>08953         pTransaction = &amp;theTransaction;
<a name="l08954"></a>08954     <span class="comment">// --------------------------------------</span>
<a name="l08955"></a>08955     <span class="comment">// BELOW THIS POINT, only use pTransaction, not theTransaction.</span>
<a name="l08956"></a>08956 
<a name="l08957"></a>08957     <span class="comment">// This transaction is presumably from the server, since we are in this</span>
<a name="l08958"></a>08958     <span class="comment">// function in order to generate a response back to the server. So therefore</span>
<a name="l08959"></a>08959     <span class="comment">// I want to verify that the server has actually signed the thing, before</span>
<a name="l08960"></a>08960     <span class="comment">// I go off responding to it like a damned fool.</span>
<a name="l08961"></a>08961     <span class="comment">//</span>
<a name="l08962"></a>08962     <span class="keywordflow">if</span> (<span class="keyword">false</span> == pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#afba0d981b40568e307178f908788fd7b">VerifyAccount</a>(*((<a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> *)pServerNym)))
<a name="l08963"></a>08963     {
<a name="l08964"></a>08964         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l08965"></a>08965         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying transaction. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l08966"></a>08966         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08967"></a>08967     }
<a name="l08968"></a>08968 
<a name="l08969"></a>08969     <span class="comment">// -----------------------------------------------------</span>
<a name="l08970"></a>08970 
<a name="l08971"></a>08971     <span class="keywordflow">if</span> (
<a name="l08972"></a>08972             (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>         != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08973"></a>08973         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>   != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08974"></a>08974         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>  != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08975"></a>08975         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a> != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08976"></a>08976         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>   != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08977"></a>08977         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>  != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08978"></a>08978         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>    != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08979"></a>08979         &amp;&amp;  (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>   != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l08980"></a>08980         )
<a name="l08981"></a>08981     {
<a name="l08982"></a>08982         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: wrong transaction type: %s.\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l08983"></a>08983         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l08984"></a>08984     }
<a name="l08985"></a>08985     <span class="comment">// -----------------------------------------------------</span>
<a name="l08986"></a>08986     <span class="comment">// At this point, I know pTransaction loaded and verified successfully.</span>
<a name="l08987"></a>08987     <span class="comment">// So let&#39;s generate a response item based on it, and add it to a processInbox</span>
<a name="l08988"></a>08988     <span class="comment">// transaction to be added to that ledger (if one&#39;s not already there...)</span>
<a name="l08989"></a>08989 
<a name="l08990"></a>08990     <span class="comment">// First, check to see if there is a processInbox transaction already on</span>
<a name="l08991"></a>08991     <span class="comment">// the ledger...</span>
<a name="l08992"></a>08992     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pResponse = theLedger.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>);
<a name="l08993"></a>08993 
<a name="l08994"></a>08994     <span class="comment">// If it&#39;s not already there, create it and add it.</span>
<a name="l08995"></a>08995     <span class="keywordflow">if</span> (NULL == pResponse)
<a name="l08996"></a>08996     {
<a name="l08997"></a>08997         <a class="code" href="class_o_t_string.html">OTString</a> strServerID(theServerID);
<a name="l08998"></a>08998         int64_t lTransactionNumber=0;
<a name="l08999"></a>08999         <span class="keywordtype">bool</span> bGotTransNum = pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a82c5ec5457947738c807bffd581181ac">GetNextTransactionNum</a>(*pNym, strServerID, lTransactionNumber);
<a name="l09000"></a>09000 
<a name="l09001"></a>09001         <span class="keywordflow">if</span> (<span class="keyword">false</span> == bGotTransNum)
<a name="l09002"></a>09002         {
<a name="l09003"></a>09003             <a class="code" href="class_o_t_string.html">OTString</a> strNymID(theUserID);
<a name="l09004"></a>09004             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: User is all out of transaction numbers:\n%s\n&quot;</span>,
<a name="l09005"></a>09005                            __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09006"></a>09006             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09007"></a>09007         }
<a name="l09008"></a>09008 
<a name="l09009"></a>09009         pResponse = <a class="code" href="class_o_t_transaction.html#a5bfc7ce34aa67cf9dad96e661e118020">OTTransaction::GenerateTransaction</a>(theUserID, theAcctID, theServerID,
<a name="l09010"></a>09010             <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>, lTransactionNumber);
<a name="l09011"></a>09011 
<a name="l09012"></a>09012         <span class="keywordflow">if</span> (NULL == pResponse)
<a name="l09013"></a>09013         {
<a name="l09014"></a>09014             <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l09015"></a>09015             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error generating processInbox transaction for AcctID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09016"></a>09016 
<a name="l09017"></a>09017             pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a2771ea8cf77d2ac05d942e149c2bc3e6">AddTransactionNum</a>(*pNym, strServerID, lTransactionNumber, <span class="keyword">true</span>); <span class="comment">// bSave=true.  Have to add this back since we failed to use it.</span>
<a name="l09018"></a>09018 
<a name="l09019"></a>09019             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09020"></a>09020         }
<a name="l09021"></a>09021 
<a name="l09022"></a>09022         theLedger.<a class="code" href="class_o_t_ledger.html#a6befecfc9199e90d459f3c89f2f0dc14">AddTransaction</a>(*pResponse); <span class="comment">// Ledger now &quot;owns&quot; it and will handle cleanup.</span>
<a name="l09023"></a>09023     }
<a name="l09024"></a>09024 
<a name="l09025"></a>09025     <span class="comment">// At this point32_t I know pResponse is a processInbox transaction, ready to go,</span>
<a name="l09026"></a>09026     <span class="comment">// and that theLedger will handle any cleanup issues related to it.</span>
<a name="l09027"></a>09027 
<a name="l09028"></a>09028     <span class="comment">// -----------------------------------------------------</span>
<a name="l09029"></a>09029 
<a name="l09030"></a>09030     <span class="comment">// Next let&#39;s create a new item that responds to pTransaction, and add that</span>
<a name="l09031"></a>09031     <span class="comment">// item to pResponse. Then we&#39;ll return the updated ledger.</span>
<a name="l09032"></a>09032 
<a name="l09033"></a>09033     <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l09034"></a>09034     <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1">OTItem::itemType</a> theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l09035"></a>09035 
<a name="l09036"></a>09036     <span class="keywordflow">switch</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l09037"></a>09037     {
<a name="l09038"></a>09038     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:
<a name="l09039"></a>09039         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>;
<a name="l09040"></a>09040         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a873fcfb43e552e1f81d475fb898e9ac8">OTItem::rejectPending</a>;
<a name="l09041"></a>09041         <span class="keywordflow">break</span>;
<a name="l09042"></a>09042 
<a name="l09043"></a>09043 
<a name="l09044"></a>09044     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:
<a name="l09045"></a>09045     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
<a name="l09046"></a>09046         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>;
<a name="l09047"></a>09047         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a0ae31723e4a6a715f4de40bf18aa932f">OTItem::disputeCronReceipt</a>;
<a name="l09048"></a>09048         <span class="keywordflow">break</span>;
<a name="l09049"></a>09049 
<a name="l09050"></a>09050     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:
<a name="l09051"></a>09051     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:
<a name="l09052"></a>09052     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>:
<a name="l09053"></a>09053         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>;
<a name="l09054"></a>09054         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4eb8608cbf2db1dd590856c3777e70a2">OTItem::disputeItemReceipt</a>;
<a name="l09055"></a>09055         <span class="keywordflow">break</span>;
<a name="l09056"></a>09056 
<a name="l09057"></a>09057     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:
<a name="l09058"></a>09058         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>;
<a name="l09059"></a>09059         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a62442ecb84d96e94176c7f9b533a9061">OTItem::disputeFinalReceipt</a>;
<a name="l09060"></a>09060         <span class="keywordflow">break</span>;
<a name="l09061"></a>09061 
<a name="l09062"></a>09062     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
<a name="l09063"></a>09063         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>;
<a name="l09064"></a>09064         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a69a150fe3a7ec3726dc71d183d572a87">OTItem::disputeBasketReceipt</a>;
<a name="l09065"></a>09065         <span class="keywordflow">break</span>;
<a name="l09066"></a>09066 
<a name="l09067"></a>09067     <span class="keywordflow">default</span>:
<a name="l09068"></a>09068         theAcceptItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l09069"></a>09069         theRejectItemType = <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a2990979bdd62bac5b4bc4f6e1a2cc5e6">OTItem::error_state</a>;
<a name="l09070"></a>09070         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unexpected transaction type in: %s\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l09071"></a>09071         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09072"></a>09072     }
<a name="l09073"></a>09073     <span class="comment">// -------------------------------------------------</span>
<a name="l09074"></a>09074     int64_t  lReferenceTransactionNum = 0;
<a name="l09075"></a>09075     int64_t     lNumberOfOrigin          = 0;
<a name="l09076"></a>09076     <a class="code" href="class_o_t_string.html">OTString</a> strNote;
<a name="l09077"></a>09077     <span class="comment">// -------------------------------------------------</span>
<a name="l09078"></a>09078     <span class="keywordflow">switch</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l09079"></a>09079     {
<a name="l09080"></a>09080     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ad46b36946aa172b4e69558c3c5697c63">OTTransaction::marketReceipt</a>:
<a name="l09081"></a>09081     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8aac41b416522c9ba6453c787607c6c68d">OTTransaction::paymentReceipt</a>:
<a name="l09082"></a>09082     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a>:
<a name="l09083"></a>09083     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a2f852a3f97691d417faa322cdbbb3377">OTTransaction::basketReceipt</a>:
<a name="l09084"></a>09084             lNumberOfOrigin          = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>();
<a name="l09085"></a>09085             lReferenceTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();   <span class="comment">// &lt;=== References the receipt in my inbox.</span>
<a name="l09086"></a>09086         <span class="keywordflow">break</span>;
<a name="l09087"></a>09087 
<a name="l09088"></a>09088     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8ab184c4314c99d16d439c96380a4e27cb">OTTransaction::transferReceipt</a>: <span class="comment">// Contains &quot;in ref to&quot; acceptPending item from someone who processed their inbox to accept my transfer.</span>
<a name="l09089"></a>09089     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a>:         <span class="comment">// Contains &quot;in ref to&quot; transfer item from someone who sent me a transfer.</span>
<a name="l09090"></a>09090     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a9a92eac3a7ccff17583eb089a056f5af">OTTransaction::chequeReceipt</a>:   <span class="comment">// Contains &quot;in ref to&quot; depositCheque item from someone who deposited my cheque.</span>
<a name="l09091"></a>09091     <span class="keywordflow">case</span> <a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a11b89ff8cbf5b3d7c526f4d166f653c8">OTTransaction::voucherReceipt</a>:  <span class="comment">// Contains &quot;in ref to&quot; depositCheque item from someone who deposited my voucher.</span>
<a name="l09092"></a>09092         {
<a name="l09093"></a>09093             <span class="comment">// -----------------------------------------------------</span>
<a name="l09094"></a>09094             <span class="comment">// Here&#39;s some code in case you need to load up the item.</span>
<a name="l09095"></a>09095             <a class="code" href="class_o_t_string.html">OTString</a> strReference;
<a name="l09096"></a>09096             pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
<a name="l09097"></a>09097 
<a name="l09098"></a>09098             <span class="keywordflow">if</span> (!strReference.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l09099"></a>09099             {
<a name="l09100"></a>09100                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No reference string found on transaction.\n&quot;</span>, __FUNCTION__);
<a name="l09101"></a>09101                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09102"></a>09102             }
<a name="l09103"></a>09103             <span class="comment">// -----------------------------------------------------</span>
<a name="l09104"></a>09104             <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, theServerID, pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09105"></a>09105             <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theAngel(pOriginalItem);
<a name="l09106"></a>09106 
<a name="l09107"></a>09107             <span class="keywordflow">if</span> (NULL == pOriginalItem)
<a name="l09108"></a>09108             {
<a name="l09109"></a>09109                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading transaction item from string.\n&quot;</span>,__FUNCTION__);
<a name="l09110"></a>09110                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09111"></a>09111             }
<a name="l09112"></a>09112             <span class="comment">// pItem will be automatically cleaned up when it goes out of scope.</span>
<a name="l09113"></a>09113             <span class="comment">// -----------------------------------------------------</span>
<a name="l09114"></a>09114             <span class="keywordflow">if</span> (
<a name="l09115"></a>09115                 (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a16fa1b0df4dbad1367dbd0f6dbac9572">OTItem::request</a> != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>())
<a name="l09116"></a>09116                 ||
<a name="l09117"></a>09117                 (
<a name="l09118"></a>09118                 (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>  != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())  &amp;&amp; <span class="comment">// I&#39;m accepting a transfer receipt that was created by someone&#39;s acceptPending (from a transfer I sent.)</span>
<a name="l09119"></a>09119                  (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>      != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())  &amp;&amp; <span class="comment">// I&#39;m accepting a pending transfer that was created by someone&#39;s transfer to me.</span>
<a name="l09120"></a>09120                 (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a>  != pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())     <span class="comment">// I&#39;m accepting a cheque or voucher receipt that was created by someone&#39;s depositCheque (of a cheque I wrote or a voucher I remitted.)</span>
<a name="l09121"></a>09121                 )
<a name="l09122"></a>09122                 )
<a name="l09123"></a>09123             {
<a name="l09124"></a>09124                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type or status attached as reference on transaction.\n&quot;</span>, __FUNCTION__);
<a name="l09125"></a>09125                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09126"></a>09126             }
<a name="l09127"></a>09127             <span class="comment">// -----------------------------------------------------------</span>
<a name="l09128"></a>09128             <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a> == pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
<a name="l09129"></a>09129                 pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">GetNote</a>(strNote);
<a name="l09130"></a>09130             <span class="comment">// -----------------------------------------------------------</span>
<a name="l09131"></a>09131             lNumberOfOrigin          = pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>();
<a name="l09132"></a>09132             lReferenceTransactionNum = pTransaction-&gt; GetTransactionNum();  <span class="comment">// &lt;=== References the receipt in my inbox.</span>
<a name="l09133"></a>09133 <span class="comment">//          lReferenceTransactionNum = pOriginalItem-&gt;GetReferenceToNum();  // &lt;=== References the original transfer I sent, or N/A (for pending), or cheque I wrote.</span>
<a name="l09134"></a>09134 <span class="comment">//          lReferenceTransactionNum = pOriginalItem-&gt;GetTransactionNum();  // &lt;=== References someone else&#39;s transaction that put the receipt into my inbox.</span>
<a name="l09135"></a>09135         }
<a name="l09136"></a>09136         <span class="comment">// -----------------------------------------------------</span>
<a name="l09137"></a>09137         <span class="keywordflow">break</span>;
<a name="l09138"></a>09138 
<a name="l09139"></a>09139     <span class="keywordflow">default</span>:
<a name="l09140"></a>09140         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unexpected transaction type in: %s\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l09141"></a>09141         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09142"></a>09142     }
<a name="l09143"></a>09143     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09144"></a>09144     <a class="code" href="class_o_t_item.html">OTItem</a> * pAcceptItem = <a class="code" href="class_o_t_item.html#a2376ee56b6c536a63a59e2bfebada0b3">OTItem::CreateItemFromTransaction</a>(*pResponse,
<a name="l09145"></a>09145         (<span class="keyword">true</span> == BOOL_DO_I_ACCEPT) ? theAcceptItemType : theRejectItemType); <span class="comment">// set above.</span>
<a name="l09146"></a>09146     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09147"></a>09147     pAcceptItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a4ebf2e97c2c1895b80f0c5fee2f9a87f">SetNumberOfOrigin</a>(lNumberOfOrigin);
<a name="l09148"></a>09148     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09149"></a>09149     <span class="comment">// Set up the &quot;accept&quot; transaction item to be sent to the server</span>
<a name="l09150"></a>09150     <span class="comment">// (this item references and accepts another item by its transaction number--</span>
<a name="l09151"></a>09151     <span class="comment">//  one that is already there in my inbox)</span>
<a name="l09152"></a>09152     pAcceptItem-&gt;<a class="code" href="class_o_t_transaction_type.html#ab0f87cd43699c20eddd70b5970c092d1">SetReferenceToNum</a>(static_cast&lt;int64_t&gt;(lReferenceTransactionNum)); <span class="comment">// This is critical. Server needs this to look up the original.</span>
<a name="l09153"></a>09153     <span class="comment">// Don&#39;t need to set transaction num on item since the constructor already got it off the owner transaction.</span>
<a name="l09154"></a>09154     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09155"></a>09155     pAcceptItem-&gt;<a class="code" href="class_o_t_item.html#a81d53d2910a45fdbb11d92ae680519fb">SetAmount</a>(pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>()); <span class="comment">// Server validates this, so make sure it&#39;s right.</span>
<a name="l09156"></a>09156     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09157"></a>09157     <span class="keywordflow">if</span> (strNote.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l09158"></a>09158         pAcceptItem-&gt;<a class="code" href="class_o_t_item.html#ac0a3c73f3c09f2fdbd83a381898360df">SetNote</a>(strNote);
<a name="l09159"></a>09159     <span class="comment">// ------------------------------------------------------------------</span>
<a name="l09160"></a>09160     <span class="comment">// sign the item</span>
<a name="l09161"></a>09161     pAcceptItem-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l09162"></a>09162     pAcceptItem-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l09163"></a>09163     <span class="comment">// ----------------------------------------------------------------------------------</span>
<a name="l09164"></a>09164     <span class="comment">// Make sure there&#39;s not already a response item in reference to the same receipt.</span>
<a name="l09165"></a>09165     <span class="comment">//</span>
<a name="l09166"></a>09166     <span class="comment">// UPDATE, NOTE: Turns out, it&#39;s normal to have multiple receipts in reference to the same thing.</span>
<a name="l09167"></a>09167     <span class="comment">// For example, I might have two transfer receipts that are both in reference to the same notarizeInbox.</span>
<a name="l09168"></a>09168     <span class="comment">//</span>
<a name="l09169"></a>09169 <span class="comment">//    OTItem * pExistingItem = pResponse-&gt;GetItemInRefTo(lReferenceTransactionNum);</span>
<a name="l09170"></a>09170 <span class="comment">//    if (NULL != pExistingItem)</span>
<a name="l09171"></a>09171 <span class="comment">//    {</span>
<a name="l09172"></a>09172 <span class="comment">//        OTLog::vError(&quot;%s: Error: There&#39;s already a response item in reference to the same receipt! (In Ref: %lld User: %s Account: %s) Failure.\n\n&quot;,</span>
<a name="l09173"></a>09173 <span class="comment">//                      __FUNCTION__, static_cast&lt;int64_t&gt;(lReferenceTransactionNum), USER_ID.c_str(), ACCOUNT_ID.c_str());</span>
<a name="l09174"></a>09174 <span class="comment">//</span>
<a name="l09175"></a>09175 <span class="comment">//        const OTString strAccept(*pAcceptItem);</span>
<a name="l09176"></a>09176 <span class="comment">//        OTLog::vError(&quot;===&gt; Failed accept item:\n%s\n\n&quot;, strAccept.Get());</span>
<a name="l09177"></a>09177 <span class="comment">//</span>
<a name="l09178"></a>09178 <span class="comment">//        const OTString strExisting(*pExistingItem);</span>
<a name="l09179"></a>09179 <span class="comment">//        OTLog::vError(&quot;===&gt; Pre-existing item:\n%s\n\n&quot;, strExisting.Get());</span>
<a name="l09180"></a>09180 <span class="comment">//</span>
<a name="l09181"></a>09181 <span class="comment">//        return &quot;&quot;;</span>
<a name="l09182"></a>09182 <span class="comment">//    }</span>
<a name="l09183"></a>09183     <span class="comment">// ----------------------------------------------------------------------------------</span>
<a name="l09184"></a>09184     <span class="comment">// the transaction will handle cleaning up the transaction item.</span>
<a name="l09185"></a>09185     pResponse-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pAcceptItem);
<a name="l09186"></a>09186 
<a name="l09187"></a>09187     <span class="comment">// I don&#39;t attach the original item here because I already reference it by transaction num,</span>
<a name="l09188"></a>09188     <span class="comment">// and because the server already has it and sent it to me. SO I just need to give the server</span>
<a name="l09189"></a>09189     <span class="comment">// enough info to look it up again.</span>
<a name="l09190"></a>09190 
<a name="l09191"></a>09191     pResponse-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l09192"></a>09192     pResponse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l09193"></a>09193     pResponse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l09194"></a>09194 
<a name="l09195"></a>09195     theLedger.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l09196"></a>09196     theLedger.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l09197"></a>09197     theLedger.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l09198"></a>09198 
<a name="l09199"></a>09199     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theLedger); <span class="comment">// For the output</span>
<a name="l09200"></a>09200 
<a name="l09201"></a>09201     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l09202"></a>09202 
<a name="l09203"></a>09203     <span class="keywordflow">return</span> pBuf;
<a name="l09204"></a>09204 }
<a name="l09205"></a>09205 
<a name="l09206"></a>09206 
<a name="l09207"></a>09207 
<a name="l09208"></a>09208 <span class="comment">// -------------------------------------------------------------------------</span>
<a name="l09209"></a>09209 <span class="comment">// (Response Ledger) LEDGER FINALIZE RESPONSE</span>
<a name="l09210"></a>09210 <span class="comment">//</span>
<a name="l09211"></a>09211 <span class="comment">// AFTER you have set up all the transaction responses, call THIS function</span>
<a name="l09212"></a>09212 <span class="comment">// to finalize them by adding a BALANCE AGREEMENT.</span>
<a name="l09213"></a>09213 <span class="comment">//</span>
<a name="l09214"></a>09214 <span class="comment">// MAKE SURE you have the latest copy of the account file, inbox file, and</span>
<a name="l09215"></a>09215 <span class="comment">// outbox file, since we will need those in here to create the balance statement</span>
<a name="l09216"></a>09216 <span class="comment">// properly.</span>
<a name="l09217"></a>09217 <span class="comment">//</span>
<a name="l09218"></a>09218 <span class="comment">// (Client software may wish to check those things, when downloaded, against</span>
<a name="l09219"></a>09219 <span class="comment">// the local copies and the local signed receipts. In this way, clients can</span>
<a name="l09220"></a>09220 <span class="comment">// protect themselves against malicious servers.)</span>
<a name="l09221"></a>09221 <span class="comment">//</span>
<a name="l09222"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae43e5ed33e7e2281c92a35818338c953">09222</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae43e5ed33e7e2281c92a35818338c953">OTAPI_Exec::Ledger_FinalizeResponse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l09223"></a>09223                                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l09224"></a>09224                                                 <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l09225"></a>09225                                                 <span class="keyword">const</span> std::string &amp; THE_LEDGER) <span class="comment">// &#39;Response&#39; ledger be sent to the server...</span>
<a name="l09226"></a>09226 {
<a name="l09227"></a>09227     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09228"></a>09228     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09229"></a>09229     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09230"></a>09230     <span class="keywordflow">if</span> (THE_LEDGER.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_LEDGER&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09231"></a>09231 
<a name="l09232"></a>09232     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l09233"></a>09233                         theUserID(USER_ID),
<a name="l09234"></a>09234                         theAcctID(ACCOUNT_ID);
<a name="l09235"></a>09235 
<a name="l09236"></a>09236     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(THE_LEDGER), strServerID(theServerID);
<a name="l09237"></a>09237     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l09238"></a>09238     <a class="code" href="class_o_t_server_contract.html">OTServerContract</a> * pServer = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afa4e2d39d29061b609d81f094c2ca25c">GetServer</a>(theServerID, __FUNCTION__);
<a name="l09239"></a>09239     <span class="keywordflow">if</span> (NULL == pServer) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09240"></a>09240     <span class="comment">// By this point, pServer is a good pointer.  (No need to cleanup.)</span>
<a name="l09241"></a>09241     <span class="comment">// --------------------------------------------------------------------</span>
<a name="l09242"></a>09242     <span class="keyword">const</span> <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pServerNym = pServer-&gt;<a class="code" href="class_o_t_contract.html#affb6a11ee52ad13fd6e1e1ef6e4bbdc1">GetContractPublicNym</a>();
<a name="l09243"></a>09243 
<a name="l09244"></a>09244     <span class="keywordflow">if</span> (NULL == pServerNym)
<a name="l09245"></a>09245     {
<a name="l09246"></a>09246         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No Contract Nym found in that Server Contract.\n&quot;</span>, __FUNCTION__);
<a name="l09247"></a>09247         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09248"></a>09248     }
<a name="l09249"></a>09249     <span class="comment">// By this point, pServerNym is a good pointer.  (No need to cleanup.)</span>
<a name="l09250"></a>09250     <span class="comment">// -----------------------------------------------------</span>
<a name="l09251"></a>09251     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// This logs, ASSERTs, etc.</span>
<a name="l09252"></a>09252     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09253"></a>09253     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l09254"></a>09254     <span class="comment">// -----------------------------------------------------</span>
<a name="l09255"></a>09255     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAcctID, theServerID);
<a name="l09256"></a>09256 
<a name="l09257"></a>09257     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l09258"></a>09258     {
<a name="l09259"></a>09259         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l09260"></a>09260         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09261"></a>09261         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09262"></a>09262     }
<a name="l09263"></a>09263     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l09264"></a>09264     {
<a name="l09265"></a>09265         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l09266"></a>09266         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error verifying ledger. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09267"></a>09267         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09268"></a>09268     }
<a name="l09269"></a>09269 
<a name="l09270"></a>09270     <span class="comment">// At this point, I know theLedger loaded and verified successfully.</span>
<a name="l09271"></a>09271     <span class="comment">// (This is the &#39;response&#39; ledger that the user previously generated</span>
<a name="l09272"></a>09272     <span class="comment">// in response to the various inbox receipts, and now he is loading</span>
<a name="l09273"></a>09273     <span class="comment">// it up with responses that this function will finalize for sending.)</span>
<a name="l09274"></a>09274     <span class="comment">// -----------------------------------------------------</span>
<a name="l09275"></a>09275 
<a name="l09276"></a>09276     <span class="comment">// First, check to see if there is a processInbox transaction already on</span>
<a name="l09277"></a>09277     <span class="comment">// the ledger...</span>
<a name="l09278"></a>09278     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a17de28d6bffb971efeebbd9a2fff5ada">OTTransaction::processInbox</a>);
<a name="l09279"></a>09279 
<a name="l09280"></a>09280     <span class="comment">// If it&#39;s not already there, create it and add it.</span>
<a name="l09281"></a>09281     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l09282"></a>09282     {
<a name="l09283"></a>09283         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAcctID);
<a name="l09284"></a>09284         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error finding processInbox transaction for AcctID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09285"></a>09285         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09286"></a>09286     }
<a name="l09287"></a>09287     <span class="comment">// At this point32_t I know pTransaction is a processInbox transaction, ready to go,</span>
<a name="l09288"></a>09288     <span class="comment">// and that theLedger will handle any cleanup issues related to it.</span>
<a name="l09289"></a>09289     <span class="comment">// -----------------------------------------------------</span>
<a name="l09290"></a>09290     <span class="comment">// If balance statement is already there, return.</span>
<a name="l09291"></a>09291     <span class="keywordflow">if</span> (NULL != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1acc6d6f33e3d865c88f56b55d1c06dbec">OTItem::balanceStatement</a>))
<a name="l09292"></a>09292     {
<a name="l09293"></a>09293         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: this response has already been finalized.\n&quot;</span>, __FUNCTION__);
<a name="l09294"></a>09294         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09295"></a>09295     }
<a name="l09296"></a>09296     <span class="comment">// -------------------------------------------------------------</span>
<a name="l09297"></a>09297     <span class="comment">// Get the account.</span>
<a name="l09298"></a>09298     <a class="code" href="class_o_t_account.html">OTAccount</a> * pAccount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a263e050929c3f000ce4172dfbc727149">GetAccount</a>(theAcctID, __FUNCTION__);
<a name="l09299"></a>09299     <span class="keywordflow">if</span> (NULL == pAccount) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09300"></a>09300     <span class="comment">// -------------------------------------------------------------</span>
<a name="l09301"></a>09301     <span class="comment">// Load the inbox and outbox.</span>
<a name="l09302"></a>09302 
<a name="l09303"></a>09303     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theInbox (theUserID, theAcctID, theServerID);
<a name="l09304"></a>09304     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theOutbox(theUserID, theAcctID, theServerID);
<a name="l09305"></a>09305 
<a name="l09306"></a>09306     <span class="keywordflow">if</span> (!theInbox.<a class="code" href="class_o_t_ledger.html#a383560406c46ae01bc5992c4928b45b6">LoadInbox</a>() || !theInbox.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l09307"></a>09307     {
<a name="l09308"></a>09308         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load or verify Inbox for acct %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l09309"></a>09309         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09310"></a>09310     }
<a name="l09311"></a>09311 
<a name="l09312"></a>09312     <span class="keywordflow">if</span> (!theOutbox.<a class="code" href="class_o_t_ledger.html#afa28a4e35a57fa01a8062b608102ddf4">LoadOutbox</a>() || !theOutbox.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym))
<a name="l09313"></a>09313     {
<a name="l09314"></a>09314         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load or verify Outbox for acct %s\n&quot;</span>, __FUNCTION__, ACCOUNT_ID.c_str());
<a name="l09315"></a>09315         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09316"></a>09316     }
<a name="l09317"></a>09317 
<a name="l09318"></a>09318     <span class="comment">// -------------------------------------------------------------</span>
<a name="l09319"></a>09319 
<a name="l09320"></a>09320     <span class="comment">// Setup balance agreement item here!</span>
<a name="l09321"></a>09321     <span class="comment">// Adapting code from OTServer... with comments:</span>
<a name="l09322"></a>09322     <span class="comment">//</span>
<a name="l09323"></a>09323     <span class="comment">// This transaction accepts various incoming pending transfers.</span>
<a name="l09324"></a>09324     <span class="comment">// So when it&#39;s all done, my balance will be higher.</span>
<a name="l09325"></a>09325     <span class="comment">// AND pending inbox items will be removed from my inbox.</span>
<a name="l09326"></a>09326     <span class="comment">//</span>
<a name="l09327"></a>09327     <span class="comment">// I would like to not even process the whole giant loop below,</span>
<a name="l09328"></a>09328     <span class="comment">// if I can verify here now that the balance agreement is wrong.</span>
<a name="l09329"></a>09329     <span class="comment">//</span>
<a name="l09330"></a>09330     <span class="comment">// Thus I will actually loop through the acceptPending items in pTransaction, and then for each one, I&#39;ll</span>
<a name="l09331"></a>09331     <span class="comment">// lookup the ACTUAL transaction in the inbox, and get its ACTUAL value. (And total them all up.)</span>
<a name="l09332"></a>09332     <span class="comment">//</span>
<a name="l09333"></a>09333     <span class="comment">// The total of those, (WITHOUT the user having to tell me what it will be, since I&#39;m looking them all up),</span>
<a name="l09334"></a>09334     <span class="comment">// should equal the difference in the account balance! Meaning the current balance plus that total will be</span>
<a name="l09335"></a>09335     <span class="comment">// the expected NEW balance, according to this balance agreement -- if it wants to be approved, that is.</span>
<a name="l09336"></a>09336     <span class="comment">//</span>
<a name="l09337"></a>09337     <span class="comment">//</span>
<a name="l09338"></a>09338 
<a name="l09339"></a>09339     <span class="keywordtype">bool</span> bSuccessFindingAllTransactions = <span class="keyword">true</span>;
<a name="l09340"></a>09340     int64_t lTotalBeingAccepted = 0;
<a name="l09341"></a>09341 
<a name="l09342"></a>09342     std::list&lt;int64_t&gt; theListOfInboxReceiptsBeingRemoved;
<a name="l09343"></a>09343 
<a name="l09344"></a>09344     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theTempNym;
<a name="l09345"></a>09345 
<a name="l09346"></a>09346     <a class="code" href="_o_t_storage_8hpp.html#a4a94c3435a932ed34e5755f3f472547c">FOR_EACH_IT</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">GetItemList</a>(), it_bigloop)
<a name="l09347"></a>09347     {
<a name="l09348"></a>09348         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it_bigloop;
<a name="l09349"></a>09349         <span class="keywordflow">if</span> (NULL == pItem)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Pointer: %s should not have been \&quot;\&quot;.\n&quot;</span>,
<a name="l09350"></a>09350                                             __FUNCTION__, <span class="stringliteral">&quot;pItem&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09351"></a>09351 
<a name="l09352"></a>09352         <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>) ||
<a name="l09353"></a>09353             (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>))
<a name="l09354"></a>09354         {
<a name="l09355"></a>09355 
<a name="l09356"></a>09356 <span class="comment">//            if (theInbox.GetTransactionCountInRefTo(pItem-&gt;GetReferenceToNum()) &gt; 1)</span>
<a name="l09357"></a>09357 <span class="comment">//                OTLog::vError(&quot;%s: WARNING: There are MULTIPLE receipts &#39;in reference to&#39; %lld. (It will return the first one...)\n&quot;,</span>
<a name="l09358"></a>09358 <span class="comment">//                              __FUNCTION__, pItem-&gt;GetReferenceToNum());</span>
<a name="l09359"></a>09359 
<a name="l09360"></a>09360 
<a name="l09361"></a>09361             <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pServerTransaction = theInbox.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09362"></a>09362 
<a name="l09363"></a>09363             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Checking inbox for expected pending or receipt (%lld) Nym: %s\n&quot;</span>,
<a name="l09364"></a>09364                            __FUNCTION__, pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), USER_ID.c_str()); <span class="comment">// temp remove</span>
<a name="l09365"></a>09365 
<a name="l09366"></a>09366             <span class="keywordflow">if</span> (NULL == pServerTransaction)
<a name="l09367"></a>09367             {
<a name="l09368"></a>09368                 bSuccessFindingAllTransactions = <span class="keyword">false</span>;
<a name="l09369"></a>09369                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Expected receipt %lld NOT found! (Do you have the latest inbox?)\n&quot;</span>,
<a name="l09370"></a>09370                                __FUNCTION__, pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09371"></a>09371                 <span class="keywordflow">break</span>;
<a name="l09372"></a>09372             }
<a name="l09373"></a>09373             <span class="keywordflow">else</span>
<a name="l09374"></a>09374             {
<a name="l09375"></a>09375                 bSuccessFindingAllTransactions = <span class="keyword">true</span>;
<a name="l09376"></a>09376 
<a name="l09377"></a>09377                 <span class="comment">// IF I&#39;m accepting a pending transfer, then add the amount to my counter of total amount being accepted.</span>
<a name="l09378"></a>09378                 <span class="comment">//</span>
<a name="l09379"></a>09379                 <span class="comment">// ELSE if I&#39;m accepting an item receipt (which will remove my responsibility for that item) then add it</span>
<a name="l09380"></a>09380                 <span class="comment">// to the temp Nym (which is a list of transaction numbers that will be removed from my responsibility if</span>
<a name="l09381"></a>09381                 <span class="comment">// all is successful.)  Also remove all the Temp Nym numbers from pNym, so we can verify the Balance</span>
<a name="l09382"></a>09382                 <span class="comment">// Statement AS IF they were already removed. Add them</span>
<a name="l09383"></a>09383                 <span class="comment">//</span>
<a name="l09384"></a>09384                 <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a>) <span class="comment">// acceptPending</span>
<a name="l09385"></a>09385                     lTotalBeingAccepted += pServerTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();   <span class="comment">// &lt;============================</span>
<a name="l09386"></a>09386 
<a name="l09387"></a>09387                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a357f900e6fdf2a978e3bc03f11d9cc75">OTItem::acceptItemReceipt</a>) <span class="comment">// acceptItemReceipt</span>
<a name="l09388"></a>09388                 {
<a name="l09389"></a>09389                     <span class="comment">// What number do I remove here? the user is accepting a transfer receipt, which</span>
<a name="l09390"></a>09390                     <span class="comment">// is in reference to the recipient&#39;s acceptPending. THAT item is in reference to</span>
<a name="l09391"></a>09391                     <span class="comment">// my original transfer (or contains a cheque with my original number.) (THAT&#39;s the # I need.)</span>
<a name="l09392"></a>09392                     <span class="comment">//</span>
<a name="l09393"></a>09393                     <a class="code" href="class_o_t_string.html">OTString</a> strOriginalItem;
<a name="l09394"></a>09394                     pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strOriginalItem);
<a name="l09395"></a>09395 
<a name="l09396"></a>09396                     <a class="code" href="class_o_t_item.html">OTItem</a> * pOriginalItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strOriginalItem, SERVER_ID.c_str(),
<a name="l09397"></a>09397                         pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09398"></a>09398                     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theOrigItemGuardian(pOriginalItem); <span class="comment">// So I don&#39;t have to clean it up later. No memory leaks.</span>
<a name="l09399"></a>09399 
<a name="l09400"></a>09400                     <span class="keywordflow">if</span> (NULL != pOriginalItem)
<a name="l09401"></a>09401                     {
<a name="l09402"></a>09402                         <span class="comment">// If pOriginalItem is acceptPending, that means the client is accepting the transfer receipt from the server, (from his inbox),</span>
<a name="l09403"></a>09403                         <span class="comment">// which has the recipient&#39;s acceptance inside of the client&#39;s transfer as the original item. This means the transfer that</span>
<a name="l09404"></a>09404                         <span class="comment">// the client originally sent is now finally closed!</span>
<a name="l09405"></a>09405                         <span class="comment">//</span>
<a name="l09406"></a>09406                         <span class="comment">// If it&#39;s a depositCheque, that means the client is accepting the cheque receipt from the server,</span>
<a name="l09407"></a>09407                         <span class="comment">// (from his inbox)</span>
<a name="l09408"></a>09408                         <span class="comment">// which has the recipient&#39;s deposit inside of it as the original item. This means that the cheque that</span>
<a name="l09409"></a>09409                         <span class="comment">// the client originally wrote is now finally closed!</span>
<a name="l09410"></a>09410                         <span class="comment">//</span>
<a name="l09411"></a>09411                         <span class="comment">// In both cases, the &quot;original item&quot; itself is not from the client, but from the recipient! Therefore,</span>
<a name="l09412"></a>09412                         <span class="comment">// the number on that item is useless for removing numbers from the client&#39;s list of issued numbers.</span>
<a name="l09413"></a>09413                         <span class="comment">// Rather, I need to load that original cheque, or pending transfer, from WITHIN the original item,</span>
<a name="l09414"></a>09414                         <span class="comment">// in order to get THAT number, to remove it from the client&#39;s issued list. (Whether for real, or for</span>
<a name="l09415"></a>09415                         <span class="comment">// setting up dummy data in order to verify the balance agreement.) *sigh*</span>
<a name="l09416"></a>09416                         <span class="comment">//</span>
<a name="l09417"></a>09417                         <span class="comment">// ----------------------------</span>
<a name="l09418"></a>09418                         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ac98fe1ea932d3c87f450a216e6a26bec">OTItem::depositCheque</a> == pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) <span class="comment">// client is accepting a cheque receipt, which has a depositCheque (from the recipient) as the original item within.</span>
<a name="l09419"></a>09419                         {
<a name="l09420"></a>09420                             <span class="comment">// Get the cheque from the Item and load it up into a Cheque object.</span>
<a name="l09421"></a>09421                             <a class="code" href="class_o_t_string.html">OTString</a> strCheque;
<a name="l09422"></a>09422                             pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strCheque);
<a name="l09423"></a>09423 
<a name="l09424"></a>09424                             <a class="code" href="class_o_t_cheque.html">OTCheque</a> theCheque; <span class="comment">// allocated on the stack :-)</span>
<a name="l09425"></a>09425 
<a name="l09426"></a>09426                             <span class="keywordflow">if</span> (<span class="keyword">false</span> == ((strCheque.<a class="code" href="class_o_t_string.html#a640392dd17a786dab643dbfc7e5a8672">GetLength</a>() &gt; 2) &amp;&amp;
<a name="l09427"></a>09427                                 theCheque.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strCheque)))
<a name="l09428"></a>09428                             {
<a name="l09429"></a>09429                                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ERROR loading cheque from string:\n%s\n&quot;</span>, __FUNCTION__, strCheque.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09430"></a>09430                             }
<a name="l09431"></a>09431                             <span class="keywordflow">else</span>    <span class="comment">// Since the client wrote the cheque, and he is now accepting the cheque receipt, he can be cleared for that transaction number...</span>
<a name="l09432"></a>09432                             {
<a name="l09433"></a>09433                                 <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>  (strServerID, theCheque.<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>()))
<a name="l09434"></a>09434                                     theTempNym.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(strServerID, theCheque.<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());
<a name="l09435"></a>09435                                 <span class="keywordflow">else</span>
<a name="l09436"></a>09436                                     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: cheque receipt, trying to &#39;remove&#39; an issued &quot;</span>
<a name="l09437"></a>09437                                     <span class="stringliteral">&quot;number (%lld) that already wasn&#39;t on my issued list. (So what is this in my inbox, &quot;</span>
<a name="l09438"></a>09438                                     <span class="stringliteral">&quot;then? Maybe need to download a fresh copy of it.)\n&quot;</span>, __FUNCTION__,
<a name="l09439"></a>09439                                     theCheque.<a class="code" href="class_o_t_trackable.html#a2594d320e3b24f3210bd38a08de66a70">GetTransactionNum</a>());
<a name="l09440"></a>09440                             }
<a name="l09441"></a>09441                         }
<a name="l09442"></a>09442                         <span class="comment">// ----------------------------</span>
<a name="l09443"></a>09443                         <span class="comment">// client is accepting a transfer receipt, which has an acceptPending from the recipient</span>
<a name="l09444"></a>09444                         <span class="comment">// as the original item within.</span>
<a name="l09445"></a>09445                         <span class="comment">//</span>
<a name="l09446"></a>09446                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1ae3e8669bd29e01bd4ed8d1fa35ba3773">OTItem::acceptPending</a> == pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) <span class="comment">// (which is in reference to the client&#39;s outgoing original transfer.)</span>
<a name="l09447"></a>09447                         {
<a name="l09448"></a>09448                             <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>  (strServerID, pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>()))
<a name="l09449"></a>09449                                 theTempNym.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(strServerID, pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>());
<a name="l09450"></a>09450                             <span class="keywordflow">else</span>
<a name="l09451"></a>09451                                 <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: transferReceipt, trying to &#39;remove&#39; an issued &quot;</span>
<a name="l09452"></a>09452                                 <span class="stringliteral">&quot;number (%lld) that already wasn&#39;t on my issued list. (So what is this in my inbox, &quot;</span>
<a name="l09453"></a>09453                                 <span class="stringliteral">&quot;then? Maybe need to download a fresh copy of it.)\n&quot;</span>, __FUNCTION__,
<a name="l09454"></a>09454                                 pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#a1d99913429afbd6827becd042fac67a8">GetNumberOfOrigin</a>());
<a name="l09455"></a>09455                         }
<a name="l09456"></a>09456                         <span class="comment">// ----------------------------</span>
<a name="l09457"></a>09457                         <span class="keywordflow">else</span> <span class="comment">// wrong type.</span>
<a name="l09458"></a>09458                         {
<a name="l09459"></a>09459                             <a class="code" href="class_o_t_string.html">OTString</a> strOriginalItemType;
<a name="l09460"></a>09460                             pOriginalItem-&gt;<a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strOriginalItemType);
<a name="l09461"></a>09461                             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Original item has wrong type, while accepting item receipt:\n%s\n&quot;</span>,
<a name="l09462"></a>09462                                           __FUNCTION__, strOriginalItemType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09463"></a>09463                         }
<a name="l09464"></a>09464                     }
<a name="l09465"></a>09465                     <span class="keywordflow">else</span>
<a name="l09466"></a>09466                     {
<a name="l09467"></a>09467                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unable to load original item from string while accepting item receipt:\n%s\n&quot;</span>,
<a name="l09468"></a>09468                                       __FUNCTION__, strOriginalItem.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09469"></a>09469                     }
<a name="l09470"></a>09470                 } <span class="comment">// acceptItemReceipt</span>
<a name="l09471"></a>09471 
<a name="l09472"></a>09472 
<a name="l09473"></a>09473                 <span class="comment">// I&#39;ll also go ahead and remove each transaction from theInbox, and pass said inbox into the VerifyBalanceAgreement call...</span>
<a name="l09474"></a>09474                 <span class="comment">// (So it can simulate as if the inbox was already changed, and the total is already calculated, and if it succeeds,</span>
<a name="l09475"></a>09475                 <span class="comment">// then we can allow the giant loop below to do it all for real.)</span>
<a name="l09476"></a>09476                 <span class="comment">// (I&#39;m not saving this copy of the inbox anyway--there&#39;s another one below.)</span>
<a name="l09477"></a>09477                 <span class="comment">//</span>
<a name="l09478"></a>09478                 <span class="comment">//theInbox.RemoveTransaction(pServerTransaction-&gt;GetTransactionNum());  // &lt;================</span>
<a name="l09479"></a>09479                 <span class="comment">// Now this is done AFTER this loop...</span>
<a name="l09480"></a>09480                 <span class="comment">//</span>
<a name="l09481"></a>09481                 theListOfInboxReceiptsBeingRemoved.push_back(pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l09482"></a>09482 
<a name="l09483"></a>09483             } <span class="comment">// pServerTransaction != &quot;&quot;</span>
<a name="l09484"></a>09484         } <span class="comment">// if pItem type is accept pending or item receipt.</span>
<a name="l09485"></a>09485 
<a name="l09486"></a>09486         <span class="comment">// ---------------------------------------------------------------</span>
<a name="l09487"></a>09487 
<a name="l09488"></a>09488         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>)   ||
<a name="l09489"></a>09489                  (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>)  ||
<a name="l09490"></a>09490                  (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>() == <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>)
<a name="l09491"></a>09491                 )
<a name="l09492"></a>09492         {
<a name="l09493"></a>09493             <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pServerTransaction = theInbox.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09494"></a>09494 
<a name="l09495"></a>09495             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Checking client-side inbox for expected cron or final or basket receipt: %lld... &quot;</span>,
<a name="l09496"></a>09496                            __FUNCTION__, pItem-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()); <span class="comment">// temp remove</span>
<a name="l09497"></a>09497 
<a name="l09498"></a>09498             <span class="keywordflow">if</span> (NULL == pServerTransaction)
<a name="l09499"></a>09499             {
<a name="l09500"></a>09500                 bSuccessFindingAllTransactions = <span class="keyword">false</span>;
<a name="l09501"></a>09501                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: NOT found! (Do you have the latest inbox?)\n&quot;</span>, __FUNCTION__); <span class="comment">// temp remove</span>
<a name="l09502"></a>09502                 <span class="keywordflow">break</span>;
<a name="l09503"></a>09503             }
<a name="l09504"></a>09504             <span class="keywordflow">else</span>
<a name="l09505"></a>09505             {
<a name="l09506"></a>09506                 bSuccessFindingAllTransactions = <span class="keyword">true</span>;
<a name="l09507"></a>09507 
<a name="l09508"></a>09508                 <span class="keywordflow">switch</span> (pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>())
<a name="l09509"></a>09509                 {
<a name="l09510"></a>09510                     <span class="comment">// ************************************************************</span>
<a name="l09511"></a>09511 
<a name="l09512"></a>09512                 <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a9f650965f11bddf081bb017e1cd0efe0">OTItem::acceptCronReceipt</a>:
<a name="l09513"></a>09513                     <span class="comment">// pServerTransaction is a marketReceipt or paymentReceipt</span>
<a name="l09514"></a>09514                     <span class="comment">//</span>
<a name="l09515"></a>09515 
<a name="l09516"></a>09516                     <span class="comment">// When accepting a cron receipt from the inbox, you don&#39;t have to clear the issued transaction number.</span>
<a name="l09517"></a>09517                     <span class="comment">// In this case, the original trans# is cleared when the finalReceipt is generated,</span>
<a name="l09518"></a>09518                     <span class="comment">// and the closing trans# is cleared when the finalReceipt is cleared.</span>
<a name="l09519"></a>09519 
<a name="l09520"></a>09520                     <span class="comment">// So NO issued numbers being removed or added in this case.</span>
<a name="l09521"></a>09521                     <span class="comment">// (But we still remove the receipt from our copy of the inbox, below,</span>
<a name="l09522"></a>09522                     <span class="comment">// so that the balance agreement will reflect as if it had already been</span>
<a name="l09523"></a>09523                     <span class="comment">// successfully removed. (Because balance agreement is meant to show the new</span>
<a name="l09524"></a>09524                     <span class="comment">// state of things, in the event of success--a signed record of those things.)</span>
<a name="l09525"></a>09525                     <span class="keywordflow">break</span>;
<a name="l09526"></a>09526 
<a name="l09527"></a>09527                     <span class="comment">// ************************************************************</span>
<a name="l09528"></a>09528 
<a name="l09529"></a>09529                 <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a6c434f644f481079015d0330d6a5efad">OTItem::acceptFinalReceipt</a>:
<a name="l09530"></a>09530                     <span class="comment">// pServerTransaction is a finalReceipt</span>
<a name="l09531"></a>09531 
<a name="l09532"></a>09532 
<a name="l09533"></a>09533                     <span class="comment">// IN THIS CASE: If we&#39;re accepting a finalReceipt, that means all the OTHER receipts related to it</span>
<a name="l09534"></a>09534                     <span class="comment">// (sharing the same &quot;in reference to&quot;) must ALSO be cleared from the inbox aint64_t with it! That&#39;s the</span>
<a name="l09535"></a>09535                     <span class="comment">// whole point32_t of the finalReceipt -- to make sure all related receipts are cleared, when IT is.</span>
<a name="l09536"></a>09536                     <span class="comment">//</span>
<a name="l09537"></a>09537                     <span class="comment">// The server WILL verify this also (I tested it)... That&#39;s why we check here, to save the trouble</span>
<a name="l09538"></a>09538                     <span class="comment">// of being rejected by the server.</span>
<a name="l09539"></a>09539                     <span class="comment">//</span>
<a name="l09540"></a>09540                     <span class="comment">// So let&#39;s see if the number of related receipts on this process inbox (pTransaction) matches</span>
<a name="l09541"></a>09541                     <span class="comment">// the number of related receipts in the actual inbox (theInbox), as found by the finalReceipt&#39;s</span>
<a name="l09542"></a>09542                     <span class="comment">// (pServerTransaction) &quot;in reference to&quot; value, which should be the same as on the related receipts.</span>
<a name="l09543"></a>09543 
<a name="l09544"></a>09544                     <span class="comment">// (Below) pTransaction is the processInbox transaction. Each item on it is in ref to a DIFFERENT receipt,</span>
<a name="l09545"></a>09545                     <span class="comment">// even though, if they are marketReceipts, all of THOSE receipts are in ref to the original transaction#.</span>
<a name="l09546"></a>09546                     {
<a name="l09547"></a>09547 <span class="comment">//                      int32_t nRefCount = 0;</span>
<a name="l09548"></a>09548                         std::set&lt;int64_t&gt; setOfRefNumbers; <span class="comment">// we&#39;ll store them here, to disallow duplicates, to make sure they are all unique IDs</span>
<a name="l09549"></a>09549 
<a name="l09550"></a>09550                         <span class="comment">//</span>
<a name="l09551"></a>09551                         <span class="comment">// I need to loop through all items on pTransaction (my processInbox request)</span>
<a name="l09552"></a>09552                         <span class="comment">// For each, look it up on the inbox. (Each item may be &quot;in reference to&quot;</span>
<a name="l09553"></a>09553                         <span class="comment">// one original transaction or another.) FIND THE ONES that are in reference to</span>
<a name="l09554"></a>09554                         <span class="comment">// the same # as pServerTransaction is.</span>
<a name="l09555"></a>09555                         <span class="comment">//</span>
<a name="l09556"></a>09556                         <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">GetItemList</a>())
<a name="l09557"></a>09557                         {
<a name="l09558"></a>09558                             <a class="code" href="class_o_t_item.html">OTItem</a> * pItemPointer = *it;
<a name="l09559"></a>09559                             <span class="keywordflow">if</span> (NULL == pItemPointer)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Pointer: %s should not have been &quot;</span><span class="stringliteral">&quot;.\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;pItemPointer&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09560"></a>09560 
<a name="l09561"></a>09561                             <span class="comment">// pItemPointer-&gt;GetReferenceToNum() is the server&#39;s transaction number for the receipt</span>
<a name="l09562"></a>09562                             <span class="comment">// that it dropped into my inbox. pTransPointer is the receipt itself (hopefully.)</span>
<a name="l09563"></a>09563                             <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransPointer = theInbox.<a class="code" href="class_o_t_ledger.html#a89dedbb3be7bd6869ad5e345fd14fb20">GetTransaction</a>(pItemPointer-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09564"></a>09564 
<a name="l09565"></a>09565                             <span class="comment">// Careful on the logic here...</span>
<a name="l09566"></a>09566                             <span class="comment">// ONCE EACH INBOX RECEIPT IS DEFINITELY NOT-&quot;&quot;, and</span>
<a name="l09567"></a>09567                             <span class="comment">// if *IT* is &quot;in reference to&quot; pServerTransaction-&gt;GetReferenceToNum(),</span>
<a name="l09568"></a>09568                             <span class="comment">// Then increment the count for the transaction.  COMPARE *THAT* to theInbox.GetCount and we&#39;re golden!!</span>
<a name="l09569"></a>09569                             <span class="comment">// Perhaps the finalReceipt is in reference to #10, and there are 6 others that are ALSO in reference to #10.</span>
<a name="l09570"></a>09570                             <span class="comment">// That&#39;s a total of 7 receipts in the inbox that are in reference to #10, so my request had better have the</span>
<a name="l09571"></a>09571                             <span class="comment">// same count :-)</span>
<a name="l09572"></a>09572                             <span class="comment">//</span>
<a name="l09573"></a>09573                             <span class="keywordflow">if</span> ((NULL != pTransPointer) &amp;&amp;
<a name="l09574"></a>09574                                 (pTransPointer-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>() == pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()))
<a name="l09575"></a>09575                             {
<a name="l09576"></a>09576 <span class="comment">//                              nRefCount++;</span>
<a name="l09577"></a>09577                                 <span class="comment">// std::set doesn&#39;t allow duplicates.</span>
<a name="l09578"></a>09578                                 setOfRefNumbers.insert(pItemPointer-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09579"></a>09579                             }
<a name="l09580"></a>09580                         }
<a name="l09581"></a>09581 
<a name="l09582"></a>09582                         <span class="comment">// ---------------------------------------------</span>
<a name="l09583"></a>09583                         <span class="comment">//</span>
<a name="l09584"></a>09584                         <span class="keywordflow">if</span> (static_cast&lt;int32_t&gt;(setOfRefNumbers.size())
<a name="l09585"></a>09585                             !=   <span class="comment">// IS NOT EQUAL TO...</span>
<a name="l09586"></a>09586                             theInbox.<a class="code" href="class_o_t_ledger.html#ac72aea8d3eb0d0e8e59a5b7eaa4fda6e">GetTransactionCountInRefTo</a>(pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()))
<a name="l09587"></a>09587                             <span class="comment">/* todo: Notice I&#39;m not making sure the count is entirely composed of ACCEPTED receipts. (vs DISPUTED...)</span>
<a name="l09588"></a>09588 <span class="comment">                            I probably should add code to GetItemCountInRefTo() so it only counts ACCEPTED receipts.*/</span>
<a name="l09589"></a>09589                         {
<a name="l09590"></a>09590                             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0,
<a name="l09591"></a>09591                                 <span class="stringliteral">&quot;%s: When accepting a finalReceipt, you MUST accept all &quot;</span>
<a name="l09592"></a>09592                                 <span class="stringliteral">&quot;related receipts (ones that share the same IN REFERENCE TO transaction number as the finalReceipt %lld)\n&quot;</span>
<a name="l09593"></a>09593                                 <span class="stringliteral">&quot;Transaction item count (in ref to): %d    Inbox transaction count (in ref to): %d.\n&quot;</span>, __FUNCTION__,
<a name="l09594"></a>09594                                 pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(),
<a name="l09595"></a>09595                                 setOfRefNumbers.size(),
<a name="l09596"></a>09596                                 theInbox.<a class="code" href="class_o_t_ledger.html#ac72aea8d3eb0d0e8e59a5b7eaa4fda6e">GetTransactionCountInRefTo</a>(pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>()));
<a name="l09597"></a>09597 
<a name="l09598"></a>09598                             bSuccessFindingAllTransactions = <span class="keyword">false</span>;
<a name="l09599"></a>09599                             <span class="keywordflow">break</span>;
<a name="l09600"></a>09600                         }
<a name="l09601"></a>09601                         <span class="comment">// Else NO BREAK;</span>
<a name="l09602"></a>09602                         <span class="comment">//break;  FALLING THROUGH TO BELOW, to do the pNym/theTempNym stuff in the BASKET section...</span>
<a name="l09603"></a>09603 
<a name="l09604"></a>09604                         <span class="comment">// pServerTransaction-&gt;GetReferenceToNum() is the OPENING number and should already be closed.</span>
<a name="l09605"></a>09605                         <span class="comment">//</span>
<a name="l09606"></a>09606                         <span class="comment">// IN fact, since the &quot;in reference to&quot; is supposedly already closed, then let&#39;s just</span>
<a name="l09607"></a>09607                         <span class="comment">// MAKE SURE of that, since otherwise it&#39;ll screw up my future balance agreements. (The</span>
<a name="l09608"></a>09608                         <span class="comment">// instant a finalReceipt appears, the &quot;in ref to&quot; is already gone on the server&#39;s side.)</span>
<a name="l09609"></a>09609                         <span class="comment">//</span>
<a name="l09610"></a>09610                         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a3877decda88be6b275652a6e4930ddc4">OTTransaction::finalReceipt</a> == pServerTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l09611"></a>09611                         {
<a name="l09612"></a>09612                             <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(*pNym, strServerID, pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>(), <span class="keyword">true</span>)) <span class="comment">// bool bSave=true</span>
<a name="l09613"></a>09613                                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: **** Due to finding a finalReceipt, REMOVING OPENING NUMBER FROM NYM:  %lld \n&quot;</span>, __FUNCTION__, pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09614"></a>09614                             <span class="keywordflow">else</span>
<a name="l09615"></a>09615                                 <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: **** Noticed a finalReceipt, but Opening Number %lld had ALREADY been removed from nym. \n&quot;</span>, __FUNCTION__, pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l09616"></a>09616                         }
<a name="l09617"></a>09617                         <span class="keywordflow">else</span>
<a name="l09618"></a>09618                             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Expected pServerTransaction to be a final receipt (while finalizing for process inbox.)\n&quot;</span>, __FUNCTION__);
<a name="l09619"></a>09619                         <span class="comment">//</span>
<a name="l09620"></a>09620                         <span class="comment">// pNym won&#39;t actually save unless it actually removes that #. If the #&#39;s already NOT THERE,</span>
<a name="l09621"></a>09621                         <span class="comment">// then the removal will fail, and thus it won&#39;t bother saving here.</span>
<a name="l09622"></a>09622                     }
<a name="l09623"></a>09623 
<a name="l09624"></a>09624                     <span class="comment">// ... (FALL THROUGH) ...</span>
<a name="l09625"></a>09625 
<a name="l09626"></a>09626                 <span class="keywordflow">case</span> <a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1aa4bc2fbc10cdf7c47dd361c4c17c605d">OTItem::acceptBasketReceipt</a>:
<a name="l09627"></a>09627                     <span class="comment">// pServerTransaction is a basketReceipt (or finalReceipt, since falling through from above.)</span>
<a name="l09628"></a>09628                     <span class="comment">//</span>
<a name="l09629"></a>09629                     <span class="comment">// Remove the proper issued number, based on the CLOSING TRANSACTION NUMBER</span>
<a name="l09630"></a>09630                     <span class="comment">// of the finalReceipt/basketReceipt I&#39;m accepting...</span>
<a name="l09631"></a>09631                     <span class="comment">//</span>
<a name="l09632"></a>09632 
<a name="l09633"></a>09633                     <span class="keywordflow">if</span> (pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a66cf3b97f1769f9d422bad8787a6c1a0">VerifyIssuedNum</a>(strServerID, pServerTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>()))
<a name="l09634"></a>09634                         theTempNym.<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(strServerID, pServerTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>());
<a name="l09635"></a>09635                     <span class="keywordflow">else</span>
<a name="l09636"></a>09636                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: final or basket Receipt, trying to &#39;remove&#39; an issued &quot;</span>
<a name="l09637"></a>09637                         <span class="stringliteral">&quot;number (%lld) that already wasn&#39;t on my issued list. (So what is this in my inbox, &quot;</span>
<a name="l09638"></a>09638                         <span class="stringliteral">&quot;then? Maybe need to download a fresh copy of it.)\n&quot;</span>, __FUNCTION__,
<a name="l09639"></a>09639                         pServerTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeaa0c946e4a737e0144cbbf102f37ed4">GetClosingNum</a>());
<a name="l09640"></a>09640                     <span class="keywordflow">break</span>;
<a name="l09641"></a>09641 
<a name="l09642"></a>09642                     <span class="comment">// ************************************************************</span>
<a name="l09643"></a>09643 
<a name="l09644"></a>09644                 <span class="keywordflow">default</span>:
<a name="l09645"></a>09645                     {
<a name="l09646"></a>09646                         <a class="code" href="class_o_t_string.html">OTString</a> strTempType;
<a name="l09647"></a>09647                         pItem-&gt;<a class="code" href="class_o_t_item.html#ad0aa349efc846dbcb46c51cf183dcc39">GetTypeString</a>(strTempType);
<a name="l09648"></a>09648                         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unexpected item type: %s\n&quot;</span>, __FUNCTION__, strTempType.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09649"></a>09649                         <span class="keywordflow">break</span>;
<a name="l09650"></a>09650                     }
<a name="l09651"></a>09651                 }
<a name="l09652"></a>09652 
<a name="l09653"></a>09653                 <span class="comment">// I&#39;ll also go ahead and remove each transaction from theInbox, and pass said inbox into the VerifyBalanceAgreement call...</span>
<a name="l09654"></a>09654                 <span class="comment">// (So it can simulate as if the inbox was already changed, and the total is already calculated, and if it succeeds,</span>
<a name="l09655"></a>09655                 <span class="comment">// then we can allow the giant loop below to do it all for real.)</span>
<a name="l09656"></a>09656                 <span class="comment">// (I&#39;m not saving this copy of the inbox anyway--there&#39;s another one below.)</span>
<a name="l09657"></a>09657                 <span class="comment">//</span>
<a name="l09658"></a>09658                 <span class="comment">//theInbox.RemoveTransaction(pItem-&gt;GetReferenceToNum());</span>
<a name="l09659"></a>09659                 <span class="comment">// Let&#39;s remove it this way instead:</span>
<a name="l09660"></a>09660                 <span class="comment">//</span>
<a name="l09661"></a>09661 <span class="comment">//              theInbox.RemoveTransaction(pServerTransaction-&gt;GetTransactionNum());    // &lt;================</span>
<a name="l09662"></a>09662                 <span class="comment">//</span>
<a name="l09663"></a>09663                 <span class="comment">// Actually, let&#39;s remove it this way:</span>
<a name="l09664"></a>09664                 theListOfInboxReceiptsBeingRemoved.push_back(pServerTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>());
<a name="l09665"></a>09665 
<a name="l09666"></a>09666             } <span class="comment">// else if pServerTransaction NOT &quot;&quot;.</span>
<a name="l09667"></a>09667         } <span class="comment">// If acceptCronReceipt/acceptFinalReceipt/acceptBasketReceipt</span>
<a name="l09668"></a>09668     }
<a name="l09669"></a>09669     <span class="comment">// ------------------------------------------</span>
<a name="l09670"></a>09670     <span class="keywordflow">if</span> (<span class="keyword">false</span> == bSuccessFindingAllTransactions) <span class="comment">// failure.</span>
<a name="l09671"></a>09671     {
<a name="l09672"></a>09672         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: transactions in processInbox message do not match actual inbox.\n&quot;</span>, __FUNCTION__);
<a name="l09673"></a>09673 
<a name="l09674"></a>09674         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;      <span class="comment">// RETURN.</span>
<a name="l09675"></a>09675     }
<a name="l09676"></a>09676     <span class="comment">// ---------------------------------------------------------------------</span>
<a name="l09677"></a>09677     <span class="comment">// SUCCESS finding all transactions</span>
<a name="l09678"></a>09678 
<a name="l09679"></a>09679     <span class="keywordflow">while</span> (!theListOfInboxReceiptsBeingRemoved.empty())
<a name="l09680"></a>09680     {
<a name="l09681"></a>09681         int64_t lTemp = theListOfInboxReceiptsBeingRemoved.front();
<a name="l09682"></a>09682         theListOfInboxReceiptsBeingRemoved.pop_front();
<a name="l09683"></a>09683 
<a name="l09684"></a>09684         <span class="keywordflow">if</span> (<span class="keyword">false</span> == theInbox.<a class="code" href="class_o_t_ledger.html#acfb903f9b389367653d22b10df900978">RemoveTransaction</a>(static_cast&lt;int64_t&gt;(lTemp)))    <span class="comment">// &lt;================</span>
<a name="l09685"></a>09685             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed removing receipt from temporary Inbox: %lld \n&quot;</span>, __FUNCTION__, lTemp);
<a name="l09686"></a>09686     }
<a name="l09687"></a>09687 
<a name="l09688"></a>09688     <span class="comment">// *****************************************************************</span>
<a name="l09689"></a>09689 
<a name="l09690"></a>09690     <span class="comment">// SET UP NYM FOR BALANCE AGREEMENT.</span>
<a name="l09691"></a>09691 
<a name="l09692"></a>09692     <span class="comment">// By this point, theTempNym contains a list of all the transaction numbers that are issued to me,</span>
<a name="l09693"></a>09693     <span class="comment">// but that will NOT be issued to me anymore once this processInbox is processed.</span>
<a name="l09694"></a>09694     <span class="comment">// Therefore I need to REMOVE those items from my issued list (at least temporarily) in order to</span>
<a name="l09695"></a>09695     <span class="comment">// calculate the balance agreement properly. So I used theTempNym as a temp variable to store those</span>
<a name="l09696"></a>09696     <span class="comment">// numbers, so I can remove them from my Nym and them add them again after generating the statement.</span>
<a name="l09697"></a>09697     <span class="comment">//</span>
<a name="l09698"></a>09698     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theTempNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(theServerID); i++)
<a name="l09699"></a>09699     {
<a name="l09700"></a>09700         int64_t lTemp = theTempNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(theServerID, i);
<a name="l09701"></a>09701         pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a17f25f5eb52440cc3ffc139dcbff75fe">RemoveIssuedNum</a>(strServerID, static_cast&lt;int64_t&gt;(lTemp));
<a name="l09702"></a>09702     }
<a name="l09703"></a>09703     <span class="comment">// -----------------------------------------</span>
<a name="l09704"></a>09704     <span class="comment">// BALANCE AGREEMENT</span>
<a name="l09705"></a>09705     <span class="comment">//</span>
<a name="l09706"></a>09706     <span class="comment">// The item is signed and saved within this call as well. No need to do that again.</span>
<a name="l09707"></a>09707     <span class="comment">//</span>
<a name="l09708"></a>09708     <a class="code" href="class_o_t_item.html">OTItem</a> * pBalanceItem = theInbox.<a class="code" href="class_o_t_ledger.html#acd3bbb77d181318d69bbf61b5aeca7fb">GenerateBalanceStatement</a>(static_cast&lt;int64_t&gt;(lTotalBeingAccepted), *pTransaction, *pNym, *pAccount, theOutbox);
<a name="l09709"></a>09709     <span class="comment">// -----------------------------------------</span>
<a name="l09710"></a>09710     <span class="comment">// Here I am adding these numbers back again, since I removed them to generate the balance agreement.</span>
<a name="l09711"></a>09711     <span class="comment">// (They won&#39;t be removed for real until I receive the server&#39;s acknowledgment that those numbers</span>
<a name="l09712"></a>09712     <span class="comment">// really were removed. theTempNym then I have to keep them and use them for my balance agreements.)</span>
<a name="l09713"></a>09713     <span class="comment">//</span>
<a name="l09714"></a>09714     <span class="keywordflow">for</span> (int32_t i = 0; i &lt; theTempNym.<a class="code" href="class_o_t_pseudonym.html#ac4fec9b0b744c9fbe3bae82c25661d19">GetIssuedNumCount</a>(theServerID); i++)
<a name="l09715"></a>09715     {
<a name="l09716"></a>09716         int64_t lTemp = theTempNym.<a class="code" href="class_o_t_pseudonym.html#ada98078d45460303c6a746c53381f5aa">GetIssuedNum</a>(theServerID, i);
<a name="l09717"></a>09717         pNym-&gt;<a class="code" href="class_o_t_pseudonym.html#a331a9c5ec8692d0b88a76d882586fbc1">AddIssuedNum</a>(strServerID, static_cast&lt;int64_t&gt;(lTemp));
<a name="l09718"></a>09718     }
<a name="l09719"></a>09719 
<a name="l09720"></a>09720     <span class="comment">// *****************************************************************</span>
<a name="l09721"></a>09721 
<a name="l09722"></a>09722     <span class="keywordflow">if</span> (NULL == pBalanceItem)
<a name="l09723"></a>09723     {
<a name="l09724"></a>09724         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: ERROR generating balance statement.\n&quot;</span>, __FUNCTION__);
<a name="l09725"></a>09725 
<a name="l09726"></a>09726         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09727"></a>09727     }
<a name="l09728"></a>09728 
<a name="l09729"></a>09729     <span class="comment">// the transaction will handle cleaning up the transaction item.</span>
<a name="l09730"></a>09730     pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5abc071b7eeddc40ea151cccd011e4d6">AddItem</a>(*pBalanceItem);
<a name="l09731"></a>09731     <span class="comment">// -----------------------------------------</span>
<a name="l09732"></a>09732     <span class="comment">// sign the item</span>
<a name="l09733"></a>09733     <span class="comment">// This already happens in the GenerateBalanceStatement() call above.</span>
<a name="l09734"></a>09734     <span class="comment">// I would actually have to RELEASE the signatures if I wanted to sign again!</span>
<a name="l09735"></a>09735     <span class="comment">// (Unless I WANT two signatures...)</span>
<a name="l09736"></a>09736     <span class="comment">//</span>
<a name="l09737"></a>09737 <span class="comment">//  pBalanceItem-&gt;SignContract(*pNym);</span>
<a name="l09738"></a>09738 <span class="comment">//  pBalanceItem-&gt;SaveContract();</span>
<a name="l09739"></a>09739 
<a name="l09740"></a>09740     pTransaction-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l09741"></a>09741     pTransaction-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l09742"></a>09742     pTransaction-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l09743"></a>09743 
<a name="l09744"></a>09744     theLedger.<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l09745"></a>09745     theLedger.<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym);
<a name="l09746"></a>09746     theLedger.<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l09747"></a>09747 
<a name="l09748"></a>09748     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theLedger); <span class="comment">// For the output</span>
<a name="l09749"></a>09749 
<a name="l09750"></a>09750     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l09751"></a>09751 
<a name="l09752"></a>09752     <span class="keywordflow">return</span> pBuf;
<a name="l09753"></a>09753 }
<a name="l09754"></a>09754 
<a name="l09755"></a>09755 
<a name="l09756"></a>09756 
<a name="l09757"></a>09757 
<a name="l09758"></a>09758 
<a name="l09759"></a>09759 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l09760"></a>09760 <span class="comment">// Retrieve Voucher from Transaction</span>
<a name="l09761"></a>09761 <span class="comment">//</span>
<a name="l09762"></a>09762 <span class="comment">// If you withdrew into a voucher instead of cash, this function allows</span>
<a name="l09763"></a>09763 <span class="comment">// you to retrieve the actual voucher cheque from the reply transaction.</span>
<a name="l09764"></a>09764 <span class="comment">// (A voucher is a cheque drawn on an internal server account instead</span>
<a name="l09765"></a>09765 <span class="comment">// of a user&#39;s asset account, so the voucher cannot ever bounce due to</span>
<a name="l09766"></a>09766 <span class="comment">// insufficient funds. We are accustomed to this functionality already</span>
<a name="l09767"></a>09767 <span class="comment">// in our daily lives, via &quot;money orders&quot; and &quot;cashier&#39;s cheques&quot;.)</span>
<a name="l09768"></a>09768 <span class="comment">//</span>
<a name="l09769"></a>09769 <span class="comment">// How would you use this in full?</span>
<a name="l09770"></a>09770 <span class="comment">//</span>
<a name="l09771"></a>09771 <span class="comment">// First, call OTAPI_Exec::withdrawVoucher() in order to send the request</span>
<a name="l09772"></a>09772 <span class="comment">// to the server. (You may optionally call OTAPI_Exec::FlushMessageBuffer()</span>
<a name="l09773"></a>09773 <span class="comment">// before doing this.)</span>
<a name="l09774"></a>09774 <span class="comment">//</span>
<a name="l09775"></a>09775 <span class="comment">// Then, call OTAPI_Exec::PopMessageBuffer() to retrieve any server reply.</span>
<a name="l09776"></a>09776 <span class="comment">//</span>
<a name="l09777"></a>09777 <span class="comment">// If there is a message from the server in reply, then call</span>
<a name="l09778"></a>09778 <span class="comment">// OTAPI_Exec::Message_GetCommand to verify that it&#39;s a reply to the message</span>
<a name="l09779"></a>09779 <span class="comment">// that you sent, and call OTAPI_Exec::Message_GetSuccess to verify whether</span>
<a name="l09780"></a>09780 <span class="comment">// the message was a success.</span>
<a name="l09781"></a>09781 <span class="comment">//</span>
<a name="l09782"></a>09782 <span class="comment">// If it was a success, next call OTAPI_Exec::Message_GetLedger to retrieve</span>
<a name="l09783"></a>09783 <span class="comment">// the actual &quot;reply ledger&quot; from the server.</span>
<a name="l09784"></a>09784 <span class="comment">//</span>
<a name="l09785"></a>09785 <span class="comment">// Penultimately, call OTAPI_Exec::Ledger_GetTransactionByID() and then,</span>
<a name="l09786"></a>09786 <span class="comment">// finally, call OTAPI_Exec::Transaction_GetVoucher() (below) in order to</span>
<a name="l09787"></a>09787 <span class="comment">// retrieve the voucher cheque itself from the transaction.</span>
<a name="l09788"></a>09788 <span class="comment">//</span>
<a name="l09789"></a><a class="code" href="class_o_t_a_p_i___exec.html#a42b95aab2376ff21fb6a7b9704212956">09789</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a42b95aab2376ff21fb6a7b9704212956">OTAPI_Exec::Transaction_GetVoucher</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l09790"></a>09790                                                <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l09791"></a>09791                                                <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l09792"></a>09792                                                <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l09793"></a>09793 {
<a name="l09794"></a>09794     <span class="keywordflow">if</span> (SERVER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09795"></a>09795     <span class="keywordflow">if</span> (USER_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09796"></a>09796     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09797"></a>09797     <span class="keywordflow">if</span> (THE_TRANSACTION.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09798"></a>09798 
<a name="l09799"></a>09799     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l09800"></a>09800 
<a name="l09801"></a>09801     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l09802"></a>09802 
<a name="l09803"></a>09803     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l09804"></a>09804 
<a name="l09805"></a>09805     <span class="comment">// -----------------------------------------------------</span>
<a name="l09806"></a>09806     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l09807"></a>09807     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09808"></a>09808     <span class="comment">// -----------------------------------------------------</span>
<a name="l09809"></a>09809 
<a name="l09810"></a>09810     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l09811"></a>09811 
<a name="l09812"></a>09812     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l09813"></a>09813     {
<a name="l09814"></a>09814         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l09815"></a>09815         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09816"></a>09816         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09817"></a>09817     }
<a name="l09818"></a>09818     <span class="comment">// No need to check if transaction is abbreviated, since it&#39;s coming from a message ledger.</span>
<a name="l09819"></a>09819     <span class="comment">// (Those always contain the full version of the transactions, automatically.)</span>
<a name="l09820"></a>09820     <span class="comment">// -----------------------------------------------------</span>
<a name="l09821"></a>09821 
<a name="l09822"></a>09822     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8a97e769c64e9e1ea2d8e7730e7d758949">OTTransaction::atWithdrawal</a> != theTransaction.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l09823"></a>09823     {
<a name="l09824"></a>09824         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: tried to retrieve voucher from wrong transaction (not atWithdrawal).\n&quot;</span>, __FUNCTION__);
<a name="l09825"></a>09825         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09826"></a>09826     }
<a name="l09827"></a>09827 
<a name="l09828"></a>09828     <span class="comment">// -----------------------------------------------------</span>
<a name="l09829"></a>09829 
<a name="l09830"></a>09830     <span class="comment">// loop through the ALL items that make up this transaction and check to see if a response to withdrawal.</span>
<a name="l09831"></a>09831 
<a name="l09832"></a>09832     <span class="comment">// if pointer not null, and it&#39;s a withdrawal, and it&#39;s an acknowledgement (not a rejection or error)</span>
<a name="l09833"></a>09833     <a class="code" href="_o_t_storage_8hpp.html#aa135ed03585fa4b246d7907afbd5873d">FOR_EACH</a>(<a class="code" href="_o_t_item_8hpp.html#afed69f7c75742cc24ea837d6589e9d19">listOfItems</a>, theTransaction.<a class="code" href="class_o_t_transaction.html#a9821c541d3d5f92e378320c6aa190c18">GetItemList</a>())
<a name="l09834"></a>09834     {
<a name="l09835"></a>09835         <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = *it;
<a name="l09836"></a>09836         <span class="keywordflow">if</span> (NULL == pItem)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Pointer: %s should not have been &quot;</span><span class="stringliteral">&quot;.\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;pItem&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09837"></a>09837 
<a name="l09838"></a>09838         <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a36d4c6faf8ad5aae6ea36fe5a66012c8">OTItem::atWithdrawVoucher</a>  == pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) &amp;&amp;
<a name="l09839"></a>09839             (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>    == pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>()))
<a name="l09840"></a>09840         {
<a name="l09841"></a>09841             <a class="code" href="class_o_t_string.html">OTString</a>    strVoucher;
<a name="l09842"></a>09842             pItem-&gt;<a class="code" href="class_o_t_item.html#aec0f00f6526a35766297615a43429ba5">GetAttachment</a>(strVoucher);
<a name="l09843"></a>09843 
<a name="l09844"></a>09844             <a class="code" href="class_o_t_cheque.html">OTCheque</a>    theVoucher;
<a name="l09845"></a>09845             <span class="keywordflow">if</span> (theVoucher.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strVoucher)) <span class="comment">// Todo additional verification here on the cheque.</span>
<a name="l09846"></a>09846             {
<a name="l09847"></a>09847                 theVoucher.<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
<a name="l09848"></a>09848                 <span class="keywordflow">break</span>;
<a name="l09849"></a>09849             }
<a name="l09850"></a>09850         }
<a name="l09851"></a>09851     }
<a name="l09852"></a>09852 
<a name="l09853"></a>09853     <span class="comment">// -----------------------------------------------------</span>
<a name="l09854"></a>09854 
<a name="l09855"></a>09855     <span class="comment">// Didn&#39;t find one.</span>
<a name="l09856"></a>09856     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l09857"></a>09857         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09858"></a>09858 
<a name="l09859"></a>09859     <span class="comment">// We found a voucher -- let&#39;s return it!</span>
<a name="l09860"></a>09860     <span class="comment">//</span>
<a name="l09861"></a>09861     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l09862"></a>09862 
<a name="l09863"></a>09863     <span class="keywordflow">return</span> pBuf;
<a name="l09864"></a>09864 }
<a name="l09865"></a>09865 
<a name="l09866"></a>09866 
<a name="l09867"></a>09867 
<a name="l09868"></a>09868 
<a name="l09869"></a>09869 
<a name="l09870"></a>09870 
<a name="l09871"></a>09871 
<a name="l09872"></a>09872 
<a name="l09873"></a><a class="code" href="class_o_t_a_p_i___exec.html#a56963563f1323165940629fe18280c47">09873</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a56963563f1323165940629fe18280c47">OTAPI_Exec::Transaction_GetSenderUserID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l09874"></a>09874                                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l09875"></a>09875                                                 <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l09876"></a>09876                                                 <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l09877"></a>09877 {
<a name="l09878"></a>09878     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09879"></a>09879     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09880"></a>09880     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09881"></a>09881     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09882"></a>09882 
<a name="l09883"></a>09883     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l09884"></a>09884 
<a name="l09885"></a>09885     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l09886"></a>09886 
<a name="l09887"></a>09887     <span class="comment">// -----------------------------------------------------</span>
<a name="l09888"></a>09888     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l09889"></a>09889     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09890"></a>09890     <span class="comment">// -----------------------------------------------------</span>
<a name="l09891"></a>09891 
<a name="l09892"></a>09892     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l09893"></a>09893 
<a name="l09894"></a>09894     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l09895"></a>09895     {
<a name="l09896"></a>09896         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l09897"></a>09897         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09898"></a>09898         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09899"></a>09899     }
<a name="l09900"></a>09900     <span class="comment">// -----------------------------------------------------</span>
<a name="l09901"></a>09901     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l09902"></a>09902     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l09903"></a>09903 
<a name="l09904"></a>09904     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l09905"></a>09905     {
<a name="l09906"></a>09906         int64_t lBoxType = 0;
<a name="l09907"></a>09907 
<a name="l09908"></a>09908              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l09909"></a>09909         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l09910"></a>09910         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l09911"></a>09911         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l09912"></a>09912         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l09913"></a>09913         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l09914"></a>09914         <span class="keywordflow">else</span>
<a name="l09915"></a>09915         {
<a name="l09916"></a>09916             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type.\n&quot;</span>, __FUNCTION__);
<a name="l09917"></a>09917             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09918"></a>09918         }
<a name="l09919"></a>09919         <span class="comment">// --------------</span>
<a name="l09920"></a>09920         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l09921"></a>09921         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l09922"></a>09922         {
<a name="l09923"></a>09923             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt.\n&quot;</span>, __FUNCTION__);
<a name="l09924"></a>09924             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09925"></a>09925         }
<a name="l09926"></a>09926         <span class="comment">// ----------------</span>
<a name="l09927"></a>09927         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l09928"></a>09928     }
<a name="l09929"></a>09929     <span class="keywordflow">else</span>
<a name="l09930"></a>09930         pTransaction = &amp;theTransaction;
<a name="l09931"></a>09931     <span class="comment">// -----------------------------------------------------</span>
<a name="l09932"></a>09932     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l09933"></a>09933 
<a name="l09934"></a>09934     <span class="keywordtype">bool</span> bSuccess = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a1091822e3072f014a8b2f64b93917ca7" title="For display purposes. The &quot;ref #&quot; you actually display (versus the one you use internally) might chan...">GetSenderUserIDForDisplay</a>(theOutput);
<a name="l09935"></a>09935     <span class="comment">// -----------------------------------------------------</span>
<a name="l09936"></a>09936 
<a name="l09937"></a>09937     <span class="keywordflow">if</span> (bSuccess)
<a name="l09938"></a>09938     {
<a name="l09939"></a>09939         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l09940"></a>09940 
<a name="l09941"></a>09941         <span class="comment">// Didn&#39;t find one.</span>
<a name="l09942"></a>09942         <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l09943"></a>09943             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09944"></a>09944 
<a name="l09945"></a>09945         <span class="comment">// We found it -- let&#39;s return the user ID</span>
<a name="l09946"></a>09946         <span class="comment">//</span>
<a name="l09947"></a>09947         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l09948"></a>09948 
<a name="l09949"></a>09949 
<a name="l09950"></a>09950 
<a name="l09951"></a>09951         <span class="keywordflow">return</span> pBuf;
<a name="l09952"></a>09952     }
<a name="l09953"></a>09953     <span class="keywordflow">else</span>
<a name="l09954"></a>09954         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09955"></a>09955 }
<a name="l09956"></a>09956 
<a name="l09957"></a>09957 
<a name="l09958"></a>09958 
<a name="l09959"></a>09959 
<a name="l09960"></a>09960 
<a name="l09961"></a>09961 
<a name="l09962"></a><a class="code" href="class_o_t_a_p_i___exec.html#a99ab2f74125acea47ded3a6878354cc8">09962</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a99ab2f74125acea47ded3a6878354cc8">OTAPI_Exec::Transaction_GetRecipientUserID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l09963"></a>09963                                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l09964"></a>09964                                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l09965"></a>09965                                                   <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l09966"></a>09966 {
<a name="l09967"></a>09967     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09968"></a>09968     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09969"></a>09969     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09970"></a>09970     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l09971"></a>09971 
<a name="l09972"></a>09972     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l09973"></a>09973 
<a name="l09974"></a>09974     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l09975"></a>09975     <span class="comment">// -----------------------------------------------------</span>
<a name="l09976"></a>09976 
<a name="l09977"></a>09977     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l09978"></a>09978     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09979"></a>09979     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l09980"></a>09980     <span class="comment">// -----------------------------------------------------</span>
<a name="l09981"></a>09981     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l09982"></a>09982 
<a name="l09983"></a>09983     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l09984"></a>09984     {
<a name="l09985"></a>09985         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l09986"></a>09986         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l09987"></a>09987         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l09988"></a>09988     }
<a name="l09989"></a>09989     <span class="comment">// -----------------------------------------------------</span>
<a name="l09990"></a>09990     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l09991"></a>09991     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l09992"></a>09992 
<a name="l09993"></a>09993     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l09994"></a>09994     {
<a name="l09995"></a>09995         int64_t lBoxType = 0;
<a name="l09996"></a>09996 
<a name="l09997"></a>09997              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l09998"></a>09998         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l09999"></a>09999         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10000"></a>10000         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10001"></a>10001         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10002"></a>10002         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10003"></a>10003         <span class="keywordflow">else</span>
<a name="l10004"></a>10004         {
<a name="l10005"></a>10005             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10006"></a>10006             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10007"></a>10007         }
<a name="l10008"></a>10008         <span class="comment">// --------------</span>
<a name="l10009"></a>10009         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10010"></a>10010         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10011"></a>10011         {
<a name="l10012"></a>10012             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt.&quot;</span>, __FUNCTION__);
<a name="l10013"></a>10013             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10014"></a>10014         }
<a name="l10015"></a>10015         <span class="comment">// ----------------</span>
<a name="l10016"></a>10016         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10017"></a>10017     }
<a name="l10018"></a>10018     <span class="keywordflow">else</span>
<a name="l10019"></a>10019         pTransaction = &amp;theTransaction;
<a name="l10020"></a>10020     <span class="comment">// -----------------------------------------------------</span>
<a name="l10021"></a>10021 
<a name="l10022"></a>10022     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l10023"></a>10023 
<a name="l10024"></a>10024     <span class="keywordtype">bool</span> bSuccess = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a829e1dc63a933dae6fd3761091a9a2b1">GetRecipientUserIDForDisplay</a>(theOutput);
<a name="l10025"></a>10025 
<a name="l10026"></a>10026     <span class="comment">// -----------------------------------------------------</span>
<a name="l10027"></a>10027 
<a name="l10028"></a>10028     <span class="comment">// Normally, there IS NO recipient user ID for a transfer (only a recipient acct ID.)</span>
<a name="l10029"></a>10029     <span class="comment">// But here, as a special trick, I&#39;ll see if the account is in my address book.</span>
<a name="l10030"></a>10030     <span class="comment">// THIS MEANS THE ADDRESS BOOK needs to store nyms (for other people, their public nym)</span>
<a name="l10031"></a>10031     <span class="comment">// as well as a list of acct IDs that I have associated with each Nym. That way, I can</span>
<a name="l10032"></a>10032     <span class="comment">// later look up the Nym ID based on the acct ID, and then look up my display label for</span>
<a name="l10033"></a>10033     <span class="comment">// that Nym.</span>
<a name="l10034"></a>10034     <span class="comment">//</span>
<a name="l10035"></a>10035     <span class="comment">//  if (!bSuccess &amp;&amp; (theTransaction.GetType() == OTTransaction::pending))</span>
<a name="l10036"></a>10036     <span class="comment">//  {</span>
<a name="l10037"></a>10037     <span class="comment">//      // AS SOON AS ADDRESS BOOK FEATURE IS ADDED, THEN THIS CAN BE COMPLETED HERE.</span>
<a name="l10038"></a>10038     <span class="comment">//  }</span>
<a name="l10039"></a>10039 
<a name="l10040"></a>10040     <span class="comment">// -----------------------------------------------------</span>
<a name="l10041"></a>10041 
<a name="l10042"></a>10042     <span class="keywordflow">if</span> (bSuccess)
<a name="l10043"></a>10043     {
<a name="l10044"></a>10044         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l10045"></a>10045 
<a name="l10046"></a>10046         <span class="comment">// Didn&#39;t find one.</span>
<a name="l10047"></a>10047         <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10048"></a>10048             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10049"></a>10049 
<a name="l10050"></a>10050         <span class="comment">// We found it -- let&#39;s return the user ID</span>
<a name="l10051"></a>10051         <span class="comment">//</span>
<a name="l10052"></a>10052         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l10053"></a>10053 
<a name="l10054"></a>10054 
<a name="l10055"></a>10055 
<a name="l10056"></a>10056         <span class="keywordflow">return</span> pBuf;
<a name="l10057"></a>10057     }
<a name="l10058"></a>10058     <span class="keywordflow">else</span>
<a name="l10059"></a>10059         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10060"></a>10060 }
<a name="l10061"></a>10061 
<a name="l10062"></a>10062 
<a name="l10063"></a>10063 
<a name="l10064"></a>10064 
<a name="l10065"></a>10065 
<a name="l10066"></a>10066 
<a name="l10067"></a><a class="code" href="class_o_t_a_p_i___exec.html#aae89130ef52fd5d564c399093e685b56">10067</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aae89130ef52fd5d564c399093e685b56">OTAPI_Exec::Transaction_GetSenderAcctID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10068"></a>10068                                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10069"></a>10069                                                 <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10070"></a>10070                                                 <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10071"></a>10071 {
<a name="l10072"></a>10072     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10073"></a>10073     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10074"></a>10074     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10075"></a>10075     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10076"></a>10076 
<a name="l10077"></a>10077     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10078"></a>10078 
<a name="l10079"></a>10079     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10080"></a>10080 
<a name="l10081"></a>10081     <span class="comment">// -----------------------------------------------------</span>
<a name="l10082"></a>10082     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10083"></a>10083     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10084"></a>10084     <span class="comment">// -----------------------------------------------------</span>
<a name="l10085"></a>10085 
<a name="l10086"></a>10086     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10087"></a>10087 
<a name="l10088"></a>10088     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10089"></a>10089     {
<a name="l10090"></a>10090         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10091"></a>10091         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10092"></a>10092         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10093"></a>10093     }
<a name="l10094"></a>10094     <span class="comment">// -----------------------------------------------------</span>
<a name="l10095"></a>10095     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10096"></a>10096     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10097"></a>10097 
<a name="l10098"></a>10098     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l10099"></a>10099     {
<a name="l10100"></a>10100         int64_t lBoxType = 0;
<a name="l10101"></a>10101 
<a name="l10102"></a>10102              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10103"></a>10103         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10104"></a>10104         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10105"></a>10105         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10106"></a>10106         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10107"></a>10107         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10108"></a>10108         <span class="keywordflow">else</span>
<a name="l10109"></a>10109         {
<a name="l10110"></a>10110             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type.\n&quot;</span>, __FUNCTION__);
<a name="l10111"></a>10111             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10112"></a>10112         }
<a name="l10113"></a>10113         <span class="comment">// --------------</span>
<a name="l10114"></a>10114         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10115"></a>10115         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10116"></a>10116         {
<a name="l10117"></a>10117             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt. \n&quot;</span>, __FUNCTION__);
<a name="l10118"></a>10118             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10119"></a>10119         }
<a name="l10120"></a>10120         <span class="comment">// ----------------</span>
<a name="l10121"></a>10121         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10122"></a>10122     }
<a name="l10123"></a>10123     <span class="keywordflow">else</span>
<a name="l10124"></a>10124         pTransaction = &amp;theTransaction;
<a name="l10125"></a>10125     <span class="comment">// -----------------------------------------------------</span>
<a name="l10126"></a>10126 
<a name="l10127"></a>10127     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l10128"></a>10128 
<a name="l10129"></a>10129     <span class="keywordtype">bool</span> bSuccess = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#acf66d9f8f5d3a6e4ee0a418a41db6019">GetSenderAcctIDForDisplay</a>(theOutput);
<a name="l10130"></a>10130 
<a name="l10131"></a>10131     <span class="comment">// -----------------------------------------------------</span>
<a name="l10132"></a>10132 
<a name="l10133"></a>10133     <span class="keywordflow">if</span> (bSuccess)
<a name="l10134"></a>10134     {
<a name="l10135"></a>10135         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l10136"></a>10136 
<a name="l10137"></a>10137         <span class="comment">// Didn&#39;t find one.</span>
<a name="l10138"></a>10138         <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10139"></a>10139             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10140"></a>10140 
<a name="l10141"></a>10141         <span class="comment">// We found it -- let&#39;s return the user ID</span>
<a name="l10142"></a>10142         <span class="comment">//</span>
<a name="l10143"></a>10143         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l10144"></a>10144 
<a name="l10145"></a>10145 
<a name="l10146"></a>10146 
<a name="l10147"></a>10147         <span class="keywordflow">return</span> pBuf;
<a name="l10148"></a>10148     }
<a name="l10149"></a>10149     <span class="keywordflow">else</span>
<a name="l10150"></a>10150         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10151"></a>10151 }
<a name="l10152"></a>10152 
<a name="l10153"></a>10153 
<a name="l10154"></a>10154 
<a name="l10155"></a>10155 
<a name="l10156"></a>10156 
<a name="l10157"></a>10157 
<a name="l10158"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8f7548ab82a6b82c625758e8fbca116b">10158</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8f7548ab82a6b82c625758e8fbca116b">OTAPI_Exec::Transaction_GetRecipientAcctID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10159"></a>10159                                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10160"></a>10160                                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10161"></a>10161                                                   <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10162"></a>10162 {
<a name="l10163"></a>10163     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10164"></a>10164     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10165"></a>10165     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10166"></a>10166     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10167"></a>10167 
<a name="l10168"></a>10168     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10169"></a>10169 
<a name="l10170"></a>10170     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10171"></a>10171 
<a name="l10172"></a>10172     <span class="comment">// -----------------------------------------------------</span>
<a name="l10173"></a>10173     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10174"></a>10174     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10175"></a>10175     <span class="comment">// -----------------------------------------------------</span>
<a name="l10176"></a>10176 
<a name="l10177"></a>10177     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10178"></a>10178 
<a name="l10179"></a>10179     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10180"></a>10180     {
<a name="l10181"></a>10181         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10182"></a>10182         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string in OTAPI_Exec::Transaction_GetRecipientAcctID. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10183"></a>10183         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10184"></a>10184     }
<a name="l10185"></a>10185 
<a name="l10186"></a>10186     <span class="comment">// -----------------------------------------------------</span>
<a name="l10187"></a>10187     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10188"></a>10188     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10189"></a>10189 
<a name="l10190"></a>10190     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l10191"></a>10191     {
<a name="l10192"></a>10192         int64_t lBoxType = 0;
<a name="l10193"></a>10193 
<a name="l10194"></a>10194              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10195"></a>10195         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10196"></a>10196         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10197"></a>10197         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10198"></a>10198         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10199"></a>10199         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10200"></a>10200         <span class="keywordflow">else</span>
<a name="l10201"></a>10201         {
<a name="l10202"></a>10202             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10203"></a>10203             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10204"></a>10204         }
<a name="l10205"></a>10205         <span class="comment">// --------------</span>
<a name="l10206"></a>10206         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10207"></a>10207         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10208"></a>10208         {
<a name="l10209"></a>10209             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt.\n&quot;</span>, __FUNCTION__);
<a name="l10210"></a>10210             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10211"></a>10211         }
<a name="l10212"></a>10212         <span class="comment">// ----------------</span>
<a name="l10213"></a>10213         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10214"></a>10214     }
<a name="l10215"></a>10215     <span class="keywordflow">else</span>
<a name="l10216"></a>10216         pTransaction = &amp;theTransaction;
<a name="l10217"></a>10217     <span class="comment">// -----------------------------------------------------</span>
<a name="l10218"></a>10218     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutput;
<a name="l10219"></a>10219 
<a name="l10220"></a>10220     <span class="keywordtype">bool</span> bSuccess = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a54221d2117096fd673147492a67f6755">GetRecipientAcctIDForDisplay</a>(theOutput);
<a name="l10221"></a>10221 
<a name="l10222"></a>10222     <span class="comment">// -----------------------------------------------------</span>
<a name="l10223"></a>10223 
<a name="l10224"></a>10224     <span class="keywordflow">if</span> (bSuccess)
<a name="l10225"></a>10225     {
<a name="l10226"></a>10226         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutput);
<a name="l10227"></a>10227 
<a name="l10228"></a>10228         <span class="comment">// Didn&#39;t find one.</span>
<a name="l10229"></a>10229         <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10230"></a>10230             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10231"></a>10231 
<a name="l10232"></a>10232         <span class="comment">// We found it -- let&#39;s return the user ID</span>
<a name="l10233"></a>10233         <span class="comment">//</span>
<a name="l10234"></a>10234         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l10235"></a>10235 
<a name="l10236"></a>10236 
<a name="l10237"></a>10237 
<a name="l10238"></a>10238         <span class="keywordflow">return</span> pBuf;
<a name="l10239"></a>10239     }
<a name="l10240"></a>10240     <span class="keywordflow">else</span>
<a name="l10241"></a>10241         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10242"></a>10242 }
<a name="l10243"></a>10243 
<a name="l10244"></a>10244 
<a name="l10245"></a>10245 
<a name="l10246"></a>10246 
<a name="l10247"></a>10247 
<a name="l10248"></a>10248 
<a name="l10249"></a>10249 
<a name="l10250"></a>10250 
<a name="l10251"></a>10251 <span class="comment">// -------------------------------------------------------------</span>
<a name="l10252"></a>10252 
<a name="l10253"></a>10253 
<a name="l10254"></a>10254 <span class="comment">// --------------------------------------------------</span>
<a name="l10255"></a>10255 <span class="comment">//</span>
<a name="l10256"></a>10256 <span class="comment">// PENDING TRANSFER (various functions)</span>
<a name="l10257"></a>10257 <span class="comment">//</span>
<a name="l10258"></a>10258 <span class="comment">// When someone has sent you a PENDING TRANSFER (a form of transaction</span>
<a name="l10259"></a>10259 <span class="comment">// that will be sitting in your inbox waiting for you to accept/reject it)</span>
<a name="l10260"></a>10260 <span class="comment">// then, as you are reading the inbox, you can use these functions in</span>
<a name="l10261"></a>10261 <span class="comment">// order to get data from the pending transfer.</span>
<a name="l10262"></a>10262 <span class="comment">//</span>
<a name="l10263"></a>10263 
<a name="l10264"></a>10264 
<a name="l10265"></a>10265 
<a name="l10266"></a><a class="code" href="class_o_t_a_p_i___exec.html#a01e724dcf58de268c61cb2699349a1f1">10266</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a01e724dcf58de268c61cb2699349a1f1">OTAPI_Exec::Pending_GetNote</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10267"></a>10267                                         <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10268"></a>10268                                         <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10269"></a>10269                                         <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10270"></a>10270 {
<a name="l10271"></a>10271     <span class="keywordflow">if</span> (SERVER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10272"></a>10272     <span class="keywordflow">if</span> (USER_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10273"></a>10273     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10274"></a>10274     <span class="keywordflow">if</span> (THE_TRANSACTION.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10275"></a>10275 
<a name="l10276"></a>10276     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10277"></a>10277 
<a name="l10278"></a>10278     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10279"></a>10279     <span class="comment">// -----------------------------------------------------</span>
<a name="l10280"></a>10280     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10281"></a>10281     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10282"></a>10282     <span class="comment">// -----------------------------------------------------</span>
<a name="l10283"></a>10283     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10284"></a>10284 
<a name="l10285"></a>10285     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10286"></a>10286     {
<a name="l10287"></a>10287         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10288"></a>10288         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10289"></a>10289         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10290"></a>10290     }
<a name="l10291"></a>10291     <span class="comment">// -----------------------------------------------------</span>
<a name="l10292"></a>10292     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10293"></a>10293     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10294"></a>10294 
<a name="l10295"></a>10295     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l10296"></a>10296     {
<a name="l10297"></a>10297         int64_t lBoxType = 0;
<a name="l10298"></a>10298 
<a name="l10299"></a>10299              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10300"></a>10300         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10301"></a>10301         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10302"></a>10302         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10303"></a>10303         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10304"></a>10304         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10305"></a>10305         <span class="keywordflow">else</span>
<a name="l10306"></a>10306         {
<a name="l10307"></a>10307             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10308"></a>10308             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10309"></a>10309         }
<a name="l10310"></a>10310         <span class="comment">// --------------</span>
<a name="l10311"></a>10311         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10312"></a>10312         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10313"></a>10313         {
<a name="l10314"></a>10314             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt. \n&quot;</span>, __FUNCTION__);
<a name="l10315"></a>10315             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10316"></a>10316         }
<a name="l10317"></a>10317         <span class="comment">// ----------------</span>
<a name="l10318"></a>10318         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10319"></a>10319     }
<a name="l10320"></a>10320     <span class="keywordflow">else</span>
<a name="l10321"></a>10321         pTransaction = &amp;theTransaction;
<a name="l10322"></a>10322     <span class="comment">// -----------------------------------------------------</span>
<a name="l10323"></a>10323     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8addbed2a5d0af9bf58ff0694f587b4e08">OTTransaction::pending</a> != pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l10324"></a>10324     {
<a name="l10325"></a>10325         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: wrong transaction type: %s. (Expected \&quot;pending\&quot;.)\n&quot;</span>, __FUNCTION__, pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>());
<a name="l10326"></a>10326         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10327"></a>10327     }
<a name="l10328"></a>10328     <span class="comment">// -----------------------------------------------------</span>
<a name="l10329"></a>10329     <a class="code" href="class_o_t_string.html">OTString</a> strReference;
<a name="l10330"></a>10330     pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a88d404b8cebd7da409e551396cc45ee7">GetReferenceString</a>(strReference);
<a name="l10331"></a>10331 
<a name="l10332"></a>10332     <span class="keywordflow">if</span> (!strReference.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10333"></a>10333     {
<a name="l10334"></a>10334         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: No reference string found on transaction.\n&quot;</span>, __FUNCTION__);
<a name="l10335"></a>10335         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10336"></a>10336     }
<a name="l10337"></a>10337     <span class="comment">// -----------------------------------------------------</span>
<a name="l10338"></a>10338     <a class="code" href="class_o_t_item.html">OTItem</a> * pItem = <a class="code" href="class_o_t_item.html#af742fa1f4ba90d4807bda01a758d2d6a">OTItem::CreateItemFromString</a>(strReference, theServerID, pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#a08578043dac9d53f7a5a879b02785d46">GetReferenceToNum</a>());
<a name="l10339"></a>10339     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTItem&gt;</a> theAngel(pItem);
<a name="l10340"></a>10340 
<a name="l10341"></a>10341     <span class="keywordflow">if</span> (NULL == pItem)
<a name="l10342"></a>10342     {
<a name="l10343"></a>10343         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading transaction item from string.\n&quot;</span>, __FUNCTION__);
<a name="l10344"></a>10344         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10345"></a>10345     }
<a name="l10346"></a>10346 
<a name="l10347"></a>10347     <span class="comment">// pItem will be automatically cleaned up when it goes out of scope.</span>
<a name="l10348"></a>10348     <span class="comment">// -----------------------------------------------------</span>
<a name="l10349"></a>10349     <span class="keywordflow">if</span> ((<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a4b8c3e5db0f93a82b46a3d7dda75a835">OTItem::transfer</a>   != pItem-&gt;<a class="code" href="class_o_t_item.html#a2f4535b271f23b7c2b6b1dbabf279ffe">GetType</a>()) ||
<a name="l10350"></a>10350         (<a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376a16fa1b0df4dbad1367dbd0f6dbac9572">OTItem::request</a>    != pItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>()))
<a name="l10351"></a>10351     {
<a name="l10352"></a>10352         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Wrong item type or status attached as reference on transaction.\n&quot;</span>, __FUNCTION__);
<a name="l10353"></a>10353         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10354"></a>10354     }
<a name="l10355"></a>10355     <span class="comment">// -----------------------------------------------------</span>
<a name="l10356"></a>10356     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l10357"></a>10357 
<a name="l10358"></a>10358     pItem-&gt;<a class="code" href="class_o_t_item.html#aba1bd99f0402a8918f7847c7a4901206">GetNote</a>(strOutput);
<a name="l10359"></a>10359     <span class="comment">// -----------------------------------------------------</span>
<a name="l10360"></a>10360     <span class="comment">// Didn&#39;t find one.</span>
<a name="l10361"></a>10361     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10362"></a>10362         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10363"></a>10363 
<a name="l10364"></a>10364     <span class="comment">// We found a note -- let&#39;s return it!</span>
<a name="l10365"></a>10365     <span class="comment">//</span>
<a name="l10366"></a>10366     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l10367"></a>10367 
<a name="l10368"></a>10368     <span class="keywordflow">return</span> pBuf;
<a name="l10369"></a>10369 }
<a name="l10370"></a>10370 
<a name="l10371"></a>10371 
<a name="l10372"></a>10372 
<a name="l10373"></a>10373 
<a name="l10374"></a><a class="code" href="class_o_t_a_p_i___exec.html#add760095ec8b4d8acb2fe4edb7e5e996">10374</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#add760095ec8b4d8acb2fe4edb7e5e996">OTAPI_Exec::Transaction_GetAmount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10375"></a>10375                                          <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10376"></a>10376                                          <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10377"></a>10377                                          <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10378"></a>10378 {
<a name="l10379"></a>10379     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10380"></a>10380     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10381"></a>10381     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10382"></a>10382     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10383"></a>10383 
<a name="l10384"></a>10384     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10385"></a>10385 
<a name="l10386"></a>10386     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10387"></a>10387 
<a name="l10388"></a>10388     <span class="comment">// -----------------------------------------------------</span>
<a name="l10389"></a>10389     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10390"></a>10390     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> -1;
<a name="l10391"></a>10391     <span class="comment">// -----------------------------------------------------</span>
<a name="l10392"></a>10392 
<a name="l10393"></a>10393     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10394"></a>10394 
<a name="l10395"></a>10395     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10396"></a>10396     {
<a name="l10397"></a>10397         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10398"></a>10398         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10399"></a>10399         <span class="keywordflow">return</span> -1;
<a name="l10400"></a>10400     }
<a name="l10401"></a>10401 
<a name="l10402"></a>10402     <span class="comment">// -----------------------------------------------------</span>
<a name="l10403"></a>10403     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10404"></a>10404     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10405"></a>10405 
<a name="l10406"></a>10406     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())
<a name="l10407"></a>10407     {
<a name="l10408"></a>10408         int64_t lBoxType = 0;
<a name="l10409"></a>10409 
<a name="l10410"></a>10410              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10411"></a>10411         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10412"></a>10412         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10413"></a>10413         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10414"></a>10414         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10415"></a>10415         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10416"></a>10416         <span class="keywordflow">else</span>
<a name="l10417"></a>10417         {
<a name="l10418"></a>10418             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10419"></a>10419             <span class="keywordflow">return</span> -1;
<a name="l10420"></a>10420         }
<a name="l10421"></a>10421         <span class="comment">// --------------</span>
<a name="l10422"></a>10422         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10423"></a>10423         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10424"></a>10424         {
<a name="l10425"></a>10425             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt. \n&quot;</span>, __FUNCTION__);
<a name="l10426"></a>10426             <span class="keywordflow">return</span> -1;
<a name="l10427"></a>10427         }
<a name="l10428"></a>10428         <span class="comment">// ----------------</span>
<a name="l10429"></a>10429         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10430"></a>10430     }
<a name="l10431"></a>10431     <span class="keywordflow">else</span>
<a name="l10432"></a>10432         pTransaction = &amp;theTransaction;
<a name="l10433"></a>10433     <span class="comment">// -----------------------------------------------------</span>
<a name="l10434"></a>10434 
<a name="l10435"></a>10435     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l10436"></a>10436     <span class="keyword">const</span> int64_t lAmount = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a7a01fdc95811465496f953c5a50dcef6">GetReceiptAmount</a>();
<a name="l10437"></a>10437 
<a name="l10438"></a>10438     <span class="keywordflow">return</span> lAmount;
<a name="l10439"></a>10439 }
<a name="l10440"></a>10440 
<a name="l10441"></a>10441 
<a name="l10442"></a>10442 
<a name="l10443"></a>10443 
<a name="l10444"></a>10444 <span class="comment">// There is a notice in my inbox, from the server, informing me of</span>
<a name="l10445"></a>10445 <span class="comment">// a pending transfer.</span>
<a name="l10446"></a>10446 <span class="comment">// Oh? And this notice is in reference to what transaction ID?</span>
<a name="l10447"></a>10447 <span class="comment">// This function will return the ID of the original transaction</span>
<a name="l10448"></a>10448 <span class="comment">// that the sender used to send me the transfer in the first place.</span>
<a name="l10449"></a>10449 <span class="comment">// Since his actual request is attached to the pending transaction,</span>
<a name="l10450"></a>10450 <span class="comment">// I can use this function to look up the number.</span>
<a name="l10451"></a>10451 <span class="comment">//</span>
<a name="l10452"></a>10452 <span class="comment">// Returns cheque #, or market offer #, or payment plan #, or pending transfer #</span>
<a name="l10453"></a>10453 <span class="comment">// (Meant to be used on inbox items.)</span>
<a name="l10454"></a>10454 <span class="comment">//</span>
<a name="l10455"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab87d86f975e78c01b27d61d960fe9fd5">10455</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#ab87d86f975e78c01b27d61d960fe9fd5">OTAPI_Exec::Transaction_GetDisplayReferenceToNum</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10456"></a>10456                                                         <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10457"></a>10457                                                         <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10458"></a>10458                                                         <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10459"></a>10459 {
<a name="l10460"></a>10460     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10461"></a>10461     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10462"></a>10462     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10463"></a>10463     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10464"></a>10464 
<a name="l10465"></a>10465     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10466"></a>10466 
<a name="l10467"></a>10467     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10468"></a>10468 
<a name="l10469"></a>10469     <span class="comment">// -----------------------------------------------------</span>
<a name="l10470"></a>10470     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10471"></a>10471     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> -1;
<a name="l10472"></a>10472     <span class="comment">// -----------------------------------------------------</span>
<a name="l10473"></a>10473 
<a name="l10474"></a>10474     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10475"></a>10475 
<a name="l10476"></a>10476     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10477"></a>10477     {
<a name="l10478"></a>10478         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10479"></a>10479         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10480"></a>10480         <span class="keywordflow">return</span> -1;
<a name="l10481"></a>10481     }
<a name="l10482"></a>10482 
<a name="l10483"></a>10483     <span class="comment">// -----------------------------------------------------</span>
<a name="l10484"></a>10484     <span class="comment">// NO need to load abbreviated version here, since it already stores this number.</span>
<a name="l10485"></a>10485     <span class="comment">//</span>
<a name="l10486"></a>10486     <span class="keyword">const</span> int64_t lDisplayNum = theTransaction.<a class="code" href="class_o_t_transaction.html#a7a4463450cc735aea9b924011f073bb3">GetReferenceNumForDisplay</a>();
<a name="l10487"></a>10487     <span class="keywordflow">return</span> lDisplayNum;
<a name="l10488"></a>10488 }
<a name="l10489"></a>10489 
<a name="l10490"></a>10490 
<a name="l10491"></a>10491 
<a name="l10492"></a>10492 
<a name="l10493"></a>10493 
<a name="l10494"></a>10494 
<a name="l10495"></a>10495 
<a name="l10496"></a>10496 <span class="comment">// --------------------------------------------------</span>
<a name="l10497"></a>10497 <span class="comment">//</span>
<a name="l10498"></a>10498 <span class="comment">// Get Transaction Type  (internally uses GetTransactionTypeString().)</span>
<a name="l10499"></a>10499 <span class="comment">//</span>
<a name="l10500"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa97dac68f36dde2f0e43c3059ac9efe2">10500</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa97dac68f36dde2f0e43c3059ac9efe2" title="Get Transaction Type (internally uses GetTransactionTypeString().)">OTAPI_Exec::Transaction_GetType</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10501"></a>10501                                             <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10502"></a>10502                                             <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10503"></a>10503                                             <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10504"></a>10504 {
<a name="l10505"></a>10505     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10506"></a>10506     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10507"></a>10507     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10508"></a>10508     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10509"></a>10509 
<a name="l10510"></a>10510     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10511"></a>10511 
<a name="l10512"></a>10512     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10513"></a>10513 
<a name="l10514"></a>10514     <span class="comment">// -----------------------------------------------------</span>
<a name="l10515"></a>10515     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10516"></a>10516     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10517"></a>10517     <span class="comment">// -----------------------------------------------------</span>
<a name="l10518"></a>10518     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10519"></a>10519 
<a name="l10520"></a>10520     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10521"></a>10521     {
<a name="l10522"></a>10522         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10523"></a>10523         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10524"></a>10524         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l10525"></a>10525     }
<a name="l10526"></a>10526     <span class="comment">// -----------------------------------------------------</span>
<a name="l10527"></a>10527     <span class="comment">// NO need to load abbreviated version, since it already stores this number.</span>
<a name="l10528"></a>10528 
<a name="l10529"></a>10529     std::string pBuf = theTransaction.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>();
<a name="l10530"></a>10530 
<a name="l10531"></a>10531     <span class="keywordflow">return</span> pBuf;
<a name="l10532"></a>10532 }
<a name="l10533"></a>10533 
<a name="l10534"></a>10534 
<a name="l10535"></a>10535 <span class="comment">// Transactions do not have request numbers. However, if you have a replyNotice</span>
<a name="l10536"></a>10536 <span class="comment">// in your Nymbox, which is an OTTransaction object, it will CONTAIN a server</span>
<a name="l10537"></a>10537 <span class="comment">// reply to some previous message. This function will only work on a replyNotice,</span>
<a name="l10538"></a>10538 <span class="comment">// and it returns the actual request number of the server reply inside that notice.</span>
<a name="l10539"></a>10539 <span class="comment">// Used for calling OTAPI_Exec::HaveAlreadySeenReply() in order to see if we&#39;ve already</span>
<a name="l10540"></a>10540 <span class="comment">// processed the reply for that message.</span>
<a name="l10541"></a>10541 <span class="comment">// Returns &quot;&quot; on Error.</span>
<a name="l10542"></a>10542 <span class="comment">//</span>
<a name="l10543"></a><a class="code" href="class_o_t_a_p_i___exec.html#a5c24d944d0bb0c4597e39acc9ed400e3">10543</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a5c24d944d0bb0c4597e39acc9ed400e3">OTAPI_Exec::ReplyNotice_GetRequestNum</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10544"></a>10544                                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10545"></a>10545                                              <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10546"></a>10546 {
<a name="l10547"></a>10547     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10548"></a>10548     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10549"></a>10549     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10550"></a>10550 
<a name="l10551"></a>10551     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l10552"></a>10552         theUserID(USER_ID),
<a name="l10553"></a>10553         theAccountID(USER_ID); <span class="comment">// account IS user, for Nymbox (the only box that carries replyNotices...)</span>
<a name="l10554"></a>10554 
<a name="l10555"></a>10555     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10556"></a>10556 
<a name="l10557"></a>10557     <span class="comment">// -----------------------------------------------------</span>
<a name="l10558"></a>10558     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10559"></a>10559     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> -1;
<a name="l10560"></a>10560     <span class="comment">// -----------------------------------------------------</span>
<a name="l10561"></a>10561 
<a name="l10562"></a>10562     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10563"></a>10563 
<a name="l10564"></a>10564     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10565"></a>10565     {
<a name="l10566"></a>10566         <a class="code" href="class_o_t_string.html">OTString</a> strUserID(theUserID);
<a name="l10567"></a>10567         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. User ID: %s\n&quot;</span>,__FUNCTION__, strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10568"></a>10568         <span class="keywordflow">return</span> -1;
<a name="l10569"></a>10569     }
<a name="l10570"></a>10570 
<a name="l10571"></a>10571     <span class="comment">// -----------------------------------------------------</span>
<a name="l10572"></a>10572     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_transaction.html#af6b54636f1000e09f19d1c7a7886e1f8acae27254bdf46d3581a3ab1038566d7c">OTTransaction::replyNotice</a> != theTransaction.<a class="code" href="class_o_t_transaction.html#ac964dfd1e704c02358a6641f030ead38">GetType</a>())
<a name="l10573"></a>10573     {
<a name="l10574"></a>10574         <a class="code" href="class_o_t_string.html">OTString</a> strUserID(theUserID);
<a name="l10575"></a>10575         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Unexpected transaction type: %s. (Expected: %s) User: %s\n&quot;</span>,__FUNCTION__, theTransaction.<a class="code" href="class_o_t_transaction.html#a5baeb1d30c71f3a37565cb2e91b05447">GetTypeString</a>(), <span class="stringliteral">&quot;replyNotice&quot;</span>, strUserID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10576"></a>10576         <span class="keywordflow">return</span> -1;
<a name="l10577"></a>10577     }
<a name="l10578"></a>10578     <span class="comment">// -----------------------------------------------------</span>
<a name="l10579"></a>10579     <span class="comment">// NO need to load abbreviated version, since it already stores this number.</span>
<a name="l10580"></a>10580 
<a name="l10581"></a>10581     <span class="keyword">const</span> int64_t lRequestNumber = theTransaction.<a class="code" href="class_o_t_transaction.html#aa90624fb50b1b0edb72c6d4bd7b01a4c">GetRequestNum</a>();
<a name="l10582"></a>10582 
<a name="l10583"></a>10583     <span class="keywordflow">return</span> lRequestNumber;
<a name="l10584"></a>10584 }
<a name="l10585"></a>10585 
<a name="l10586"></a>10586 
<a name="l10587"></a>10587 
<a name="l10588"></a>10588 
<a name="l10589"></a>10589 <span class="comment">// --------------------------------------------------</span>
<a name="l10590"></a>10590 <span class="comment">//</span>
<a name="l10591"></a>10591 <span class="comment">// Get Transaction Date Signed  (internally uses OTTransaction::GetDateSigned().)</span>
<a name="l10592"></a>10592 <span class="comment">//</span>
<a name="l10593"></a><a class="code" href="class_o_t_a_p_i___exec.html#a08f64194b0ac81e9b3695d6500894303">10593</a> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#a08f64194b0ac81e9b3695d6500894303">OTAPI_Exec::Transaction_GetDateSigned</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10594"></a>10594                                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10595"></a>10595                                              <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10596"></a>10596                                              <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10597"></a>10597 {
<a name="l10598"></a>10598     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10599"></a>10599     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10600"></a>10600     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10601"></a>10601     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10602"></a>10602 
<a name="l10603"></a>10603     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10604"></a>10604 
<a name="l10605"></a>10605     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10606"></a>10606 
<a name="l10607"></a>10607     <span class="comment">// -----------------------------------------------------</span>
<a name="l10608"></a>10608     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10609"></a>10609     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l10610"></a>10610     <span class="comment">// -----------------------------------------------------</span>
<a name="l10611"></a>10611 
<a name="l10612"></a>10612     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10613"></a>10613 
<a name="l10614"></a>10614     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10615"></a>10615     {
<a name="l10616"></a>10616         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10617"></a>10617         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10618"></a>10618         <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l10619"></a>10619     }
<a name="l10620"></a>10620     <span class="comment">// NO need to load abbreviated version here, since it already stores the date.</span>
<a name="l10621"></a>10621     <span class="comment">// -----------------------------------------------------</span>
<a name="l10622"></a>10622 
<a name="l10623"></a>10623     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l10624"></a>10624     <span class="keywordflow">return</span> theTransaction.<a class="code" href="class_o_t_transaction.html#afb069b9f7ab72f90e9e42aed0ba3b17c">GetDateSigned</a>();
<a name="l10625"></a>10625 }
<a name="l10626"></a>10626 
<a name="l10627"></a>10627 
<a name="l10628"></a>10628 <span class="comment">// --------------------------------------------------</span>
<a name="l10629"></a>10629 <span class="comment">//</span>
<a name="l10630"></a>10630 <span class="comment">// Get TransactionSuccess</span>
<a name="l10631"></a>10631 <span class="comment">//</span>
<a name="l10632"></a>10632 <span class="comment">// OT_TRUE  (1) == acknowledgment</span>
<a name="l10633"></a>10633 <span class="comment">// OT_FALSE (0) == rejection</span>
<a name="l10634"></a>10634 <span class="comment">// OT_ERROR(-1) == error_state (such as dropped message.)</span>
<a name="l10635"></a>10635 <span class="comment">//</span>
<a name="l10636"></a>10636 <span class="comment">// Returns OT_BOOL.</span>
<a name="l10637"></a>10637 <span class="comment">//</span>
<a name="l10638"></a><a class="code" href="class_o_t_a_p_i___exec.html#a53d79e4cf2d08e573668e7d5950a88ff">10638</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#a53d79e4cf2d08e573668e7d5950a88ff">OTAPI_Exec::Transaction_GetSuccess</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10639"></a>10639                                            <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10640"></a>10640                                            <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10641"></a>10641                                            <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10642"></a>10642 {
<a name="l10643"></a>10643     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10644"></a>10644     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10645"></a>10645     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10646"></a>10646     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10647"></a>10647 
<a name="l10648"></a>10648     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10649"></a>10649 
<a name="l10650"></a>10650     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10651"></a>10651     <span class="comment">// -----------------------------------------------------</span>
<a name="l10652"></a>10652     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10653"></a>10653     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10654"></a>10654     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l10655"></a>10655     <span class="comment">// -----------------------------------------------------</span>
<a name="l10656"></a>10656     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10657"></a>10657 
<a name="l10658"></a>10658     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10659"></a>10659     {
<a name="l10660"></a>10660         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10661"></a>10661         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10662"></a>10662         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10663"></a>10663     }
<a name="l10664"></a>10664     <span class="comment">// -----------------------------------------------------</span>
<a name="l10665"></a>10665     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10666"></a>10666     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10667"></a>10667 
<a name="l10668"></a>10668     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>()) <span class="comment">// Abbreviated.</span>
<a name="l10669"></a>10669     {
<a name="l10670"></a>10670         int64_t lBoxType = 0;
<a name="l10671"></a>10671 
<a name="l10672"></a>10672         <span class="comment">// --------------</span>
<a name="l10673"></a>10673              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))           lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10674"></a>10674         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))            lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10675"></a>10675         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))           lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10676"></a>10676         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>))     lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10677"></a>10677         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10678"></a>10678         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10679"></a>10679         <span class="keywordflow">else</span>
<a name="l10680"></a>10680         {
<a name="l10681"></a>10681             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10682"></a>10682             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10683"></a>10683         }
<a name="l10684"></a>10684         <span class="comment">// --------------</span>
<a name="l10685"></a>10685         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10686"></a>10686         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10687"></a>10687         {
<a name="l10688"></a>10688             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt. \n&quot;</span>, __FUNCTION__);
<a name="l10689"></a>10689             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10690"></a>10690         }
<a name="l10691"></a>10691         <span class="comment">// ----------------</span>
<a name="l10692"></a>10692         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10693"></a>10693     }
<a name="l10694"></a>10694     <span class="keywordflow">else</span>  <span class="comment">// NOT abbreviated.</span>
<a name="l10695"></a>10695         pTransaction = &amp;theTransaction;
<a name="l10696"></a>10696     <span class="comment">// -----------------------------------------------------</span>
<a name="l10697"></a>10697 
<a name="l10698"></a>10698     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac5ffc9f0e274bbc617185a5335c061a3">GetSuccess</a>())
<a name="l10699"></a>10699     {
<a name="l10700"></a>10700         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l10701"></a>10701     }
<a name="l10702"></a>10702     <span class="keywordflow">else</span>
<a name="l10703"></a>10703     {
<a name="l10704"></a>10704         <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
<a name="l10705"></a>10705 
<a name="l10706"></a>10706         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: ** FYI, this transaction has a &#39;failure&#39; status from the server. TransNum: %lld\n&quot;</span>, __FUNCTION__, lTransactionNum);
<a name="l10707"></a>10707     }
<a name="l10708"></a>10708 
<a name="l10709"></a>10709     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l10710"></a>10710 }
<a name="l10711"></a>10711 
<a name="l10712"></a>10712 
<a name="l10713"></a><a class="code" href="class_o_t_a_p_i___exec.html#abd80f7e0caf22e569fcdf9173cafb8fa">10713</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#abd80f7e0caf22e569fcdf9173cafb8fa">OTAPI_Exec::Transaction_IsCanceled</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10714"></a>10714                                            <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10715"></a>10715                                            <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10716"></a>10716                                            <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10717"></a>10717 {
<a name="l10718"></a>10718     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10719"></a>10719     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10720"></a>10720     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10721"></a>10721     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10722"></a>10722 
<a name="l10723"></a>10723     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10724"></a>10724 
<a name="l10725"></a>10725     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10726"></a>10726     <span class="comment">// -----------------------------------------------------</span>
<a name="l10727"></a>10727     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10728"></a>10728     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10729"></a>10729     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l10730"></a>10730     <span class="comment">// -----------------------------------------------------</span>
<a name="l10731"></a>10731     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10732"></a>10732 
<a name="l10733"></a>10733     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10734"></a>10734     {
<a name="l10735"></a>10735         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10736"></a>10736         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10737"></a>10737         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10738"></a>10738     }
<a name="l10739"></a>10739     <span class="comment">// -----------------------------------------------------</span>
<a name="l10740"></a>10740     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10741"></a>10741     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10742"></a>10742 
<a name="l10743"></a>10743     <span class="comment">// Note: This is an artifact from Transaction_GetSuccess, whose code was copied to make</span>
<a name="l10744"></a>10744     <span class="comment">// this function. In reality, a cancelled transaction will never be abbreviated, since it</span>
<a name="l10745"></a>10745     <span class="comment">// won&#39;t be used as any kind of box receipt in the first place. Rather, a canceled transaction</span>
<a name="l10746"></a>10746     <span class="comment">// will only occur as a server reply to a transaction request. For example, if you cancel a</span>
<a name="l10747"></a>10747     <span class="comment">// cheque, or cancel a payment plan, and that cancellation is successful, then the server</span>
<a name="l10748"></a>10748     <span class="comment">// will return a &quot;reply transaction&quot; to that request, which has &#39;cancelled&#39; set to true.</span>
<a name="l10749"></a>10749     <span class="comment">// So why am I leaving this code here for now? We can trim it down later I suppose.</span>
<a name="l10750"></a>10750     <span class="comment">//</span>
<a name="l10751"></a>10751     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>()) <span class="comment">// Abbreviated.</span>
<a name="l10752"></a>10752     {
<a name="l10753"></a>10753         int64_t lBoxType = 0;
<a name="l10754"></a>10754 
<a name="l10755"></a>10755         <span class="comment">// --------------</span>
<a name="l10756"></a>10756              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))           lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10757"></a>10757         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))            lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10758"></a>10758         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))           lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10759"></a>10759         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>))     lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10760"></a>10760         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10761"></a>10761         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10762"></a>10762         <span class="keywordflow">else</span>
<a name="l10763"></a>10763         {
<a name="l10764"></a>10764             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10765"></a>10765             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10766"></a>10766         }
<a name="l10767"></a>10767         <span class="comment">// --------------</span>
<a name="l10768"></a>10768         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10769"></a>10769         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10770"></a>10770         {
<a name="l10771"></a>10771             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt. \n&quot;</span>, __FUNCTION__);
<a name="l10772"></a>10772             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10773"></a>10773         }
<a name="l10774"></a>10774         <span class="comment">// ----------------</span>
<a name="l10775"></a>10775         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10776"></a>10776     }
<a name="l10777"></a>10777     <span class="keywordflow">else</span>  <span class="comment">// NOT abbreviated.</span>
<a name="l10778"></a>10778         pTransaction = &amp;theTransaction;
<a name="l10779"></a>10779     <span class="comment">// -----------------------------------------------------</span>
<a name="l10780"></a>10780     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeabba0a2b6a52c8f50a329f7d14a1ba1">IsCancelled</a>())
<a name="l10781"></a>10781     {
<a name="l10782"></a>10782         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l10783"></a>10783     }
<a name="l10784"></a>10784 
<a name="l10785"></a>10785     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l10786"></a>10786 }
<a name="l10787"></a>10787 
<a name="l10788"></a>10788 
<a name="l10789"></a>10789 
<a name="l10790"></a>10790 <span class="comment">// --------------------------------------------------</span>
<a name="l10791"></a>10791 <span class="comment">//</span>
<a name="l10792"></a>10792 <span class="comment">// Get Balance Agreement Success</span>
<a name="l10793"></a>10793 <span class="comment">// (from a TRANSACTION.)</span>
<a name="l10794"></a>10794 <span class="comment">//                              true  (1) == acknowledgment</span>
<a name="l10795"></a>10795 <span class="comment">//                              false (0) == rejection</span>
<a name="l10796"></a>10796 <span class="comment">// NEW: -1 (-1) for error</span>
<a name="l10797"></a>10797 <span class="comment">//</span>
<a name="l10798"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac9008c5a1c984e5870207e87dff173e3">10798</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#ac9008c5a1c984e5870207e87dff173e3">OTAPI_Exec::Transaction_GetBalanceAgreementSuccess</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10799"></a>10799                                                            <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10800"></a>10800                                                            <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10801"></a>10801                                                            <span class="keyword">const</span> std::string &amp; THE_TRANSACTION)
<a name="l10802"></a>10802 {
<a name="l10803"></a>10803     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10804"></a>10804     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10805"></a>10805     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10806"></a>10806     <span class="keywordflow">if</span> (THE_TRANSACTION.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TRANSACTION&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10807"></a>10807 
<a name="l10808"></a>10808     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10809"></a>10809 
<a name="l10810"></a>10810     <a class="code" href="class_o_t_string.html">OTString</a> strTransaction(THE_TRANSACTION);
<a name="l10811"></a>10811     <span class="comment">// -----------------------------------------------------</span>
<a name="l10812"></a>10812 
<a name="l10813"></a>10813     <span class="comment">// -----------------------------------------------------</span>
<a name="l10814"></a>10814     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theUserID, <span class="keyword">false</span>, __FUNCTION__); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l10815"></a>10815     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10816"></a>10816     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l10817"></a>10817     <span class="comment">// -----------------------------------------------------</span>
<a name="l10818"></a>10818     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> theTransaction(theUserID, theAccountID, theServerID);
<a name="l10819"></a>10819 
<a name="l10820"></a>10820     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theTransaction.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strTransaction))
<a name="l10821"></a>10821     {
<a name="l10822"></a>10822         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10823"></a>10823         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading transaction from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10824"></a>10824         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10825"></a>10825     }
<a name="l10826"></a>10826     <span class="comment">// -----------------------------------------------------</span>
<a name="l10827"></a>10827     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = NULL;
<a name="l10828"></a>10828     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTTransaction&gt;</a> theTransAngel;
<a name="l10829"></a>10829 
<a name="l10830"></a>10830     <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction.html#aacf7e02644aace6f245b9d493e721186">IsAbbreviated</a>())  <span class="comment">// IF TRANSACTION IS ABBREVIATED (Ledger may only contain stubs, not full records...)</span>
<a name="l10831"></a>10831     {
<a name="l10832"></a>10832         int64_t lBoxType = 0;
<a name="l10833"></a>10833 
<a name="l10834"></a>10834         <span class="comment">// ----------------</span>
<a name="l10835"></a>10835              <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;nymboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae7427339a1b7566f46fb6d60c66bbfae">OTLedger::nymbox</a>);
<a name="l10836"></a>10836         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;inboxRecord&quot;</span>))        lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa7bd594902e6c775ef4f356897fb36006">OTLedger::inbox</a>);
<a name="l10837"></a>10837         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;outboxRecord&quot;</span>))       lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaa0150c89048bba5eedf6a0919603d4e4">OTLedger::outbox</a>);
<a name="l10838"></a>10838         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;paymentInboxRecord&quot;</span>)) lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aaf8b0cad55e051e014a4f9ebee8dd2984">OTLedger::paymentInbox</a>);
<a name="l10839"></a>10839         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;recordBoxRecord&quot;</span>))    lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aae650dd1b5a89523bace1c54c06897922">OTLedger::recordBox</a>);
<a name="l10840"></a>10840         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theTransaction.<a class="code" href="class_o_t_transaction_type.html#a6551c3443c638e690ddd5eda535c0101">Contains</a>(<span class="stringliteral">&quot;expiredBoxRecord&quot;</span>))   lBoxType = static_cast&lt;int64_t&gt;(<a class="code" href="class_o_t_ledger.html#ac03f2514d0c6ae00147c5d53bf19591aa500bad2900b83847f7cc16b8cc26817a">OTLedger::expiredBox</a>);
<a name="l10841"></a>10841         <span class="keywordflow">else</span>
<a name="l10842"></a>10842         {
<a name="l10843"></a>10843             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: unknown ledger type. \n&quot;</span>, __FUNCTION__);
<a name="l10844"></a>10844             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10845"></a>10845         }
<a name="l10846"></a>10846         <span class="comment">// --------------</span>
<a name="l10847"></a>10847         pTransaction = <a class="code" href="class_o_t_transaction.html#ae97bc794fe820f4f2e864c29c42df8eb">OTTransaction::LoadBoxReceipt</a>(theTransaction, static_cast&lt;int64_t&gt;(lBoxType));
<a name="l10848"></a>10848         <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l10849"></a>10849         {
<a name="l10850"></a>10850             <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading from abbreviated transaction: failed loading box receipt.\n&quot;</span>, __FUNCTION__);
<a name="l10851"></a>10851             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10852"></a>10852         }
<a name="l10853"></a>10853         <span class="comment">// ----------------</span>
<a name="l10854"></a>10854         theTransAngel.<a class="code" href="class_o_t_cleanup.html#aac0b26193b0a59dbbf491a4e417af833">SetCleanupTargetPointer</a>(pTransaction);
<a name="l10855"></a>10855     }
<a name="l10856"></a>10856     <span class="keywordflow">else</span>
<a name="l10857"></a>10857         pTransaction = &amp;theTransaction;
<a name="l10858"></a>10858     <span class="comment">// -----------------------------------------------------</span>
<a name="l10859"></a>10859     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return its success status</span>
<a name="l10860"></a>10860     <a class="code" href="class_o_t_item.html">OTItem</a> * pReplyItem = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>);
<a name="l10861"></a>10861 
<a name="l10862"></a>10862     <span class="keywordflow">if</span> (NULL == pReplyItem)
<a name="l10863"></a>10863         pReplyItem = pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>);
<a name="l10864"></a>10864 
<a name="l10865"></a>10865     <span class="keywordflow">if</span> (NULL == pReplyItem)
<a name="l10866"></a>10866     {
<a name="l10867"></a>10867         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good transaction (could have been abbreviated though) &quot;</span>
<a name="l10868"></a>10868                       <span class="stringliteral">&quot;but uncovered \&quot;\&quot; item pointer.\n&quot;</span>, __FUNCTION__);
<a name="l10869"></a>10869         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// Weird.</span>
<a name="l10870"></a>10870     }
<a name="l10871"></a>10871 
<a name="l10872"></a>10872     <span class="keywordflow">return</span> (pReplyItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>() == <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>) ? <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a> : <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l10873"></a>10873 }
<a name="l10874"></a>10874 
<a name="l10875"></a>10875 
<a name="l10876"></a>10876 
<a name="l10877"></a>10877 
<a name="l10878"></a>10878 <span class="comment">// -----------------------------------------------------------</span>
<a name="l10879"></a>10879 <span class="comment">// GET BALANCE AGREEMENT SUCCESS (From a MESSAGE.)</span>
<a name="l10880"></a>10880 <span class="comment">//</span>
<a name="l10881"></a>10881 <span class="comment">// Returns true (1) for Success and false (0) for Failure.</span>
<a name="l10882"></a>10882 <span class="comment">// New: returns -1 (-1) for error.</span>
<a name="l10883"></a>10883 <span class="comment">//</span>
<a name="l10884"></a><a class="code" href="class_o_t_a_p_i___exec.html#aafcc2a8a18275deef3ea14b672e0902b">10884</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#aafcc2a8a18275deef3ea14b672e0902b">OTAPI_Exec::Message_GetBalanceAgreementSuccess</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l10885"></a>10885                                                        <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l10886"></a>10886                                                        <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l10887"></a>10887                                                        <span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l10888"></a>10888 {
<a name="l10889"></a>10889     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10890"></a>10890     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10891"></a>10891     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10892"></a>10892     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l10893"></a>10893 
<a name="l10894"></a>10894     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l10895"></a>10895 
<a name="l10896"></a>10896     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l10897"></a>10897 
<a name="l10898"></a>10898     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l10899"></a>10899 
<a name="l10900"></a>10900     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l10901"></a>10901     {
<a name="l10902"></a>10902         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l10903"></a>10903         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10904"></a>10904     }
<a name="l10905"></a>10905 
<a name="l10906"></a>10906     <span class="comment">// It&#39;s not a transaction request or response, so the Payload wouldn&#39;t</span>
<a name="l10907"></a>10907     <span class="comment">// contain a ledger. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l10908"></a>10908     <span class="comment">// in that case, now do I?)</span>
<a name="l10909"></a>10909     <span class="comment">//</span>
<a name="l10910"></a>10910     <span class="keywordflow">if</span> (
<a name="l10911"></a>10911         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@notarizeTransactions&quot;</span>)) &amp;&amp;
<a name="l10912"></a>10912         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processNymbox&quot;</span>)) &amp;&amp;
<a name="l10913"></a>10913         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processInbox&quot;</span>))
<a name="l10914"></a>10914         )
<a name="l10915"></a>10915     {
<a name="l10916"></a>10916         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10917"></a>10917         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10918"></a>10918     }
<a name="l10919"></a>10919 
<a name="l10920"></a>10920     <span class="comment">// The ledger is stored in the Payload, we&#39;ll grab it into the String.</span>
<a name="l10921"></a>10921     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>);
<a name="l10922"></a>10922 
<a name="l10923"></a>10923     <span class="keywordflow">if</span> (!strLedger.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l10924"></a>10924     {
<a name="l10925"></a>10925         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No ledger found on message.\n&quot;</span>, __FUNCTION__);
<a name="l10926"></a>10926         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10927"></a>10927     }
<a name="l10928"></a>10928 
<a name="l10929"></a>10929     <span class="comment">// ------------------------------------</span>
<a name="l10930"></a>10930 
<a name="l10931"></a>10931     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l10932"></a>10932 
<a name="l10933"></a>10933     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_ledger.html#a472314e803ddaad58d3063c78ef0c22b">LoadLedgerFromString</a>(strLedger))
<a name="l10934"></a>10934     {
<a name="l10935"></a>10935         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l10936"></a>10936         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l10937"></a>10937         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l10938"></a>10938     }
<a name="l10939"></a>10939 
<a name="l10940"></a>10940     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l10941"></a>10941 
<a name="l10942"></a>10942     <span class="keywordflow">if</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &lt;= 0)
<a name="l10943"></a>10943     {
<a name="l10944"></a>10944         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s bad count in message ledger: %d\n&quot;</span>, __FUNCTION__, theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>());
<a name="l10945"></a>10945         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<a name="l10946"></a>10946     }
<a name="l10947"></a>10947 
<a name="l10948"></a>10948     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pReplyTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(0); <span class="comment">// Right now this is a defacto standard. (only 1 transaction per message ledger, excepting process inbox. &lt;== why? That&#39;s one as well I thought. And has multiple items attached.)</span>
<a name="l10949"></a>10949     <span class="comment">//  OTCleanup&lt;OTTransaction&gt; theAngel(pTransaction); // THE LEDGER CLEANS THIS ALREADY.</span>
<a name="l10950"></a>10950 
<a name="l10951"></a>10951     <span class="keywordflow">if</span> (NULL == pReplyTransaction)
<a name="l10952"></a>10952     {
<a name="l10953"></a>10953         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s good index but uncovered \&quot;\&quot; pointer there: %d\n&quot;</span>, __FUNCTION__, 0);
<a name="l10954"></a>10954         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// Weird.</span>
<a name="l10955"></a>10955     }
<a name="l10956"></a>10956 
<a name="l10957"></a>10957     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return its success status</span>
<a name="l10958"></a>10958     <a class="code" href="class_o_t_item.html">OTItem</a> * pReplyItem = pReplyTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1af8bcd696284c0bcd0fe198dceaf2f6d5">OTItem::atBalanceStatement</a>);
<a name="l10959"></a>10959 
<a name="l10960"></a>10960     <span class="keywordflow">if</span> (NULL == pReplyItem)
<a name="l10961"></a>10961         pReplyItem = pReplyTransaction-&gt;<a class="code" href="class_o_t_transaction.html#a62bf5069d7a7fda92fa1d6746a75bb49">GetItem</a>(<a class="code" href="class_o_t_item.html#a03db091faaab100aadc455f4ebe2c5d1a53f9e1f8ef8651545c50d933db94636c">OTItem::atTransactionStatement</a>);
<a name="l10962"></a>10962 
<a name="l10963"></a>10963     <span class="keywordflow">if</span> (NULL == pReplyItem)
<a name="l10964"></a>10964     {
<a name="l10965"></a>10965         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s good index but uncovered \&quot;\&quot; item pointer: %d\n&quot;</span>, __FUNCTION__, 0);
<a name="l10966"></a>10966         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// Weird.</span>
<a name="l10967"></a>10967     }
<a name="l10968"></a>10968 
<a name="l10969"></a>10969     <span class="keywordflow">if</span> (pReplyItem-&gt;<a class="code" href="class_o_t_item.html#abadbfe245f0dbc8a035d8d6930dd9dfc">GetStatus</a>() == <a class="code" href="class_o_t_item.html#a61e86f5b6c64a518664123907235f376aa099f14a8a9ef5987b1161b764895cdf">OTItem::acknowledgement</a>)
<a name="l10970"></a>10970     {
<a name="l10971"></a>10971         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l10972"></a>10972     }
<a name="l10973"></a>10973 
<a name="l10974"></a>10974     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l10975"></a>10975 }
<a name="l10976"></a>10976 
<a name="l10977"></a>10977 
<a name="l10978"></a>10978 
<a name="l10979"></a>10979 
<a name="l10980"></a>10980 
<a name="l10981"></a>10981 
<a name="l10982"></a>10982 
<a name="l10983"></a>10983 
<a name="l10984"></a>10984 
<a name="l10985"></a>10985 <span class="comment">/*</span>
<a name="l10986"></a>10986 <span class="comment">std::string OTAPI_Exec::LoadPurse(const std::string &amp; SERVER_ID,</span>
<a name="l10987"></a>10987 <span class="comment">                                  std::string ASSET_TYPE_ID,</span>
<a name="l10988"></a>10988 <span class="comment">                                  std::string USER_ID) // returns &quot;&quot;, or a purse.</span>
<a name="l10989"></a>10989 <span class="comment">{</span>
<a name="l10990"></a>10990 <span class="comment">    OT_ASSERT_MSG(&quot;&quot; != SERVER_ID, &quot;Null SERVER_ID passed in.&quot;);</span>
<a name="l10991"></a>10991 <span class="comment">    OT_ASSERT_MSG(&quot;&quot; != ASSET_TYPE_ID, &quot;Null ASSET_TYPE_ID passed in.&quot;);</span>
<a name="l10992"></a>10992 <span class="comment">    OT_ASSERT_MSG(&quot;&quot; != USER_ID, &quot;Null USER_ID passed in.&quot;);</span>
<a name="l10993"></a>10993 <span class="comment"></span>
<a name="l10994"></a>10994 <span class="comment">    const OTIdentifier theServerID(SERVER_ID);</span>
<a name="l10995"></a>10995 <span class="comment">    const OTIdentifier theAssetID(ASSET_TYPE_ID);</span>
<a name="l10996"></a>10996 <span class="comment">    const OTIdentifier theUserID(USER_ID);</span>
<a name="l10997"></a>10997 <span class="comment"></span>
<a name="l10998"></a>10998 <span class="comment">    // There is an OT_ASSERT in here for memory failure,</span>
<a name="l10999"></a>10999 <span class="comment">    // but it still might return &quot;&quot; if various verification fails.</span>
<a name="l11000"></a>11000 <span class="comment">    OTPurse * pPurse = OTAPI()-&gt;LoadPurse(theServerID, theAssetID, theUserID);</span>
<a name="l11001"></a>11001 <span class="comment"></span>
<a name="l11002"></a>11002 <span class="comment">    // Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l11003"></a>11003 <span class="comment">    OTCleanup&lt;OTPurse&gt;  thePurseAngel(pPurse); // I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l11004"></a>11004 <span class="comment"></span>
<a name="l11005"></a>11005 <span class="comment">    if (NULL == pPurse)</span>
<a name="l11006"></a>11006 <span class="comment">    {</span>
<a name="l11007"></a>11007 <span class="comment">        OTLog::vOutput(0, &quot;Failure calling OT_API::LoadPurse in OTAPI_Exec::LoadPurse.\n &quot;</span>
<a name="l11008"></a>11008 <span class="comment">                       &quot;Server: %s\n Asset Type: %s\n&quot;, SERVER_ID, ASSET_TYPE_ID);</span>
<a name="l11009"></a>11009 <span class="comment">    }</span>
<a name="l11010"></a>11010 <span class="comment">    else // success</span>
<a name="l11011"></a>11011 <span class="comment">    {</span>
<a name="l11012"></a>11012 <span class="comment">        OTString strOutput(*pPurse); // For the output</span>
<a name="l11013"></a>11013 <span class="comment"></span>
<a name="l11014"></a>11014 <span class="comment">        std::string pBuf = strOutput.Get();</span>
<a name="l11015"></a>11015 <span class="comment"></span>
<a name="l11016"></a>11016 <span class="comment"></span>
<a name="l11017"></a>11017 <span class="comment"></span>
<a name="l11018"></a>11018 <span class="comment">        return pBuf;</span>
<a name="l11019"></a>11019 <span class="comment">    }</span>
<a name="l11020"></a>11020 <span class="comment"></span>
<a name="l11021"></a>11021 <span class="comment">    return &quot;&quot;;</span>
<a name="l11022"></a>11022 <span class="comment">}</span>
<a name="l11023"></a>11023 <span class="comment">*/</span>
<a name="l11024"></a>11024 
<a name="l11025"></a>11025 
<a name="l11026"></a>11026 
<a name="l11027"></a>11027 
<a name="l11028"></a>11028 
<a name="l11029"></a>11029 
<a name="l11030"></a>11030 
<a name="l11031"></a>11031 
<a name="l11032"></a>11032 <span class="comment">// --------------------------------------------------</span>
<a name="l11033"></a>11033 
<a name="l11034"></a>11034 
<a name="l11035"></a>11035 
<a name="l11036"></a>11036 
<a name="l11037"></a>11037 <span class="comment">// PURSE FUNCTIONS</span>
<a name="l11038"></a>11038 
<a name="l11039"></a>11039 
<a name="l11040"></a>11040 
<a name="l11041"></a>11041 
<a name="l11042"></a>11042 
<a name="l11043"></a>11043 <span class="comment">// Warning! This will overwrite whatever purse is there.</span>
<a name="l11044"></a>11044 <span class="comment">// The proper way to use this function is, LOAD the purse,</span>
<a name="l11045"></a>11045 <span class="comment">// then IMPORT whatever other purse you want into it, then</span>
<a name="l11046"></a>11046 <span class="comment">// SAVE it again.</span>
<a name="l11047"></a><a class="code" href="class_o_t_a_p_i___exec.html#abf8584922878bf613ccbd5cbe5a237e5">11047</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#abf8584922878bf613ccbd5cbe5a237e5">OTAPI_Exec::SavePurse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11048"></a>11048                         <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11049"></a>11049                         <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l11050"></a>11050                         <span class="keyword">const</span> std::string &amp; THE_PURSE) <span class="comment">// returns bool</span>
<a name="l11051"></a>11051 {
<a name="l11052"></a>11052     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11053"></a>11053     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11054"></a>11054     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11055"></a>11055     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11056"></a>11056 
<a name="l11057"></a>11057     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11058"></a>11058     std::string strFunc = __FUNCTION__;
<a name="l11059"></a>11059     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11060"></a>11060     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11061"></a>11061         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11062"></a>11062         theUserID(USER_ID);
<a name="l11063"></a>11063     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11064"></a>11064     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11065"></a>11065     <span class="keywordtype">bool</span> bSuccess = <span class="keyword">false</span>;
<a name="l11066"></a>11066     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11067"></a>11067     <a class="code" href="class_o_t_purse.html">OTPurse</a> thePurse(theServerID, theAssetTypeID, theUserID);
<a name="l11068"></a>11068 
<a name="l11069"></a>11069     <span class="keywordflow">if</span> (strPurse.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse))
<a name="l11070"></a>11070     {
<a name="l11071"></a>11071         <span class="comment">// NOTE: no need to verify the server / asset ID here, since the call</span>
<a name="l11072"></a>11072         <span class="comment">// to SavePurse already does that.</span>
<a name="l11073"></a>11073         <span class="comment">//</span>
<a name="l11074"></a>11074         <span class="comment">//      if ((theServerID    != thePurse.GetServerID()) ||</span>
<a name="l11075"></a>11075         <span class="comment">//          (theAssetTypeID != thePurse.GetAssetID()))</span>
<a name="l11076"></a>11076         <span class="comment">//      {</span>
<a name="l11077"></a>11077         <span class="comment">//          OTLog::vOutput(0, &quot;%s: Failure loading purse from string; server &quot;</span>
<a name="l11078"></a>11078         <span class="comment">//                         &quot;or asset ID didn&#39;t match what was expected:\n%s\n&quot;,</span>
<a name="l11079"></a>11079         <span class="comment">//                         strFunc, strPurse.Get());</span>
<a name="l11080"></a>11080         <span class="comment">//      }</span>
<a name="l11081"></a>11081         <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ac3e808efa2420f7647ee0659de4ed176">SavePurse</a>(theServerID, theAssetTypeID, theUserID, thePurse))
<a name="l11082"></a>11082         {
<a name="l11083"></a>11083             bSuccess = <span class="keyword">true</span>;
<a name="l11084"></a>11084         }
<a name="l11085"></a>11085         <span class="keywordflow">else</span>
<a name="l11086"></a>11086         {
<a name="l11087"></a>11087             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure saving purse:\n%s\n&quot;</span>, strFunc.c_str(), strPurse.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l11088"></a>11088         }
<a name="l11089"></a>11089     }
<a name="l11090"></a>11090     <span class="keywordflow">else</span>
<a name="l11091"></a>11091     {
<a name="l11092"></a>11092         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading purse from string:\n%s\n&quot;</span>, strFunc.c_str(), strPurse.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l11093"></a>11093     }
<a name="l11094"></a>11094 
<a name="l11095"></a>11095     <span class="keywordflow">return</span> bSuccess;
<a name="l11096"></a>11096 }
<a name="l11097"></a>11097 
<a name="l11098"></a>11098 
<a name="l11099"></a>11099 <span class="comment">// --------------------------------------------------------------</span>
<a name="l11100"></a>11100 <span class="comment">// LOAD PURSE -- (from local storage)</span>
<a name="l11101"></a>11101 <span class="comment">//</span>
<a name="l11102"></a>11102 <span class="comment">// Based on Asset Type ID: load a purse, a public mint, or an asset contract</span>
<a name="l11103"></a>11103 <span class="comment">// and return it as a string -- or return &quot;&quot; if it wasn&#39;t found.</span>
<a name="l11104"></a>11104 <span class="comment">//</span>
<a name="l11105"></a><a class="code" href="class_o_t_a_p_i___exec.html#a50d1782dab55e11d3e833895039b63ef">11105</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a50d1782dab55e11d3e833895039b63ef">OTAPI_Exec::LoadPurse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11106"></a>11106                              <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11107"></a>11107                              <span class="keyword">const</span> std::string &amp; USER_ID) <span class="comment">// returns &quot;&quot;, or a purse.</span>
<a name="l11108"></a>11108 {
<a name="l11109"></a>11109     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11110"></a>11110     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11111"></a>11111     <span class="keywordflow">if</span> (USER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11112"></a>11112     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l11113"></a>11113     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l11114"></a>11114     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetID(ASSET_TYPE_ID);
<a name="l11115"></a>11115     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l11116"></a>11116     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l11117"></a>11117     <span class="comment">// There is an OT_ASSERT in here for memory failure,</span>
<a name="l11118"></a>11118     <span class="comment">// but it still might return &quot;&quot; if various verification fails.</span>
<a name="l11119"></a>11119 
<a name="l11120"></a>11120     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae86b6c0831420bcf0ecadc603364d230">LoadPurse</a>(theServerID, theAssetID, theUserID);
<a name="l11121"></a>11121 
<a name="l11122"></a>11122     <span class="comment">// Make sure it gets cleaned up when this goes out of scope.</span>
<a name="l11123"></a>11123     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a>  thePurseAngel(pPurse); <span class="comment">// I pass the pointer, in case it&#39;s &quot;&quot;.</span>
<a name="l11124"></a>11124 
<a name="l11125"></a>11125     <span class="keywordflow">if</span> (NULL == pPurse)
<a name="l11126"></a>11126     {
<a name="l11127"></a>11127         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;OTAPI_Exec::LoadPurse() received null when called OT_API::LoadPurse(). &quot;</span>
<a name="l11128"></a>11128             <span class="stringliteral">&quot;Server: %s Asset Type: %s\n&quot;</span>, SERVER_ID.c_str(), ASSET_TYPE_ID.c_str());
<a name="l11129"></a>11129     }
<a name="l11130"></a>11130     <span class="keywordflow">else</span> <span class="comment">// success</span>
<a name="l11131"></a>11131     {
<a name="l11132"></a>11132         <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pPurse); <span class="comment">// For the output</span>
<a name="l11133"></a>11133         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11134"></a>11134         <span class="keywordflow">return</span> pBuf;
<a name="l11135"></a>11135     }
<a name="l11136"></a>11136 
<a name="l11137"></a>11137     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11138"></a>11138 }
<a name="l11139"></a>11139 
<a name="l11140"></a>11140 
<a name="l11141"></a>11141 
<a name="l11142"></a>11142 
<a name="l11143"></a>11143 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l11144"></a>11144 <span class="comment">// Get Purse Total Value  (internally uses GetTotalValue().)</span>
<a name="l11145"></a>11145 <span class="comment">//</span>
<a name="l11146"></a>11146 <span class="comment">// Returns the purported sum of all the tokens within.</span>
<a name="l11147"></a>11147 <span class="comment">//</span>
<a name="l11148"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8be549e91a6befefc633125e2980b69e">11148</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a8be549e91a6befefc633125e2980b69e" title="Get Purse Total Value (internally uses GetTotalValue().)">OTAPI_Exec::Purse_GetTotalValue</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11149"></a>11149                                         <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11150"></a>11150                                         <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11151"></a>11151 {
<a name="l11152"></a>11152     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11153"></a>11153     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11154"></a>11154     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11155"></a>11155     <span class="comment">// -----------------------------------------------------</span>
<a name="l11156"></a>11156     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11157"></a>11157     <span class="comment">// -----------------------------------------------------</span>
<a name="l11158"></a>11158     <a class="code" href="class_o_t_string.html">OTString</a> strPurse(THE_PURSE);
<a name="l11159"></a>11159     <a class="code" href="class_o_t_purse.html">OTPurse</a>  thePurse(theServerID, theAssetTypeID);
<a name="l11160"></a>11160 
<a name="l11161"></a>11161     <span class="keywordflow">if</span> (<span class="keyword">false</span> == thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse))
<a name="l11162"></a>11162     {
<a name="l11163"></a>11163         <a class="code" href="class_o_t_string.html">OTString</a> strAssetTypeID(theAssetTypeID);
<a name="l11164"></a>11164         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading purse from string. Asset Type ID: %s\n&quot;</span>,
<a name="l11165"></a>11165             __FUNCTION__, strAssetTypeID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l11166"></a>11166         <span class="keywordflow">return</span> -1;
<a name="l11167"></a>11167     }
<a name="l11168"></a>11168     <span class="comment">// -----------------------------------------------------</span>
<a name="l11169"></a>11169     int64_t lTotalValue = 0;
<a name="l11170"></a>11170 
<a name="l11171"></a>11171     <span class="keywordflow">if</span> (thePurse.<a class="code" href="class_o_t_purse.html#a20274bcfe719e3d24450862d24fc5cfd">GetTotalValue</a>() &gt; 0)
<a name="l11172"></a>11172         lTotalValue = thePurse.<a class="code" href="class_o_t_purse.html#a20274bcfe719e3d24450862d24fc5cfd">GetTotalValue</a>();
<a name="l11173"></a>11173 
<a name="l11174"></a>11174     <span class="keywordflow">return</span> lTotalValue;
<a name="l11175"></a>11175 }
<a name="l11176"></a>11176 
<a name="l11177"></a>11177 
<a name="l11178"></a>11178 
<a name="l11179"></a>11179 <span class="comment">// ---</span>
<a name="l11180"></a>11180 
<a name="l11181"></a>11181 <span class="comment">// Returns a count of the tokens inside this purse. (Coins.)</span>
<a name="l11182"></a>11182 <span class="comment">// or -1 in case of error.</span>
<a name="l11183"></a>11183 <span class="comment">//</span>
<a name="l11184"></a><a class="code" href="class_o_t_a_p_i___exec.html#a34a956fd19fad82a197806fc87834709">11184</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a34a956fd19fad82a197806fc87834709" title="returns a count of the number of cash tokens inside this purse.">OTAPI_Exec::Purse_Count</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11185"></a>11185                                 <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11186"></a>11186                                 <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11187"></a>11187 {
<a name="l11188"></a>11188     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11189"></a>11189     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11190"></a>11190     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11191"></a>11191 
<a name="l11192"></a>11192     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11193"></a>11193                     theAssetTypeID(ASSET_TYPE_ID);
<a name="l11194"></a>11194     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11195"></a>11195     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11196"></a>11196     <a class="code" href="class_o_t_purse.html">OTPurse</a> thePurse(theServerID, theAssetTypeID);
<a name="l11197"></a>11197 
<a name="l11198"></a>11198     <span class="keywordflow">if</span> (strPurse.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse) &amp;&amp;
<a name="l11199"></a>11199         <span class="comment">// --------------------------------------</span>
<a name="l11200"></a>11200             (thePurse.<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>() == theServerID) &amp;&amp;
<a name="l11201"></a>11201             (thePurse.<a class="code" href="class_o_t_purse.html#af87e5b076d8d738e6b32e56cc49737c1">GetAssetID</a>()  == theAssetTypeID))
<a name="l11202"></a>11202     {
<a name="l11203"></a>11203         <span class="keywordflow">return</span> thePurse.<a class="code" href="class_o_t_purse.html#a6684af2c27ddb65d259f2b8cbdd6c361">Count</a>();
<a name="l11204"></a>11204     }
<a name="l11205"></a>11205 
<a name="l11206"></a>11206     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l11207"></a>11207 }
<a name="l11208"></a>11208 
<a name="l11209"></a>11209 
<a name="l11210"></a>11210 <span class="comment">// ---------</span>
<a name="l11211"></a>11211 <span class="comment">// Some purses are encrypted to a specific Nym.</span>
<a name="l11212"></a>11212 <span class="comment">// Whereas other purses are encrypted to a passphrase.</span>
<a name="l11213"></a>11213 <span class="comment">// This function returns bool and lets you know, either way.</span>
<a name="l11214"></a>11214 <span class="comment">//</span>
<a name="l11215"></a><a class="code" href="class_o_t_a_p_i___exec.html#a301c584efb3af64dc0047ae09307543a">11215</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a301c584efb3af64dc0047ae09307543a">OTAPI_Exec::Purse_HasPassword</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11216"></a>11216                                       <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11217"></a>11217 {
<a name="l11218"></a>11218     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11219"></a>11219     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11220"></a>11220 
<a name="l11221"></a>11221     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID);
<a name="l11222"></a>11222     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11223"></a>11223     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11224"></a>11224     <a class="code" href="class_o_t_purse.html">OTPurse</a> thePurse(theServerID);
<a name="l11225"></a>11225 
<a name="l11226"></a>11226     <span class="keywordflow">if</span> (strPurse.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; thePurse.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strPurse) &amp;&amp;
<a name="l11227"></a>11227         <span class="comment">// --------------------------------------</span>
<a name="l11228"></a>11228             (thePurse.<a class="code" href="class_o_t_purse.html#aa6b026618394154f1a7f80064a5e6c50">GetServerID</a>() == theServerID))
<a name="l11229"></a>11229     {
<a name="l11230"></a>11230         <span class="keywordflow">return</span> thePurse.<a class="code" href="class_o_t_purse.html#a3546f66455d223a482a462c083b5713e">IsPasswordProtected</a>();
<a name="l11231"></a>11231     }
<a name="l11232"></a>11232 
<a name="l11233"></a>11233     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11234"></a>11234 }
<a name="l11235"></a>11235 
<a name="l11236"></a>11236 
<a name="l11237"></a>11237 
<a name="l11238"></a>11238 
<a name="l11239"></a>11239 
<a name="l11240"></a>11240 <span class="comment">// returns &quot;&quot;, or a purse.</span>
<a name="l11241"></a>11241 <span class="comment">//</span>
<a name="l11242"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2bb95de55453830c7a0ccc260d5f4f35">11242</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2bb95de55453830c7a0ccc260d5f4f35">OTAPI_Exec::CreatePurse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11243"></a>11243                                 <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11244"></a>11244                                 <span class="keyword">const</span> std::string &amp; OWNER_ID,
<a name="l11245"></a>11245                                 <span class="keyword">const</span> std::string &amp; SIGNER_ID)
<a name="l11246"></a>11246 {
<a name="l11247"></a>11247     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11248"></a>11248     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11249"></a>11249     <span class="keywordflow">if</span> (OWNER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;OWNER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11250"></a>11250     <span class="keywordflow">if</span> (SIGNER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11251"></a>11251 
<a name="l11252"></a>11252     std::string strFunc = __FUNCTION__;
<a name="l11253"></a>11253 
<a name="l11254"></a>11254     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l11255"></a>11255         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11256"></a>11256         theOwnerID(OWNER_ID),
<a name="l11257"></a>11257         theSignerID(SIGNER_ID);
<a name="l11258"></a>11258     <span class="comment">// -----------------------------------------------------</span>
<a name="l11259"></a>11259     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<span class="stringliteral">&quot;Creating a cash purse. Enter wallet master password.&quot;</span>);
<a name="l11260"></a>11260     <span class="comment">// -----------------------------------------------------</span>
<a name="l11261"></a>11261     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pOwnerNym  = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(theOwnerID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData);
<a name="l11262"></a>11262     <span class="keywordflow">if</span> (NULL == pOwnerNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11263"></a>11263     <span class="comment">// -----------------------------------------------------</span>
<a name="l11264"></a>11264     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11265"></a>11265     <span class="keywordflow">if</span> (NULL == pSignerNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11266"></a>11266     <span class="comment">// By this point, pSignerNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11267"></a>11267     <span class="comment">// -----------------------------------------------------</span>
<a name="l11268"></a>11268     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a85b0d012168cd75ed3aaebd08cba2dea">CreatePurse</a>(theServerID, theAssetTypeID, theOwnerID);
<a name="l11269"></a>11269     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theAngel(pPurse);
<a name="l11270"></a>11270 
<a name="l11271"></a>11271     <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l11272"></a>11272     {
<a name="l11273"></a>11273         pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pSignerNym, &amp;thePWData);
<a name="l11274"></a>11274         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l11275"></a>11275         <span class="comment">// -------------</span>
<a name="l11276"></a>11276         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pPurse);
<a name="l11277"></a>11277         <span class="comment">// -------------</span>
<a name="l11278"></a>11278         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11279"></a>11279 
<a name="l11280"></a>11280         <span class="keywordflow">return</span> pBuf;
<a name="l11281"></a>11281     }
<a name="l11282"></a>11282     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11283"></a>11283 }
<a name="l11284"></a>11284 
<a name="l11285"></a>11285 
<a name="l11286"></a>11286 
<a name="l11287"></a>11287 
<a name="l11288"></a>11288 <span class="comment">// When we create a password-protected purse, OWNER_ID has changed to SIGNER_ID,</span>
<a name="l11289"></a>11289 <span class="comment">// since we still need a Nym to sign it (in order to save it to string.) But this</span>
<a name="l11290"></a>11290 <span class="comment">// Nym will not be the owner. There is no owner, and the tokens are not encrypted</span>
<a name="l11291"></a>11291 <span class="comment">// to any Nym (but instead to a passphrase.)</span>
<a name="l11292"></a>11292 <span class="comment">//</span>
<a name="l11293"></a>11293 <span class="comment">// returns &quot;&quot;, or a purse.</span>
<a name="l11294"></a>11294 <span class="comment">//</span>
<a name="l11295"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3fe29ca225e57260b51840a45f4d4b8b">11295</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a3fe29ca225e57260b51840a45f4d4b8b">OTAPI_Exec::CreatePurse_Passphrase</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11296"></a>11296                                           <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11297"></a>11297                                           <span class="keyword">const</span> std::string &amp; SIGNER_ID)
<a name="l11298"></a>11298 {
<a name="l11299"></a>11299     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11300"></a>11300     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11301"></a>11301     <span class="keywordflow">if</span> (SIGNER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11302"></a>11302     <span class="comment">// -----------------------------------------------------</span>
<a name="l11303"></a>11303     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>
<a name="l11304"></a>11304         theServerID(SERVER_ID),
<a name="l11305"></a>11305         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11306"></a>11306         theSignerID(SIGNER_ID);
<a name="l11307"></a>11307     <span class="comment">// -----------------------------------------------------</span>
<a name="l11308"></a>11308     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<span class="stringliteral">&quot;Creating a password-protected cash purse.&quot;</span>);
<a name="l11309"></a>11309     <span class="comment">// -----------------------------------------------------</span>
<a name="l11310"></a>11310     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerID, <span class="keyword">false</span>, __FUNCTION__, &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11311"></a>11311     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11312"></a>11312     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11313"></a>11313     <span class="comment">// -----------------------------------------------------</span>
<a name="l11314"></a>11314     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a0f580137479e85f755aadbecc85f84a0">CreatePurse_Passphrase</a>(theServerID, theAssetTypeID);
<a name="l11315"></a>11315     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> theAngel(pPurse);
<a name="l11316"></a>11316 
<a name="l11317"></a>11317     <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l11318"></a>11318     {
<a name="l11319"></a>11319         pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym, &amp;thePWData);
<a name="l11320"></a>11320         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l11321"></a>11321         <span class="comment">// -------------</span>
<a name="l11322"></a>11322         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pPurse);
<a name="l11323"></a>11323         <span class="comment">// -------------</span>
<a name="l11324"></a>11324         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11325"></a>11325 
<a name="l11326"></a>11326         <span class="keywordflow">return</span> pBuf;
<a name="l11327"></a>11327     }
<a name="l11328"></a>11328     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11329"></a>11329 }
<a name="l11330"></a>11330 
<a name="l11331"></a>11331 
<a name="l11332"></a>11332 
<a name="l11333"></a>11333 
<a name="l11334"></a>11334 <span class="comment">// Returns the TOKEN on top of the stock (LEAVING it on top of the stack,</span>
<a name="l11335"></a>11335 <span class="comment">// but giving you a decrypted string copy of it.)</span>
<a name="l11336"></a>11336 <span class="comment">//</span>
<a name="l11337"></a>11337 <span class="comment">// OWNER_ID can be &quot;&quot;, **if** the purse is password-protected.</span>
<a name="l11338"></a>11338 <span class="comment">// (It&#39;s just ignored in that case.) Otherwise MUST contain the NymID for</span>
<a name="l11339"></a>11339 <span class="comment">// the Purse owner (necessary to decrypt the token.)</span>
<a name="l11340"></a>11340 <span class="comment">//</span>
<a name="l11341"></a>11341 <span class="comment">// returns &quot;&quot; if failure.</span>
<a name="l11342"></a>11342 <span class="comment">//</span>
<a name="l11343"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8c71857a2fbfc51e6c6dc571fe27054c">11343</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8c71857a2fbfc51e6c6dc571fe27054c">OTAPI_Exec::Purse_Peek</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11344"></a>11344                               <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11345"></a>11345                               <span class="keyword">const</span> std::string &amp; OWNER_ID, <span class="comment">// This should be &quot;&quot;, **IF** purse is password-protected. Otherwise MUST contain the NymID for the Purse owner (necessary to decrypt the token.)</span>
<a name="l11346"></a>11346                               <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11347"></a>11347 {
<a name="l11348"></a>11348     <a class="code" href="class_o_t_string.html">OTString</a> strOutput; <span class="comment">// for later.</span>
<a name="l11349"></a>11349 
<a name="l11350"></a>11350     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11351"></a>11351     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11352"></a>11352     <span class="comment">//if (OWNER_ID.empty())         { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;OWNER_ID&quot;           ); OT_FAIL; }</span>
<a name="l11353"></a>11353     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11354"></a>11354 
<a name="l11355"></a>11355     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11356"></a>11356     std::string strFunc = __FUNCTION__; <span class="comment">//&quot;OTAPI_Exec::Purse_Peek&quot;;</span>
<a name="l11357"></a>11357     <span class="comment">// -----------------------------------------------------</span>
<a name="l11358"></a>11358     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(<span class="stringliteral">&quot;Peeking at cash purse contents.&quot;</span>);
<a name="l11359"></a>11359     <span class="comment">// -----------------------------------</span>
<a name="l11360"></a>11360     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bDoesOwnerIDExist = ((<span class="stringliteral">&quot;&quot;</span> != OWNER_ID) &amp;&amp; (<span class="charliteral">&#39;\0&#39;</span> != OWNER_ID[0])); <span class="comment">// If bDoesOwnerIDExist is not true, then the purse MUST be password-protected.</span>
<a name="l11361"></a>11361     <span class="comment">// -----------------------------------</span>
<a name="l11362"></a>11362     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOwnerID;
<a name="l11363"></a>11363     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = NULL;
<a name="l11364"></a>11364     <span class="keywordflow">if</span> (bDoesOwnerIDExist)
<a name="l11365"></a>11365     {
<a name="l11366"></a>11366         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOwnerID(OWNER_ID);
<a name="l11367"></a>11367 
<a name="l11368"></a>11368         <span class="keywordflow">if</span> (strOwnerID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l11369"></a>11369         {
<a name="l11370"></a>11370             theOwnerID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(strOwnerID);
<a name="l11371"></a>11371             pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theOwnerID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11372"></a>11372         }
<a name="l11373"></a>11373         <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11374"></a>11374     }
<a name="l11375"></a>11375     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11376"></a>11376     <span class="comment">// -----------------------------------------------------</span>
<a name="l11377"></a>11377     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11378"></a>11378         theAssetTypeID(ASSET_TYPE_ID);
<a name="l11379"></a>11379     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11380"></a>11380     <span class="comment">// -----------------------------------------------------</span>
<a name="l11381"></a>11381     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ac4922a16395e2da553cf4f0bd0fdaf62">Purse_Peek</a>(theServerID, theAssetTypeID,
<a name="l11382"></a>11382         strPurse,
<a name="l11383"></a>11383         bDoesOwnerIDExist ? &amp;theOwnerID : NULL,
<a name="l11384"></a>11384         NULL);
<a name="l11385"></a>11385     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11386"></a>11386     <span class="comment">// -----------------------------------------------------</span>
<a name="l11387"></a>11387     <span class="keywordflow">if</span> (NULL != pToken)
<a name="l11388"></a>11388     {
<a name="l11389"></a>11389         pToken-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
<a name="l11390"></a>11390 
<a name="l11391"></a>11391         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11392"></a>11392 
<a name="l11393"></a>11393         <span class="keywordflow">return</span> pBuf;
<a name="l11394"></a>11394     }
<a name="l11395"></a>11395     <span class="keywordflow">else</span>
<a name="l11396"></a>11396         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed peeking at a token on a cash purse.\n&quot;</span>, strFunc.c_str());
<a name="l11397"></a>11397 
<a name="l11398"></a>11398     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11399"></a>11399 }
<a name="l11400"></a>11400 
<a name="l11401"></a>11401 
<a name="l11402"></a>11402 
<a name="l11403"></a>11403 <span class="comment">// Removes the token from the top of the stock and DESTROYS IT,</span>
<a name="l11404"></a>11404 <span class="comment">// and RETURNS THE UPDATED PURSE (with the token now missing from it.)</span>
<a name="l11405"></a>11405 <span class="comment">//</span>
<a name="l11406"></a>11406 <span class="comment">// WARNING: Do not call this function unless you have PEEK()d FIRST!!</span>
<a name="l11407"></a>11407 <span class="comment">// Otherwise you will lose the token and get left &quot;holding the bag&quot;.</span>
<a name="l11408"></a>11408 <span class="comment">//</span>
<a name="l11409"></a>11409 <span class="comment">// returns &quot;&quot; if failure.</span>
<a name="l11410"></a>11410 <span class="comment">//</span>
<a name="l11411"></a><a class="code" href="class_o_t_a_p_i___exec.html#acc9c33a32376d1d8ea0cd64920905966">11411</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#acc9c33a32376d1d8ea0cd64920905966">OTAPI_Exec::Purse_Pop</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11412"></a>11412                              <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11413"></a>11413                              <span class="keyword">const</span> std::string &amp; OWNER_OR_SIGNER_ID, <span class="comment">// The purse, in order to be changed, must be re-signed, which requires a private Nym. If the purse is password-protected, then there&#39;s no owner, but you still need to pass a Nym in here to sign it (doesn&#39;t really matter which one, as long as the private key is available, for signing.) In that case, he&#39;s the signer. But if the purse DOES have a Nym owner, then you MUST pass the owner&#39;s Nym ID here, in order for this action to be successful. (Because we must be able to load the private key for that Nym, in order to perform the pop. In which case we might as well use the same Nym for signing...)</span>
<a name="l11414"></a>11414                              <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11415"></a>11415 {
<a name="l11416"></a>11416     <a class="code" href="class_o_t_string.html">OTString</a> strOutput; <span class="comment">// for later.</span>
<a name="l11417"></a>11417 
<a name="l11418"></a>11418     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11419"></a>11419     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11420"></a>11420     <span class="keywordflow">if</span> (OWNER_OR_SIGNER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;OWNER_OR_SIGNER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11421"></a>11421     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11422"></a>11422 
<a name="l11423"></a>11423     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11424"></a>11424     std::string strFunc = __FUNCTION__; <span class="comment">//&quot;OTAPI_Exec::Purse_Pop&quot;;</span>
<a name="l11425"></a>11425     <span class="comment">// -----------------------------------------------------</span>
<a name="l11426"></a>11426     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason(<span class="stringliteral">&quot;Popping a token off of a cash purse.&quot;</span>);
<a name="l11427"></a>11427     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(strReason);
<a name="l11428"></a>11428     <span class="comment">// -----------------------------------</span>
<a name="l11429"></a>11429     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11430"></a>11430         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11431"></a>11431         theNymID(OWNER_OR_SIGNER_ID);
<a name="l11432"></a>11432     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11433"></a>11433     <span class="comment">// -----------------------------------------------------</span>
<a name="l11434"></a>11434     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theNymID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11435"></a>11435     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11436"></a>11436     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11437"></a>11437     <span class="comment">// -----------------------------------------------------</span>
<a name="l11438"></a>11438     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a71b132b76b09ced31829d59348aa6a08">Purse_Pop</a>(theServerID, theAssetTypeID,
<a name="l11439"></a>11439         strPurse,
<a name="l11440"></a>11440         &amp;theNymID, <span class="comment">// Note: if the purse is password-protected, then this parameter is ignored.</span>
<a name="l11441"></a>11441         &amp;strReason);
<a name="l11442"></a>11442     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse);
<a name="l11443"></a>11443     <span class="comment">// -----------------------------------------------------</span>
<a name="l11444"></a>11444     <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l11445"></a>11445     {
<a name="l11446"></a>11446         pPurse-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l11447"></a>11447         pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym, &amp;thePWData);
<a name="l11448"></a>11448         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l11449"></a>11449 
<a name="l11450"></a>11450         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
<a name="l11451"></a>11451         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11452"></a>11452 
<a name="l11453"></a>11453         <span class="keywordflow">return</span> pBuf;
<a name="l11454"></a>11454     }
<a name="l11455"></a>11455     <span class="keywordflow">else</span>
<a name="l11456"></a>11456         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed popping a token off of a cash purse.\n&quot;</span>, strFunc.c_str());
<a name="l11457"></a>11457 
<a name="l11458"></a>11458     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11459"></a>11459 }
<a name="l11460"></a>11460 
<a name="l11461"></a>11461 
<a name="l11462"></a>11462 
<a name="l11463"></a>11463 <span class="comment">// Makes an exact copy of a purse, except with no tokens inside. (Value of zero.)</span>
<a name="l11464"></a>11464 <span class="comment">// Useful when you need to create a temporary purse for moving tokens around, and</span>
<a name="l11465"></a>11465 <span class="comment">// you don&#39;t want some new symmetric/master key being generated for that purse as</span>
<a name="l11466"></a>11466 <span class="comment">// though it were really some new &quot;other purse.&quot;</span>
<a name="l11467"></a>11467 <span class="comment">// For example, if you have a password-protected purse, you might want to pop all of</span>
<a name="l11468"></a>11468 <span class="comment">// the tokens off of it, and as you iterate, re-assign half of them to new ownership,</span>
<a name="l11469"></a>11469 <span class="comment">// push those onto a new purse owned by that new owner. But you only want to do this</span>
<a name="l11470"></a>11470 <span class="comment">// with half of the tokens... the other half of the tokens, you just want to push onto</span>
<a name="l11471"></a>11471 <span class="comment">// a temp purse (for the loop) that&#39;s owned by the original owner, so you can then save</span>
<a name="l11472"></a>11472 <span class="comment">// it back over the original in storage (since it contains &quot;all the tokens that WEREN&#39;T</span>
<a name="l11473"></a>11473 <span class="comment">// deposited&quot; or &quot;all the tokens that WEREN&#39;T exported&quot; etc.</span>
<a name="l11474"></a>11474 <span class="comment">//</span>
<a name="l11475"></a>11475 <span class="comment">// The point? If the &quot;original owner&quot; is a password-protected purse with a symmetric</span>
<a name="l11476"></a>11476 <span class="comment">// key, then you can&#39;t just generate some new &quot;temp purse&quot; without also generating a</span>
<a name="l11477"></a>11477 <span class="comment">// whole new KEY, which you DO NOT want to do. You also don&#39;t want to have to deal with</span>
<a name="l11478"></a>11478 <span class="comment">// re-assigning ownership back and forth between the two purses -- you just want to</span>
<a name="l11479"></a>11479 <span class="comment">// shove some tokens into one temporarily so you can finish your loop.</span>
<a name="l11480"></a>11480 <span class="comment">// You could take the original purse and make a copy of it, and then just pop all the</span>
<a name="l11481"></a>11481 <span class="comment">// tokens off of it one-by-one, but that is very cumbersome and expensive. But that&#39;d</span>
<a name="l11482"></a>11482 <span class="comment">// be the only way to get a copy of the original purse with the SAME symmetric key,</span>
<a name="l11483"></a>11483 <span class="comment">// except empty, so you can use it as a temp purse.</span>
<a name="l11484"></a>11484 <span class="comment">// Therefore, to make that easier and solve that whole dilemma, I present: OTAPI_Exec::Purse_Empty.</span>
<a name="l11485"></a>11485 <span class="comment">// OTAPI_Exec::Purse_Empty takes a purse and returns an empty version of it (except if there&#39;s</span>
<a name="l11486"></a>11486 <span class="comment">// a symmetric/master key inside, those are preserved, so you can use it as a temp purse.)</span>
<a name="l11487"></a>11487 <span class="comment">//</span>
<a name="l11488"></a>11488 <span class="comment">// This function is effectively the same thing as calling Pop until the purse is empty.</span>
<a name="l11489"></a>11489 <span class="comment">// Returns: the empty purse, or &quot;&quot; if failure.</span>
<a name="l11490"></a>11490 <span class="comment">//</span>
<a name="l11491"></a><a class="code" href="class_o_t_a_p_i___exec.html#a701509c4d9b817d3beca03bc1cbe6d99">11491</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a701509c4d9b817d3beca03bc1cbe6d99">OTAPI_Exec::Purse_Empty</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11492"></a>11492                                 <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11493"></a>11493                                 <span class="keyword">const</span> std::string &amp; SIGNER_ID,
<a name="l11494"></a>11494                                 <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11495"></a>11495 {
<a name="l11496"></a>11496     <a class="code" href="class_o_t_string.html">OTString</a> strOutput; <span class="comment">// for later.</span>
<a name="l11497"></a>11497 
<a name="l11498"></a>11498     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11499"></a>11499     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11500"></a>11500     <span class="keywordflow">if</span> (SIGNER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11501"></a>11501     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11502"></a>11502 
<a name="l11503"></a>11503     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11504"></a>11504     std::string strFunc = __FUNCTION__; <span class="comment">//&quot;OTAPI_Exec::Purse_Empty&quot;;</span>
<a name="l11505"></a>11505     <span class="comment">// -----------------------------------------------------</span>
<a name="l11506"></a>11506     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason(<span class="stringliteral">&quot;Creating an empty copy of a cash purse.&quot;</span>);
<a name="l11507"></a>11507     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(strReason);
<a name="l11508"></a>11508     <span class="comment">// -----------------------------------</span>
<a name="l11509"></a>11509     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11510"></a>11510         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11511"></a>11511         theNymID(SIGNER_ID);
<a name="l11512"></a>11512     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE);
<a name="l11513"></a>11513     <span class="comment">// -----------------------------------------------------</span>
<a name="l11514"></a>11514     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theNymID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11515"></a>11515     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11516"></a>11516     <span class="comment">// By this point, pNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11517"></a>11517     <span class="comment">// -----------------------------------------------------</span>
<a name="l11518"></a>11518     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#adc667ad801925aaddd138f0dd7d0770e">Purse_Empty</a>(theServerID, theAssetTypeID, strPurse, &amp;strReason);
<a name="l11519"></a>11519     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse);
<a name="l11520"></a>11520     <span class="comment">// -----------------------------------------------------</span>
<a name="l11521"></a>11521     <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l11522"></a>11522     {
<a name="l11523"></a>11523         pPurse-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l11524"></a>11524         pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pNym, &amp;thePWData);
<a name="l11525"></a>11525         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l11526"></a>11526 
<a name="l11527"></a>11527         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
<a name="l11528"></a>11528         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11529"></a>11529 
<a name="l11530"></a>11530         <span class="keywordflow">return</span> pBuf;
<a name="l11531"></a>11531     }
<a name="l11532"></a>11532     <span class="keywordflow">else</span>
<a name="l11533"></a>11533         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed emptying a cash purse.\n&quot;</span>, strFunc.c_str());
<a name="l11534"></a>11534 
<a name="l11535"></a>11535     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11536"></a>11536 
<a name="l11537"></a>11537 }
<a name="l11538"></a>11538 
<a name="l11539"></a>11539 
<a name="l11540"></a>11540 <span class="comment">// Pushes a token onto the stack (of the purse.)</span>
<a name="l11541"></a>11541 <span class="comment">// Returns the updated purse (now including the token.)</span>
<a name="l11542"></a>11542 <span class="comment">//</span>
<a name="l11543"></a>11543 <span class="comment">// Returns &quot;&quot; if failure.</span>
<a name="l11544"></a>11544 <span class="comment">//</span>
<a name="l11545"></a><a class="code" href="class_o_t_a_p_i___exec.html#a84cb52e90c17386b9d829cc19b9ec7fe">11545</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a84cb52e90c17386b9d829cc19b9ec7fe">OTAPI_Exec::Purse_Push</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11546"></a>11546                               <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11547"></a>11547                               <span class="keyword">const</span> std::string &amp; SIGNER_ID, <span class="comment">// The purse, in order to be changed, must be re-signed, which requires a private Nym. Even if the purse is password-protected, then there&#39;s no owner, but you still need to pass a Nym in here to sign it (doesn&#39;t really matter which one, but must have private key for signing.)</span>
<a name="l11548"></a>11548                               <span class="keyword">const</span> std::string &amp; OWNER_ID, <span class="comment">// If the purse is password-protected, then there&#39;s no owner, and this owner parameter should be &quot;&quot;. However, if the purse DOES have a Nym owner, then you MUST pass the owner&#39;s Nym ID here, in order for this action to be successful. Furthermore, the public key for that Nym must be available, in order to encrypt the token being pushed into the purse. (Private key NOT necessary for owner, in this case.) If this fails due to public key not being available, just download it from the server and try again.</span>
<a name="l11549"></a>11549                               <span class="keyword">const</span> std::string &amp; THE_PURSE,
<a name="l11550"></a>11550                               <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11551"></a>11551 {
<a name="l11552"></a>11552     <a class="code" href="class_o_t_string.html">OTString</a> strOutput; <span class="comment">// for later.</span>
<a name="l11553"></a>11553 
<a name="l11554"></a>11554     <span class="keywordflow">if</span> (SERVER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11555"></a>11555     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11556"></a>11556     <span class="keywordflow">if</span> (SIGNER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11557"></a>11557 <span class="comment">//  if (OWNER_ID.empty())       { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;OWNER_ID&quot;      ); OT_FAIL; }</span>
<a name="l11558"></a>11558     <span class="keywordflow">if</span> (THE_PURSE.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11559"></a>11559     <span class="keywordflow">if</span> (THE_TOKEN.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11560"></a>11560 
<a name="l11561"></a>11561     <span class="comment">// -------------------------------------------------------------</span>
<a name="l11562"></a>11562     std::string strFunc = __FUNCTION__; <span class="comment">//&quot;OTAPI_Exec::Purse_Push&quot;;</span>
<a name="l11563"></a>11563     <span class="comment">// -----------------------------------------------------</span>
<a name="l11564"></a>11564     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strReason(<span class="stringliteral">&quot;Pushing a token onto a cash purse.&quot;</span>);
<a name="l11565"></a>11565     <a class="code" href="class_o_t_password_data.html">OTPasswordData</a> thePWData(strReason);
<a name="l11566"></a>11566     <span class="comment">// -----------------------------------</span>
<a name="l11567"></a>11567     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bDoesOwnerIDExist = ((<span class="stringliteral">&quot;&quot;</span> != OWNER_ID) &amp;&amp; (<span class="charliteral">&#39;\0&#39;</span> != OWNER_ID[0])); <span class="comment">// If bDoesOwnerIDExist is not true, then the purse MUST be password-protected.</span>
<a name="l11568"></a>11568     <span class="comment">// -----------------------------------</span>
<a name="l11569"></a>11569     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theOwnerID;
<a name="l11570"></a>11570     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pOwnerNym = NULL;
<a name="l11571"></a>11571     <span class="keywordflow">if</span> (bDoesOwnerIDExist)
<a name="l11572"></a>11572     {
<a name="l11573"></a>11573         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOwnerID(OWNER_ID);
<a name="l11574"></a>11574 
<a name="l11575"></a>11575         <span class="keywordflow">if</span> (strOwnerID.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l11576"></a>11576         {
<a name="l11577"></a>11577             theOwnerID.<a class="code" href="class_o_t_identifier.html#ae29aa1245d3831a207aabc9b8a493bfc">SetString</a>(strOwnerID);
<a name="l11578"></a>11578             pOwnerNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa09f3af30f4bc451d56c6948d536922f">GetOrLoadNym</a>(theOwnerID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11579"></a>11579         }
<a name="l11580"></a>11580         <span class="keywordflow">if</span> (NULL == pOwnerNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11581"></a>11581     }
<a name="l11582"></a>11582     <span class="comment">// By this point, pOwnerNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11583"></a>11583     <span class="comment">// -----------------------------------------------------</span>
<a name="l11584"></a>11584     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l11585"></a>11585         theAssetTypeID(ASSET_TYPE_ID);
<a name="l11586"></a>11586     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>     strPurse(THE_PURSE), strToken(THE_TOKEN);
<a name="l11587"></a>11587     <span class="comment">// -----------------------------------------------------</span>
<a name="l11588"></a>11588     <a class="code" href="class_o_t_purse.html">OTPurse</a> * pPurse = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a480eef589ef3fd1f416930540e46082f">Purse_Push</a>(theServerID, theAssetTypeID,
<a name="l11589"></a>11589         strPurse, strToken,
<a name="l11590"></a>11590         bDoesOwnerIDExist ? &amp;theOwnerID : NULL, <span class="comment">// Note: if the purse is password-protected, then this parameter should be &quot;&quot;.</span>
<a name="l11591"></a>11591         &amp;strReason);
<a name="l11592"></a>11592     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTPurse&gt;</a> thePurseAngel(pPurse);
<a name="l11593"></a>11593     <span class="comment">// -----------------------------------------------------</span>
<a name="l11594"></a>11594     <span class="keywordflow">if</span> (NULL != pPurse)
<a name="l11595"></a>11595     {
<a name="l11596"></a>11596         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theSignerID(SIGNER_ID);
<a name="l11597"></a>11597         <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pSignerNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theSignerID, <span class="keyword">false</span>, strFunc.c_str(), &amp;thePWData); <span class="comment">// These copiously log, and ASSERT.</span>
<a name="l11598"></a>11598         <span class="keywordflow">if</span> (NULL == pSignerNym) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11599"></a>11599         <span class="comment">// By this point, pSignerNym is a good pointer, and is on the wallet. (No need to cleanup.)</span>
<a name="l11600"></a>11600         <span class="comment">// -----------------------------------------------------</span>
<a name="l11601"></a>11601         pPurse-&gt;<a class="code" href="class_o_t_contract.html#aae54340526fbd8eb8a18de27a4b97c83">ReleaseSignatures</a>();
<a name="l11602"></a>11602         pPurse-&gt;<a class="code" href="class_o_t_contract.html#abd60037fe655ee8cae9a3ece5d1e2ea6">SignContract</a>(*pSignerNym, &amp;thePWData);
<a name="l11603"></a>11603         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a363ae430d4fd9256ab8364dbafb95444">SaveContract</a>();
<a name="l11604"></a>11604 
<a name="l11605"></a>11605         pPurse-&gt;<a class="code" href="class_o_t_contract.html#a5fd00cded794a6f96ba80d8d4081d591">SaveContractRaw</a>(strOutput);
<a name="l11606"></a>11606         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11607"></a>11607 
<a name="l11608"></a>11608         <span class="keywordflow">return</span> pBuf;
<a name="l11609"></a>11609     }
<a name="l11610"></a>11610     <span class="keywordflow">else</span>
<a name="l11611"></a>11611         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failed pushing a token onto a cash purse.\n&quot;</span>, strFunc.c_str());
<a name="l11612"></a>11612 
<a name="l11613"></a>11613     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11614"></a>11614 
<a name="l11615"></a>11615 }
<a name="l11616"></a>11616 
<a name="l11617"></a>11617 
<a name="l11618"></a>11618 <span class="comment">// ------------------</span>
<a name="l11619"></a>11619 
<a name="l11620"></a>11620 
<a name="l11621"></a>11621 <span class="comment">//</span>
<a name="l11622"></a>11622 <span class="comment">// Returns bool</span>
<a name="l11623"></a>11623 <span class="comment">// Should handle duplicates. Should load, merge, and save.</span>
<a name="l11624"></a>11624 <span class="comment">//</span>
<a name="l11625"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3c0090685d45d8d765eef17619afa089">11625</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a3c0090685d45d8d765eef17619afa089" title="Should handle duplicates. Should load, merge, and save.">OTAPI_Exec::Wallet_ImportPurse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11626"></a>11626                                  <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11627"></a>11627                                  <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l11628"></a>11628                                   <span class="comment">// -----------------------</span>
<a name="l11629"></a>11629                                  <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11630"></a>11630 {
<a name="l11631"></a>11631     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11632"></a>11632     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11633"></a>11633     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11634"></a>11634     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11635"></a>11635 
<a name="l11636"></a>11636     <span class="comment">// -----------------------------------------------------</span>
<a name="l11637"></a>11637     std::string strFunc = __FUNCTION__; <span class="comment">//&quot;OTAPI_Exec::Wallet_ImportPurse&quot;;</span>
<a name="l11638"></a>11638     <span class="comment">// -----------------------------------------------------</span>
<a name="l11639"></a>11639     <a class="code" href="class_o_t_string.html">OTString</a> strReason(<span class="stringliteral">&quot;Importing a cash purse into the wallet.&quot;</span>);
<a name="l11640"></a>11640     <span class="comment">//  OTPasswordData thePWData(strReason);</span>
<a name="l11641"></a>11641     <span class="comment">// -----------------------------------------------------</span>
<a name="l11642"></a>11642     <span class="keyword">const</span>
<a name="l11643"></a>11643         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID), theUserID(USER_ID);
<a name="l11644"></a>11644     <span class="keyword">const</span>
<a name="l11645"></a>11645         <a class="code" href="class_o_t_string.html">OTString</a>      strNewPurse(THE_PURSE);
<a name="l11646"></a>11646     <span class="comment">// -----------------------------------------------------</span>
<a name="l11647"></a>11647     <span class="comment">// THE_PURSE (the new purse) either is for a Nym, or a Symmetric Key.</span>
<a name="l11648"></a>11648     <span class="comment">// If it&#39;s for a Nym, it either has a NymID, or the ID is left blank.</span>
<a name="l11649"></a>11649     <span class="comment">//</span>
<a name="l11650"></a>11650     <span class="comment">// This call already logs on failure, so I won&#39;t bother logging again here.</span>
<a name="l11651"></a>11651     <span class="comment">//</span>
<a name="l11652"></a>11652     <a class="code" href="class_o_t_string.html">OTString</a> strDisplay(<span class="stringliteral">&quot;&quot;</span>);
<a name="l11653"></a>11653 
<a name="l11654"></a>11654     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bImported = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a4b5282e8670208c395d3ab98a9a2a315">Wallet_ImportPurse</a>(theServerID, theAssetTypeID, theUserID,
<a name="l11655"></a>11655         strNewPurse, &amp;strDisplay);
<a name="l11656"></a>11656     <span class="comment">// --------------------------------------------------------------</span>
<a name="l11657"></a>11657     <span class="keywordflow">return</span> bImported ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l11658"></a>11658 }
<a name="l11659"></a>11659 
<a name="l11660"></a>11660 
<a name="l11661"></a>11661 
<a name="l11662"></a>11662 
<a name="l11663"></a>11663 
<a name="l11664"></a>11664 
<a name="l11665"></a>11665 
<a name="l11666"></a>11666 
<a name="l11667"></a>11667 
<a name="l11668"></a>11668 
<a name="l11669"></a>11669 
<a name="l11670"></a>11670 
<a name="l11671"></a>11671 <span class="comment">// TODO:!!!!!  NEW!!!!!</span>
<a name="l11672"></a>11672 
<a name="l11673"></a>11673 <span class="comment">// Messages the server. If failure, make sure you didn&#39;t lose that purse!!</span>
<a name="l11674"></a>11674 <span class="comment">// If success, the new tokens will be returned shortly and saved into the appropriate purse.</span>
<a name="l11675"></a>11675 <span class="comment">// Note that an asset account isn&#39;t necessary to do this... just a nym operating cash-only.</span>
<a name="l11676"></a>11676 <span class="comment">// The same as exchanging a 20-dollar bill at the teller window for a replacement bill.</span>
<a name="l11677"></a>11677 <span class="comment">//</span>
<a name="l11678"></a>11678 <span class="comment">// You could also have a webpage operated by the transaction server, where a dummy nym</span>
<a name="l11679"></a>11679 <span class="comment">// performs cash exchanges using a single page with a text area (for copying and pasting</span>
<a name="l11680"></a>11680 <span class="comment">// cash tokens.) This way all cash token exchanges can go through the same Nym. (Although</span>
<a name="l11681"></a>11681 <span class="comment">// it must be stressed, that the cash is untraceable whether you use your own Nym or not.)</span>
<a name="l11682"></a>11682 <span class="comment">//</span>
<a name="l11683"></a>11683 <span class="comment">// Returns int32_t:</span>
<a name="l11684"></a>11684 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l11685"></a>11685 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l11686"></a>11686 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l11687"></a>11687 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l11688"></a>11688 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l11689"></a>11689 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l11690"></a>11690 <span class="comment">//</span>
<a name="l11691"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2152b86656a453a48c270fa3c0154884">11691</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a2152b86656a453a48c270fa3c0154884">OTAPI_Exec::exchangePurse</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11692"></a>11692                                   <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11693"></a>11693                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l11694"></a>11694                                   <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l11695"></a>11695 {
<a name="l11696"></a>11696     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11697"></a>11697     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11698"></a>11698     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11699"></a>11699     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11700"></a>11700 
<a name="l11701"></a>11701     <span class="comment">// todo:  exchange message.</span>
<a name="l11702"></a>11702     <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: TODO (NOT CODED YET) OTAPI_Exec::exchangePurse: SERVER_ID: %s\n ASSET_TYPE_ID: %s\n USER_ID: %s\n &quot;</span>, __FUNCTION__, SERVER_ID.c_str(), ASSET_TYPE_ID.c_str(), USER_ID.c_str());
<a name="l11703"></a>11703 
<a name="l11704"></a>11704     <span class="keywordflow">return</span> -1;
<a name="l11705"></a>11705 }
<a name="l11706"></a>11706 
<a name="l11707"></a>11707 
<a name="l11708"></a>11708 
<a name="l11709"></a>11709 
<a name="l11710"></a>11710 
<a name="l11711"></a>11711 
<a name="l11712"></a>11712 <span class="comment">// the GUI needs to be able to export cash from one Nym to another,</span>
<a name="l11713"></a>11713 <span class="comment">// so a function has been provided for doing so to the actual Token IDs (not just the purse.</span>
<a name="l11714"></a>11714 <span class="comment">// Understand that even when you decrypt a token out of a purse, the token ID itself is still</span>
<a name="l11715"></a>11715 <span class="comment">// encrypted within that token. That is what this function is for.</span>
<a name="l11716"></a>11716 <span class="comment">//</span>
<a name="l11717"></a>11717 <span class="comment">// returns: the updated token itself in string form.</span>
<a name="l11718"></a>11718 <span class="comment">//</span>
<a name="l11719"></a>11719 
<a name="l11720"></a>11720 <span class="comment">//</span>
<a name="l11721"></a>11721 <span class="comment">// ALLOW the caller to pass a symmetric key here, instead of either Nym ID.</span>
<a name="l11722"></a>11722 <span class="comment">// We&#39;ll load it up and use it instead of a Nym. Update: make that a purse.</span>
<a name="l11723"></a>11723 <span class="comment">// These tokens already beint64_t to specific purses, so just pass the purse here</span>
<a name="l11724"></a>11724 <span class="comment">//</span>
<a name="l11725"></a>11725 <span class="comment">// Done: Also, add a key cache with a timeout (similar to Master Key) where we can stash</span>
<a name="l11726"></a>11726 <span class="comment">// any already-loaded symmetric keys, and a thread wipes them out later. That way</span>
<a name="l11727"></a>11727 <span class="comment">// even if we have to load the key each time this func is called, we still avoid the</span>
<a name="l11728"></a>11728 <span class="comment">// user having to enter the passphrase more than once per timeout period.</span>
<a name="l11729"></a>11729 <span class="comment">//</span>
<a name="l11730"></a>11730 <span class="comment">// Done also: allow a &quot;Signer ID&quot; to be passed in here, since either Nym could potentially</span>
<a name="l11731"></a>11731 <span class="comment">// now be a symmetric key.</span>
<a name="l11732"></a>11732 
<a name="l11733"></a><a class="code" href="class_o_t_a_p_i___exec.html#a69c71e95a4ef9eb2bb19937618735fbe">11733</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a69c71e95a4ef9eb2bb19937618735fbe">OTAPI_Exec::Token_ChangeOwner</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11734"></a>11734                                      <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11735"></a>11735                                      <span class="keyword">const</span> std::string &amp; THE_TOKEN,
<a name="l11736"></a>11736                                      <span class="keyword">const</span> std::string &amp; SIGNER_NYM_ID,
<a name="l11737"></a>11737                                      <span class="keyword">const</span> std::string &amp; OLD_OWNER, <span class="comment">// Pass a NymID here, or a purse.</span>
<a name="l11738"></a>11738                                      <span class="keyword">const</span> std::string &amp; NEW_OWNER) <span class="comment">// Pass a NymID here, or a purse.</span>
<a name="l11739"></a>11739 {
<a name="l11740"></a>11740     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11741"></a>11741     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11742"></a>11742     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11743"></a>11743     <span class="keywordflow">if</span> (SIGNER_NYM_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SIGNER_NYM_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11744"></a>11744     <span class="keywordflow">if</span> (OLD_OWNER.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;OLD_OWNER&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11745"></a>11745     <span class="keywordflow">if</span> (NEW_OWNER.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;NEW_OWNER&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11746"></a>11746 
<a name="l11747"></a>11747     <span class="comment">// -----------------------------------------------------</span>
<a name="l11748"></a>11748     std::string strFunc = __FUNCTION__; <span class="comment">//OTAPI_Exec::Token_ChangeOwner</span>
<a name="l11749"></a>11749     <span class="comment">// -----------------------------------------------------</span>
<a name="l11750"></a>11750     <span class="keyword">const</span>
<a name="l11751"></a>11751         <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID),
<a name="l11752"></a>11752         theAssetTypeID(ASSET_TYPE_ID),
<a name="l11753"></a>11753         theSignerNymID(SIGNER_NYM_ID);
<a name="l11754"></a>11754     <span class="comment">// -----------------------------------------------------</span>
<a name="l11755"></a>11755     <span class="keyword">const</span>
<a name="l11756"></a>11756         <a class="code" href="class_o_t_string.html">OTString</a>      strOldOwner(OLD_OWNER), <span class="comment">// Either of these MIGHT contain a Nym ID, OR might contain a purse...</span>
<a name="l11757"></a>11757         strNewOwner(NEW_OWNER); <span class="comment">// (purse is passed in cases where the token is encrypted with a passphrase aka symmetric crypto, versus being encrypted to a Nym&#39;s public key.)</span>
<a name="l11758"></a>11758     <span class="comment">// -----------------------------------------------------</span>
<a name="l11759"></a>11759     <a class="code" href="class_o_t_string.html">OTString</a>      strToken   (THE_TOKEN);
<a name="l11760"></a>11760     <span class="comment">// -----------------------------------------------------</span>
<a name="l11761"></a>11761     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7183d283456ab1e13c01f88b71062828">Token_ChangeOwner</a>(theServerID, theAssetTypeID,
<a name="l11762"></a>11762         strToken, theSignerNymID,
<a name="l11763"></a>11763         strOldOwner,  <span class="comment">// Pass a NymID here as a string, or a purse. (IF symmetrically encrypted, the relevant key is in the purse.)</span>
<a name="l11764"></a>11764         strNewOwner); <span class="comment">// Pass a NymID here as a string, or a purse. (IF symmetrically encrypted, the relevant key is in the purse.)</span>
<a name="l11765"></a>11765     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11766"></a>11766     <span class="comment">// -----------------------------------------------------</span>
<a name="l11767"></a>11767     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// Success!</span>
<a name="l11768"></a>11768     {
<a name="l11769"></a>11769         <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pToken);
<a name="l11770"></a>11770 
<a name="l11771"></a>11771         std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11772"></a>11772 
<a name="l11773"></a>11773         <span class="keywordflow">return</span> pBuf;
<a name="l11774"></a>11774     }
<a name="l11775"></a>11775 
<a name="l11776"></a>11776     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l11777"></a>11777 }
<a name="l11778"></a>11778 
<a name="l11779"></a>11779 
<a name="l11780"></a>11780 <span class="comment">// --------------</span>
<a name="l11781"></a>11781 
<a name="l11782"></a>11782 
<a name="l11783"></a>11783 <span class="comment">// Returns an encrypted form of the actual blinded token ID.</span>
<a name="l11784"></a>11784 <span class="comment">// (There&#39;s no need to decrypt the ID until redeeming the token, when</span>
<a name="l11785"></a>11785 <span class="comment">// you re-encrypt it to the server&#39;s public key, or until spending it,</span>
<a name="l11786"></a>11786 <span class="comment">// when you re-encrypt it to the recipient&#39;s public key, or exporting</span>
<a name="l11787"></a>11787 <span class="comment">// it, when you create a dummy recipient and attach it to the purse.)</span>
<a name="l11788"></a>11788 <span class="comment">//</span>
<a name="l11789"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad7f11418c03d9e3ad70c23bb220da105">11789</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad7f11418c03d9e3ad70c23bb220da105">OTAPI_Exec::Token_GetID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11790"></a>11790                                 <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11791"></a>11791                                 <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11792"></a>11792 {
<a name="l11793"></a>11793     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11794"></a>11794     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11795"></a>11795     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11796"></a>11796 
<a name="l11797"></a>11797     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11798"></a>11798 
<a name="l11799"></a>11799     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(<span class="stringliteral">&quot;0&quot;</span>);
<a name="l11800"></a>11800 
<a name="l11801"></a>11801     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11802"></a>11802     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, theServerID, theAssetTypeID);
<a name="l11803"></a>11803     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11804"></a>11804 
<a name="l11805"></a>11805     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11806"></a>11806     {
<a name="l11807"></a>11807         <span class="keyword">const</span> <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> &amp; ascSpendable = pToken-&gt;<a class="code" href="class_o_t_token.html#ac66cb04fd3053e8fa444010b59a89332">GetSpendable</a>(); <span class="comment">// encrypted version of Token ID, used as an &quot;ID&quot; on client side.</span>
<a name="l11808"></a>11808 
<a name="l11809"></a>11809         strOutput.<a class="code" href="class_o_t_string.html#af1c861f21033a1d583b3cb12f952422e">Format</a>(<span class="stringliteral">&quot;%s&quot;</span>, ascSpendable.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l11810"></a>11810     }
<a name="l11811"></a>11811 
<a name="l11812"></a>11812     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11813"></a>11813 
<a name="l11814"></a>11814     <span class="keywordflow">return</span> pBuf;
<a name="l11815"></a>11815 }
<a name="l11816"></a>11816 
<a name="l11817"></a>11817 
<a name="l11818"></a>11818 
<a name="l11819"></a>11819 <span class="comment">// The actual cash value of the token. Returns a int64_t int32_t as a string.</span>
<a name="l11820"></a>11820 <span class="comment">//</span>
<a name="l11821"></a><a class="code" href="class_o_t_a_p_i___exec.html#a806f47fc133eb237a14ecd5e6416d71a">11821</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a806f47fc133eb237a14ecd5e6416d71a" title="The actual cash value of the token. Returns a int64_t.">OTAPI_Exec::Token_GetDenomination</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11822"></a>11822                                          <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11823"></a>11823                                          <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11824"></a>11824 {
<a name="l11825"></a>11825     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11826"></a>11826     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11827"></a>11827     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11828"></a>11828 
<a name="l11829"></a>11829     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11830"></a>11830 
<a name="l11831"></a>11831     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(<span class="stringliteral">&quot;0&quot;</span>);
<a name="l11832"></a>11832 
<a name="l11833"></a>11833     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11834"></a>11834     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, theServerID, theAssetTypeID);
<a name="l11835"></a>11835     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11836"></a>11836 
<a name="l11837"></a>11837     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11838"></a>11838     {
<a name="l11839"></a>11839         <span class="keywordflow">return</span> pToken-&gt;<a class="code" href="class_o_t_token.html#a4e17470c475313139d1ed975e6c26b5a">GetDenomination</a>();
<a name="l11840"></a>11840     }
<a name="l11841"></a>11841     <span class="keywordflow">else</span> <span class="keywordflow">return</span> -1;
<a name="l11842"></a>11842 }
<a name="l11843"></a>11843 
<a name="l11844"></a>11844 
<a name="l11845"></a>11845 
<a name="l11846"></a>11846 <span class="comment">// OTAPI_Exec::Token_GetSeries</span>
<a name="l11847"></a>11847 <span class="comment">// Returns -1 for error.</span>
<a name="l11848"></a>11848 <span class="comment">// Otherwise returns the series number of this token. (Int.)</span>
<a name="l11849"></a>11849 <span class="comment">//</span>
<a name="l11850"></a><a class="code" href="class_o_t_a_p_i___exec.html#af2b5c6e571ec7670ffcf36e6f65b8494">11850</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af2b5c6e571ec7670ffcf36e6f65b8494">OTAPI_Exec::Token_GetSeries</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11851"></a>11851                           <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11852"></a>11852                           <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11853"></a>11853 {
<a name="l11854"></a>11854     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11855"></a>11855     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11856"></a>11856     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11857"></a>11857 
<a name="l11858"></a>11858     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11859"></a>11859 
<a name="l11860"></a>11860     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l11861"></a>11861 
<a name="l11862"></a>11862     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11863"></a>11863     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, theServerID, theAssetTypeID);
<a name="l11864"></a>11864     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11865"></a>11865 
<a name="l11866"></a>11866     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11867"></a>11867         <span class="keywordflow">return</span> pToken-&gt;<a class="code" href="class_o_t_token.html#ad68798a37c37605745ae99475a942126">GetSeries</a>();
<a name="l11868"></a>11868 
<a name="l11869"></a>11869     <span class="keywordflow">return</span> -1;
<a name="l11870"></a>11870 }
<a name="l11871"></a>11871 
<a name="l11872"></a>11872 
<a name="l11873"></a>11873 
<a name="l11874"></a>11874 
<a name="l11875"></a>11875 <span class="comment">// the date is seconds since Jan 1970, but returned as a string.</span>
<a name="l11876"></a>11876 <span class="comment">//</span>
<a name="l11877"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad238d24c7f5b9ed5dcc075e63e05b9d0">11877</a> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#ad238d24c7f5b9ed5dcc075e63e05b9d0" title="the date is seconds since Jan 1970.">OTAPI_Exec::Token_GetValidFrom</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11878"></a>11878                                       <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11879"></a>11879                                       <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11880"></a>11880 {
<a name="l11881"></a>11881     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11882"></a>11882     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11883"></a>11883     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11884"></a>11884 
<a name="l11885"></a>11885     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11886"></a>11886 
<a name="l11887"></a>11887     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l11888"></a>11888 
<a name="l11889"></a>11889     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11890"></a>11890     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, theServerID, theAssetTypeID);
<a name="l11891"></a>11891     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11892"></a>11892 
<a name="l11893"></a>11893     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11894"></a>11894     {
<a name="l11895"></a>11895         <span class="keywordflow">return</span> pToken-&gt;<a class="code" href="class_o_t_instrument.html#a08eb5f25566832e1a67b3e33c0dcc13f">GetValidFrom</a>();
<a name="l11896"></a>11896     }
<a name="l11897"></a>11897     <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l11898"></a>11898 }
<a name="l11899"></a>11899 
<a name="l11900"></a>11900 
<a name="l11901"></a>11901 <span class="comment">// the date is seconds since Jan 1970, but returned as a string.</span>
<a name="l11902"></a>11902 <span class="comment">//</span>
<a name="l11903"></a><a class="code" href="class_o_t_a_p_i___exec.html#a18f41ee30a81eddd1abd8c0ecc42e1c8">11903</a> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a> <a class="code" href="class_o_t_a_p_i___exec.html#a18f41ee30a81eddd1abd8c0ecc42e1c8">OTAPI_Exec::Token_GetValidTo</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l11904"></a>11904                                     <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l11905"></a>11905                                     <span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11906"></a>11906 {
<a name="l11907"></a>11907     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11908"></a>11908     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11909"></a>11909     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11910"></a>11910 
<a name="l11911"></a>11911     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l11912"></a>11912 
<a name="l11913"></a>11913     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l11914"></a>11914 
<a name="l11915"></a>11915     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11916"></a>11916     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken, theServerID, theAssetTypeID);
<a name="l11917"></a>11917     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11918"></a>11918 
<a name="l11919"></a>11919     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11920"></a>11920     {
<a name="l11921"></a>11921         <span class="keywordflow">return</span> pToken-&gt;<a class="code" href="class_o_t_instrument.html#ab83a62f51692c946ff394408026b0c18">GetValidTo</a>();
<a name="l11922"></a>11922     }
<a name="l11923"></a>11923     <span class="keywordflow">return</span> <a class="code" href="_o_t_common_8hpp.html#a5c0893ffd83818f1c3c6b3b7ae92da13">OTTimeGetTimeFromSeconds</a>(-1);
<a name="l11924"></a>11924 }
<a name="l11925"></a>11925 
<a name="l11926"></a>11926 <span class="comment">// ---------</span>
<a name="l11927"></a>11927 
<a name="l11928"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad7ab09b32bc246b3370f65456c5acfcd">11928</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad7ab09b32bc246b3370f65456c5acfcd">OTAPI_Exec::Token_GetAssetID</a>(<span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11929"></a>11929 {
<a name="l11930"></a>11930     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11931"></a>11931 
<a name="l11932"></a>11932     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l11933"></a>11933 
<a name="l11934"></a>11934     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11935"></a>11935     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken);
<a name="l11936"></a>11936     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11937"></a>11937 
<a name="l11938"></a>11938     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11939"></a>11939     {
<a name="l11940"></a>11940         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theID = pToken-&gt;<a class="code" href="class_o_t_instrument.html#a1f6c7b528680d84dcb998d473bdd99a6">GetAssetID</a>();
<a name="l11941"></a>11941         theID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strOutput);
<a name="l11942"></a>11942     }
<a name="l11943"></a>11943 
<a name="l11944"></a>11944     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11945"></a>11945 
<a name="l11946"></a>11946     <span class="keywordflow">return</span> pBuf;
<a name="l11947"></a>11947 }
<a name="l11948"></a>11948 
<a name="l11949"></a>11949 
<a name="l11950"></a><a class="code" href="class_o_t_a_p_i___exec.html#a37c61882ab4f0fc0d8621e2dc062740b">11950</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a37c61882ab4f0fc0d8621e2dc062740b">OTAPI_Exec::Token_GetServerID</a>(<span class="keyword">const</span> std::string &amp; THE_TOKEN)
<a name="l11951"></a>11951 {
<a name="l11952"></a>11952     <span class="keywordflow">if</span> (THE_TOKEN.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_TOKEN&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11953"></a>11953 
<a name="l11954"></a>11954     <a class="code" href="class_o_t_string.html">OTString</a> strOutput;
<a name="l11955"></a>11955 
<a name="l11956"></a>11956     <a class="code" href="class_o_t_string.html">OTString</a> strToken(THE_TOKEN);
<a name="l11957"></a>11957     <a class="code" href="class_o_t_token.html">OTToken</a> * pToken = <a class="code" href="class_o_t_token.html#ac758de04ed60991098005a7ac9578d71">OTToken::TokenFactory</a>(strToken);
<a name="l11958"></a>11958     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTToken&gt;</a> theTokenAngel(pToken);
<a name="l11959"></a>11959 
<a name="l11960"></a>11960     <span class="keywordflow">if</span> (NULL != pToken) <span class="comment">// TokenFactory instantiates AND loads from string.</span>
<a name="l11961"></a>11961     {
<a name="l11962"></a>11962         <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> &amp; theID = pToken-&gt;<a class="code" href="class_o_t_instrument.html#a878dd8998f7b131b85c082575e255375">GetServerID</a>();
<a name="l11963"></a>11963         theID.<a class="code" href="class_o_t_identifier.html#a4bccb30446b4b515d9d6016b86b260bb">GetString</a>(strOutput);
<a name="l11964"></a>11964     }
<a name="l11965"></a>11965 
<a name="l11966"></a>11966     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l11967"></a>11967 
<a name="l11968"></a>11968     <span class="keywordflow">return</span> pBuf;
<a name="l11969"></a>11969 }
<a name="l11970"></a>11970 
<a name="l11971"></a>11971 
<a name="l11972"></a>11972 
<a name="l11973"></a>11973 
<a name="l11974"></a>11974 
<a name="l11975"></a>11975 
<a name="l11976"></a>11976 
<a name="l11977"></a>11977 
<a name="l11978"></a>11978 
<a name="l11979"></a>11979 
<a name="l11980"></a>11980 
<a name="l11981"></a>11981 
<a name="l11982"></a>11982 <span class="comment">// --------------------------------------------------------------</span>
<a name="l11983"></a>11983 <span class="comment">// IS BASKET CURRENCY ?</span>
<a name="l11984"></a>11984 <span class="comment">//</span>
<a name="l11985"></a>11985 <span class="comment">// Tells you whether or not a given asset type is actually a basket currency.</span>
<a name="l11986"></a>11986 <span class="comment">//</span>
<a name="l11987"></a>11987 <span class="comment">// returns bool (true or false aka 1 or 0.)</span>
<a name="l11988"></a>11988 <span class="comment">//</span>
<a name="l11989"></a><a class="code" href="class_o_t_a_p_i___exec.html#acdb88af66f7b63a075f4fa744105854a">11989</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#acdb88af66f7b63a075f4fa744105854a">OTAPI_Exec::IsBasketCurrency</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID)
<a name="l11990"></a>11990 {
<a name="l11991"></a>11991     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l11992"></a>11992 
<a name="l11993"></a>11993     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetTypeID(ASSET_TYPE_ID);
<a name="l11994"></a>11994 
<a name="l11995"></a>11995     <span class="keywordflow">if</span> (<a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t_a_p_i___exec.html#acdb88af66f7b63a075f4fa744105854a">IsBasketCurrency</a>(theAssetTypeID))
<a name="l11996"></a>11996         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l11997"></a>11997     <span class="keywordflow">else</span>
<a name="l11998"></a>11998         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l11999"></a>11999 }
<a name="l12000"></a>12000 
<a name="l12001"></a>12001 
<a name="l12002"></a>12002 
<a name="l12003"></a>12003 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l12004"></a>12004 <span class="comment">// Get Basket Count (of backing asset types.)</span>
<a name="l12005"></a>12005 <span class="comment">//</span>
<a name="l12006"></a>12006 <span class="comment">// Returns the number of asset types that make up this basket.</span>
<a name="l12007"></a>12007 <span class="comment">// (Or zero.)</span>
<a name="l12008"></a>12008 <span class="comment">//</span>
<a name="l12009"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae0da0edb6c9accf976aefa1b7f9edc63">12009</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ae0da0edb6c9accf976aefa1b7f9edc63">OTAPI_Exec::Basket_GetMemberCount</a>(<span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID)
<a name="l12010"></a>12010 {
<a name="l12011"></a>12011     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12012"></a>12012 
<a name="l12013"></a>12013     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetTypeID(ASSET_TYPE_ID);
<a name="l12014"></a>12014 
<a name="l12015"></a>12015     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af4747b3de4902f3217ab050bb041bc66">GetBasketMemberCount</a>(theAssetTypeID);
<a name="l12016"></a>12016 }
<a name="l12017"></a>12017 
<a name="l12018"></a>12018 
<a name="l12019"></a>12019 
<a name="l12020"></a>12020 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l12021"></a>12021 <span class="comment">// Get Asset Type of a basket&#39;s member currency, by index.</span>
<a name="l12022"></a>12022 <span class="comment">//</span>
<a name="l12023"></a>12023 <span class="comment">// (Returns a string containing Asset Type ID, or &quot;&quot;).</span>
<a name="l12024"></a>12024 <span class="comment">//</span>
<a name="l12025"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2e07e1aeba5f83e3c5ec7b2f36fd2fa0">12025</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2e07e1aeba5f83e3c5ec7b2f36fd2fa0">OTAPI_Exec::Basket_GetMemberType</a>(<span class="keyword">const</span> std::string &amp; BASKET_ASSET_TYPE_ID,
<a name="l12026"></a>12026                                              <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l12027"></a>12027 {
<a name="l12028"></a>12028     <span class="keywordflow">if</span> (BASKET_ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12029"></a>12029 
<a name="l12030"></a>12030     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12031"></a>12031 
<a name="l12032"></a>12032     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetTypeID(BASKET_ASSET_TYPE_ID);
<a name="l12033"></a>12033 
<a name="l12034"></a>12034     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theOutputMemberType;
<a name="l12035"></a>12035 
<a name="l12036"></a>12036     <span class="keywordtype">bool</span> bGotType = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa51bdf044a89177e8bb1e0387e28a24a">GetBasketMemberType</a>(theAssetTypeID,
<a name="l12037"></a>12037         nIndex,
<a name="l12038"></a>12038         theOutputMemberType);
<a name="l12039"></a>12039     <span class="keywordflow">if</span> (<span class="keyword">false</span> == bGotType)
<a name="l12040"></a>12040         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l12041"></a>12041 
<a name="l12042"></a>12042     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theOutputMemberType);
<a name="l12043"></a>12043 
<a name="l12044"></a>12044     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l12045"></a>12045 
<a name="l12046"></a>12046     <span class="keywordflow">return</span> pBuf;
<a name="l12047"></a>12047 }
<a name="l12048"></a>12048 
<a name="l12049"></a>12049 
<a name="l12050"></a>12050 
<a name="l12051"></a>12051 
<a name="l12052"></a>12052 <span class="comment">// ----------------------------------------------------</span>
<a name="l12053"></a>12053 <span class="comment">// GET BASKET MINIMUM TRANSFER AMOUNT</span>
<a name="l12054"></a>12054 <span class="comment">//</span>
<a name="l12055"></a>12055 <span class="comment">// Returns a int64_t (as string) containing the minimum transfer</span>
<a name="l12056"></a>12056 <span class="comment">// amount for the entire basket.</span>
<a name="l12057"></a>12057 <span class="comment">//</span>
<a name="l12058"></a>12058 <span class="comment">// FOR EXAMPLE:</span>
<a name="l12059"></a>12059 <span class="comment">// If the basket is defined as 10 Rands == 2 Silver, 5 Gold, 8 Euro,</span>
<a name="l12060"></a>12060 <span class="comment">// then the minimum transfer amount for the basket is 10. This function</span>
<a name="l12061"></a>12061 <span class="comment">// would return a string containing &quot;10&quot;, in that example.</span>
<a name="l12062"></a>12062 <span class="comment">//</span>
<a name="l12063"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7d8ee6e7112c90631e808875bd9a1977">12063</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a7d8ee6e7112c90631e808875bd9a1977">OTAPI_Exec::Basket_GetMinimumTransferAmount</a>(<span class="keyword">const</span> std::string &amp; BASKET_ASSET_TYPE_ID)
<a name="l12064"></a>12064 {
<a name="l12065"></a>12065     <span class="keywordflow">if</span> (BASKET_ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12066"></a>12066 
<a name="l12067"></a>12067     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetTypeID(BASKET_ASSET_TYPE_ID);
<a name="l12068"></a>12068 
<a name="l12069"></a>12069     int64_t lMinTransAmount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aba4eb1e71d36b4ca4f077a90e3220ed5">GetBasketMinimumTransferAmount</a>(theAssetTypeID);
<a name="l12070"></a>12070 
<a name="l12071"></a>12071     <span class="keywordflow">if</span> (0 &gt;= lMinTransAmount)
<a name="l12072"></a>12072     {
<a name="l12073"></a>12073         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: returned 0 (or negitive). Strange... what basket is this?\n&quot;</span>, __FUNCTION__);
<a name="l12074"></a>12074         <span class="keywordflow">return</span> -1;
<a name="l12075"></a>12075     }
<a name="l12076"></a>12076 
<a name="l12077"></a>12077     <span class="keywordflow">return</span> lMinTransAmount;
<a name="l12078"></a>12078 }
<a name="l12079"></a>12079 
<a name="l12080"></a>12080 
<a name="l12081"></a>12081 
<a name="l12082"></a>12082 <span class="comment">// ----------------------------------------------------</span>
<a name="l12083"></a>12083 <span class="comment">// GET BASKET MEMBER&#39;s MINIMUM TRANSFER AMOUNT</span>
<a name="l12084"></a>12084 <span class="comment">//</span>
<a name="l12085"></a>12085 <span class="comment">// Returns a int64_t (as string) containing the minimum transfer</span>
<a name="l12086"></a>12086 <span class="comment">// amount for one of the member currencies in the basket.</span>
<a name="l12087"></a>12087 <span class="comment">//</span>
<a name="l12088"></a>12088 <span class="comment">// FOR EXAMPLE:</span>
<a name="l12089"></a>12089 <span class="comment">// If the basket is defined as 10 Rands == 2 Silver, 5 Gold, 8 Euro,</span>
<a name="l12090"></a>12090 <span class="comment">// then the minimum transfer amount for the member currency at index</span>
<a name="l12091"></a>12091 <span class="comment">// 0 is 2, the minimum transfer amount for the member currency at</span>
<a name="l12092"></a>12092 <span class="comment">// index 1 is 5, and the minimum transfer amount for the member</span>
<a name="l12093"></a>12093 <span class="comment">// currency at index 2 is 8.</span>
<a name="l12094"></a>12094 <span class="comment">//</span>
<a name="l12095"></a><a class="code" href="class_o_t_a_p_i___exec.html#a06717b4dbc96621925dc37a4150f66fc">12095</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a06717b4dbc96621925dc37a4150f66fc">OTAPI_Exec::Basket_GetMemberMinimumTransferAmount</a>(<span class="keyword">const</span> std::string &amp; BASKET_ASSET_TYPE_ID,
<a name="l12096"></a>12096                                                           <span class="keyword">const</span> int32_t &amp; nIndex)
<a name="l12097"></a>12097 {
<a name="l12098"></a>12098     <span class="keywordflow">if</span> (BASKET_ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12099"></a>12099 
<a name="l12100"></a>12100     <span class="keywordflow">if</span> (0 &gt; nIndex) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: nIndex is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12101"></a>12101 
<a name="l12102"></a>12102     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theAssetTypeID(BASKET_ASSET_TYPE_ID);
<a name="l12103"></a>12103 
<a name="l12104"></a>12104     int64_t lMinTransAmount = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af5ceba4f208230dc9b077b37423e289f">GetBasketMemberMinimumTransferAmount</a>(theAssetTypeID, nIndex);
<a name="l12105"></a>12105 
<a name="l12106"></a>12106     <span class="keywordflow">if</span> (0 &gt;= lMinTransAmount)
<a name="l12107"></a>12107     {
<a name="l12108"></a>12108         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: returned 0 (or negitive). Strange... what basket is this?\n&quot;</span>, __FUNCTION__);
<a name="l12109"></a>12109         <span class="keywordflow">return</span> -1;
<a name="l12110"></a>12110     }
<a name="l12111"></a>12111 
<a name="l12112"></a>12112     <span class="keywordflow">return</span> lMinTransAmount;
<a name="l12113"></a>12113 }
<a name="l12114"></a>12114 
<a name="l12115"></a>12115 
<a name="l12116"></a>12116 
<a name="l12117"></a>12117 <span class="comment">// ----------------------------------------------------</span>
<a name="l12118"></a>12118 
<a name="l12119"></a>12119 
<a name="l12120"></a>12120 
<a name="l12121"></a>12121 
<a name="l12122"></a>12122 <span class="comment">// --------------------------------------------------</span>
<a name="l12123"></a>12123 
<a name="l12124"></a>12124 <span class="comment">// MESSAGES BEING SENT TO THE SERVER:</span>
<a name="l12125"></a>12125 
<a name="l12126"></a>12126 
<a name="l12127"></a>12127 
<a name="l12128"></a>12128 
<a name="l12129"></a>12129 <span class="comment">// Returns int32_t:</span>
<a name="l12130"></a>12130 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12131"></a>12131 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12132"></a>12132 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12133"></a>12133 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12134"></a>12134 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12135"></a>12135 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12136"></a>12136 <span class="comment">//</span>
<a name="l12137"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6cd08bfe3b6c64afc6c0a16b308022c0">12137</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a6cd08bfe3b6c64afc6c0a16b308022c0">OTAPI_Exec::checkServerID</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12138"></a>12138                         <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l12139"></a>12139 {
<a name="l12140"></a>12140     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12141"></a>12141     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12142"></a>12142 
<a name="l12143"></a>12143     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12144"></a>12144 
<a name="l12145"></a>12145     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1d07c06d85b685d11ac4076104d73f49">checkServerID</a>(theServerID, theUserID);
<a name="l12146"></a>12146 }
<a name="l12147"></a>12147 
<a name="l12148"></a>12148 
<a name="l12149"></a>12149 <span class="comment">// Returns int32_t:</span>
<a name="l12150"></a>12150 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12151"></a>12151 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12152"></a>12152 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12153"></a>12153 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12154"></a>12154 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12155"></a>12155 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12156"></a>12156 <span class="comment">//</span>
<a name="l12157"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9ac57a993b4d2a1608ef0ac164960948">12157</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9ac57a993b4d2a1608ef0ac164960948">OTAPI_Exec::createUserAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12158"></a>12158                             <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l12159"></a>12159 {
<a name="l12160"></a>12160     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12161"></a>12161     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12162"></a>12162 
<a name="l12163"></a>12163     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12164"></a>12164 
<a name="l12165"></a>12165     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a60e541e43d25106bee94688886d66dcb">createUserAccount</a>(theServerID, theUserID);
<a name="l12166"></a>12166 }
<a name="l12167"></a>12167 
<a name="l12168"></a>12168 <span class="comment">// Returns int32_t:</span>
<a name="l12169"></a>12169 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12170"></a>12170 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12171"></a>12171 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12172"></a>12172 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12173"></a>12173 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12174"></a>12174 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12175"></a>12175 <span class="comment">//</span>
<a name="l12176"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0f3388bb5b779fa5f44ecea7b6513866">12176</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a0f3388bb5b779fa5f44ecea7b6513866">OTAPI_Exec::deleteUserAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12177"></a>12177                             <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l12178"></a>12178 {
<a name="l12179"></a>12179     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12180"></a>12180     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12181"></a>12181 
<a name="l12182"></a>12182     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12183"></a>12183 
<a name="l12184"></a>12184     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a6d44f675aa0c8fb36f9d55dadba5efcc">deleteUserAccount</a>(theServerID, theUserID);
<a name="l12185"></a>12185 }
<a name="l12186"></a>12186 
<a name="l12187"></a>12187 
<a name="l12188"></a>12188 
<a name="l12189"></a>12189 <span class="comment">// If THE_MESSAGE is of command type @usageCredits, and IF it was a SUCCESS,</span>
<a name="l12190"></a>12190 <span class="comment">// then this function returns the usage credits BALANCE (it&#39;s a int64_t int32_t, but</span>
<a name="l12191"></a>12191 <span class="comment">// passed as a string). If you adjusted the balance using the usageCredits</span>
<a name="l12192"></a>12192 <span class="comment">// message (THE_MESSAGE being the server&#39;s reply to that) then you will see</span>
<a name="l12193"></a>12193 <span class="comment">// the balance AFTER the adjustment. (The &quot;Current&quot; Usage Credits balance.)</span>
<a name="l12194"></a>12194 <span class="comment">//</span>
<a name="l12195"></a>12195 <span class="comment">// UPDATE: Notice that we now return -2 in the case of all errors.</span>
<a name="l12196"></a>12196 <span class="comment">//         This is because the lowest possible actual value is -1.</span>
<a name="l12197"></a>12197 <span class="comment">//</span>
<a name="l12198"></a>12198 <span class="comment">//         - Basically a 0 or positive value means that usage credits are</span>
<a name="l12199"></a>12199 <span class="comment">//           actually turned on (on the server side) and that you are seeing</span>
<a name="l12200"></a>12200 <span class="comment">//           the actual usage credits value for that Nym.</span>
<a name="l12201"></a>12201 <span class="comment">//</span>
<a name="l12202"></a>12202 <span class="comment">//         - Whereas a -2 value means there was an error.</span>
<a name="l12203"></a>12203 <span class="comment">//</span>
<a name="l12204"></a>12204 <span class="comment">//         - Whereas a -1 value means that usage credits are turned off (on</span>
<a name="l12205"></a>12205 <span class="comment">//           the server side) OR that the Nym has been given the special -1</span>
<a name="l12206"></a>12206 <span class="comment">//           setting for usage credits, which enables him to operate as if he</span>
<a name="l12207"></a>12207 <span class="comment">//           has unlimited usage credits.</span>
<a name="l12208"></a>12208 <span class="comment">//</span>
<a name="l12209"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9ba3dd59c6ae3c669730014842bfb90e">12209</a> int64_t <a class="code" href="class_o_t_a_p_i___exec.html#a9ba3dd59c6ae3c669730014842bfb90e">OTAPI_Exec::Message_GetUsageCredits</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l12210"></a>12210 {
<a name="l12211"></a>12211     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12212"></a>12212 
<a name="l12213"></a>12213     <a class="code" href="class_o_t_string.html">OTString</a>  strMessage(THE_MESSAGE);
<a name="l12214"></a>12214     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l12215"></a>12215 
<a name="l12216"></a>12216     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l12217"></a>12217     {
<a name="l12218"></a>12218         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: THE_MESSAGE doesn&#39;t exist.\n&quot;</span>, __FUNCTION__);
<a name="l12219"></a>12219         <span class="keywordflow">return</span> -2;
<a name="l12220"></a>12220     }
<a name="l12221"></a>12221 
<a name="l12222"></a>12222     <span class="keywordflow">if</span> (!theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l12223"></a>12223     {
<a name="l12224"></a>12224         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading message from string.\n&quot;</span>, __FUNCTION__);
<a name="l12225"></a>12225         <span class="keywordflow">return</span> -2;
<a name="l12226"></a>12226     }
<a name="l12227"></a>12227 
<a name="l12228"></a>12228     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#ad6d611b1178ec24da0a380fb461300b8">m_bSuccess</a>)
<a name="l12229"></a>12229     {
<a name="l12230"></a>12230         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Message success == false, thus unable to report Usage Credits balance. (Returning -2.)\n&quot;</span>, __FUNCTION__);
<a name="l12231"></a>12231         <span class="keywordflow">return</span> -2;
<a name="l12232"></a>12232     }
<a name="l12233"></a>12233 
<a name="l12234"></a>12234     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@usageCredits&quot;</span>))
<a name="l12235"></a>12235     {
<a name="l12236"></a>12236         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: THE_MESSAGE is supposed to be of command type \&quot;@usageCredits\&quot;, but instead it&#39;s a: %s\n (Failure. Returning -2.)&quot;</span>,
<a name="l12237"></a>12237             __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l12238"></a>12238         <span class="keywordflow">return</span> -2;
<a name="l12239"></a>12239     }
<a name="l12240"></a>12240 
<a name="l12241"></a>12241     <span class="comment">// ----------------------------------------------</span>
<a name="l12242"></a>12242     <span class="comment">// By this point, we know the message was a successful @usageCredits, loaded</span>
<a name="l12243"></a>12243     <span class="comment">// properly from the string that was passed in. Let&#39;s return the usage credits</span>
<a name="l12244"></a>12244     <span class="comment">// balance (a int64_t int32_t, returned in string format.)</span>
<a name="l12245"></a>12245 
<a name="l12246"></a>12246     <span class="keywordflow">return</span> theMessage.<a class="code" href="class_o_t_message.html#a04ef2907cff33f832b438c93f17880b7">m_lDepth</a>;
<a name="l12247"></a>12247 }
<a name="l12248"></a>12248 
<a name="l12249"></a>12249 
<a name="l12250"></a>12250 
<a name="l12251"></a>12251 <span class="comment">// Returns int32_t:</span>
<a name="l12252"></a>12252 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12253"></a>12253 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12254"></a>12254 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12255"></a>12255 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12256"></a>12256 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12257"></a>12257 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12258"></a>12258 <span class="comment">//</span>
<a name="l12259"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4e5460e41424176727e7043b278d8350">12259</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4e5460e41424176727e7043b278d8350">OTAPI_Exec::usageCredits</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12260"></a>12260                                  <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12261"></a>12261                                  <span class="keyword">const</span> std::string &amp; USER_ID_CHECK,
<a name="l12262"></a>12262                                  <span class="keyword">const</span> int64_t     &amp; ADJUSTMENT)    <span class="comment">// can be &quot;0&quot;, or &quot;&quot;, if you just want to check the current balance without adjusting it.</span>
<a name="l12263"></a>12263 {
<a name="l12264"></a>12264     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12265"></a>12265     <span class="keywordflow">if</span> (USER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12266"></a>12266     <span class="keywordflow">if</span> (USER_ID_CHECK.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID_CHECK&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12267"></a>12267 
<a name="l12268"></a>12268 <span class="comment">//  OT_ASSERT_MSG(&quot;&quot; != ADJUSTMENT, &quot;OTAPI_Exec::usageCredits: Null ADJUSTMENT passed in.&quot;); // &quot;&quot; is allowed here.</span>
<a name="l12269"></a>12269 
<a name="l12270"></a>12270     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theOtherUserID(USER_ID_CHECK);
<a name="l12271"></a>12271 
<a name="l12272"></a>12272     <span class="keyword">const</span> int64_t lAdjustment = ADJUSTMENT; <span class="comment">// &quot;&quot; resolves as 0.</span>
<a name="l12273"></a>12273 
<a name="l12274"></a>12274     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aae87777314e8bcd258a117082559b024">usageCredits</a>(theServerID, theUserID, theOtherUserID, static_cast&lt;int64_t&gt;(lAdjustment));
<a name="l12275"></a>12275 }
<a name="l12276"></a>12276 
<a name="l12277"></a>12277 
<a name="l12278"></a>12278 <span class="comment">// Returns int32_t:</span>
<a name="l12279"></a>12279 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12280"></a>12280 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12281"></a>12281 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12282"></a>12282 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12283"></a>12283 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12284"></a>12284 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12285"></a>12285 <span class="comment">//</span>
<a name="l12286"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4a382400dd621c29f9e66dd7714bfef4">12286</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4a382400dd621c29f9e66dd7714bfef4">OTAPI_Exec::checkUser</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12287"></a>12287                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12288"></a>12288                               <span class="keyword">const</span> std::string &amp; USER_ID_CHECK)
<a name="l12289"></a>12289 {
<a name="l12290"></a>12290     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12291"></a>12291     <span class="keywordflow">if</span> (USER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12292"></a>12292     <span class="keywordflow">if</span> (USER_ID_CHECK.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID_CHECK&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12293"></a>12293 
<a name="l12294"></a>12294     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theOtherUserID(USER_ID_CHECK);
<a name="l12295"></a>12295 
<a name="l12296"></a>12296     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a3c15352c5e6e6297252cc4d41dc66188">checkUser</a>(theServerID, theUserID, theOtherUserID);
<a name="l12297"></a>12297 }
<a name="l12298"></a>12298 
<a name="l12299"></a>12299 
<a name="l12300"></a>12300 <span class="comment">// Returns int32_t:</span>
<a name="l12301"></a>12301 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12302"></a>12302 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12303"></a>12303 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12304"></a>12304 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12305"></a>12305 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12306"></a>12306 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12307"></a>12307 <span class="comment">//</span>
<a name="l12308"></a><a class="code" href="class_o_t_a_p_i___exec.html#a379cedb3b377bb28201da0989b0fdc43">12308</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a379cedb3b377bb28201da0989b0fdc43">OTAPI_Exec::sendUserMessage</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12309"></a>12309                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12310"></a>12310                                     <span class="keyword">const</span> std::string &amp; USER_ID_RECIPIENT,
<a name="l12311"></a>12311                                     <span class="keyword">const</span> std::string &amp; RECIPIENT_PUBKEY,
<a name="l12312"></a>12312                                     <span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l12313"></a>12313 {
<a name="l12314"></a>12314     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12315"></a>12315     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12316"></a>12316     <span class="keywordflow">if</span> (USER_ID_RECIPIENT.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID_RECIPIENT&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12317"></a>12317     <span class="keywordflow">if</span> (RECIPIENT_PUBKEY.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_PUBKEY&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12318"></a>12318     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12319"></a>12319 
<a name="l12320"></a>12320     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID), theUserID(USER_ID), theOtherUserID(USER_ID_RECIPIENT);
<a name="l12321"></a>12321     <a class="code" href="class_o_t_string.html">OTString</a>        strRecipPubkey(RECIPIENT_PUBKEY);
<a name="l12322"></a>12322     <a class="code" href="class_o_t_string.html">OTString</a>        strMessage(THE_MESSAGE);
<a name="l12323"></a>12323 
<a name="l12324"></a>12324     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ab168fb55e1ce59b07f251517d6768076">sendUserMessage</a>(theServerID, theUserID, theOtherUserID, strRecipPubkey, strMessage);
<a name="l12325"></a>12325 }
<a name="l12326"></a>12326 
<a name="l12327"></a>12327 
<a name="l12328"></a>12328 
<a name="l12329"></a>12329 <span class="comment">// Returns int32_t:</span>
<a name="l12330"></a>12330 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12331"></a>12331 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12332"></a>12332 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12333"></a>12333 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12334"></a>12334 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12335"></a>12335 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12336"></a>12336 <span class="comment">//</span>
<a name="l12337"></a><a class="code" href="class_o_t_a_p_i___exec.html#a01f5aa5a55a345259b808fceaf310eba">12337</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a01f5aa5a55a345259b808fceaf310eba">OTAPI_Exec::sendUserInstrument</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12338"></a>12338                                        <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12339"></a>12339                                        <span class="keyword">const</span> std::string &amp; USER_ID_RECIPIENT,
<a name="l12340"></a>12340                                        <span class="keyword">const</span> std::string &amp; RECIPIENT_PUBKEY,
<a name="l12341"></a>12341                                        <span class="keyword">const</span> std::string &amp; THE_INSTRUMENT,
<a name="l12342"></a>12342                                        <span class="keyword">const</span> std::string &amp; INSTRUMENT_FOR_SENDER) <span class="comment">// Can be empty. Special version for the sender&#39;s outpayments box. Only used for cash: THE_INSTRUMENT contains tokens already encrypted to the recipient&#39;s key. So this version contains tokens encrypted to the sender&#39;s key instead.</span>
<a name="l12343"></a>12343 {
<a name="l12344"></a>12344     <span class="keywordflow">if</span> (SERVER_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12345"></a>12345     <span class="keywordflow">if</span> (USER_ID.empty())               { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>              ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12346"></a>12346     <span class="keywordflow">if</span> (USER_ID_RECIPIENT.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID_RECIPIENT&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12347"></a>12347     <span class="keywordflow">if</span> (RECIPIENT_PUBKEY.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_PUBKEY&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12348"></a>12348     <span class="keywordflow">if</span> (THE_INSTRUMENT.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_INSTRUMENT&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12349"></a>12349 <span class="comment">//  if (INSTRUMENT_FOR_SENDER.empty()) { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;, __FUNCTION__, &quot;INSTRUMENT_FOR_SENDER&quot;); OT_FAIL; }</span>
<a name="l12350"></a>12350     <span class="comment">// (INSTRUMENT_FOR_SENDER is optional, so we allow it to be empty.)</span>
<a name="l12351"></a>12351 
<a name="l12352"></a>12352     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID), theUserID(USER_ID), theOtherUserID(USER_ID_RECIPIENT);
<a name="l12353"></a>12353     <span class="comment">// -----------------------------------------------------</span>
<a name="l12354"></a>12354     <a class="code" href="class_o_t_string.html">OTString</a>    strRecipPubkey(RECIPIENT_PUBKEY),
<a name="l12355"></a>12355                 strInstrument(THE_INSTRUMENT);
<a name="l12356"></a>12356     <span class="comment">// -----------------------------------------------------</span>
<a name="l12357"></a>12357     <span class="comment">// Note: this was removed and can be deleted from the code.</span>
<a name="l12358"></a>12358     <span class="comment">//</span>
<a name="l12359"></a>12359     <span class="comment">// Why? Because we pass the string version of the public key,</span>
<a name="l12360"></a>12360     <span class="comment">// not the OTASCIIArmor version. The bookends are passed intact</span>
<a name="l12361"></a>12361     <span class="comment">// into the OpenSSL call since the key is expected that way.</span>
<a name="l12362"></a>12362     <span class="comment">// Whereas loading it into ascii-armor is just going to strip off</span>
<a name="l12363"></a>12363     <span class="comment">// the bookends and pass the raw base64-encoded pubkey to OpenSSL</span>
<a name="l12364"></a>12364     <span class="comment">// which is NOT what OpenSSL is expecting. FYI.</span>
<a name="l12365"></a>12365     <span class="comment">//</span>
<a name="l12366"></a>12366     <span class="comment">// Todo, security: Should we do this anyway, just purely for validation purposes?</span>
<a name="l12367"></a>12367     <span class="comment">//</span>
<a name="l12368"></a>12368 <span class="comment">//  OTASCIIArmor ascRecipPubkey;</span>
<a name="l12369"></a>12369 <span class="comment">//  const bool bLoadedArmor = OTASCIIArmor::LoadFromString(ascRecipPubkey, strRecipPubkey); // str_bookend=&quot;-----BEGIN&quot; by default</span>
<a name="l12370"></a>12370 <span class="comment">//  // -----------------------------------------------------</span>
<a name="l12371"></a>12371 <span class="comment">//  if (!bLoadedArmor || !ascRecipPubkey.Exists())</span>
<a name="l12372"></a>12372 <span class="comment">//  {</span>
<a name="l12373"></a>12373 <span class="comment">//      OTLog::vError(&quot;%s: Failure loading string into OTASCIIArmor object:\n\n%s\n\n&quot;,</span>
<a name="l12374"></a>12374 <span class="comment">//                    __FUNCTION__, strRecipPubkey.Get());</span>
<a name="l12375"></a>12375 <span class="comment">//      return OT_ERROR;</span>
<a name="l12376"></a>12376 <span class="comment">//  }</span>
<a name="l12377"></a>12377     <span class="comment">// -----------------------------------------------------</span>
<a name="l12378"></a>12378     <a class="code" href="class_o_t_payment.html">OTPayment</a> thePayment(strInstrument);
<a name="l12379"></a>12379 
<a name="l12380"></a>12380     <span class="keywordflow">if</span> (!thePayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>() || !thePayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>())
<a name="l12381"></a>12381     {
<a name="l12382"></a>12382         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading payment instrument (intended for recipient) from string:\n\n%s\n\n&quot;</span>,
<a name="l12383"></a>12383                        __FUNCTION__, strInstrument.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l12384"></a>12384         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l12385"></a>12385     }
<a name="l12386"></a>12386     <span class="comment">// -----------------------------------------------------</span>
<a name="l12387"></a>12387     <span class="keyword">const</span> <span class="keywordtype">bool</span> bSenderCopyIncluded = (INSTRUMENT_FOR_SENDER.size() &gt; 0);
<a name="l12388"></a>12388 
<a name="l12389"></a>12389     <span class="keywordflow">if</span> (bSenderCopyIncluded)
<a name="l12390"></a>12390     {
<a name="l12391"></a>12391         <a class="code" href="class_o_t_string.html">OTString</a>  strInstrumentForSender(INSTRUMENT_FOR_SENDER);
<a name="l12392"></a>12392         <span class="comment">// -----------------------------------------------------</span>
<a name="l12393"></a>12393         <a class="code" href="class_o_t_payment.html">OTPayment</a> theSenderPayment(strInstrumentForSender);
<a name="l12394"></a>12394 
<a name="l12395"></a>12395         <span class="keywordflow">if</span> (!theSenderPayment.<a class="code" href="class_o_t_payment.html#a7f95ab568d481ecc7d38689c80caba84">IsValid</a>() || !theSenderPayment.<a class="code" href="class_o_t_payment.html#a1ee95406f9d221ae4a57783422d52156">SetTempValues</a>())
<a name="l12396"></a>12396         {
<a name="l12397"></a>12397             <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Failure loading payment instrument (copy intended for sender&#39;s records) from string:\n\n%s\n\n&quot;</span>,
<a name="l12398"></a>12398                            __FUNCTION__, strInstrumentForSender.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l12399"></a>12399             <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l12400"></a>12400         }
<a name="l12401"></a>12401         <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a579f8299c5c8df16a7d30e2226663d84">sendUserInstrument</a>(theServerID, theUserID, theOtherUserID, strRecipPubkey, thePayment, &amp;theSenderPayment);
<a name="l12402"></a>12402     }
<a name="l12403"></a>12403     <span class="comment">// -----------------------------------------------------</span>
<a name="l12404"></a>12404     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a579f8299c5c8df16a7d30e2226663d84">sendUserInstrument</a>(theServerID, theUserID, theOtherUserID, strRecipPubkey, thePayment);
<a name="l12405"></a>12405 }
<a name="l12406"></a>12406 
<a name="l12407"></a>12407 
<a name="l12408"></a>12408 
<a name="l12409"></a>12409 <span class="comment">// Returns int32_t:</span>
<a name="l12410"></a>12410 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12411"></a>12411 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12412"></a>12412 <span class="comment">//  1 means the &quot;getRequest&quot; message was successfully SENT.</span>
<a name="l12413"></a>12413 <span class="comment">//</span>
<a name="l12414"></a><a class="code" href="class_o_t_a_p_i___exec.html#a57eb0708df353538dc4a33b031ecc07c">12414</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a57eb0708df353538dc4a33b031ecc07c">OTAPI_Exec::getRequest</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12415"></a>12415                                <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l12416"></a>12416 {
<a name="l12417"></a>12417     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12418"></a>12418     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12419"></a>12419 
<a name="l12420"></a>12420     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12421"></a>12421 
<a name="l12422"></a>12422     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1dfa9ba3149336b36e68662e86265b6e">getRequest</a>(theServerID, theUserID);
<a name="l12423"></a>12423 }
<a name="l12424"></a>12424 
<a name="l12425"></a>12425 
<a name="l12426"></a>12426 
<a name="l12427"></a>12427 <span class="comment">// Returns int32_t:</span>
<a name="l12428"></a>12428 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12429"></a>12429 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12430"></a>12430 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12431"></a>12431 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12432"></a>12432 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12433"></a>12433 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12434"></a>12434 <span class="comment">//</span>
<a name="l12435"></a><a class="code" href="class_o_t_a_p_i___exec.html#abc76e39d38dcea1d999c410272f6cd53">12435</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#abc76e39d38dcea1d999c410272f6cd53">OTAPI_Exec::issueAssetType</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12436"></a>12436                                    <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12437"></a>12437                                    <span class="keyword">const</span> std::string &amp; THE_CONTRACT)
<a name="l12438"></a>12438 {
<a name="l12439"></a>12439     <span class="keywordflow">if</span> (SERVER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12440"></a>12440     <span class="keywordflow">if</span> (USER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12441"></a>12441     <span class="keywordflow">if</span> (THE_CONTRACT.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CONTRACT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12442"></a>12442 
<a name="l12443"></a>12443     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12444"></a>12444 
<a name="l12445"></a>12445     <a class="code" href="class_o_t_string.html">OTString</a> strContract(THE_CONTRACT);
<a name="l12446"></a>12446 
<a name="l12447"></a>12447     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8ab12884841613694afed4593e780e5a">issueAssetType</a>(theServerID, theUserID, strContract);
<a name="l12448"></a>12448 }
<a name="l12449"></a>12449 
<a name="l12450"></a>12450 
<a name="l12451"></a>12451 <span class="comment">// Returns int32_t:</span>
<a name="l12452"></a>12452 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12453"></a>12453 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12454"></a>12454 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12455"></a>12455 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12456"></a>12456 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12457"></a>12457 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12458"></a>12458 <span class="comment">//</span>
<a name="l12459"></a><a class="code" href="class_o_t_a_p_i___exec.html#af26e961f144a979bc1bbe1aa5f5537be">12459</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af26e961f144a979bc1bbe1aa5f5537be">OTAPI_Exec::getContract</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12460"></a>12460                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12461"></a>12461                                 <span class="keyword">const</span> std::string &amp; ASSET_ID)
<a name="l12462"></a>12462 {
<a name="l12463"></a>12463     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12464"></a>12464     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12465"></a>12465     <span class="keywordflow">if</span> (ASSET_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12466"></a>12466 
<a name="l12467"></a>12467     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAssetID(ASSET_ID);
<a name="l12468"></a>12468 
<a name="l12469"></a>12469     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5edd49c564ada6fb519882ad7a60bd8e">getContract</a>(theServerID, theUserID, theAssetID);
<a name="l12470"></a>12470 }
<a name="l12471"></a>12471 
<a name="l12472"></a>12472 
<a name="l12473"></a>12473 <span class="comment">// Returns int32_t:</span>
<a name="l12474"></a>12474 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12475"></a>12475 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12476"></a>12476 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12477"></a>12477 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12478"></a>12478 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12479"></a>12479 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12480"></a>12480 <span class="comment">//</span>
<a name="l12481"></a><a class="code" href="class_o_t_a_p_i___exec.html#a6486d68cd2943fbdf0c01716ea78a9d5">12481</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a6486d68cd2943fbdf0c01716ea78a9d5">OTAPI_Exec::getMint</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12482"></a>12482                             <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12483"></a>12483                             <span class="keyword">const</span> std::string &amp; ASSET_ID)
<a name="l12484"></a>12484 {
<a name="l12485"></a>12485     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12486"></a>12486     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12487"></a>12487     <span class="keywordflow">if</span> (ASSET_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12488"></a>12488 
<a name="l12489"></a>12489     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAssetID(ASSET_ID);
<a name="l12490"></a>12490 
<a name="l12491"></a>12491     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ab8904b6f61d9c3c03acc6d5723458d86">getMint</a>(theServerID, theUserID, theAssetID);
<a name="l12492"></a>12492 }
<a name="l12493"></a>12493 
<a name="l12494"></a>12494 
<a name="l12495"></a>12495 <span class="comment">// Returns int32_t:</span>
<a name="l12496"></a>12496 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12497"></a>12497 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12498"></a>12498 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12499"></a>12499 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12500"></a>12500 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12501"></a>12501 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12502"></a>12502 <span class="comment">//</span>
<a name="l12503"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1a3d22b5d80e570fb07ba3f7ee1c17b3">12503</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a1a3d22b5d80e570fb07ba3f7ee1c17b3">OTAPI_Exec::createAssetAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12504"></a>12504                                        <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12505"></a>12505                                        <span class="keyword">const</span> std::string &amp; ASSET_ID)
<a name="l12506"></a>12506 {
<a name="l12507"></a>12507     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12508"></a>12508     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12509"></a>12509     <span class="keywordflow">if</span> (ASSET_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12510"></a>12510 
<a name="l12511"></a>12511     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAssetID(ASSET_ID);
<a name="l12512"></a>12512 
<a name="l12513"></a>12513     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a911f4791ccc4619dc5149e571d676867">createAssetAccount</a>(theServerID, theUserID, theAssetID);
<a name="l12514"></a>12514 }
<a name="l12515"></a>12515 
<a name="l12516"></a>12516 
<a name="l12517"></a>12517 
<a name="l12518"></a>12518 <span class="comment">// Sends a message to the server to retrieve latest copy of an asset acct.</span>
<a name="l12519"></a>12519 <span class="comment">// Returns int32_t:</span>
<a name="l12520"></a>12520 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12521"></a>12521 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12522"></a>12522 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12523"></a>12523 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12524"></a>12524 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12525"></a>12525 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12526"></a>12526 <span class="comment">//</span>
<a name="l12527"></a>12527 <span class="comment">// NOTE: Deprecated. Replaced by getAccountFiles</span>
<a name="l12528"></a><a class="code" href="class_o_t_a_p_i___exec.html#a676046a2b6dde3b9852ab00c4216d52d">12528</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a676046a2b6dde3b9852ab00c4216d52d">OTAPI_Exec::getAccount</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12529"></a>12529                                <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12530"></a>12530                                <span class="keyword">const</span> std::string &amp; ACCT_ID)
<a name="l12531"></a>12531 {
<a name="l12532"></a>12532     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12533"></a>12533     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12534"></a>12534     <span class="keywordflow">if</span> (ACCT_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12535"></a>12535 
<a name="l12536"></a>12536     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l12537"></a>12537 
<a name="l12538"></a>12538     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8d2a98f3ec41510173e91d2acb34b520">getAccount</a>(theServerID, theUserID, theAcctID);
<a name="l12539"></a>12539 }
<a name="l12540"></a>12540 
<a name="l12541"></a>12541 
<a name="l12542"></a>12542 
<a name="l12543"></a>12543 <span class="comment">// Sends a message to the server to retrieve latest copy of an asset acct.</span>
<a name="l12544"></a>12544 <span class="comment">// Returns int32_t:</span>
<a name="l12545"></a>12545 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12546"></a>12546 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12547"></a>12547 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12548"></a>12548 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12549"></a>12549 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12550"></a>12550 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12551"></a>12551 <span class="comment">//</span>
<a name="l12552"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8cb22849daabd9d44b8bb6bccb26e722">12552</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a8cb22849daabd9d44b8bb6bccb26e722">OTAPI_Exec::getAccountFiles</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12553"></a>12553                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12554"></a>12554                                     <span class="keyword">const</span> std::string &amp; ACCT_ID)
<a name="l12555"></a>12555 {
<a name="l12556"></a>12556     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12557"></a>12557     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12558"></a>12558     <span class="keywordflow">if</span> (ACCT_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12559"></a>12559 
<a name="l12560"></a>12560     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l12561"></a>12561 
<a name="l12562"></a>12562     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a2df75f7a37f281e3bacfce2c0fa49a3e">getAccountFiles</a>(theServerID, theUserID, theAcctID);
<a name="l12563"></a>12563 }
<a name="l12564"></a>12564 
<a name="l12565"></a>12565 
<a name="l12566"></a>12566 
<a name="l12567"></a>12567 
<a name="l12568"></a>12568 <span class="comment">// ----------------------------------------------------</span>
<a name="l12569"></a>12569 <span class="comment">// GENERATE BASKET CREATION REQUEST</span>
<a name="l12570"></a>12570 <span class="comment">//</span>
<a name="l12571"></a>12571 <span class="comment">// (returns the basket in string form.)</span>
<a name="l12572"></a>12572 <span class="comment">//</span>
<a name="l12573"></a>12573 <span class="comment">// Call OTAPI_Exec::AddBasketCreationItem multiple times to add</span>
<a name="l12574"></a>12574 <span class="comment">// the various currencies to the basket, and then call</span>
<a name="l12575"></a>12575 <span class="comment">// OTAPI_Exec::issueBasket to send the request to the server.</span>
<a name="l12576"></a>12576 <span class="comment">//</span>
<a name="l12577"></a><a class="code" href="class_o_t_a_p_i___exec.html#afa5010dfd9752a6b4adcd12afd98e598">12577</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afa5010dfd9752a6b4adcd12afd98e598">OTAPI_Exec::GenerateBasketCreation</a>(<span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12578"></a>12578                                           <span class="keyword">const</span> int64_t &amp; MINIMUM_TRANSFER)
<a name="l12579"></a>12579 {
<a name="l12580"></a>12580     <span class="keywordflow">if</span> (USER_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12581"></a>12581     <span class="keywordflow">if</span> (0 &gt; MINIMUM_TRANSFER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MINIMUM_TRANSFER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12582"></a>12582 
<a name="l12583"></a>12583     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID);
<a name="l12584"></a>12584 
<a name="l12585"></a>12585     <span class="comment">// ----------------------------------------------</span>
<a name="l12586"></a>12586     int64_t lMinimumTransfer = MINIMUM_TRANSFER == 0 ? 10 : MINIMUM_TRANSFER;
<a name="l12587"></a>12587     <span class="comment">// ----------------------------------------------</span>
<a name="l12588"></a>12588 
<a name="l12589"></a>12589     <a class="code" href="class_o_t_basket.html">OTBasket</a> * pBasket = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acd596ba47ce7c6e3f1035d91e6fdfbac">GenerateBasketCreation</a>(theUserID, static_cast&lt;int64_t&gt;(lMinimumTransfer)); <span class="comment">// Must be above zero. If &lt;= 0, defaults to 10.</span>
<a name="l12590"></a>12590 
<a name="l12591"></a>12591     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTBasket&gt;</a> theAngel(pBasket);
<a name="l12592"></a>12592 
<a name="l12593"></a>12593     <span class="keywordflow">if</span> (NULL == pBasket)
<a name="l12594"></a>12594         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l12595"></a>12595 
<a name="l12596"></a>12596     <span class="comment">// At this point, I know pBasket is good (and will be cleaned up automatically.)</span>
<a name="l12597"></a>12597     <span class="comment">// ----------------------------------------------</span>
<a name="l12598"></a>12598 
<a name="l12599"></a>12599 
<a name="l12600"></a>12600     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pBasket);
<a name="l12601"></a>12601     <span class="comment">//  pBasket-&gt;SaveContract(strOutput); // Extract the basket to string form.</span>
<a name="l12602"></a>12602 
<a name="l12603"></a>12603     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l12604"></a>12604 
<a name="l12605"></a>12605 
<a name="l12606"></a>12606 
<a name="l12607"></a>12607     <span class="keywordflow">return</span> pBuf;
<a name="l12608"></a>12608 }
<a name="l12609"></a>12609 
<a name="l12610"></a>12610 
<a name="l12611"></a>12611 
<a name="l12612"></a>12612 
<a name="l12613"></a>12613 <span class="comment">// ----------------------------------------------------</span>
<a name="l12614"></a>12614 <span class="comment">// ADD BASKET CREATION ITEM</span>
<a name="l12615"></a>12615 <span class="comment">//</span>
<a name="l12616"></a>12616 <span class="comment">// (returns the updated basket in string form.)</span>
<a name="l12617"></a>12617 <span class="comment">//</span>
<a name="l12618"></a>12618 <span class="comment">// Call OTAPI_Exec::GenerateBasketCreation first (above), then</span>
<a name="l12619"></a>12619 <span class="comment">// call this function multiple times to add the various</span>
<a name="l12620"></a>12620 <span class="comment">// currencies to the basket, and then call OTAPI_Exec::issueBasket</span>
<a name="l12621"></a>12621 <span class="comment">// to send the request to the server.</span>
<a name="l12622"></a>12622 <span class="comment">//</span>
<a name="l12623"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7391d23707ed9404c19e92bcf0c97b61">12623</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a7391d23707ed9404c19e92bcf0c97b61">OTAPI_Exec::AddBasketCreationItem</a>(<span class="keyword">const</span> std::string &amp; USER_ID, <span class="comment">// for signature.</span>
<a name="l12624"></a>12624                                               <span class="keyword">const</span> std::string &amp; THE_BASKET, <span class="comment">// created in above call.</span>
<a name="l12625"></a>12625                                               <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID, <span class="comment">// Adding an asset type to the new basket.</span>
<a name="l12626"></a>12626                                               <span class="keyword">const</span> int64_t &amp; MINIMUM_TRANSFER)
<a name="l12627"></a>12627 {
<a name="l12628"></a>12628 
<a name="l12629"></a>12629     <span class="keywordflow">if</span> (USER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12630"></a>12630     <span class="keywordflow">if</span> (THE_BASKET.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;THE_BASKET&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12631"></a>12631     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12632"></a>12632     <span class="keywordflow">if</span> (0 &gt; MINIMUM_TRANSFER)  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MINIMUM_TRANSFER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12633"></a>12633 
<a name="l12634"></a>12634     <a class="code" href="class_o_t_string.html">OTString</a> strBasket(THE_BASKET);
<a name="l12635"></a>12635     <span class="comment">// ----------------------------------------------------</span>
<a name="l12636"></a>12636     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theUserID(USER_ID), theAssetTypeID(ASSET_TYPE_ID);
<a name="l12637"></a>12637     <span class="comment">// ----------------------------------------------</span>
<a name="l12638"></a>12638     int64_t lMinimumTransfer = MINIMUM_TRANSFER == 0 ? 10 : MINIMUM_TRANSFER;
<a name="l12639"></a>12639     <span class="comment">// ----------------------------------------------</span>
<a name="l12640"></a>12640     <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;
<a name="l12641"></a>12641 
<a name="l12642"></a>12642     <span class="keywordtype">bool</span> bAdded = <span class="keyword">false</span>;
<a name="l12643"></a>12643 
<a name="l12644"></a>12644     <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
<a name="l12645"></a>12645     <span class="comment">// Can&#39;t never be too sure.</span>
<a name="l12646"></a>12646     <span class="keywordflow">if</span> (theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strBasket))
<a name="l12647"></a>12647     {
<a name="l12648"></a>12648         bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a27cfd793ce09044f9364bee6e0bff7ad">AddBasketCreationItem</a>(theUserID, <span class="comment">// for signature.</span>
<a name="l12649"></a>12649             theBasket, <span class="comment">// created in above call.</span>
<a name="l12650"></a>12650             theAssetTypeID, <span class="comment">// Adding an asset type to the new basket.</span>
<a name="l12651"></a>12651             static_cast&lt;int64_t&gt;(lMinimumTransfer)); <span class="comment">// The amount of the asset type that is in the basket (per).</span>
<a name="l12652"></a>12652     }
<a name="l12653"></a>12653 
<a name="l12654"></a>12654     <span class="keywordflow">if</span> (<span class="keyword">false</span> == bAdded)
<a name="l12655"></a>12655         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l12656"></a>12656     <span class="comment">// ----------------------------------------</span>
<a name="l12657"></a>12657     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theBasket); <span class="comment">// Extract the updated basket to string form.</span>
<a name="l12658"></a>12658 
<a name="l12659"></a>12659     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l12660"></a>12660 
<a name="l12661"></a>12661     <span class="keywordflow">return</span> pBuf;
<a name="l12662"></a>12662 }
<a name="l12663"></a>12663 
<a name="l12664"></a>12664 
<a name="l12665"></a>12665 
<a name="l12666"></a>12666 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l12667"></a>12667 <span class="comment">// ISSUE BASKET CURRENCY</span>
<a name="l12668"></a>12668 <span class="comment">//</span>
<a name="l12669"></a>12669 <span class="comment">// Issue a new asset type based on a BASKET of other asset types!</span>
<a name="l12670"></a>12670 <span class="comment">// You cannot call this function until you first set up the BASKET_INFO object.</span>
<a name="l12671"></a>12671 <span class="comment">// I will provide functions for setting up that object, so that you can then</span>
<a name="l12672"></a>12672 <span class="comment">// call this function to actually message the server with your request.</span>
<a name="l12673"></a>12673 <span class="comment">//</span>
<a name="l12674"></a>12674 <span class="comment">// ANYONE can issue a new basket type, but they will have no control over the</span>
<a name="l12675"></a>12675 <span class="comment">// issuer account. Normally when issuing a currency, you therefore control the</span>
<a name="l12676"></a>12676 <span class="comment">// issuer account. But with baskets, that is managed internally by the server.</span>
<a name="l12677"></a>12677 <span class="comment">// This means anyone can define a basket, and all may use it -- but no one</span>
<a name="l12678"></a>12678 <span class="comment">// controls it except the server.</span>
<a name="l12679"></a>12679 <span class="comment">//</span>
<a name="l12680"></a>12680 <span class="comment">// Returns int32_t:</span>
<a name="l12681"></a>12681 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12682"></a>12682 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12683"></a>12683 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12684"></a>12684 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12685"></a>12685 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12686"></a>12686 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12687"></a>12687 <span class="comment">//</span>
<a name="l12688"></a><a class="code" href="class_o_t_a_p_i___exec.html#a56b0f22eb7eb90ec4c858ec204c92ab3">12688</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a56b0f22eb7eb90ec4c858ec204c92ab3">OTAPI_Exec::issueBasket</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12689"></a>12689                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12690"></a>12690                                 <span class="keyword">const</span> std::string &amp; THE_BASKET)
<a name="l12691"></a>12691 {
<a name="l12692"></a>12692     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12693"></a>12693     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12694"></a>12694     <span class="keywordflow">if</span> (THE_BASKET.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_BASKET&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12695"></a>12695 
<a name="l12696"></a>12696     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12697"></a>12697 
<a name="l12698"></a>12698     <a class="code" href="class_o_t_string.html">OTString</a> strBasketInfo(THE_BASKET);
<a name="l12699"></a>12699 
<a name="l12700"></a>12700     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ab691e0c2f1b8728b31babf07d958168a">issueBasket</a>(theServerID, theUserID, strBasketInfo);
<a name="l12701"></a>12701 }
<a name="l12702"></a>12702 
<a name="l12703"></a>12703 
<a name="l12704"></a>12704 
<a name="l12705"></a>12705 
<a name="l12706"></a>12706 
<a name="l12707"></a>12707 
<a name="l12708"></a>12708 
<a name="l12709"></a>12709 <span class="comment">// ----------------------------------------------------</span>
<a name="l12710"></a>12710 <span class="comment">// GENERATE BASKET EXCHANGE REQUEST</span>
<a name="l12711"></a>12711 <span class="comment">//</span>
<a name="l12712"></a>12712 <span class="comment">// (Returns the new basket exchange request in string form.)</span>
<a name="l12713"></a>12713 <span class="comment">//</span>
<a name="l12714"></a>12714 <span class="comment">// Call this function first. Then call OTAPI_Exec::AddBasketExchangeItem</span>
<a name="l12715"></a>12715 <span class="comment">// multiple times, and then finally call OTAPI_Exec::exchangeBasket to</span>
<a name="l12716"></a>12716 <span class="comment">// send the request to the server.</span>
<a name="l12717"></a>12717 <span class="comment">//</span>
<a name="l12718"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae5bbfef608110f122e8bb29da971ad5e">12718</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ae5bbfef608110f122e8bb29da971ad5e">OTAPI_Exec::GenerateBasketExchange</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12719"></a>12719                                           <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12720"></a>12720                                           <span class="keyword">const</span> std::string &amp; BASKET_ASSET_TYPE_ID,
<a name="l12721"></a>12721                                           <span class="keyword">const</span> std::string &amp; BASKET_ASSET_ACCT_ID,
<a name="l12722"></a>12722                                            <span class="comment">// -------------------------------------</span>
<a name="l12723"></a>12723                                            <span class="keyword">const</span> int32_t &amp; TRANSFER_MULTIPLE)   <span class="comment">// 1            2            3</span>
<a name="l12724"></a>12724                                            <span class="comment">// 5=2,3,4  OR  10=4,6,8  OR 15=6,9,12</span>
<a name="l12725"></a>12725 {
<a name="l12726"></a>12726     <span class="keywordflow">if</span> (SERVER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>           ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12727"></a>12727     <span class="keywordflow">if</span> (USER_ID.empty())              { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12728"></a>12728     <span class="keywordflow">if</span> (BASKET_ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_TYPE_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12729"></a>12729     <span class="keywordflow">if</span> (BASKET_ASSET_ACCT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_ACCT_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12730"></a>12730 
<a name="l12731"></a>12731     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theUserID(USER_ID), theServerID(SERVER_ID),
<a name="l12732"></a>12732                         theBasketAssetTypeID(BASKET_ASSET_TYPE_ID),
<a name="l12733"></a>12733                         theBasketAssetAcctID(BASKET_ASSET_ACCT_ID);
<a name="l12734"></a>12734     <span class="comment">// ----------------------------------------------</span>
<a name="l12735"></a>12735     int32_t nTransferMultiple = 1; <span class="comment">// Just a default value.</span>
<a name="l12736"></a>12736 
<a name="l12737"></a>12737     <span class="keywordflow">if</span> (TRANSFER_MULTIPLE &gt; 0)
<a name="l12738"></a>12738         nTransferMultiple = TRANSFER_MULTIPLE;
<a name="l12739"></a>12739     <span class="comment">// ----------------------------------------------</span>
<a name="l12740"></a>12740     <a class="code" href="class_o_t_basket.html">OTBasket</a> * pBasket = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a25e69e50ec485944c6031a5a9511e570">GenerateBasketExchange</a>(theServerID,
<a name="l12741"></a>12741         theUserID,
<a name="l12742"></a>12742         theBasketAssetTypeID,
<a name="l12743"></a>12743         theBasketAssetAcctID,
<a name="l12744"></a>12744         nTransferMultiple); <span class="comment">// 1            2            3</span>
<a name="l12745"></a>12745     <span class="comment">// 5=2,3,4  OR  10=4,6,8  OR 15=6,9,12</span>
<a name="l12746"></a>12746     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTBasket&gt;</a> theAngel(pBasket);
<a name="l12747"></a>12747 
<a name="l12748"></a>12748     <span class="keywordflow">if</span> (NULL == pBasket)
<a name="l12749"></a>12749         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l12750"></a>12750 
<a name="l12751"></a>12751     <span class="comment">// At this point, I know pBasket is good (and will be cleaned up automatically.)</span>
<a name="l12752"></a>12752     <span class="comment">// ----------------------------------------------</span>
<a name="l12753"></a>12753     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pBasket); <span class="comment">// Extract the basket to string form.</span>
<a name="l12754"></a>12754 
<a name="l12755"></a>12755     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l12756"></a>12756 
<a name="l12757"></a>12757     <span class="keywordflow">return</span> pBuf;
<a name="l12758"></a>12758 }
<a name="l12759"></a>12759 
<a name="l12760"></a>12760 <span class="comment">// ----------------------------------------------------</span>
<a name="l12761"></a>12761 <span class="comment">// ADD BASKET EXCHANGE ITEM</span>
<a name="l12762"></a>12762 <span class="comment">//</span>
<a name="l12763"></a>12763 <span class="comment">// Returns the updated basket exchange request in string form.</span>
<a name="l12764"></a>12764 <span class="comment">// (Or &quot;&quot;.)</span>
<a name="l12765"></a>12765 <span class="comment">//</span>
<a name="l12766"></a>12766 <span class="comment">// Call the above function first. Then call this one multiple</span>
<a name="l12767"></a>12767 <span class="comment">// times, and then finally call OTAPI_Exec::exchangeBasket to send</span>
<a name="l12768"></a>12768 <span class="comment">// the request to the server.</span>
<a name="l12769"></a>12769 <span class="comment">//</span>
<a name="l12770"></a><a class="code" href="class_o_t_a_p_i___exec.html#a278c992b2b6066acb57a0f6d5910aee4">12770</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a278c992b2b6066acb57a0f6d5910aee4">OTAPI_Exec::AddBasketExchangeItem</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12771"></a>12771                                               <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12772"></a>12772                                               <span class="keyword">const</span> std::string &amp; THE_BASKET,
<a name="l12773"></a>12773                                               <span class="keyword">const</span> std::string &amp; ASSET_TYPE_ID,
<a name="l12774"></a>12774                                               <span class="keyword">const</span> std::string &amp; ASSET_ACCT_ID)
<a name="l12775"></a>12775 {
<a name="l12776"></a>12776     <span class="keywordflow">if</span> (SERVER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12777"></a>12777     <span class="keywordflow">if</span> (USER_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12778"></a>12778     <span class="keywordflow">if</span> (THE_BASKET.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_BASKET&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12779"></a>12779     <span class="keywordflow">if</span> (ASSET_TYPE_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12780"></a>12780     <span class="keywordflow">if</span> (ASSET_ACCT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ACCT_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12781"></a>12781 
<a name="l12782"></a>12782     <a class="code" href="class_o_t_string.html">OTString</a> strBasket(THE_BASKET);
<a name="l12783"></a>12783     <span class="comment">// ----------------------------------------------------</span>
<a name="l12784"></a>12784     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID),
<a name="l12785"></a>12785                         theAssetTypeID(ASSET_TYPE_ID),
<a name="l12786"></a>12786                         theAssetAcctID(ASSET_ACCT_ID);
<a name="l12787"></a>12787     <span class="comment">// ----------------------------------------------</span>
<a name="l12788"></a>12788     <a class="code" href="class_o_t_basket.html">OTBasket</a> theBasket;
<a name="l12789"></a>12789 
<a name="l12790"></a>12790     <span class="keywordtype">bool</span> bAdded = <span class="keyword">false</span>;
<a name="l12791"></a>12791 
<a name="l12792"></a>12792     <span class="comment">// todo perhaps verify the basket here, even though I already verified the asset contract itself...</span>
<a name="l12793"></a>12793     <span class="comment">// Can&#39;t never be too sure.</span>
<a name="l12794"></a>12794     <span class="keywordflow">if</span> (theBasket.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strBasket))
<a name="l12795"></a>12795     {
<a name="l12796"></a>12796         bAdded = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a9257737bcd43f36e8426b5d5bfb67a7b">AddBasketExchangeItem</a>(theServerID,
<a name="l12797"></a>12797             theUserID,
<a name="l12798"></a>12798             theBasket,
<a name="l12799"></a>12799             theAssetTypeID,
<a name="l12800"></a>12800             theAssetAcctID);
<a name="l12801"></a>12801     }
<a name="l12802"></a>12802 
<a name="l12803"></a>12803     <span class="keywordflow">if</span> (<span class="keyword">false</span> == bAdded)
<a name="l12804"></a>12804         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l12805"></a>12805 
<a name="l12806"></a>12806     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theBasket); <span class="comment">// Extract the updated basket to string form.</span>
<a name="l12807"></a>12807 
<a name="l12808"></a>12808     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l12809"></a>12809 
<a name="l12810"></a>12810     <span class="keywordflow">return</span> pBuf;
<a name="l12811"></a>12811 }
<a name="l12812"></a>12812 
<a name="l12813"></a>12813 
<a name="l12814"></a>12814 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l12815"></a>12815 <span class="comment">// EXCHANGE BASKET</span>
<a name="l12816"></a>12816 <span class="comment">//</span>
<a name="l12817"></a>12817 <span class="comment">// Send a request to the server asking to exchange in or out of a basket</span>
<a name="l12818"></a>12818 <span class="comment">// currency.</span>
<a name="l12819"></a>12819 <span class="comment">//</span>
<a name="l12820"></a>12820 <span class="comment">// For example, maybe you have 3 gold, 2 silver, and 5 dollars, and those are</span>
<a name="l12821"></a>12821 <span class="comment">// the ingredients of the &quot;Rand&quot; basket currency. This message allows you to</span>
<a name="l12822"></a>12822 <span class="comment">// ask the server to convert from your gold, silver, and dollar accounts into</span>
<a name="l12823"></a>12823 <span class="comment">// your Rand account. (Or convert from your Rand account back into your gold,</span>
<a name="l12824"></a>12824 <span class="comment">// silver, and dollar accounts.)</span>
<a name="l12825"></a>12825 <span class="comment">//</span>
<a name="l12826"></a>12826 <span class="comment">// Other than this conversion process, (with the reserves stored internally by</span>
<a name="l12827"></a>12827 <span class="comment">// the server) basket accounts are identical to normal asset accounts -- they</span>
<a name="l12828"></a>12828 <span class="comment">// are merely another asset type ID, and you can use them the same as you would</span>
<a name="l12829"></a>12829 <span class="comment">// use any other asset type (open accounts, write cheques, withdraw cash, trade</span>
<a name="l12830"></a>12830 <span class="comment">// on markets, etc.)</span>
<a name="l12831"></a>12831 <span class="comment">//</span>
<a name="l12832"></a>12832 <span class="comment">// Returns int32_t:</span>
<a name="l12833"></a>12833 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12834"></a>12834 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12835"></a>12835 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12836"></a>12836 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12837"></a>12837 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12838"></a>12838 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12839"></a>12839 <span class="comment">//</span>
<a name="l12840"></a>12840 
<a name="l12841"></a><a class="code" href="class_o_t_a_p_i___exec.html#af33eafc3822332f38a50b4018395478b">12841</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af33eafc3822332f38a50b4018395478b">OTAPI_Exec::exchangeBasket</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12842"></a>12842                                    <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12843"></a>12843                                    <span class="keyword">const</span> std::string &amp; BASKET_ASSET_ID,
<a name="l12844"></a>12844                                    <span class="keyword">const</span> std::string &amp; THE_BASKET,
<a name="l12845"></a>12845                                    <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; BOOL_EXCHANGE_IN_OR_OUT) <span class="comment">// exchanging in == true (1), out == false (0).</span>
<a name="l12846"></a>12846 {
<a name="l12847"></a>12847     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12848"></a>12848     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12849"></a>12849     <span class="keywordflow">if</span> (BASKET_ASSET_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BASKET_ASSET_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12850"></a>12850     <span class="keywordflow">if</span> (THE_BASKET.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_BASKET&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12851"></a>12851 
<a name="l12852"></a>12852     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != BOOL_EXCHANGE_IN_OR_OUT ) &amp;&amp; (<span class="keyword">false</span> != BOOL_EXCHANGE_IN_OR_OUT ) ) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;BOOL_EXCHANGE_IN_OR_OUT&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12853"></a>12853 
<a name="l12854"></a>12854     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theBasketAssetID(BASKET_ASSET_ID);
<a name="l12855"></a>12855 
<a name="l12856"></a>12856     <a class="code" href="class_o_t_string.html">OTString</a> strBasketInfo(THE_BASKET);
<a name="l12857"></a>12857 
<a name="l12858"></a>12858     <span class="comment">// exchanging in == true, out == false.</span>
<a name="l12859"></a>12859     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bExchangeInOrOut = ((<span class="keyword">true</span> == BOOL_EXCHANGE_IN_OR_OUT) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l12860"></a>12860 
<a name="l12861"></a>12861     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aac6fa94e53c2fd89cd398965282be272">exchangeBasket</a>(theServerID, theUserID, theBasketAssetID, strBasketInfo, bExchangeInOrOut);
<a name="l12862"></a>12862 }
<a name="l12863"></a>12863 
<a name="l12864"></a>12864 <span class="comment">// ----------------------------------------------------</span>
<a name="l12865"></a>12865 
<a name="l12866"></a>12866 
<a name="l12867"></a>12867 
<a name="l12868"></a>12868 
<a name="l12869"></a>12869 
<a name="l12870"></a>12870 
<a name="l12871"></a>12871 
<a name="l12872"></a>12872 
<a name="l12873"></a>12873 
<a name="l12874"></a>12874 
<a name="l12875"></a>12875 <span class="comment">// Returns int32_t:</span>
<a name="l12876"></a>12876 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12877"></a>12877 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12878"></a>12878 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12879"></a>12879 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12880"></a>12880 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12881"></a>12881 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12882"></a>12882 <span class="comment">//</span>
<a name="l12883"></a><a class="code" href="class_o_t_a_p_i___exec.html#a89358c9cc2fa0dcfff007c3bcbc2ed5c">12883</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a89358c9cc2fa0dcfff007c3bcbc2ed5c">OTAPI_Exec::getTransactionNumber</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12884"></a>12884                                 <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l12885"></a>12885 {
<a name="l12886"></a>12886     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12887"></a>12887     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12888"></a>12888 
<a name="l12889"></a>12889     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12890"></a>12890 
<a name="l12891"></a>12891 
<a name="l12892"></a>12892     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afd2344eb8007c310ada18aaafa70eb67">getTransactionNumber</a>(theServerID, theUserID);
<a name="l12893"></a>12893 }
<a name="l12894"></a>12894 
<a name="l12895"></a>12895 
<a name="l12896"></a>12896 <span class="comment">// Returns int32_t:</span>
<a name="l12897"></a>12897 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12898"></a>12898 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12899"></a>12899 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12900"></a>12900 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12901"></a>12901 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12902"></a>12902 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12903"></a>12903 <span class="comment">//</span>
<a name="l12904"></a><a class="code" href="class_o_t_a_p_i___exec.html#aff10a3fbcf70deccbce6ead956bc9d63">12904</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#aff10a3fbcf70deccbce6ead956bc9d63">OTAPI_Exec::notarizeWithdrawal</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12905"></a>12905                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12906"></a>12906                              <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l12907"></a>12907                              <span class="keyword">const</span> int64_t &amp; AMOUNT)
<a name="l12908"></a>12908 {
<a name="l12909"></a>12909     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12910"></a>12910     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12911"></a>12911     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12912"></a>12912     <span class="keywordflow">if</span> (0 &gt; AMOUNT)                 { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AMOUNT&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12913"></a>12913 
<a name="l12914"></a>12914     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l12915"></a>12915 
<a name="l12916"></a>12916     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a598ad655514570fcbcc615709251c7e4">notarizeWithdrawal</a>(theServerID, theUserID, theAcctID, static_cast&lt;int64_t&gt;(AMOUNT));
<a name="l12917"></a>12917 }
<a name="l12918"></a>12918 
<a name="l12919"></a>12919 
<a name="l12920"></a>12920 <span class="comment">// Returns int32_t:</span>
<a name="l12921"></a>12921 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12922"></a>12922 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12923"></a>12923 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12924"></a>12924 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12925"></a>12925 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12926"></a>12926 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12927"></a>12927 <span class="comment">//</span>
<a name="l12928"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab9ead57ad3597f23d1dfdf548c8d4a74">12928</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ab9ead57ad3597f23d1dfdf548c8d4a74">OTAPI_Exec::notarizeDeposit</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12929"></a>12929                           <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12930"></a>12930                           <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l12931"></a>12931                           <span class="keyword">const</span> std::string &amp; THE_PURSE)
<a name="l12932"></a>12932 {
<a name="l12933"></a>12933     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12934"></a>12934     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12935"></a>12935     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12936"></a>12936     <span class="keywordflow">if</span> (THE_PURSE.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PURSE&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12937"></a>12937 
<a name="l12938"></a>12938     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l12939"></a>12939     <a class="code" href="class_o_t_string.html">OTString</a> strPurse(THE_PURSE);
<a name="l12940"></a>12940 
<a name="l12941"></a>12941     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a02e42976ba8ca2b4a667c97c94199780">notarizeDeposit</a>(theServerID, theUserID, theAcctID, strPurse);
<a name="l12942"></a>12942 }
<a name="l12943"></a>12943 
<a name="l12944"></a>12944 
<a name="l12945"></a>12945 <span class="comment">// Returns int32_t:</span>
<a name="l12946"></a>12946 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12947"></a>12947 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12948"></a>12948 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12949"></a>12949 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12950"></a>12950 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12951"></a>12951 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12952"></a>12952 <span class="comment">//</span>
<a name="l12953"></a><a class="code" href="class_o_t_a_p_i___exec.html#ada681fe672dc6e9c5dfa2273dc3d797d">12953</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ada681fe672dc6e9c5dfa2273dc3d797d">OTAPI_Exec::notarizeTransfer</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12954"></a>12954                             <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12955"></a>12955                             <span class="keyword">const</span> std::string &amp; ACCT_FROM,
<a name="l12956"></a>12956                             <span class="keyword">const</span> std::string &amp; ACCT_TO,
<a name="l12957"></a>12957                             <span class="keyword">const</span> int64_t &amp; AMOUNT,
<a name="l12958"></a>12958                             <span class="keyword">const</span> std::string &amp; NOTE)
<a name="l12959"></a>12959 {
<a name="l12960"></a>12960     <span class="keywordflow">if</span> (SERVER_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12961"></a>12961     <span class="keywordflow">if</span> (USER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12962"></a>12962     <span class="keywordflow">if</span> (ACCT_FROM.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ACCT_FROM&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12963"></a>12963     <span class="keywordflow">if</span> (ACCT_TO.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ACCT_TO&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12964"></a>12964     <span class="keywordflow">if</span> (0 &gt; AMOUNT)        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AMOUNT&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12965"></a>12965 
<a name="l12966"></a>12966     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l12967"></a>12967     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theFromAcct(ACCT_FROM), theToAcct(ACCT_TO);
<a name="l12968"></a>12968 
<a name="l12969"></a>12969     <a class="code" href="class_o_t_string.html">OTString</a> strNote(NOTE.empty() ? <span class="stringliteral">&quot;&quot;</span> : NOTE);
<a name="l12970"></a>12970 
<a name="l12971"></a>12971     int64_t lAmount = AMOUNT;
<a name="l12972"></a>12972 
<a name="l12973"></a>12973     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a10d6c5c156dfe6cf66860c3aa62e5fc0">notarizeTransfer</a>(theServerID, theUserID, theFromAcct, theToAcct, static_cast&lt;int64_t&gt;(lAmount), strNote);
<a name="l12974"></a>12974 }
<a name="l12975"></a>12975 
<a name="l12976"></a>12976 
<a name="l12977"></a>12977 <span class="comment">// Returns int32_t:</span>
<a name="l12978"></a>12978 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l12979"></a>12979 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l12980"></a>12980 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l12981"></a>12981 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l12982"></a>12982 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l12983"></a>12983 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l12984"></a>12984 <span class="comment">//</span>
<a name="l12985"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab6e791d8ddd8345831b8618afd635f38">12985</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ab6e791d8ddd8345831b8618afd635f38">OTAPI_Exec::getInbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l12986"></a>12986                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l12987"></a>12987                     <span class="keyword">const</span> std::string &amp; ACCT_ID)
<a name="l12988"></a>12988 {
<a name="l12989"></a>12989     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12990"></a>12990     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12991"></a>12991     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l12992"></a>12992 
<a name="l12993"></a>12993     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l12994"></a>12994 
<a name="l12995"></a>12995     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8bc5ab412574867dd506207e311d0fa2">getInbox</a>(theServerID, theUserID, theAcctID);
<a name="l12996"></a>12996 }
<a name="l12997"></a>12997 
<a name="l12998"></a>12998 
<a name="l12999"></a>12999 <span class="comment">// Returns int32_t:</span>
<a name="l13000"></a>13000 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13001"></a>13001 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13002"></a>13002 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13003"></a>13003 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13004"></a>13004 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13005"></a>13005 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13006"></a>13006 <span class="comment">//</span>
<a name="l13007"></a><a class="code" href="class_o_t_a_p_i___exec.html#a69bce6a3205dbd153104c79e0b9f0202">13007</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a69bce6a3205dbd153104c79e0b9f0202">OTAPI_Exec::getNymbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13008"></a>13008                     <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13009"></a>13009 {
<a name="l13010"></a>13010     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13011"></a>13011     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13012"></a>13012 
<a name="l13013"></a>13013     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13014"></a>13014 
<a name="l13015"></a>13015     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a2536b41070f3a165345ae598381ddfdd">getNymbox</a>(theServerID, theUserID);
<a name="l13016"></a>13016 }
<a name="l13017"></a>13017 
<a name="l13018"></a>13018 
<a name="l13019"></a>13019 <span class="comment">// Returns int32_t:</span>
<a name="l13020"></a>13020 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13021"></a>13021 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13022"></a>13022 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13023"></a>13023 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13024"></a>13024 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13025"></a>13025 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13026"></a>13026 <span class="comment">//</span>
<a name="l13027"></a><a class="code" href="class_o_t_a_p_i___exec.html#af13f8f83d370e8b18ad2de97181a5dfa">13027</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af13f8f83d370e8b18ad2de97181a5dfa">OTAPI_Exec::getOutbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13028"></a>13028                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13029"></a>13029                     <span class="keyword">const</span> std::string &amp; ACCT_ID)
<a name="l13030"></a>13030 {
<a name="l13031"></a>13031     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13032"></a>13032     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13033"></a>13033     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13034"></a>13034 
<a name="l13035"></a>13035     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l13036"></a>13036 
<a name="l13037"></a>13037     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#afca788fa27e0d4988a5c09586fe23237">getOutbox</a>(theServerID, theUserID, theAcctID);
<a name="l13038"></a>13038 }
<a name="l13039"></a>13039 
<a name="l13040"></a>13040 
<a name="l13041"></a>13041 <span class="comment">// Returns int32_t:</span>
<a name="l13042"></a>13042 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13043"></a>13043 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13044"></a>13044 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13045"></a>13045 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13046"></a>13046 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13047"></a>13047 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13048"></a>13048 <span class="comment">//</span>
<a name="l13049"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab0f854984189e4ed4c309cff726f9ab4">13049</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ab0f854984189e4ed4c309cff726f9ab4">OTAPI_Exec::processInbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13050"></a>13050                         <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13051"></a>13051                         <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l13052"></a>13052                         <span class="keyword">const</span> std::string &amp; ACCT_LEDGER)
<a name="l13053"></a>13053 {
<a name="l13054"></a>13054     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13055"></a>13055     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13056"></a>13056     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13057"></a>13057     <span class="keywordflow">if</span> (ACCT_LEDGER.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_LEDGER&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13058"></a>13058 
<a name="l13059"></a>13059 <span class="comment">//  OTLog::vOutput(0, &quot;%s: \n&quot;</span>
<a name="l13060"></a>13060 <span class="comment">//      &quot;SERVER_ID: %s \n&quot;</span>
<a name="l13061"></a>13061 <span class="comment">//      &quot;USER_ID: %s \n&quot;</span>
<a name="l13062"></a>13062 <span class="comment">//      &quot;ACCT_ID: %s \n&quot;</span>
<a name="l13063"></a>13063 <span class="comment">//      &quot;ACCT_LEDGER:\n%s\n\n&quot;,</span>
<a name="l13064"></a>13064 <span class="comment">//      __FUNCTION__, SERVER_ID.c_str(), USER_ID.c_str(), ACCT_ID.c_str(), ACCT_LEDGER.c_str());</span>
<a name="l13065"></a>13065 
<a name="l13066"></a>13066     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID), theUserID(USER_ID), theAcctID(ACCT_ID);
<a name="l13067"></a>13067     <a class="code" href="class_o_t_string.html">OTString</a>        strLedger(ACCT_LEDGER);
<a name="l13068"></a>13068 
<a name="l13069"></a>13069 <span class="comment">//  OTString temp1(SERVER_ID), temp2(USER_ID), temp3(ACCT_ID), temp4(ACCT_LEDGER);</span>
<a name="l13070"></a>13070 <span class="comment">//  OTLog::vOutput(0,  &quot;%s: \n&quot;</span>
<a name="l13071"></a>13071 <span class="comment">//      &quot;\n\nSERVER_ID: %s \n&quot;</span>
<a name="l13072"></a>13072 <span class="comment">//      &quot;USER_ID: %s \n&quot;</span>
<a name="l13073"></a>13073 <span class="comment">//      &quot;ACCT_ID: %s \n&quot;</span>
<a name="l13074"></a>13074 <span class="comment">//      &quot;ACCT_LEDGER:\n%s\n\n&quot;,</span>
<a name="l13075"></a>13075 <span class="comment">//      __FUNCTION__, temp1.Get(), temp2.Get(), temp3.Get(), temp4.Get());</span>
<a name="l13076"></a>13076 
<a name="l13077"></a>13077     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a937dc63294d4d989c0f691b6f12287df">processInbox</a>(theServerID, theUserID, theAcctID, strLedger);
<a name="l13078"></a>13078 }
<a name="l13079"></a>13079 
<a name="l13080"></a>13080 
<a name="l13081"></a>13081 <span class="comment">// Returns:</span>
<a name="l13082"></a>13082 <span class="comment">// -1 if error.</span>
<a name="l13083"></a>13083 <span class="comment">//  0 if Nymbox is empty.</span>
<a name="l13084"></a>13084 <span class="comment">//  1 or more: (OLD: Count of items in Nymbox before processing.)</span>
<a name="l13085"></a>13085 <span class="comment">//  UPDATE: This now returns the request number of the message sent, if success.</span>
<a name="l13086"></a>13086 <span class="comment">//</span>
<a name="l13087"></a><a class="code" href="class_o_t_a_p_i___exec.html#a05803277a289a947cb936eb7dd3626d8">13087</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a05803277a289a947cb936eb7dd3626d8">OTAPI_Exec::processNymbox</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13088"></a>13088                         <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13089"></a>13089 {
<a name="l13090"></a>13090     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13091"></a>13091     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13092"></a>13092 
<a name="l13093"></a>13093     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13094"></a>13094 
<a name="l13095"></a>13095     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aafe1988e1f3029dc633666816ccee743">processNymbox</a>(theServerID, theUserID);
<a name="l13096"></a>13096 }
<a name="l13097"></a>13097 
<a name="l13098"></a>13098 
<a name="l13099"></a>13099 <span class="comment">// Returns int32_t:</span>
<a name="l13100"></a>13100 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13101"></a>13101 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13102"></a>13102 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13103"></a>13103 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13104"></a>13104 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13105"></a>13105 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13106"></a>13106 <span class="comment">//</span>
<a name="l13107"></a><a class="code" href="class_o_t_a_p_i___exec.html#a141b6f08b693940b3cc24797d9fdaa92">13107</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a141b6f08b693940b3cc24797d9fdaa92">OTAPI_Exec::withdrawVoucher</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13108"></a>13108                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13109"></a>13109                                     <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l13110"></a>13110                                     <span class="keyword">const</span> std::string &amp; RECIPIENT_USER_ID,
<a name="l13111"></a>13111                                     <span class="keyword">const</span> std::string &amp; CHEQUE_MEMO,
<a name="l13112"></a>13112                                     <span class="keyword">const</span> int64_t     &amp; AMOUNT)
<a name="l13113"></a>13113 {
<a name="l13114"></a>13114     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13115"></a>13115     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13116"></a>13116     <span class="keywordflow">if</span> (ACCT_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13117"></a>13117     <span class="keywordflow">if</span> (RECIPIENT_USER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;RECIPIENT_USER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13118"></a>13118 <span class="comment">//  if (CHEQUE_MEMO.empty())        { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;,     __FUNCTION__, &quot;CHEQUE_MEMO&quot;        ); OT_FAIL; }</span>
<a name="l13119"></a>13119     <span class="keywordflow">if</span> (0 &gt; AMOUNT)                 { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AMOUNT&quot;</span>             ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13120"></a>13120 
<a name="l13121"></a>13121     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID), theUserID(USER_ID),
<a name="l13122"></a>13122                     theAcctID(ACCT_ID),     theRecipientUserID(RECIPIENT_USER_ID);
<a name="l13123"></a>13123 
<a name="l13124"></a>13124     <a class="code" href="class_o_t_string.html">OTString</a> strMemo(CHEQUE_MEMO);
<a name="l13125"></a>13125     int64_t  lAmount = AMOUNT;
<a name="l13126"></a>13126 
<a name="l13127"></a>13127     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a7157cd6bf562305e24867b9521188a3c">withdrawVoucher</a>(theServerID, theUserID, theAcctID, theRecipientUserID, strMemo, static_cast&lt;int64_t&gt;(lAmount));
<a name="l13128"></a>13128 }
<a name="l13129"></a>13129 
<a name="l13130"></a>13130 
<a name="l13131"></a>13131 <span class="comment">// PAY DIVIDEND -- to shareholders</span>
<a name="l13132"></a>13132 <span class="comment">//</span>
<a name="l13133"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7a7dbdb89197a47d1c62887b67d0054e">13133</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a7a7dbdb89197a47d1c62887b67d0054e" title="PAY DIVIDEND -- to shareholders.">OTAPI_Exec::payDividend</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13134"></a>13134                       <span class="keyword">const</span> std::string &amp; ISSUER_USER_ID,        <span class="comment">// must be issuer of SHARES_ASSET_TYPE_ID</span>
<a name="l13135"></a>13135                       <span class="keyword">const</span> std::string &amp; DIVIDEND_FROM_ACCT_ID, <span class="comment">// if dollars paid for pepsi shares, then this is the issuer&#39;s dollars account.</span>
<a name="l13136"></a>13136                       <span class="keyword">const</span> std::string &amp; SHARES_ASSET_TYPE_ID,  <span class="comment">// if dollars paid for pepsi shares, then this is the pepsi shares asset type id.</span>
<a name="l13137"></a>13137                       <span class="keyword">const</span> std::string &amp; DIVIDEND_MEMO,         <span class="comment">// user-configurable note that&#39;s added to the payout request message.</span>
<a name="l13138"></a>13138                       <span class="keyword">const</span> int64_t     &amp; AMOUNT_PER_SHARE)      <span class="comment">// number of dollars to be paid out PER SHARE (multiplied by total number of shares issued.)</span>
<a name="l13139"></a>13139 {
<a name="l13140"></a>13140     <span class="keywordflow">if</span> (SERVER_ID.empty())             { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13141"></a>13141     <span class="keywordflow">if</span> (ISSUER_USER_ID.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ISSUER_USER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13142"></a>13142     <span class="keywordflow">if</span> (DIVIDEND_FROM_ACCT_ID.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;DIVIDEND_FROM_ACCT_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13143"></a>13143     <span class="keywordflow">if</span> (SHARES_ASSET_TYPE_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;SHARES_ASSET_TYPE_ID&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13144"></a>13144 <span class="comment">//  if (DIVIDEND_MEMO.empty())         { OTLog::vError(&quot;%s: Null: %s passed in!\n&quot;,     __FUNCTION__, &quot;DIVIDEND_MEMO&quot;        ); OT_FAIL; }</span>
<a name="l13145"></a>13145     <span class="keywordflow">if</span> (0 &gt; AMOUNT_PER_SHARE)          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;AMOUNT_PER_SHARE&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13146"></a>13146 
<a name="l13147"></a>13147     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID           (SERVER_ID),
<a name="l13148"></a>13148                     theIssuerUserID       (ISSUER_USER_ID),
<a name="l13149"></a>13149                     theDividendFromAcctID (DIVIDEND_FROM_ACCT_ID),
<a name="l13150"></a>13150                     theSharesAssetTypeID  (SHARES_ASSET_TYPE_ID);
<a name="l13151"></a>13151 
<a name="l13152"></a>13152     <a class="code" href="class_o_t_string.html">OTString</a>  strMemo  (DIVIDEND_MEMO);
<a name="l13153"></a>13153     int64_t   lAmount = AMOUNT_PER_SHARE;
<a name="l13154"></a>13154 
<a name="l13155"></a>13155     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a867538fd96d36fc772d94cffef2e8d47">payDividend</a>(theServerID,
<a name="l13156"></a>13156         theIssuerUserID,
<a name="l13157"></a>13157         theDividendFromAcctID,
<a name="l13158"></a>13158         theSharesAssetTypeID,
<a name="l13159"></a>13159         strMemo,
<a name="l13160"></a>13160         static_cast&lt;int64_t&gt;(lAmount));
<a name="l13161"></a>13161 }
<a name="l13162"></a>13162 
<a name="l13163"></a>13163 
<a name="l13164"></a>13164 
<a name="l13165"></a>13165 <span class="comment">// Returns int32_t:</span>
<a name="l13166"></a>13166 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13167"></a>13167 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13168"></a>13168 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13169"></a>13169 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13170"></a>13170 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13171"></a>13171 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13172"></a>13172 <span class="comment">//</span>
<a name="l13173"></a><a class="code" href="class_o_t_a_p_i___exec.html#a7e6d6c5b53a6688f743189efb6008381">13173</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a7e6d6c5b53a6688f743189efb6008381">OTAPI_Exec::depositCheque</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13174"></a>13174                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13175"></a>13175                                   <span class="keyword">const</span> std::string &amp; ACCT_ID,
<a name="l13176"></a>13176                                   <span class="keyword">const</span> std::string &amp; THE_CHEQUE)
<a name="l13177"></a>13177 {
<a name="l13178"></a>13178     <span class="keywordflow">if</span> (SERVER_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13179"></a>13179     <span class="keywordflow">if</span> (USER_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13180"></a>13180     <span class="keywordflow">if</span> (ACCT_ID.empty())    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCT_ID&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13181"></a>13181     <span class="keywordflow">if</span> (THE_CHEQUE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_CHEQUE&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13182"></a>13182 
<a name="l13183"></a>13183     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID),
<a name="l13184"></a>13184                  theUserID(USER_ID),
<a name="l13185"></a>13185                  theAcctID(ACCT_ID);
<a name="l13186"></a>13186 
<a name="l13187"></a>13187     <a class="code" href="class_o_t_string.html">OTString</a> strCheque(THE_CHEQUE);
<a name="l13188"></a>13188 
<a name="l13189"></a>13189     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1216782dbd78afbf72e269e81c936c6b">depositCheque</a>(theServerID, theUserID, theAcctID, strCheque);
<a name="l13190"></a>13190 }
<a name="l13191"></a>13191 
<a name="l13192"></a>13192 
<a name="l13193"></a>13193 
<a name="l13194"></a>13194 
<a name="l13195"></a>13195 <span class="comment">// --------------------------------------------------</span>
<a name="l13196"></a>13196 <span class="comment">// DEPOSIT PAYMENT PLAN</span>
<a name="l13197"></a>13197 <span class="comment">//</span>
<a name="l13198"></a>13198 <span class="comment">// See OTAPI_Exec::WritePaymentPlan as well.</span>
<a name="l13199"></a>13199 <span class="comment">//</span>
<a name="l13200"></a>13200 <span class="comment">// Returns int32_t:</span>
<a name="l13201"></a>13201 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13202"></a>13202 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13203"></a>13203 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13204"></a>13204 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13205"></a>13205 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13206"></a>13206 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13207"></a>13207 <span class="comment">//</span>
<a name="l13208"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac3d0dbc91bb09c6979a8a9586bf25f4e">13208</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ac3d0dbc91bb09c6979a8a9586bf25f4e">OTAPI_Exec::depositPaymentPlan</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13209"></a>13209                                        <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13210"></a>13210                                        <span class="keyword">const</span> std::string &amp; THE_PAYMENT_PLAN)
<a name="l13211"></a>13211 {
<a name="l13212"></a>13212     <span class="keywordflow">if</span> (SERVER_ID.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13213"></a>13213     <span class="keywordflow">if</span> (USER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13214"></a>13214     <span class="keywordflow">if</span> (THE_PAYMENT_PLAN.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_PAYMENT_PLAN&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13215"></a>13215 
<a name="l13216"></a>13216     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13217"></a>13217     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strPlan(THE_PAYMENT_PLAN);
<a name="l13218"></a>13218 
<a name="l13219"></a>13219     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a4b11c8f60024b34f43c9a9132fe8ac65">depositPaymentPlan</a>(theServerID, theUserID, strPlan);
<a name="l13220"></a>13220 }
<a name="l13221"></a>13221 
<a name="l13222"></a>13222 
<a name="l13223"></a>13223 
<a name="l13224"></a>13224 <span class="comment">// DONE: Remove Market ID.</span>
<a name="l13225"></a>13225 <span class="comment">// DONE: Change inner call from cancelNymMarketOffer to cancelCronItem</span>
<a name="l13226"></a>13226 <span class="comment">// DONE: Make a copy of this function called cancelPaymentPlan.</span>
<a name="l13227"></a>13227 <span class="comment">//</span>
<a name="l13228"></a>13228 <span class="comment">// Returns int32_t:</span>
<a name="l13229"></a>13229 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13230"></a>13230 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13231"></a>13231 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13232"></a>13232 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13233"></a>13233 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13234"></a>13234 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13235"></a>13235 <span class="comment">//</span>
<a name="l13236"></a><a class="code" href="class_o_t_a_p_i___exec.html#a3c094e341789c8f2442d519a0b89163b">13236</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a3c094e341789c8f2442d519a0b89163b">OTAPI_Exec::killMarketOffer</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13237"></a>13237                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13238"></a>13238                                     <span class="keyword">const</span> std::string &amp; ASSET_ACCT_ID,
<a name="l13239"></a>13239                                     <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER)
<a name="l13240"></a>13240 {
<a name="l13241"></a>13241     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13242"></a>13242     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13243"></a>13243     <span class="keywordflow">if</span> (ASSET_ACCT_ID.empty())      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ASSET_ACCT_ID&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13244"></a>13244     <span class="keywordflow">if</span> (0 &gt; TRANSACTION_NUMBER)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13245"></a>13245 
<a name="l13246"></a>13246     <span class="keyword">const</span> int64_t lTransactionNumber = TRANSACTION_NUMBER;
<a name="l13247"></a>13247 
<a name="l13248"></a>13248     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAssetAcctID(ASSET_ACCT_ID);
<a name="l13249"></a>13249 
<a name="l13250"></a>13250     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ade192b1b17ef3814b79e76afe7badb8a">cancelCronItem</a>(theServerID, theUserID, theAssetAcctID, static_cast&lt;int64_t&gt;(lTransactionNumber));
<a name="l13251"></a>13251 }
<a name="l13252"></a>13252 
<a name="l13253"></a>13253 <span class="comment">// OTAPI_Exec::cancelPaymentPlan</span>
<a name="l13254"></a>13254 <span class="comment">// Cancel a payment plan by transaction number.</span>
<a name="l13255"></a>13255 <span class="comment">//</span>
<a name="l13256"></a>13256 <span class="comment">// Returns int32_t:</span>
<a name="l13257"></a>13257 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13258"></a>13258 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13259"></a>13259 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13260"></a>13260 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13261"></a>13261 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13262"></a>13262 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13263"></a>13263 <span class="comment">//</span>
<a name="l13264"></a><a class="code" href="class_o_t_a_p_i___exec.html#af480784697d3e4a5d61be6024b152591">13264</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#af480784697d3e4a5d61be6024b152591">OTAPI_Exec::killPaymentPlan</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13265"></a>13265                                     <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13266"></a>13266                                     <span class="keyword">const</span> std::string &amp; FROM_ACCT_ID,
<a name="l13267"></a>13267                                     <span class="keyword">const</span> int64_t &amp; TRANSACTION_NUMBER)
<a name="l13268"></a>13268 {
<a name="l13269"></a>13269     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13270"></a>13270     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13271"></a>13271     <span class="keywordflow">if</span> (FROM_ACCT_ID.empty())       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;FROM_ACCT_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13272"></a>13272     <span class="keywordflow">if</span> ( 0 &gt; TRANSACTION_NUMBER)    { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TRANSACTION_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13273"></a>13273 
<a name="l13274"></a>13274     <span class="keyword">const</span> int64_t lTransactionNumber = TRANSACTION_NUMBER;
<a name="l13275"></a>13275 
<a name="l13276"></a>13276     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theFromAcctID(FROM_ACCT_ID);
<a name="l13277"></a>13277 
<a name="l13278"></a>13278     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ade192b1b17ef3814b79e76afe7badb8a">cancelCronItem</a>(theServerID, theUserID, theFromAcctID, static_cast&lt;int64_t&gt;(lTransactionNumber));
<a name="l13279"></a>13279 }
<a name="l13280"></a>13280 
<a name="l13281"></a>13281 
<a name="l13282"></a>13282 <span class="comment">// --------------------------------------------------</span>
<a name="l13283"></a>13283 <span class="comment">// ISSUE MARKET OFFER</span>
<a name="l13284"></a>13284 <span class="comment">//</span>
<a name="l13285"></a>13285 <span class="comment">// Returns int32_t:</span>
<a name="l13286"></a>13286 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13287"></a>13287 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13288"></a>13288 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13289"></a>13289 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13290"></a>13290 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13291"></a>13291 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13292"></a>13292 <span class="comment">//</span>
<a name="l13293"></a><a class="code" href="class_o_t_a_p_i___exec.html#ab0679f69605179746070b0acb003bbab">13293</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ab0679f69605179746070b0acb003bbab">OTAPI_Exec::issueMarketOffer</a>(<span class="keyword">const</span> std::string &amp; ASSET_ACCT_ID,     <span class="comment">// Perhaps this is the wheat market.</span>
<a name="l13294"></a>13294                                      <span class="keyword">const</span> std::string &amp; CURRENCY_ACCT_ID,  <span class="comment">// Perhaps I&#39;m buying the wheat with rubles.</span>
<a name="l13295"></a>13295                                      <span class="comment">// -------------------------------------------</span>
<a name="l13296"></a>13296                                      <span class="keyword">const</span> int64_t     &amp; MARKET_SCALE,          <span class="comment">// Defaults to minimum of 1. Market granularity.</span>
<a name="l13297"></a>13297                                      <span class="keyword">const</span> int64_t     &amp; MINIMUM_INCREMENT,     <span class="comment">// This will be multiplied by the Scale. Min 1.</span>
<a name="l13298"></a>13298                                      <span class="keyword">const</span> int64_t     &amp; TOTAL_ASSETS_ON_OFFER, <span class="comment">// Total assets available for sale or purchase. Will be multiplied by minimum increment.</span>
<a name="l13299"></a>13299                                      <span class="keyword">const</span> int64_t     &amp; PRICE_LIMIT,           <span class="comment">// Per Minimum Increment...</span>
<a name="l13300"></a>13300                                      <span class="keyword">const</span> <span class="keywordtype">bool</span>        &amp; bBuyingOrSelling,      <span class="comment">// SELLING == true, BUYING == false.</span>
<a name="l13301"></a>13301                                      <span class="keyword">const</span> <a class="code" href="_o_t_common_8hpp.html#ad28ff0a3eda18840f6bda5872819167f">time64_t</a>      &amp; LIFESPAN_IN_SECONDS,   <span class="comment">// Pass 0 for the default behavior: 86400 seconds aka 1 day.</span>
<a name="l13302"></a>13302                                      <span class="comment">// -------------------------------------------</span>
<a name="l13303"></a>13303                                      <span class="keyword">const</span> std::string &amp; STOP_SIGN,             <span class="comment">// Must be &quot;&quot; (for market/limit orders) or &quot;&lt;&quot; or &quot;&gt;&quot;  (for stop orders.)</span>
<a name="l13304"></a>13304                                      <span class="keyword">const</span> int64_t     &amp; ACTIVATION_PRICE)      <span class="comment">// Must be provided if STOP_SIGN is also set. Determines the price threshold for stop orders.</span>
<a name="l13305"></a>13305 {
<a name="l13306"></a>13306     <span class="keywordflow">if</span> (ASSET_ACCT_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;ASSET_ACCT_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13307"></a>13307     <span class="keywordflow">if</span> (CURRENCY_ACCT_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,     __FUNCTION__, <span class="stringliteral">&quot;CURRENCY_ACCT_ID&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13308"></a>13308     <span class="comment">// -------------------------------------------</span>
<a name="l13309"></a>13309     <span class="keywordflow">if</span> (0 &gt; MARKET_SCALE)          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MARKET_SCALE&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13310"></a>13310     <span class="keywordflow">if</span> (0 &gt; MINIMUM_INCREMENT)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MINIMUM_INCREMENT&quot;</span>    ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13311"></a>13311     <span class="keywordflow">if</span> (0 &gt; TOTAL_ASSETS_ON_OFFER) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;TOTAL_ASSETS_ON_OFFER&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13312"></a>13312     <span class="keywordflow">if</span> (0 &gt; PRICE_LIMIT)           { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;PRICE_LIMIT&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13313"></a>13313     <span class="keywordflow">if</span> (0 &gt; ACTIVATION_PRICE)      { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACTIVATION_PRICE&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13314"></a>13314     <span class="comment">// -------------------------------------------</span>
<a name="l13315"></a>13315     <span class="keywordtype">char</span> cStopSign = 0;
<a name="l13316"></a>13316 
<a name="l13317"></a>13317     <span class="keywordflow">if</span> (0 == STOP_SIGN.compare(<span class="stringliteral">&quot;&lt;&quot;</span>))
<a name="l13318"></a>13318         cStopSign = <span class="charliteral">&#39;&lt;&#39;</span>;
<a name="l13319"></a>13319     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == STOP_SIGN.compare(<span class="stringliteral">&quot;&gt;&quot;</span>))
<a name="l13320"></a>13320         cStopSign = <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l13321"></a>13321     <span class="comment">// -------------------------------------------</span>
<a name="l13322"></a>13322     <span class="keywordflow">if</span> (!STOP_SIGN.empty() &amp;&amp;
<a name="l13323"></a>13323         (
<a name="l13324"></a>13324         (ACTIVATION_PRICE == 0) ||
<a name="l13325"></a>13325         ((cStopSign != <span class="charliteral">&#39;&lt;&#39;</span>) &amp;&amp; (cStopSign != <span class="charliteral">&#39;&gt;&#39;</span>))
<a name="l13326"></a>13326         )) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: If STOP_SIGN is provided, it must be \&quot;&lt;\&quot; or \&quot;&gt;\&quot;, and in that case ACTIVATION_PRICE must be non-zero.\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13327"></a>13327     <span class="comment">// -------------------------------------------</span>
<a name="l13328"></a>13328     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theAssetAcctID(ASSET_ACCT_ID),  theCurrencyAcctID(CURRENCY_ACCT_ID);
<a name="l13329"></a>13329     <span class="comment">// -------------------------------------------</span>
<a name="l13330"></a>13330     <span class="keyword">const</span> std::string str_asset_server_id    = <a class="code" href="class_o_t_a_p_i___exec.html#afb2255e4fb7fb27bbeebe753eb827770">OTAPI_Exec::GetAccountWallet_ServerID</a>(ASSET_ACCT_ID);
<a name="l13331"></a>13331     <span class="keyword">const</span> std::string str_currency_server_id = <a class="code" href="class_o_t_a_p_i___exec.html#afb2255e4fb7fb27bbeebe753eb827770">OTAPI_Exec::GetAccountWallet_ServerID</a>(CURRENCY_ACCT_ID);
<a name="l13332"></a>13332     <span class="comment">// -------------------------------------------</span>
<a name="l13333"></a>13333     <span class="keyword">const</span> std::string str_asset_nym_id       = <a class="code" href="class_o_t_a_p_i___exec.html#a5c11f6d8c1dd9024788124685c8bb8d8">OTAPI_Exec::GetAccountWallet_NymID</a>(ASSET_ACCT_ID);
<a name="l13334"></a>13334     <span class="keyword">const</span> std::string str_currency_nym_id    = <a class="code" href="class_o_t_a_p_i___exec.html#a5c11f6d8c1dd9024788124685c8bb8d8">OTAPI_Exec::GetAccountWallet_NymID</a>(CURRENCY_ACCT_ID);
<a name="l13335"></a>13335     <span class="comment">// -------------------------------------------</span>
<a name="l13336"></a>13336     <span class="keywordflow">if</span> (str_asset_server_id.empty() || str_currency_server_id.empty() || str_asset_nym_id.empty() || str_currency_nym_id.empty())
<a name="l13337"></a>13337     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed determining server or nym ID for either asset or currency account.\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13338"></a>13338     <span class="comment">// -------------------------------------------</span>
<a name="l13339"></a>13339     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theAssetServerID    (str_asset_server_id),
<a name="l13340"></a>13340                         theAssetUserID      (str_asset_nym_id),
<a name="l13341"></a>13341                         theCurrencyServerID (str_currency_server_id),
<a name="l13342"></a>13342                         theCurrencyUserID   (str_currency_nym_id);
<a name="l13343"></a>13343     <span class="comment">// -------------------------------------------</span>
<a name="l13344"></a>13344     <span class="keywordflow">if</span> (theAssetServerID != theCurrencyServerID) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: The accounts provided are on two different servers.\n&quot;</span>,    __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13345"></a>13345     <span class="keywordflow">if</span> (theAssetUserID   != theCurrencyUserID)   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: The accounts provided are owned by two different nyms.\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13346"></a>13346     <span class="comment">// -------------------------------------------</span>
<a name="l13347"></a>13347     <span class="comment">// 1 is the minimum value here.</span>
<a name="l13348"></a>13348     <span class="comment">//</span>
<a name="l13349"></a>13349     int64_t lMarketScale        = (0 == MARKET_SCALE)           ? 1 : MARKET_SCALE;
<a name="l13350"></a>13350     int64_t lMinIncrement       = (0 == MINIMUM_INCREMENT)      ? 1 : MINIMUM_INCREMENT;
<a name="l13351"></a>13351     int64_t lTotalAssetsOnOffer = (0 == TOTAL_ASSETS_ON_OFFER)  ? 1 : TOTAL_ASSETS_ON_OFFER;
<a name="l13352"></a>13352     int64_t lPriceLimit         =                                     PRICE_LIMIT; <span class="comment">// 0 is allowed now, for market orders.</span>
<a name="l13353"></a>13353     <span class="comment">// -------------------------------------------</span>
<a name="l13354"></a>13354     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#acadf476636347f6d2e748a3ac517c7c8">issueMarketOffer</a>(theAssetServerID, theAssetUserID,
<a name="l13355"></a>13355                                                  <span class="comment">// -------------------------------------------</span>
<a name="l13356"></a>13356                                                  theAssetAcctID,
<a name="l13357"></a>13357                                                  theCurrencyAcctID,
<a name="l13358"></a>13358                                                  <span class="comment">// -------------------------------------------</span>
<a name="l13359"></a>13359                                                  static_cast&lt;int64_t&gt;(lMarketScale),
<a name="l13360"></a>13360                                                  static_cast&lt;int64_t&gt;(lMinIncrement),
<a name="l13361"></a>13361                                                  static_cast&lt;int64_t&gt;(lTotalAssetsOnOffer),
<a name="l13362"></a>13362                                                  static_cast&lt;int64_t&gt;(lPriceLimit),
<a name="l13363"></a>13363                                                  bBuyingOrSelling,
<a name="l13364"></a>13364                                                  LIFESPAN_IN_SECONDS,
<a name="l13365"></a>13365                                                  cStopSign,
<a name="l13366"></a>13366                                                  static_cast&lt;int64_t&gt;(ACTIVATION_PRICE));
<a name="l13367"></a>13367 }
<a name="l13368"></a>13368 
<a name="l13369"></a>13369 
<a name="l13370"></a>13370 
<a name="l13371"></a>13371 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13372"></a>13372 
<a name="l13373"></a>13373 
<a name="l13374"></a>13374 <span class="comment">// Returns int32_t:</span>
<a name="l13375"></a>13375 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13376"></a>13376 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13377"></a>13377 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13378"></a>13378 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13379"></a>13379 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13380"></a>13380 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13381"></a>13381 <span class="comment">//</span>
<a name="l13382"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9cc96101156fb1a34e6f8f30bc7b8e01">13382</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9cc96101156fb1a34e6f8f30bc7b8e01" title="Retrieves details for each market.">OTAPI_Exec::getMarketList</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13383"></a>13383                                   <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13384"></a>13384 {
<a name="l13385"></a>13385     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13386"></a>13386     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13387"></a>13387 
<a name="l13388"></a>13388     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13389"></a>13389 
<a name="l13390"></a>13390     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a86ffb271aec1f5cdb211f3f1403cc910">getMarketList</a>(theServerID, theUserID);
<a name="l13391"></a>13391 }
<a name="l13392"></a>13392 
<a name="l13393"></a>13393 
<a name="l13394"></a>13394 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13395"></a>13395 
<a name="l13396"></a>13396 <span class="comment">// Returns int32_t:</span>
<a name="l13397"></a>13397 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13398"></a>13398 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13399"></a>13399 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13400"></a>13400 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13401"></a>13401 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13402"></a>13402 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13403"></a>13403 <span class="comment">//</span>
<a name="l13404"></a><a class="code" href="class_o_t_a_p_i___exec.html#a0c338692168a52f6d51e8545038044d3">13404</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a0c338692168a52f6d51e8545038044d3" title="Gets all offers for a specific market and their details (up until maximum depth)">OTAPI_Exec::getMarketOffers</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13405"></a>13405                           <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13406"></a>13406                           <span class="keyword">const</span> std::string &amp; MARKET_ID,
<a name="l13407"></a>13407                           <span class="keyword">const</span> int64_t &amp; MAX_DEPTH)
<a name="l13408"></a>13408 {
<a name="l13409"></a>13409     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13410"></a>13410     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13411"></a>13411     <span class="keywordflow">if</span> (0 &gt; MAX_DEPTH)              { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MAX_DEPTH&quot;</span>      ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13412"></a>13412 
<a name="l13413"></a>13413     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theMarketID(MARKET_ID);
<a name="l13414"></a>13414 
<a name="l13415"></a>13415     <span class="keyword">const</span> int64_t lDepth = MAX_DEPTH;
<a name="l13416"></a>13416     <span class="keywordflow">if</span> (0 &gt; lDepth) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: lDepth is out of bounds (it&#39;s in the negative!)\n&quot;</span>, __FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13417"></a>13417 
<a name="l13418"></a>13418     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a32bf905befe6a9450b9293ed75ee1e3a">getMarketOffers</a>(theServerID, theUserID, theMarketID, static_cast&lt;int64_t&gt;(lDepth));
<a name="l13419"></a>13419 }
<a name="l13420"></a>13420 
<a name="l13421"></a>13421 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13422"></a>13422 
<a name="l13423"></a>13423 <span class="comment">// Returns int32_t:</span>
<a name="l13424"></a>13424 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13425"></a>13425 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13426"></a>13426 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13427"></a>13427 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13428"></a>13428 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13429"></a>13429 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13430"></a>13430 <span class="comment">//</span>
<a name="l13431"></a><a class="code" href="class_o_t_a_p_i___exec.html#ac4d037d2bf1c776f78845d2120d85072">13431</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#ac4d037d2bf1c776f78845d2120d85072" title="Gets all recent trades (up until maximum depth)">OTAPI_Exec::getMarketRecentTrades</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13432"></a>13432                                 <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13433"></a>13433                                 <span class="keyword">const</span> std::string &amp; MARKET_ID)
<a name="l13434"></a>13434 {
<a name="l13435"></a>13435     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13436"></a>13436     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13437"></a>13437     <span class="keywordflow">if</span> (MARKET_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MARKET_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13438"></a>13438 
<a name="l13439"></a>13439     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theMarketID(MARKET_ID);
<a name="l13440"></a>13440 
<a name="l13441"></a>13441     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ad4046209a1d0cb1792b23f71834a294e">getMarketRecentTrades</a>(theServerID, theUserID, theMarketID);
<a name="l13442"></a>13442 }
<a name="l13443"></a>13443 
<a name="l13444"></a>13444 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13445"></a>13445 
<a name="l13446"></a>13446 <span class="comment">// Returns int32_t:</span>
<a name="l13447"></a>13447 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13448"></a>13448 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13449"></a>13449 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13450"></a>13450 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13451"></a>13451 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13452"></a>13452 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13453"></a>13453 <span class="comment">//</span>
<a name="l13454"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9a467be336ba01534d66f5d572be2222">13454</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9a467be336ba01534d66f5d572be2222" title="This &quot;Market Offer&quot; data is a lot more detailed than the Market_GetOffers() call, which seems similar...">OTAPI_Exec::getNym_MarketOffers</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13455"></a>13455                               <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13456"></a>13456 {
<a name="l13457"></a>13457     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13458"></a>13458     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13459"></a>13459 
<a name="l13460"></a>13460     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13461"></a>13461 
<a name="l13462"></a>13462     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a1e508b83332ea7707f74c91622105ea8">getNym_MarketOffers</a>(theServerID, theUserID);
<a name="l13463"></a>13463 }
<a name="l13464"></a>13464 
<a name="l13465"></a>13465 
<a name="l13466"></a>13466 
<a name="l13467"></a>13467 
<a name="l13468"></a>13468 
<a name="l13469"></a>13469 
<a name="l13470"></a>13470 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13471"></a>13471 <span class="comment">// POP MESSAGE BUFFER</span>
<a name="l13472"></a>13472 <span class="comment">//</span>
<a name="l13473"></a>13473 <span class="comment">// If there are any replies from the server, they are stored in</span>
<a name="l13474"></a>13474 <span class="comment">// the message buffer. This function will return those messages</span>
<a name="l13475"></a>13475 <span class="comment">// (and remove them from the list) one-by-one, newest first.</span>
<a name="l13476"></a>13476 <span class="comment">//</span>
<a name="l13477"></a>13477 <span class="comment">// Returns the message as a string.</span>
<a name="l13478"></a>13478 <span class="comment">//</span>
<a name="l13479"></a>13479 <span class="comment">// Update: added arguments for: ServerID AND NymID AND request number</span>
<a name="l13480"></a>13480 <span class="comment">// NOTE: Any messages, when popping, which have the CORRECT serverID</span>
<a name="l13481"></a>13481 <span class="comment">// and the CORRECT NymID, but the wrong Request number, will be discarded.</span>
<a name="l13482"></a>13482 <span class="comment">//</span>
<a name="l13483"></a>13483 <span class="comment">// (Why? Because the client using the OT API will have already treated</span>
<a name="l13484"></a>13484 <span class="comment">// that message as &quot;dropped&quot; by now, if it&#39;s already on to the next one,</span>
<a name="l13485"></a>13485 <span class="comment">// and the protocol is designed to move forward properly based specifically</span>
<a name="l13486"></a>13486 <span class="comment">// on this function returning the one EXPECTED... outgoing messages flush</span>
<a name="l13487"></a>13487 <span class="comment">// the incoming buffer anyway, so the client will have assumed the wrong</span>
<a name="l13488"></a>13488 <span class="comment">// reply was flushed by now anyway.)</span>
<a name="l13489"></a>13489 <span class="comment">//</span>
<a name="l13490"></a>13490 <span class="comment">// However, if the Server ID and the User ID are wrong, this just means that</span>
<a name="l13491"></a>13491 <span class="comment">// some other code is still expecting that reply, and hasn&#39;t even popped yet!</span>
<a name="l13492"></a>13492 <span class="comment">// Therefore, we do NOT want to discard THOSE replies, but put them back if</span>
<a name="l13493"></a>13493 <span class="comment">// necessary -- only discarding the ones where the IDs match.</span>
<a name="l13494"></a>13494 <span class="comment">//</span>
<a name="l13495"></a>13495 <span class="comment">//</span>
<a name="l13496"></a><a class="code" href="class_o_t_a_p_i___exec.html#a65175755753f15ff01e91312f349f5ea">13496</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a65175755753f15ff01e91312f349f5ea">OTAPI_Exec::PopMessageBuffer</a>(<span class="keyword">const</span> int64_t &amp; REQUEST_NUMBER,
<a name="l13497"></a>13497                                     <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13498"></a>13498                                     <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13499"></a>13499 {
<a name="l13500"></a>13500     <span class="keywordflow">if</span> (0 &gt; REQUEST_NUMBER)         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;REQUEST_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13501"></a>13501     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13502"></a>13502     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13503"></a>13503 
<a name="l13504"></a>13504     <span class="comment">// ------------------------------------------------</span>
<a name="l13505"></a>13505     <span class="keyword">const</span> int64_t          lRequestNum = REQUEST_NUMBER;
<a name="l13506"></a>13506     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l13507"></a>13507         theUserID(USER_ID);
<a name="l13508"></a>13508     <span class="comment">// ------------------------------------------------</span>
<a name="l13509"></a>13509     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMsg = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a04aee43cd2310d2da162f14c771e26cb">PopMessageBuffer</a>(static_cast&lt;int64_t&gt;(lRequestNum), theServerID, theUserID); <span class="comment">// caller responsible to delete.</span>
<a name="l13510"></a>13510     <a class="code" href="class_o_t_cleanup.html">OTCleanup&lt;OTMessage&gt;</a> theAngel(pMsg);  <span class="comment">// Just making sure it gets cleaned up.</span>
<a name="l13511"></a>13511 
<a name="l13512"></a>13512     <span class="keywordflow">if</span> (NULL == pMsg) <span class="comment">// The buffer was empty.</span>
<a name="l13513"></a>13513     {
<a name="l13514"></a>13514         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s:  Reply not found, sorry.\n&quot;</span>, __FUNCTION__);
<a name="l13515"></a>13515         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13516"></a>13516     }
<a name="l13517"></a>13517 
<a name="l13518"></a>13518     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pMsg);
<a name="l13519"></a>13519 
<a name="l13520"></a>13520     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13521"></a>13521     <span class="keywordflow">return</span> pBuf;
<a name="l13522"></a>13522 }
<a name="l13523"></a>13523 
<a name="l13524"></a>13524 
<a name="l13525"></a>13525 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13526"></a>13526 
<a name="l13527"></a>13527 <span class="comment">// Just flat-out empties the thing.</span>
<a name="l13528"></a>13528 <span class="comment">//</span>
<a name="l13529"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa920e604052b505d382202593c050a11">13529</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#aa920e604052b505d382202593c050a11">OTAPI_Exec::FlushMessageBuffer</a>(<span class="keywordtype">void</span>)
<a name="l13530"></a>13530 {
<a name="l13531"></a>13531     <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ae9f593a90e408ab34e92c25a4428bf8b">FlushMessageBuffer</a>();
<a name="l13532"></a>13532 }
<a name="l13533"></a>13533 
<a name="l13534"></a>13534 
<a name="l13535"></a>13535 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13536"></a>13536 
<a name="l13537"></a>13537 
<a name="l13538"></a>13538 <span class="comment">// Message OUT-BUFFER</span>
<a name="l13539"></a>13539 <span class="comment">//</span>
<a name="l13540"></a>13540 <span class="comment">// (for messages I--the client--have sent the server.)</span>
<a name="l13541"></a>13541 <span class="comment">/*</span>
<a name="l13542"></a>13542 <span class="comment">class OTMessageOutbuffer:</span>
<a name="l13543"></a>13543 <span class="comment">void        Clear();</span>
<a name="l13544"></a>13544 <span class="comment">void        AddSentMessage      (OTMessage &amp; theMessage);   // Allocate theMsg on the heap (takes ownership.) Mapped by request num.</span>
<a name="l13545"></a>13545 <span class="comment">OTMessage * GetSentMessage      (const int64_t &amp; lRequestNum); // null == not found. caller NOT responsible to delete.</span>
<a name="l13546"></a>13546 <span class="comment">bool        RemoveSentMessage   (const int64_t &amp; lRequestNum); // true == it was removed. false == it wasn&#39;t found.</span>
<a name="l13547"></a>13547 <span class="comment">*/</span>
<a name="l13548"></a>13548 
<a name="l13549"></a>13549 
<a name="l13550"></a>13550 
<a name="l13551"></a>13551 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13552"></a>13552 <span class="comment">// GET SENT MESSAGE</span>
<a name="l13553"></a>13553 <span class="comment">//</span>
<a name="l13554"></a>13554 <span class="comment">// If there were any messages sent to the server, copies are</span>
<a name="l13555"></a>13555 <span class="comment">// stored here, so the developer using the OT API can access</span>
<a name="l13556"></a>13556 <span class="comment">// them by request number.</span>
<a name="l13557"></a>13557 <span class="comment">//</span>
<a name="l13558"></a>13558 <span class="comment">// Returns the message as a string.</span>
<a name="l13559"></a>13559 <span class="comment">//</span>
<a name="l13560"></a><a class="code" href="class_o_t_a_p_i___exec.html#aa9537e99a39bb621775e57b8be07fc02">13560</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#aa9537e99a39bb621775e57b8be07fc02">OTAPI_Exec::GetSentMessage</a>(<span class="keyword">const</span> int64_t &amp; REQUEST_NUMBER,
<a name="l13561"></a>13561                                   <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13562"></a>13562                                   <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13563"></a>13563 {
<a name="l13564"></a>13564     <span class="keywordflow">if</span> (0 &gt; REQUEST_NUMBER)         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;REQUEST_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13565"></a>13565     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,    __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13566"></a>13566     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>,    __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13567"></a>13567     <span class="comment">// ------------------------------------------------</span>
<a name="l13568"></a>13568     <span class="keyword">const</span> int64_t          lRequestNum = REQUEST_NUMBER;
<a name="l13569"></a>13569     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l13570"></a>13570         theUserID(USER_ID);
<a name="l13571"></a>13571     <span class="comment">// ------------------------------------------------</span>
<a name="l13572"></a>13572     <a class="code" href="class_o_t_message.html">OTMessage</a> * pMsg = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a23edd3f777f72244fa6281911d431e08">GetSentMessage</a>(static_cast&lt;int64_t&gt;(lRequestNum), theServerID, theUserID);
<a name="l13573"></a>13573     <span class="comment">//  OTCleanup&lt;OTMessage&gt; theAngel(pMsg);    // caller NOT responsible to delete.</span>
<a name="l13574"></a>13574 
<a name="l13575"></a>13575     <span class="keywordflow">if</span> (NULL == pMsg) <span class="comment">// The message wasn&#39;t found with that request number.</span>
<a name="l13576"></a>13576     {
<a name="l13577"></a>13577         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: Message not found with request number %lld, sorry.\n&quot;</span>, __FUNCTION__, lRequestNum);
<a name="l13578"></a>13578         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13579"></a>13579     }
<a name="l13580"></a>13580     <span class="comment">// ------------------------------------------------</span>
<a name="l13581"></a>13581     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a> strOutput(*pMsg); <span class="comment">// No need to cleanup the message since it&#39;s still in the buffer until explicitly removed.</span>
<a name="l13582"></a>13582 
<a name="l13583"></a>13583     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13584"></a>13584 
<a name="l13585"></a>13585     <span class="keywordflow">return</span> pBuf;
<a name="l13586"></a>13586 }
<a name="l13587"></a>13587 
<a name="l13588"></a>13588 
<a name="l13589"></a>13589 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13590"></a>13590 <span class="comment">// REMOVE SENT MESSAGE</span>
<a name="l13591"></a>13591 <span class="comment">//</span>
<a name="l13592"></a>13592 <span class="comment">// If there were any messages sent to the server, copies are</span>
<a name="l13593"></a>13593 <span class="comment">// stored until removed via this function.</span>
<a name="l13594"></a>13594 <span class="comment">//</span>
<a name="l13595"></a>13595 <span class="comment">// Returns bool based on whether message was found (and removed.)</span>
<a name="l13596"></a>13596 <span class="comment">//</span>
<a name="l13597"></a><a class="code" href="class_o_t_a_p_i___exec.html#af1dbcebe7dd7a4c24ba1c32c9d6c062a">13597</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#af1dbcebe7dd7a4c24ba1c32c9d6c062a">OTAPI_Exec::RemoveSentMessage</a>(<span class="keyword">const</span> int64_t &amp; REQUEST_NUMBER,
<a name="l13598"></a>13598                                 <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13599"></a>13599                                 <span class="keyword">const</span> std::string &amp; USER_ID)
<a name="l13600"></a>13600 {
<a name="l13601"></a>13601     <span class="keywordflow">if</span> (0 &gt; REQUEST_NUMBER)     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;REQUEST_NUMBER&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13602"></a>13602     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13603"></a>13603     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13604"></a>13604     <span class="comment">// ------------------------------------------------</span>
<a name="l13605"></a>13605     <span class="keyword">const</span> int64_t          lRequestNum = REQUEST_NUMBER;
<a name="l13606"></a>13606     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l13607"></a>13607         theUserID(USER_ID);
<a name="l13608"></a>13608     <span class="comment">// ------------------------------------------------</span>
<a name="l13609"></a>13609     <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bSuccess = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a5ee70b9309b55c10ade9e0bf240c66a2">RemoveSentMessage</a>(static_cast&lt;int64_t&gt;(lRequestNum), theServerID, theUserID);
<a name="l13610"></a>13610 
<a name="l13611"></a>13611     <span class="keywordflow">return</span> bSuccess;
<a name="l13612"></a>13612 }
<a name="l13613"></a>13613 
<a name="l13614"></a>13614 
<a name="l13615"></a>13615 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13616"></a>13616 <span class="comment">// OTAPI_Exec::FlushSentMessages</span>
<a name="l13617"></a>13617 <span class="comment">//</span>
<a name="l13618"></a>13618 <span class="comment">// Make sure to call this directly after a successful @getNymbox.</span>
<a name="l13619"></a>13619 <span class="comment">// (And ONLY at that time.)</span>
<a name="l13620"></a>13620 <span class="comment">//</span>
<a name="l13621"></a>13621 <span class="comment">// This empties the buffer of sent messages.</span>
<a name="l13622"></a>13622 <span class="comment">// (Harvesting any transaction numbers that are still there.)</span>
<a name="l13623"></a>13623 <span class="comment">//</span>
<a name="l13624"></a>13624 <span class="comment">// NOTE: You normally ONLY call this immediately after receiving</span>
<a name="l13625"></a>13625 <span class="comment">// a successful @getNymbox. It&#39;s only then that you can see which</span>
<a name="l13626"></a>13626 <span class="comment">// messages a server actually received or not -- which transactions</span>
<a name="l13627"></a>13627 <span class="comment">// it processed (success or fail) vs which transactions did NOT</span>
<a name="l13628"></a>13628 <span class="comment">// process (and thus did NOT leave any success/fail receipt in the</span>
<a name="l13629"></a>13629 <span class="comment">// nymbox.)</span>
<a name="l13630"></a>13630 <span class="comment">//</span>
<a name="l13631"></a>13631 <span class="comment">// I COULD have just flushed myself IN the @getNymbox code (where</span>
<a name="l13632"></a>13632 <span class="comment">// the reply is processed.) But then the developer using the OT API</span>
<a name="l13633"></a>13633 <span class="comment">// would never have the opportunity to see whether a message was</span>
<a name="l13634"></a>13634 <span class="comment">// replied to, and harvest it for himself (say, just before attempting</span>
<a name="l13635"></a>13635 <span class="comment">// a re-try, which I plan to do in the high-level Java API, which is</span>
<a name="l13636"></a>13636 <span class="comment">// why I&#39;m coding it this way.)</span>
<a name="l13637"></a>13637 <span class="comment">//</span>
<a name="l13638"></a>13638 <span class="comment">// This way, he can do that if he wishes, THEN call this function,</span>
<a name="l13639"></a>13639 <span class="comment">// and harvesting will still occur properly, and he will also thus have</span>
<a name="l13640"></a>13640 <span class="comment">// his chance to check for his own replies to harvest before then.</span>
<a name="l13641"></a>13641 <span class="comment">// This all depends on the developer using the API being smart enough</span>
<a name="l13642"></a>13642 <span class="comment">// to call this function after a successful @getNymbox!</span>
<a name="l13643"></a>13643 <span class="comment">//</span>
<a name="l13644"></a><a class="code" href="class_o_t_a_p_i___exec.html#ae9d152765febba64cb98ddfc8461686d">13644</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#ae9d152765febba64cb98ddfc8461686d">OTAPI_Exec::FlushSentMessages</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> &amp; bHarvestingForRetry,
<a name="l13645"></a>13645                              <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l13646"></a>13646                              <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l13647"></a>13647                              <span class="keyword">const</span> std::string &amp; THE_NYMBOX)
<a name="l13648"></a>13648 {
<a name="l13649"></a>13649     <span class="keywordflow">if</span> ( (<span class="keyword">true</span> != bHarvestingForRetry) &amp;&amp; (<span class="keyword">false</span> != bHarvestingForRetry) ) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Bad: %s \n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;bHarvestingForRetry&quot;</span>); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13650"></a>13650 
<a name="l13651"></a>13651     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13652"></a>13652     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13653"></a>13653     <span class="keywordflow">if</span> (THE_NYMBOX.empty())         { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_NYMBOX&quot;</span>         ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13654"></a>13654 
<a name="l13655"></a>13655     <span class="comment">// ------------------------------------------------</span>
<a name="l13656"></a>13656     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>  theServerID(SERVER_ID),
<a name="l13657"></a>13657         theUserID(USER_ID);
<a name="l13658"></a>13658     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>      strLedger(THE_NYMBOX);
<a name="l13659"></a>13659     <a class="code" href="class_o_t_ledger.html">OTLedger</a>      theLedger(theUserID, theUserID, theServerID);
<a name="l13660"></a>13660     <span class="comment">// ------------------------------------------------</span>
<a name="l13661"></a>13661     <span class="keywordflow">if</span> (strLedger.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() &amp;&amp; theLedger.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strLedger))
<a name="l13662"></a>13662         <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a9a02cca439067abd875c78ca7f732011">FlushSentMessages</a>(bHarvestingForRetry,
<a name="l13663"></a>13663                                                theServerID,
<a name="l13664"></a>13664                                                theUserID,
<a name="l13665"></a>13665                                                theLedger);
<a name="l13666"></a>13666     <span class="keywordflow">else</span>
<a name="l13667"></a>13667         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failure: Unable to load Nymbox from string:\n\n%s\n\n&quot;</span>, __FUNCTION__, strLedger.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l13668"></a>13668 }
<a name="l13669"></a>13669 
<a name="l13670"></a>13670 
<a name="l13671"></a>13671 
<a name="l13672"></a>13672 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13673"></a>13673 
<a name="l13674"></a>13674 
<a name="l13675"></a>13675 
<a name="l13676"></a>13676 
<a name="l13677"></a>13677 
<a name="l13678"></a>13678 
<a name="l13679"></a>13679 <span class="comment">// Sometimes you just need a quick nap between messages.</span>
<a name="l13680"></a>13680 <span class="comment">//</span>
<a name="l13681"></a><a class="code" href="class_o_t_a_p_i___exec.html#a393c8f1065be86b2bcb8192ebdfff64b">13681</a> <span class="keywordtype">void</span> <a class="code" href="class_o_t_a_p_i___exec.html#a393c8f1065be86b2bcb8192ebdfff64b">OTAPI_Exec::Sleep</a>(<span class="keyword">const</span> int64_t &amp; MILLISECONDS)
<a name="l13682"></a>13682 {
<a name="l13683"></a>13683     <span class="comment">// -----------------------------------------------------</span>
<a name="l13684"></a>13684     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l13685"></a>13685     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__);   <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13686"></a>13686 
<a name="l13687"></a>13687     <span class="keywordflow">if</span> (0 &gt; MILLISECONDS)       { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Negative: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;MILLISECONDS&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; <span class="keywordflow">return</span>; }
<a name="l13688"></a>13688     <span class="comment">// -----------------------------------------------</span>
<a name="l13689"></a>13689 
<a name="l13690"></a>13690     <span class="keyword">const</span> int64_t lMilliseconds = MILLISECONDS;
<a name="l13691"></a>13691 
<a name="l13692"></a>13692     <a class="code" href="class_o_t_log.html#a10fba9fb1a7c5cb04178e2beb7fd10c9">OTLog::SleepMilliseconds</a>(static_cast&lt;int64_t&gt;(lMilliseconds));
<a name="l13693"></a>13693 }
<a name="l13694"></a>13694 
<a name="l13695"></a>13695 
<a name="l13696"></a>13696 
<a name="l13697"></a>13697 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13698"></a>13698 
<a name="l13699"></a>13699 
<a name="l13700"></a>13700 
<a name="l13701"></a>13701 <span class="comment">// Make sure you download your Nymbox (getNymbox) before calling this,</span>
<a name="l13702"></a>13702 <span class="comment">// so when it loads the Nymbox it will have the latest version of it.</span>
<a name="l13703"></a>13703 <span class="comment">//</span>
<a name="l13704"></a>13704 <span class="comment">// Also, call createUserAccount() and pass the server reply message in</span>
<a name="l13705"></a>13705 <span class="comment">// here, so that it can read theMessageNym (to sync the transaction</span>
<a name="l13706"></a>13706 <span class="comment">// numbers.)</span>
<a name="l13707"></a>13707 <span class="comment">//</span>
<a name="l13708"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9dbdf7e9ccdf8e21ac5c3a6fbcf2705b">13708</a> <span class="keywordtype">bool</span> <a class="code" href="class_o_t_a_p_i___exec.html#a9dbdf7e9ccdf8e21ac5c3a6fbcf2705b">OTAPI_Exec::ResyncNymWithServer</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; USER_ID, <span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13709"></a>13709 {
<a name="l13710"></a>13710     <span class="comment">// -----------------------------------------------------</span>
<a name="l13711"></a>13711     <span class="keywordtype">bool</span> bIsInitialized = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#af11b60d083c4a8e1e68a59a0824899d4">IsInitialized</a>();
<a name="l13712"></a>13712     <span class="keywordflow">if</span> (!bIsInitialized) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Not initialized; call OT_API::Init first.\n&quot;</span>,__FUNCTION__); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13713"></a>13713 
<a name="l13714"></a>13714     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13715"></a>13715     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13716"></a>13716     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13717"></a>13717     <span class="comment">// -----------------------------------------------</span>
<a name="l13718"></a>13718 
<a name="l13719"></a>13719 
<a name="l13720"></a>13720     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a>    theServerID(SERVER_ID), theNymID(USER_ID);
<a name="l13721"></a>13721     <span class="keyword">const</span> <a class="code" href="class_o_t_string.html">OTString</a>  strMessage(THE_MESSAGE), strNymID(theNymID);
<a name="l13722"></a>13722 
<a name="l13723"></a>13723     <span class="comment">// -----------------------------------------------------</span>
<a name="l13724"></a>13724     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> * pNym = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#aa53f110b77dee2bc71b70906ca64fbbc">GetOrLoadPrivateNym</a>(theNymID, <span class="keyword">false</span>);
<a name="l13725"></a>13725     <span class="keywordflow">if</span> (NULL == pNym) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13726"></a>13726     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13727"></a>13727     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l13728"></a>13728 
<a name="l13729"></a>13729     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13730"></a>13730     {
<a name="l13731"></a>13731         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed trying to load @createUserAccount() message from string (it&#39;s a server reply.) Contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, strMessage.Get());
<a name="l13732"></a>13732         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13733"></a>13733     }
<a name="l13734"></a>13734     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13735"></a>13735     <span class="keywordflow">if</span> (<span class="keyword">false</span> == strNymID.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>))
<a name="l13736"></a>13736     {
<a name="l13737"></a>13737         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed. Though success loading message from string, it had the wrong NymID. &quot;</span>
<a name="l13738"></a>13738             <span class="stringliteral">&quot;(Expected %s, but found %s.) Message contents:\n\n%s\n\n&quot;</span>, __FUNCTION__,
<a name="l13739"></a>13739             strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), theMessage.<a class="code" href="class_o_t_message.html#a61b38b159dbb516bb3f4f382b936238a">m_strNymID</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strMessage.Get());
<a name="l13740"></a>13740         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13741"></a>13741     }
<a name="l13742"></a>13742     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13743"></a>13743     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@createUserAccount&quot;</span>))
<a name="l13744"></a>13744     {
<a name="l13745"></a>13745         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed. Though success loading message from string, it had the wrong command type. &quot;</span>
<a name="l13746"></a>13746             <span class="stringliteral">&quot;(Expected @createUserAccount, but found %s.) Message contents:\n\n%s\n\n&quot;</span>, __FUNCTION__,
<a name="l13747"></a>13747             theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), strMessage.Get());
<a name="l13748"></a>13748         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13749"></a>13749     }
<a name="l13750"></a>13750     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13751"></a>13751     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l13752"></a>13752     {
<a name="l13753"></a>13753         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed. Though success loading @createUserAccount() message, the payload was empty. &quot;</span>
<a name="l13754"></a>13754             <span class="stringliteral">&quot;(Expected theMessageNym to be there, so I could re-sync client side to server.) Message contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, strMessage.Get());
<a name="l13755"></a>13755         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13756"></a>13756     }
<a name="l13757"></a>13757     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13758"></a>13758     <a class="code" href="class_o_t_string.html">OTString</a> strMessageNym;
<a name="l13759"></a>13759 
<a name="l13760"></a>13760     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_a_s_c_i_i_armor.html#ab39b6cae69c14149716e5ce7a6f0bb0f">GetString</a>(strMessageNym))
<a name="l13761"></a>13761     {
<a name="l13762"></a>13762         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed decoding message payload in server reply: @createUserAccount(). &quot;</span>
<a name="l13763"></a>13763             <span class="stringliteral">&quot;(Expected theMessageNym to be there, so I could re-sync client side to server.) Message contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, strMessage.Get());
<a name="l13764"></a>13764         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13765"></a>13765     }
<a name="l13766"></a>13766     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13767"></a>13767     <a class="code" href="class_o_t_pseudonym.html">OTPseudonym</a> theMessageNym; <span class="comment">// &lt;====================</span>
<a name="l13768"></a>13768 
<a name="l13769"></a>13769     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessageNym.<a class="code" href="class_o_t_pseudonym.html#a7992e8fbf785eeb2d5158cdf966c7a1b">LoadFromString</a>(strMessageNym))
<a name="l13770"></a>13770     {
<a name="l13771"></a>13771         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed loading theMessageNym from a string. String contents:\n\n%s\n\n&quot;</span>, __FUNCTION__, strMessageNym.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l13772"></a>13772         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l13773"></a>13773     }
<a name="l13774"></a>13774     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13775"></a>13775     <span class="comment">// Based on serverID and UserID, load the Nymbox.</span>
<a name="l13776"></a>13776     <span class="comment">//</span>
<a name="l13777"></a>13777     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theNymbox(theNymID, theNymID, theServerID); <span class="comment">// &lt;===========</span>
<a name="l13778"></a>13778 
<a name="l13779"></a>13779     <span class="keywordtype">bool</span> bSynced        = <span class="keyword">false</span>;
<a name="l13780"></a>13780     <span class="keywordtype">bool</span> bLoadedNymbox  = (theNymbox.<a class="code" href="class_o_t_ledger.html#aa77a7e498b3866d054b3c58fb6c8e7d7">LoadNymbox</a>() &amp;&amp; theNymbox.<a class="code" href="class_o_t_ledger.html#a3511c200c6eaa50c6cf249c8995fcb7e">VerifyAccount</a>(*pNym));
<a name="l13781"></a>13781 
<a name="l13782"></a>13782     <span class="keywordflow">if</span> (bLoadedNymbox)
<a name="l13783"></a>13783         bSynced = <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#a8257fd4d11d7a54cc633edb5224d55f4">ResyncNymWithServer</a>(*pNym, theNymbox, theMessageNym);
<a name="l13784"></a>13784     <span class="keywordflow">else</span>
<a name="l13785"></a>13785         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Failed while loading or verifying Nymbox for User %s, on Server %s \n&quot;</span>, __FUNCTION__, strNymID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), SERVER_ID.c_str());
<a name="l13786"></a>13786     <span class="comment">// -----------------------------------------------------------------</span>
<a name="l13787"></a>13787 
<a name="l13788"></a>13788     <span class="keywordflow">return</span> bSynced;
<a name="l13789"></a>13789 }
<a name="l13790"></a>13790 
<a name="l13791"></a>13791 
<a name="l13792"></a>13792 
<a name="l13793"></a>13793 
<a name="l13794"></a>13794 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13795"></a>13795 <span class="comment">// QUERY ASSET TYPES (server message)</span>
<a name="l13796"></a>13796 <span class="comment">//</span>
<a name="l13797"></a>13797 <span class="comment">// This way you can ask the server to confirm whether various</span>
<a name="l13798"></a>13798 <span class="comment">// asset types are issued there. You must prepare the encoded</span>
<a name="l13799"></a>13799 <span class="comment">// StringMap in advance of calling this function.</span>
<a name="l13800"></a>13800 <span class="comment">//</span>
<a name="l13801"></a>13801 
<a name="l13802"></a>13802 <span class="comment">// Returns int32_t:</span>
<a name="l13803"></a>13803 <span class="comment">// -1 means error; no message was sent.</span>
<a name="l13804"></a>13804 <span class="comment">// -2 means the message was sent, but the request number must be passed as a string, so call OTAPI_Exec::GetLargeRequestNum.</span>
<a name="l13805"></a>13805 <span class="comment">//  0 means NO error, but also: no message was sent.</span>
<a name="l13806"></a>13806 <span class="comment">// &gt;0 means NO error, and the message was sent, and the request number fits into an integer...</span>
<a name="l13807"></a>13807 <span class="comment">//  ...and in fact the requestNum IS the return value!</span>
<a name="l13808"></a>13808 <span class="comment">//  ===&gt; In 99% of cases, this LAST option is what actually happens!!</span>
<a name="l13809"></a>13809 <span class="comment">//</span>
<a name="l13810"></a><a class="code" href="class_o_t_a_p_i___exec.html#a9103c1fd88d7819719b3485bc2127e50">13810</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a9103c1fd88d7819719b3485bc2127e50">OTAPI_Exec::queryAssetTypes</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID, <span class="keyword">const</span> std::string &amp; USER_ID, <span class="keyword">const</span> std::string &amp; ENCODED_MAP)
<a name="l13811"></a>13811 {
<a name="l13812"></a>13812     <span class="keywordflow">if</span> (SERVER_ID.empty())          { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>          ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13813"></a>13813     <span class="keywordflow">if</span> (USER_ID.empty())            { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>            ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13814"></a>13814     <span class="keywordflow">if</span> (ENCODED_MAP.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ENCODED_MAP&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13815"></a>13815 
<a name="l13816"></a>13816     <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID);
<a name="l13817"></a>13817     <a class="code" href="class_o_t_a_s_c_i_i_armor.html">OTASCIIArmor</a> theArmor(ENCODED_MAP);
<a name="l13818"></a>13818 
<a name="l13819"></a>13819     <span class="keywordflow">return</span> <a class="code" href="class_o_t_a_p_i___exec.html#afc695435b4053950845879a9e6b95d4f">OTAPI</a>()-&gt;<a class="code" href="class_o_t___a_p_i.html#ab1188ffba89c5ab70a5924effb4f0477">queryAssetTypes</a>(theServerID, theUserID, theArmor);
<a name="l13820"></a>13820 }
<a name="l13821"></a>13821 
<a name="l13822"></a>13822 
<a name="l13823"></a>13823 
<a name="l13824"></a>13824 
<a name="l13825"></a>13825 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13826"></a>13826 <span class="comment">// GET MESSAGE PAYLOAD</span>
<a name="l13827"></a>13827 <span class="comment">//</span>
<a name="l13828"></a>13828 <span class="comment">// This way you can retrieve the payload from any message.</span>
<a name="l13829"></a>13829 <span class="comment">// Useful, for example, for getting the encoded StringMap object</span>
<a name="l13830"></a>13830 <span class="comment">// from the queryAssetTypes and @queryAssetTypes messages, which both</span>
<a name="l13831"></a>13831 <span class="comment">// use the m_ascPayload field to transport it.</span>
<a name="l13832"></a>13832 <span class="comment">//</span>
<a name="l13833"></a><a class="code" href="class_o_t_a_p_i___exec.html#a8dc2de784de5e6ea5d73d71a56e951b2">13833</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a8dc2de784de5e6ea5d73d71a56e951b2">OTAPI_Exec::Message_GetPayload</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13834"></a>13834 {
<a name="l13835"></a>13835     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13836"></a>13836 
<a name="l13837"></a>13837     <a class="code" href="class_o_t_string.html">OTString</a>    strMessage(THE_MESSAGE);
<a name="l13838"></a>13838     <a class="code" href="class_o_t_message.html">OTMessage</a>   theMessage;
<a name="l13839"></a>13839 
<a name="l13840"></a>13840     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13841"></a>13841         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13842"></a>13842 
<a name="l13843"></a>13843     std::string pBuf = theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13844"></a>13844 
<a name="l13845"></a>13845 
<a name="l13846"></a>13846 
<a name="l13847"></a>13847     <span class="keywordflow">return</span> pBuf;
<a name="l13848"></a>13848 }
<a name="l13849"></a>13849 
<a name="l13850"></a>13850 
<a name="l13851"></a>13851 
<a name="l13852"></a>13852 
<a name="l13853"></a>13853 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13854"></a>13854 <span class="comment">// GET MESSAGE COMMAND TYPE</span>
<a name="l13855"></a>13855 <span class="comment">//</span>
<a name="l13856"></a>13856 <span class="comment">// This way you can discover what kind of command it was.</span>
<a name="l13857"></a>13857 <span class="comment">// All server replies are pre-pended with the @ sign. For example, if</span>
<a name="l13858"></a>13858 <span class="comment">// you send a &quot;getAccount&quot; message, the server reply is &quot;@getAccount&quot;,</span>
<a name="l13859"></a>13859 <span class="comment">// and if you send &quot;getMint&quot; the reply is &quot;@getMint&quot;, and so on.</span>
<a name="l13860"></a>13860 <span class="comment">//</span>
<a name="l13861"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4e3665a9990c226dd4981c9db2a3f693">13861</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4e3665a9990c226dd4981c9db2a3f693">OTAPI_Exec::Message_GetCommand</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13862"></a>13862 {
<a name="l13863"></a>13863     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13864"></a>13864 
<a name="l13865"></a>13865     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l13866"></a>13866 
<a name="l13867"></a>13867     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l13868"></a>13868 
<a name="l13869"></a>13869     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13870"></a>13870         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13871"></a>13871 
<a name="l13872"></a>13872     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>);
<a name="l13873"></a>13873 
<a name="l13874"></a>13874     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13875"></a>13875 
<a name="l13876"></a>13876     <span class="keywordflow">return</span> pBuf;
<a name="l13877"></a>13877 }
<a name="l13878"></a>13878 
<a name="l13879"></a>13879 
<a name="l13880"></a>13880 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13881"></a>13881 <span class="comment">// GET MESSAGE LEDGER</span>
<a name="l13882"></a>13882 <span class="comment">//</span>
<a name="l13883"></a>13883 <span class="comment">// If you just received a server response to a transaction, and</span>
<a name="l13884"></a>13884 <span class="comment">// you want to actually iterate through the transactions in the</span>
<a name="l13885"></a>13885 <span class="comment">// response ledger for that transaction, this function will retrieve</span>
<a name="l13886"></a>13886 <span class="comment">// that ledger for you.</span>
<a name="l13887"></a>13887 <span class="comment">//</span>
<a name="l13888"></a><a class="code" href="class_o_t_a_p_i___exec.html#afbc53195dcad5ab5231e9c5ac4ac909f">13888</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#afbc53195dcad5ab5231e9c5ac4ac909f">OTAPI_Exec::Message_GetLedger</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13889"></a>13889 {
<a name="l13890"></a>13890     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>       ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13891"></a>13891 
<a name="l13892"></a>13892     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l13893"></a>13893 
<a name="l13894"></a>13894     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l13895"></a>13895 
<a name="l13896"></a>13896     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13897"></a>13897     {
<a name="l13898"></a>13898         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l13899"></a>13899         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13900"></a>13900     }
<a name="l13901"></a>13901 
<a name="l13902"></a>13902     <span class="comment">// It&#39;s not a transaction request or response, so the Payload wouldn&#39;t</span>
<a name="l13903"></a>13903     <span class="comment">// contain a ledger. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l13904"></a>13904     <span class="comment">// in that case, now do I?)</span>
<a name="l13905"></a>13905     <span class="comment">//</span>
<a name="l13906"></a>13906     <span class="keywordflow">if</span> ((<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;notarizeTransactions&quot;</span>)) &amp;&amp;
<a name="l13907"></a>13907         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@notarizeTransactions&quot;</span>)))
<a name="l13908"></a>13908     {
<a name="l13909"></a>13909         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l13910"></a>13910         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13911"></a>13911     }
<a name="l13912"></a>13912 
<a name="l13913"></a>13913     <span class="comment">// The ledger is stored in the Payload, we&#39;ll grab it into the String.</span>
<a name="l13914"></a>13914     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>);
<a name="l13915"></a>13915 
<a name="l13916"></a>13916     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l13917"></a>13917     {
<a name="l13918"></a>13918         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No ledger found on message.\n&quot;</span>, __FUNCTION__);
<a name="l13919"></a>13919         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13920"></a>13920     }
<a name="l13921"></a>13921 
<a name="l13922"></a>13922     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13923"></a>13923 
<a name="l13924"></a>13924 
<a name="l13925"></a>13925 
<a name="l13926"></a>13926     <span class="keywordflow">return</span> pBuf;
<a name="l13927"></a>13927 }
<a name="l13928"></a>13928 
<a name="l13929"></a>13929 
<a name="l13930"></a>13930 
<a name="l13931"></a>13931 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13932"></a>13932 <span class="comment">// GET NEW ASSET TYPE ID</span>
<a name="l13933"></a>13933 <span class="comment">//</span>
<a name="l13934"></a>13934 <span class="comment">// If you just issued a new asset type, you&#39;ll want to read the</span>
<a name="l13935"></a>13935 <span class="comment">// server reply and get the new asset type ID out of it.</span>
<a name="l13936"></a>13936 <span class="comment">// Otherwise how will you ever open accounts in that new type?</span>
<a name="l13937"></a>13937 <span class="comment">//</span>
<a name="l13938"></a><a class="code" href="class_o_t_a_p_i___exec.html#ad1bfd4d027d5ba28ba126297c99a2952">13938</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#ad1bfd4d027d5ba28ba126297c99a2952">OTAPI_Exec::Message_GetNewAssetTypeID</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13939"></a>13939 {
<a name="l13940"></a>13940     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13941"></a>13941 
<a name="l13942"></a>13942     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l13943"></a>13943 
<a name="l13944"></a>13944     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l13945"></a>13945 
<a name="l13946"></a>13946     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13947"></a>13947     {
<a name="l13948"></a>13948         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l13949"></a>13949         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13950"></a>13950     }
<a name="l13951"></a>13951 
<a name="l13952"></a>13952     <span class="comment">// It&#39;s not a transaction request or response, so the Payload wouldn&#39;t</span>
<a name="l13953"></a>13953     <span class="comment">// contain a ledger. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l13954"></a>13954     <span class="comment">// in that case, now do I?)</span>
<a name="l13955"></a>13955     <span class="comment">//</span>
<a name="l13956"></a>13956     <span class="keywordflow">if</span> ((<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@issueAssetType&quot;</span>)) &amp;&amp;
<a name="l13957"></a>13957         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@issueBasket&quot;</span>)))
<a name="l13958"></a>13958     {
<a name="l13959"></a>13959         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l13960"></a>13960         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13961"></a>13961     }
<a name="l13962"></a>13962 
<a name="l13963"></a>13963     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#a7cbf8c19d4be37bc2f67a8b8df7e701f">m_strAssetID</a>);
<a name="l13964"></a>13964 
<a name="l13965"></a>13965     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l13966"></a>13966     {
<a name="l13967"></a>13967         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No new asset type ID found on message.\n&quot;</span>, __FUNCTION__);
<a name="l13968"></a>13968         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13969"></a>13969     }
<a name="l13970"></a>13970 
<a name="l13971"></a>13971     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l13972"></a>13972 
<a name="l13973"></a>13973 
<a name="l13974"></a>13974 
<a name="l13975"></a>13975     <span class="keywordflow">return</span> pBuf;
<a name="l13976"></a>13976 }
<a name="l13977"></a>13977 
<a name="l13978"></a>13978 
<a name="l13979"></a>13979 <span class="comment">// -----------------------------------------------------------</span>
<a name="l13980"></a>13980 <span class="comment">// GET NEW ISSUER ACCOUNT ID</span>
<a name="l13981"></a>13981 <span class="comment">//</span>
<a name="l13982"></a>13982 <span class="comment">// If you just issued a new asset type, you&#39;ll want to read the</span>
<a name="l13983"></a>13983 <span class="comment">// server reply and get the new issuer acct ID out of it.</span>
<a name="l13984"></a>13984 <span class="comment">// Otherwise how will you ever issue anything with it?</span>
<a name="l13985"></a>13985 <span class="comment">//</span>
<a name="l13986"></a><a class="code" href="class_o_t_a_p_i___exec.html#a2fce33981138126dbb29b0800440de87">13986</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a2fce33981138126dbb29b0800440de87">OTAPI_Exec::Message_GetNewIssuerAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l13987"></a>13987 {
<a name="l13988"></a>13988     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l13989"></a>13989 
<a name="l13990"></a>13990     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l13991"></a>13991 
<a name="l13992"></a>13992     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l13993"></a>13993 
<a name="l13994"></a>13994     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l13995"></a>13995     {
<a name="l13996"></a>13996         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l13997"></a>13997         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l13998"></a>13998     }
<a name="l13999"></a>13999 
<a name="l14000"></a>14000     <span class="comment">// It&#39;s not an issue asset type response, so the m_strAcctID wouldn&#39;t</span>
<a name="l14001"></a>14001     <span class="comment">// contain an issuer account ID. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l14002"></a>14002     <span class="comment">// in that case, now do I?)</span>
<a name="l14003"></a>14003     <span class="comment">//</span>
<a name="l14004"></a>14004     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@issueAssetType&quot;</span>))
<a name="l14005"></a>14005     {
<a name="l14006"></a>14006         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>,  __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14007"></a>14007         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14008"></a>14008     }
<a name="l14009"></a>14009 
<a name="l14010"></a>14010     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>);
<a name="l14011"></a>14011 
<a name="l14012"></a>14012     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14013"></a>14013     {
<a name="l14014"></a>14014         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No issuer account ID found on message.\n&quot;</span>, __FUNCTION__);
<a name="l14015"></a>14015         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14016"></a>14016     }
<a name="l14017"></a>14017 
<a name="l14018"></a>14018     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l14019"></a>14019 
<a name="l14020"></a>14020 
<a name="l14021"></a>14021 
<a name="l14022"></a>14022     <span class="keywordflow">return</span> pBuf;
<a name="l14023"></a>14023 }
<a name="l14024"></a>14024 
<a name="l14025"></a>14025 
<a name="l14026"></a>14026 
<a name="l14027"></a>14027 
<a name="l14028"></a>14028 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14029"></a>14029 <span class="comment">// GET NEW ACCOUNT ID</span>
<a name="l14030"></a>14030 <span class="comment">//</span>
<a name="l14031"></a>14031 <span class="comment">// If you just created a new asset account, you&#39;ll want to read the</span>
<a name="l14032"></a>14032 <span class="comment">// server reply and get the new acct ID out of it.</span>
<a name="l14033"></a>14033 <span class="comment">// Otherwise how will you ever use it?</span>
<a name="l14034"></a>14034 <span class="comment">// This function allows you to get the new account ID out of the</span>
<a name="l14035"></a>14035 <span class="comment">// server reply message.</span>
<a name="l14036"></a>14036 <span class="comment">//</span>
<a name="l14037"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4179300fdda6081f70afaf61c485399e">14037</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#a4179300fdda6081f70afaf61c485399e">OTAPI_Exec::Message_GetNewAcctID</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l14038"></a>14038 {
<a name="l14039"></a>14039     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14040"></a>14040 
<a name="l14041"></a>14041     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l14042"></a>14042 
<a name="l14043"></a>14043     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l14044"></a>14044 
<a name="l14045"></a>14045     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14046"></a>14046     {
<a name="l14047"></a>14047         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l14048"></a>14048         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14049"></a>14049     }
<a name="l14050"></a>14050 
<a name="l14051"></a>14051     <span class="comment">// It&#39;s not a response to createAccount, so the m_strAcctID wouldn&#39;t</span>
<a name="l14052"></a>14052     <span class="comment">// contain a new account ID anyway, right? (Don&#39;t want to pass back whatever</span>
<a name="l14053"></a>14053     <span class="comment">// it DOES contain in that case, now do I?)</span>
<a name="l14054"></a>14054     <span class="comment">//</span>
<a name="l14055"></a>14055     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@createAccount&quot;</span>))
<a name="l14056"></a>14056     {
<a name="l14057"></a>14057         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14058"></a>14058         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14059"></a>14059     }
<a name="l14060"></a>14060 
<a name="l14061"></a>14061     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#aeba5afa7ce73d9398cc898a2749acd45">m_strAcctID</a>);
<a name="l14062"></a>14062 
<a name="l14063"></a>14063     <span class="keywordflow">if</span> (!strOutput.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14064"></a>14064     {
<a name="l14065"></a>14065         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No asset account ID found on message.\n&quot;</span>, __FUNCTION__);
<a name="l14066"></a>14066         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14067"></a>14067     }
<a name="l14068"></a>14068 
<a name="l14069"></a>14069     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l14070"></a>14070 
<a name="l14071"></a>14071 
<a name="l14072"></a>14072 
<a name="l14073"></a>14073     <span class="keywordflow">return</span> pBuf;
<a name="l14074"></a>14074 }
<a name="l14075"></a>14075 
<a name="l14076"></a>14076 
<a name="l14077"></a>14077 
<a name="l14078"></a>14078 
<a name="l14079"></a>14079 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14080"></a>14080 <span class="comment">// GET NYMBOX HASH</span>
<a name="l14081"></a>14081 <span class="comment">//</span>
<a name="l14082"></a>14082 <span class="comment">// Some messages include a copy of the Nymbox Hash. This helps the</span>
<a name="l14083"></a>14083 <span class="comment">// server to quickly ascertain whether some messages will fail, and</span>
<a name="l14084"></a>14084 <span class="comment">// also allows the client to query the server for this information</span>
<a name="l14085"></a>14085 <span class="comment">// for syncronicity purposes.</span>
<a name="l14086"></a>14086 <span class="comment">//</span>
<a name="l14087"></a><a class="code" href="class_o_t_a_p_i___exec.html#abfaaae79076695bf0ec9dac56c17f2fb">14087</a> std::string <a class="code" href="class_o_t_a_p_i___exec.html#abfaaae79076695bf0ec9dac56c17f2fb">OTAPI_Exec::Message_GetNymboxHash</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l14088"></a>14088 {
<a name="l14089"></a>14089     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14090"></a>14090 
<a name="l14091"></a>14091     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l14092"></a>14092 
<a name="l14093"></a>14093     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l14094"></a>14094 
<a name="l14095"></a>14095     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14096"></a>14096     {
<a name="l14097"></a>14097         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>, __FUNCTION__);
<a name="l14098"></a>14098         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14099"></a>14099     }
<a name="l14100"></a>14100 
<a name="l14101"></a>14101     <span class="comment">// So far these are the only messages that use m_strNymboxHash:</span>
<a name="l14102"></a>14102     <span class="keywordflow">if</span> (
<a name="l14103"></a>14103         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;processNymbox&quot;</span>)) &amp;&amp;
<a name="l14104"></a>14104         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;notarizeTransactions&quot;</span>)) &amp;&amp;
<a name="l14105"></a>14105         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;getTransactionNum&quot;</span>)) &amp;&amp;
<a name="l14106"></a>14106         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;processInbox&quot;</span>)) &amp;&amp;
<a name="l14107"></a>14107         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;triggerClause&quot;</span>)) &amp;&amp;
<a name="l14108"></a>14108         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@getNymbox&quot;</span>)) &amp;&amp;
<a name="l14109"></a>14109         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@getRequest&quot;</span>)) &amp;&amp;
<a name="l14110"></a>14110         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@getTransactionNum&quot;</span>))
<a name="l14111"></a>14111         )
<a name="l14112"></a>14112     {
<a name="l14113"></a>14113         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s \nFYI, with m_strNymboxHash: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>(), theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14114"></a>14114         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14115"></a>14115     }
<a name="l14116"></a>14116 
<a name="l14117"></a>14117     <span class="keywordflow">if</span> (!theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14118"></a>14118     {
<a name="l14119"></a>14119         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No NymboxHash found on message: %s\n&quot;</span>, __FUNCTION__, strMessage.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14120"></a>14120         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l14121"></a>14121     }
<a name="l14122"></a>14122 
<a name="l14123"></a>14123     <a class="code" href="class_o_t_string.html">OTString</a> strOutput(theMessage.<a class="code" href="class_o_t_message.html#a3038ccc70302742da4df4c3af1093b78">m_strNymboxHash</a>);
<a name="l14124"></a>14124     std::string pBuf = strOutput.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>();
<a name="l14125"></a>14125 
<a name="l14126"></a>14126 
<a name="l14127"></a>14127 
<a name="l14128"></a>14128     <span class="keywordflow">return</span> pBuf;
<a name="l14129"></a>14129 }
<a name="l14130"></a>14130 
<a name="l14131"></a>14131 
<a name="l14132"></a>14132 
<a name="l14133"></a>14133 
<a name="l14134"></a>14134 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14135"></a>14135 <span class="comment">// GET MESSAGE SUCCESS (True or False)</span>
<a name="l14136"></a>14136 <span class="comment">//</span>
<a name="l14137"></a>14137 <span class="comment">// Returns true (1) for Success and false (0) for Failure.</span>
<a name="l14138"></a>14138 <span class="comment">//</span>
<a name="l14139"></a>14139 <span class="comment">// NEW: returns (-1) for error!</span>
<a name="l14140"></a>14140 <span class="comment">//</span>
<a name="l14141"></a><a class="code" href="class_o_t_a_p_i___exec.html#a74918f6e7d392c9d1b5bd1bf6cf77647">14141</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#a74918f6e7d392c9d1b5bd1bf6cf77647">OTAPI_Exec::Message_GetSuccess</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l14142"></a>14142 {
<a name="l14143"></a>14143     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14144"></a>14144 
<a name="l14145"></a>14145     <a class="code" href="class_o_t_message.html">OTMessage</a>   theMessage;
<a name="l14146"></a>14146     <a class="code" href="class_o_t_string.html">OTString</a>    strMessage(THE_MESSAGE);
<a name="l14147"></a>14147 
<a name="l14148"></a>14148     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14149"></a>14149     {
<a name="l14150"></a>14150         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: THE_MESSAGE doesn&#39;t exist.\n&quot;</span>, __FUNCTION__);
<a name="l14151"></a>14151         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14152"></a>14152     }
<a name="l14153"></a>14153 
<a name="l14154"></a>14154     <span class="keywordflow">if</span> (!theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14155"></a>14155     {
<a name="l14156"></a>14156         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error: Failed loading message from string:\n\n%s\n\n&quot;</span>, __FUNCTION__, THE_MESSAGE.c_str());
<a name="l14157"></a>14157         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14158"></a>14158     }
<a name="l14159"></a>14159     <span class="comment">// ---------------------------------------------</span>
<a name="l14160"></a>14160     <span class="keywordflow">if</span> (<span class="keyword">true</span> == theMessage.<a class="code" href="class_o_t_message.html#ad6d611b1178ec24da0a380fb461300b8">m_bSuccess</a>)
<a name="l14161"></a>14161     {
<a name="l14162"></a>14162         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(2, <span class="stringliteral">&quot;%s: Server reply for RequestNum %lld (Message_GetSuccess was successful, but any transaction inside could have failed OR succeeded. Use Message_GetTransactionSuccess for that.)\n&quot;</span>,<span class="comment">// Contents: \n\n%s\n\n&quot;,</span>
<a name="l14163"></a>14163             __FUNCTION__, <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">StringToLong</a>(theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));<span class="comment">//, THE_MESSAGE);</span>
<a name="l14164"></a>14164         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l14165"></a>14165     }
<a name="l14166"></a>14166     <span class="keywordflow">else</span>
<a name="l14167"></a>14167     {
<a name="l14168"></a>14168         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: ** FYI, server reply was received, and &quot;</span>
<a name="l14169"></a>14169             <span class="stringliteral">&quot;it said &#39;No.&#39; (Status = failed). RequestNum: %lld\n&quot;</span>,<span class="comment">// Contents: \n\n%s\n\n&quot;,</span>
<a name="l14170"></a>14170             __FUNCTION__, <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">StringToLong</a>(theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>()));<span class="comment">//, THE_MESSAGE);</span>
<a name="l14171"></a>14171     }
<a name="l14172"></a>14172     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l14173"></a>14173 }
<a name="l14174"></a>14174 
<a name="l14175"></a>14175 
<a name="l14176"></a>14176 
<a name="l14177"></a>14177 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14178"></a>14178 <span class="comment">// GET MESSAGE &quot;DEPTH&quot;   (USED FOR MARKET-SPECIFIC MESSAGES.)</span>
<a name="l14179"></a>14179 <span class="comment">//</span>
<a name="l14180"></a>14180 <span class="comment">// Returns the count of relevant items, so you know whether to bother reading the payload.</span>
<a name="l14181"></a>14181 <span class="comment">// Returns -1 if error.</span>
<a name="l14182"></a>14182 <span class="comment">//</span>
<a name="l14183"></a>14183 <span class="comment">// The &quot;depth&quot; variable stores the count of items being returned.</span>
<a name="l14184"></a>14184 <span class="comment">// For example, if I call getMarketList, and 10 markets are returned,</span>
<a name="l14185"></a>14185 <span class="comment">// then depth will be set to 10. OR, if I call getNym_MarketOffers, and</span>
<a name="l14186"></a>14186 <span class="comment">// the Nym has 16 offers on the various markets, then the depth will be 16.</span>
<a name="l14187"></a>14187 <span class="comment">//</span>
<a name="l14188"></a>14188 <span class="comment">// This value is important when processing server replies to market inquiries.</span>
<a name="l14189"></a>14189 <span class="comment">// If the depth is 0, then you are done. End. BUT! if it contains a number, such as 10,</span>
<a name="l14190"></a>14190 <span class="comment">// then that means you will want to next READ those 10 markets (or offers, or trades, etc)</span>
<a name="l14191"></a>14191 <span class="comment">// out of the server reply&#39;s payload.</span>
<a name="l14192"></a>14192 <span class="comment">//</span>
<a name="l14193"></a>14193 <span class="comment">// Whereas if success is TRUE, but depth is 0, that means while the message processed</span>
<a name="l14194"></a>14194 <span class="comment">// successfully, the list was simply empty (and thus it would be a waste of time trying</span>
<a name="l14195"></a>14195 <span class="comment">// to unpack the non-existent, empty list of data items from the payload of your successful</span>
<a name="l14196"></a>14196 <span class="comment">// reply.)</span>
<a name="l14197"></a>14197 <span class="comment">//</span>
<a name="l14198"></a><a class="code" href="class_o_t_a_p_i___exec.html#a4d2f83207774557d0a71bfbceadca34f">14198</a> int32_t <a class="code" href="class_o_t_a_p_i___exec.html#a4d2f83207774557d0a71bfbceadca34f">OTAPI_Exec::Message_GetDepth</a>(<span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l14199"></a>14199 {
<a name="l14200"></a>14200     <span class="keywordflow">if</span> (THE_MESSAGE.empty())        { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span>        ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14201"></a>14201 
<a name="l14202"></a>14202     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l14203"></a>14203 
<a name="l14204"></a>14204     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l14205"></a>14205 
<a name="l14206"></a>14206     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14207"></a>14207         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14208"></a>14208 
<a name="l14209"></a>14209     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(theMessage.<a class="code" href="class_o_t_message.html#a04ef2907cff33f832b438c93f17880b7">m_lDepth</a>);
<a name="l14210"></a>14210 }
<a name="l14211"></a>14211 
<a name="l14212"></a>14212 
<a name="l14213"></a>14213 
<a name="l14214"></a>14214 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14215"></a>14215 <span class="comment">// GET MESSAGE TRANSACTION &quot;IS CANCELLED&quot; (True or False)</span>
<a name="l14216"></a>14216 <span class="comment">//</span>
<a name="l14217"></a>14217 <span class="comment">// Returns true (1) for Success and false (0) for Failure.</span>
<a name="l14218"></a>14218 <span class="comment">//         also returns (-1) for Error</span>
<a name="l14219"></a>14219 <span class="comment">//</span>
<a name="l14220"></a><a class="code" href="class_o_t_a_p_i___exec.html#a601be53bd7d0027de7a8f8c643a95bd3">14220</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#a601be53bd7d0027de7a8f8c643a95bd3">OTAPI_Exec::Message_IsTransactionCanceled</a>(
<a name="l14221"></a>14221                                                   <span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l14222"></a>14222                                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l14223"></a>14223                                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l14224"></a>14224                                                   <span class="keyword">const</span> std::string &amp; THE_MESSAGE
<a name="l14225"></a>14225                                                   )
<a name="l14226"></a>14226 {
<a name="l14227"></a>14227     <span class="keywordflow">if</span> (SERVER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14228"></a>14228     <span class="keywordflow">if</span> (USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14229"></a>14229     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14230"></a>14230     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14231"></a>14231 
<a name="l14232"></a>14232     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l14233"></a>14233 
<a name="l14234"></a>14234     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l14235"></a>14235 
<a name="l14236"></a>14236     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l14237"></a>14237 
<a name="l14238"></a>14238     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14239"></a>14239     {
<a name="l14240"></a>14240         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>,__FUNCTION__);
<a name="l14241"></a>14241         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14242"></a>14242     }
<a name="l14243"></a>14243 
<a name="l14244"></a>14244     <span class="comment">// It&#39;s not a transaction request or response, so the Payload wouldn&#39;t</span>
<a name="l14245"></a>14245     <span class="comment">// contain a ledger. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l14246"></a>14246     <span class="comment">// in that case, now do I?)</span>
<a name="l14247"></a>14247     <span class="comment">//</span>
<a name="l14248"></a>14248     <span class="keywordflow">if</span> (
<a name="l14249"></a>14249         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@notarizeTransactions&quot;</span>)) &amp;&amp;
<a name="l14250"></a>14250         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processInbox&quot;</span>)) &amp;&amp;
<a name="l14251"></a>14251         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processNymbox&quot;</span>))
<a name="l14252"></a>14252         )
<a name="l14253"></a>14253     {
<a name="l14254"></a>14254         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14255"></a>14255         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14256"></a>14256     }
<a name="l14257"></a>14257 
<a name="l14258"></a>14258     <span class="comment">// The ledger is stored in the Payload, we&#39;ll grab it into the String.</span>
<a name="l14259"></a>14259     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>);
<a name="l14260"></a>14260 
<a name="l14261"></a>14261     <span class="keywordflow">if</span> (!strLedger.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14262"></a>14262     {
<a name="l14263"></a>14263         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No ledger found on message.\n&quot;</span>, __FUNCTION__);
<a name="l14264"></a>14264         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14265"></a>14265     }
<a name="l14266"></a>14266 
<a name="l14267"></a>14267     <span class="comment">// ------------------------------------</span>
<a name="l14268"></a>14268 
<a name="l14269"></a>14269     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l14270"></a>14270 
<a name="l14271"></a>14271     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strLedger))
<a name="l14272"></a>14272     {
<a name="l14273"></a>14273         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l14274"></a>14274         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14275"></a>14275         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14276"></a>14276     }
<a name="l14277"></a>14277 
<a name="l14278"></a>14278     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l14279"></a>14279 
<a name="l14280"></a>14280     <span class="keywordflow">if</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &lt;= 0)
<a name="l14281"></a>14281     {
<a name="l14282"></a>14282         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: bad count in message ledger: %d\n&quot;</span>, __FUNCTION__, theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>());
<a name="l14283"></a>14283         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<a name="l14284"></a>14284     }
<a name="l14285"></a>14285 
<a name="l14286"></a>14286     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(0); <span class="comment">// Right now this is a defacto standard. (only 1 transaction per message ledger, excepting process inbox.)</span>
<a name="l14287"></a>14287 <span class="comment">//  OTCleanup&lt;OTTransaction&gt; theAngel(pTransaction); // THE LEDGER CLEANS THIS ALREADY.</span>
<a name="l14288"></a>14288 
<a name="l14289"></a>14289     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l14290"></a>14290     {
<a name="l14291"></a>14291         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered \&quot;\&quot; pointer: %d\n&quot;</span>, __FUNCTION__, 0);
<a name="l14292"></a>14292         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// Weird.</span>
<a name="l14293"></a>14293     }
<a name="l14294"></a>14294 
<a name="l14295"></a>14295     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return its &#39;canceled&#39; status</span>
<a name="l14296"></a>14296     <span class="comment">//</span>
<a name="l14297"></a>14297     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#aeabba0a2b6a52c8f50a329f7d14a1ba1">IsCancelled</a>())
<a name="l14298"></a>14298         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l14299"></a>14299 
<a name="l14300"></a>14300     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l14301"></a>14301 }
<a name="l14302"></a>14302 
<a name="l14303"></a>14303 <span class="comment">// -----------------------------------------------------------</span>
<a name="l14304"></a>14304 <span class="comment">// GET MESSAGE TRANSACTION SUCCESS (True or False)</span>
<a name="l14305"></a>14305 <span class="comment">//</span>
<a name="l14306"></a>14306 <span class="comment">// Returns true (1) for Success and false (0) for Failure.</span>
<a name="l14307"></a>14307 <span class="comment">//         also returns (-1) for Error</span>
<a name="l14308"></a>14308 <span class="comment">//</span>
<a name="l14309"></a><a class="code" href="class_o_t_a_p_i___exec.html#a1be2395223951358285e4f32507dd405">14309</a> <a class="code" href="_o_t_data_check_8hpp.html#aa3817cab69424142fb73706ef4871d36">OT_BOOL</a> <a class="code" href="class_o_t_a_p_i___exec.html#a1be2395223951358285e4f32507dd405">OTAPI_Exec::Message_GetTransactionSuccess</a>(<span class="keyword">const</span> std::string &amp; SERVER_ID,
<a name="l14310"></a>14310                                                   <span class="keyword">const</span> std::string &amp; USER_ID,
<a name="l14311"></a>14311                                                   <span class="keyword">const</span> std::string &amp; ACCOUNT_ID,
<a name="l14312"></a>14312                                                   <span class="keyword">const</span> std::string &amp; THE_MESSAGE)
<a name="l14313"></a>14313 {
<a name="l14314"></a>14314     <span class="keywordflow">if</span> (SERVER_ID.empty())   { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;SERVER_ID&quot;</span>   ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14315"></a>14315     <span class="keywordflow">if</span> (USER_ID.empty())     { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;USER_ID&quot;</span>     ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14316"></a>14316     <span class="keywordflow">if</span> (ACCOUNT_ID.empty())  { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;ACCOUNT_ID&quot;</span>  ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14317"></a>14317     <span class="keywordflow">if</span> (THE_MESSAGE.empty()) { <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Null: %s passed in!\n&quot;</span>, __FUNCTION__, <span class="stringliteral">&quot;THE_MESSAGE&quot;</span> ); <a class="code" href="_o_t_assert_8hpp.html#a1ae1def3bdc59b89b0d96240d3c5c321">OT_FAIL</a>; }
<a name="l14318"></a>14318 
<a name="l14319"></a>14319     <span class="keyword">const</span> <a class="code" href="class_o_t_identifier.html">OTIdentifier</a> theServerID(SERVER_ID), theUserID(USER_ID), theAccountID(ACCOUNT_ID);
<a name="l14320"></a>14320 
<a name="l14321"></a>14321     <a class="code" href="class_o_t_string.html">OTString</a> strMessage(THE_MESSAGE);
<a name="l14322"></a>14322 
<a name="l14323"></a>14323     <a class="code" href="class_o_t_message.html">OTMessage</a> theMessage;
<a name="l14324"></a>14324 
<a name="l14325"></a>14325     <span class="keywordflow">if</span> (!strMessage.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>() || !theMessage.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strMessage))
<a name="l14326"></a>14326     {
<a name="l14327"></a>14327         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Unable to load message.\n&quot;</span>,__FUNCTION__);
<a name="l14328"></a>14328         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14329"></a>14329     }
<a name="l14330"></a>14330 
<a name="l14331"></a>14331     <span class="comment">// It&#39;s not a transaction request or response, so the Payload wouldn&#39;t</span>
<a name="l14332"></a>14332     <span class="comment">// contain a ledger. (Don&#39;t want to pass back whatever it DOES contain</span>
<a name="l14333"></a>14333     <span class="comment">// in that case, now do I?)</span>
<a name="l14334"></a>14334     <span class="comment">//</span>
<a name="l14335"></a>14335     <span class="keywordflow">if</span> (
<a name="l14336"></a>14336         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@notarizeTransactions&quot;</span>)) &amp;&amp;
<a name="l14337"></a>14337         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processInbox&quot;</span>)) &amp;&amp;
<a name="l14338"></a>14338         (<span class="keyword">false</span> == theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#a03401b39fb66d63696342c4f61ea8bf5">Compare</a>(<span class="stringliteral">&quot;@processNymbox&quot;</span>))
<a name="l14339"></a>14339         )
<a name="l14340"></a>14340     {
<a name="l14341"></a>14341         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: Wrong message type: %s\n&quot;</span>, __FUNCTION__, theMessage.<a class="code" href="class_o_t_message.html#a14c7dc1d2e11075a73e0a9aaf79fd762">m_strCommand</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14342"></a>14342         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14343"></a>14343     }
<a name="l14344"></a>14344 
<a name="l14345"></a>14345     <span class="comment">// The ledger is stored in the Payload, we&#39;ll grab it into the String.</span>
<a name="l14346"></a>14346     <a class="code" href="class_o_t_string.html">OTString</a> strLedger(theMessage.<a class="code" href="class_o_t_message.html#aa6729578b97f61804e91035a7709800a">m_ascPayload</a>);
<a name="l14347"></a>14347 
<a name="l14348"></a>14348     <span class="keywordflow">if</span> (!strLedger.<a class="code" href="class_o_t_string.html#adf7489cd917d4ae5bf30853a3ad78daf">Exists</a>())
<a name="l14349"></a>14349     {
<a name="l14350"></a>14350         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(0, <span class="stringliteral">&quot;%s: No ledger found on message.\n&quot;</span>, __FUNCTION__);
<a name="l14351"></a>14351         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14352"></a>14352     }
<a name="l14353"></a>14353 
<a name="l14354"></a>14354     <span class="comment">// ------------------------------------</span>
<a name="l14355"></a>14355 
<a name="l14356"></a>14356     <a class="code" href="class_o_t_ledger.html">OTLedger</a> theLedger(theUserID, theAccountID, theServerID);
<a name="l14357"></a>14357 
<a name="l14358"></a>14358     <span class="keywordflow">if</span> (<span class="keyword">false</span> == theLedger.<a class="code" href="class_o_t_contract.html#a36300e34dcd94ed7006d98b392d46815">LoadContractFromString</a>(strLedger))
<a name="l14359"></a>14359     {
<a name="l14360"></a>14360         <a class="code" href="class_o_t_string.html">OTString</a> strAcctID(theAccountID);
<a name="l14361"></a>14361         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: Error loading ledger from string. Acct ID: %s\n&quot;</span>, __FUNCTION__, strAcctID.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14362"></a>14362         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>;
<a name="l14363"></a>14363     }
<a name="l14364"></a>14364 
<a name="l14365"></a>14365     <span class="comment">// At this point, I know theLedger loaded successfully.</span>
<a name="l14366"></a>14366 
<a name="l14367"></a>14367     <span class="keywordflow">if</span> (theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>() &lt;= 0)
<a name="l14368"></a>14368     {
<a name="l14369"></a>14369         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: bad count in message ledger: %d\n&quot;</span>, __FUNCTION__, theLedger.<a class="code" href="class_o_t_ledger.html#a963473034789aca7bab8ddb4b089a3ff">GetTransactionCount</a>());
<a name="l14370"></a>14370         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// out of bounds. I&#39;m saving from an OT_ASSERT_MSG() happening here. (Maybe I shouldn&#39;t.)</span>
<a name="l14371"></a>14371     }
<a name="l14372"></a>14372 
<a name="l14373"></a>14373     <a class="code" href="class_o_t_transaction.html">OTTransaction</a> * pTransaction = theLedger.<a class="code" href="class_o_t_ledger.html#a5ede5441f84527b2717662fa465e526c">GetTransactionByIndex</a>(0); <span class="comment">// Right now this is a defacto standard. (only 1 transaction per message ledger, excepting process inbox.)</span>
<a name="l14374"></a>14374 <span class="comment">//  OTCleanup&lt;OTTransaction&gt; theAngel(pTransaction); // THE LEDGER CLEANS THIS ALREADY.</span>
<a name="l14375"></a>14375 
<a name="l14376"></a>14376     <span class="keywordflow">if</span> (NULL == pTransaction)
<a name="l14377"></a>14377     {
<a name="l14378"></a>14378         <a class="code" href="class_o_t_log.html#acd1264f26723485de0783186149b0eca">OTLog::vError</a>(<span class="stringliteral">&quot;%s: good index but uncovered \&quot;\&quot; pointer: %d\n&quot;</span>, __FUNCTION__, 0);
<a name="l14379"></a>14379         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a8a0b2a3e3d4461ba60ae320c17b09ab4">OT_ERROR</a>; <span class="comment">// Weird.</span>
<a name="l14380"></a>14380     }
<a name="l14381"></a>14381 
<a name="l14382"></a>14382     <span class="comment">// At this point, I actually have the transaction pointer, so let&#39;s return its success status</span>
<a name="l14383"></a>14383     <span class="comment">//</span>
<a name="l14384"></a>14384     <span class="keywordflow">if</span> (pTransaction-&gt;<a class="code" href="class_o_t_transaction.html#ac5ffc9f0e274bbc617185a5335c061a3">GetSuccess</a>())
<a name="l14385"></a>14385         <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#a39b50c1f70f7626e72c95494a44f8921">OT_TRUE</a>;
<a name="l14386"></a>14386     <span class="keywordflow">else</span>
<a name="l14387"></a>14387     {
<a name="l14388"></a>14388         <span class="keyword">const</span> int64_t lRequestNum     = <a class="code" href="class_o_t_a_p_i___exec.html#a1990c82970f94e5e7ca00f9e78d645c9">StringToLong</a>(theMessage.<a class="code" href="class_o_t_message.html#a1f97ec73f2a05d3d3d6fcb4854501dbe">m_strRequestNum</a>.<a class="code" href="class_o_t_string.html#af87b3b43148de9b1425ed8e9348241d3">Get</a>());
<a name="l14389"></a>14389         <span class="keyword">const</span> int64_t lTransactionNum = pTransaction-&gt;<a class="code" href="class_o_t_transaction_type.html#aa204b21b7f498389f746742c1d2007fa">GetTransactionNum</a>();
<a name="l14390"></a>14390 
<a name="l14391"></a>14391         <a class="code" href="class_o_t_log.html#aa2a497c02879b811fe3134631d762f08">OTLog::vOutput</a>(1, <span class="stringliteral">&quot;%s: ** FYI, server reply was received, and it said &#39;No.&#39; (Status = failed). &quot;</span>
<a name="l14392"></a>14392                       <span class="stringliteral">&quot;RequestNum: %lld, TransNum: %lld\n&quot;</span>,<span class="comment">// Contents: \n\n%s\n\n&quot;,</span>
<a name="l14393"></a>14393             __FUNCTION__, lRequestNum, lTransactionNum);<span class="comment">//, THE_MESSAGE);</span>
<a name="l14394"></a>14394     }
<a name="l14395"></a>14395 
<a name="l14396"></a>14396     <span class="keywordflow">return</span> <a class="code" href="_o_t_a_p_i_8cpp.html#aa4db9fe11de208bcc9e4b869c932948b">OT_FALSE</a>;
<a name="l14397"></a>14397 }
<a name="l14398"></a>14398 
<a name="l14399"></a>14399 
<a name="l14400"></a>14400 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_o_t_a_p_i___exec_8cpp.html">OTAPI_Exec.cpp</a>      </li>

    <li class="footer">Generated on Wed May 21 2014 11:26:02 for Open-Transactions by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
